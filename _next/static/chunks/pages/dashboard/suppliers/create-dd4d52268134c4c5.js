(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8360],{90645:function(n,t,e){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/suppliers/create",function(){return e(70121)}])},63047:function(n,t,e){"use strict";e.d(t,{E:function(){return a}});var r,u=e(47568),c=e(97582),s=e(94885),a=(r=(0,u.Z)(function(n,t){var e,r,u,a=arguments;return(0,c.__generator)(this,function(r){switch(r.label){case 0:e=a.length>2&&void 0!==a[2]&&a[2],r.label=1;case 1:return r.trys.push([1,3,,4]),[4,n.query({query:s.WF,variables:{email:t}})];case 2:if((u=r.sent().data.users)&&u.length>0)return[2,!!e&&u[0]];return[2,!e||null];case 3:return r.sent(),[2,!0];case 4:return[2]}})}),function(n,t){return r.apply(this,arguments)})},94885:function(n,t,e){"use strict";e.d(t,{$E:function(){return N},AX:function(){return q},I4:function(){return v},JA:function(){return w},MT:function(){return S},Px:function(){return Z},WF:function(){return L},ZA:function(){return x},a8:function(){return k},fA:function(){return M},fo:function(){return b},ge:function(){return E},iM:function(){return j},nE:function(){return C},nh:function(){return F},r1:function(){return P},tW:function(){return G},uz:function(){return T}});var r=e(7297),u=e(75063);function c(){var n=(0,r.Z)(["\n  mutation InsertAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return c=function(){return n},n}function s(){var n=(0,r.Z)(["\n  mutation UpdateUser(\n    $id: Int!\n    $accountUserId: Int!\n    $accountUserChanges: Account_User_set_input\n    $changes: User_set_input\n    $updateAccountUser: Boolean!\n  ) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _set: $accountUserChanges)\n      @include(if: $updateAccountUser) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return s=function(){return n},n}function a(){var n=(0,r.Z)(["\n  query GetUsers(\n    $accountId: Int\n    $accountType: String\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: User_order_by!\n    $status: String\n  ) {\n    users: User(\n      limit: $limit\n      offset: $offset\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [\n          { email: { _ilike: $q } }\n          { nameFirst: { _ilike: $q } }\n          { nameLast: { _ilike: $q } }\n        ]\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n    meta: User_aggregate(\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return a=function(){return n},n}function i(){var n=(0,r.Z)(["\n  query GetUser($id: Int!) {\n    user: User_by_pk(id: $id) {\n      id\n      fullName\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return i=function(){return n},n}function o(){var n=(0,r.Z)(["\n  query CheckDuplicateEmail($email: String!) {\n    users: User_public(where: { email: { _eq: $email } }) {\n      id\n      nameFirst\n      nameLast\n      email\n      phone\n    }\n  }\n"]);return o=function(){return n},n}function d(){var n=(0,r.Z)(["\n  fragment UserFields on User {\n    id\n    email\n    nameFirst\n    nameLast\n    fullName\n    phone\n    status\n  }\n"]);return d=function(){return n},n}function _(){var n=(0,r.Z)(["\n  mutation SendGoogleAuthCode($code: String!, $id: Int!, $type: String!) {\n    createGoogleToken(code: $code, id: $id, type: $type) {\n      success\n      tokens\n      error\n    }\n  }\n"]);return _=function(){return n},n}function m(){var n=(0,r.Z)(["\n  mutation GenerateMSURL($type: String!, $id: Int!) {\n    genenrateMSURL(id: $id, type: $type) {\n      url\n    }\n  }\n"]);return m=function(){return n},n}function l(){var n=(0,r.Z)(["\n  mutation signoutMS($id: Int!, $type: String!, $email: String!) {\n    signoutMS(id: $id, type: $type, email: $email) {\n      error\n      msId\n      success\n    }\n  }\n"]);return l=function(){return n},n}function f(){var n=(0,r.Z)(["\n  query getAccountMeta($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      meta\n    }\n  }\n"]);return f=function(){return n},n}function p(){var n=(0,r.Z)(["\n  query user($id: Int!) {\n    user: User_by_pk(id: $id) {\n      meta\n      invoiceThreshold\n      quoteThreshold\n    }\n  }\n"]);return p=function(){return n},n}function $(){var n=(0,r.Z)(["\n  query GetAccountUserMeta($userId: Int!, $accountId: Int!) {\n    accountUser: Account_User(where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }) {\n      meta\n    }\n  }\n"]);return $=function(){return n},n}function I(){var n=(0,r.Z)(["\n  mutation UpdateAccountUserByUserIdAccoutId(\n    $userId: Int!\n    $accountId: Int!\n    $changes: Account_User_set_input!\n  ) {\n    update_Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n      _set: $changes\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return I=function(){return n},n}function U(){var n=(0,r.Z)(["\n  mutation updateAccount($accountId: Int!, $set: Account_set_input!) {\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $set) {\n      id\n    }\n  }\n"]);return U=function(){return n},n}function g(){var n=(0,r.Z)(["\n  mutation updateUserMeta($userId: Int!, $meta: jsonb!) {\n    update_User_by_pk(pk_columns: { id: $userId }, _set: { meta: $meta }) {\n      id\n      meta\n    }\n  }\n"]);return g=function(){return n},n}function h(){var n=(0,r.Z)(['\n  query userDevices($accountId: Int!) {\n    users: User(\n      where: {\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        UserDevices: { status: { _eq: "active" } }\n        status: { _eq: "active" }\n      }\n    ) {\n      id\n      fullName\n      devices: UserDevices(\n        order_by: { updatedAt: desc_nulls_last }\n        where: { status: { _eq: "active" } }\n        limit: 1\n      ) {\n        id\n        playerId\n      }\n    }\n  }\n']);return h=function(){return n},n}function y(){var n=(0,r.Z)(['\n  query GetAccountLocations($accountId: Int, $limit: Int, $offset: Int) {\n    location: Location(\n      offset: $offset\n      limit: $limit\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      id\n      name\n      accountLocations: Account_Locations {\n        id\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return y=function(){return n},n}function A(){var n=(0,r.Z)(["\n  mutation InsertUserAccountLocations(\n    $accountUserId: Int!\n    $objects: [User_Account_Location_insert_input!]!\n  ) {\n    delete_User_Account_Location(where: { accountUserId: { _eq: $accountUserId } }) {\n      affected_rows\n    }\n    insert_User_Account_Location(objects: $objects) {\n      affected_rows\n      returning {\n        id\n      }\n    }\n  }\n"]);return A=function(){return n},n}var v=(0,u.Ps)(c()),q=(0,u.Ps)(s()),b=(0,u.Ps)(a()),w=(0,u.Ps)(i()),L=(0,u.Ps)(o()),Z=(0,u.Ps)(d()),k=(0,u.Ps)(_()),P=(0,u.Ps)(m()),S=(0,u.Ps)(l()),C=(0,u.Ps)(f()),F=(0,u.Ps)(p()),j=(0,u.Ps)($()),M=(0,u.Ps)(I()),N=(0,u.Ps)(U()),T=(0,u.Ps)(g()),E=(0,u.Ps)(h()),x=(0,u.Ps)(y()),G=(0,u.Ps)(A())},70121:function(n,t,e){"use strict";e.r(t),e.d(t,{default:function(){return A}});var r=e(85893),u=e(19076),c=e(47568),s=e(828),a=e(97582),i=e(67294),o=e(66252),d=e(50319),_=e(39710),m=e(11163),l=e.n(m),f=e(44666),p=e(74944),$=e(63047),I=e(894),U=e(67797),g=e(49010),h=e(45698),y=function(){var n,t=(0,o.x)(),e=(0,p.x)().user,u=(0,s.Z)((0,U.d)(),2),m=u[0],y=u[1],A=(0,i.useState)(!1),v=A[0],q=A[1],b=(0,i.useState)(!1),w=b[0],L=b[1],Z=(0,s.Z)((0,d.D)(_.KQ,{onCompleted:function(n){var t=n.insert_Account.returning[0].id;l().push("".concat("/dashboard/suppliers/","view?id=").concat(t))}}),1)[0],k=(n=(0,c.Z)(function(n){var u,c;return(0,a.__generator)(this,function(s){switch(s.label){case 0:if(s.trys.push([0,,3,4]),!(0,g.b)(n.vatId)&&!v)return[2,y({content:function(n){var t=n.onClose;return(0,r.jsx)(h.F,{onCancel:t,onConfirm:function(){q(!0),t()}})}})];return L(!0),(u={managerId:n.managerSelected.value,name:n.name,website:n.website||null,companyNumber:n.companyNumber||null,vatId:n.vatId||null,status:n.status,type:"supplier"}).SupplierDetails={data:{typeOfOrganisation:n.typeOfOrganisation||null,quotingEmail:n.quotingEmail||null,utrNumber:n.utrNumber||null,cisRegistered:n.cisRegistered||null}},u.Admins={data:[{adminId:e.accountId,status:n.status}]},[4,(0,$.E)(t,n.contactUseremail,!0)];case 1:return c=s.sent(),u.Account_Users={data:[{isContact:!0,role:"owner",status:n.contactUserstatus}]},c?u.Account_Users.data[0].userId=c.id:u.Account_Users.data[0].User={data:{nameFirst:n.contactUsernameFirst,nameLast:n.contactUsernameLast,email:n.contactUseremail,phone:n.contactUserphone,status:"active",meta:{notificationSettings:{sms:!0,email:!0,toast:!0,pushNotification:!0}}}},[4,Z({variables:{objects:u}})];case 2:return s.sent(),[3,4];case 3:return L(!1),[7];case 4:return[2]}})}),function(t){return n.apply(this,arguments)});return(0,r.jsxs)(r.Fragment,{children:[m,(0,r.jsx)(f.P,{loading:w,onSubmit:k,schema:I.f,type:"supplier"})]})},A=function(){return(0,r.jsx)(u.Z,{pageHeading:{heading:"Suppliers - Create"},View:(0,r.jsx)(y,{})})}}},function(n){n.O(0,[3662,2283,212,8890,9511,2583,6310,4599,7645,3776,3054,1417,4043,6210,7493,4666,3261,9774,2888,179],function(){return n(n.s=90645)}),_N_E=n.O()}]);