(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5230],{92523:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/suppliers/view",function(){return t(78656)}])},65428:function(e,n,t){"use strict";t.d(n,{m:function(){return h}});var i=t(85893),r=t(67294),a=t(6812),o=t(7297),s=t(75063);function u(){var e=(0,o.Z)(["\n  query GetJobsByMonth(\n    $adminId: Int\n    $customerId: Int\n    $endTime: timestamptz\n    $isFixed: Int\n    $isPlanned: Int\n    $locationId: Int\n    $managerId: Int\n    $postCodeAreaId: Int\n    $serviceId: Int\n    $slaId: Int\n    $startTime: timestamptz\n    $supplierId: Int\n  ) {\n    meta: getDashboard_Count_By_Month_aggregate(\n      args: {\n        adminId: $adminId\n        customerId: $customerId\n        endTime: $endTime\n        isFixed: $isFixed\n        isPlanned: $isPlanned\n        locationId: $locationId\n        managerId: $managerId\n        postCodeAreaId: $postCodeAreaId\n        serviceId: $serviceId\n        slaId: $slaId\n        startTime: $startTime\n        supplierId: $supplierId\n      }\n    ) {\n      aggregate {\n        sum {\n          count: count\n        }\n      }\n    }\n    jobsByMonth: getDashboard_Count_By_Month(\n      args: {\n        adminId: $adminId\n        customerId: $customerId\n        endTime: $endTime\n        isFixed: $isFixed\n        isPlanned: $isPlanned\n        locationId: $locationId\n        managerId: $managerId\n        postCodeAreaId: $postCodeAreaId\n        serviceId: $serviceId\n        slaId: $slaId\n        startTime: $startTime\n        supplierId: $supplierId\n      }\n      order_by: { strval_extra: asc }\n    ) {\n      count: count\n      month: strval_extra\n    }\n  }\n"]);return u=function(){return e},e}var d=(0,s.Ps)(u()),c=t(78840),l=t.n(c),m=t(75708),p=t.n(m),f=t(90346),v=t(78200),h=(0,r.forwardRef)(function(e,n){var r,o,s,u,c=e.filters,m=e.removeChart,h=(0,a.a)(d,{variables:{adminId:c.adminId,customerId:c.customerId,endTime:c.endDate,isFixed:c.isFixed,isPlanned:c.isPlanned,locationId:c.locationId,managerId:c.managerId,postCodeAreaId:c.postCodeAreaId,serviceId:c.serviceId,slaId:c.slaId,startTime:c.startDate,supplierId:c.supplierId}}).data,g=void 0===h?{meta:{},jobsByMonth:[]}:h,x=g.meta,y=g.jobsByMonth,I=function(e){e.reflow()};return t(18393)(l()),(0,i.jsx)(f.J,{name:"JobsByMonth",removeChart:m,title:"Total bookings by Month (".concat(null===(r=x.aggregate)||void 0===r?void 0:r.sum.count,")"),children:(0,i.jsx)(p(),{callback:I,constructorType:"chart",Highcharts:l(),options:{chart:{type:"column"},title:{text:null},xAxis:{type:"category",title:null},yAxis:{min:0,title:{text:"Counts"}},tooltip:{headerFormat:'<span style="font-size:11px">{series.name}</span><br>',pointFormat:"{point.name}</span>: <b>{point.y}</b> "},series:[{name:"Month",data:(s=y,u=[],s.forEach(function(e){try{u.push({name:(0,v.Z)(new Date(e.month),"LLL yyyy"),y:e.count})}catch(n){}}),u),showInLegend:!1}]},ref:n})})})},78208:function(e,n,t){"use strict";t.d(n,{e:function(){return v}});var i=t(85893),r=t(67294),a=t(6812),o=t(7297),s=t(75063);function u(){var e=(0,o.Z)(["\n  query GetJobsByStatus(\n    $adminId: Int\n    $customerId: Int\n    $endTime: timestamptz\n    $isFixed: Int\n    $isPlanned: Int\n    $locationId: Int\n    $managerId: Int\n    $postCodeAreaId: Int\n    $serviceId: Int\n    $slaId: Int\n    $startTime: timestamptz\n    $supplierId: Int\n  ) {\n    jobsByStatus: getDashboard_Count_By_Status(\n      args: {\n        adminId: $adminId\n        customerId: $customerId\n        endTime: $endTime\n        isFixed: $isFixed\n        isPlanned: $isPlanned\n        locationId: $locationId\n        managerId: $managerId\n        postCodeAreaId: $postCodeAreaId\n        serviceId: $serviceId\n        slaId: $slaId\n        startTime: $startTime\n        supplierId: $supplierId\n      }\n      order_by: {}\n    ) {\n      statusname: name\n      count: count\n    }\n    meta: getDashboard_Count_By_Status_aggregate(\n      args: {\n        adminId: $adminId\n        customerId: $customerId\n        endTime: $endTime\n        isFixed: $isFixed\n        isPlanned: $isPlanned\n        locationId: $locationId\n        managerId: $managerId\n        postCodeAreaId: $postCodeAreaId\n        serviceId: $serviceId\n        slaId: $slaId\n        startTime: $startTime\n        supplierId: $supplierId\n      }\n      order_by: { count: desc }\n    ) {\n      aggregate {\n        sum {\n          count: count\n        }\n      }\n    }\n  }\n"]);return u=function(){return e},e}var d=(0,s.Ps)(u()),c=t(78840),l=t.n(c),m=t(75708),p=t.n(m),f=t(90346),v=(0,r.forwardRef)(function(e,n){var r,o,s=e.filters,u=e.removeChart,c=(0,a.a)(d,{variables:{adminId:s.adminId,customerId:s.customerId,endTime:s.endDate,isFixed:s.isFixed,isPlanned:s.isPlanned,locationId:s.locationId,managerId:s.managerId,postCodeAreaId:s.postCodeAreaId,serviceId:s.serviceId,slaId:s.slaId,startTime:s.startDate,supplierId:s.supplierId}}).data,m=void 0===c?{meta:{},jobsByStatus:[]}:c,v=m.meta,h=m.jobsByStatus,g=function(e){e.reflow()};return t(18393)(l()),h&&(0,i.jsx)(f.J,{name:"JobsByStatusPieChart",removeChart:u,title:"Total bookings by Status (".concat(null===(r=v.aggregate)||void 0===r?void 0:r.sum.count,")"),children:(0,i.jsx)(p(),{callback:g,constructorType:"chart",Highcharts:l(),options:{chart:{type:"pie"},title:{text:null},tooltip:{formatter:function(){return"<b>"+this.x+"</b><br/>"+this.series.name+": "+this.y}},series:[{data:h.map(function(e){return{name:e.statusname,y:e.count}}),showInLegend:!1}],xAxis:{type:"category",title:null},yAxis:{title:null}},ref:n})})})},90346:function(e,n,t){"use strict";t.d(n,{J:function(){return c}});var i=t(7297),r=t(85893),a=t(40826),o=t(55377),s=t(11585),u=t(10367);function d(){var e=(0,i.Z)(["\n  height: 100%;\n  overflow-x: ",";\n"]);return d=function(){return e},e}var c=function(e){var n=e.title,t=e.children,i=e.isTable,u=e.name,d=e.removeChart,c=function(e){e.stopPropagation(),d(e,u)},m=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a.Z,{context:"danger",icon:"trash",prefix:"fa",size:"sm",title:"Delete",onClick:c}),(0,r.jsx)(o.Z,{context:"darkGrey",vertical:!0}),(0,r.jsx)(a.Z,{className:"dragHandle",icon:"arrows-alt",prefix:"fa",size:"md",title:"Move",onClick:function(e){return e.stopPropagation()}})]});return(0,r.jsx)(s.Z,{context:"secondary",fitParentHeight:!0,open:!0,title:n,toolbar:m,loading:!0,children:(0,r.jsx)(l,{overflow:i,children:t})})},l=u.ZP.div.withConfig({displayName:"wrapper__StyledChildren",componentId:"sc-3157a897-0"})(d(),function(e){return e.overflow?"hidden":"unset"})},13602:function(e,n,t){"use strict";t.d(n,{NG:function(){return m},NK:function(){return l},OW:function(){return p},sM:function(){return c}});var i=t(7297),r=t(75063);function a(){var e=(0,i.Z)(["\n  query GetPostcodeAreas(\n    $countryId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: PostcodeArea_order_by!\n  ) {\n    postcodeAreas: PostcodeArea(\n      limit: $limit\n      offset: $offset\n      where: { countryId: { _eq: $countryId }, name: { _ilike: $q } }\n      order_by: [$orderBy]\n    ) {\n      id\n      area\n      name\n      status\n      country: Country {\n        id\n        name\n        code\n      }\n    }\n    meta: PostcodeArea_aggregate(where: { countryId: { _eq: $countryId }, name: { _ilike: $q } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return a=function(){return e},e}function o(){var e=(0,i.Z)(["\n  query GetPostcodeArea($id: Int!) {\n    postcodeArea: PostcodeArea_by_pk(id: $id) {\n      id\n      area\n      name\n      status\n      country: Country {\n        id\n        name\n        code\n      }\n    }\n  }\n"]);return o=function(){return e},e}function s(){var e=(0,i.Z)(["\n  mutation AddPostcodeArea($areas: [PostcodeArea_insert_input!]!) {\n    insert_PostcodeArea(objects: $areas) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,i.Z)(["\n  mutation InsertPostCodeArea($objects: [PostcodeArea_Entity_insert_input!]!) {\n    insert_PostcodeArea_Entity(\n      objects: $objects\n      on_conflict: {\n        constraint: PostcodeArea_Entity_postcodeAreaId_entityId_entity_key\n        update_columns: status\n      }\n    ) {\n      returning {\n        id\n        status\n      }\n    }\n  }\n"]);return u=function(){return e},e}function d(){var e=(0,i.Z)(["\n  mutation UpdateEntityAssign($id: Int!, $changes: PostcodeArea_Entity_set_input) {\n    update_PostcodeArea_Entity_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      status\n    }\n  }\n"]);return d=function(){return e},e}var c=(0,r.Ps)(a()),l=(0,r.Ps)(o());(0,r.Ps)(s());var m=(0,r.Ps)(u()),p=(0,r.Ps)(d())},67101:function(e,n,t){"use strict";t.d(n,{r:function(){return o}});var i=t(85893),r=t(45697),a=t(95103),o=function(e){var n=e.errors,t=e.name,r=e.onChange,o=e.options,s=e.register;return(0,i.jsx)(a.Z,{errors:n,name:t,onChange:r,options:o,register:s})};o.propTypes={errors:r.object.isRequired,name:r.string,onChange:r.func,options:r.array.isRequired,register:r.func.isRequired},o.defaultProps={name:"status"}},39710:function(e,n,t){"use strict";t.d(n,{D7:function(){return I},KQ:function(){return y},R7:function(){return x},j$:function(){return j},kx:function(){return _},l1:function(){return g},lk:function(){return b},ys:function(){return h}});var i=t(7297),r=t(75063);function a(){var e=(0,i.Z)(['\n  query GetSuppliers(\n    $limit: Int\n    $offset: Int\n    $orderBy: Account_order_by!\n    $where: Account_bool_exp\n  ) {\n    suppliers: Account(limit: $limit, offset: $offset, where: $where, order_by: [$orderBy]) {\n      id\n      createdAt\n      name\n      status\n      companyNumber\n      vatId\n      website\n      jobs: SupplierJobs_aggregate {\n        aggregate {\n          count\n          max {\n            scheduledAt\n          }\n          sum {\n            amount\n          }\n        }\n      }\n      jobList: SupplierJobs(order_by: { createdAt: desc }) {\n        id\n      }\n      services: Services(where: { entity: { _eq: "Account" } }) {\n        id\n        service: Service {\n          id\n          name\n        }\n      }\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      locations: Account_Locations {\n        id\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n    }\n    meta: Account_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return a=function(){return e},e}function o(){var e=(0,i.Z)(['\n  query GetSupplier($id: Int!) {\n    supplier: Account_by_pk(id: $id) {\n      id\n      companyNumber\n      createdAt\n      name\n      status\n      type\n      updatedAt\n      website\n      clientType\n      managerId\n      vatId\n      meta\n      statusLogs: StatusLog(where: { entity: { _eq: "Account" } }) {\n        id\n        status\n        createdAt\n      }\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      manager: Manager {\n        id\n        fullName\n      }\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n\n      details: SupplierDetail {\n        cisRegistered\n        quotingEmail\n        typeOfOrganisation\n        utrNumber\n        accountId\n      }\n\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n        }\n      }\n      usersMeta: Account_Users_aggregate {\n        aggregate {\n          count\n        }\n      }\n\n      coverage: PostcodeAreas(where: { entity: { _eq: "Account" }, status: { _eq: "active" } }) {\n        id\n        status\n        createdAt\n        area: PostcodeArea {\n          id\n          name\n          area\n        }\n      }\n      services: Services {\n        serviceId\n        createdAt\n      }\n      references: References {\n        id\n        createdAt\n      }\n    }\n  }\n']);return o=function(){return e},e}function s(){var e=(0,i.Z)(["\n  query GetSupplierManage($id: Int!) {\n    supplier: Account_by_pk(id: $id) {\n      id\n      name\n      website\n      companyNumber\n      vatId\n      status\n      meta\n      managerSelected: Manager {\n        id\n        label: fullName\n        value: id\n      }\n      supplierDetails: SupplierDetail {\n        id\n        cisRegistered\n        quotingEmail\n        typeOfOrganisation\n        utrNumber\n      }\n    }\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,i.Z)(["\n  mutation AddSupplier($objects: [Account_insert_input!]!) {\n    insert_Account(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return e},e}function d(){var e=(0,i.Z)(["\n  mutation AddSupplierDetail($objects: [SupplierDetail_insert_input!]!) {\n    insert_SupplierDetail(objects: $objects) {\n      returning {\n        id\n        accountId\n      }\n    }\n  }\n"]);return d=function(){return e},e}function c(){var e=(0,i.Z)(["\n  mutation AddSupplierOffer($objects: [SupplierOffer_insert_input!]!) {\n    insert_SupplierOffer(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return c=function(){return e},e}function l(){var e=(0,i.Z)(["\n  mutation UpdateSupplier(\n    $supplierId: Int!\n    $supplier: Account_set_input\n    $supplierDetails: SupplierDetail_set_input\n  ) {\n    update_SupplierDetail(where: { accountId: { _eq: $supplierId } }, _set: $supplierDetails) {\n      returning {\n        id\n      }\n    }\n\n    update_Account_by_pk(pk_columns: { id: $supplierId }, _set: $supplier) {\n      id\n    }\n  }\n"]);return l=function(){return e},e}function m(){var e=(0,i.Z)(['\n  query GetPostCodeAreas(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $supplierId: Int\n    $status: String = "active"\n  ) {\n    coverage: PostcodeArea_Entity(\n      where: {\n        entity: { _eq: "Account" }\n        entityId: { _eq: $supplierId }\n        status: { _eq: $status }\n        PostcodeArea: { name: { _ilike: $q } }\n      }\n      order_by: { PostcodeArea: { name: asc } }\n      limit: $limit\n      offset: $offset\n    ) {\n      id\n      status\n      createdAt\n      area: PostcodeArea {\n        id\n        name\n        area\n      }\n    }\n    meta: PostcodeArea_Entity_aggregate(\n      where: {\n        entity: { _eq: "Account" }\n        entityId: { _eq: $supplierId }\n        status: { _eq: $status }\n        PostcodeArea: { name: { _ilike: $q } }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return m=function(){return e},e}function p(){var e=(0,i.Z)(["\n  query GetPostCodeAreaForSelect($countryId: Int, $q: String) {\n    items: PostcodeArea(\n      where: { name: { _ilike: $q }, countryId: { _eq: $countryId } }\n      order_by: { name: asc }\n    ) {\n      area\n      label: name\n      value: id\n    }\n  }\n"]);return p=function(){return e},e}function f(){var e=(0,i.Z)(['\n  query GetServicesForSelect($q: String, $limit: Int, $offset: Int) {\n    items: Service(\n      where: { name: { _ilike: $q }, status: { _eq: "active" } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']);return f=function(){return e},e}function v(){var e=(0,i.Z)(['\n  query GetFinancialJob(\n    $adminId: Int\n    $customerId: Int\n    $endDate: timestamptz\n    $startDate: timestamptz\n    $limit: Int\n    $status: [String]\n    $managerId: Int\n    $locationId: Int\n    $offset: Int\n    $supplierId: Int\n    $q: String\n    $orderBy: Job_order_by!\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      type\n      number\n      status\n      description\n      reference\n      timingStart\n      scheduledAt\n      createdAt\n\n      customerTotal: customerFinances(path: "amountInfo.total")\n      supplierTotal: supplierFinances(path: "amountInfo.total")\n      customerVatTotal: customerFinances(path: "amountInfo.vatTotal")\n      supplierVatTotal: supplierFinances(path: "amountInfo.vatTotal")\n      customerExpensesTotal: customerFinances(path: "expensesInfo.expensesTotal")\n      supplierExpensesTotal: supplierFinances(path: "expensesInfo.expensesTotal")\n      customerRebateAmount: customerFinances(path: "rebate.amount")\n\n      slaId\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        invoiceNumber\n      }\n      customer: Customer {\n        id\n        name\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      sla: SLA {\n        name\n      }\n      manager: Manager {\n        fullName\n        nameLast\n        nameFirst\n        id\n      }\n      service: Service {\n        id\n        name\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return v=function(){return e},e}var h=(0,r.Ps)(a()),g=(0,r.Ps)(o()),x=(0,r.Ps)(s()),y=(0,r.Ps)(u());(0,r.Ps)(d()),(0,r.Ps)(c());var I=(0,r.Ps)(l()),b=(0,r.Ps)(m()),j=(0,r.Ps)(p()),_=(0,r.Ps)(f());(0,r.Ps)(v())},67860:function(e,n,t){"use strict";t.d(n,{T:function(){return u}});var i=t(85893),r=t(45697),a=t(11585),o=t(86036),s=t(19664),u=function(e){var n,t,r,u=e.open,d=e.supplier,c="";return s.E.forEach(function(e){var n;e.value===(null===(n=d.details)||void 0===n?void 0:n.typeOfOrganisation)&&(c=e.text)}),(0,i.jsxs)(a.Z,{open:u,title:"Company",children:[(0,i.jsx)(o.Z,{content:"Organization Type",text:c}),(0,i.jsx)(o.Z,{content:"Company Number",text:d.companyNumber}),(0,i.jsx)(o.Z,{content:"VAT Number",text:d.vatId}),(0,i.jsx)(o.Z,{content:"UTR Number",text:null===(n=d.details)||void 0===n?void 0:n.utrNumber}),(0,i.jsx)(o.Z,{content:"CIS registration number",text:null===(t=d.details)||void 0===t?void 0:t.cisRegistered}),(0,i.jsx)(o.Z,{content:"Website",text:d.website}),(null===(r=d.meta)||void 0===r?void 0:r.xeroContactId)&&(0,i.jsx)(o.Z,{content:"Xero Contact ID",text:d.meta.xeroContactId})]})};u.propTypes={open:r.bool,supplier:r.object.isRequired},u.defaultProps={open:!0}},81639:function(e,n,t){"use strict";t.d(n,{D:function(){return s}});var i=t(85893),r=t(11585),a=t(86036),o=t(55377),s=function(e){var n=e.supplier;return(0,i.jsx)(r.Z,{open:!0,title:"Contact",children:n.contactUsers.map(function(e){var t;return(0,i.jsxs)("div",{children:[(0,i.jsx)(a.Z,{content:"Name",text:"".concat(e.user.fullName)}),(0,i.jsx)(a.Z,{content:"Phone",text:e.user.phone}),(0,i.jsx)(a.Z,{content:"Email",text:e.user.email}),(0,i.jsx)(a.Z,{content:"Quoting Email",text:(null===(t=n.details)||void 0===t?void 0:t.quotingEmail)||"-"}),(0,i.jsx)(o.Z,{})]},e.user.id)})})}},14990:function(e,n,t){"use strict";t.d(n,{Im:function(){return m},RQ:function(){return v},X4:function(){return g},fC:function(){return h},mW:function(){return p},ze:function(){return f}});var i=t(7297),r=t(75063);function a(){var e=(0,i.Z)(['\n  query GetTaxonomys(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Taxonomy_order_by!\n    $status: String = "active"\n    $type: String\n    $typeGroup: String\n    $parentId: Int\n    $fetchGroup: Boolean! = true\n    $id: Int\n    $isGroup: Boolean = false\n  ) {\n    taxonomy: Taxonomy(\n      limit: $limit\n      offset: $offset\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n      order_by: [$orderBy]\n    ) {\n      options: Taxonomies(\n        where: {\n          type: { _eq: $type }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n\n        childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n          taxonomyId: id\n          name\n          type\n          meta\n          status\n        }\n      }\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n      parent: Parent {\n        id\n        name\n        type\n      }\n      childs: Taxonomies(order_by: { id: asc }, where: { status: { _eq: "active" } }) {\n        taxonomyId: id\n        name\n        type\n        meta\n        status\n      }\n      jobs: Taxonomy_Entities_aggregate(\n        where: { Taxonomy: { type: { _eq: "jobTags" } }, entity: { _eq: "Job" } }\n      ) {\n        aggregate {\n          count\n        }\n      }\n    }\n    meta: Taxonomy_aggregate(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n        parentId: { _eq: $parentId }\n        id: { _eq: $id }\n        isGroup: { _eq: $isGroup }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n    taxonomyGroup: Taxonomy(where: { isGroup: { _eq: true }, type: { _eq: $typeGroup } })\n      @include(if: $fetchGroup) {\n      value: id\n      text: name\n    }\n  }\n']);return a=function(){return e},e}function o(){var e=(0,i.Z)(["\n  query GetTaxonomy($id: Int!) {\n    taxonomy: Taxonomy_by_pk(id: $id) {\n      id\n      name\n      type\n      status\n      parentId\n      createdAt\n      meta\n    }\n  }\n"]);return o=function(){return e},e}function s(){var e=(0,i.Z)(["\n  mutation AddTaxonomy($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        type\n      }\n    }\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,i.Z)(["\n  mutation UpdateTaxonomy($id: Int!, $changes: Taxonomy_set_input) {\n    update_Taxonomy_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      type\n    }\n  }\n"]);return u=function(){return e},e}function d(){var e=(0,i.Z)(["\n  query GeTaxonomyWithEntities($type: String!, $entity: String!, $entityId: Int!) {\n    questions: Taxonomy(where: { type: { _eq: $type } }) {\n      id\n      meta\n      name\n      status\n      taxonomy_entity: Taxonomy_Entities(\n        where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }\n      ) {\n        comments\n      }\n    }\n  }\n"]);return d=function(){return e},e}function c(){var e=(0,i.Z)(["\n  mutation InsertTaxonomyEntity(\n    $entity: String!\n    $entityId: Int!\n    $questions: [Taxonomy_Entity_insert_input!]!\n    $objectStatusLog: [StatusLog_insert_input!]!\n    $hasStatusLog: Boolean!\n  ) {\n    delete_Taxonomy_Entity(where: { entityId: { _eq: $entityId }, entity: { _eq: $entity } }) {\n      returning {\n        id\n      }\n    }\n    insert_Taxonomy_Entity(objects: $questions) {\n      returning {\n        id\n      }\n    }\n\n    insert_StatusLog(objects: $objectStatusLog) @include(if: $hasStatusLog) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return c=function(){return e},e}function l(){var e=(0,i.Z)(["\n  query GetSlasForTemplate($where: SLA_bool_exp, $limit: Int, $offset: Int) {\n    slas: SLA(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      id\n      label: name\n      subtype\n      notes\n      onSite\n      onSiteUnit\n      quoteReturned\n      quoteReturnedUnit\n    }\n  }\n"]);return l=function(){return e},e}var m=(0,r.Ps)(a());(0,r.Ps)(o());var p=(0,r.Ps)(s()),f=(0,r.Ps)(u()),v=(0,r.Ps)(d()),h=(0,r.Ps)(c()),g=(0,r.Ps)(l())},62247:function(e,n,t){"use strict";t.d(n,{y:function(){return m}});var i=t(85893),r=t(45697),a=t(55377),o=t(9270),s=t(62140),u=t(86036),d=t(16551),c=t(77439),l=t(97637),m=function(e){var n=e.answers,t=e.onEdit,r=e.entity,m=e.entityId,p=function(){t&&t(n)};return(0,i.jsxs)(i.Fragment,{children:[n&&n.length>0&&(0,i.jsx)(a.Z,{content:"Questions"}),n&&n.map(function(e){var n,t,d,c=e.meta;return(null==c?void 0:c.input)==="media"?(0,i.jsx)(o.Z,{children:(0,i.jsxs)(s.Z,{md:6,children:[(0,i.jsx)(l.G,{entity:r,entityId:m,showItemActions:!1,showActionButtons:!1,summary:null==c?void 0:c.label,category:"supplierQuestion",mediaMeta:{taxonomyId:e.id}}),(0,i.jsx)(a.Z,{})]})}):(0,i.jsx)(u.Z,{content:(null===(n=e.taxonomy)||void 0===n?void 0:n.name)||e.name,text:e.comments||(null===(t=e.taxonomy_entity)||void 0===t?void 0:null===(d=t[0])||void 0===d?void 0:d.comments)},e.id||e.taxonomyId)}),n&&n.length>0&&t&&(0,i.jsx)(d.Z,{align:"flex-end",children:(0,i.jsx)(c.Z,{content:"Edit Answers",size:"sm",context:"secondary",onClick:p})}),n&&n.length>0&&(0,i.jsx)(a.Z,{})]})};m.propTypes={answers:r.array}},76990:function(e,n,t){"use strict";t.d(n,{D:function(){return P}});var i=t(26042),r=t(69396),a=t(85893),o=t(67294),s=t(45697),u=t(42283),d=t(79665),c=t(76600),l=t(9270),m=t(62140),p=t(16551),f=t(77439),v=t(58594),h=t(28497),g=t(55563),x=t(90951),y=t(95103),I=t(6710),b=t(78289),j=t(23233),_=t(49501),$=t(40826),Z=t(40552),A=t(97637),q={checkbox:v.Z,currencyInput:h.Z,datepicker:Z.M,input:g.Z,radio:x.Z,select:y.Z,textArea:I.Z,selectRange:y.Z},C=function(e){var n=e.control,t=e.entity,s=e.entityId,u=e.errors,d=e.input,c=e.inputType,l=e.key,m=e.label,p=e.mediaMeta,v=e.name,h=e.options,g=e.register,x=(0,o.useContext)(b.Z),y="select"===d&&h.length>0,I=["checkbox","radio"].includes(d)&&h.length>0,Z=(0,r.Z)((0,i.Z)({control:n},I&&{data:h},y&&{options:h.map(function(e){return(0,r.Z)((0,i.Z)({},e),{text:e.label})})},"selectRange"===d&&{range:[10,0]}),{errors:u,key:l,label:j.Z.camelize(m),name:v,register:g,type:I?d:c,minDate:"2020-04-19T08:29:04.839Z"}),C=function(){x.show({content:t&&s&&(0,a.jsx)(A.G,{entity:t,entityId:s,mediaMeta:p,category:"supplierQuestion"}),submit:!1,title:m})},S=q[d];return(0,a.jsx)(a.Fragment,{children:"currencyInput"===d?(0,a.jsx)(_.Z,{label:m,children:(0,a.jsx)(S,(0,r.Z)((0,i.Z)({},Z),{label:""}))}):(0,a.jsx)(a.Fragment,{children:"media"===d?(0,a.jsx)(_.Z,{label:m,children:(0,a.jsx)(f.Z,{context:"info",content:(0,a.jsx)($.Z,{icon:"file-upload"}),onClick:C,size:"sm"})}):(0,a.jsx)(_.Z,{label:m,children:(0,a.jsx)(S,(0,i.Z)({},Z))})})})};C.propTypes={control:s.object.isRequired,entity:s.string,entityId:s.number,errors:s.object.isRequired,input:s.string,inputType:s.string,key:s.string,label:s.string.isRequired,mediaMeta:s.object,name:s.string.isRequired,options:s.array,register:s.func.isRequired},C.defaultProps={input:"input",options:[],inputType:"text",label:"label"};var S=t(16310),T=function(e,n){var t=n.object,r=n.string,a={};return null==e||e.forEach(function(e){var n;(null===(n=e.meta)||void 0===n?void 0:n.required)&&(a[e.name]=r().required())}),t().shape((0,i.Z)({},a))},w=function(e){var n=e.map(function(e){return(0,r.Z)((0,i.Z)({},e),{name:"".concat(e.name,"/id=").concat(e.taxonomyId)})}),t=(0,S.Ry)().shape({}),a=T(n,{object:S.Ry,string:S.Z_});return t.concat(a)},P=function(e){var n,t=e.entity,s=e.entityId,v=e.onSuccess,h=e.questions,g=e.hasChangeStatus,x=(0,u.cI)({defaultValues:(n={},h.forEach(function(e){var t=e.comments,i=e.taxonomyId,r=e.name;n["".concat(r,"/id=").concat(i)]=t}),n),resolver:(0,d.S)(w(h))}),y=x.control,I=x.errors,b=x.handleSubmit,j={control:y,errors:I,register:x.register},_=function(e,n){var i=Object.keys(e).map(function(n){return{taxonomyId:parseInt(n.split("/id=")[1]),name:n.split("/id=")[0],comments:String(e[n]),entity:t,entityId:s}});v&&v(i,n)};return(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(c.Z,{id:g?"offCanvasFormQuestions":"offCanvasForm",handleSubmit:b(function(e){return _(e,"supplierQuestionsSubmitted")}),children:(0,a.jsxs)(l.Z,{children:[h.map(function(e){var n,u,d,c;return(0,a.jsx)(m.Z,{md:12,children:(0,o.createElement)(C,(0,r.Z)((0,i.Z)({},j),{input:null===(n=e.meta)||void 0===n?void 0:n.input,inputType:null===(u=e.meta)||void 0===u?void 0:u.inputType,key:e.taxonomyId,label:null===(d=e.meta)||void 0===d?void 0:d.label,name:"".concat(e.name,"/id=").concat(e.taxonomyId),options:null===(c=e.meta)||void 0===c?void 0:c.options,entity:t,entityId:s,mediaMeta:{taxonomyId:e.taxonomyId}}))})}),g&&(0,a.jsx)(m.Z,{md:12,children:(0,a.jsxs)(p.Z,{align:"flex-end",children:[(0,a.jsx)(f.Z,{content:"Save",context:"success",onClick:b(function(e){return _(e,"supplierQuestionsDraft")}),size:"sm"}),(0,a.jsx)(f.Z,{content:"Submit",context:"secondary",type:"submit",size:"sm"})]})})]})})})};P.propTypes={entity:s.string.isRequired,entityId:s.number,onSuccess:s.func,hasChangeStatus:s.bool,questions:s.array.isRequired},P.defaultProps={hasChangeStatus:!1}},19664:function(e,n,t){"use strict";t.d(n,{E:function(){return i}});var i=[{text:"Select Type Of Organisation",value:""},{text:"Sole trader",value:"soleTrader"},{text:"Limited company",value:"limitedCompany"},{text:"Partnership",value:"partnership"},{text:"LLP",value:"llp"},{text:"PLC",value:"plc"}]},78656:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return nk}});var i=t(85893),r=t(11163),a=t.n(r),o=t(24716),s=t(9270),u=t(62140),d=t(67294),c=t(6812),l=t(39710),m=t(52019),p=t(41085),f=t(47568),v=t(26042),h=t(828),g=t(97582),x=t(45697),y=t.n(x),I=t(50319),b=t(14990),j=t(78289),_=t(11587),$=t(11585),Z=t(62247),A=t(76990),q=[{text:"Draft",value:"supplierQuestionsDraft",context:"info"},{text:"Submitted",value:"supplierQuestionsSubmitted",context:"help"},{text:"Approved",value:"supplierQuestionsApproved",context:"success"}],C=function(e){var n,t=e.accountId,r=e.statusLogs,a=e.refetch,o=(0,d.useContext)(j.Z),s=(0,c.a)(b.RQ,{variables:{entity:"Account",entityId:t,type:"supplierQuestion"}}),u=s.loading,l=s.refetch,m=s.data,p=(void 0===m?{questions:{}}:m).questions,x=(0,h.Z)((0,I.D)(b.fC),1)[0],y=(n=(0,f.Z)(function(e,n){return(0,g.__generator)(this,function(i){switch(i.label){case 0:return[4,x({variables:{entity:"Account",entityId:t,questions:C(e),objectStatusLog:[{status:n,entity:"Account",entityId:t}],hasStatusLog:!!n}})];case 1:return i.sent(),a(),l(),o.close(),[2]}})}),function(e,t){return n.apply(this,arguments)}),C=function(e){return e.map(function(e){return{comments:e.comments,taxonomyId:e.taxonomyId,entity:e.entity,entityId:e.entityId}})},S=function(){var e;o.show({content:(0,i.jsx)(A.D,{onSuccess:y,entity:"Account",entityId:t,questions:p.map(function(e){var n;return(0,v.Z)({comments:null===(n=e.taxonomy_entity[0])||void 0===n?void 0:n.comments,taxonomyId:e.id,name:e.name},e)}),hasChangeStatus:!0}),title:"Complete Questions",width:"50%",submit:!1})},T=function(){var e=r.slice().filter(function(e){return q.find(function(n){return n.value===e.status})}).sort(function(e,n){return Number(n.id)-Number(e.id)}),n=q.find(function(n){var t;return n.value===(null===(t=e[0])||void 0===t?void 0:t.status)})||{text:"-",context:"info"};return(0,i.jsx)(_.Z,{content:n.text,size:"md",context:n.context})};return!u&&(0,i.jsx)($.Z,{open:!0,title:"Operational Processes And Procedures",toolbar:(0,i.jsx)(T,{}),children:(0,i.jsx)(Z.y,{answers:p,onEdit:S,entity:"Account",entityId:t})})};C.propTypes={accountId:x.number.isRequired};var S=t(69396),T=t(29815),w=t(73359),P=t(65650),R=t(57460),k=t.n(R),D=t(51466),F=t(26186),N=t(68956),E=t(11082),L=t(55843),M=t(77439),O=t(40826),G=t(87336),z=t(16605),H=t(48996),Q=function(e){var n=e.addresses;return(null==n?void 0:n.address)?{__html:"".concat(n.address.addressLine1,"<br />").concat(n.address.postCode)}:"Please add"},B=t(48795),J=t(53767),U=t(35374),V=t(12632),W=t(31312),X=t(86036),Y=function(e){var n,t=e.job,r=(null==t?void 0:t.shortJobDesc)&&t.shortJobDesc.length?t.shortJobDesc[0].taxonomy.name:null;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(X.Z,{content:"Short Job Description",text:r||(null==t?void 0:t.title)}),(0,i.jsx)(X.Z,{content:"Work description",text:null!==(n=null==t?void 0:t.description)&&void 0!==n?n:"-"})]})};Y.propTypes={job:x.object.isRequired};var K=function(e){var n,t,r,a=e.initialFilters,o=e.filters,s=(0,V.x)({filters:o}),u=s.initialData,l=s.ref,m=a.supplierId,p=void 0===m?null:m,f=(0,d.useContext)(j.Z),g=(0,d.useState)(!1),x=g[0],y=g[1],I=(0,J.q)(),b=null===(n=I.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,_=null===(t=I.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,Z=(0,c.a)(P.JE,{variables:(0,S.Z)((0,v.Z)({q:null},a,u),{accountId:p})}),A=Z.data,q=void 0===A?{quotations:[],meta:{aggregate:{totalCount:0}}}:A,C=q.meta,R=q.quotations,X=Z.loading,K=Z.refetch,ee=(0,h.Z)((0,w.t)(P.JE,{variables:{accountId:p,limit:(null==C?void 0:null===(r=C.aggregate)||void 0===r?void 0:r.totalCount)||150},onCompleted:function(e){var n=e.quotations;if(x){var t=k().unparse(eu(n)),i="data:application/octet-stream,"+encodeURIComponent(t);(0,z.S)(i,"quotations.csv"),y(!1)}},skip:!0}),2),en=ee[0],et=ee[1].loading,ei=function(){K(),f.close()},er=function(e){f.show({content:(0,i.jsx)(H.m,{quotationId:e.id,onSuccess:ei}),title:"Quotation",width:"50%"})},ea=function(e,n){e.stopPropagation(),n.id||(n={}),f.show({content:(0,i.jsx)(Y,{job:n.job}),submit:!1,title:"Quotaition Description"})},eo=[{hidden:!0},{hidden:!0},{formatter:function(e){var n,t=e.row;return(null===(n=t.job)||void 0===n?void 0:n.type)?(0,i.jsx)(B.D,{id:t.jobId,number:t.number,numberPrefix:b,numberSuffix:_,openCanvas:!0,shortJobDesc:t.shortJobDesc,type:t.job.type}):(0,i.jsxs)(D.Z,{size:"xs",children:["Q ",t.jobId]})},text:"Job"},{text:"Creator"},{hidden:!0},{text:"Customer"},{text:"Address"},{text:"Labour Total"},{text:"Materials Total"},{text:"Quote Total"},{formatter:function(e){var n;return n=e.row,(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(D.Z,{size:"xs",children:[n.totalDuration," ",n.totalDurationUnit]}),(0,i.jsx)(D.Z,{size:"xs",children:n.startDate?(0,F.Z)(n.startDate):"-"})]})},text:"Total Duration"},{hidden:!0},{hidden:!0},{text:"Status"},{hidden:!0},{formatter:N.Z,formatterData:[{context:"info",icon:["fas","receipt"],onClick:function(e,n){return ea(e,n)},tooltip:"Info"}],text:"Actions"}],es=function(e){e.stopPropagation(),en(),y(!0)},eu=function(e){return e.map(function(e){var n,t,i,r,a,o,s,u,d,c,l,m,p=((0,T.Z)(W.E6).find(function(n){return n.value===e.status})||{text:""}).text,f=((0,T.Z)(W.l8).concat((0,T.Z)(W.iz)).find(function(n){var t;return n.value===(null==e?void 0:null===(t=e.job)||void 0===t?void 0:t.status)})||{text:""}).text;return{id:e.id,number:null===(n=e.job)||void 0===n?void 0:n.number,jobId:e.jobId,creator:(null===(i=null==e?void 0:null===(t=e.job)||void 0===t?void 0:t.timings[0])||void 0===i?void 0:null===(r=i.user)||void 0===r?void 0:r.fullName)||"-",shortJobDesc:null===(o=null===(a=e.job)||void 0===a?void 0:a.shortJobDesc[0])||void 0===o?void 0:null===(s=o.taxonomy)||void 0===s?void 0:s.name,customer:(null===(u=e.job)||void 0===u?void 0:null===(d=u.customer)||void 0===d?void 0:d.name)||"-",address:(null===(c=e.job)||void 0===c?void 0:null===(l=c.location)||void 0===l?void 0:l.addresses[0])?Q({addresses:e.job.location.addresses[0]}):"-",labourTotal:(0,E.Z)(e.labourTotal.aggregate.sum.supplierTotal),materialsTotal:(0,E.Z)(e.materialsTotal.aggregate.sum.supplierTotal),quoteTotal:(0,E.Z)(e.total.aggregate.sum.supplierTotal),totalDuration:e.totalDuration,totalDurationUnit:e.totalDurationUnit,startDate:e.startDate,status:(null==e?void 0:null===(m=e.job)||void 0===m?void 0:m.type)==="reactive"?f:p,job:e.job,actions:""}})};return(0,i.jsx)($.Z,{open:!0,title:"Quotes",toolbar:!(0,U.s)()&&(0,i.jsx)(L.Z,{marginRight:"xs",children:(0,i.jsx)(M.Z,{content:"Export to excel",context:"secondary",size:"sm",disabled:void 0===et||et,onClick:es,children:(0,i.jsx)(O.Z,{context:"white",icon:"file-csv",size:"lg"})})}),children:(0,i.jsx)(G.t,{columns:eo,loading:X,meta:C,ref:l,refetch:K,rowClick:er,rows:eu(R)})})};K.propTypes={supplierId:x.number.isRequired};var ee=t(19611),en=t(26535),et=t(32725),ei=t(74280),er=t(97637),ea=t(81777),eo=t(7297),es=t(75063);function eu(){var e=(0,eo.Z)(["\n  mutation InsertReference($objects: [Reference_insert_input!]!) {\n    insert_Reference(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return eu=function(){return e},e}function ed(){var e=(0,eo.Z)(["\n  mutation UpdateReference($id: Int!, $changes: Reference_set_input) {\n    update_Reference_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return ed=function(){return e},e}function ec(){var e=(0,eo.Z)(["\n  query GetReferences($accountId: Int) {\n    references: Reference(where: { accountId: { _eq: $accountId } }) {\n      id\n      name\n      email\n      phone\n      media: Media {\n        id\n      }\n    }\n  }\n"]);return ec=function(){return e},e}function el(){var e=(0,eo.Z)(["\n  mutation DeleteReference($id: Int!) {\n    delete_Reference_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return el=function(){return e},e}var em=(0,es.Ps)(eu()),ep=(0,es.Ps)(ed()),ef=(0,es.Ps)(ec()),ev=(0,es.Ps)(el()),eh=t(16551),eg=t(16540),ex=t(42283),ey=t(79665),eI=t(76600),eb=t(49501),ej=t(55563),e_=t(16310),e$=(0,e_.Ry)().shape({email:(0,e_.Z_)().required().email(),name:(0,e_.Z_)().required(),phone:(0,e_.Z_)().required()}),eZ=function(e){var n=e.defaultValues,t=e.accountId,r=e.success,a=(0,ex.cI)({defaultValues:n&&n,resolver:(0,ey.S)(e$)}),o=a.errors,s=a.handleSubmit,u=a.register,d=(0,h.Z)((0,I.D)(em,{onCompleted:function(){r&&r()}}),1)[0],c=(0,h.Z)((0,I.D)(ep,{onCompleted:function(){r&&r()}}),1)[0],l=function(e){e.id?c({variables:{id:e.id,changes:e}}):(e.accountId=t,d({variables:{objects:e}}))};return(0,i.jsxs)(eI.Z,{id:"offCanvasForm",handleSubmit:s(l),children:[(0,i.jsx)(eb.Z,{label:"Name",children:(0,i.jsx)(ej.Z,{errors:o,name:"name",register:u})}),(0,i.jsx)(eb.Z,{label:"Phone",children:(0,i.jsx)(ej.Z,{errors:o,name:"phone",register:u})}),(0,i.jsx)(eb.Z,{label:"Email",children:(0,i.jsx)(ej.Z,{errors:o,name:"email",register:u})}),(null==n?void 0:n.id)&&(0,i.jsx)(ej.Z,{errors:o,name:"id",register:u,type:"hidden"})]})};eZ.propTypes={defaultValues:x.object,accountId:x.number.isRequired,success:x.func};var eA=function(e){var n,t=e.accountId,r=e.edit,a=(0,d.useContext)(j.Z),o=(0,c.a)(ef,{variables:{accountId:t}}),s=o.data,u=(void 0===s?{references:[]}:s).references,l=o.loading,m=o.refetch,p=(0,h.Z)((0,I.D)(ev,{onCompleted:function(e){m()}}),1)[0],f=function(e){p({variables:{id:e.id}})},v=function(e){a.show({title:"Media",content:(0,i.jsx)(er.G,{entity:"Reference",entityId:null==e?void 0:e.id})})},g=function(e,n){e.stopPropagation(),a.show({title:"Reference",content:(0,i.jsx)(eZ,{defaultValues:n,accountId:t,success:function(){a.close(),m()}})})},x=[{hidden:!0},{text:"Name"},{text:"Phone"},{text:"Email"},{hideen:!0},{hidden:!r,formatter:N.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:(n={editClick:function(e,n){return g(e,n)},mediaClick:function(e,n){return v(n)},deleteClick:function(e,n){return f(n)}}).editClick,tooltip:"Edit"},{context:"info",icon:["fas","file-upload"],onClick:n.mediaClick,tooltip:"Media",numberOverlay:"mediaCount"},{context:"danger",icon:["fas","trash"],onClick:n.deleteClick,tooltip:"Delete"}],text:"Actions"}],y=function(){return(0,i.jsx)(eh.Z,{children:(0,i.jsx)(M.Z,{context:"secondary",content:"Add Quote",onClick:g,size:"sm"})})};return(0,i.jsx)($.Z,{toolbar:r&&(0,i.jsx)(y,{}),title:"References",children:(0,i.jsx)(eg.Z,{columns:x,loading:l,rows:u.map(function(e){return{id:e.id,name:e.name,phone:e.phone,email:e.email,mediaCount:e.media.length,actions:""}})})})};eA.propTypes={accountId:x.number,edit:x.bool},eA.defaultProps={edit:!0};var eq=t(74297),eC=t(13602),eS=t(76312),eT=t(33006),ew=t(95103),eP=t(10367),eR=t(15897),ek=(0,e_.Ry)().shape({coverageArea:(0,e_.Ry)(),coverAll:(0,e_.Xg)(),status:(0,e_.Z_)().oneOf(["active","inactive"])}),eD=t(57493),eF=t(62047),eN=function(e){var n=e.toggleFormatter,t=e.assignAll,r=e.hasRole;return[{text:"postcodeAreaId",hidden:!0},{text:"id",hidden:!0},{text:"lock",hidden:!0},{text:"Area"},{text:"Name"},{formatter:n,text:(0,i.jsx)(eF.Z,{context:"secondary",size:"sm",onToggle:t,disabled:r(["supplier"])})},{hidden:!0}]},eE=function(e){var n=e.coveredAreas,t=e.allAreas,i=[];return t.forEach(function(e){var t=e.area,r=e.label,a=e.value,o=n.findIndex(function(e){return e.area.id===a}),s=o>-1&&"active"===n[o].status,u=o>-1&&n[o].id||-1;i.push({postcodeAreaId:a,id:u,Area:t,Name:r,actions:"",assigned:s})}),i},eL=function(e){var n=e.areas,t=e.toggled;return n.map(function(e){return(0,S.Z)((0,v.Z)({},e),{assigned:t})})},eM=function(e,n){var t=(0,h.Z)((0,w.t)(eD.j$,{variables:n}),2),i=t[0],r=t[1],a=r.loading,o=r.data,s=(void 0===o?{items:[]}:o).items;(0,d.useEffect)(function(){i()},[]);var u=eE({allAreas:s,coveredAreas:e});return{loading:a,rows:u}},eO=function(e){var n=e.onToggle,t=e.areas,r=e.ref,a=e.hasRole,o=function(e){var t=e.row;return(0,i.jsx)(eF.Z,{context:"secondary",size:"sm",onToggle:function(e){return n({postcodeAreaId:t.postcodeAreaId,id:t.id,toggled:e})},toggled:t.assigned,disabled:a(["supplier"])})},s=(0,d.useState)(t),u=s[0],c=s[1],l=function(e){c(eL({areas:u,toggled:e})),t.map(function(t){return n({id:t.id,postcodeAreaId:t.postcodeAreaId,toggled:e})})};return(0,i.jsx)(eg.Z,{columns:eN({toggleFormatter:o,assignAll:l,hasRole:a}),rows:u,ref:r})};function eG(){var e=(0,eo.Z)(["\n  height: 100%;\n  width: 30%;\n  padding: 0;\n  margin: 0;\n  position: fixed;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  text-align: center;\n"]);return eG=function(){return e},e}eO.propTypes={areas:x.array,hasRole:x.func,onToggle:x.func};var ez=function(e){var n,t=e.accountId,r=e.item,a=e.offCanvas,o=e.refetch,s=e.type,u=e.coveredAreas,c=e.filters,l=e.hasRole,m=(0,d.useState)(""),p=m[0],x=m[1],y=(0,d.useState)([]),b=y[0],j=y[1],_=(0,ex.cI)({defaultValues:{status:r?r.status:"active"},resolver:(0,ey.S)(ek)}),$=_.control,Z=_.errors,A=_.handleSubmit,q=_.register,C=(0,V.x)({filters:c}),w=C.initialData,P=C.ref,R=eM(u,w),k=R.rows,F=R.loading,N=function(e){a.close(),o()},E=function(e){return x(e)},M=(0,h.Z)((0,I.D)(eC.OW,{onCompleted:N,onError:E}),1)[0],O=(0,h.Z)((0,I.D)(eC.NG,{onCompleted:N,onError:E}),1)[0],G=function(e){var n=e.id,i=e.postcodeAreaId,r={entity:"Account",postcodeAreaId:i,entityId:t,status:e.toggled?"active":"inactive"};-1!==n&&(r.id=n),j(function(e){var a=e.findIndex(function(e){return e.postcodeAreaId===i&&e.entityId===t&&"Account"===e.entity&&e.id===n});return -1!==a?e[a]=r:e.push(r),(0,T.Z)(e)})},z=(n=(0,f.Z)(function(e){return(0,g.__generator)(this,function(n){return"edit"===s?M({variables:{id:r.id,changes:e}}):"add"===s&&O({variables:{objects:b}}),[2]})}),function(e){return n.apply(this,arguments)});return F?(0,i.jsx)(eH,{children:(0,i.jsx)(eS.Z,{})}):(0,i.jsxs)(eI.Z,{id:"offCanvasForm",handleSubmit:A(z),children:[(0,i.jsx)(D.Z,{context:"danger",children:p}),(0,i.jsx)(L.Z,{}),"add"!==s||F?"edit"===s&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eT.Z,{content:"".concat(r.postcode," - ").concat(r.area),tag:"h4"}),(0,i.jsx)(eb.Z,{label:"Status",children:(0,i.jsx)(ew.Z,(0,S.Z)((0,v.Z)({},{control:$,errors:Z,register:q}),{name:"status",options:eR.bg}))})]}):(0,i.jsx)(eO,{onToggle:G,hasRole:l,areas:k,ref:P})]})},eH=eP.ZP.div.withConfig({displayName:"form__StyledLoadingContainer",componentId:"sc-cc698373-0"})(eG());ez.defaultProps={coveredAreas:[]},ez.propTypes={accountId:x.number,item:(0,x.exact)({actions:x.string,area:x.string,postcode:x.string,id:x.number}),offCanvas:x.object.isRequired,refetch:x.func,type:x.string.isRequired,coverageAreas:x.array};var eQ=t(75903),eB=t(31113),eJ=(0,d.memo)(function(e){var n=e.initialValues,t=(e.renderFilters,e.setFilters),r=e.lastQuery,a=(0,ex.cI)({defaultValues:n}),o=a.errors,d=a.handleSubmit,c=a.register,l=a.reset,m=function(e){var i=e.query;if(i!==r){var a={q:"%".concat(i,"%")||0},o=/^\d+$/.test(i);"id"in n&&(a.id=o?Number(i):null),"meta"in n&&(a.meta=o?{invoiceNumber:Number(i)}:null),(a.id||a.meta)&&(a.q=null),t(function(e){return(0,v.Z)({},e,a)})}},p=function(e){t(n),l(n),m("")};return(0,i.jsxs)(eI.Z,{handleSubmit:d(m),children:[(0,i.jsx)(s.Z,{children:(0,i.jsx)(u.Z,{sm:12,lg:12,children:(0,i.jsx)(eb.Z,{label:"",children:(0,i.jsx)(eQ.Z,{errors:o,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:c,type:"search"})})})}),(0,i.jsx)(eB.H,{content:"Search",context:"secondary",handleClick:m,type:"submit",children:(0,i.jsx)(M.Z,{content:"Reset filters",context:"danger",onClick:p,size:"sm"})})]})},function(e,n){return!0});eJ.propTypes={initialValues:x.object,renderFilters:x.func.isRequired,setFilters:x.func.isRequired};var eU={q:null},eV=function(e){var n=e.q,t=e.accountId,r=e.item,a=e.offCanvas,o=e.refetch,s=e.type,u=e.coveredAreas,c=e.hasRole;eU.q=n?"%".concat(n,"%"):null;var l=(0,d.useState)(eU),m=l[0],p=l[1];return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eJ,{initialValues:eU,setFilters:p}),(0,i.jsx)(ez,{refetch:o,item:r,offCanvas:a,accountId:t,coveredAreas:u,type:s,filters:m,hasRole:c})]})},eW=function(e){var n=[];return e&&e.forEach(function(e){n.push({id:e.id,area:e.area.name,postcode:e.area.area,status:e.status,actions:""})}),n},eX=function(e){var n,t,r=e.filters,a=e.accountId,o=e.handleClick,s=e.hasRole,u=(0,V.x)({filters:r}),d=u.initialData,m=u.ref,p=(0,c.a)(l.lk,{variables:(0,v.Z)({supplierId:a},d)}),f=p.loading,h=p.data,g=void 0===h?{coverage:[],meta:{aggregate:{totalCount:0}}}:h,x=g.coverage,y=g.meta,I=p.refetch;return(0,i.jsx)(G.t,{columns:[{hidden:!0},{text:"Area"},{text:"Postcode"},{hidden:!0},{hidden:s("supplier"),formatter:N.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(e,n){return o(e,"edit",n)},tooltip:"Edit"}],text:"Actions"}],loading:f,meta:y,ref:m,history:!1,refetch:I,rows:eW(x)})},eY=function(e){var n=e.refetch,t=e.hasRole,r=e.supplier,a={q:null},o=(0,d.useContext)(j.Z),s=function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",s=arguments.length>2?arguments[2]:void 0;e.stopPropagation(),o.show({title:"".concat((0,eq.Z)(a)," Postcode Area"),content:(0,i.jsx)(eV,{accountId:r.id,item:s,refetch:n,offCanvas:o,type:a,coveredAreas:r.coverage,hasRole:t})})},u=(0,d.useState)(a),c=u[0],l=u[1],m=function(){return(0,i.jsx)(eh.Z,{children:(0,i.jsx)(M.Z,{context:"secondary",content:"Add",onClick:function(e){return s(e,"add")},size:"sm"})})};return(0,i.jsxs)($.Z,{toolbar:!t("supplier")&&(0,i.jsx)(m,{}),open:!0,title:"Coverage Area",children:[(0,i.jsx)(eJ,{initialValues:a,setFilters:l}),(0,i.jsx)(eX,{accountId:r.id,handleClick:s,filters:c,hasRole:t})]})};eY.propTypes={supplier:x.object.isRequired,hasRole:x.func.isRequired,refetch:x.func.isRequired};var eK=t(67860),e0=t(81639),e1=t(41890),e6=t(30381),e7=t.n(e6),e3=t(32791),e2=function(e,n){if(Array.isArray(n)){var t=null;return n.forEach(function(n){var i=null==e?void 0:e.find(function(e){return e.status===n});t=(null==i?void 0:i.createdAt)||t}),t}var i=null==e?void 0:e.find(function(e){return e.status===n});return(null==i?void 0:i.createdAt)||null},e5=t(6710);function e9(){var e=(0,eo.Z)(["\n  mutation InsertStatusLog($objects: [StatusLog_insert_input!]!) {\n    insert_StatusLog(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return e9=function(){return e},e}var e8=(0,es.Ps)(e9()),e4=function(e){var n,t=e.status,r=e.entityId,a=e.entityName,o=e.refetch,s=e.toggleShow,u=(0,ex.cI)({defaultValues:{notes:""}}),d=u.errors,c=u.handleSubmit,l=u.register,m=(0,h.Z)((0,I.D)(e8,{onCompleted:function(){o&&o(),s()}}),1)[0],p=(n=(0,f.Z)(function(e){var n;return(0,g.__generator)(this,function(i){switch(i.label){case 0:return n={entityId:r,entity:a,status:t,notes:e.notes},[4,m({variables:{objects:[n]}})];case 1:return i.sent(),[2]}})}),function(e){return n.apply(this,arguments)});return(0,i.jsx)(eI.Z,{id:"offCanvasForm",handleSubmit:c(p),children:(0,i.jsx)(eb.Z,{label:"Notes",children:(0,i.jsx)(e5.Z,{errors:d,name:"notes",register:l,rows:4})})})};e4.propTypes={status:x.string.isRequired,entityId:x.number.isRequired,entityName:x.string.isRequired,refetch:x.func.isRequired,toggleShow:x.func.isRequired};var ne=function(e){var n=e.status,t=e.statusTitle,r=e.entityId,a=e.entityName,o=e.offCanvas,s=e.refetch;o.show({content:(0,i.jsx)(e4,{entityId:r,entityName:a,refetch:s,status:n,toggleShow:o.close}),title:t})},nn=t(74944),nt=function(e){var n,t,r,o,s,u,d,c,l=e.supplier,m=e.offCanvas,p=e.refetch,f=(0,nn.x)().hasRole,v="/dashboard/suppliers/",h=e2(null==l?void 0:l.statusLogs,"supplierQuestionsSubmitted"),g=e2(null==l?void 0:l.statusLogs,"supplierQuestionsApproved"),x=(0,en.WE)(l,"registered"),y=(0,en.WE)(l,"operating"),I=l.createdAt&&(null===(n=l.references[0])||void 0===n?void 0:n.createdAt)&&(null==x?void 0:x.createdAt)&&(null===(t=l.compliance)||void 0===t?void 0:t.createdAt)&&(null===(r=l.coverage[0])||void 0===r?void 0:r.createdAt)&&(null===(o=l.services[0])||void 0===o?void 0:o.createdAt)&&g,b=function(e){e&&p()},j=function(){m.show({title:"Add/Update Postcode Area",content:(0,i.jsx)(ez,{accountId:l.id,refetch:p,offCanvas:m,type:"add",coveredAreas:l.coverage,hasRole:f})})},_=function(){m.show({title:"Reference",content:(0,i.jsx)(eZ,{accountId:l.id,success:function(){p(),m.close()}})})};return[{id:1,label:"Create account",date:l.createdAt},{id:2,label:"Complete profile",info:"",date:(null==x?void 0:x.createdAt)||null,actions:[{id:1,active:!f("supplier"),content:"Registered address",context:"secondary",handleClick:function(){m.show({content:(0,i.jsx)(e3.H,{addressId:null==x?void 0:x.address.id,entity:"Account",entityId:l.id,id:(null==x?void 0:x.id)||null,onSubmit:b,type:"registered"}),submit:!1,title:"Manage addresses"})},type:"button"},{id:2,active:!f("supplier"),content:"Operating address",context:"secondary",handleClick:function(){m.show({content:(0,i.jsx)(e3.H,{addressId:null==y?void 0:y.address.id,entity:"Account",entityId:l.id,id:(null==y?void 0:y.id)||null,onSubmit:b,type:"operating"}),submit:!1,title:"Manage addresses"})},type:"button"}]},{id:3,label:"Select service lines & coverage",info:"",date:(null===(s=l.coverage[0])||void 0===s?void 0:s.createdAt)&&(null===(u=l.services[0])||void 0===u?void 0:u.createdAt),actions:[{id:1,active:!f("supplier"),content:"Service lines",context:"secondary",handleClick:function(){a().push("".concat(v,"view?id=").concat(l.id,"&tab=services"))},type:"button"},{id:2,active:!f("supplier"),content:"Coverage",context:"secondary",handleClick:j,type:"button"}]},{id:4,label:"Submit documents",info:"",date:(null===(d=l.references[0])||void 0===d?void 0:d.createdAt)&&(null===(c=l.compliance)||void 0===c?void 0:c.createdAt),actions:[{id:1,active:!f("supplier"),content:"Compliances",context:"secondary",handleClick:function(){a().push("".concat(v,"view?id=").concat(l.id,"&tab=compliance"))},type:"button"},{id:2,active:f("admin"),content:"References",context:"secondary",handleClick:_,type:"button"}]},{id:5,label:"Submit questionnaire",info:f("supplier")?h&&!g&&"awaiting admin approval":h&&!g&&"Questions were submitted",date:g,content:[{id:1,active:!f("supplier"),data:function(){return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(eh.Z,{align:"flex-start",size:"xs",children:[f("admin")&&h&&!g&&(0,i.jsx)(M.Z,{content:"Approve",context:"primary",onClick:function(){return ne({status:"supplierQuestionsApproved",statusTitle:"Approve Questions",entityId:l.id,entityName:"Account",offCanvas:m,refetch:p})},size:"xs"}),(0,i.jsx)(M.Z,{content:"Question",context:"secondary",onClick:function(){return a().push("".concat(v,"view?id=").concat(l.id,"&tab=questions"))},size:"xs"})]})})}}]},{id:6,label:"Start receiving work",info:"accept job offers",date:I}]},ni=function(e,n,t){var i=nt({supplier:e,offCanvas:n,refetch:t});return i.map(function(e){return e.date&&(e.date=e7()(e.date).format("D MMM YYYY HH:mm")),e}),i},nr=t(74492),na=function(e){var n,t=e.supplier,r=e.refetch,a=(0,nr.a)();return(0,i.jsx)($.Z,{open:!0,title:"Profile",children:(0,i.jsx)(e1.Z,{items:ni(t,a,r),summary:(n=t,[{label:"Account manager: ",value:n.manager?"".concat(n.manager.nameFirst," ").concat(n.manager.nameLast," "):"Unassigned"},{label:"Users: ",value:n.usersMeta?n.usersMeta.aggregate.count:0},{label:"Status: ",value:n.status||""}])},"stepper-".concat(t.id))})},no=t(22378),ns=function(e){var n=e.hasRole,t=e.isSupplier,r=e.refetch,a=e.supplier,o=(0,en.WE)(a,"registered"),d=(0,en.WE)(a,"operating");return(0,i.jsxs)(s.Z,{children:[(0,i.jsxs)(u.Z,{md:4,children:[(0,i.jsx)(ea.g,{avatar:(0,ei.Q)(a.media),editable:n("admin"),entity:a,entityName:"Account",icons:n("admin")?(0,no.Y)(a):[]}),(0,i.jsx)(e0.D,{supplier:a}),(0,i.jsx)(eK.T,{supplier:a}),o&&(0,i.jsx)(ee.f,{address:o.address,entity:"Account",entityId:a.id,id:o.id,refetch:r,title:"Registered Address",type:"registered"}),d&&(0,i.jsx)(ee.f,{address:d.address,entity:"Account",entityId:a.id,id:d.id,refetch:r,title:"Operating Address",type:"operating"}),n("admin")&&(0,i.jsx)(et.E,{entity:"Account",entityId:a.id,open:!0,title:"Notes"})]}),(0,i.jsx)(u.Z,{md:4,children:(0,i.jsx)(na,{refetch:r,supplier:a})}),(0,i.jsxs)(u.Z,{md:4,children:[(0,i.jsx)(er.G,{details:!0,entity:"Account",entityId:a.id}),(0,i.jsx)(eY,{hasRole:n,refetch:r,supplier:a},"coverage-".concat(a.id)),(0,i.jsx)(eA,{accountId:a.id,edit:!t,open:!0},"references-".concat(a.id))]})]})};ns.propTypes={isSupplier:x.bool,supplier:x.object.isRequired,refetch:x.func.isRequired};var nu=t(78208),nd=t(65428),nc=t(67101),nl=function(e){var n=e.control,t=e.errors,r=e.initialValues,a=e.register,o=e.setFilters,c=(e.setValue,e.watch),l=(0,d.useContext)(m.Z).hasRole,p=c("customerId"),f=c("supplierId"),h=!r.customerId,g=W.E6.map(function(e){return l("admin")?e:{text:e.customerText,value:e.value}}),x=[{text:"Status",value:""}].concat((0,T.Z)(g)).filter(function(e,n,t){return!!l("admin")||t.findIndex(function(n){return n.text===e.text})===n});(0,d.useEffect)(function(){h&&o(function(e){return(0,S.Z)((0,v.Z)({},e),{customerId:(null==p?void 0:p.value)||null})})},[p]),(0,d.useEffect)(function(){h&&o(function(e){return(0,S.Z)((0,v.Z)({},e),{supplierId:(null==f?void 0:f.value)||null})})},[f]);var y=function(e){var n;return n="quoteNew"===e?["quoteNew","quoteOffered","quoteReceived"]:e};return(0,i.jsx)(i.Fragment,{children:(0,i.jsx)(s.Z,{align:"baseline",children:(0,i.jsx)(u.Z,{md:6,children:(0,i.jsx)(nc.r,(0,S.Z)((0,v.Z)({},{control:n,errors:t,register:a}),{errors:t,onChange:function(e){return l("admin")?o(function(n){return(0,S.Z)((0,v.Z)({},n),{status:e.target.value||null})}):o(function(n){return(0,S.Z)((0,v.Z)({},n),{status:y(e.target.value)||null})})},options:x,register:a}))})})})};nl.propTypes={errors:x.object.isRequired,register:x.func.isRequired,setFilters:x.func.isRequired};var nm=t(66267),np=t(246),nf=t(39453),nv=t(70323),nh=t(11057),ng=t(39474),nx=t(87918),ny=t(90629),nI=t(51233),nb=t(15861),nj=t(45451),n_=t(25040),n$=t(67797),nZ=t(21830),nA=t(74301),nq=t(79217),nC=t(15843),nS=function(e){var n=e.editable,t=e.initialFilters,r=e.entity,a=e.entityId,o=e.tableHeight,s=e.paperHeight,u=(0,h.Z)((0,n$.d)(),2),l=u[0],m=u[1],p=(0,d.useState)({}),f=p[0],g=p[1],x=(0,d.useState)(!1),y=x[0],I=x[1],b=(0,V.x)({filters:f}),j=b.ref,_=b.initialData,$=(0,c.a)(n_.pB,{variables:(0,S.Z)((0,v.Z)({},_),{entity:r,entityId:a})}),Z=$.data,A=void 0===Z?{schedules:[],meta:{aggregate:{totalCount:0}}}:Z,q=A.schedules,C=A.meta,T=$.loading,w=$.refetch,P=function(e){e.stopPropagation(),m({content:function(e){var n=e.onClose;return(0,i.jsx)(nA.t,{entity:r,entityId:a,close:n})}})},R=(0,d.useCallback)(function(e){n&&m({content:function(n){var t=n.onClose;return(0,i.jsx)(nA.t,{isEdit:!0,scheduleId:e,entity:r,entityId:a,close:t})}})},[r,a,n,m]),k=(0,d.useCallback)(function(e){return[{icon:"edit",onClick:function(n){n.stopPropagation(),R(e.id)},tooltip:"Edit Schedule"}]},[R]),D=(0,d.useMemo)(function(){return[{sortable:!1,flex:1,minWidth:180,field:"serviceLine",headerName:"Service line"},{sortable:!1,flex:1,minWidth:180,field:"schedule",headerName:"Schedule"},{sortable:!1,flex:1,minWidth:180,field:"rate",headerName:"\xa3/H",renderCell:function(e){var n=e.row;return(0,i.jsxs)(nI.Z,{children:[(0,i.jsxs)(nb.Z,{children:["First hour: \xa3 ",n.rate.firstHour]}),(0,i.jsxs)(nb.Z,{children:["Subsequent hours: \xa3 ",n.rate.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:180,field:"rateOOH",headerName:"\xa3/H OOH",renderCell:function(e){var n=e.row;return(0,i.jsxs)(nI.Z,{children:[(0,i.jsxs)(nb.Z,{children:["First hour: \xa3 ",n.rateOOH.firstHour]}),(0,i.jsxs)(nb.Z,{children:["Subsequent hours: \xa3 ",n.rateOOH.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:180,field:"ratePremium",headerName:"\xa3/H Premium",renderCell:function(e){var n=e.row;return(0,i.jsxs)(nI.Z,{children:[(0,i.jsxs)(nb.Z,{children:["First hour: \xa3 ",n.ratePremium.firstHour]}),(0,i.jsxs)(nb.Z,{children:["Subsequent hours: \xa3 ",n.ratePremium.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:150,field:"coverageArea",headerName:"Coverage area"},{sortable:!1,flex:1,field:"minimumDuration",headerName:"Min duration"},{sortable:!1,flex:1,field:"minimumIncrement",headerName:"Min increment"},{sortable:!1,flex:1,minWidth:100,field:"status",headerName:"Status",renderCell:function(e){var n=e.row;return(0,i.jsx)(nx.Z,{label:"active"===n.status?"Active":"Inactive",color:"active"===n.status?"success":"danger",size:"small"})}},{sortable:!1,width:100,field:"actions",headerName:"Actions",renderCell:function(e){var n=e.row;return(0,i.jsx)(nZ.C,{row:n,actionsData:k})}}]},[k]),F=(0,d.useMemo)(function(){return q.map(function(e){return{id:e.id,serviceLine:e.service.name,schedule:e.name,rate:e.normal,rateOOH:e.ooh,ratePremium:e.premium,coverageArea:e.postcodeAreas.map(function(e){return e.postcode.area}).join(", "),minimumDuration:e.minimumDuration,minimumIncrement:e.minimumIncrement,status:e.status,serviceId:e.serviceId}})},[q]);return(0,i.jsxs)(i.Fragment,{children:[l,(0,i.jsx)(nq.X,{open:y,close:function(){return I(!1)},initialFilters:t,setFilters:g}),(0,i.jsx)(nI.Z,{width:"100%",spacing:2,sx:{height:"100%"},children:(0,i.jsxs)(ny.Z,{sx:{paddingTop:"16px",paddingBottom:"16px",height:s},children:[(0,i.jsxs)(nI.Z,{direction:"row",justifyContent:"space-between",pl:2,pr:2,children:[(0,i.jsx)(nb.Z,{variant:"h5",sx:{fontWeight:600},children:"Services"}),(0,i.jsxs)(ng.Z,{children:[n&&(0,i.jsx)(nh.Z,{color:"secondary",variant:"contained",onClick:P,children:"Add schedule"}),(0,i.jsx)(nh.Z,{startIcon:(0,i.jsx)(nC.Z,{}),variant:"contained",onClick:function(){return I(!0)},children:"Filters"})]})]}),(0,i.jsx)(nj.i,{autoHeight:!1,loading:T,ref:j,columns:D,rows:F,meta:C,refetch:w,containerHeight:o,columnVisibilityModel:{actions:n},onRowClick:function(e){return R(e.row.id)}})]})})]})};nS.propTypes={editable:y().bool,initialFilters:y().object,entity:y().oneOf(["Supplier"]).isRequired,entityId:y().number.isRequired,tableHeight:y().string,paperHeight:y().string},nS.defaultProps={editable:!1,initialFilters:{filterType:"supplier"},tableHeight:"calc(100% - 52px)",paperHeight:"calc(100% - 32px)"};var nT=t(85427),nw=function(e){var n,t,a=e.id,o=e.isSupplier,f=e.adminId,v=(0,J.q)(),h=(0,d.useContext)(m.Z).hasRole,g=h("admin"),x=(0,r.useRouter)().query,y=!!(null==v?void 0:null===(n=v.admin)||void 0===n?void 0:null===(t=n.modules)||void 0===t?void 0:t.sageIntegration),I=(0,c.a)(l.l1,{variables:{id:a}}),b=I.loading,j=I.refetch,_=I.data,$=(void 0===_?{supplier:{}}:_).supplier,Z={adminId:f,supplierId:a},A=(0,d.useMemo)(function(){return x.tab||"details"},[x.tab]);return!b&&(0,i.jsxs)(p.Z,{children:[(0,i.jsx)("div",{active:"details"===A||!A,label:"Details",children:(0,i.jsx)(ns,{hasRole:h,isSupplier:o,refetch:j,supplier:$})}),(0,i.jsx)("div",{active:"finance"===A,label:"Finance",children:(0,i.jsx)(nf.b,{type:"supplier",accountId:$.id,accountName:$.name,accountRefetch:j,meta:$.meta,hasSageIntegration:y})}),(0,i.jsx)("div",{active:"users"===A,label:"Users",children:(0,i.jsx)(nv.q,{accountType:"supplier",filters:{accountId:$.id}})}),(0,i.jsx)("div",{active:"services"===A,label:"Services",children:(0,i.jsx)(nS,{editable:g,initialFilters:{filterType:"supplier"},entity:"Supplier",entityId:$.id,paperHeight:"calc(100vh - 90px)"})}),(0,i.jsx)("div",{active:"work-orders"===A,label:"Work Orders",children:(0,i.jsx)(np.A,{filtersVisibilityModel:{supplier:!1,manager:!1,customerManager:!1,accountManager:!1},entityRelationToFetch:{supplierId:$.id},initialFilters:{jobNumber:null,invoiceNumber:null,userId:null,startDate:null,endDate:null,filterType:"supplier_work_orders_tab"}})}),(0,i.jsx)("div",{active:"quotations"===A,label:"Quotations",children:(0,i.jsx)(nm.J,{FiltersComp:nl,initialFilters:{supplierId:$.id,customerId:null,status:null,id:null,filterType:"supplier_quotations_tab"},TableComp:K})}),(0,i.jsx)("div",{active:"questions"===A,label:"Questions",children:(0,i.jsx)(C,{accountId:$.id,statusLogs:$.statusLogs,refetch:j})}),(0,i.jsx)("div",{active:"planned-maintenance"===A,label:"Planned Maintenance",children:(0,i.jsx)(nT.w,{defaultFilters:["ppm"],filterDisabled:{cppm:!0},supplierId:$.id})}),(0,i.jsx)("div",{active:"data"===A,label:"Data",children:(0,i.jsxs)(s.Z,{children:[(0,i.jsx)(u.Z,{md:6,children:(0,i.jsx)(nd.m,{filters:Z})}),(0,i.jsx)(u.Z,{md:6,children:(0,i.jsx)(nu.e,{filters:Z})})]})})]},A)},nP=function(){var e=(0,r.useRouter)().query,n=(0,nn.x)(),t=n.hasRole,a=n.user,o=!t("admin")&&t("supplier");return(0,i.jsx)(s.Z,{children:(0,i.jsx)(u.Z,{md:12,children:(0,i.jsx)(nw,{id:o?a.accountId:e.id,isSupplier:o,adminId:a.adminId})})})},nR=function(){return(0,nn.x)().user?(0,i.jsx)(o.Z,{children:(0,i.jsx)(nP,{})}):(a().push("/account/sign-in"),null)};nR.getLayout=function(e){return e};var nk=nR}},function(e){e.O(0,[3662,367,1069,6898,2283,212,8890,9511,2583,6310,4599,4135,8579,4244,7645,3776,1564,2329,778,3054,1023,3911,1417,9957,6540,1870,5037,8062,1352,4043,2429,1207,5117,9313,2600,4211,8495,2461,6043,8920,4716,8359,6557,6937,5427,3762,4664,3057,1650,825,9223,3351,9774,2888,179],function(){return e(e.s=92523)}),_N_E=e.O()}]);