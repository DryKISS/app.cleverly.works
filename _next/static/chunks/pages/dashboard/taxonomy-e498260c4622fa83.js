(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4031],{52418:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/taxonomy",function(){return n(3761)}])},52553:function(e,t,n){"use strict";n.d(t,{F:function(){return p}});var r=n(26042),i=n(69396),o=n(99534),a=n(85893),s=n(87918),l=n(98456),u=n(23776),c=n(50135),d=n(67294),p=function(e){var t=e.color,n=e.variant,p=e.label,m=e.placeholder,g=e.error,f=e.helperText,h=(e.size,e.loading),v=e.onSearchChange,x=e.textFieldProps,y=void 0===x?{}:x,b=(e.disableClearable,(0,o.Z)(e,["color","variant","label","placeholder","error","helperText","size","loading","onSearchChange","textFieldProps","disableClearable"])),Z=(0,d.useState)(""),j=Z[0],C=Z[1];return(0,d.useEffect)(function(){if(v){var e=setTimeout(function(){v(j)},500);return function(){return clearTimeout(e)}}},[j,v]),(0,a.jsx)(u.Z,(0,r.Z)({getOptionLabel:function(e){return"string"==typeof e?e:(null==e?void 0:e.label)||""},isOptionEqualToValue:function(e,t){return e.value===t.value},loading:h,onInputChange:function(e,t){C(t)},renderTags:function(e,t){return e.map(function(e,n){return(0,a.jsx)(s.Z,(0,r.Z)({size:"small",label:e.label},t({index:n})))})},renderInput:function(e){return(0,a.jsx)(c.Z,(0,i.Z)((0,r.Z)({label:p,placeholder:m,color:t,variant:n,error:g,helperText:f},e,y),{InputProps:(0,i.Z)((0,r.Z)({},e.InputProps,y.InputProps||{}),{endAdornment:(0,a.jsxs)(a.Fragment,{children:[h?(0,a.jsx)(l.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}},b))}},19441:function(e,t,n){"use strict";n.d(t,{P:function(){return m}});var r=n(26042),i=n(69396),o=n(99534),a=n(85893),s=n(90948),l=n(94054),u=n(47312),c=n(18972),d=n(18360),p=n(56815),m=function(e){var t=e.fullWidth,n=e.variant,s=e.label,l=e.options,u=e.value,m=e.onChange,h=e.helperText,v=(0,o.Z)(e,["fullWidth","variant","label","options","value","onChange","helperText"]);return(0,a.jsxs)(g,{variant:n,fullWidth:t,children:[(0,a.jsx)(f,{children:s}),(0,a.jsx)(d.Z,(0,i.Z)((0,r.Z)({fullWidth:t,displayEmpty:!0,value:u||"",onChange:m,renderValue:function(){var e,t=l.find(function(e){return e.value===u});return t?t.label:""}},v),{children:l.map(function(e){return(0,a.jsx)(c.Z,{value:e.value,children:e.label},e.value)})})),h&&(0,a.jsx)(p.Z,{children:h})]})},g=(0,s.ZP)(l.Z)(function(e){return e.theme,{"&.MuiFormControl-root":{display:"flex",flexDirection:"column",alignItems:"flex-start"}}}),f=(0,s.ZP)(u.Z)(function(e){return{"&.MuiFormLabel-root.MuiInputLabel-root.Mui-focused":{color:e.theme.palette.secondary.main}}})},71181:function(e,t,n){"use strict";n.d(t,{C:function(){return P}});var r=n(85893),i=n(67294),o=n(93946),a=n(25464),s=n(18972),l=n(57976),u=n(73890),c=n(69008),d=n(41687),p=n(60888),m=n(40535),g=n(63441),f=n(41733),h=n(77957),v=n(2548),x=n(24519),y=n(2391),b=n(69308),Z=n(79369),j=n(22961),C=n(28201),I=n(51233),S=n(15861),T={add:(0,r.jsx)(d.Z,{}),archive:(0,r.jsx)(u.Z,{}),avatar:(0,r.jsx)(C.Z,{}),check:(0,r.jsx)(p.Z,{}),delete:(0,r.jsx)(f.Z,{}),description:(0,r.jsx)(m.Z,{}),download:(0,r.jsx)(g.Z,{}),info:(0,r.jsx)(v.Z,{}),edit:(0,r.jsx)(h.Z,{}),location:(0,r.jsx)(b.Z,{}),unarchive:(0,r.jsx)(c.Z,{}),uploadFile:(0,r.jsx)(x.Z,{}),receipt:(0,r.jsx)(y.Z,{}),visibility:(0,r.jsx)(j.Z,{})},q={default:(0,r.jsx)(l.Z,{}),defaultHoriz:(0,r.jsx)(Z.Z,{}),description:(0,r.jsx)(m.Z,{})},P=function(e){var t=e.actions,n=e.icon,l=e.disabled,u=(0,i.useState)(null),c=u[0],d=u[1],p=function(e){e.stopPropagation(),d(e.currentTarget)},m=function(){d(null)};return(0,r.jsxs)("div",{children:[(0,r.jsx)(o.Z,{sx:{":hover":{backgroundColor:"#DDDDDD"}},disabled:l,"aria-controls":"simple-menu","aria-haspopup":"true",onClick:p,children:q[void 0===n?"default":n]}),(0,r.jsx)(a.Z,{id:"simple-menu",anchorEl:c,keepMounted:!0,open:Boolean(c),onClose:m,PaperProps:{sx:{borderRadius:2}},children:t.map(function(e,t){return(0,r.jsx)(s.Z,{disabled:e.disabled,onClick:function(t){e.onClick(t),m()},sx:{pl:3,pr:4},children:(0,r.jsxs)(I.Z,{direction:"row",alignItems:"center",spacing:2,children:[e.icon?T[e.icon]:null,(0,r.jsx)(S.Z,{children:e.tooltip})]})},t)})})]})}},29059:function(e,t,n){"use strict";n.d(t,{i:function(){return S}});var r=n(14924),i=n(26042),o=n(69396),a=n(99534),s=n(85893),l=n(67294),u=n(11163),c=n(61870),d=n(5616),p=n(51233),m=n(15861),g=n(90948),f=n(41796),h=n(29217),v=n(45111),x=n(98209),y=n(70872),b=n(58886),Z=n(61730),j=function(e){var t=e.currentPage,n=e.totalCount,r=e.pageSize,o=e.onPageChange,a=(0,Z.Z)("(max-width:400px)"),l=(0,Z.Z)("(max-width:500px)");return(0,s.jsx)(C,{page:t,count:Math.ceil(n/r),onChange:function(e,t){return o(t)},variant:"outlined",shape:"rounded",size:a?"small":"medium",hidePrevButton:1===t,hideNextButton:t===Math.ceil(n/r),siblingCount:l?0:1,renderItem:function(e){return(0,s.jsx)(b.Z,(0,i.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})},C=(0,g.ZP)(y.Z)(function(e){var t,n=e.hidePrevButton,o=e.hideNextButton,a=e.theme;return t={},(0,r.Z)(t,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,r.Z)(t,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,r.Z)(t,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,r.Z)(t,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,r.Z)(t,"& button.Mui-selected",(0,i.Z)({color:a.palette.white.main,backgroundColor:a.palette.secondary.main},o?{borderRadius:"0 5px 5px 0"}:{},n?{borderRadius:"5px 0 0 5px"}:{})),t}),I={item:"id",order:"desc"},S=function(e){var t=e.columns,n=(e.history,e.totalCount),r=e.paginationSize,o=e.containerHeight,c=e.noResultsMessage,d=void 0===c?"There are no results.":c,g=e.autoHeight,f=e.onTableStateChange,y=(0,a.Z)(e,["columns","history","totalCount","paginationSize","containerHeight","noResultsMessage","autoHeight","onTableStateChange"]),b=(0,u.useRouter)().query,Z=(0,l.useMemo)(function(){var e,t;return(null==b?void 0:null===(e=b.page)||void 0===e?void 0:null===(t=e.toString)||void 0===t?void 0:t.call(e))?parseInt(b.page.toString(),10):1},[b.page]),C=(0,l.useState)(Z||1),S=C[0],P=C[1],w=(0,l.useState)(r||x.C1.paginationSize)[0],_=(0,l.useState)({item:I.item,order:I.order}),k=_[0],M=_[1];(0,l.useEffect)(function(){f&&f({currentPage:S-1,pageSize:w,sorting:[k]})},[S,w,k,f]);var R=function(e){P(e)},A=function(e){e&&e.field&&e.sort?M({item:e.field,order:e.sort}):M({item:I.item,order:I.order})};return(0,s.jsxs)(T,{containerHeight:o,children:[(0,s.jsx)(q,(0,i.Z)({hideFooter:!0,disableColumnMenu:!0,disableRowSelectionOnClick:!0,autoHeight:g,sortingMode:"server",onSortModelChange:function(e){return A(e[0])},columns:t,initialState:{pagination:{paginationModel:{pageSize:w}}},slots:{columnSortedAscendingIcon:function(){return(0,s.jsx)(h.Z,{})},columnSortedDescendingIcon:function(){return(0,s.jsx)(v.Z,{})},columnUnsortedIcon:function(){return(0,s.jsxs)(p.Z,{alignItems:"center",sx:{width:"33px"},children:[(0,s.jsx)(h.Z,{sx:{marginBottom:"-15px"}}),(0,s.jsx)(v.Z,{})]})},noResultsOverlay:function(){return(0,s.jsx)(p.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,s.jsx)(m.Z,{children:d})})},noRowsOverlay:function(){return(0,s.jsx)(p.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,s.jsx)(m.Z,{children:d})})}}},y)),n&&Math.ceil(n/w)>1?(0,s.jsx)(j,{currentPage:S,totalCount:n,pageSize:w,onPageChange:R}):null]})},T=(0,g.ZP)(d.Z)(function(e){return{height:e.containerHeight,display:"flex",flexDirection:"column"}}),q=(0,g.ZP)(c.s)(function(e){var t,n=e.theme,a=e.hideHeader;return t={"--DataGrid-overlayHeight":"40px"},(0,r.Z)(t,"&.MuiDataGrid-root",{color:n.palette.black.main,border:"none"}),(0,r.Z)(t,"& .MuiDataGrid-columnHeaders",(0,o.Z)((0,i.Z)({},a&&{display:"none"}),{"& .MuiDataGrid-iconButtonContainer":{visibility:"visible","& .MuiButtonBase-root.MuiIconButton-root":{backgroundColor:"inherit",color:n.palette.black.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}}})),(0,r.Z)(t,"& .MuiDataGrid-virtualScroller",(0,i.Z)({},a&&{marginTop:"0 !important"})),(0,r.Z)(t,"& .MuiDataGrid-iconSeparator",{opacity:0}),(0,r.Z)(t,"& .MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(t,"& .MuiButtonBase-root.MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(t,"& .MuiDataGrid-overlayWrapper",(0,r.Z)({},"& .MuiCircularProgress-root",{color:n.palette.secondary.main})),(0,r.Z)(t,"& .MuiDataGrid-row.even",{backgroundColor:n.palette.muiLightGray.main,"&:hover, &.Mui-hovered":{backgroundColor:(0,f.Fq)(n.palette.muiLightGray.main,.3),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,f.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,f.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity+n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,f.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity)}}}}),t})},25267:function(e,t,n){"use strict";n.d(t,{MI:function(){return a},UF:function(){return o},gz:function(){return i}});var r=n(24341),i={active:"success",inactive:"danger"},o=[{label:"Active",value:r.b.ACTIVE},{label:"Inactive",value:r.b.INACTIVE}],a=[{label:r.D.WEEKLY,value:r.D.WEEKLY},{label:r.D.MONTHLY,value:r.D.MONTHLY},{label:r.D.QUARTERLY,value:r.D.QUARTERLY},{label:r.D.ANNUALLY,value:r.D.ANNUALLY},{label:r.D.EVERY_FIVE_YEARS,value:r.D.EVERY_FIVE_YEARS}]},24341:function(e,t,n){"use strict";var r,i,o,a;n.d(t,{D:function(){return r},b:function(){return i}}),(o=r||(r={})).WEEKLY="Weekly",o.MONTHLY="Monthly",o.QUARTERLY="Quarterly",o.ANNUALLY="Annually",o.EVERY_FIVE_YEARS="Every 5 years",(a=i||(i={})).ACTIVE="active",a.INACTIVE="inactive"},74492:function(e,t,n){"use strict";n.d(t,{a:function(){return o}});var r=n(55508),i=n(67294),o=function(){var e=(0,i.useContext)(r.d);if(!e)throw Error("useOffCanvasContext must be used within the OffCanvasProvider");return e}},19512:function(e,t,n){"use strict";n.d(t,{D:function(){return o}});var r=n(67294),i=n(21925),o=function(){var e=(0,r.useContext)(i.S);if(!e)throw Error("useSnackbarContext must be used within the SnackbarProvider");return e}},24572:function(e,t,n){"use strict";n.d(t,{V:function(){return o}});var r=n(14924),i=n(67294),o=function(){var e=(0,i.useState)({currentPage:0,pageSize:50,sorting:[]}),t=e[0],n=e[1],o=(0,i.useMemo)(function(){return t.sorting.map(function(e){return(0,r.Z)({},e.item,e.order)},[])},[t.sorting]);return{reference:{onTableStateChange:n},pagination:{offset:t.currentPage*t.pageSize,limit:t.pageSize},order:o}}},182:function(e,t,n){"use strict";n.d(t,{OZ:function(){return c},UH:function(){return m},UM:function(){return p},r6:function(){return g},zR:function(){return d}});var r=n(7297),i=n(75063);function o(){var e=(0,r.Z)(['\n  query GetComplianceCategoriesForSelect($q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: {\n        type: { _eq: "complianceCategory" }\n        status: { _eq: "active" }\n        name: { _ilike: $q }\n      }\n      order_by: { name: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      label: name\n      value: id\n    }\n  }\n']);return o=function(){return e},e}function a(){var e=(0,r.Z)(["\n  query GetSublocationsForSelect($locationId: Int, $q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Sublocation(\n      where: { name: { _ilike: $q }, locationId: { _eq: $locationId }, active: { _eq: true } }\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n"]);return a=function(){return e},e}function s(){var e=(0,r.Z)(['\n  query GetAssetsCategoryForSelect($q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: {\n        type: { _eq: "assetCategory" }\n        isGroup: { _eq: false }\n        status: { _eq: "active" }\n        name: { _ilike: $q }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']);return s=function(){return e},e}function l(){var e=(0,r.Z)(["\n  query GetAssetsForSelect(\n    $locationId: Int\n    $sublocationId: Int\n    $categoryId: Int\n    $q: String\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    items: Asset(\n      where: {\n        categoryId: { _eq: $categoryId }\n        locationId: { _eq: $locationId }\n        sublocationId: { _eq: $sublocationId }\n        name: { _ilike: $q }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]);return l=function(){return e},e}function u(){var e=(0,r.Z)(["\n  query GetAdminCompliancesForSelect($q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Compliance(\n      where: { name: { _ilike: $q }, locationId: { _is_null: true } }\n      order_by: { name: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      value: id\n      label: name\n      category: ComplianceCategory {\n        value: id\n        label: name\n      }\n    }\n  }\n"]);return u=function(){return e},e}var c=(0,i.Ps)(o()),d=(0,i.Ps)(a()),p=(0,i.Ps)(s()),m=(0,i.Ps)(l()),g=(0,i.Ps)(u())},67101:function(e,t,n){"use strict";n.d(t,{r:function(){return a}});var r=n(85893),i=n(45697),o=n(95103),a=function(e){var t=e.errors,n=e.name,i=e.onChange,a=e.options,s=e.register;return(0,r.jsx)(o.Z,{errors:t,name:n,onChange:i,options:a,register:s})};a.propTypes={errors:i.object.isRequired,name:i.string,onChange:i.func,options:i.array.isRequired,register:i.func.isRequired},a.defaultProps={name:"status"}},83162:function(e,t,n){"use strict";n.d(t,{r:function(){return p}});var r=n(26042),i=n(69396),o=n(99534),a=n(85893),s=n(45697),l=n.n(s),u=n(41664),c=n.n(u),d=n(23795),p=function(e){var t=e.children,n=e.href,s=e.noWrap,l=e.target,u=e.sx,p=void 0===u?{}:u,m=(0,o.Z)(e,["children","href","noWrap","target","sx"]);return s?(0,a.jsx)(a.Fragment,{children:t}):n?(0,a.jsx)(c(),{href:n,target:l,passHref:!0,children:(0,a.jsx)(d.Z,(0,i.Z)((0,r.Z)({sx:p,children:t,href:n,noWrap:s,target:l},m),{children:t}))}):(0,a.jsx)(d.Z,(0,i.Z)((0,r.Z)({sx:p,children:t,href:n,noWrap:s,target:l},m),{children:t}))};p.defaultProps={onClick:function(e){e.stopPropagation()}},p.propTypes={onClick:l().func,href:l().string,noWrap:l().bool,color:l().string}},57779:function(e,t,n){"use strict";n.d(t,{G:function(){return O}});var r=n(26042),i=n(69396),o=n(85893),a=n(45697),s=n.n(a),l=n(6812),u=n(92711),c=n(45451),d=n(11013),p=n(3770),m=n(452),g=n(40826),f=function(e,t){var n=function(){return(0,o.jsx)(g.Z,{context:"success",icon:"check",size:"sm",title:"Yes"})},r=function(){return(0,o.jsx)(g.Z,{context:"warning",icon:"times",size:"sm",title:"No"})},i=function(){return(0,o.jsx)(g.Z,{context:"dark",icon:"minus",size:"sm",title:"Unavailable"})};return"image"===e?(null==t?void 0:t.thumbnails)&&(null==t?void 0:t.thumbnails.length)?n:r:i},h=n(12632),v=n(74944),x=n(86532),y=n(22797),b=n(38895),Z=n(5616),j=n(11057),C=n(51233),I=n(21023),S=n(15861),T=n(14924),q=n(70872),P=n(58886),w=n(90948),_=n(67294),k=n(77314),M=(0,n(42850).bH)(k.ZP),R=function(e){var t=e.images,n=e.showPagination,i=e.height,a=(0,_.useState)(0),s=a[0],l=a[1],u=function(e){l(e)};return(0,o.jsxs)(C.Z,{width:"100%",alignItems:"center",children:[(0,o.jsx)(M,{index:s,onChangeIndex:u,enableMouseEvents:!0,interval:1e4,children:t.map(function(e){return(0,o.jsx)(Z.Z,{component:"img",sx:{height:i,display:"block",overflow:"hidden",width:"100%",objectFit:"cover"},src:e.filename,alt:e.caption},e.caption)})}),n&&t.length>1&&(0,o.jsx)(A,{page:s+1,count:t.length,onChange:function(e,t){return u(t-1)},variant:"outlined",shape:"rounded",renderItem:function(e){return(0,o.jsx)(P.Z,(0,r.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})]})};R.defaultProps={images:[],showPagination:!0},R.propTypes={height:s().oneOfType([s().string,s().number]),images:s().arrayOf(s().shape({caption:s().string,filename:s().string.isRequired}).isRequired).isRequired,showPagination:s().bool};var A=(0,w.ZP)(q.Z)(function(e){e.hidePrevButton,e.hideNextButton;var t,n=e.theme;return t={},(0,T.Z)(t,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,T.Z)(t,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,T.Z)(t,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,T.Z)(t,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,T.Z)(t,"& button.Mui-selected",{color:n.palette.white.main,backgroundColor:n.palette.secondary.main}),t}),E=n(27434),D=n(21830),F=n(83162),$=n(74492),O=function(e){var t=e.carousel,n=e.category,a=e.data,s=e.entity,g=e.entityId,T=e.filters,q=e.listView,P=e.mediaMeta,w=e.onMediaAdd,_=e.onMediaRemove,k=e.showActionButtons,M=e.showEntityColumn,A=e.showItemActions,O=e.title,G=e.type,z=e.expanded,N=e.onChangeExpanded,V=e.hideExpandIcon,H=e.mediaFormProps,Q=e.offCanvasProps,B=e.onlySingleMedia,U=e.elevation,L=e.accordionSx,W=e.refetch,Y=(0,h.x)({filters:T}),X=Y.initialData,J=Y.ref,K=(0,v.x)(),ee=K.hasRole,et=K.user,en=(0,$.a)(),er=(0,l.a)(u.t,{variables:(0,i.Z)((0,r.Z)({},X),{entity:s,entityId:g,category:n,adminId:et.adminId,meta:P})}),ei=er.data,eo=void 0===ei?{items:[],meta:{aggregate:{totalCount:0}}}:ei,ea=eo.items,es=eo.meta,el=er.loading,eu=er.refetch,ec=function(e){en.close(),a.length||eu();var t=e.map(function(e){return(0,i.Z)((0,r.Z)({},e),{link:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.filename)})});w&&w(t),W&&W()},ed=function(e){en.close(),a.length||eu(),_&&_(e),W&&W()},ep=function(e){e.stopPropagation(),en.show((0,r.Z)({content:(0,o.jsx)(m.z,(0,r.Z)({accept:"image/*",adminId:et.adminId,category:n,entity:s,entityId:g,expiryShow:!1,mediaMeta:P,multiple:!0,onSuccess:ec,type:"image"},H)),title:"Upload Photos"},Q))},em=function(e){e.stopPropagation(),en.show((0,r.Z)({content:(0,o.jsx)(m.z,(0,r.Z)({accept:".pdf, .doc, .docx, .xlsx",adminId:et.adminId,category:n,entity:s,entityId:g,expiryShow:!1,mediaMeta:P,onSuccess:ec,type:"document"},H)),title:"Upload Documents"},Q))},eg=function(e){en.show({content:(0,o.jsx)(d.d,{mediaId:e.data.id,onSuccess:ed}),submit:!1,title:"Delete Media"})},ef=function(e){en.show({content:(0,o.jsx)(p.z,{media:e.data,toggleShow:en.close}),title:"Media Details"})},eh=function(e){return[{context:"primary",icon:"info",onClick:function(t){return ef(e)},tooltip:"Details"},{context:"danger",icon:"delete",onClick:function(t){return eg(e)},tooltip:"Delete"}]},ev=[{field:"file",headerName:"File",flex:1,sortable:!1,renderCell:function(e){var t=e.row,n=e.value;return(0,o.jsx)(F.r,{color:"secondary",onClick:function(e){e.preventDefault(),window.open("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(t.filename))},children:n})}},{field:"visibility",headerName:"Visible to",flex:1,sortable:!1},{hide:!M,field:"entity",headerName:"Entity",flex:1,sortable:!1},{field:"authority",headerName:"",width:50,sortable:!1,renderCell:function(e){var t=e.value;return(0,o.jsx)(o.Fragment,{children:(null==t?void 0:t.adminOnly)&&(0,o.jsx)(I.Z,{title:"Admin user only",children:(0,o.jsx)(Z.Z,{component:"img",alt:"Admin Only",src:"/messaging/admin-only.svg",sx:{height:"24px"}})})})}},{field:"uploaded",headerName:"Uploaded by",flex:1,sortable:!1},{hide:!q,field:"thumbnails",headerName:"Thumbnails",flex:1,sortable:!1,renderCell:function(e){var t=e.value;return"function"==typeof t?t():t}},{hide:!A,field:"actions",headerName:"",width:50,sortable:!1,renderCell:function(e){var t=e.row;return ee("admin")?(0,o.jsx)(D.C,{actionsData:eh,row:t}):et.id===t.userId?(0,o.jsx)(D.C,{actionsData:eh,row:t}):null}}],ex=[],ey=ea.filter(function(e){var t=e.item;return(null==t?void 0:t.visibility)&&ee(null==t?void 0:t.visibility)}).map(function(e){var t=e.entity,n=e.entityId,r=e.id,i=e.item,o=i.caption,a=i.filename,s=i.meta,l=i.name,u=i.type,c=i.user,d=i.visibility;return{data:i,id:r,userId:null==c?void 0:c.id,filename:a,visibility:d.join(", "),file:o||l||a,entity:t&&"".concat(t,"#").concat(n),authority:s,uploaded:"".concat(null==c?void 0:c.nameFirst," ").concat(null==c?void 0:c.nameLast),thumbnails:f(u,s),actions:""}}),eb=(ea.filter(function(e){var t=e.item;return(null==t?void 0:t.visibility)&&ee(null==t?void 0:t.visibility)}).forEach(function(e){var t=e.item,n=t.caption,r=t.filename;"image"===t.type&&ex.push({caption:n,filename:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(r)})}),ex),eZ=eb.length;return(0,o.jsxs)(x.Z,{elevation:U,expanded:z,onChange:N,sx:L,children:[(0,o.jsx)(b.Z,(0,i.Z)((0,r.Z)({},V?{}:{expandIcon:(0,o.jsx)(E.Z,{})}),{children:(0,o.jsx)(S.Z,{variant:"h6",children:O})})),(0,o.jsxs)(y.Z,{children:[t&&eZ>0&&(0,o.jsx)(R,{height:"200px",images:eb}),(0,o.jsx)(c.i,{columns:ev,rows:ey,loading:el,meta:es,ref:J,refetch:eu,columnVisibilityModel:{entity:M,thumbnails:q,actions:A}}),k&&!(B&&ey.length>0)&&(0,o.jsxs)(C.Z,{direction:"row",justifyContent:"center",spacing:2,mt:2,children:[(!G||"document"===G)&&(0,o.jsx)(j.Z,{variant:"contained",color:"secondary",onClick:em,children:"Add Document"}),(!G||"image"===G||"avatar"===G)&&(0,o.jsxs)(j.Z,{variant:"contained",color:"secondary",onClick:ep,children:["Add ",G?"".concat(G.charAt(0).toUpperCase()).concat(G.slice(1)):"Image"]})]})]})]})};O.propTypes={carousel:s().bool,category:s().string,data:s().array,entity:s().string,entityId:s().number,filters:s().object,listView:s().bool,mediaMeta:s().object,onMediaAdd:s().func,onMediaRemove:s().func,showActionButtons:s().bool,showEntityColumn:s().bool,showItemActions:s().bool,title:s().string,type:s().string,expanded:s().bool,onChangeExpanded:s().func,hideExpandIcon:s().bool,mediaFormProps:s().object,offCanvasProps:s().object,onlySingleMedia:s().bool,elevation:s().number,accordionSx:s().object,refetch:s().func},O.defaultProps={carousel:!0,data:[],filters:{},listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,title:"Media",type:null,onChangeExpanded:function(){},mediaFormProps:{},offCanvasProps:{},category:"media",onlySingleMedia:!1,elevation:1,accordionSx:{},refetch:function(){}}},536:function(e,t,n){"use strict";n.d(t,{P:function(){return S}});var r=n(47568),i=n(26042),o=n(69396),a=n(99534),s=n(7297),l=n(97582),u=n(85893),c=n(67294),d=n(45697),p=n(10367),m=n(66252),g=n(57493),f=n(78289),h=n(52019),v=n(49501),x=n(9270),y=n(62140),b=n(84043),Z=n(77439);function j(){var e=(0,s.Z)(["\n  position: relative;\n  right: 25px;\n  top: 2px;\n"]);return j=function(){return e},e}var C=function(e,t){var n,r,i,o=!0;return(null===(n=e.errors[e.name])||void 0===n?void 0:n.message)!==(null===(r=t.errors[t.name])||void 0===r?void 0:r.message)&&(o=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach(function(n){e[n]!==t[n]&&(o=!1)}),o},I=function(e){var t=e.accountId,n=e.area,r=e.assetCategoryId,i=e.entity,o=e.entityId,a=(e.hasRole,e.id),s=e.locationId,l=e.serviceId,u=e.taxonomyGroupType,c=e.customerId,d=e.customerRole,p=e.type,m=e.userId,f=e.invoiceThreshold,h=e.quoteThreshold,v=p;switch(d&&(v="".concat(p,"_").concat(d)),v){case"address":return{query:g.cz,variables:{entity:i,entityId:o}};case"asset":return{query:g.UH,variables:{categoryId:r,locationId:s}};case"assetBookable":return{query:g.UH,variables:{categoryId:r,locationId:s,bookable:"yes"}};case"assetCategory":return{query:g.nD,variables:{id:a}};case"assetSublocation":return{query:g.UH,variables:{category:"sublocation",adminId:t,locationId:s}};case"coverage":return{query:g.j$};case"customer":return{query:g.SW};case"job":return{query:g.Qn,variables:{locationId:s}};case"manager":return{query:g.he,variables:{accountId:t,userId:m}};case"thresholdManagers":return{query:g.Ak,variables:{accountId:t,userId:m,invoiceThreshold:f,quoteThreshold:h}};case"product":return{query:g.UH,variables:{category:"product",locationId:s}};case"property":return{query:g._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:t}}}}};case"property_user":return{query:g._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:t},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:c}}},User_Account_Locations:{Account_User:{userId:{_eq:c},accountId:{_eq:t}}}}}}};case"sensor":return{query:g.UH,variables:{category:"sensor",locationId:s}};case"service":return{query:g.kx};case"sla":return{query:g.t1,variables:{type:"priority",adminId:t}};case"sublocation":return{query:g.zR,variables:{locationId:s}};case"supplier":var x={type:{_eq:"supplier"}};return n&&(x.PostcodeAreas={PostcodeArea:{area:{_eq:n}},entity:{_eq:"Account"},status:{_eq:"active"}}),l&&(x.ServiceSchedule={status:{_eq:"active"},entity:{_eq:"Supplier"},serviceId:{_eq:l}},n&&(x.ServiceSchedule.PostcodeAreas={PostcodeArea:{area:{_eq:n}}})),{query:g.by,variables:{where:x}};case"user":return{query:g.yR,variables:{accountId:t}};case"usersForBookings":return{query:g.yR,variables:{accountId:m}};case"tenant":return{query:g.RJ};case"taxonomyGroup":return{query:g.Cj,variables:{type:u}};case"expenseCategory":return{query:g.Ve};default:return{query:g.qd}}},S=(0,c.memo)(function(e){var t,n=e.AddForm,s=e.accountId,d=e.area,p=e.assetCategoryId,g=e.control,j=e.entity,C=e.entityId,S=e.errors,q=e.id,P=e.isClearable,w=e.isDisabled,_=e.label,k=e.locationId,M=e.name,R=e.serviceId,A=e.taxonomyGroupType,E=e.customerId,D=e.customerRole,F=e.type,$=e.userId,O=e.invoiceThreshold,G=e.quoteThreshold,z=(0,a.Z)(e,["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId","invoiceThreshold","quoteThreshold"]),N=(0,m.x)(),V=(0,c.useState)(!1),H=V[0],Q=V[1],B=(0,c.useState)(),U=B[0],L=B[1],W=(0,c.useState)(!1),Y=W[0],X=W[1],J=(0,c.useContext)(f.Z),K=(0,c.useContext)(h.Z).hasRole,ee=(0,c.useState)(!1),et=ee[0],en=ee[1];(0,c.useEffect)(function(){return en(!1),X(!1),function(){}},[s,p,j,C,k,R,F,E,D,$]);var er=(t=(0,r.Z)(function(){var e,t,n,r,a,u,c,m;return(0,l.__generator)(this,function(a){switch(a.label){case 0:if(Y)return en(!0),[2,null];return Q(!0),t=(e=I({accountId:s,area:d,assetCategoryId:p,entity:j,entityId:C,hasRole:K,id:q,locationId:k,serviceId:R,taxonomyGroupType:A,customerId:E,customerRole:D,type:F,userId:$,invoiceThreshold:O,quoteThreshold:G})).query,r=void 0===(n=e.variables)?{}:n,[4,N.query({query:t,variables:(0,i.Z)({},r)})];case 1:var l,c;return l=(void 0===(u=a.sent().data)?{items:[]}:u).items,m="asset"===(c=F)?l.map(function(e){return(0,o.Z)((0,i.Z)({},e),{label:"".concat(e.label," ").concat(e.sublocation?"- ".concat(e.sublocation.name):"")})}):l,L(m),Q(!1),X(!0),en(!0),[2]}})}),function(){return t.apply(this,arguments)}),ei=function(){J.show({content:(0,u.jsx)("div",{children:(0,u.jsx)(n,{})}),title:"Add form"})};return(0,u.jsx)(v.Z,{id:M,label:_,children:(0,u.jsxs)(x.Z,{children:[(0,u.jsx)(y.Z,{md:n?11:12,children:(0,u.jsx)(b.Z,(0,i.Z)({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:g,errors:S,isDisabled:w,isClearable:P,isLoading:H,menuIsOpen:et,options:U,onFocus:er,onBlur:function(){en(!1)},name:M,searchable:!0},z),z.defaultValue)}),n&&(0,u.jsx)(y.Z,{md:1,children:(0,u.jsx)(T,{children:(0,u.jsx)(Z.Z,{content:null,startIcon:"plus",size:"sm",onClick:ei})})})]})})},C),T=p.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-f7921e38-0"})(j());S.propTypes={AddForm:d.object,area:d.string,accountId:d.number,assetCategoryId:d.number,control:d.object.isRequired,errors:d.object.isRequired,entity:d.string,entityId:d.number,id:d.number,isClearable:d.bool,label:d.string.isRequired,locationId:d.number,name:d.string.isRequired,serviceId:d.number,taxonomyGroupType:(0,d.oneOf)(["expenseCategory","costCategory","jobTags"]),type:d.string},S.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},86574:function(e,t,n){"use strict";n.d(t,{O:function(){return l}});var r=n(26042),i=n(85893),o=n(90948),a=n(40044),s=(0,o.ZP)(function(e){return(0,i.jsx)(a.Z,(0,r.Z)({disableRipple:!0},e))})(function(e){var t=e.theme;return{textTransform:"none",color:t.palette.text.primary,"&.Mui-selected":{fontWeight:600,color:t.palette.secondary.contrastText,backgroundColor:t.palette.secondary.main},"&.Mui-focusVisible":{backgroundColor:"rgba(100, 95, 228, 0.32)"}}}),l=function(e){return(0,i.jsx)(s,(0,r.Z)({},e))};l.defaultProps={},l.propTypes={}},86858:function(e,t,n){"use strict";n.d(t,{x:function(){return u}});var r=n(26042),i=n(69396),o=n(99534),a=n(85893),s=n(90948),l=n(5616),u=function(e){var t=e.children,n=e.value,s=e.index,u=e.boxProps,d=e.boxSx,p=(0,o.Z)(e,["children","value","index","boxProps","boxSx"]);return(0,a.jsx)(c,(0,i.Z)((0,r.Z)({role:"tabpanel",hidden:n!==s,id:"simple-tabpanel-".concat(s),"aria-labelledby":"simple-tab-".concat(s)},p),{children:n===s&&(0,a.jsx)(l.Z,(0,i.Z)((0,r.Z)({},u),{sx:(0,r.Z)({padding:"25px 0"},d),children:t}))}))};u.defaultProps={boxProps:{},boxSx:{}};var c=(0,s.ZP)(l.Z)(function(){return{"& .MuiTabs-root":{}}})},83336:function(e,t,n){"use strict";n.d(t,{m:function(){return g}});var r=n(26042),i=n(69396),o=n(99534),a=n(85893),s=n(45697),l=n.n(s),u=n(90948),c=n(3892),d=n(11163),p=n.n(d),m=(0,u.ZP)(function(e){return(0,a.jsx)(c.Z,(0,r.Z)({},e))})(function(e){var t=e.theme,n=e.size;return(0,i.Z)((0,r.Z)({},"small"===n&&{height:"32px",minHeight:"32px"}),{"& .MuiTabs-scroller":(0,r.Z)({overflow:"scroll !important"},"small"===n&&{height:"60px",minHeight:"60px"}),"& .MuiTabs-indicator":{display:"none"},"& .MuiTabs-flexContainer > .MuiTab-root":(0,i.Z)((0,r.Z)({},"small"===n&&{height:"32px",minHeight:"32px"}),{border:1,borderStyle:"solid",borderColor:t.palette.divider,"&:first-child":(0,r.Z)({borderTopLeftRadius:"10px",borderBottomLeftRadius:"10px"},"small"===n&&{borderTopLeftRadius:"5px",borderBottomLeftRadius:"5px"}),"&:last-child":(0,r.Z)({borderTopRightRadius:"10px",borderBottomRightRadius:"10px"},"small"===n&&{borderTopRightRadius:"5px",borderBottomRightRadius:"5px"})})})}),g=function(e){var t=e.onChange,n=e.changeQuery,i=(0,o.Z)(e,["onChange","changeQuery"]),s=(0,d.useRouter)(),l=function(e,r){t(e,r),n&&u(r)},u=function(e){var t=s.query;delete t.tab,t.tab=e,p().push({pathname:s.pathname,query:t,shallow:!0})};return(0,a.jsx)(m,(0,r.Z)({onChange:l},i))};g.defaultProps={size:"small"},g.propTypes={size:l().oneOf(["small",void 0])}},45451:function(e,t,n){"use strict";n.d(t,{i:function(){return S}});var r=n(14924),i=n(26042),o=n(69396),a=n(85893),s=n(67294),l=n(11163),u=n(45697),c=n.n(u),d=n(61870),p=n(5616),m=n(51233),g=n(15861),f=n(90948),h=n(41796),v=n(29217),x=n(45111),y=n(98209),b=n(70872),Z=n(58886),j=n(61730),C=function(e){var t=e.currentPage,n=e.totalCount,r=e.pageSize,o=e.onPageChange,s=(0,j.Z)("(max-width:400px)"),l=(0,j.Z)("(max-width:500px)");return(0,a.jsx)(I,{mb:2,page:t,count:Math.ceil(n/r),onChange:function(e,t){return o(t)},variant:"outlined",shape:"rounded",size:s?"small":"medium",hidePrevButton:1===t,hideNextButton:t===Math.ceil(n/r),siblingCount:l?0:1,renderItem:function(e){return(0,a.jsx)(Z.Z,(0,i.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})};C.defaultProps={currentPage:1,totalCount:0,pageSize:50,onPageChange:function(){}},C.propTypes={currentPage:c().number,totalCount:c().number,pageSize:c().number,onPageChange:c().func};var I=(0,f.ZP)(b.Z)(function(e){var t,n=e.hidePrevButton,o=e.hideNextButton,a=e.theme;return t={},(0,r.Z)(t,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,r.Z)(t,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,r.Z)(t,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,r.Z)(t,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,r.Z)(t,"& button.Mui-selected",(0,i.Z)({color:a.palette.white.main,backgroundColor:a.palette.secondary.main},o?{borderRadius:"0 5px 5px 0"}:{},n?{borderRadius:"5px 0 0 5px"}:{})),t}),S=(0,s.forwardRef)(function(e,t){var n=e.columns,r=e.history,o=e.initialSort,u=e.meta,c=e.refetch,d=e.paginationSize,p=e.containerHeight,f=e.containerMaxHeight,h=e.noResultsMessage,b=e.autoHeight,Z=(0,l.useRouter)(),j=Z.query,I=void 0===j?{}:j,S=(0,s.useState)(parseInt(null==I?void 0:I.page,10)||1),P=S[0],w=S[1],_=(0,s.useState)(d||y.C1.paginationSize),k=_[0],M=_[1],R=o;R||(R={item:"createdAt",order:"desc"});var A=(0,s.useState)({item:R.item,order:R.order}),E=A[0],D=A[1],F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=Z.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var r=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(r)},$=function(){D({item:R.item,order:R.order}),w(1);var e=F();Z.push(e),M(d||y.C1.paginationSize)};(0,s.useImperativeHandle)(t,function(){return{currentPage:P,pageSize:k,sort:E,resetPagination:function(){$()}}});var O=function(e){var t=F(e);r&&Z.push(t),w(e),!r&&c&&c()},G=function(e){e&&e.field&&e.sort?(D({item:n.find(function(t){return t.field===e.field}).sortName||e.field||e.item||R.item,order:e.sort||e.order||R.order}),c&&c()):(D({item:R.item,order:R.order}),c&&c())};return(0,a.jsxs)(T,{containerHeight:p,containerMaxHeight:f,children:[(0,a.jsx)(q,(0,i.Z)({hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0,autoHeight:b,sortingMode:"server",onSortModelChange:function(e){return G(e[0])},columns:n,pageSize:k,slots:{columnSortedAscendingIcon:function(){return(0,a.jsx)(v.Z,{})},columnSortedDescendingIcon:function(){return(0,a.jsx)(x.Z,{})},columnUnsortedIcon:function(){return(0,a.jsxs)(m.Z,{alignItems:"center",sx:{width:"33px"},children:[(0,a.jsx)(v.Z,{sx:{marginBottom:"-15px"}}),(0,a.jsx)(x.Z,{})]})},noResultsOverlay:function(){return(0,a.jsx)(m.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(g.Z,{children:h})})},noRowsOverlay:function(){return(0,a.jsx)(m.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(g.Z,{children:h})})}}},e)),u&&Math.ceil(u.aggregate.totalCount/k)>1&&(0,a.jsx)(C,{currentPage:P,totalCount:u.aggregate.totalCount,pageSize:k,onPageChange:O})]})});S.propTypes={history:c().bool,initialSort:c().object,loading:c().bool,meta:c().object,refetch:c().func,paginationSize:c().number,noResultsMessage:c().string,columns:c().array.isRequired,rows:c().array.isRequired,autoHeight:c().bool},S.defaultProps={columns:[],history:!1,loading:!1,rows:[],noResultsMessage:"There are no results.",autoHeight:!0};var T=(0,f.ZP)(p.Z)(function(e){var t;return{height:e.containerHeight,maxHeight:e.containerMaxHeight,display:"flex",flexDirection:"column"}}),q=(0,f.ZP)(d.s)(function(e){var t,n=e.theme,a=e.hideHeader,s=(e.rows,e.loading,e.rowHeight),l=e.isPdf;return t={"--DataGrid-overlayHeight":"40px"},(0,r.Z)(t,"&.MuiDataGrid-root",(0,i.Z)({color:n.palette.black.main,border:"none"},l&&{"@media print":{display:"block"}})),(0,r.Z)(t,"& .MuiDataGrid-main",(0,i.Z)({},l&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(t,"& .MuiDataGrid-columnHeaders",(0,o.Z)((0,i.Z)({},a&&{display:"none"}),{"& .MuiDataGrid-iconButtonContainer":{visibility:"visible","& .MuiButtonBase-root.MuiIconButton-root":{backgroundColor:"inherit",color:n.palette.black.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}}})),(0,r.Z)(t,"& .MuiDataGrid-virtualScroller",(0,i.Z)({},a&&{marginTop:"0 !important"},l&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(t,"& .MuiDataGrid-iconSeparator",{opacity:0}),(0,r.Z)(t,"& .MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(t,"& .MuiButtonBase-root.MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(t,"& .MuiDataGrid-virtualScrollerContent",(0,i.Z)({},l&&{height:"initial !important",minHeight:"initial !important"})),(0,r.Z)(t,"& .MuiDataGrid-virtualScrollerRenderZone",(0,i.Z)({},l&&{position:"relative"})),(0,r.Z)(t,"& .MuiDataGrid-overlayWrapper",(0,r.Z)({},"& .MuiCircularProgress-root",{color:n.palette.secondary.main})),(0,r.Z)(t,"& .MuiDataGrid-row",(0,i.Z)({},l&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,r.Z)(t,"& .MuiDataGrid-row > .MuiDataGrid-cell",(0,i.Z)({},l&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,r.Z)(t,"& .MuiDataGrid-columnHeaderCheckbox",(0,r.Z)({},"& .MuiButtonBase-root.MuiCheckbox-root > .MuiSvgIcon-root",(0,r.Z)({color:n.palette.secondary.main},'&[data-testid="CheckBoxOutlineBlankIcon"]',{color:"currentColor"}))),(0,r.Z)(t,"& .MuiDataGrid-row > .MuiDataGrid-cellCheckbox",(0,r.Z)({},"& .MuiButtonBase-root.MuiCheckbox-root > .MuiSvgIcon-root",(0,r.Z)({color:n.palette.secondary.main},'&[data-testid="CheckBoxOutlineBlankIcon"]',{color:"currentColor"}))),(0,r.Z)(t,"& .MuiDataGrid-row.even",{backgroundColor:n.palette.muiLightGray.main,"&:hover, &.Mui-hovered":{backgroundColor:(0,h.Fq)(n.palette.muiLightGray.main,.3),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,h.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,h.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity+n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,h.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity)}}}}),t})},87336:function(e,t,n){"use strict";n.d(t,{t:function(){return u}});var r=n(85893),i=n(67294),o=n(45697),a=n(11163),s=n(98209),l=n(16540),u=(0,i.forwardRef)(function(e,t){var n=e.columns,o=e.history,u=e.initialSort,c=e.loading,d=e.meta,p=e.paginationSize,m=e.refetch,g=e.rowClick,f=e.rows,h=e.xeroPageSize,v=(0,a.useRouter)(),x=v.query,y=void 0===x?{}:x,b=(0,i.useState)(parseInt(null==y?void 0:y.page,10)||1),Z=b[0],j=b[1],C=(0,i.useState)(h||s.C1.paginationSize),I=C[0],S=C[1];u||(u={item:"createdAt",order:"desc"});var T=(0,i.useState)({item:u.item,order:u.order}),q=T[0],P=T[1],w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=v.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var r=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(r)},_=function(){P({item:u.item,order:u.order}),j(1);var e=w();v.push(e),S(h||s.C1.paginationSize)};(0,i.useImperativeHandle)(t,function(){return{currentPage:Z,pageSize:I,sort:q,resetPagination:function(){_()}}});var k=function(e){var t=w(e);o&&v.push(t),j(e),!o&&m&&m()},M=function(e){e!==s.C1.paginationSize&&(S(e),m&&m())},R=function(e){var t;P({item:e.item,order:e.order}),m&&m()};return(0,r.jsx)(l.Z,{columns:n,loading:c,paginationSize:p,pagination:d&&!0,paginationProps:d&&{currentPage:Z,onPageChange:k,onPageSizeChange:M,pageCount:Math.ceil(d.aggregate.totalCount/I),perPage:I},rowClick:g,rows:f,sort:q,setSort:R})});u.propTypes={columns:o.array.isRequired,history:o.bool,initialSort:o.object,loading:o.bool,meta:o.object,refetch:o.func,rowClick:o.func,rows:o.array.isRequired},u.defaultProps={history:!0,loading:!0,paginationSize:!1}},22428:function(e,t,n){"use strict";n.d(t,{T:function(){return y}});var r=n(85893),i=n(45697),o=n.n(i),a=n(93946),s=n(97212),l=n(98619),u=n(59334),c=n(51233),d=n(50135),p=n(50594),m=n(40055),g=n(21830),f=n(10166),h=n(67294),v=n(42283),x=a.Z,y=function(e){var t=e.tagEntityId,n=e.tagId,i=e.name,o=e.color,a=e.editable,u=e.onDelete,f=e.onColorChange,y=e.onNameChange,Z=(0,v.cI)({defaultValues:{name:i,color:o}}),j=Z.register,C=Z.handleSubmit,I=(0,h.useState)(null),S=I[0],T=I[1],q=function(){return[{icon:"delete",onClick:function(e){e.stopPropagation(),u(t)},tooltip:"Remove"},{icon:"edit",onClick:function(e){e.stopPropagation(),T("rename")},tooltip:"Rename"},{icon:"visibility",onClick:function(e){e.stopPropagation(),T("changeColor")},tooltip:"Change color"}]},P=function(e){e.stopPropagation(),T(null)},w=function(e){f({tagId:n,color:e.color}),T(null)},_=function(e){y({tagId:n,name:e.name}),T(null)};return(0,r.jsx)(s.ZP,{disablePadding:!0,secondaryAction:!a||!S&&(0,r.jsx)(g.C,{icon:"defaultHoriz",actionsData:q}),children:S?({changeColor:function(){return(0,r.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,r.jsx)("input",{name:"color",ref:j,type:"color",style:{padding:0,border:"none","background-color":"unset"}}),(0,r.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,r.jsx)(x,{size:"small",color:"danger",onClick:P,children:(0,r.jsx)(p.Z,{})}),(0,r.jsx)(x,{size:"small",color:"success",onClick:C(w),children:(0,r.jsx)(m.Z,{})})]})]})},rename:function(){return(0,r.jsxs)(c.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,r.jsx)(d.Z,{name:"name",inputRef:j,variant:"standard",color:"secondary"}),(0,r.jsxs)(c.Z,{direction:"row",alignItems:"center",children:[(0,r.jsx)(x,{size:"small",color:"danger",onClick:P,children:(0,r.jsx)(p.Z,{})}),(0,r.jsx)(x,{size:"small",color:"success",onClick:C(_),children:(0,r.jsx)(m.Z,{})})]})]})}})[S]():(0,r.jsx)(l.Z,{children:(0,r.jsx)(b,{primary:i,color:o})})},n)};y.defaultProps={onDelete:function(){},onColorChange:function(){},onNameChange:function(){},editable:!0},y.propTypes={tagEntityId:o().string.isRequired,tagId:o().string.isRequired,name:o().string.isRequired,color:o().string.isRequired,editable:o().bool,onDelete:o().func.isRequired,onColorChange:o().func.isRequired,onNameChange:o().func.isRequired};var b=(0,f.Z)(u.Z)(function(e){return e.theme,{"&.MuiListItemText-root .MuiListItemText-primary":{fontWeight:700,color:e.color}}})},71403:function(e,t,n){"use strict";n.d(t,{P:function(){return m}});var r=n(85893),i=n(67294),o=n(45697),a=n.n(o),s=n(15861),l=n(14564),u=n(78462),c=n(51233),d=n(74833),p=n(22428),m=function(e){var t=e.tags,n=e.handleDeleteTagEntity,o=(0,i.useState)(null),a=o[0],m=o[1],g=null==t?void 0:t.slice(0,5),f=(null==t?void 0:t.length)-(null==g?void 0:g.length),h=Boolean(a);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(c.Z,{direction:"row",spacing:1,children:g.map(function(e,t){var i;return(0,r.jsx)(d.V,{tagEntityId:e.id||t,name:e.tag.name,color:null===(i=e.tag.meta)||void 0===i?void 0:i.color,onDelete:n})})}),f>0&&(0,r.jsxs)(s.Z,{fontWeight:700,ml:1,onMouseEnter:function(e){m(e.currentTarget),e.stopPropagation()},children:["+",f]}),(0,r.jsx)(l.ZP,{id:h?"tags-in-table-popover":void 0,open:h,anchorEl:a,onClose:function(){return m(null)},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,r.jsx)(u.Z,{children:null==t?void 0:t.map(function(e){var t;return(0,r.jsx)(p.T,{tagEntityId:e.id,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,editable:!1},e.tag.id)})})})]})};m.propTypes={tags:a().object,title:a().string},m.defaultProps={tags:{},displayOnly:!1,refetchQueries:[],handleDeleteTagEntity:function(){}}},42074:function(e,t,n){"use strict";n.d(t,{n:function(){return A}});var r=n(47568),i=n(26042),o=n(69396),a=n(828),s=n(29815),l=n(97582),u=n(85893),c=n(45697),d=n.n(c),p=n(96486),m=n(6812),g=n(50319),f=n(11961),h=n(93362),v=n(23776),x=n(5616),y=n(98456),b=n(93946),Z=n(78462),j=n(18972),C=n(14564),I=n(51233),S=n(50135),T=n(67294),q=n(10166),P=n(74944),w=n(22428),_=n(16380),k=n(71403),M=b.Z,R=(0,h.D)(),A=function(e){var t=e.entityId,n=e.entity,c=e.values,d=void 0===c?[]:c,h=e.name,b=void 0===h?"tags":h,C=e.setValue,q=(0,P.x)().user,A=(0,T.useState)(null),D=A[0],F=A[1],$=(0,T.useState)(""),O=$[0],G=$[1],z=(0,T.useState)(""),N=z[0],V=z[1],H=(0,T.useState)(""),Q=H[0],B=H[1],U=(0,m.a)(_.BU,{skip:!t,variables:{entityId:t,entity:n},onCompleted:function(e){C(b,e.tags)}}),L=U.data,W=(void 0===L?{tags:[]}:L).tags,Y=U.loading,X=U.refetch,J=(0,m.a)(_.gI,{skip:!D,variables:{entityId:t,entity:n,q:""!==Q?"%".concat(Q,"%"):null}}),K=J.data,ee=(void 0===K?{tags:[]}:K).tags,et=J.loading,en=(0,a.Z)((0,g.D)(_.Zm,{refetchQueries:["GetAllTags"]}),2),er=en[0],ei=en[1].loading,eo=(0,a.Z)((0,g.D)(_.LE,{onCompleted:function(){X()}}),2),ea=eo[0],es=eo[1].loading,el=(0,a.Z)((0,g.D)(_.cS,{onCompleted:function(){X()}}),2),eu=el[0],ec=el[1].loading,ed=(0,a.Z)((0,g.D)(_.g$,{refetchQueries:["GetAllTags"]}),2),ep=ed[0],em=ed[1].loading;(0,T.useEffect)(function(){var e=setTimeout(function(){B(N)},500);return function(){return clearTimeout(e)}},[N]);var eg,ef,eh,ev=function(e){e.stopPropagation(),F(e.currentTarget)},ex=function(){F(null)},ey=(eg=(0,r.Z)(function(e,r){var i,o,a;return(0,l.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof r)return[3,1];return G({label:r}),[3,6];case 1:if(!(r&&r.inputValue&&t))return[3,2];return ea({variables:{objects:[{entity:n,entityId:t,Taxonomy:{data:{type:"tags",status:"active",name:r.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:q.adminId}}}]}}),G(null),[3,6];case 2:if(!(r&&r.value&&t))return[3,3];return ea({variables:{objects:[{entity:n,entityId:t,taxonomyId:r.value}]}}),G(null),[3,6];case 3:if(!(r&&r.inputValue))return[3,5];return[4,er({variables:{objects:[{type:"tags",status:"active",name:r.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:q.adminId}]}})];case 4:return a=e.sent().data.insert_Taxonomy,C(b,(0,s.Z)(d).concat([{id:null,tag:{id:a.returning[0].id,name:a.returning[0].name,meta:a.returning[0].meta}}])),G(null),[3,6];case 5:r&&r.value&&(C(b,(0,s.Z)(d).concat([{id:null,tag:{id:r.value,name:r.label,meta:r.meta}}])),G(null)),e.label=6;case 6:return[2]}})}),function(e,t){return eg.apply(this,arguments)}),eb=(0,T.useCallback)(function(e,t){var n=R(e,t),r=t.inputValue,i=e.some(function(e){return r===e.label});return""===r||i||n.push({inputValue:r,label:'Add "'.concat(r,'"')}),n},[]),eZ=(0,T.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),ej=function(e){t?eu({variables:{tagEntityId:e}}):C(b,d.filter(function(t,n){return n!==e}))},eC=(ef=(0,r.Z)(function(e){var t,n,r,a,s,u;return(0,l.__generator)(this,function(n){switch(n.label){case 0:return[4,ep({variables:{tagId:t=e.tagId,object:{meta:{color:e.color}}}})];case 1:return s=n.sent().data.update_Taxonomy_by_pk,C(b,d.map(function(e){return e.tag.id===t?(0,o.Z)((0,i.Z)({},e),{tag:(0,i.Z)({},s)}):e})),[2]}})}),function(e){return ef.apply(this,arguments)}),eI=(eh=(0,r.Z)(function(e){var t,n,r,a,s,u;return(0,l.__generator)(this,function(r){switch(r.label){case 0:return[4,ep({variables:{tagId:t=e.tagId,object:{name:n=e.name}}})];case 1:return s=r.sent().data.update_Taxonomy_by_pk,C(n,d.map(function(e){return e.tag.id===t?(0,o.Z)((0,i.Z)({},e),{tag:(0,i.Z)({},s)}):e})),[2]}})}),function(e){return eh.apply(this,arguments)}),eS=Boolean(D),eT=(0,T.useMemo)(function(){return ee.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[ee]),eq=(0,T.useMemo)(function(){return p.uniqBy((0,s.Z)(W).concat((0,s.Z)(d)),function(e){var t;return null===(t=e.tag)||void 0===t?void 0:t.id})},[W,d]);return(0,u.jsxs)(I.Z,{direction:"row",alignItems:"center",children:[(0,u.jsx)(k.P,{tags:eq,handleDeleteTagEntity:ej}),(0,u.jsx)(E,{id:eS?"tags-popover":void 0,open:eS,anchorEl:D,onClose:ex,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,u.jsxs)(x.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,u.jsx)(v.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,s.Z)(eT),value:O,onChange:ey,onInputChange:function(e,t){V(t)},filterOptions:eb,getOptionLabel:eZ,renderOption:function(e,t){return(0,u.jsx)(j.Z,(0,o.Z)((0,i.Z)({},e),{children:t.label}))},renderInput:function(e){return(0,u.jsx)(S.Z,(0,o.Z)((0,i.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,o.Z)((0,i.Z)({},e.InputProps),{endAdornment:(0,u.jsxs)(u.Fragment,{children:[et||ei||es?(0,u.jsx)(y.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),Y||ec||em?(0,u.jsx)(I.Z,{width:"100%",alignItems:"center",p:4,children:(0,u.jsx)(y.Z,{color:"secondary"})}):(0,u.jsx)(Z.Z,{children:null==eq?void 0:eq.map(function(e,t){var n;return(0,u.jsx)(w.T,{tagEntityId:e.id||t,tagId:e.tag.id,name:e.tag.name,color:null===(n=e.tag.meta)||void 0===n?void 0:n.color,onDelete:ej,onColorChange:eC,onNameChange:eI})})})]})}),(0,u.jsx)(M,{color:"black",onClick:ev,children:(0,u.jsx)(f.Z,{sx:{height:"16px",width:"16px"}})})]})};A.defaultProps={entityId:null},A.propTypes={entityId:d().number};var E=(0,q.Z)(C.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}})},16380:function(e,t,n){"use strict";n.d(t,{Aw:function(){return j},BU:function(){return h},C3:function(){return Z},LE:function(){return x},Zm:function(){return f},cS:function(){return y},g$:function(){return b},gI:function(){return g},lx:function(){return v}});var r=n(7297),i=n(75063);function o(){var e=(0,r.Z)(['\n  query GetTagsForEntity($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    tags: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']);return o=function(){return e},e}function a(){var e=(0,r.Z)(["\n  mutation CreateTag($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        name\n        meta\n      }\n    }\n  }\n"]);return a=function(){return e},e}function s(){var e=(0,r.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n']);return s=function(){return e},e}function l(){var e=(0,r.Z)(['\n  query GetTagsForSelect($q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n']);return l=function(){return e},e}function u(){var e=(0,r.Z)(["\n  mutation CreateTagsAgainstEntity($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return e},e}function c(){var e=(0,r.Z)(["\n  mutation DeleteTagAgainstEntity($tagEntityId: Int!) {\n    delete_Taxonomy_Entity_by_pk(id: $tagEntityId) {\n      id\n      taxonomyId\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,r.Z)(["\n  mutation UpdateTagAgainstEntity($tagId: Int!, $object: Taxonomy_set_input!) {\n    update_Taxonomy_by_pk(pk_columns: { id: $tagId }, _set: $object) {\n      id\n      name\n      meta\n    }\n  }\n"]);return d=function(){return e},e}function p(){var e=(0,r.Z)(["\n  mutation CreateTagsAgainstEntityWithFollowing($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return p=function(){return e},e}function m(){var e=(0,r.Z)(["\n  mutation DeleteTagAgainstEntityWithFollowing($where: Taxonomy_Entity_bool_exp!) {\n    delete_Taxonomy_Entity(where: $where) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return m=function(){return e},e}var g=(0,i.Ps)(o()),f=(0,i.Ps)(a()),h=(0,i.Ps)(s()),v=(0,i.Ps)(l()),x=(0,i.Ps)(u()),y=(0,i.Ps)(c()),b=(0,i.Ps)(d()),Z=(0,i.Ps)(p()),j=(0,i.Ps)(m())},45307:function(e,t,n){"use strict";n.d(t,{X:function(){return g}});var r=n(14924),i=n(82670),o=n(828),a=n(7297),s=n(67294),l=n(6812),u=n(50319),c=n(75063),d=n(53767);function p(){var e=(0,a.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]);return p=function(){return e},e}function m(){var e=(0,a.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"]);return m=function(){return e},e}function g(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",a=(0,d.q)().user,c=(0,s.useState)(function(){try{switch(n){case"network":case"state":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||t}}catch(r){return t}}),p=c[0],m=c[1],g=function(t){try{var o=(0,i.Z)(t,Function)?t(p):t;switch(m(o),n){case"network":v({variables:{accountUserId:null==a?void 0:a.accountUserId,filters:(0,r.Z)({},e,o)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(o))}}catch(s){}};(0,l.a)(f,{variables:{accountUserId:null==a?void 0:a.accountUserId},skip:"network"!==n,onCompleted:function(n){var r=n.accountUser;r&&m(r.filters[e]||t)}});var v=(0,o.Z)((0,u.D)(h),1)[0];return[p,g]}var f=(0,c.Ps)(p()),h=(0,c.Ps)(m())},15897:function(e,t,n){"use strict";n.d(t,{bg:function(){return r}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},66267:function(e,t,n){"use strict";n.d(t,{J:function(){return j}});var r=n(26042),i=n(69396),o=n(99534),a=n(828),s=n(85893),l=n(11163),u=n(67294),c=n(45697),d=n(9270),p=n(62140),m=n(42283),g=n(76600),f=n(11585),h=n(49501),v=n(75903),x=n(77439),y=n(31113),b=n(45307),Z=function(e){var t=e.initialValues,n=e.renderFilters,o=e.setFilters,l=e.lastQuery,c=e.filters,Z=(0,a.Z)((0,b.X)("form_data_".concat(t.filterType),t),2),j=Z[0],C=Z[1],I=(0,m.cI)({defaultValues:j||t}),S=I.control,T=I.errors,q=I.handleSubmit,P=I.register,w=I.reset,_=I.watch,k=I.setValue,M=_(),R=(0,i.Z)((0,r.Z)({},M),{filterType:t.filterType});(0,u.useEffect)(function(){w(R)},[w]),(0,u.useEffect)(function(){C(R)},[c]);var A=function(e){var n=e.query;if(n!==l){var i={q:"%".concat(n,"%")||0},a=/^\d+$/.test(n);"id"in t&&(i.id=a?Number(n):null),"meta"in t&&(i.meta=a?{invoiceNumbers:[n]}:null),"jobNumber"in t&&(i.jobNumber=a?String(n):null,i.invoiceNumber=a?Number(n):null),o(function(e){return(0,r.Z)({},e,i)})}},E=function(e){Object.keys(t).map(function(e){return k(e,null)}),o(t),w(t),A("")};return(0,s.jsx)(g.Z,{handleSubmit:q(A),children:(0,s.jsxs)(f.Z,{title:"Filters",children:[(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(p.Z,{sm:12,lg:12,children:(0,s.jsx)(h.Z,{label:"",children:(0,s.jsx)(v.Z,{errors:T,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:P,type:"search"})})}),(0,s.jsx)(p.Z,{sm:12,lg:12,children:n({control:S,errors:T,initialValues:t,register:P,setFilters:o,watch:_,setValue:k,reset:w})})]}),(0,s.jsx)(y.H,{content:"Search",context:"secondary",handleClick:A,type:"submit",children:(0,s.jsx)(x.Z,{content:"Clear",context:"danger",onClick:E,size:"sm"})})]})})};Z.propTypes={initialValues:c.object,renderFilters:c.func.isRequired,setFilters:c.func.isRequired};var j=function(e){var t=e.FiltersComp,n=e.initialFilters,c=e.TableComp,m=(0,o.Z)(e,["FiltersComp","initialFilters","TableComp"]),g=(0,a.Z)((0,b.X)("form_data_".concat(n.filterType),n),2),f=g[0],h=g[1],v=(0,u.useState)(f||n),x=v[0],y=v[1],j=(0,l.useRouter)().query.show;return(0,u.useEffect)(function(){h(x)},[x,h]),(0,s.jsx)(d.Z,{children:(0,s.jsxs)(p.Z,{sm:12,lg:12,children:[(0,s.jsx)(Z,{initialValues:n,renderFilters:function(e){return(0,s.jsx)(t,(0,i.Z)((0,r.Z)({},e,m),{show:j}))},setFilters:y,filters:x}),(0,s.jsx)(c,(0,r.Z)({filters:x,initialFilters:n},m))]})})};j.propTypes={FiltersComp:c.func,initialFilters:c.object.isRequired,TableComp:c.func}},461:function(e,t,n){"use strict";n.d(t,{V:function(){return l},z:function(){return s}});var r=n(7297),i=n(75063);function o(){var e=(0,r.Z)(["\n  mutation CreateCompliance($data: jsonb!) {\n    createCompliance(data: $data) {\n      message\n    }\n  }\n"]);return o=function(){return e},e}function a(){var e=(0,r.Z)(["\n  mutation UpdateCompliance($data: jsonb!) {\n    updateCompliance(data: $data) {\n      message\n    }\n  }\n"]);return a=function(){return e},e}var s=(0,i.Ps)(o()),l=(0,i.Ps)(a())},3761:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return tg}});var r=n(85893),i=n(19076),o=n(67294),a=n(11163),s=n(41085),l=n(45697),u=n(66267),c=n(26042),d=n(69396),p=n(6812),m=n(14990),g=n(68956),f=n(74297),h=n(16551),v=n(77439),x=n(11585),y=n(40826),b=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"dark";return function(){return(0,r.jsx)(y.Z,{context:t,icon:"check",size:"sm",title:e})}},Z=function(e,t){return"assetCategory"===e&&!t},j=n(87336),C=n(47568),I=n(828),S=n(97582),T=n(50319),q=n(42283),P=n(76600),w=n(49501),_=n(6710),k=n(90951),M=n(15214),R=n(28497),A=n(9270),E=n(62140),D=n(79665),F=n(536),$=n(20390),O=n(95124),G=n(69368),z=n(50480),N=n(56815),V=n(15861),H=n(16310),Q=function(e){var t="assetQuestion"===e||"complianceQuestions"===e||"supplierQuestion"===e;return(0,H.Ry)().shape({group:(0,H.Rx)(),input:t&&(0,H.Z_)().required(),label:t&&(0,H.Z_)().required(),name:(0,H.Z_)().required(),questions:(0,H.Xg)(),status:(0,H.Z_)().oneOf(["active","inactive"]).required(),sublocation:(0,H.Xg)(),required:(0,H.Xg)(),customerSignature:(0,H.Xg)(),supplierSignature:(0,H.Xg)()})},B=(0,H.Ry)().shape({reportPassFail:(0,H.Xg)(),reportPassFailTitle:(0,H.Z_)().when(["reportPassFail"],function(e,t){return e?t.max(50).required():t.nullable()})}),U=n(83372),L=n(74944),W=n(42074),Y=function(e){var t,n,i,o,a=e.defaultValues,s=e.onSuccess,l=(e.groups,e.parentId),u=void 0===l?null:l,g=(0,L.x)().hasRole,f=(0,q.cI)({defaultValues:null==a?void 0:a.template,resolver:(0,D.S)(B)}),h=f.control,v=f.errors,x=f.handleSubmit,y=f.register,b=f.watch,Z=f.setValue,j=(0,I.Z)((0,T.D)(m.ze,{onCompleted:function(e){var t=e.update_Taxonomy_by_pk.id;s&&s(t)}}),1)[0],H=(0,p.a)(m.X4,{variables:{where:{subtype:{_eq:"reactive"}}}}).data,Q=(0,p.a)(m.X4,{variables:{where:{subtype:{_eq:"quote"}}}}).data,U=b("reportPassFail"),Y=b("reportPassFailTitle"),J=b("slaIdReactive"),K=b("slaIdQuote"),ee=b("tags"),et=(0,O.GU)("reactive",H),en=null===(t=null==et?void 0:et.find(function(e){return e.id===Number(J)}))||void 0===t?void 0:t.notes,er=(0,O.GU)("quote",Q),ei=null===(n=null==er?void 0:er.find(function(e){return e.id===Number(K)}))||void 0===n?void 0:n.notes,eo=(o=(0,C.Z)(function(e){var t;return(0,S.__generator)(this,function(n){switch(n.label){case 0:if(!u)return[3,2];return e.parentId=u,t={meta:(0,d.Z)((0,c.Z)({},a||{}),{template:e})},[4,j({variables:{id:u,changes:t}})];case 1:n.sent(),n.label=2;case 2:return[2]}})}),function(e){return o.apply(this,arguments)}),ea={errors:v,register:y,control:h};return(0,r.jsxs)(P.Z,{id:"offCanvasForm",handleSubmit:x(eo),children:[(0,r.jsx)(w.Z,{label:"Work Description",children:(0,r.jsx)(_.Z,(0,d.Z)((0,c.Z)({},ea),{name:"description",rows:3}))}),g("admin")&&(0,r.jsx)(W.n,{entityId:u,entity:"Taxonomy",name:"tags",setValue:Z,values:ee}),(0,r.jsx)(z.Z,{sx:X,control:(0,r.jsx)(q.Qr,{name:"reportPassFail",control:h,render:function(e){var t=e.onChange,n=e.value;return(0,r.jsx)(G.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:"Add Pass/Fail status"}),!!U&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(z.Z,{sx:X,control:(0,r.jsx)(q.Qr,{name:"requireReportRecommendations",control:h,render:function(e){var t=e.onChange,n=e.value;return(0,r.jsx)(G.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:'Require "Recommendations" if job fails'}),(0,r.jsxs)(w.Z,{label:"Specify text to appear Pass/Fail toggle",children:[(0,r.jsx)(_.Z,(0,d.Z)((0,c.Z)({},ea),{name:"reportPassFailTitle",rows:3})),(null==v?void 0:v.reportPassFailTitle)&&(0,r.jsx)(N.Z,{sx:{m:0},children:null==v?void 0:null===(i=v.reportPassFailTitle)||void 0===i?void 0:i.message}),(0,r.jsxs)(V.Z,{children:[(null==Y?void 0:Y.length)||0,"/50"]})]})]}),(0,r.jsx)(k.Z,(0,d.Z)((0,c.Z)({},ea),{data:et,legend:"Priority Work Orders",name:"slaIdReactive"})),J&&(0,r.jsx)(M.Z,{content:en||"-",context:"light"}),(0,r.jsx)(k.Z,(0,d.Z)((0,c.Z)({},ea),{data:er,legend:"Priority Quotes",name:"slaIdQuote"})),K&&(0,r.jsx)(M.Z,{content:ei||"-",context:"light"}),(0,r.jsx)($.l,(0,d.Z)((0,c.Z)({},ea),{label:"Cost category",name:"costCategorySelected",type:"costCategory"})),(0,r.jsx)(F.P,(0,d.Z)((0,c.Z)({},ea),{errors:(0,c.Z)({},v),name:"serviceSelected",label:"Service",type:"service"})),(0,r.jsx)(R.Z,(0,d.Z)((0,c.Z)({},ea),{label:"Customer",name:"amount",vat:"Ex VAT"})),(0,r.jsxs)(A.Z,{children:[(0,r.jsx)(E.Z,{sm:12,md:6,children:(0,r.jsx)(R.Z,(0,d.Z)((0,c.Z)({},ea),{label:"Supplier labour amount",name:"supplierLabourAmount",vat:"Ex VAT"}))}),(0,r.jsx)(E.Z,{sm:12,md:6,children:(0,r.jsx)(R.Z,(0,d.Z)((0,c.Z)({},ea),{label:"Supplier materials amount",name:"supplierMaterialsAmount",vat:"Ex VAT"}))})]}),(0,r.jsx)(z.Z,{sx:X,control:(0,r.jsx)(q.Qr,{name:"customerSignature",control:h,render:function(e){var t=e.onChange,n=e.value;return(0,r.jsx)(G.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:"Require customer signature"}),(0,r.jsx)(z.Z,{sx:X,control:(0,r.jsx)(q.Qr,{name:"supplierSignature",control:h,render:function(e){var t=e.onChange,n=e.value;return(0,r.jsx)(G.Z,{color:"secondary",checked:n,onChange:function(e){return t(e.target.checked)}})}}),label:"Require engineer signature"}),(0,r.jsx)("input",(0,c.Z)({type:"hidden"},y("tags")))]})};Y.propTypes={defaultValues:l.object,onSuccess:l.func.isRequired};var X={color:U.Q.COLOUR.dark,"& .MuiTypography-root":{fontFamily:"Arial,sans-serif,sans-serif"}},J=n(31113),K=n(55563),ee=n(95103),et=n(62047),en=n(58594),er=n(29005),ei=n(55843),eo=[{disabled:!0,text:"Please choose...",value:""},{text:"Checkbox",value:"checkbox",hasOptions:!0},{text:"CurrencyInput",value:"currencyInput",hasOptions:!1},{text:"Datepicker",value:"datepicker",hasOptions:!1},{text:"Input",value:"input",hasOptions:!1},{text:"Radio",value:"radio",hasOptions:!0},{text:"Select",value:"select",hasOptions:!0},{text:"Range(1 - 10)",value:"selectRange",hasOptions:!1},{text:"TextArea",value:"textArea",hasOptions:!1},{text:"Upload File",value:"media",hasOptions:!1}],ea=[{text:"Email",value:"email"},{text:"Number",value:"number"},{text:"Text",value:"text"}],es=function(e){var t=e.defaultOptions,n=(0,q.qo)({control:t.control,name:"input"}),i=n&&eo.find(function(e){return e.value===n}).hasOptions,a=(0,q.Dq)({control:t.control,name:"options"}),s=a.fields,l=a.append,u=a.remove;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w.Z,{label:"Label",children:(0,r.jsx)(K.Z,(0,d.Z)((0,c.Z)({},t),{name:"label"}))}),(0,r.jsx)(w.Z,{label:"Input",children:(0,r.jsx)(ee.Z,(0,d.Z)((0,c.Z)({},t),{name:"input",options:eo}))}),"input"===n&&(0,r.jsx)(w.Z,{label:"Type",children:(0,r.jsx)(ee.Z,(0,d.Z)((0,c.Z)({},t),{name:"inputType",options:ea}))}),i&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(A.Z,{children:[(0,r.jsx)(E.Z,{xs:4,md:4,children:(0,r.jsx)(w.Z,{label:"Options"})}),(0,r.jsx)(E.Z,{children:(0,r.jsx)(er.Z,{iconName:"plus",onClick:l})})]}),s.map(function(e,n){return(0,r.jsxs)(o.Fragment,{children:[(0,r.jsxs)(A.Z,{align:"center",children:[(0,r.jsx)(E.Z,{xs:5,md:5,children:(0,r.jsx)(K.Z,(0,d.Z)((0,c.Z)({},t),{defaultValue:e.label,name:"options[".concat(n,"].label"),placeholder:"Label"}))}),(0,r.jsx)(E.Z,{xs:5,md:5,children:(0,r.jsx)(K.Z,(0,d.Z)((0,c.Z)({},t),{defaultValue:e.value,name:"options[".concat(n,"].value"),placeholder:"Value"}))}),(0,r.jsx)(E.Z,{xs:2,md:2,children:(0,r.jsx)(er.Z,{iconName:"delete",onClick:function(){return u(n)}})})]}),(0,r.jsx)(ei.Z,{marginBottom:"md"})]},e.id)})]}),(0,r.jsx)(en.Z,(0,d.Z)((0,c.Z)({},t),{name:"required",data:[{label:"Required",value:!0}],stacked:!0}))]})};es.propTypes={defaultOptions:l.object};var el,eu=n(15897),ec=n(29815),ed=[{name:"acquisitionCost",meta:{input:"currencyInput",inputType:"number",label:"Acquisition cost",isSystem:!0,questionType:"tco",required:!0}},{name:"datePutInService",meta:{input:"datepicker",inputType:"text",label:"Date put in service",isSystem:!0,questionType:"tco",required:!0}},{name:"usefulLife",meta:{input:"input",inputType:"number",label:"Useful life (months)",isSystem:!0,questionType:"tco",required:!0}},{name:"maintenanceSpend",meta:{input:"currencyInput",inputType:"number",label:"Maintenance spend (\xa3 p/m)",isSystem:!0,questionType:"tco",required:!0}},{name:"residualValue",meta:{input:"currencyInput",inputType:"number",label:"Residual Value",isSystem:!0,questionType:"tco",required:!0}}],ep=[{name:"type",meta:{input:"select",inputType:"text",label:"Type",options:[{label:"Thermo",value:"thermo"},{label:"Occupancy",value:"occupancy"}],questionType:"sensor",isSystem:!0,required:!0}},{name:"brand",meta:{input:"select",inputType:"text",label:"Brand",options:[{label:"AirThings",value:"airthings"},{label:"Other",value:"other"}],questionType:"sensor",isSystem:!0,required:!0}}],em=(el=(0,C.Z)(function(e){var t,n,r,i,o,a,s,l,u;return(0,S.__generator)(this,function(o){switch(o.label){case 0:return t=e.addTaxonomy,n=e.adminId,r=e.hasSensorQuestions,i=e.hasTCOQuestions,l={status:"active",adminId:n,parentId:e.parentId,type:"assetQuestion"},u=[],i&&(a=u).push.apply(a,(0,ec.Z)(eg(ed,l))),r&&(s=u).push.apply(s,(0,ec.Z)(eg(ep,l))),[4,t({variables:{objects:(0,ec.Z)(u)}})];case 1:return o.sent(),[2]}})}),function(e){return el.apply(this,arguments)}),eg=function(e,t){return e.map(function(e){return e=(0,c.Z)({},e,t)})},ef=n(51233),eh=function(e){var t,n,i,a,s,l,u,p,g=e.defaultValues,f=e.entity,h=e.entityId,v=e.groups,x=e.hasSublocation,y=e.isAssetCategoryParent,b=e.onSuccess,Z=e.parentId,j=void 0===Z?null:Z,_=e.systemQuestions,k=(0,L.x)().user,R=(0,o.useState)(!1),A=R[0],E=R[1],F=g.type,$=(0,o.useState)(!1),O=$[0],G=$[1],z=(0,o.useState)(!1),N=z[0],V=z[1],H=(0,q.cI)({defaultValues:(0,d.Z)((0,c.Z)({},g),{input:null==g?void 0:null===(t=g.meta)||void 0===t?void 0:t.input,inputType:null==g?void 0:null===(n=g.meta)||void 0===n?void 0:n.inputType,sensor:(null==g?void 0:g.hasSensor)||!1,label:null==g?void 0:null===(i=g.meta)||void 0===i?void 0:i.label,options:null==g?void 0:null===(a=g.meta)||void 0===a?void 0:a.options,required:null==g?void 0:null===(s=g.meta)||void 0===s?void 0:s.required,customerSignature:null==g?void 0:null===(l=g.meta)||void 0===l?void 0:l.customerSignature,supplierSignature:null==g?void 0:null===(u=g.meta)||void 0===u?void 0:u.supplierSignature,sublocation:(null==g?void 0:null===(p=g.meta)||void 0===p?void 0:p.sublocation)||!1}),resolver:(0,D.S)(Q(F))}),B=H.control,U=H.errors,W=H.handleSubmit,Y=H.register,X=H.setValue,J=H.watch,er=J("sublocation");er="false"!==er&&Boolean(er);var ei=J("sensor");ei="false"!==ei&&Boolean(ei);var eo,ea=function(e,t){X(e,t),el()},el=function(){V(!1),G(!1)},ec=(0,I.Z)((0,T.D)(m.mW,{onCompleted:function(e){var t=e.insert_Taxonomy.returning[0],n=t.id,r=t.type;(A||ei)&&"assetQuestion"!==r?em({hasTCOQuestions:A,hasSensorQuestions:ei,addTaxonomy:ec,adminId:k.accountId,parentId:n}):b&&b(n)}}),1)[0],ed=(0,I.Z)((0,T.D)(m.ze,{onCompleted:function(e){var t=e.update_Taxonomy_by_pk,n=t.id,r=t.type;!_.sensor&&ei&&"assetQuestion"!==r?em({hasTCOQuestions:A,hasSensorQuestions:ei,addTaxonomy:ec,adminId:k.accountId,parentId:n}):b&&b(n)}}),1)[0],ep=(eo=(0,C.Z)(function(e){return(0,S.__generator)(this,function(t){switch(t.label){case 0:if(j&&(e.parentId=j),er&&ei)return[2,V(!0)];if(x&&er&&!g.id)return[2,G(!0)];if(y&&(e.isGroup=!0),e.entity=f,e.entityId=h,e.meta=(0,d.Z)((0,c.Z)({},(null==g?void 0:g.meta)||{}),{input:e.input,options:e.options,inputType:e.inputType,label:e.label,required:e.required,customerSignature:e.customerSignature,supplierSignature:e.supplierSignature,sublocation:e.sublocation}),delete e.input,delete e.inputType,delete e.sensor,delete e.label,delete e.options,delete e.required,delete e.sublocation,delete e.customerSignature,delete e.supplierSignature,e.adminId=k.accountId,!(null==g?void 0:g.id))return[3,2];return[4,ed({variables:{id:g.id,changes:e}})];case 1:return t.sent(),[3,4];case 2:return[4,ec({variables:{objects:[e]}})];case 3:t.sent(),t.label=4;case 4:return[2]}})}),function(e){return eo.apply(this,arguments)}),eg={control:B,errors:U,register:Y},eh=(0,d.Z)((0,c.Z)({},eg),{context:"secondary",size:"sm"});return(0,r.jsxs)(P.Z,{id:"offCanvasForm",handleSubmit:W(ep),children:["assetQuestion"!==F&&(0,r.jsx)(w.Z,{label:"Name",children:(0,r.jsx)(K.Z,(0,d.Z)((0,c.Z)({},eg),{name:"name"}))}),("assetQuestion"===F||"complianceQuestions"===F||"supplierQuestion"===F)&&(0,r.jsx)(es,{defaultOptions:eg}),(null==v?void 0:v.length)>0&&(0,r.jsx)(w.Z,{label:"Group",children:(0,r.jsx)(ee.Z,(0,d.Z)((0,c.Z)({},eg),{name:"parentId",options:v}))}),(0,r.jsx)(w.Z,{label:"Status",children:(0,r.jsx)(ee.Z,(0,d.Z)((0,c.Z)({},eg),{name:"status",options:eu.bg}))}),"assetCategory"===F&&!y&&!g.id&&(0,r.jsx)(w.Z,{label:"Total cost of ownership",children:(0,r.jsx)(et.Z,{context:"secondary",onToggle:function(e){return E(e)},size:"sm",toggled:A})}),"assetCategory"===F&&!y&&(0,r.jsx)(w.Z,{label:"Sensor",children:(0,r.jsx)(et.Z,{context:"secondary",disabled:_.sensor,onToggle:function(e){return ea("sensor",e)},size:"sm",toggled:ei})}),"assetCategory"===F&&!y&&(0,r.jsx)(w.Z,{label:"Sublocation",children:(0,r.jsx)(et.Z,(0,d.Z)((0,c.Z)({},eh),{onToggle:function(e){return ea("sublocation",e)},toggled:er}))}),"signatures"===F&&(0,r.jsxs)(ef.Z,{spacing:10,direction:"row",children:[(0,r.jsx)(en.Z,(0,d.Z)((0,c.Z)({},eg),{name:"customerSignature",data:[{label:"Customer",value:!0}],stacked:!0})),(0,r.jsx)(en.Z,(0,d.Z)((0,c.Z)({},eg),{name:"supplierSignature",data:[{label:"Supplier",value:!0}],stacked:!0}))]}),O&&(0,r.jsx)(M.Z,{content:"You can only create one sublocation",context:"warning"}),N&&(0,r.jsx)(M.Z,{content:"You can only select a sub-location or a sensor",context:"warning"}),"assetQuestion"===F&&(0,r.jsx)(K.Z,(0,d.Z)((0,c.Z)({},eg),{name:"name",type:"hidden"})),(0,r.jsx)(K.Z,(0,d.Z)((0,c.Z)({},eg),{name:"sensor",type:"hidden"})),"assetCategory"===F&&(0,r.jsx)(K.Z,(0,d.Z)((0,c.Z)({},eg),{name:"sublocation",type:"hidden"})),(0,r.jsx)(K.Z,(0,d.Z)((0,c.Z)({},eg),{name:"type",type:"hidden"}))]})};eh.propTypes={defaultValues:l.object,entity:l.string,entityId:l.number,hasSublocation:l.bool,isAssetCategoryParent:l.bool,onSuccess:l.func.isRequired,systemQuestions:l.object},eh.defaultProps={hasSublocation:!1,isAssetCategoryParent:!1,systemQuestions:{sensor:!1}};var ev=n(12632),ex=n(74492),ey={item:"name",order:"asc"},eb=function(e){var t=e.entity,n=e.entityId,i=e.refetchCompliance,o=e.parentId,a=e.type,s=(0,ex.a)(),l=(0,ev.x)({filters:{},initialSort:ey}),u=l.initialData,h=l.ref,v=(0,d.Z)((0,c.Z)({},u),{parentId:o}),x=(0,p.a)(m.Im,{variables:v}),y=x.data,b=void 0===y?{taxonomy:[],meta:{aggregate:{totalCount:0}}}:y,Z=b.taxonomy,C=b.meta,I=x.loading,S=x.refetch,T=function(){S(),i&&i(),s.close()},q=function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},l=(0,d.Z)((0,c.Z)({},i),{type:a});"assetQuestion"!==a||l.id||(l.name="assetQuestionField-".concat(Z.length)),s.show({title:i.id?"Edit":"Add",content:(0,r.jsx)(eh,{entity:t,entityId:n,defaultValues:l,onSuccess:T,groups:{},parentId:o})})},P=function(e){var t;return[{context:"secondary",disabled:null===(t=e.data.meta)||void 0===t?void 0:t.isSystem,icon:["fas","edit"],onClick:function(e,t){return q("edit",t.data)},tooltip:"Edit"}]},w=[{hidden:!0},{hidden:!0},{text:"Name",formatter:function(e){var t,n,r=e.row;return"assetQuestion"===a?null==r?void 0:null===(t=r.data)||void 0===t?void 0:null===(n=t.meta)||void 0===n?void 0:n.label:r.name}},{hidden:!0},{text:"Status"},{formatter:g.Z,formatterData:P,text:"Actions"}];return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.t,{columns:w,loading:I,meta:C,ref:h,refetch:S,rows:Z.map(function(e){return{data:e,id:e.id,name:e.name,status:e.status,statusText:(0,f.Z)(e.status),actions:""}})}),(0,r.jsx)(J.H,{content:"Add New",handleClick:q})]})};eb.propTypes={entity:l.string,entityId:l.number,refetchCompliance:l.func,type:l.string,parentId:l.number};var eZ=n(57779),ej=function(e){var t=e.entityId,n=(0,I.Z)((0,T.D)(m.ze),1)[0],i=function(e){n({variables:{id:t,changes:{meta:{imageLink:e[0].link}}}})};return(0,r.jsx)(eZ.G,{entity:"Taxonomy",entityId:t,type:"image",onMediaAdd:i,onlySingleMedia:!0})},eC=function(e){var t,n=e.filters,i=e.props,o={item:"id",order:"desc"},a=(0,ev.x)({filters:n,initialSort:o}),s=a.initialData,l=a.ref,u=(0,ex.a)(),y=(0,d.Z)((0,c.Z)({},s),{isGroup:i.isAssetCategoryParent,typeGroup:(t=i.type,"expenseCategory"===t?"expenseCategoryGroup":t),fetchGroup:"expenseCategory"===i.type||"assetCategory"===i.type}),C=(0,p.a)(m.Im,{variables:y}),I=C.data,S=void 0===I?{taxonomy:[],meta:{aggregate:{totalCount:0}}}:I,T=S.taxonomy,q=S.meta,P=S.taxonomyGroup,w=C.loading,_=C.refetch,k=function(){_(),u.close()},M=function(e,t){var n,o;e.stopPropagation(),t||(t={status:"active"}),t.type=i.type,u.show({content:(0,r.jsx)(eh,{defaultValues:t,onSuccess:k,isAssetCategoryParent:i.isAssetCategoryParent,groups:("expenseCategory"===i.type||Z(i.type,i.isAssetCategoryParent))&&P,hasSublocation:T.find(function(e){var t;return(null===(t=e.meta)||void 0===t?void 0:t.sublocation)===!0}),systemQuestions:{sensor:void 0!==T.find(function(e){var t;return null===(t=e.childs)||void 0===t?void 0:t.find(function(e){var t,n;return(null===(t=e.meta)||void 0===t?void 0:t.isSystem)&&(null===(n=e.meta)||void 0===n?void 0:n.questionType)==="sensor"})})}}),title:t.id?"Edit":"Add ".concat(i.title)})},R=function(e){u.show({content:(0,r.jsx)(eb,{type:"jobTags"===i.type?"jobQuestion":"assetQuestion",parentId:e.id}),submit:!1,title:"Questions"})},A=function(e){u.show({content:(0,r.jsx)(Y,{defaultValues:(0,d.Z)((0,c.Z)({},e.meta),{name:e.name}),groups:{},onSuccess:k,parentId:e.id}),title:e.name})},E=function(e){u.show({content:(0,r.jsx)(ej,{entityId:e.id}),title:e.name,submit:!1})},D=[{context:"secondary",icon:["fas","edit"],onClick:function(e,t){return M(e,t)},tooltip:"Edit"}];["jobTags","assetCategory"].includes(i.type)&&!i.isAssetCategoryParent&&D.push({context:"info",icon:["fas","question"],numberOverlay:"childCount",onClick:function(e,t){return R(t)},tooltip:"Manage Questions"}),"jobTags"===i.type&&D.push({context:"secondary",icon:["fas","info-circle"],numberOverlay:"hasDescription",onClick:function(e,t){return A(t)},tooltip:"Add Template"}),"issueType"===i.type&&D.push({context:"secondary",icon:["fas","info-circle"],numberOverlay:"hasDescription",onClick:function(e,t){return E(t)},tooltip:"Add issue type photo"});var F=[{hidden:!0},{hidden:!0},{text:"Name"},{hidden:"expenseCategory"!==i.type&&!Z(i.type,i.isAssetCategoryParent),text:"Group"},{hidden:"jobTags"!==i.type,text:"Jobs"},{hidden:!0},{hidden:"assetCategory"!==i.type||i.isAssetCategoryParent,text:"TCO"},{hidden:"assetCategory"!==i.type||i.isAssetCategoryParent,text:"Sensor"},{hidden:"assetCategory"!==i.type||i.isAssetCategoryParent,text:"Sublocation"},{text:"Status"},{hidden:"signatures"!==i.type,text:"Display for"},{hidden:!0},{hidden:!0,text:"meta"},{hidden:!0},{formatter:g.Z,formatterData:D,text:"Actions"}],$=function(){return(0,r.jsx)(h.Z,{children:(0,r.jsx)(v.Z,{context:"secondary",content:"Add New",onClick:M,size:"sm"})})};return(0,r.jsx)(x.Z,{handleClick:M,open:!0,title:i.title,toolbar:(0,r.jsx)($,{}),children:(0,r.jsx)(j.t,{columns:F,loading:w,meta:q,ref:l,initialSort:o,refetch:_,rows:T.map(function(e){var t,n,r,i,o,a,s,l,u,c,d=[];return((null===(t=e.meta)||void 0===t?void 0:t.customerSignature)||(null===(n=e.meta)||void 0===n?void 0:n.supplierSignature))&&((null===(s=e.meta)||void 0===s?void 0:s.customerSignature)&&d.push("Customer"),(null===(l=e.meta)||void 0===l?void 0:l.supplierSignature)&&d.push("Supplier")),{id:e.id,parentId:e.parentId,name:e.name,groupText:null===(r=e.parent)||void 0===r?void 0:r.name,jobs:e.jobs.aggregate.count,status:e.status,hasTCO:(u=null==e?void 0:e.childs).find(function(e){var t,n;return(null===(t=e.meta)||void 0===t?void 0:t.isSystem)&&(null===(n=e.meta)||void 0===n?void 0:n.questionType)==="tco"})&&b("TCO"),hasSensor:(c=null==e?void 0:e.childs).find(function(e){var t,n;return(null===(t=e.meta)||void 0===t?void 0:t.isSystem)&&(null===(n=e.meta)||void 0===n?void 0:n.questionType)==="sensor"})&&b("Sensor"),hasSublocation:(null===(i=e.meta)||void 0===i?void 0:i.sublocation)&&b("Sub-location"),statusText:(0,f.Z)(e.status),displayFor:d.length>0&&d.join(", "),childCount:null===(o=e.childs)||void 0===o?void 0:o.length,meta:e.meta,hasDescription:(null===(a=e.meta)||void 0===a?void 0:a.template)?"1":"",actions:""}})})})};eC.propTypes={filters:l.object};var eI=n(67101),eS=function(e){var t=e.control,n=e.errors,i=e.register,a=e.setFilters,s=e.props,l=e.watch,u={control:t,errors:n,register:i},p=l("parentId");return(0,o.useEffect)(function(){a(function(e){return(0,d.Z)((0,c.Z)({},e),{parentId:(null==p?void 0:p.value)||null,type:s.type})})},[p]),(0,r.jsxs)(A.Z,{align:"baseline",children:[(0,r.jsx)(E.Z,{md:6,children:(0,r.jsx)(eI.r,(0,d.Z)((0,c.Z)({},u),{onChange:function(e){return a(function(t){return(0,d.Z)((0,c.Z)({},t),{status:e.target.value||null,type:s.type})})},options:eu.bg}))}),"expenseCategory"===s.type&&(0,r.jsx)(E.Z,{md:6,children:(0,r.jsx)(F.P,(0,d.Z)((0,c.Z)({},u),{errors:(0,c.Z)({},n),label:"",name:"parentId",placeholder:"Group",type:"taxonomyGroup",isClearable:!0,taxonomyGroupType:"expenseCategoryGroup"}))})]})};eS.propTypes={control:l.object.isRequired,errors:l.object.isRequired,register:l.func.isRequired,setFilters:l.func.isRequired};var eT=function(e){var t={q:null,status:null,type:e.type||"",parentId:null,filterType:"taxonomy_table"};return(0,r.jsx)(u.J,{FiltersComp:eS,initialFilters:t,props:e,TableComp:eC})};eT.propTypes={type:(0,l.oneOf)(["assetCategory","complianceCategory","expenseCategory","costCategory","tags","supplierQuestion","signatures"])};var eq=n(53767),eP=n(11057),ew=n(87918),e_=n(90629),ek=n(29059),eM=n(24572),eR=n(25267),eA=n(71181),eE=n(7297),eD=n(75063);function eF(){var e=(0,eE.Z)(["\n  query GetCompliancesAdmin(\n    $where: Compliance_bool_exp\n    $order: [Compliance_order_by!]\n    $limit: Int\n    $offset: Int\n  ) {\n    compliances: Compliance(where: $where, limit: $limit, offset: $offset, order_by: $order) {\n      id\n      name\n      status\n      createdAt\n      updatedAt\n      complianceCategory: ComplianceCategory {\n        id\n        name\n      }\n    }\n    meta: Compliance_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return eF=function(){return e},e}var e$=(0,eD.Ps)(eF()),eO=n(90948),eG=n(52553),ez=n(50135),eN=n(19441),eV=n(84808),eH=n(98456),eQ=n(19512),eB=n(24341),eU=H.Ry({complianceCategory:H.Ry({label:H.Z_().required(),value:H.Rx().required()}).required("Compliance category is required"),name:H.Z_().required("Name is required").trim(),status:H.Z_().oneOf(Object.values(eB.b)).required()}),eL={name:"",status:eB.b.ACTIVE};function eW(){var e=(0,eE.Z)(["\n  query GetComplianceAdmin($id: Int!) {\n    compliance: Compliance_by_pk(id: $id) {\n      id\n      name\n      status\n\n      complianceCategory: ComplianceCategory {\n        id\n        name\n      }\n    }\n  }\n"]);return eW=function(){return e},e}var eY=(0,eD.Ps)(eW()),eX=n(461),eJ=n(73359),eK=n(182),e0=function(){var e=(0,o.useState)(""),t=e[0],n=e[1],r=(0,I.Z)((0,eJ.t)(eK.OZ,{variables:{q:""!==t?"%".concat(t,"%"):null}}),2),i=r[0],a=r[1],s=a.data,l=(void 0===s?{items:[]}:s).items;return{complianceCategory:{onSearchChange:function(e){return n(e)},onOpen:function(){return i()},loading:a.loading,options:l}}},e1=function(e){var t=e.compliance;return{complianceCategory:{label:t.complianceCategory.name,value:t.complianceCategory.id},name:t.name,status:t.status}},e2=function(e){var t,n=e.id,i=e.edit,o=void 0!==i&&i,a=e.close,s=e.refetchQueries,l=void 0===s?[]:s,u=(0,eQ.D)(),m=(0,q.cI)({defaultValues:(0,c.Z)({},eL),context:{edit:o},resolver:(0,D.S)(eU)}),g=(0,p.a)(eY,{skip:!n,variables:{id:n},onCompleted:function(e){var t=e1(e);m.reset(t)}}).loading,f=e0(),h=(0,I.Z)((0,T.D)(eX.z,{refetchQueries:l,onCompleted:function(){u.show({content:"Compliance was successfully created.",severity:"success"}),a&&a()},onError:function(e){u.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),v=h[0],x=h[1].loading,y=(0,I.Z)((0,T.D)(eX.V,{refetchQueries:l,onCompleted:function(){u.show({content:"Compliance was successfully updated.",severity:"success"}),a&&a()},onError:function(e){u.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),b=y[0],Z=y[1].loading,j=(t=(0,C.Z)(function(e){var t;return(0,S.__generator)(this,function(r){return t={id:n,name:e.name,status:e.status,complianceCategoryId:e.complianceCategory.value},o&&n?b({variables:{data:t}}):v({variables:{data:t}}),[2]})}),function(e){return t.apply(this,arguments)});return(0,r.jsxs)(e5,{id:"offCanvas-manage-compliance",onSubmit:m.handleSubmit(j),children:[(0,r.jsx)(eV.Z,{sx:{zIndex:1e5},open:g||x||Z,children:(0,r.jsx)(eH.Z,{color:"secondary"})}),(0,r.jsxs)(ef.Z,{spacing:3,children:[(0,r.jsx)(q.Qr,{name:"complianceCategory",control:m.control,defaultValue:null,render:function(e){var t,n=e.value,i=e.onChange;return(0,r.jsx)(eG.F,(0,d.Z)((0,c.Z)({freeSolo:!0,variant:"standard",color:"secondary",label:"Compliance category*",placeholder:"Compliance category",value:n||null,onChange:function(e,t){return i(t)}},f.complianceCategory),{error:!!m.errors.complianceCategory,helperText:null===(t=m.errors.complianceCategory)||void 0===t?void 0:t.message}))}}),(0,r.jsx)(q.Qr,{name:"name",control:m.control,render:function(e){var t,n=e.value,i=e.onChange;return(0,r.jsx)(ez.Z,{variant:"standard",color:"secondary",label:"Name*",placeholder:"Name",value:n,onChange:i,error:!!m.errors.name,helperText:null===(t=m.errors.name)||void 0===t?void 0:t.message})}}),(0,r.jsx)(q.Qr,{name:"status",control:m.control,render:function(e){var t,n=e.value,i=e.onChange;return(0,r.jsx)(eN.P,{fullWidth:!0,variant:"standard",color:"secondary",label:"Status*",placeholder:"Status",value:n,onChange:i,options:eR.UF,error:!!m.errors.status,helperText:null===(t=m.errors.status)||void 0===t?void 0:t.message})}})]})]})},e5=(0,eO.ZP)("form")(function(){return{}}),e6=n(11994),e9=n(15843),e4=n(93946),e3=n(36191),e7=H.Ry({search:H.Z_(),status:H.Z_().oneOf(Object.values(eB.b)).nullable()}),e8={search:"",status:null},te=function(e){var t=e.setFilters,n=e.onTableStateChange,i=(0,o.useState)(!1),a=i[0],s=i[1],l=(0,q.cI)({defaultValues:(0,c.Z)({},e8),resolver:(0,D.S)(e7)}),u=function(e){t({q:e.search,status:e.status}),n(function(e){return(0,d.Z)((0,c.Z)({},e),{currentPage:0})}),s(!1)},p=function(){l.reset(),t({}),s(!1)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eP.Z,{variant:"contained",startIcon:(0,r.jsx)(e9.Z,{}),onClick:function(){return s(!0)},children:"Filters"}),(0,r.jsx)(e6.Z,{keepMounted:!0,open:a,onClose:function(){return s(!1)},children:(0,r.jsx)(tt,{children:(0,r.jsxs)(tn,{onSubmit:l.handleSubmit(u),children:[(0,r.jsxs)(tr,{children:[(0,r.jsx)(V.Z,{variant:"h6",children:"Filters"}),(0,r.jsx)(e4.Z,{onClick:function(){return s(!1)},children:(0,r.jsx)(e3.Z,{})})]}),(0,r.jsxs)(ti,{spacing:2,children:[(0,r.jsx)(q.Qr,{name:"search",control:l.control,render:function(e){var t=e.value,n=e.onChange;return(0,r.jsx)(ez.Z,{fullWidth:!0,color:"secondary",variant:"standard",label:"Search",placeholder:"Search...",value:t,onChange:n})}}),(0,r.jsx)(ef.Z,{direction:"row",width:"100%",spacing:2,children:(0,r.jsx)(q.Qr,{name:"status",control:l.control,render:function(e){var t=e.value,n=e.onChange;return(0,r.jsx)(eN.P,{fullWidth:!0,label:"Status",placeholder:"Select status...",color:"secondary",variant:"standard",value:t,onChange:n,options:eR.UF})}})})]}),(0,r.jsxs)(to,{direction:"row",spacing:2,children:[(0,r.jsx)(eP.Z,{variant:"contained",color:"danger",onClick:p,children:"Clear"}),(0,r.jsx)(eP.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})]})},tt=(0,eO.ZP)(e_.Z)(function(){return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"700px",padding:"16px 27px 16px 27px",borderRadius:"8px"}}),tn=(0,eO.ZP)("form")(function(){return{}}),tr=(0,eO.ZP)(ef.Z)(function(){return{width:"100%",display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"}}),ti=(0,eO.ZP)(ef.Z)(function(){return{width:"100%"}}),to=(0,eO.ZP)(ef.Z)(function(){return{width:"100%",justifyContent:"flex-end",paddingTop:"16px"}}),ta=function(e){var t=e.q,n=e.complianceCategory,r=e.status,i={type:{_eq:"admin"}};return t&&(i.name={_ilike:"%".concat(t,"%")}),n&&(i.complianceCategoryId={_eq:n}),r&&(i.status={_eq:r}),{where:(0,c.Z)({},i)}},ts=function(){var e=(0,ex.a)(),t=(0,o.useState)({}),n=t[0],i=t[1],a=(0,eM.V)(),s=a.reference,l=a.order,u=a.pagination,m=(0,p.a)(e$,{variables:(0,c.Z)({order:l},u,ta((0,c.Z)({},n)))}),g=m.data,f=void 0===g?{compliances:[],meta:{aggregate:{totalCount:0}}}:g,h=f.compliances,v=f.meta.aggregate.totalCount,x=m.loading,y=(0,o.useCallback)(function(){e.show({content:(0,r.jsx)(e2,{close:e.close,refetchQueries:["GetCompliancesAdmin"]}),submit:!0,title:"Add compliance",submitForm:"offCanvas-manage-compliance"})},[e]),b=(0,o.useCallback)(function(t){e.show({content:(0,r.jsx)(e2,{edit:!0,id:t,close:e.close,refetchQueries:["GetCompliancesAdmin"]}),submit:!0,title:"Edit compliance",submitForm:"offCanvas-manage-compliance"})},[e]),Z=(0,o.useMemo)(function(){return[{minWidth:200,flex:1,sortable:!1,field:"id",headerName:"Item",renderCell:function(e){var t=e.row;return(0,r.jsx)(ef.Z,{direction:"row",alignItems:"center",children:(0,r.jsx)(V.Z,{children:t.name})})}},{minWidth:200,flex:1,sortable:!1,field:"category",headerName:"Category",renderCell:function(e){return e.row.complianceCategory.name}},{minWidth:100,flex:1,sortable:!1,field:"status",headerName:"Status",renderCell:function(e){var t=e.row;return(0,r.jsx)(ew.Z,{label:"".concat(t.status.charAt(0).toLocaleUpperCase()).concat(t.status.substring(1)),color:eR.gz[t.status]})}},{minWidth:100,flex:1,sortable:!1,field:"action",headerName:"Action",renderCell:function(e){var t=e.row;return(0,r.jsx)(eA.C,{actions:[{icon:"edit",tooltip:"Edit",onClick:function(){b(t.id)}}]})}}]},[b]);return(0,r.jsxs)(e_.Z,{sx:{height:"calc(100vh - 280px)"},children:[(0,r.jsxs)(ef.Z,{direction:"row",justifyContent:"space-between",pl:2,pr:2,pt:2,pb:2,children:[(0,r.jsx)(te,(0,d.Z)((0,c.Z)({},s),{setFilters:i})),(0,r.jsx)(ef.Z,{direction:"row",spacing:2,children:(0,r.jsx)(eP.Z,{variant:"contained",color:"success",onClick:y,children:"Add compliance"})})]}),(0,r.jsx)(ek.i,(0,d.Z)((0,c.Z)({},s),{loading:x,columns:Z,rows:h,totalCount:v,autoHeight:!1,containerHeight:"calc(100% - 120px)"}))]})},tl=n(5616),tu=n(86574),tc=n(86858),td=n(83336),tp=function(){var e=(0,o.useState)("primary"),t=e[0],n=e[1],i=function(e,t){n(t)};return(0,r.jsxs)(tl.Z,{children:[(0,r.jsxs)(td.m,{value:t,onChange:i,"aria-label":"basic tabs example",textColor:"black.main",children:[(0,r.jsx)(tu.O,{label:"Primary",value:"primary"}),(0,r.jsx)(tu.O,{label:"Secondary",value:"secondary"})]}),(0,r.jsx)(tc.x,{value:t,index:"primary",boxSx:{padding:"16px 0px 0px 0px"},children:(0,r.jsx)(eT,{type:"complianceCategory",title:"Compliance Categories"})}),(0,r.jsx)(tc.x,{value:t,index:"secondary",boxSx:{padding:"16px 0px 0px 0px"},children:(0,r.jsx)(ts,{})})]})},tm=function(){var e,t,n=(0,a.useRouter)().query,i=(0,eq.q)(),l=null==i?void 0:null===(e=i.admin)||void 0===e?void 0:null===(t=e.modules)||void 0===t?void 0:t.assets,u=(0,o.useMemo)(function(){return n.tab||"expense-categories"},[n.tab]),c=[(0,r.jsx)("div",{active:"expense-categories"===u,label:"Expense Categories",children:(0,r.jsx)(eT,{type:"expenseCategory",title:"Expense Categories"})}),(0,r.jsx)("div",{active:"cost-categories"===u,label:"Cost Categories",children:(0,r.jsx)(eT,{type:"costCategory",title:"Cost Categories"})}),(0,r.jsx)("div",{active:"job-templates-and-questions"===u,label:"Job templates and questions",children:(0,r.jsx)(eT,{type:"jobTags",title:"Job Descriptions"})}),(0,r.jsx)("div",{active:"supplier-questions"===u,label:"Supplier Questions",children:(0,r.jsx)(eT,{type:"supplierQuestion",title:"Supplier Questions"})}),(0,r.jsx)("div",{hide:!l,active:"asset-categories"===u,label:"Asset Categories",children:(0,r.jsxs)(s.Z,{handleChange:!1,children:[(0,r.jsx)("div",{active:!0,label:"Asset Categories Parent",children:(0,r.jsx)(eT,{type:"assetCategory",title:"Asset Categories Parent",isAssetCategoryParent:!0})}),(0,r.jsx)("div",{label:"Asset Categories Child",children:(0,r.jsx)(eT,{type:"assetCategory",title:"Asset Categories Child"})})]})}),(0,r.jsx)("div",{active:"compliance-categories"===u,label:"Compliance Categories",children:(0,r.jsx)(tp,{})}),(0,r.jsx)("div",{active:"client-type"===u,label:"Client Type",children:(0,r.jsx)(eT,{type:"clientType",title:"Client Type"})}),(0,r.jsx)("div",{active:"tags"===u,label:"Tags",children:(0,r.jsx)(eT,{type:"tags",title:"Tags"})}),(0,r.jsx)("div",{active:"job-hold-reason"===u,label:"Job Hold Reason",children:(0,r.jsx)(eT,{type:"jobHoldReason",title:"Job Hold Reason"})}),(0,r.jsx)("div",{active:"signatures"===u,label:"Signatures",children:(0,r.jsx)(eT,{type:"signatures",title:"Signatures"})}),(0,r.jsx)("div",{active:"issue-types"===u,label:"Issue Types",children:(0,r.jsx)(eT,{type:"issueType",title:"Issue types"})})];return(0,r.jsx)(s.Z,{children:c.filter(function(e){return!e.props.hide}).map(function(e){return e})},u)},tg=function(){return(0,r.jsx)(i.Z,{pageHeading:{heading:"Categories"},View:(0,r.jsx)(tm,{})})}}},function(e){e.O(0,[3662,2283,212,8890,9511,2583,6310,4599,4135,7645,3776,1564,2329,778,3054,1023,1417,6540,3425,1870,5037,1352,4043,5497,9313,3704,1121,7823,6557,8395,9774,2888,179],function(){return e(e.s=52418)}),_N_E=e.O()}]);