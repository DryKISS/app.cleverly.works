(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5868],{90646:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/media",function(){return n(47082)}])},19512:function(e,t,n){"use strict";n.d(t,{D:function(){return o}});var i=n(67294),r=n(21925),o=function(){var e=(0,i.useContext)(r.S);if(!e)throw Error("useSnackbarContext must be used within the SnackbarProvider");return e}},67101:function(e,t,n){"use strict";n.d(t,{r:function(){return a}});var i=n(85893),r=n(45697),o=n(95103),a=function(e){var t=e.errors,n=e.name,r=e.onChange,a=e.options,s=e.register;return(0,i.jsx)(o.Z,{errors:t,name:n,onChange:r,options:a,register:s})};a.propTypes={errors:r.object.isRequired,name:r.string,onChange:r.func,options:r.array.isRequired,register:r.func.isRequired},a.defaultProps={name:"status"}},97637:function(e,t,n){"use strict";n.d(t,{G:function(){return z}});var i=n(26042),r=n(69396),o=n(7297),a=n(85893),s=n(67294),c=n(45697),u=n(6812),l=n(92711),d=n(10367),m=n(78289),f=n(41564),p=n(34953),h=n(62466),g=n(68956),y=n(73373),v=n(11585),x=n(18678),w=n(55377),b=n(16551),j=n(77439),Z=n(74297),C=n(11013),S=n(3770),I=n(452),_=n(71072),k=n(87336),F=n(12632),P=n(74944);function q(){var e=(0,o.Z)(["\n  width: 24px;\n"]);return q=function(){return e},e}function A(){var e=(0,o.Z)(["\n  border: 1px solid #eee;\n"]);return A=function(){return e},e}var z=function(e){var t=e.carousel,n=e.category,o=e.children,c=e.data,d=(e.details,e.entity),q=e.entityId,A=e.filters,z=(e.limit,e.listView),U=e.mediaMeta,N=e.onMediaAdd,E=e.onMediaRemove,M=(e.pagination,e.showActionButtons),V=e.showEntityColumn,D=e.showItemActions,O=e.summary,$=e.type,H=(0,F.x)({filters:A}),X=H.initialData,B=H.ref,J=(0,P.x)(),G=J.hasRole,L=J.user,Q=(0,s.useContext)(m.Z),W=(0,u.a)(l.t,{variables:(0,r.Z)((0,i.Z)({},X),{entity:d,entityId:q,category:n,adminId:L.adminId,meta:U})}),K=W.data,Y=void 0===K?{items:[],meta:{aggregate:{totalCount:0}}}:K,ee=Y.items,et=Y.meta,en=W.loading,ei=W.refetch,er=function(e){Q.close(),c.length||ei(),N&&N(e)},eo=function(e){Q.close(),c.length||ei(),E&&E(e)},ea=function(e){e.stopPropagation(),Q.show({content:(0,a.jsx)(I.z,{accept:"image/*",adminId:L.adminId,category:n,entity:d,entityId:q,expiryShow:!1,mediaMeta:U,multiple:!0,onSuccess:er,type:"image"}),title:"Upload Photos"})},es=function(e){e.stopPropagation(),Q.show({content:(0,a.jsx)(I.z,{accept:".pdf, .doc, .docx, .xlsx",adminId:L.adminId,category:n,entity:d,entityId:q,expiryShow:!1,mediaMeta:U,onSuccess:er,type:"document"}),title:"Upload Documents"})},ec=function(e){Q.show({content:(0,a.jsx)(C.d,{mediaId:e.data.id,onSuccess:eo}),submit:!1,title:"Delete Media"})},eu=function(e){Q.show({content:(0,a.jsx)(S.z,{media:e.data,toggleShow:Q.close}),submit:!1,title:"Media Details",width:"50%"})},el=[{context:"primary",icon:["fas","info-circle"],onClick:function(e,t){return eu(t)},tooltip:"Details"}];G("admin")&&el.push({context:"danger",icon:["fas","trash"],onClick:function(e,t){return ec(t)},tooltip:"Delete"});var ed=[{hidden:!0},{hidden:!0},{hidden:!0,text:"Caption"},{hidden:!1,text:"File"},{hidden:!V,text:"Entity"},{formatter:function(e){var t,n=e.row;return(0,a.jsx)(T,{children:(null==n?void 0:null===(t=n.authority)||void 0===t?void 0:t.adminOnly)&&(0,a.jsx)(f.Z,{content:"Admin user only",children:(0,a.jsx)(p.Z,{alt:"Admin Only",src:"/messaging/admin-only.svg"})})})},text:"",tooltip:"Only Admin can see"},{formatter:(0,h.Z)("/dashboard/users/view","userId","uploaded"),text:"Uploaded by"},{hidden:!z,text:"Thumbnails"},{hidden:!D,formatter:g.Z,formatterData:el,text:"Actions"}],em=function(e,t){e.preventDefault(),window.open("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(t))},ef=[],ep=ee.map(function(e){var t=e.entity,n=e.entityId,i=e.id,r=e.item,o=r.caption,s=r.filename,c=r.meta,u=r.name,l=r.type,d=r.user;return{data:r,id:i,userId:null==d?void 0:d.id,file:function(){return(0,a.jsx)(y.Z,{onClick:function(e){return em(e,s)},children:o||u||s})},entity:t&&"".concat(t,"#").concat(n),authority:c,uploaded:"".concat(null==d?void 0:d.nameFirst," ").concat(null==d?void 0:d.nameLast),thumbnails:(0,_.S)(l,c),actions:""}}),eh=(ee.forEach(function(e){var t=e.item,n=t.caption,i=t.filename;"image"===t.type&&ef.push({caption:n,filename:i})}),ef),eg=eh.length;return(0,a.jsxs)(v.Z,{fitParentHeight:!0,open:!0,title:O,children:[o,t&&eg>0&&(0,a.jsx)(R,{children:(0,a.jsx)(x.Z,{fullWidth:!0,height:"200px",numberOfItems:1,showNavs:!1,showPagination:!0,slides:eh.map(function(e){var t=e.caption,n=e.filename;return{node:(0,a.jsx)(p.Z,{alt:t,src:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n)}),text:" "}})})}),(0,a.jsx)(k.t,{columns:ed,loading:en,fullHeight:!0,paginationSize:!1,meta:et,ref:B,refetch:ei,rows:ep}),M&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(w.Z,{size:"sm"}),(0,a.jsxs)(b.Z,{align:"flex-end",children:[(!$||"document"===$)&&!G("supplier")&&(0,a.jsx)(j.Z,{content:"Add Document",context:"secondary",onClick:es,size:"sm"}),(!$||"image"===$||"avatar"===$)&&!G("supplier")&&(0,a.jsx)(j.Z,{content:"Add ".concat((0,Z.Z)($||"Image")),context:"secondary",onClick:ea,size:"sm"})]})]})]})},T=d.ZP.div.withConfig({displayName:"table__StyledIcon",componentId:"sc-fc77535-0"})(q()),R=d.ZP.div.withConfig({displayName:"table__StyledCarousel",componentId:"sc-fc77535-1"})(A());z.propTypes={carousel:c.bool,category:c.string,children:c.node,data:c.array,details:c.bool,entity:c.string,entityId:c.number,filters:c.object,limit:c.number,listView:c.bool,mediaMeta:c.object,onMediaAdd:c.func,onMediaRemove:c.func,pagination:c.object,showActionButtons:c.bool,showEntityColumn:c.bool,showItemActions:c.bool,summary:c.string,type:c.string},z.defaultProps={carousel:!0,category:null,data:[],details:!1,filters:{},limit:20,listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,summary:"Media",type:null}},87336:function(e,t,n){"use strict";n.d(t,{t:function(){return u}});var i=n(85893),r=n(67294),o=n(45697),a=n(11163),s=n(98209),c=n(16540),u=(0,r.forwardRef)(function(e,t){var n=e.columns,o=e.history,u=e.initialSort,l=e.loading,d=e.meta,m=e.paginationSize,f=e.refetch,p=e.rowClick,h=e.rows,g=e.xeroPageSize,y=(0,a.useRouter)(),v=y.query,x=void 0===v?{}:v,w=(0,r.useState)(parseInt(null==x?void 0:x.page,10)||1),b=w[0],j=w[1],Z=(0,r.useState)(g||s.C1.paginationSize),C=Z[0],S=Z[1];u||(u={item:"createdAt",order:"desc"});var I=(0,r.useState)({item:u.item,order:u.order}),_=I[0],k=I[1],F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=y.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var i=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(i)},P=function(){k({item:u.item,order:u.order}),j(1);var e=F();y.push(e),S(g||s.C1.paginationSize)};(0,r.useImperativeHandle)(t,function(){return{currentPage:b,pageSize:C,sort:_,resetPagination:function(){P()}}});var q=function(e){var t=F(e);o&&y.push(t),j(e),!o&&f&&f()},A=function(e){e!==s.C1.paginationSize&&(S(e),f&&f())},z=function(e){var t;k({item:e.item,order:e.order}),f&&f()};return(0,i.jsx)(c.Z,{columns:n,loading:l,paginationSize:m,pagination:d&&!0,paginationProps:d&&{currentPage:b,onPageChange:q,onPageSizeChange:A,pageCount:Math.ceil(d.aggregate.totalCount/C),perPage:C},rowClick:p,rows:h,sort:_,setSort:z})});u.propTypes={columns:o.array.isRequired,history:o.bool,initialSort:o.object,loading:o.bool,meta:o.object,refetch:o.func,rowClick:o.func,rows:o.array.isRequired},u.defaultProps={history:!0,loading:!0,paginationSize:!1}},45307:function(e,t,n){"use strict";n.d(t,{X:function(){return p}});var i=n(14924),r=n(82670),o=n(828),a=n(7297),s=n(67294),c=n(6812),u=n(50319),l=n(75063),d=n(53767);function m(){var e=(0,a.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]);return m=function(){return e},e}function f(){var e=(0,a.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"]);return f=function(){return e},e}function p(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",a=(0,d.q)().user,l=(0,s.useState)(function(){try{switch(n){case"network":case"state":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||t}}catch(i){return t}}),m=l[0],f=l[1],p=function(t){try{var o=(0,r.Z)(t,Function)?t(m):t;switch(f(o),n){case"network":y({variables:{accountUserId:null==a?void 0:a.accountUserId,filters:(0,i.Z)({},e,o)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(o))}}catch(s){}};(0,c.a)(h,{variables:{accountUserId:null==a?void 0:a.accountUserId},skip:"network"!==n,onCompleted:function(n){var i=n.accountUser;i&&f(i.filters[e]||t)}});var y=(0,o.Z)((0,u.D)(g),1)[0];return[m,p]}var h=(0,l.Ps)(m()),g=(0,l.Ps)(f())},66267:function(e,t,n){"use strict";n.d(t,{J:function(){return j}});var i=n(26042),r=n(69396),o=n(99534),a=n(828),s=n(85893),c=n(11163),u=n(67294),l=n(45697),d=n(9270),m=n(62140),f=n(42283),p=n(76600),h=n(11585),g=n(49501),y=n(75903),v=n(77439),x=n(31113),w=n(45307),b=function(e){var t=e.initialValues,n=e.renderFilters,o=e.setFilters,c=e.lastQuery,l=e.filters,b=(0,a.Z)((0,w.X)("form_data_".concat(t.filterType),t),2),j=b[0],Z=b[1],C=(0,f.cI)({defaultValues:j||t}),S=C.control,I=C.errors,_=C.handleSubmit,k=C.register,F=C.reset,P=C.watch,q=C.setValue,A=P(),z=(0,r.Z)((0,i.Z)({},A),{filterType:t.filterType});(0,u.useEffect)(function(){F(z)},[F]),(0,u.useEffect)(function(){Z(z)},[l]);var T=function(e){var n=e.query;if(n!==c){var r={q:"%".concat(n,"%")||0},a=/^\d+$/.test(n);"id"in t&&(r.id=a?Number(n):null),"meta"in t&&(r.meta=a?{invoiceNumbers:[n]}:null),"jobNumber"in t&&(r.jobNumber=a?String(n):null,r.invoiceNumber=a?Number(n):null),o(function(e){return(0,i.Z)({},e,r)})}},R=function(e){Object.keys(t).map(function(e){return q(e,null)}),o(t),F(t),T("")};return(0,s.jsx)(p.Z,{handleSubmit:_(T),children:(0,s.jsxs)(h.Z,{title:"Filters",children:[(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(m.Z,{sm:12,lg:12,children:(0,s.jsx)(g.Z,{label:"",children:(0,s.jsx)(y.Z,{errors:I,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:k,type:"search"})})}),(0,s.jsx)(m.Z,{sm:12,lg:12,children:n({control:S,errors:I,initialValues:t,register:k,setFilters:o,watch:P,setValue:q,reset:F})})]}),(0,s.jsx)(x.H,{content:"Search",context:"secondary",handleClick:T,type:"submit",children:(0,s.jsx)(v.Z,{content:"Clear",context:"danger",onClick:R,size:"sm"})})]})})};b.propTypes={initialValues:l.object,renderFilters:l.func.isRequired,setFilters:l.func.isRequired};var j=function(e){var t=e.FiltersComp,n=e.initialFilters,l=e.TableComp,f=(0,o.Z)(e,["FiltersComp","initialFilters","TableComp"]),p=(0,a.Z)((0,w.X)("form_data_".concat(n.filterType),n),2),h=p[0],g=p[1],y=(0,u.useState)(h||n),v=y[0],x=y[1],j=(0,c.useRouter)().query.show;return(0,u.useEffect)(function(){g(v)},[v,g]),(0,s.jsx)(d.Z,{children:(0,s.jsxs)(m.Z,{sm:12,lg:12,children:[(0,s.jsx)(b,{initialValues:n,renderFilters:function(e){return(0,s.jsx)(t,(0,r.Z)((0,i.Z)({},e,f),{show:j}))},setFilters:x,filters:v}),(0,s.jsx)(l,(0,i.Z)({filters:v,initialFilters:n},f))]})})};j.propTypes={FiltersComp:l.func,initialFilters:l.object.isRequired,TableComp:l.func}},47082:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return y}});var i=n(85893),r=n(19076),o=n(66267),a=n(97637),s=n(26042),c=n(69396),u=n(45697),l=n(67101),d=[{text:"Type",value:""},{text:"Document",value:"document"},{text:"Image",value:"image"},{text:"Video",value:"video"}],m=n(9270),f=n(62140),p=function(e){e.control;var t=e.errors,n=e.register,r=e.setFilters;return(0,i.jsx)(m.Z,{children:(0,i.jsx)(f.Z,{md:6,children:(0,i.jsx)(l.r,{errors:t,name:"type",onChange:function(e){return r(function(t){return(0,c.Z)((0,s.Z)({},t),{type:e.target.value||null})})},options:d,register:n})})})};p.propTypes={control:u.object.isRequired,errors:u.object.isRequired,register:u.func.isRequired,setFilters:u.func.isRequired};var h={q:null,type:null,filterType:"media_table"},g=function(){return(0,i.jsx)(o.J,{carousel:!1,details:!0,listView:!0,showActionButtons:!1,showEntityColumn:!0,FiltersComp:p,initialFilters:h,TableComp:a.G})},y=function(){return(0,i.jsx)(r.Z,{pageHeading:{heading:"Media"},View:(0,i.jsx)(g,{})})}}},function(e){e.O(0,[3662,2283,212,8890,9511,2583,6310,4599,7645,3776,1564,3054,1417,6540,5037,1352,1207,7876,6557,9774,2888,179],function(){return e(e.s=90646)}),_N_E=e.O()}]);