(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5503],{31932:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/issues/manage",function(){return t(81515)}])},62547:function(e,n,t){"use strict";t.d(n,{V:function(){return C}});var i=t(26042),r=t(69396),o=t(29815),a=t(85893),s=t(45697),l=t.n(s),u=t(93946),d=t(51233),c=t(15861),m=t(21023),p=t(96540),v=t(67294),f=t(83162),h=t(42283),g=t(79665),x=t(11057),Z=t(50135),y=t(77957),b=t(41733),j=t(16310),I=j.Ry({name:j.Z_().required(),url:j.Z_().url().required()}),S=x.Z,w=function(e){var n=e.noEdit,t=e.noDelete,o=e.onDelete,s=e.id,l=e.isAdded,c=e.url,p=e.name,x=e.onSave,j=(0,v.useState)(l),w=j[0],q=j[1],C=(0,h.cI)({resolver:(0,g.S)(I)}),D=C.control,_=C.handleSubmit,A=C.errors,T=function(e){e.stopPropagation(),q(!0)},R=function(e){e.stopPropagation(),q(!1),p&&c||o()},E=function(e){x(e),q(!1)};return(0,a.jsx)("form",{children:w?(0,a.jsxs)(d.Z,{children:[(0,a.jsxs)(d.Z,{spacing:1,children:[(0,a.jsx)(h.Qr,{control:D,name:"name",defaultValue:p,render:function(e){var n;return(0,a.jsx)(Z.Z,(0,r.Z)((0,i.Z)({fullWidth:!0,label:"Name",variant:"standard",color:"secondary"},e),{error:A.name,helperText:null===(n=A.name)||void 0===n?void 0:n.message}))}}),(0,a.jsx)(h.Qr,{control:D,name:"url",defaultValue:c,render:function(e){var n;return(0,a.jsx)(Z.Z,(0,r.Z)((0,i.Z)({fullWidth:!0,label:"Link",variant:"standard",color:"secondary"},e),{error:A.url,helperText:null===(n=A.url)||void 0===n?void 0:n.message}))}})]}),(0,a.jsxs)(d.Z,{direction:"row",justifyContent:"flex-end",spacing:1,mt:2,children:[(0,a.jsx)(S,{variant:"contained",color:"danger",size:"small",onClick:R,children:"Cancel"}),(0,a.jsx)(S,{variant:"contained",size:"small",onClick:_(E),children:"Save"})]})]}):(0,a.jsxs)(d.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,a.jsx)(f.r,{target:"_blank",variant:"body1",color:"secondary",href:c,sx:{textDecoration:"auto",fontWeight:700},children:p}),!n&&(0,a.jsx)(m.Z,{title:"Edit",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:T,children:(0,a.jsx)(y.Z,{sx:{fontSize:"16px"}})})}),!t&&(0,a.jsx)(m.Z,{title:"Delete",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:function(){return o(s)},children:(0,a.jsx)(b.Z,{sx:{fontSize:"16px"}})})})]})})};w.defaultProps={isAdded:!1,noEdit:!1,noDelete:!1,url:"",name:"",onSave:function(){},onCancel:function(){},onDelete:function(){}},w.propTypes={isAdded:l().bool,noEdit:l().bool,noDelete:l().bool,url:l().string,name:l().string,onSave:l().func,onCancel:l().func,onDelete:l().func};var q=t(74944),C=function(e){var n=e.values,t=e.setValue,s=e.name,l=e.title,f=e.displayMode,h=e.noDeleteEdit,g=e.titleSx,x=(0,v.useState)([]),Z=x[0],y=x[1],b=(0,(0,q.x)().hasRole)("tenant");(0,v.useEffect)(function(){Array.isArray(n)&&y(n)},[n]);var j=function(e){e.stopPropagation(),y(function(e){return(0,o.Z)(e).concat([{name:"",link:"",isAdded:!0}])})},I=function(e,n){var i=(0,o.Z)(Z);i.splice(e,1,n),t(s,i)};return(0,a.jsxs)(d.Z,{children:[(0,a.jsxs)(d.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,a.jsxs)(c.Z,{sx:g,children:[l,":"]}),!f&&!b&&(0,a.jsx)(m.Z,{title:"Add new link",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:j,children:(0,a.jsx)(p.Z,{})})})]}),(0,a.jsx)(d.Z,{pl:2,spacing:.8,children:(null==Z?void 0:Z.length)?Z.map(function(e,o){var l;return(0,a.jsx)(w,(0,r.Z)((0,i.Z)({index:o},e),{noEdit:h||f,noDelete:h||f,onDelete:function(){var e=n.filter(function(e,n){return n!==o});t(s,e),y(e)},onSave:function(e){return I(o,e)}}))}):(0,a.jsx)(c.Z,{typography:"subtitle2",children:"No data"})})]})};C.defaultProps={values:[],setValue:function(){},title:"Related links",displayMode:!1,noDeleteEdit:!1,titleSx:{}},C.propTypes={values:l().arrayOf(l().shape({isAdded:l().bool,noEdit:l().bool,url:l().string,name:l().string})),titleSx:l().object,setValue:l().func,noDeleteEdit:l().bool}},16951:function(e,n,t){"use strict";t.d(n,{k:function(){return y}});var i=t(26042),r=t(69396),o=t(85893),a=t(45697),s=t(42283),l=t(79665),u=t(76600),d=t(9270),c=t(62140),m=t(49501),p=t(55563),v=t(6710),f=t(95103),h=t(16310),g=(0,h.Ry)().shape({name:(0,h.Z_)(),invoicingEntity:(0,h.Z_)(),addressLine1:(0,h.Z_)().required(),addressLine2:(0,h.Z_)(),addressLine3:(0,h.Z_)(),city:(0,h.Z_)().required(),postCode:(0,h.Z_)().matches("^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9][A-Za-z]?))))\\s?[0-9][A-Za-z]{2})$|^([AC-FHKNPRTV-Y]\\d{2}|D6W)\\s[0-9AC-FHKNPRTV-Y]{4}$").required(),county:(0,h.Z_)(),countryId:(0,h.Z_)().required()}),x=t(31113),Z=t(98521),y=function(e){var n=e.defaultValues,t=e.onSubmit,a=e.type,h=(0,s.cI)({defaultValues:(0,i.Z)({},n),resolver:(0,l.S)(g)}),y=h.control,b=h.errors,j=h.handleSubmit,I={control:y,errors:b,register:h.register};return(0,o.jsxs)(u.Z,{id:"offCanvasForm",handleSubmit:j(t),children:[(0,o.jsxs)(d.Z,{children:[(0,o.jsx)(c.Z,{md:12,children:(0,o.jsx)(m.Z,{label:"Address name",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},I),{name:"name"}))})}),"invoice"===a&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(c.Z,{md:12,children:(0,o.jsx)(m.Z,{label:"invoicing email",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},I),{name:"invoicingEmail",type:"email"}))})}),(0,o.jsx)(c.Z,{md:12,children:(0,o.jsx)(m.Z,{label:"Invoicing entity",children:(0,o.jsx)(v.Z,(0,r.Z)((0,i.Z)({},I),{name:"invoicingEntity",rows:4}))})})]}),(0,o.jsx)(c.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Address Line 1",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},I),{name:"addressLine1"}))})}),(0,o.jsx)(c.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Address Line 2",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},I),{name:"addressLine2"}))})}),(0,o.jsx)(c.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Address Line 3",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},I),{name:"addressLine3"}))})}),(0,o.jsx)(c.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"City",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},I),{name:"city"}))})}),(0,o.jsx)(c.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Post Code",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},I),{name:"postCode"}))})}),(0,o.jsx)(c.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"County",children:(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},I),{name:"county"}))})}),(0,o.jsx)(c.Z,{md:6,children:(0,o.jsx)(m.Z,{label:"Country",children:(0,o.jsx)(f.Z,(0,r.Z)((0,i.Z)({},I),{name:"countryId",options:Z.O}))})})]}),(0,o.jsx)(d.Z,{justify:"end",children:(0,o.jsx)(c.Z,{md:12,children:(0,o.jsx)(x.H,{content:"Submit",type:"submit"})})}),(null==n?void 0:n.id)&&(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},I),{name:"id",type:"hidden"})),(null==n?void 0:n.meta)&&(0,o.jsx)(p.Z,(0,r.Z)((0,i.Z)({},I),{name:"meta",type:"hidden"}))]})};y.propTypes={defaultValues:a.object,onCancel:a.func.isRequired,onSubmit:a.func.isRequired,type:a.string}},53600:function(e,n,t){"use strict";t.d(n,{E:function(){return i}});var i=function(e,n){if(Array.isArray(n)){var t,i=null;return n.forEach(function(n){var t,r=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});i=(null==r?void 0:r.createdAt)||i}),i}var r=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});return(null==r?void 0:r.createdAt)||null}},64732:function(e,n,t){"use strict";t.d(n,{n:function(){return v}});var i=t(26042),r=t(69396),o=t(85893),a=t(45697),s=t(11585),l=t(90951),u=t(28497),d=t(15214),c=t(9270),m=t(62140),p=t(99988),v=function(e){var n=e.errors,t=e.register,a=e.pricingWatch,v=e.hasServiceRate,f=e.isPPM,h={register:t,errors:n},g=p.Hu.filter(function(e){var n=e.value;return!f||"fixed"===n});return(0,o.jsxs)(s.Z,{dataSet:{"data-cy":"pricing"},open:!0,title:"Pricing",children:[(0,o.jsx)(l.Z,(0,r.Z)((0,i.Z)({},h),{data:g,legend:"Pricing",name:"pricing"})),"time-materials"===a&&(0,o.jsx)(u.Z,(0,r.Z)((0,i.Z)({},h),{label:"Spend Threshold",name:"customerSpendThreshold",vat:"Ex VAT"})),"fixed"===a&&(0,o.jsxs)(o.Fragment,{children:[v?(0,o.jsx)(d.Z,{content:"This customer has a service rate on their account. //@ts-ignore The customer amounts will be calculated using the relevant service rates.",context:"info"}):(0,o.jsx)(u.Z,(0,r.Z)((0,i.Z)({},h),{label:"Customer",name:"amount",vat:"Ex VAT"})),(0,o.jsxs)(c.Z,{children:[(0,o.jsx)(m.Z,{sm:12,md:6,children:(0,o.jsx)(u.Z,(0,r.Z)((0,i.Z)({},h),{label:"Supplier labour amount",name:"supplierLabourAmount",vat:"Ex VAT"}))}),(0,o.jsx)(m.Z,{sm:12,md:6,children:(0,o.jsx)(u.Z,(0,r.Z)((0,i.Z)({},h),{label:"Supplier materials amount",name:"supplierMaterialsAmount",vat:"Ex VAT"}))})]})]})]})};v.propTypes={errors:a.object.isRequired,pricingWatch:a.string,register:a.func.isRequired,hasServiceRate:a.bool,isPPM:a.bool}},79772:function(e,n,t){"use strict";t.d(n,{t:function(){return d}});var i=t(26042),r=t(69396),o=t(85893),a=t(45697),s=t(11585),l=t(536),u=t(20390),d=function(e){var n=e.control,t=e.errors,a={control:n,errors:t,register:e.register};return(0,o.jsxs)(s.Z,{dataSet:{"data-cy":"taxonomy"},open:!0,title:"Service",children:[(0,o.jsx)(u.l,(0,r.Z)((0,i.Z)({},a),{label:"Cost category",name:"costCategorySelected",type:"costCategory"})),(0,o.jsx)(l.P,(0,r.Z)((0,i.Z)({},a),{errors:(0,i.Z)({},t),name:"serviceSelected",label:"Service",type:"service"}))]})};d.propTypes={control:a.object.isRequired,errors:a.object.isRequired,register:a.func.isRequired}},72790:function(e,n,t){"use strict";t.d(n,{X:function(){return C}});var i=t(82670),r=t(26042),o=t(69396),a=t(85893),s=t(67294),l=t(45697),u=t(11585),d=t(49501),c=t(95103),m=t(90951),p=t(9270),v=t(62140),f=t(58594),h=t(40552),g=t(99988),x=[{text:"Select...",value:""},{text:"Today",value:"today"},{text:"This week",value:"thisWeek"},{text:"This month",value:"thisMonth"},{text:"Next Three month",value:"nextThreeMonth"}],Z=t(4135),y=t(43703),b=t(11640),j=t(83894),I=t(69119),S=t(67090),w=function(){var e=(0,Z.Z)(new Date),n=(0,y.Z)(new Date),t=(0,Z.Z)((0,b.Z)(new Date(n),2)),i=(0,j.Z)(new Date),r=(0,I.Z)(new Date),o=(0,S.Z)(new Date);return{monthEnd:e,nextThreeEnd:t,todayEnd:i,todayStart:r,weekEnd:o}},q=g.KB,C=function(e){var n=e.control,t=e.errors,l=e.hasRole,Z=e.query,y=e.register,b=e.setValue,j=e.timingWatch,I=e.watch,S={control:n,errors:t,register:y},C=l("customer")&&!l("admin"),D=I("pricing"),_=I("timingStart"),A=I("timingEnd"),T=I("multipleDays"),R=I("timeSpan"),E=I("timing");(0,s.useEffect)(function(){C&&(q=g.KB.filter(function(e){return"at"!==e.value}),b("timing","between")),R&&P({time:R,setValue:b})},[R]),(0,s.useEffect)(function(){"at"===E&&b("timeSpan","")},[E]);var P=function(e){var n,t,i=e.time,r=e.setValue,o=w(),a=o.monthEnd,s=o.todayStart,l=o.weekEnd,u=o.todayEnd,d=o.nextThreeEnd;switch(i){case"today":n=s,t=u;break;case"thisWeek":n=s,t=l;break;case"thisMonth":n=s,t=a;break;case"nextThreeMonth":n=s,t=d}r("timing","between"),r("timingStart",n),r("timingEnd",t)},k=function(e){var n=new Date,t=new Date(e);return n.getTime()<t.getTime()},M=function(e){var n=_?new Date(_):new Date,t=new Date(e);return n.getTime()<t.getTime()};return(0,a.jsxs)(u.Z,{dataSet:{"data-cy":"timing"},open:!0,title:"Timing",children:[!(null==Z?void 0:Z.id)&&b&&(0,a.jsx)(d.Z,{label:"Select Time span",children:(0,a.jsx)(c.Z,(0,o.Z)((0,r.Z)({},S),{name:"timeSpan",options:x}))}),(0,a.jsx)(m.Z,(0,o.Z)((0,r.Z)({},S),{data:q,legend:"Timing",name:"timing"})),(0,a.jsxs)(p.Z,{children:[(0,a.jsxs)(v.Z,{md:12,children:[(0,a.jsx)(d.Z,{label:"Start time"}),(0,a.jsx)(h.M,(0,o.Z)((0,r.Z)({},S),{dateFormat:"d MMM yyyy HH:mm",maxDate:A?new Date(A):null,minDate:new Date,filterTime:k,name:"timingStart",placeholder:"Click to select Start time",showTimeSelect:!0,todayButton:!1}))]}),"at"!==j&&(0,a.jsxs)(v.Z,{md:12,children:[(0,a.jsx)(d.Z,{label:"End time"}),(0,a.jsx)(h.M,(0,o.Z)((0,r.Z)({},S),{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,minDate:_?new Date(_):new Date,filterTime:M,name:"timingEnd",showTimeSelect:!0,todayButton:!1}))]})]}),(0,i.Z)(_,Date)&&"fixed"===D&&(0,a.jsx)(f.Z,(0,o.Z)((0,r.Z)({},S),{data:[{id:"multipleDays",label:"Multiple days"}],name:"multipleDays"})),T&&(0,a.jsx)(d.Z,{label:"End Date",children:(0,a.jsx)(h.M,(0,o.Z)((0,r.Z)({},S),{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!0,filterTime:M,minDate:_?new Date(_):new Date,name:"endDate",showTimeSelect:!0,todayButton:!1}))}),l("admin")&&(0,a.jsx)(f.Z,(0,o.Z)((0,r.Z)({},S),{data:[{id:"allowTimingNormalHours",label:"Allow premium rates to be used",value:"allowTimingNormalHours"}],name:"allowTimingNormalHours"}))]})};C.propTypes={control:l.object.isRequired,errors:l.object.isRequired,query:l.object.isRequired,register:l.func.isRequired,setValue:l.func,timingWatch:l.string}},20725:function(e,n,t){"use strict";t.d(n,{H_:function(){return g},aL:function(){return v},pf:function(){return f},sW:function(){return y},wd:function(){return h},xY:function(){return x},yT:function(){return Z}});var i=t(7297),r=t(75063),o=t(22666);function a(){var e=(0,i.Z)(["\n  fragment JobFields on Job {\n    access\n    issueReportedDescription\n    adminId\n    costCategory\n    createdAt\n    description\n    id\n    meta\n    pricing\n    reference\n    scheduledAt\n    status\n    supplierLabourAmount\n    supplierMaterialsAmount\n    timing\n    timingEnd\n    timingNormalHours\n    timingStart\n    title\n    type\n    siteVisitStart\n    siteVisitEnd\n    siteVisitWeekends\n    amount\n    number\n    quoted\n    timingStatus\n    correctDuration\n    correctStart\n    correctEnd\n  }\n"]);return a=function(){return e},e}function s(){var e=(0,i.Z)(["\n  fragment JobQuoteFields on Job {\n    quoted\n    quoteNumber\n    quoteDue\n    quoteDueSupplier\n    quoteCharge\n  }\n"]);return s=function(){return e},e}function l(){var e=(0,i.Z)(["\n  fragment JobAdminFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]);return l=function(){return e},e}function u(){var e=(0,i.Z)(["\n  fragment JobSupplierFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]);return u=function(){return e},e}function d(){var e=(0,i.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n    $_append: Job_append_input = {}\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes, _append: $_append) {\n      id\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return d=function(){return e},e}function c(){var e=(0,i.Z)(["\n  mutation InsertJobTiming($timing: [JobTiming_insert_input!]!) {\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return c=function(){return e},e}function m(){var e=(0,i.Z)(['\n  query GetJobHistory(\n    $jobId: Int\n    $locationId: Int!\n    $limit: Int\n    $offset: Int\n    $serviceId: Int\n    $startDate: timestamptz!\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      id\n      title\n      status\n      scheduledAt\n      createdAt\n      meta\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return m=function(){return e},e}function p(){var e=(0,i.Z)(['\n  query GetJobOffCanvas($jobId: Int!) {\n    job: Job_by_pk(id: $jobId) {\n      access\n      costCategory\n      customerSpendThreshold\n      description\n      supplierLabourAmount\n      supplierMaterialsAmount\n      quoteDue\n      quoteNumber\n      id\n      number\n      meta\n      paymentMethod\n      reference\n      status\n      title\n      type\n      quoted\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n      }\n      quotations: SupplierQuotes {\n        id\n        quoteNumber\n        status\n        lineItems: SupplierQuoteLineItems {\n          id\n          description\n          item\n          qty\n          qtyUnit\n          quoteId\n          total\n          type\n          unitRate\n          supplierTotal\n        }\n        supplier: Supplier {\n          id\n          type\n          name\n          accountUsers: Account_Users {\n            user: User {\n              id\n              fullName\n              nameFirst\n              nameLast\n              phone\n              email\n              devices: UserDevices(where: { status: { _eq: "active" } }) {\n                id\n                playerId\n              }\n            }\n          }\n        }\n      }\n      admin: Admin {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      customer: Customer {\n        id\n        name\n        website\n        slas: SLAs(where: { entity: { _eq: "Account" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        nameFirst\n        nameLast\n        fullName\n        email\n        phone\n      }\n      supplier: Supplier {\n        id\n        name\n        contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n          id\n          role\n          position\n          isContact\n          lastSignInAt\n          userId\n          user: User {\n            id\n            fullName\n            nameFirst\n            nameLast\n            email\n            phone\n          }\n        }\n      }\n      supplierUser: SupplierUser {\n        id\n        fullName\n        nameFirst\n        nameLast\n        email\n        phone\n      }\n      location: Location {\n        id\n        name\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      costCategoryTaxonomy: CostCategory {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n  ',"\n  ","\n"]);return p=function(){return e},e}var v=(0,r.Ps)(a()),f=(0,r.Ps)(s()),h=(0,r.Ps)(l()),g=(0,r.Ps)(u()),x=(0,r.Ps)(d()),Z=(0,r.Ps)(c()),y=(0,r.Ps)(m());(0,r.Ps)(p(),o.WW,o.MR)},76011:function(e,n,t){"use strict";t.d(n,{f:function(){return D}});var i=t(26042),r=t(69396),o=t(29815),a=t(85893),s=t(67294),l=t(15861),u=t(93946),d=t(51233),c=t(21023),m=t(96540),p=t(45697),v=t.n(p),f=t(79665),h=t(50135),g=t(11057),x=t(90948),Z=t(42283),y=t(41733),b=t(83372),j=t(16310),I=j.Ry().shape({caption:j.Z_()}),S=g.Z,w=(0,x.ZP)(l.Z)({backgroundColor:b.Q.COLOUR.secondary,color:b.Q.COLOUR.white,textAlign:"center",minWidth:"64px",borderRadius:"4px",margin:"10px 0",padding:"4px 10px",boxShadow:"0px 3px 1px -2px rgba(0,0,0,0.2),\n    0px 2px 2px 0px rgba(0,0,0,0.14),\n    0px 1px 5px 0px rgba(0,0,0,0.12)"}),q=(0,x.ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),C=function(e){var n,t=e.noDelete,o=e.onDelete,m=e.isAdded,p=e.media,v=e.caption,g=e.onSave,x=(0,s.useState)(null),j=x[0],C=x[1],D=(0,s.useState)(""),_=D[0],A=D[1],T=(0,s.useState)(m),R=T[0],E=T[1],P=(0,Z.cI)({resolver:(0,f.S)(I)}),k=P.register,M=P.errors,V=P.handleSubmit,$=P.reset,L=function(e){e.stopPropagation(),C(null),$()},U=function(e){e.stopPropagation(),E(!1),o()},F=function(e){j&&(g((0,r.Z)((0,i.Z)({},e),{media:j,type:_})),E(!1))},N=(0,s.useCallback)(function(e){return function(n){n.stopPropagation();var t=n.target.files[0];A(e),C(t)}},[C]);return(0,a.jsx)("form",{children:R?(0,a.jsx)(d.Z,{children:(0,a.jsxs)(d.Z,{rowGap:2,children:[(0,a.jsx)(h.Z,{fullWidth:!0,label:"Caption",variant:"standard",color:"secondary",name:"caption",inputRef:k,error:M.name,helperText:null===(n=M.name)||void 0===n?void 0:n.message}),j?(0,a.jsxs)(d.Z,{rowGap:3,children:[(0,a.jsxs)(d.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(l.Z,{sx:{color:b.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:j.name}),(0,a.jsx)(c.Z,{title:"Delete",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:L,children:(0,a.jsx)(y.Z,{})})})]}),(0,a.jsxs)(d.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,a.jsx)(S,{variant:"contained",color:"danger",size:"small",onClick:U,children:"Cancel"}),(0,a.jsx)(S,{variant:"contained",size:"small",onClick:V(F),children:"Save"})]})]}):(0,a.jsxs)(d.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,a.jsxs)(w,{component:"label",children:["Add image\xa0",(0,a.jsx)(q,{onChange:N("image"),type:"file",accept:"image/*, .heic"})]}),(0,a.jsxs)(w,{component:"label",children:["Add document\xa0",(0,a.jsx)(q,{onChange:N("document"),type:"file",accept:".pdf, .doc, .docx, .xlsx",multiple:!0})]})]})]})}):(0,a.jsxs)(d.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:1,children:[(0,a.jsx)(l.Z,{sx:{color:b.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:v||(null==p?void 0:p.name)||"No caption"}),!t&&(0,a.jsx)(c.Z,{title:"Delete",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:o,children:(0,a.jsx)(y.Z,{sx:{fontSize:"16px"}})})})]})})};C.propTypes={noDelete:v().func,onDelete:v().func,isAdded:v().bool,media:v().object,onSave:v().func};var D=function(e){var n=e.values,t=e.setValue,p=e.name,v=void 0===p?"attachments":p,f=e.title,h=void 0===f?"Attachments":f,g=e.titleSx,x=e.onDeleteExistingMedia,Z=(0,s.useState)([]),y=Z[0],b=Z[1];(0,s.useEffect)(function(){Array.isArray(n)&&b(n)},[n]);var j=function(e){e.stopPropagation(),b(function(e){return(0,o.Z)(e).concat([{mediaId:null,caption:"",media:null,type:"",isAdded:!0}])})},I=function(e,n){var i=(0,o.Z)(y);i.splice(e,1,n),t(v,i)};return(0,a.jsxs)(d.Z,{children:[(0,a.jsxs)(d.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,a.jsx)(l.Z,{sx:void 0===g?{}:g,children:h?h+":":""}),(0,a.jsx)(c.Z,{title:"Add new attachment",placement:"top-start",children:(0,a.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:j,children:(0,a.jsx)(m.Z,{})})})]}),(0,a.jsx)(d.Z,{pl:2,spacing:.8,children:(null==y?void 0:y.length)?y.map(function(e,n){var o;return(0,a.jsx)(C,(0,r.Z)((0,i.Z)({},e),{onDelete:function(){x&&(null===(e=y[n])||void 0===e?void 0:e.mediaId)&&x(y[n].mediaId);var e,i=y.filter(function(e,t){return t!==n});t(v,i),b(i)},onSave:function(e){return I(n,e)}}),e.caption+n)}):(0,a.jsx)(l.Z,{typography:"subtitle2",children:"No data"})})]})}},97637:function(e,n,t){"use strict";t.d(n,{G:function(){return E}});var i=t(26042),r=t(69396),o=t(7297),a=t(85893),s=t(67294),l=t(45697),u=t(6812),d=t(92711),c=t(10367),m=t(78289),p=t(41564),v=t(34953),f=t(62466),h=t(68956),g=t(73373),x=t(11585),Z=t(18678),y=t(55377),b=t(16551),j=t(77439),I=t(74297),S=t(11013),w=t(3770),q=t(452),C=t(71072),D=t(87336),_=t(12632),A=t(74944);function T(){var e=(0,o.Z)(["\n  width: 24px;\n"]);return T=function(){return e},e}function R(){var e=(0,o.Z)(["\n  border: 1px solid #eee;\n"]);return R=function(){return e},e}var E=function(e){var n=e.carousel,t=e.category,o=e.children,l=e.data,c=(e.details,e.entity),T=e.entityId,R=e.filters,E=(e.limit,e.listView),M=e.mediaMeta,V=e.onMediaAdd,$=e.onMediaRemove,L=(e.pagination,e.showActionButtons),U=e.showEntityColumn,F=e.showItemActions,N=e.summary,W=e.type,z=(0,_.x)({filters:R}),O=z.initialData,J=z.ref,H=(0,A.x)(),Q=H.hasRole,B=H.user,G=(0,s.useContext)(m.Z),X=(0,u.a)(d.t,{variables:(0,r.Z)((0,i.Z)({},O),{entity:c,entityId:T,category:t,adminId:B.adminId,meta:M})}),Y=X.data,K=void 0===Y?{items:[],meta:{aggregate:{totalCount:0}}}:Y,ee=K.items,en=K.meta,et=X.loading,ei=X.refetch,er=function(e){G.close(),l.length||ei(),V&&V(e)},eo=function(e){G.close(),l.length||ei(),$&&$(e)},ea=function(e){e.stopPropagation(),G.show({content:(0,a.jsx)(q.z,{accept:"image/*",adminId:B.adminId,category:t,entity:c,entityId:T,expiryShow:!1,mediaMeta:M,multiple:!0,onSuccess:er,type:"image"}),title:"Upload Photos"})},es=function(e){e.stopPropagation(),G.show({content:(0,a.jsx)(q.z,{accept:".pdf, .doc, .docx, .xlsx",adminId:B.adminId,category:t,entity:c,entityId:T,expiryShow:!1,mediaMeta:M,onSuccess:er,type:"document"}),title:"Upload Documents"})},el=function(e){G.show({content:(0,a.jsx)(S.d,{mediaId:e.data.id,onSuccess:eo}),submit:!1,title:"Delete Media"})},eu=function(e){G.show({content:(0,a.jsx)(w.z,{media:e.data,toggleShow:G.close}),submit:!1,title:"Media Details",width:"50%"})},ed=[{context:"primary",icon:["fas","info-circle"],onClick:function(e,n){return eu(n)},tooltip:"Details"}];Q("admin")&&ed.push({context:"danger",icon:["fas","trash"],onClick:function(e,n){return el(n)},tooltip:"Delete"});var ec=[{hidden:!0},{hidden:!0},{hidden:!0,text:"Caption"},{hidden:!1,text:"File"},{hidden:!U,text:"Entity"},{formatter:function(e){var n,t=e.row;return(0,a.jsx)(P,{children:(null==t?void 0:null===(n=t.authority)||void 0===n?void 0:n.adminOnly)&&(0,a.jsx)(p.Z,{content:"Admin user only",children:(0,a.jsx)(v.Z,{alt:"Admin Only",src:"/messaging/admin-only.svg"})})})},text:"",tooltip:"Only Admin can see"},{formatter:(0,f.Z)("/dashboard/users/view","userId","uploaded"),text:"Uploaded by"},{hidden:!E,text:"Thumbnails"},{hidden:!F,formatter:h.Z,formatterData:ed,text:"Actions"}],em=function(e,n){e.preventDefault(),window.open("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n))},ep=[],ev=ee.map(function(e){var n=e.entity,t=e.entityId,i=e.id,r=e.item,o=r.caption,s=r.filename,l=r.meta,u=r.name,d=r.type,c=r.user;return{data:r,id:i,userId:null==c?void 0:c.id,file:function(){return(0,a.jsx)(g.Z,{onClick:function(e){return em(e,s)},children:o||u||s})},entity:n&&"".concat(n,"#").concat(t),authority:l,uploaded:"".concat(null==c?void 0:c.nameFirst," ").concat(null==c?void 0:c.nameLast),thumbnails:(0,C.S)(d,l),actions:""}}),ef=(ee.forEach(function(e){var n=e.item,t=n.caption,i=n.filename;"image"===n.type&&ep.push({caption:t,filename:i})}),ep),eh=ef.length;return(0,a.jsxs)(x.Z,{fitParentHeight:!0,open:!0,title:N,children:[o,n&&eh>0&&(0,a.jsx)(k,{children:(0,a.jsx)(Z.Z,{fullWidth:!0,height:"200px",numberOfItems:1,showNavs:!1,showPagination:!0,slides:ef.map(function(e){var n=e.caption,t=e.filename;return{node:(0,a.jsx)(v.Z,{alt:n,src:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(t)}),text:" "}})})}),(0,a.jsx)(D.t,{columns:ec,loading:et,fullHeight:!0,paginationSize:!1,meta:en,ref:J,refetch:ei,rows:ev}),L&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(y.Z,{size:"sm"}),(0,a.jsxs)(b.Z,{align:"flex-end",children:[(!W||"document"===W)&&!Q("supplier")&&(0,a.jsx)(j.Z,{content:"Add Document",context:"secondary",onClick:es,size:"sm"}),(!W||"image"===W||"avatar"===W)&&!Q("supplier")&&(0,a.jsx)(j.Z,{content:"Add ".concat((0,I.Z)(W||"Image")),context:"secondary",onClick:ea,size:"sm"})]})]})]})},P=c.ZP.div.withConfig({displayName:"table__StyledIcon",componentId:"sc-fc77535-0"})(T()),k=c.ZP.div.withConfig({displayName:"table__StyledCarousel",componentId:"sc-fc77535-1"})(R());E.propTypes={carousel:l.bool,category:l.string,children:l.node,data:l.array,details:l.bool,entity:l.string,entityId:l.number,filters:l.object,limit:l.number,listView:l.bool,mediaMeta:l.object,onMediaAdd:l.func,onMediaRemove:l.func,pagination:l.object,showActionButtons:l.bool,showEntityColumn:l.bool,showItemActions:l.bool,summary:l.string,type:l.string},E.defaultProps={carousel:!0,category:null,data:[],details:!1,filters:{},limit:20,listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,summary:"Media",type:null}},87336:function(e,n,t){"use strict";t.d(n,{t:function(){return u}});var i=t(85893),r=t(67294),o=t(45697),a=t(11163),s=t(98209),l=t(16540),u=(0,r.forwardRef)(function(e,n){var t=e.columns,o=e.history,u=e.initialSort,d=e.loading,c=e.meta,m=e.paginationSize,p=e.refetch,v=e.rowClick,f=e.rows,h=e.xeroPageSize,g=(0,a.useRouter)(),x=g.query,Z=void 0===x?{}:x,y=(0,r.useState)(parseInt(null==Z?void 0:Z.page,10)||1),b=y[0],j=y[1],I=(0,r.useState)(h||s.C1.paginationSize),S=I[0],w=I[1];u||(u={item:"createdAt",order:"desc"});var q=(0,r.useState)({item:u.item,order:u.order}),C=q[0],D=q[1],_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=g.query,t=void 0===n?{}:n;if(e>1?t.page=e:delete t.page,!(Object.keys(t).length>0))return{};var i=Object.keys(t).map(function(n){return"page"===n?"".concat(n,"=").concat(e):"".concat(n,"=").concat(t[n])}).join("&");return"?".concat(i)},A=function(){D({item:u.item,order:u.order}),j(1);var e=_();g.push(e),w(h||s.C1.paginationSize)};(0,r.useImperativeHandle)(n,function(){return{currentPage:b,pageSize:S,sort:C,resetPagination:function(){A()}}});var T=function(e){var n=_(e);o&&g.push(n),j(e),!o&&p&&p()},R=function(e){e!==s.C1.paginationSize&&(w(e),p&&p())},E=function(e){var n;D({item:e.item,order:e.order}),p&&p()};return(0,i.jsx)(l.Z,{columns:t,loading:d,paginationSize:m,pagination:c&&!0,paginationProps:c&&{currentPage:b,onPageChange:T,onPageSizeChange:R,pageCount:Math.ceil(c.aggregate.totalCount/S),perPage:S},rowClick:v,rows:f,sort:C,setSort:E})});u.propTypes={columns:o.array.isRequired,history:o.bool,initialSort:o.object,loading:o.bool,meta:o.object,refetch:o.func,rowClick:o.func,rows:o.array.isRequired},u.defaultProps={history:!0,loading:!0,paginationSize:!1}},22428:function(e,n,t){"use strict";t.d(n,{T:function(){return Z}});var i=t(85893),r=t(45697),o=t.n(r),a=t(93946),s=t(97212),l=t(98619),u=t(59334),d=t(51233),c=t(50135),m=t(50594),p=t(40055),v=t(21830),f=t(10166),h=t(67294),g=t(42283),x=a.Z,Z=function(e){var n=e.tagEntityId,t=e.tagId,r=e.name,o=e.color,a=e.editable,u=e.onDelete,f=e.onColorChange,Z=e.onNameChange,b=(0,g.cI)({defaultValues:{name:r,color:o}}),j=b.register,I=b.handleSubmit,S=(0,h.useState)(null),w=S[0],q=S[1],C=function(){return[{icon:"delete",onClick:function(e){e.stopPropagation(),u(n)},tooltip:"Remove"},{icon:"edit",onClick:function(e){e.stopPropagation(),q("rename")},tooltip:"Rename"},{icon:"visibility",onClick:function(e){e.stopPropagation(),q("changeColor")},tooltip:"Change color"}]},D=function(e){e.stopPropagation(),q(null)},_=function(e){f({tagId:t,color:e.color}),q(null)},A=function(e){Z({tagId:t,name:e.name}),q(null)};return(0,i.jsx)(s.ZP,{disablePadding:!0,secondaryAction:!a||!w&&(0,i.jsx)(v.C,{icon:"defaultHoriz",actionsData:C}),children:w?({changeColor:function(){return(0,i.jsxs)(d.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,i.jsx)("input",{name:"color",ref:j,type:"color",style:{padding:0,border:"none","background-color":"unset"}}),(0,i.jsxs)(d.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(x,{size:"small",color:"danger",onClick:D,children:(0,i.jsx)(m.Z,{})}),(0,i.jsx)(x,{size:"small",color:"success",onClick:I(_),children:(0,i.jsx)(p.Z,{})})]})]})},rename:function(){return(0,i.jsxs)(d.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",pl:"16px",pr:"16px",children:[(0,i.jsx)(c.Z,{name:"name",inputRef:j,variant:"standard",color:"secondary"}),(0,i.jsxs)(d.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(x,{size:"small",color:"danger",onClick:D,children:(0,i.jsx)(m.Z,{})}),(0,i.jsx)(x,{size:"small",color:"success",onClick:I(A),children:(0,i.jsx)(p.Z,{})})]})]})}})[w]():(0,i.jsx)(l.Z,{children:(0,i.jsx)(y,{primary:r,color:o})})},t)};Z.defaultProps={onDelete:function(){},onColorChange:function(){},onNameChange:function(){},editable:!0},Z.propTypes={tagEntityId:o().string.isRequired,tagId:o().string.isRequired,name:o().string.isRequired,color:o().string.isRequired,editable:o().bool,onDelete:o().func.isRequired,onColorChange:o().func.isRequired,onNameChange:o().func.isRequired};var y=(0,f.Z)(u.Z)(function(e){return e.theme,{"&.MuiListItemText-root .MuiListItemText-primary":{fontWeight:700,color:e.color}}})},71403:function(e,n,t){"use strict";t.d(n,{P:function(){return p}});var i=t(85893),r=t(67294),o=t(45697),a=t.n(o),s=t(15861),l=t(14564),u=t(78462),d=t(51233),c=t(74833),m=t(22428),p=function(e){var n=e.tags,t=e.handleDeleteTagEntity,o=(0,r.useState)(null),a=o[0],p=o[1],v=null==n?void 0:n.slice(0,5),f=(null==n?void 0:n.length)-(null==v?void 0:v.length),h=Boolean(a);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,{direction:"row",spacing:1,children:v.map(function(e,n){var r;return(0,i.jsx)(c.V,{tagEntityId:e.id||n,name:e.tag.name,color:null===(r=e.tag.meta)||void 0===r?void 0:r.color,onDelete:t})})}),f>0&&(0,i.jsxs)(s.Z,{fontWeight:700,ml:1,onMouseEnter:function(e){p(e.currentTarget),e.stopPropagation()},children:["+",f]}),(0,i.jsx)(l.ZP,{id:h?"tags-in-table-popover":void 0,open:h,anchorEl:a,onClose:function(){return p(null)},anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,i.jsx)(u.Z,{children:null==n?void 0:n.map(function(e){var n;return(0,i.jsx)(m.T,{tagEntityId:e.id,tagId:e.tag.id,name:e.tag.name,color:null===(n=e.tag.meta)||void 0===n?void 0:n.color,editable:!1},e.tag.id)})})})]})};p.propTypes={tags:a().object,title:a().string},p.defaultProps={tags:{},displayOnly:!1,refetchQueries:[],handleDeleteTagEntity:function(){}}},42074:function(e,n,t){"use strict";t.d(n,{n:function(){return P}});var i=t(47568),r=t(26042),o=t(69396),a=t(828),s=t(29815),l=t(97582),u=t(85893),d=t(45697),c=t.n(d),m=t(96486),p=t(6812),v=t(50319),f=t(11961),h=t(93362),g=t(23776),x=t(5616),Z=t(98456),y=t(93946),b=t(78462),j=t(18972),I=t(14564),S=t(51233),w=t(50135),q=t(67294),C=t(10166),D=t(74944),_=t(22428),A=t(16380),T=t(71403),R=y.Z,E=(0,h.D)(),P=function(e){var n=e.entityId,t=e.entity,d=e.values,c=void 0===d?[]:d,h=e.name,y=void 0===h?"tags":h,I=e.setValue,C=(0,D.x)().user,P=(0,q.useState)(null),M=P[0],V=P[1],$=(0,q.useState)(""),L=$[0],U=$[1],F=(0,q.useState)(""),N=F[0],W=F[1],z=(0,q.useState)(""),O=z[0],J=z[1],H=(0,p.a)(A.BU,{skip:!n,variables:{entityId:n,entity:t},onCompleted:function(e){I(y,e.tags)}}),Q=H.data,B=(void 0===Q?{tags:[]}:Q).tags,G=H.loading,X=H.refetch,Y=(0,p.a)(A.gI,{skip:!M,variables:{entityId:n,entity:t,q:""!==O?"%".concat(O,"%"):null}}),K=Y.data,ee=(void 0===K?{tags:[]}:K).tags,en=Y.loading,et=(0,a.Z)((0,v.D)(A.Zm,{refetchQueries:["GetAllTags"]}),2),ei=et[0],er=et[1].loading,eo=(0,a.Z)((0,v.D)(A.LE,{onCompleted:function(){X()}}),2),ea=eo[0],es=eo[1].loading,el=(0,a.Z)((0,v.D)(A.cS,{onCompleted:function(){X()}}),2),eu=el[0],ed=el[1].loading,ec=(0,a.Z)((0,v.D)(A.g$,{refetchQueries:["GetAllTags"]}),2),em=ec[0],ep=ec[1].loading;(0,q.useEffect)(function(){var e=setTimeout(function(){J(N)},500);return function(){return clearTimeout(e)}},[N]);var ev,ef,eh,eg=function(e){e.stopPropagation(),V(e.currentTarget)},ex=function(){V(null)},eZ=(ev=(0,i.Z)(function(e,i){var r,o,a;return(0,l.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof i)return[3,1];return U({label:i}),[3,6];case 1:if(!(i&&i.inputValue&&n))return[3,2];return ea({variables:{objects:[{entity:t,entityId:n,Taxonomy:{data:{type:"tags",status:"active",name:i.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:C.adminId}}}]}}),U(null),[3,6];case 2:if(!(i&&i.value&&n))return[3,3];return ea({variables:{objects:[{entity:t,entityId:n,taxonomyId:i.value}]}}),U(null),[3,6];case 3:if(!(i&&i.inputValue))return[3,5];return[4,ei({variables:{objects:[{type:"tags",status:"active",name:i.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:C.adminId}]}})];case 4:return a=e.sent().data.insert_Taxonomy,I(y,(0,s.Z)(c).concat([{id:null,tag:{id:a.returning[0].id,name:a.returning[0].name,meta:a.returning[0].meta}}])),U(null),[3,6];case 5:i&&i.value&&(I(y,(0,s.Z)(c).concat([{id:null,tag:{id:i.value,name:i.label,meta:i.meta}}])),U(null)),e.label=6;case 6:return[2]}})}),function(e,n){return ev.apply(this,arguments)}),ey=(0,q.useCallback)(function(e,n){var t=E(e,n),i=n.inputValue,r=e.some(function(e){return i===e.label});return""===i||r||t.push({inputValue:i,label:'Add "'.concat(i,'"')}),t},[]),eb=(0,q.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),ej=function(e){n?eu({variables:{tagEntityId:e}}):I(y,c.filter(function(n,t){return t!==e}))},eI=(ef=(0,i.Z)(function(e){var n,t,i,a,s,u;return(0,l.__generator)(this,function(t){switch(t.label){case 0:return[4,em({variables:{tagId:n=e.tagId,object:{meta:{color:e.color}}}})];case 1:return s=t.sent().data.update_Taxonomy_by_pk,I(y,c.map(function(e){return e.tag.id===n?(0,o.Z)((0,r.Z)({},e),{tag:(0,r.Z)({},s)}):e})),[2]}})}),function(e){return ef.apply(this,arguments)}),eS=(eh=(0,i.Z)(function(e){var n,t,i,a,s,u;return(0,l.__generator)(this,function(i){switch(i.label){case 0:return[4,em({variables:{tagId:n=e.tagId,object:{name:t=e.name}}})];case 1:return s=i.sent().data.update_Taxonomy_by_pk,I(t,c.map(function(e){return e.tag.id===n?(0,o.Z)((0,r.Z)({},e),{tag:(0,r.Z)({},s)}):e})),[2]}})}),function(e){return eh.apply(this,arguments)}),ew=Boolean(M),eq=(0,q.useMemo)(function(){return ee.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[ee]),eC=(0,q.useMemo)(function(){return m.uniqBy((0,s.Z)(B).concat((0,s.Z)(c)),function(e){var n;return null===(n=e.tag)||void 0===n?void 0:n.id})},[B,c]);return(0,u.jsxs)(S.Z,{direction:"row",alignItems:"center",children:[(0,u.jsx)(T.P,{tags:eC,handleDeleteTagEntity:ej}),(0,u.jsx)(k,{id:ew?"tags-popover":void 0,open:ew,anchorEl:M,onClose:ex,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,u.jsxs)(x.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,u.jsx)(g.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,s.Z)(eq),value:L,onChange:eZ,onInputChange:function(e,n){W(n)},filterOptions:ey,getOptionLabel:eb,renderOption:function(e,n){return(0,u.jsx)(j.Z,(0,o.Z)((0,r.Z)({},e),{children:n.label}))},renderInput:function(e){return(0,u.jsx)(w.Z,(0,o.Z)((0,r.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,o.Z)((0,r.Z)({},e.InputProps),{endAdornment:(0,u.jsxs)(u.Fragment,{children:[en||er||es?(0,u.jsx)(Z.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),G||ed||ep?(0,u.jsx)(S.Z,{width:"100%",alignItems:"center",p:4,children:(0,u.jsx)(Z.Z,{color:"secondary"})}):(0,u.jsx)(b.Z,{children:null==eC?void 0:eC.map(function(e,n){var t;return(0,u.jsx)(_.T,{tagEntityId:e.id||n,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,onDelete:ej,onColorChange:eI,onNameChange:eS})})})]})}),(0,u.jsx)(R,{color:"black",onClick:eg,children:(0,u.jsx)(f.Z,{sx:{height:"16px",width:"16px"}})})]})};P.defaultProps={entityId:null},P.propTypes={entityId:c().number};var k=(0,C.Z)(I.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}})},16380:function(e,n,t){"use strict";t.d(n,{Aw:function(){return j},BU:function(){return h},C3:function(){return b},LE:function(){return x},Zm:function(){return f},cS:function(){return Z},g$:function(){return y},gI:function(){return v},lx:function(){return g}});var i=t(7297),r=t(75063);function o(){var e=(0,i.Z)(['\n  query GetTagsForEntity($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    tags: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']);return o=function(){return e},e}function a(){var e=(0,i.Z)(["\n  mutation CreateTag($objects: [Taxonomy_insert_input!]!) {\n    insert_Taxonomy(objects: $objects) {\n      returning {\n        id\n        name\n        meta\n      }\n    }\n  }\n"]);return a=function(){return e},e}function s(){var e=(0,i.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "tags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n']);return s=function(){return e},e}function l(){var e=(0,i.Z)(['\n  query GetTagsForSelect($q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "tags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n']);return l=function(){return e},e}function u(){var e=(0,i.Z)(["\n  mutation CreateTagsAgainstEntity($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return e},e}function d(){var e=(0,i.Z)(["\n  mutation DeleteTagAgainstEntity($tagEntityId: Int!) {\n    delete_Taxonomy_Entity_by_pk(id: $tagEntityId) {\n      id\n      taxonomyId\n    }\n  }\n"]);return d=function(){return e},e}function c(){var e=(0,i.Z)(["\n  mutation UpdateTagAgainstEntity($tagId: Int!, $object: Taxonomy_set_input!) {\n    update_Taxonomy_by_pk(pk_columns: { id: $tagId }, _set: $object) {\n      id\n      name\n      meta\n    }\n  }\n"]);return c=function(){return e},e}function m(){var e=(0,i.Z)(["\n  mutation CreateTagsAgainstEntityWithFollowing($objects: [Taxonomy_Entity_insert_input!]!) {\n    insert_Taxonomy_Entity(objects: $objects) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return m=function(){return e},e}function p(){var e=(0,i.Z)(["\n  mutation DeleteTagAgainstEntityWithFollowing($where: Taxonomy_Entity_bool_exp!) {\n    delete_Taxonomy_Entity(where: $where) {\n      returning {\n        id\n        taxonomyId\n      }\n    }\n  }\n"]);return p=function(){return e},e}var v=(0,r.Ps)(o()),f=(0,r.Ps)(a()),h=(0,r.Ps)(s()),g=(0,r.Ps)(l()),x=(0,r.Ps)(u()),Z=(0,r.Ps)(d()),y=(0,r.Ps)(c()),b=(0,r.Ps)(m()),j=(0,r.Ps)(p())},62247:function(e,n,t){"use strict";t.d(n,{y:function(){return m}});var i=t(85893),r=t(45697),o=t(55377),a=t(9270),s=t(62140),l=t(86036),u=t(16551),d=t(77439),c=t(97637),m=function(e){var n=e.answers,t=e.onEdit,r=e.entity,m=e.entityId,p=function(){t&&t(n)};return(0,i.jsxs)(i.Fragment,{children:[n&&n.length>0&&(0,i.jsx)(o.Z,{content:"Questions"}),n&&n.map(function(e){var n,t,u,d=e.meta;return(null==d?void 0:d.input)==="media"?(0,i.jsx)(a.Z,{children:(0,i.jsxs)(s.Z,{md:6,children:[(0,i.jsx)(c.G,{entity:r,entityId:m,showItemActions:!1,showActionButtons:!1,summary:null==d?void 0:d.label,category:"supplierQuestion",mediaMeta:{taxonomyId:e.id}}),(0,i.jsx)(o.Z,{})]})}):(0,i.jsx)(l.Z,{content:(null===(n=e.taxonomy)||void 0===n?void 0:n.name)||e.name,text:e.comments||(null===(t=e.taxonomy_entity)||void 0===t?void 0:null===(u=t[0])||void 0===u?void 0:u.comments)},e.id||e.taxonomyId)}),n&&n.length>0&&t&&(0,i.jsx)(u.Z,{align:"flex-end",children:(0,i.jsx)(d.Z,{content:"Edit Answers",size:"sm",context:"secondary",onClick:p})}),n&&n.length>0&&(0,i.jsx)(o.Z,{})]})};m.propTypes={answers:r.array}},76990:function(e,n,t){"use strict";t.d(n,{D:function(){return R}});var i=t(26042),r=t(69396),o=t(85893),a=t(67294),s=t(45697),l=t(42283),u=t(79665),d=t(76600),c=t(9270),m=t(62140),p=t(16551),v=t(77439),f=t(58594),h=t(28497),g=t(55563),x=t(90951),Z=t(95103),y=t(6710),b=t(78289),j=t(23233),I=t(49501),S=t(40826),w=t(40552),q=t(97637),C={checkbox:f.Z,currencyInput:h.Z,datepicker:w.M,input:g.Z,radio:x.Z,select:Z.Z,textArea:y.Z,selectRange:Z.Z},D=function(e){var n=e.control,t=e.entity,s=e.entityId,l=e.errors,u=e.input,d=e.inputType,c=e.key,m=e.label,p=e.mediaMeta,f=e.name,h=e.options,g=e.register,x=(0,a.useContext)(b.Z),Z="select"===u&&h.length>0,y=["checkbox","radio"].includes(u)&&h.length>0,w=(0,r.Z)((0,i.Z)({control:n},y&&{data:h},Z&&{options:h.map(function(e){return(0,r.Z)((0,i.Z)({},e),{text:e.label})})},"selectRange"===u&&{range:[10,0]}),{errors:l,key:c,label:j.Z.camelize(m),name:f,register:g,type:y?u:d,minDate:"2020-04-19T08:29:04.839Z"}),D=function(){x.show({content:t&&s&&(0,o.jsx)(q.G,{entity:t,entityId:s,mediaMeta:p,category:"supplierQuestion"}),submit:!1,title:m})},_=C[u];return(0,o.jsx)(o.Fragment,{children:"currencyInput"===u?(0,o.jsx)(I.Z,{label:m,children:(0,o.jsx)(_,(0,r.Z)((0,i.Z)({},w),{label:""}))}):(0,o.jsx)(o.Fragment,{children:"media"===u?(0,o.jsx)(I.Z,{label:m,children:(0,o.jsx)(v.Z,{context:"info",content:(0,o.jsx)(S.Z,{icon:"file-upload"}),onClick:D,size:"sm"})}):(0,o.jsx)(I.Z,{label:m,children:(0,o.jsx)(_,(0,i.Z)({},w))})})})};D.propTypes={control:s.object.isRequired,entity:s.string,entityId:s.number,errors:s.object.isRequired,input:s.string,inputType:s.string,key:s.string,label:s.string.isRequired,mediaMeta:s.object,name:s.string.isRequired,options:s.array,register:s.func.isRequired},D.defaultProps={input:"input",options:[],inputType:"text",label:"label"};var _=t(16310),A=function(e,n){var t=n.object,r=n.string,o={};return null==e||e.forEach(function(e){var n;(null===(n=e.meta)||void 0===n?void 0:n.required)&&(o[e.name]=r().required())}),t().shape((0,i.Z)({},o))},T=function(e){var n=e.map(function(e){return(0,r.Z)((0,i.Z)({},e),{name:"".concat(e.name,"/id=").concat(e.taxonomyId)})}),t=(0,_.Ry)().shape({}),o=A(n,{object:_.Ry,string:_.Z_});return t.concat(o)},R=function(e){var n,t=e.entity,s=e.entityId,f=e.onSuccess,h=e.questions,g=e.hasChangeStatus,x=(0,l.cI)({defaultValues:(n={},h.forEach(function(e){var t=e.comments,i=e.taxonomyId,r=e.name;n["".concat(r,"/id=").concat(i)]=t}),n),resolver:(0,u.S)(T(h))}),Z=x.control,y=x.errors,b=x.handleSubmit,j={control:Z,errors:y,register:x.register},I=function(e,n){var i=Object.keys(e).map(function(n){return{taxonomyId:parseInt(n.split("/id=")[1]),name:n.split("/id=")[0],comments:String(e[n]),entity:t,entityId:s}});f&&f(i,n)};return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(d.Z,{id:g?"offCanvasFormQuestions":"offCanvasForm",handleSubmit:b(function(e){return I(e,"supplierQuestionsSubmitted")}),children:(0,o.jsxs)(c.Z,{children:[h.map(function(e){var n,l,u,d;return(0,o.jsx)(m.Z,{md:12,children:(0,a.createElement)(D,(0,r.Z)((0,i.Z)({},j),{input:null===(n=e.meta)||void 0===n?void 0:n.input,inputType:null===(l=e.meta)||void 0===l?void 0:l.inputType,key:e.taxonomyId,label:null===(u=e.meta)||void 0===u?void 0:u.label,name:"".concat(e.name,"/id=").concat(e.taxonomyId),options:null===(d=e.meta)||void 0===d?void 0:d.options,entity:t,entityId:s,mediaMeta:{taxonomyId:e.taxonomyId}}))})}),g&&(0,o.jsx)(m.Z,{md:12,children:(0,o.jsxs)(p.Z,{align:"flex-end",children:[(0,o.jsx)(v.Z,{content:"Save",context:"success",onClick:b(function(e){return I(e,"supplierQuestionsDraft")}),size:"sm"}),(0,o.jsx)(v.Z,{content:"Submit",context:"secondary",type:"submit",size:"sm"})]})})]})})})};R.propTypes={entity:s.string.isRequired,entityId:s.number,onSuccess:s.func,hasChangeStatus:s.bool,questions:s.array.isRequired},R.defaultProps={hasChangeStatus:!1}},46242:function(e,n,t){"use strict";t.d(n,{z:function(){return m}});var i=t(47568),r=t(828),o=t(29815),a=t(97582),s=t(6812),l=t(50319),u=t(92711),d=t(67999),c=t(67294),m=function(e,n,t,m){var p,v,f,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"media",g=(0,c.useState)(!1),x=g[0],Z=g[1],y=(0,s.a)(u.O,{variables:{entity:e,entityId:m,category:h,adminId:n},skip:!m}),b=y.data,j=(void 0===b?{items:[]}:b).items,I=y.loading,S=(0,r.Z)((0,l.D)(d.CI),2),w=S[0],q=S[1].loading,C=(0,r.Z)((0,l.D)(d.xM,{refetchQueries:["MEDIAS"]}),1)[0],D=function(e){w({variables:{mediaId:e}})},_=function(){var e="cleverly-media";return JSON.stringify([{width:32,height:32,bucket:e,sizeName:"vSmall",fit:"inside"},{width:200,height:200,bucket:e,sizeName:"small",fit:"inside"},{width:600,height:600,bucket:e,sizeName:"medium",fit:"inside"},{width:1200,height:1200,bucket:e,sizeName:"large",fit:"inside"}])},A=(p=(0,i.Z)(function(i,r){var o,s;return(0,a.__generator)(this,function(a){switch(a.label){case 0:if(a.trys.push([0,,4,5]),Z(!0),!r)return[3,3];return[4,R(r)];case 1:return o=a.sent(),s={adminId:n,caption:r.caption,expiryAt:null,extension:r.media.name.split(".").pop(),userId:t,filename:o.key,type:r.type,Media_Entities:{data:[{entity:e,entityId:i}]}},[4,C({variables:{objects:s}})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:return Z(!1),[7];case 5:return[2]}})}),function(e,n){return p.apply(this,arguments)}),T=(v=(0,i.Z)(function(){var i,r,s,l,u,d,c,m,p,v,f,h,g,x,y,b,j,I,S=arguments;return(0,a.__generator)(this,function(a){switch(a.label){case 0:i=S.length>0&&void 0!==S[0]?S[0]:[],r=S.length>1&&void 0!==S[1]?S[1]:"media",a.label=1;case 1:a.trys.push([1,,10,11]),Z(!0),s=null,l=!0,u=!1,d=void 0,a.label=2;case 2:a.trys.push([2,7,8,9]),c=i[Symbol.iterator](),a.label=3;case 3:if(l=(m=c.next()).done)return[3,6];if((p=m.value).mediaId)return[3,5];return[4,R(p)];case 4:f=a.sent(),h=null,g=null,"image"===p.type?(x=f.key,h=(y=f.data.find(function(e){return"large"===e.name}))?y.relativePath:x,g={original:{relativePath:x},thumbnails:f.data||null}):h=f.key,s={Media_Entity:{data:(0,o.Z)(null!==(b=null==s?void 0:null===(v=s.Media_Entity)||void 0===v?void 0:v.data)&&void 0!==b?b:[]).concat([{entity:e,Medium:{data:{adminId:n,caption:null!==(j=null==p?void 0:p.caption)&&void 0!==j?j:null,expiryAt:null,extension:p.media.name.split(".").pop(),userId:t,category:r,filename:h,type:p.type,meta:g}}}])}},a.label=5;case 5:return l=!0,[3,3];case 6:return[3,9];case 7:return I=a.sent(),u=!0,d=I,[3,9];case 8:try{l||null==c.return||c.return()}finally{if(u)throw d}return[7];case 9:return[2,s];case 10:return Z(!1),[7];case 11:return[2]}})}),function(){return v.apply(this,arguments)}),R=(f=(0,i.Z)(function(e){var n,t,i,r,o;return(0,a.__generator)(this,function(o){switch(o.label){case 0:switch(n="cleverly-media",t="https://aws.cleverly.works/aws/s3/upload",(i=new window.FormData).append("file",e.media,e.media.name),e.type){case"image":r="https://aws.cleverly.works/image/process",i.append("sizes",_());break;case"document":case"audio":i.append("bucket",n),i.append("folder","".concat(e.type,"s")),r=t}return[4,window.fetch(r,{method:"POST",body:i})];case 1:return[2,o.sent().json()]}})}),function(e){return f.apply(this,arguments)});return{uploadMedia:A,uploadMediaToS3:R,createMediaInput:T,deleteMediaByEntity:D,loadingAddMedia:x,loadingDeleteMedia:q,preloadedMediaLoading:I,preloadedMedia:(null==j?void 0:j.length)?j:[]}}},98521:function(e,n,t){"use strict";t.d(n,{O:function(){return i},v:function(){return r}});var i=[{text:"Country",value:""},{text:"United Kingdom",value:1},{text:"Ireland",value:4}],r=[{label:"United Kingdom",value:1},{label:"Ireland",value:4}]},99988:function(e,n,t){"use strict";t.d(n,{Hu:function(){return i},KB:function(){return r},M2:function(){return o}});var i=[{id:"time-materials",label:"Time & Materials",value:"time-materials"},{id:"fixed",label:"Fixed",value:"fixed"}],r=[{id:"at",label:"At",value:"at"},{id:"between",label:"Between",value:"between"}],o=[{id:"complete",label:"Job complete",value:"complete"},{id:"completeCertificate",label:"Job complete, certificate to follow",value:"completeCertificate"},{id:"returnVisit",label:"Return visit required",value:"returnVisit"},{id:"returnVisitByAnother",label:"Visit required by another supplier",value:"returnVisitByAnother"},{id:"couldNotDo",label:"Could not do",value:"couldNotDo"}]},84570:function(e,n,t){"use strict";t.d(n,{Y:function(){return i}});var i=[{text:"Select...",value:""},{text:"Call",value:"call"},{text:"Email",value:"email"},{text:"Portal",value:"portal"},{text:"Other",value:"other"}]},15897:function(e,n,t){"use strict";t.d(n,{bg:function(){return i}});var i=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},78067:function(e,n,t){"use strict";t.d(n,{m:function(){return X}});var i=t(47568),r=t(26042),o=t(69396),a=t(828),s=t(97582),l=t(85893),u=t(67294),d=t(45697),c=t(6812),m=t(50319),p=t(11163),v=t.n(p),f=t(42283),h=t(79665),g=t(76600),x=t(15214),Z=t(9270),y=t(62140),b=t(49501),j=t(55563),I=t(6710),S=t(95103),w=t(84043),q=t(11057),C=t(69368),D=t(50480),_=t(6054),A=t(536),T=function(e){var n=e.accountId,t=e.accountName,i=e.canSelectAccount,a=e.control,s=e.errors,d=e.setValue,c=e.watch,m=n?{value:n,label:t}:c("propertyOwner"),p=(0,_.Z)(m),v=function(e){d("contactUser",null)};(0,u.useEffect)(function(){m!==p&&p&&v(m)},[m]);var f={control:a,errors:s};return(0,l.jsxs)(Z.Z,{children:[(0,l.jsx)(y.Z,{md:6,children:(0,l.jsx)(A.P,(0,o.Z)((0,r.Z)({},f),{defaultValue:n&&{value:n,label:t},errors:(0,r.Z)({},s),isDisabled:!i,label:"Client",name:"propertyOwner",placeholder:"Select",type:"customer"}))}),(0,l.jsx)(y.Z,{md:6,children:(0,l.jsx)(A.P,(0,o.Z)((0,r.Z)({},f),{accountId:(null==m?void 0:m.value)||null,errors:(0,r.Z)({},s),isDisabled:!m,label:"Contact Name",name:"contactUser",placeholder:m?"Select":"Select the location owner",type:"user"}))})]})};T.propTypes={accountId:d.number,accountName:d.string,canSelectAccount:d.bool.isRequired,control:d.func.isRequired,errors:d.object.isRequired,setValue:d.func.isRequired,watch:d.func.isRequired};var R=t(53600),E=function(e,n){var t=e.propertyOwner,i=e.contactUser;return e.Account_Locations={data:{accountId:t.value}},delete e.propertyOwner,e.contactUserId=(null==i?void 0:i.value)||null,delete e.contactUser,n&&delete e.Account_Locations,e},P=function(e,n,t,i){var r={location:E(e,!0),locationId:n.locationId,accountId:n.accountId,newAccountId:n.newAccountId,hasChanged:n.hasChanged};i({variables:r})},k=t(16310),M=t(74492),V=t(74944),$=t(7297),L=t(75063);function U(){var e=(0,$.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"]);return U=function(){return e},e}function F(){var e=(0,$.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]);return F=function(){return e},e}function N(){var e=(0,$.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]);return N=function(){return e},e}function W(){var e=(0,$.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return W=function(){return e},e}var z=(0,L.Ps)(U()),O=(0,L.Ps)(F()),J=(0,L.Ps)(N()),H=(0,L.Ps)(W()),Q=t(16951),B=t(15897),G="/dashboard/properties/",X=function(e){var n,t,d,p,_=e.accountId,A=e.accountName,$=e.entity,L=e.data,U=e.refetch,F=e.onAddressCreated,N=e.isPropsComponent,W=e.initialValues,X=e.xeroContactId,Y=e.displayXeroContacts,K=e.xeroContacts,ee=e.displaySignin,en=e.handleXeroAuthorize,et=e.onClose,ei=(0,M.a)(),er=(0,V.x)().hasRole,eo=(0,u.useState)(!1),ea=eo[0],es=eo[1],el=null==K?void 0:K.find(function(e){return e.value===X}),eu=(0,o.Z)((0,r.Z)({},L?(location.propertyOwner={label:L.customer[0].account.name,value:L.customer[0].account.id},location.contactUser=(null==L?void 0:L.user)&&L.customer[0].account.id&&{label:L.user.fullName,value:L.user.id},location.access=L.access,location.name=L.name,location.status=L.status,location.permitsRequired=L.permitsRequired,location):{},W),{xeroContact:el}),ed=(0,f.cI)({defaultValues:eu,resolver:(0,h.S)((0,k.Ry)().shape({access:(0,k.Z_)().required(),contactUser:(0,k.Ry)().required(),name:(0,k.Z_)().required(),propertyOwner:(0,k.Ry)().required(),status:er("admin")&&(0,k.Z_)().required(),permitsRequired:(0,k.O7)()}))}),ec=ed.control,em=ed.errors,ep=ed.handleSubmit,ev=ed.register,ef=ed.setValue,eh=ed.getValues,eg=ed.watch,ex=(0,c.a)(z,{variables:{id:null==L?void 0:L.id},skip:!(null==L?void 0:L.id)}).data,eZ=(void 0===ex?{property:{}}:ex).property,ey=(d=(0,i.Z)(function(e){var n,t,i,o,a,l,u,d,c,m,p;return(0,s.__generator)(this,function(a){switch(a.label){case 0:var s,u;return n=e.addressFormData,t=e.outerFormData,i={Addresses:{data:{Address:{data:(0,r.Z)({},n)},entity:$}}},o=(0,r.Z)({},eh(),i,t),er("customer")&&(o.status="active"),[4,eI({variables:{objects:[E(s=o)]}})];case 1:return p=void 0===(m=(void 0===(d=(void 0===(l=a.sent().data)?{}:l).insert_Location)?{}:d).returning)?{}:m,F&&F(p),ei.close(),[2]}})}),function(e){return d.apply(this,arguments)}),eb=(p=(0,i.Z)(function(e){return(0,s.__generator)(this,function(n){return ei.show({title:"Add new address",content:(0,l.jsx)(Q.k,{onCancel:function(){},onSubmit:function(n){ey({addressFormData:n,outerFormData:e})},type:"text"}),submit:!1}),[2]})}),function(e){return p.apply(this,arguments)}),ej=(0,a.Z)((0,m.D)(O,{onCompleted:function(e){if(!N){var n=e.insert_Location.returning[0].id;ei.close(),U?U():v().push("".concat(G,"view?id=").concat(n))}}}),2),eI=ej[0],eS=ej[1].loading,ew=(0,a.Z)((0,m.D)(J,{onCompleted:function(e){var n=e.update_Location_by_pk.id;ei.close(),U?U():v().push("".concat(G,"view?id=").concat(n))}}),2),eq=ew[0],eC=ew[1].loading,eD=(0,a.Z)((0,m.D)(H),1)[0],e_=function(e){if(es(!1),L){if("inactive"===e.status&&!(n=eZ.jobs).every(function(e){return!!(0,R.E)(e,["completed","closed"])})){es(!0);return}e.xeroContact&&eD({variables:{id:null===(s=null==L?void 0:L.customer[0])||void 0===s?void 0:s.account.id,changes:{meta:(0,o.Z)((0,r.Z)({},null===(l=null==L?void 0:L.customer[0])||void 0===l?void 0:l.account.meta),{xeroContactId:e.xeroContact.value})}}});var n,t,i,a,s,l,u={locationId:null==L?void 0:L.id,accountId:null===(t=null==L?void 0:L.customer[0])||void 0===t?void 0:t.account.id,newAccountId:null==e?void 0:null===(i=e.propertyOwner)||void 0===i?void 0:i.value,hasChanged:(null===(a=null==L?void 0:L.customer[0])||void 0===a?void 0:a.account.id)!==(null==e?void 0:e.propertyOwner.value)};P((0,o.Z)((0,r.Z)({},e),{xeroContact:void 0}),u,L.id,eq),et&&et()}else eb(e),et&&et()},eA={control:ec,errors:em,register:ev};return(0,l.jsxs)(g.Z,{disabled:eS||eC,id:"offCanvasForm",handleSubmit:ep(e_),children:[ea&&(0,l.jsx)(x.Z,{context:"info",content:" This location cannot be made inactive, it has active jobs."}),(0,l.jsx)(Z.Z,{children:(0,l.jsx)(y.Z,{md:12,children:(0,l.jsx)(T,(0,o.Z)((0,r.Z)({},eA),{accountId:_,accountName:A,canSelectAccount:!_,setValue:ef,watch:eg}))})}),(0,l.jsx)(b.Z,{label:"Name",children:(0,l.jsx)(j.Z,(0,o.Z)((0,r.Z)({},eA),{name:"name"}))}),(0,l.jsx)(b.Z,{label:"Access information",children:(0,l.jsx)(I.Z,(0,o.Z)((0,r.Z)({},eA),{name:"access",rows:4}))}),er("admin")&&(0,l.jsx)(b.Z,{label:"Status",children:(0,l.jsx)(S.Z,(0,o.Z)((0,r.Z)({},eA),{name:"status",options:B.bg}))}),(0,l.jsx)(f.Qr,{name:"permitsRequired",control:ec,render:function(e){var n=e.value,t=e.onChange;return(0,l.jsx)(D.Z,{control:(0,l.jsx)(C.Z,{color:"secondary",checked:n||!1,onChange:function(e){return t(e.target.checked)}}),label:"Permits required"})}}),er("admin")&&void 0!==Y&&Y&&(0,l.jsx)(b.Z,{label:"Xero Contact",children:ee?(0,l.jsx)(q.Z,{variant:"contained",onClick:function(){en()},children:"Connect to Xero to select Contact"}):(0,l.jsx)(w.Z,(0,o.Z)((0,r.Z)({options:K},eA),{name:"xeroContact"}))})]})};T.propTypes={accountId:d.number,accountName:d.string,data:d.object,refetch:d.func,offCanvas:d.func}},81515:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return eO}});var i=t(26042),r=t(85893),o=t(11163),a=t.n(o),s=t(19076),l=t(47568),u=t(69396),d=t(828),c=t(97582),m=t(67294),p=t(66252),v=t(73359),f=t(50319),h=t(64573),g=t(67999),x=t(53600),Z=t(45697),y=t.n(Z),b=t(42283),j=t(79665),I=t(6054),S=t(76600),w=t(9270),q=t(62140),C=t(77439),D=t(6812),_=t(20725),A=t(83863),T=t(54559),R=t(78289),E=t(26186),P=t(11585),k=t(87336),M=t(21813),V=t(12632),$=t(53767),L=(0,A.Z)((0,T.Z)(new Date,12)),U=(0,m.memo)(function(e){var n,t,o=e.jobId,a=e.locationId,s=e.serviceId,l=(0,V.x)({filters:{}}),d=l.initialData,c=l.ref,p=(0,m.useContext)(R.Z),v=(0,$.q)(),f=null===(n=v.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,h=null===(t=v.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,g=(0,D.a)(_.sW,{variables:(0,u.Z)((0,i.Z)({jobId:o,locationId:a},d),{serviceId:s,startDate:L})}),x=g.data,Z=void 0===x?{jobs:[],meta:{aggregate:{totalCount:0}}}:x,y=Z.jobs,b=Z.meta,j=g.loading,I=g.refetch,S=function(e){p.show({content:(0,r.jsx)(M.g,{jobId:e.id,toggleShow:p.close,numberPrefix:f,numberSuffix:h}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})};return(0,r.jsx)(P.Z,{title:"Job History",children:(0,r.jsx)(k.t,{columns:[{hidden:!0,text:"Id"},{text:"Title"},{text:"Service"},{text:"Date"}],history:!1,loading:j,meta:b,ref:c,refetch:I,rowClick:S,rows:y.map(function(e){var n;return{id:e.id,title:e.title,service:null===(n=e.service)||void 0===n?void 0:n.name,createdDate:(0,E.Z)(e.createdAt)}})})})},function(e,n){var t=!0;return(n.locationId!==e.locationId||n.serviceId!==e.serviceId)&&(t=!1),t});U.propTypes={jobId:Z.number,locationId:Z.number.isRequired,serviceId:Z.number};var F=t(29815),N=t(49501),W=t(95103),z=t(536),O=t(84570),J=t(53625),H=(0,m.memo)(function(e){var n=e.control,t=e.customerSelectedWatch,o=e.errors,a=e.hasRole,s={control:n,errors:o,register:e.register};return(0,r.jsxs)(P.Z,{dataSet:{"data-cy":"customer"},open:!0,title:"Customer",children:[(0,r.jsx)(z.P,(0,u.Z)((0,i.Z)({},s),{errors:(0,i.Z)({},o),label:"Customer",name:"customerSelected",type:"customer"})),t&&(0,r.jsx)(z.P,(0,u.Z)((0,i.Z)({},s),{isDisabled:!a((0,F.Z)(J.td).concat((0,F.Z)(J.Sf),(0,F.Z)(J.n))),accountId:(null==t?void 0:t.value)||null,errors:(0,i.Z)({},o),label:"Contact User",name:"customerUserSelected",type:"user"})),a("admin")&&(0,r.jsx)(N.Z,{label:"Source",children:(0,r.jsx)(W.Z,(0,u.Z)((0,i.Z)({},s),{name:"source",options:O.Y}))})]})},function(e,n){var t,i;return e.customerSelectedWatch===n.customerSelectedWatch&&!(null===(t=n.errors.customerSelected)||void 0===t?void 0:t.message)&&!(null===(i=n.errors.customerUserSelected)||void 0===i?void 0:i.message)});H.propTypes={control:Z.object.isRequired,customerSelectedWatch:Z.object,errors:Z.object.isRequired,register:Z.func.isRequired};var Q=t(55843),B=t(6710),G=t(90951),X=t(15214),Y=t(55563),K=t(62247),ee=t(20390),en=t(76990),et=t(95124),ei=t(74944),er=t(42074),eo=function(e){var n,t=e.control,o=e.currentAnswers,a=e.errors,s=e.isQuote,l=e.isPPM,d=e.jobId,c=(e.locationSelectedWatch,e.prevTaxonomy),p=e.register,v=e.taxonomyWatch,f=e.watch,h=e.dataSlas,g=e.tagsWatch,x=e.setValue,Z=(0,ei.x)().hasRole,y=(0,m.useContext)(R.Z),b=(0,m.useState)(o),j=b[0],I=b[1],S=f("slaId");(0,m.useEffect)(function(){v!==c&&v&&T(null==v?void 0:v.childs)},[v]);var C=(0,et.GU)(s?"quote":"reactive",h),D=null===(n=null==C?void 0:C.find(function(e){return e.id===Number(S)}))||void 0===n?void 0:n.notes,_={errors:a,register:p,control:t},A=function(e){I(e),y.close()},T=function(e){e&&e.length>0?y.show({content:(0,r.jsx)(en.D,{onSuccess:A,entity:"Job",entityId:d,questions:e}),title:"Please answer the following questions"}):I([])};return(0,r.jsxs)(P.Z,{dataSet:{"data-cy":"details"},open:!0,title:"Description",children:[(0,r.jsx)(ee.l,(0,u.Z)((0,i.Z)({},_),{label:s?"Quote Headline":"Short job description",name:"taxonomyId_ShortDesc",type:"jobTags"})),(0,r.jsx)(K.y,{answers:j,onEdit:T}),(0,r.jsx)(Q.Z,{}),(0,r.jsx)(N.Z,{label:"Work Description",children:(0,r.jsx)(B.Z,(0,u.Z)((0,i.Z)({},_),{name:"description",rows:3}))}),!l&&(0,r.jsx)(G.Z,(0,u.Z)((0,i.Z)({},_),{data:C,legend:"Priority",name:"slaId"})),S&&(0,r.jsx)(X.Z,{content:D||"-",context:"light"}),!s&&(0,r.jsxs)(w.Z,{children:[(0,r.jsx)(q.Z,{md:6,children:(0,r.jsx)(N.Z,{label:"Estimated duration",children:(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},_),{name:"estimatedDuration",type:"number",defaultValue:90,min:0}))})}),(0,r.jsx)(q.Z,{md:6,children:(0,r.jsx)(N.Z,{label:"Unit",children:(0,r.jsx)(W.Z,(0,u.Z)((0,i.Z)({},_),{name:"estimatedDurationUnit",options:[{text:"Hours",value:"hours"},{text:"Minutes",value:"minutes"},{text:"Days",value:"days"}],defaultValue:"minutes"}))})})]}),(0,r.jsx)(N.Z,{label:"".concat(Z("customer")?"Your reference":"Customer reference"),children:(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},_),{name:"reference"}))}),Z("admin")&&(0,r.jsx)(er.n,{entityId:d,values:g,setValue:x,entity:"Job"}),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},_),{name:"questions",type:"hidden",defaultValue:JSON.stringify(j)})),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},_),{name:"reportPassFail",type:"hidden"})),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},_),{name:"reportPassFailTitle",type:"hidden"})),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},_),{name:"requireReportRecommendations",type:"hidden"})),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},_),{name:"customerSignature",type:"hidden"})),(0,r.jsx)(Y.Z,(0,u.Z)((0,i.Z)({},_),{name:"supplierSignature",type:"hidden"}))]})};eo.propTypes={control:Z.object.isRequired,currentAnswers:Z.array.isRequired,errors:Z.object.isRequired,isQuote:Z.bool,isPPM:Z.bool,jobId:Z.number,locationSelectedWatch:Z.object,prevTaxonomy:Z.string,register:Z.func.isRequired,taxonomyWatch:Z.object.isRequired,watch:Z.func.isRequired,slaData:Z.array},eo.defaultProps={isQuote:!1};var ea=t(7297),es=t(57493),el=t(10367),eu=t(78067);function ed(){var e=(0,ea.Z)(["\n  && > div:first-of-type {\n    ","\n  }\n  && {\n    margin-bottom: 1rem;\n  }\n"]);return ed=function(){return e},e}var ec=["manager","owner"],em=function(e){var n,t,o=e.assetCategoryWatch,a=e.control,s=e.customerSelectedWatch,l=e.customerUserSelectedWatch,c=e.errors,m=e.locationSelectedWatch,p=e.register,v=e.setValue,f=(0,$.q)(),h=null==f?void 0:null===(n=f.admin)||void 0===n?void 0:null===(t=n.modules)||void 0===t?void 0:t.assets,g=(0,D.a)(es.kB,{variables:{accountId:null==s?void 0:s.value,userId:null==l?void 0:l.value}}).data,x=(void 0===g?{accountUsers:[]}:g).accountUsers,Z=function(e){var n=(0,d.Z)(e,1)[0];v("locationSelected",{value:n.id,label:n.name})},y={isClearable:!1,control:a,errors:c,register:p};return(0,r.jsxs)(P.Z,{dataSet:{"data-cy":"location"},open:!0,title:"Location",children:[(0,r.jsx)(z.P,(0,u.Z)((0,i.Z)({},y),{accountId:null==s?void 0:s.value,errors:(0,i.Z)({},c),name:"locationSelected",label:"Property",type:"property",customerRole:x.some(function(e){return ec.includes(e.role)})?null:"user",customerId:null==l?void 0:l.value,AddForm:function(){return(0,r.jsx)(eu.m,{initialValues:{propertyOwner:(0,i.Z)({},s)},isPropsComponent:!0,entity:"Location",onAddressCreated:Z})}})),m&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(z.P,(0,u.Z)((0,i.Z)({},y),{isClearable:!0,label:"Sublocation",locationId:m.value,name:"sublocationSelected",type:"sublocation"})),(0,r.jsx)(N.Z,{label:"Access information",children:(0,r.jsx)(B.Z,(0,u.Z)((0,i.Z)({},y),{name:"access",rows:2}))}),h&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(z.P,(0,u.Z)((0,i.Z)({},y),{isClearable:!0,label:"Asset Category",locationId:m.value,id:null==o?void 0:o.value,name:"assetCategorySelected",type:"assetCategory"})),(0,r.jsx)(ep,(0,u.Z)((0,i.Z)({},y),{isClearable:!0,isDisabled:!o,label:"Assets",locationId:m.value,assetCategoryId:(null==o?void 0:o.value)||null,name:"assetSelected",type:"asset",isMulti:!0}))]})]})]})};em.propTypes={control:Z.object.isRequired,customerSelectedWatch:Z.object,errors:Z.object.isRequired,locationSelectedWatch:Z.object,register:Z.func.isRequired};var ep=(0,el.ZP)(z.P).withConfig({displayName:"location__StyledSelect",componentId:"sc-8da0c89c-0"})(ed(),function(e){return e.isDisabled?"background-color: #cecece !important;":""}),ev=(0,m.memo)(function(e){var n=e.control,t=e.errors,o=e.user;return(0,r.jsx)(P.Z,{dataSet:{"data-cy":"manager"},open:!0,title:"Admin User",children:(0,r.jsx)(z.P,{control:n,accountId:o.accountId,errors:(0,i.Z)({},t),isClearable:!1,label:"Assigned to",name:"managerSelected",type:"user"})})},function(e,n){return!0});ev.propTypes={control:Z.object.isRequired,errors:Z.object.isRequired,user:Z.object.isRequired};var ef=t(58594),eh=["1w","1m","3m","6m","12m"].map(function(e){return{id:e,label:e,value:e}}),eg=[1,2,3,4].map(function(e){return{id:"week"+e,label:e,value:"week"+e}}),ex=function(e){var n,t=e.control,o={control:t,errors:e.errors,register:e.register};return(0,r.jsxs)(P.Z,{dataSet:{"data-cy":"ppm"},open:!0,title:"PPM",children:[(0,r.jsx)(ef.Z,(0,u.Z)((0,i.Z)({},o),{data:eh,legend:"Frequency",name:"frequency",stacked:!1})),(0,r.jsx)(N.Z,{label:"Frequency Description",children:(0,r.jsx)(B.Z,(0,u.Z)((0,i.Z)({},o),{name:"frequencyDesc",rows:2}))}),(0,r.jsx)(ef.Z,(0,u.Z)((0,i.Z)({},o),{data:eg,legend:"Week",name:"week",stacked:!1}))]})};ex.propTypes={control:Z.object.isRequired,errors:Z.object.isRequired,locationId:Z.number,register:Z.func.isRequired};var eZ=t(64732),ey=t(40552),eb=t(1691),ej=t(30381),eI=t.n(ej),eS=function(e){var n=e.control,t=e.errors,o=e.register,a=e.siteVisitWatch,s=e.watch,l=e.quoteReturnedTimingEndSupplier,d=e.quoteReturnedTimingEndCustomer,c={control:n,errors:t,register:o},p=s("siteVisitStart"),v=s("siteVisitEnd"),f=s("siteVisitWeekends"),h=s("quoteDue"),g=s("quoteDueSupplier"),x=function(e){var n=new Date,t=new Date(e);return t.getHours()>=8&&17>t.getHours()&&n.getTime()<t.getTime()},Z=function(e){var n=p?new Date(p):new Date,t=new Date(e);return t.getHours()>=8&&17>t.getHours()&&n.getTime()<t.getTime()},y=function(e){var n=e.getDay();return 0!==n&&6!==n},b=(0,m.useMemo)(function(){return eI()(h).isAfter(d,"day")||eI()(g).isAfter(l,"day")},[h,g,d,l]);return(0,r.jsxs)(P.Z,{dataSet:{"data-cy":"quote"},open:!0,title:"Quote information",children:[(0,r.jsx)(N.Z,{label:"Number of Quotes",children:(0,r.jsx)(W.Z,(0,u.Z)((0,i.Z)({},c),{name:"quoteNumber",placeholder:"Select number of quotes",range:[4,1]}))}),b&&(0,r.jsx)(eb.Z,{color:"info",variant:"filled",sx:{mb:1},children:"Please note, the selected quote return date is later than that required by the relevant SLA. This will trigger a SLA breach."}),(0,r.jsx)(N.Z,{label:"Quote due by Customer",children:(0,r.jsx)(ey.M,(0,u.Z)((0,i.Z)({},c),{name:"quoteDue",placeholder:"Click to select Quote Due Date"}))}),(0,r.jsx)(N.Z,{label:"Quote due from Supplier",children:(0,r.jsx)(ey.M,(0,u.Z)((0,i.Z)({},c),{name:"quoteDueSupplier",placeholder:"Click to select Quote Due Date"}))}),(0,r.jsx)(ef.Z,(0,u.Z)((0,i.Z)({},c),{data:[{id:"siteVisitReq",label:"Site visit required",value:!0}],name:"siteVisitReq"})),a&&(0,r.jsxs)(w.Z,{children:[(0,r.jsx)(q.Z,{md:12,children:(0,r.jsx)(ef.Z,(0,u.Z)((0,i.Z)({},c),{data:[{id:"siteVisitWeekends",label:"Include Weekends",value:!0}],name:"siteVisitWeekends"}))}),(0,r.jsxs)(q.Z,{md:12,children:[(0,r.jsx)(N.Z,{label:"Start time"}),(0,r.jsx)(ey.M,(0,u.Z)((0,i.Z)({},c),{dateFormat:"d MMM yyyy HH:mm",minDate:new Date,maxDate:v?new Date(v):null,filterTime:x,filterDate:!f&&y,name:"siteVisitStart",showTimeSelect:!0,todayButton:!1}))]}),p&&(0,r.jsxs)(q.Z,{md:12,children:[(0,r.jsx)(N.Z,{label:"End time"}),(0,r.jsx)(ey.M,(0,u.Z)((0,i.Z)({},c),{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,minDate:p?new Date(p):new Date,filterTime:Z,filterDate:!f&&y,name:"siteVisitEnd",showTimeSelect:!0,todayButton:!1}))]})]})]})};eS.propTypes={control:Z.object.isRequired,errors:Z.object.isRequired,register:Z.func.isRequired};var ew=t(16310);(0,ew.Ry)().shape({title:(0,ew.Z_)().required(),description:(0,ew.Z_)().required(),access:(0,ew.Z_)(),serviceSelected:(0,ew.Ry)().required(),timingEnd:(0,ew.hT)().required(),timingStart:(0,ew.hT)().required()});var eq=t(79772),eC=t(72790),eD=t(50135),e_=t(51233),eA=t(18531),eT=function(e){var n=e.register,t=e.control,i=(0,d.Z)((0,v.t)(h.dL),2),o=i[0],a=i[1],s=a.loading,l=a.data,u=(void 0===l?{issueTypes:[]}:l).issueTypes;return(0,r.jsx)(P.Z,{title:"Issue reported",open:!0,children:(0,r.jsxs)(e_.Z,{spacing:3,children:[(0,r.jsx)(b.Qr,{name:"issueType",control:t,render:function(e){var n=e.value,t=e.onChange;return(0,r.jsx)(eA.q,{value:n,disableClearable:!0,loading:s,onOpen:o,textFieldProps:{color:"secondary",variant:"standard",label:"Select issue type"},sx:{width:"200px"},onChange:function(e,n){return t(n)},options:u})}}),(0,r.jsx)(eD.Z,{multiline:!0,name:"issueReportedDescription",inputRef:n})]})})},eR=t(62547),eE=t(76011),eP=function(e){var n=e.setValue,t=e.permitsLinks,i=e.attachmentsPermits,o=e.showWarning,a=e.onDeleteExistingMedia;return(0,r.jsxs)(e_.Z,{sx:ek.container,children:[o&&(0,r.jsx)(eb.Z,{variant:"filled",severity:"error",children:"Warning: This site requires a permit for attendance"}),(0,r.jsx)(eR.V,{name:"permitsLinks",setValue:n,values:t,title:"Permits links"}),(0,r.jsx)(eE.f,{setValue:n,values:i,onDeleteExistingMedia:a,name:"permitsAttachments",title:"Permits attachments"})]})};eP.propTypes={setValue:y().func,permitsLinks:y().array,attachmentsPermits:y().array,showWarning:y().bool},eP.defaultProps={showWarning:!0};var ek={container:{width:"100%"}},eM=t(36740),eV=function(e){var n,t,o,a=e.defaultValues,s=e.preloadedMedia,l=e.deleteMediaByEntity,d=e.job,c=e.onSubmit,p=e.query,v=(0,ei.x)(),f=v.hasRole,g=v.user,x=(0,b.cI)({defaultValues:a,resolver:(0,j.S)((n=p,t=f,o=a.type,(0,ew.Ry)().shape({managerSelected:t("admin")&&(0,ew.Ry)().required(),customerSelected:(0,ew.Ry)().nullable().required(),customerUserSelected:(0,ew.Ry)().required(),source:t("admin")&&(0,ew.Z_)().oneOf(["call","email","portal","other"]).required(),slaId:"ppm"!==o&&(0,ew.Rx)().required(),description:(0,ew.Z_)().required(),taxonomyId_ShortDesc:(0,ew.Ry)().required(),reference:(0,ew.Z_)(),locationSelected:(0,ew.Ry)().required(),access:(0,ew.Z_)().required(),pricing:!n.quoted&&(0,ew.Z_)().oneOf(["time-materials","fixed"]),customerSpendThreshold:!n.quoted&&(0,ew.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),amount:!n.quoted&&(0,ew.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),supplierLabourAmount:!n.quoted&&(0,ew.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),supplierMaterialsAmount:!n.quoted&&(0,ew.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),quoteNumber:n.quoted&&(0,ew.Z_)().required(),quoteDue:n.quoted&&(0,ew.hT)().required(),quoteDueSupplier:n.quoted&&(0,ew.hT)().required(),siteVisitStart:n.quoted&&(0,ew.hT)().when("siteVisitReq",{is:"true",then:function(){return(0,ew.hT)().required()}}),siteVisitEnd:n.quoted&&(0,ew.hT)().when("siteVisitReq",{is:"true",then:function(){return(0,ew.hT)().required()}}),siteVisitWeekends:n.quoted&&(0,ew.Z_)(),costCategorySelected:t(["admin","customer"])&&!n.quoted&&(0,ew.Ry)().required(),serviceSelected:t(["admin","customer"])&&!n.quoted&&(0,ew.Ry)().required(),timing:!n.quoted&&(0,ew.Z_)().required().oneOf(["at","between"]),timingStart:!n.quoted&&(0,ew.hT)().required(),timingEnd:!n.quoted&&(0,ew.hT)().when("timing",{is:"between",then:function(){return(0,ew.hT)().required()}}),allowTimingNormalHours:!n.quoted&&(0,ew.Z_)(),reportPassFail:(0,ew.Xg)(),reportPassFailTitle:(0,ew.Z_)().nullable(),customerSignature:(0,ew.Xg)(),supplierSignature:(0,ew.Xg)(),requireReportRecommendations:(0,ew.Xg)(),estimatedDuration:(0,ew.Rx)().min(0),estimatedDurationUnit:(0,ew.Z_)()})))}),Z=x.control,y=x.errors,_=x.formState,A=x.handleSubmit,T=x.register,R=x.setValue,E=x.watch,P=(0,m.useState)(),k=P[0],M=P[1],V=(0,m.useState)(),$=V[0],L=V[1],F=E("tags",a.tags),N=E("customerSelected",a.customerSelected),W=E("customerUserSelected",a.customerUserSelected),z=E("locationSelected",a.locationSelected),O=E("pricing",a.pricing),J=E("serviceSelected",a.serviceSelected),Q=E("timing",a.timing),B=E("siteVisitReq",a.siteVisitReq),G=E("taxonomyId_ShortDesc"),X=E("assetCategorySelected",null==a?void 0:a.assetCategorySelected),Y=E("slaId"),K=E("permitsLinks"),ee=E("permitsAttachments"),en=(0,I.Z)(N),er=(0,I.Z)(W),ea=(0,I.Z)(z),es=(0,I.Z)(G),el=(0,D.a)(h.Ab,{skip:!(null==N?void 0:N.value)||!(null==z?void 0:z.value),variables:{customerId:null==N?void 0:N.value,locationId:null==z?void 0:z.value}}).data;(0,m.useEffect)(function(){if(void 0!==ea&&z!==ea?[{name:"access",value:(null==z?void 0:z.access)||""},{name:"coordinates",value:null}].forEach(function(e){var n;return R(e.name,e.value)}):N!==en&&en?[{name:"coordinates",value:null},{name:"customerUserSelected",value:null},{name:"locationSelected",value:null}].forEach(function(e){var n;return R(e.name,e.value)}):O&&!p.parentId&&!p.id&&[{name:"customerSpendThreshold",value:null==N?void 0:N.spendThreshold},{name:"amount",value:null==G?void 0:null===(d=G.meta)||void 0===d?void 0:null===(c=d.template)||void 0===c?void 0:c.amount},{name:"supplierLabourAmount",value:null==G?void 0:null===(m=G.meta)||void 0===m?void 0:null===(v=m.template)||void 0===v?void 0:v.supplierLabourAmount},{name:"supplierMaterialsAmount",value:null==G?void 0:null===(f=G.meta)||void 0===f?void 0:null===(h=f.template)||void 0===h?void 0:h.supplierMaterialsAmount}].forEach(function(e){var n;return R(e.name,e.value)}),G!==es&&!p.id&&!p.parentId){[{name:"title",value:null==G?void 0:null===(g=G.meta)||void 0===g?void 0:null===(x=g.template)||void 0===x?void 0:x.title},{name:"description",value:null==G?void 0:null===(Z=G.meta)||void 0===Z?void 0:null===(y=Z.template)||void 0===y?void 0:y.description},{name:"tags",value:(null==G?void 0:null===(b=G.meta)||void 0===b?void 0:null===(j=b.template)||void 0===j?void 0:j.tags)||[]},{name:"costCategorySelected",value:null==G?void 0:null===(I=G.meta)||void 0===I?void 0:null===(S=I.template)||void 0===S?void 0:S.costCategorySelected},{name:"serviceSelected",value:null==G?void 0:null===(w=G.meta)||void 0===w?void 0:null===(q=w.template)||void 0===q?void 0:q.serviceSelected},{name:"reportPassFail",value:(null==G?void 0:null===(C=G.meta)||void 0===C?void 0:null===(D=C.template)||void 0===D?void 0:D.reportPassFail)||!1},{name:"customerSignature",value:(null==G?void 0:null===(_=G.meta)||void 0===_?void 0:null===(A=_.template)||void 0===A?void 0:A.customerSignature)||!1},{name:"supplierSignature",value:(null==G?void 0:null===(T=G.meta)||void 0===T?void 0:null===(E=T.template)||void 0===E?void 0:E.customerSignature)||!1},{name:"reportPassFailTitle",value:null==G?void 0:null===(P=G.meta)||void 0===P?void 0:null===(k=P.template)||void 0===k?void 0:k.reportPassFailTitle},{name:"requireReportRecommendations",value:(null==G?void 0:null===(M=G.meta)||void 0===M?void 0:null===(V=M.template)||void 0===V?void 0:V.requireReportRecommendations)||!1}].forEach(function(e){var n;return R(e.name,e.value)});var e,n,t,i,r,o,a,s,l,u,d,c,m,v,f,h,g,x,Z,y,b,j,I,S,w,q,C,D,_,A,T,E,P,k,M,V,$,L=null==G?void 0:null===($=G.meta)||void 0===$?void 0:$.template;(null==L?void 0:L.amount)||(null==L?void 0:L.supplierLabourAmount)||(null==L?void 0:L.supplierMaterialsAmount)?R("pricing","fixed"):R("pricing",null)}G!==es&&[{name:"reportPassFail",value:(null==G?void 0:null===(e=G.meta)||void 0===e?void 0:null===(n=e.template)||void 0===n?void 0:n.reportPassFail)||!1},{name:"reportPassFailTitle",value:null==G?void 0:null===(t=G.meta)||void 0===t?void 0:null===(i=t.template)||void 0===i?void 0:i.reportPassFailTitle},{name:"customerSignature",value:(null==G?void 0:null===(r=G.meta)||void 0===r?void 0:null===(o=r.template)||void 0===o?void 0:o.customerSignature)||!1},{name:"supplierSignature",value:(null==G?void 0:null===(a=G.meta)||void 0===a?void 0:null===(s=a.template)||void 0===s?void 0:s.supplierSignature)||!1},{name:"requireReportRecommendations",value:(null==G?void 0:null===(l=G.meta)||void 0===l?void 0:null===(u=l.template)||void 0===u?void 0:u.requireReportRecommendations)||!1}].forEach(function(e){var n;return R(e.name,e.value)}),er&&(null==W?void 0:W.value)!==(null==er?void 0:er.value)&&R("locationSelected",null)},[N,null==W?void 0:W.value,z,en,er,ea,es,O,p.id,p.parentId,R,G]),(0,m.useEffect)(function(){if(Y&&!p.quoted){var e,n,t=(0,et.GU)("reactive",el),i=null===(e=null==t?void 0:t.find(function(e){return e.id===Number(Y)}))||void 0===e?void 0:e.onSite,r=null===(n=null==t?void 0:t.find(function(e){return e.id===Number(Y)}))||void 0===n?void 0:n.onSiteUnit;if(i&&r){var o=eI()(null==a?void 0:a.createdAt),s=eI()(null==a?void 0:a.createdAt).add(i,r),l=30-o.minute()%30,u=30-s.minute()%30;R("timing","between"),R("timingStart",o.clone().add(l,"minutes").toDate()),R("timingEnd",s.clone().add(u,"minutes").toDate())}}},[el,null==a?void 0:a.createdAt,p.quoted,R,Y]),(0,m.useEffect)(function(){if(Y&&p.quoted){var e,n,t=(0,et.GU)("quote",el),i=null===(e=null==t?void 0:t.find(function(e){return e.id===Number(Y)}))||void 0===e?void 0:e.quoteReturned,r=null===(n=null==t?void 0:t.find(function(e){return e.id===Number(Y)}))||void 0===n?void 0:n.quoteReturnedUnit;if(i&&r){var o=eI()(null==a?void 0:a.createdAt).add(i,r),s=30-o.minute()%30,l=o.clone().add(s,"minutes").toDate(),u=o.clone().add(s,"minutes").subtract(1,"day").toDate();R("quoteDue",l),R("quoteDueSupplier",u),L(l),M(u)}}},[el,null==a?void 0:a.createdAt,p.quoted,R,Y]),(0,m.useEffect)(function(){R("permitsAttachments",s.map(function(e){return{mediaId:e.mediaId,caption:e.media.caption,media:null,type:"",isAdded:!1}}))},[s,R]);var eu={control:Z,errors:y,register:T};return(0,r.jsxs)(S.Z,{handleSubmit:A(c),children:[(0,r.jsxs)(w.Z,{children:[(0,r.jsxs)(q.Z,{md:6,children:[f("admin")&&(0,r.jsx)(ev,(0,u.Z)((0,i.Z)({},eu),{user:g})),(0,r.jsx)(H,(0,u.Z)((0,i.Z)({},eu),{customerSelectedWatch:N,user:g,hasRole:f})),(null==d?void 0:d.type)!=="quote"&&!p.quoted&&(0,r.jsx)(eT,{register:T,control:Z}),z&&f(["admin","customer","tenant"])&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eo,(0,u.Z)((0,i.Z)({},eu),{dataSlas:el,currentAnswers:a.questions,jobId:null==d?void 0:d.id,locationSelectedWatch:z,taxonomyWatch:G,prevTaxonomy:es,watch:E,isQuote:p.quoted,isPPM:"ppm"===a.type,tagsWatch:F,setValue:R})),!p.quoted&&f(["admin","customer"])&&(0,r.jsx)(eq.t,(0,i.Z)({},eu)),!p.quoted&&f("admin")&&(0,r.jsx)(eZ.n,(0,u.Z)((0,i.Z)({},eu),{pricingWatch:O,hasServiceRate:!!(null==N?void 0:N.serviceRateLabour)||!!(null==N?void 0:N.serviceRateExpenses),serviceSelectedWatch:J,isPPM:(null==d?void 0:d.type)==="ppm"})),!p.quoted&&(0,r.jsx)(eC.X,(0,u.Z)((0,i.Z)({},eu),{hasRole:f,query:p,setValue:R,timingWatch:Q,watch:E}))]})]}),(0,r.jsxs)(q.Z,{md:6,children:[N&&(0,r.jsx)(em,(0,u.Z)((0,i.Z)({},eu),{setValue:R,assetCategoryWatch:X,customerSelectedWatch:N,customerUserSelectedWatch:W,locationSelectedWatch:z})),(null==z?void 0:z.permitsRequired)&&f(["admin","customer"])&&(0,r.jsx)(eM.s,{title:"Location permits",children:(0,r.jsx)(eP,{setValue:R,permitsLinks:K,attachmentsPermits:ee,onDeleteExistingMedia:l})}),z&&(0,r.jsxs)(r.Fragment,{children:[p.quoted&&(0,r.jsx)(eS,(0,u.Z)((0,i.Z)({},eu),{siteVisitWatch:B,watch:E,quoteReturnedTimingEndSupplier:k,quoteReturnedTimingEndCustomer:$})),p.ppm&&(0,r.jsx)(ex,(0,u.Z)((0,i.Z)({},eu),{locationId:z.value})),!d&&(0,r.jsx)(U,{locationId:z.value,serviceId:(null==J?void 0:J.value)||null})]})]})]}),(0,r.jsx)("input",(0,i.Z)({type:"hidden"},T("permitsLinks"))),(0,r.jsx)("input",(0,i.Z)({type:"hidden"},T("permitsAttachments"))),(0,r.jsx)("input",(0,i.Z)({type:"hidden"},T("tags"))),(0,r.jsx)(C.Z,{content:"Submit",disabled:_.isSubmitting,size:"lg",type:"submit"})]})};eV.propTypes={defaultValues:Z.object.isRequired,job:Z.object,onSubmit:Z.func.isRequired,query:Z.object.isRequired};var e$=t(64811),eL=t(19512),eU=t(84808),eF=t(98456),eN=t(46242),eW=t(62153),ez=function(e){var n=(0,ei.x)(),t=n.hasRole,o=n.user,s=(0,p.x)(),Z=(0,eL.D)(),y=(0,eW.useMainContext)(),b=y.predefinedAssetForWorkOrder,j=y.setPredefinedAssetForWorkOrder,I=(0,m.useState)(!0),S=I[0],w=I[1],q="/dashboard/issues/",C=e.accountId||0,D=e.locationId||0,_=e.parentId||0,A=e.assetId||0,T=e.recall||null;t("customer")&&(C=o.accountId);var R,E,P,k=(0,d.Z)((0,v.t)(h.E6,{skip:!e.id,variables:{adminId:o.adminId,number:"".concat(e.id)},onError:function(e){Z.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),M=k[0],V=k[1],$=V.loading,L=V.data,U=(void 0===L?{job:null}:L).job,F=U&&U[0],N=(0,eN.z)("Job",o.adminId,o.id,null==F?void 0:F.id,"supportingDocuments"),W=N.createMediaInput,z=N.preloadedMedia,O=N.deleteMediaByEntity,J=N.loadingDeleteMedia,H=(0,d.Z)((0,v.t)(h.TY,{onError:function(e){Z.show({content:"Error: ".concat(e.message),severity:"error"})},variables:{accountId:C,locationId:D,parentId:_,assetId:A,includeAccount:!!C,includeLocation:!!D,includeParentJob:!!_,includeAsset:!!A}}),2),Q=H[0],B=H[1],G=B.loading,X=B.data,Y=(0,d.Z)((0,f.D)(g.xM,{onError:function(e){Z.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),K=Y[0],ee=Y[1].loading,en=(0,d.Z)((0,f.D)(g.tv,{onError:function(e){Z.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),er=en[0],eo=en[1].loading,ea=(0,d.Z)((0,f.D)(h.mJ,{onError:function(e){Z.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:(R=(0,l.Z)(function(n){var t,i,r,u,d,m;return(0,c.__generator)(this,function(u){switch(u.label){case 0:return i=(t=n.createJob.data.insert_Job.returning[0]).id,r=t.number,[4,(0,e$.F)(s,i)];case 1:if(u.sent(),!(_&&"true"===T))return[3,4];return[4,ed({variables:{objects:[{notes:"Marked as dispute because of creating a recall job",status:"inDispute",jobId:e.parentId,userId:o.id}]}})];case 2:var m;return u.sent(),[4,K({variables:{objects:{caption:"report for recall job",expiryAt:null,extension:null==(d=e.report)?void 0:d.split(".").pop(),userId:o.id,filename:d,type:"document"}}}).then((m=(0,l.Z)(function(e){var n,t,r;return(0,c.__generator)(this,function(n){switch(n.label){case 0:return[4,er({variables:{objects:r={mediaId:e.data.insert_Media.returning[0].id,entity:"Job",entityId:i}}})];case 1:return n.sent(),[2]}})}),function(e){return m.apply(this,arguments)}))];case 3:u.sent(),u.label=4;case 4:return a().push("".concat(q,"view?id=").concat(r)),[2]}})}),function(e){return R.apply(this,arguments)})}),2),es=ea[0],el=ea[1].loading,eu=(0,d.Z)((0,f.D)(h.r2,{onError:function(e){Z.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),ed=eu[0],ec=eu[1].loading,em=(0,d.Z)((0,f.D)(h.uA,{onCompleted:(E=(0,l.Z)(function(e){var n;return(0,c.__generator)(this,function(t){switch(t.label){case 0:return[4,(0,e$.F)(s,F.id)];case 1:return t.sent(),n=e.update_Job_by_pk.number,a().push("".concat(q,"view?id=").concat(n)),[2]}})}),function(e){return E.apply(this,arguments)})}),2),ep=em[0],ev=em[1].loading;(0,m.useEffect)(function(){e.id?M():C||D||_?Q():w(!1)},[]),(0,m.useEffect)(function(){!$&&F?w(!1):!G&&X&&w(!1)},[$,G]);var ef=(P=(0,l.Z)(function(n){var r,a,s,l,d,m,p,v,f;return(0,c.__generator)(this,function(c){switch(c.label){case 0:return r=(0,et.eD)(n,null==F?void 0:F.id),[4,W(n.permitsAttachments,"supportingDocuments")];case 1:return a=c.sent(),delete n.permitsAttachments,[4,(0,et.lV)({query:e,data:(0,i.Z)({},(0,u.Z)((0,i.Z)({},n),{meta:null!==(s=null==F?void 0:F.meta)&&void 0!==s?s:{}}),a||{}),hasRole:t,user:o,type:eh.type})];case 2:if(l=c.sent(),!(!e.id||e.parentId))return[3,4];return[4,es({variables:{adminId:o.adminId,objects:[l]}})];case 3:return c.sent(),[3,6];case 4:return p=[],v=eh.assetSelected.map(function(e){return e.assetId}),(null===(d=l.Assets)||void 0===d?void 0:null===(m=d.data)||void 0===m?void 0:m.length)>0&&(p=l.Assets.data.map(function(e){return(0,u.Z)((0,i.Z)({},e),{entityId:F.id})}),delete l.Assets),f=(0,et.A5)(F.id,l),delete l.Taxonomy,[4,ep({variables:{jobId:F.id,changes:l,deletedAssetIds:v,assets:p,questions:r,media:f,hasQuestions:(null==r?void 0:r.length)>0}})];case 5:c.sent(),c.label=6;case 6:return[2]}})}),function(e){return P.apply(this,arguments)});if((0,m.useEffect)(function(){return function(){j(null)}},[j]),F&&((0,x.E)(F,"accepted")&&!t("admin")||(0,x.E)(F,"inProgress")))return(0,r.jsx)("p",{children:"Work order can't be edited after started by supplier"});var eh={};return b?eh=(0,et.Pu)(b,t,o):S||(eh=e.id?F?(0,et.I2)(F):null:(0,et.$z)(X,t,o,T)),(0,r.jsxs)(r.Fragment,{children:[(S||$||J||G||ee||eo||el||ec||ev)&&(0,r.jsx)(eU.Z,{open:!0,sx:{zIndex:1e5},children:(0,r.jsx)(eF.Z,{color:"secondary"})}),!S&&eh&&(0,r.jsx)(eV,{defaultValues:eh,job:e.id?F:null,onSubmit:ef,preloadedMedia:z,deleteMediaByEntity:O,query:e})]})},eO=function(){var e=(0,o.useRouter)().query,n=e.id?"Edit":"Create",t="Work Order";return t=e.quoted?"Quote":t,t=e.ppm?"PPM":t,(0,r.jsx)(s.Z,{pageHeading:{heading:"".concat(n," ").concat(t)},View:(0,r.jsx)(ez,(0,i.Z)({},e))})}}},function(e){e.O(0,[3662,2283,212,8890,9511,2583,6310,4599,4135,8579,4244,7645,3776,1564,3054,1023,3911,1417,6540,3425,5037,1352,4043,1207,3704,6110,8359,6557,3057,8395,9774,2888,179],function(){return e(e.s=31932)}),_N_E=e.O()}]);