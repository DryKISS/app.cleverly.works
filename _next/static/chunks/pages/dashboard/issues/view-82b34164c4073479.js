(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9312],{33152:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/issues/view",function(){return t(69232)}])},17868:function(e,n,t){"use strict";t.d(n,{z:function(){return a}});var i=t(7297),r=t(75063);function o(){var e=(0,i.Z)(["\n  fragment AccountFields on Account {\n    id\n    type\n    name\n    status\n    vatId\n  }\n"]);return o=function(){return e},e}var a=(0,r.Ps)(o())},4595:function(e,n,t){"use strict";t.d(n,{F:function(){return R}});var i=t(14924),r=t(26042),o=t(69396),a=t(85893),s=t(45697),u=t.n(s),l=t(10166),c=t(80482),d=t(23776),p=t(98456),m=t(16143),f=t(50135),v=t(99534),h=t(29815),b=t(74061),g=t(6498),x=t(75438),j=t(15861),y=t(61730),Z=t(67294),I=(0,Z.createContext)({}),S=(0,Z.forwardRef)(function(e,n){var t=(0,Z.useContext)(I);return(0,a.jsx)("div",(0,r.Z)({ref:n},e,t))}),w=(0,Z.forwardRef)(function(e,n){var t=e.children,i=(0,v.Z)(e,["children"]),r=[];t.forEach(function(e){r.push(e),r.push.apply(r,(0,h.Z)(e.children||[]))});var o,s,u=(0,g.u)(),l=(0,y.Z)(u.breakpoints.up("sm"),{noSsr:!0}),c=r.length,d=l?36:48,p=function(e){return e.hasOwnProperty("group")?48:d},m=(s=(0,Z.useRef)(null),(0,Z.useEffect)(function(){null!=s.current&&s.current.resetAfterIndex(0,!0)},[c]),s);return(0,a.jsx)("div",{ref:n,children:(0,a.jsx)(I.Provider,{value:i,children:(0,a.jsx)(b.S_,{itemData:r,height:(c>8?8*d:r.map(p).reduce(function(e,n){return e+n},0))+16,width:"100%",ref:m,outerElementType:S,innerElementType:"ul",itemSize:function(e){return p(r[e])},overscanCount:5,itemCount:c,children:C})})})});function C(e){var n=e.data,t=e.index,i=e.style,s=n[t],u=(0,o.Z)((0,r.Z)({},i),{top:i.top+8});return s.hasOwnProperty("group")?(0,a.jsx)(x.Z,{component:"div",style:u,children:s.group},s.key):(0,a.jsx)(j.Z,(0,o.Z)((0,r.Z)({component:"li"},s[0]),{noWrap:!0,style:u,children:s[1].label}))}var R=function(e){var n=e.label,t=e.loading,i=e.placeholder,s=e.error,u=e.helperText,l=e.inputProps;return(0,a.jsx)(_,(0,o.Z)((0,r.Z)({},e),{disableListWrap:!0,PopperComponent:q,ListboxComponent:w,renderInput:function(e){return(0,a.jsx)(f.Z,(0,o.Z)((0,r.Z)({},e,l),{error:s,helperText:u,label:n,placeholder:i,color:"secondary",variant:"standard",InputProps:(0,o.Z)((0,r.Z)({},e.InputProps,(null==l?void 0:l.InputProps)||{}),{endAdornment:(0,a.jsxs)(a.Fragment,{children:[t?(0,a.jsx)(p.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},renderOption:function(e,n,t){return[e,n,t.index]},renderGroup:function(e){return e}}))};R.defaultProps={value:null,onChange:function(){},label:"",loading:!1,error:!1,onOpen:function(){},options:[],inputProps:{},withoutSelectIcon:!1},R.propTypes={value:u().shape({value:u().any,label:u().string}),onChange:u().func,label:u().string,loading:u().bool,onOpen:u().func,options:u().arrayOf(u().shape({value:u().any,label:u().string})),inputProps:u().object,withoutSelectIcon:u().bool,inputValue:u().string,onInputChange:u().func};var q=(0,l.Z)(m.Z)((0,i.Z)({zIndex:"12000 !important"},"& .".concat(c.Z.listbox),{boxSizing:"border-box","& ul":{padding:0,margin:0}})),_=(0,l.Z)(d.Z)(function(e){var n=e.withoutSelectIcon;return{"& .MuiAutocomplete-root":{cursor:"pointer"},"& .MuiAutocomplete-popper":{zIndex:"12000 "},"& .MuiAutocomplete-endAdornment":{"& .MuiButtonBase-root.MuiIconButton-root.MuiAutocomplete-popupIndicator":{"& .MuiSvgIcon-root":(0,r.Z)({},n&&{display:"none"})}}}})},38944:function(e,n,t){"use strict";t.d(n,{L:function(){return i}});var i=function(e){for(var n="",t=e.slice().sort(function(e,n){return Number(e.id)-Number(n.id)}),i=t.length-1;i>=0;i--){var r=t[i].status;if("onHold"===r||"resumed"===r||"paused"===r||"continued"===r){n=t[i].status;break}}return n}},53600:function(e,n,t){"use strict";t.d(n,{E:function(){return i}});var i=function(e,n){if(Array.isArray(n)){var t,i=null;return n.forEach(function(n){var t,r=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});i=(null==r?void 0:r.createdAt)||i}),i}var r=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});return(null==r?void 0:r.createdAt)||null}},52324:function(e,n,t){"use strict";t.d(n,{OQ:function(){return u},Pn:function(){return r},TT:function(){return o},Xd:function(){return a},aH:function(){return i},nN:function(){return s}});var i=function(e,n,t){var i,r=null===(i=null==n?void 0:n.slice())||void 0===i?void 0:i.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdApproval")&&t===n.quoteId})},r=function(e,n,t){var i,r=null===(i=null==n?void 0:n.slice())||void 0===i?void 0:i.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdApproved")&&t===n.quoteId})},o=function(e,n,t){var i,r=null===(i=null==n?void 0:n.slice())||void 0===i?void 0:i.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdRejected")&&t===n.quoteId})},a=function(e,n){var t,i=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});return null==i?void 0:i.find(function(n){return n.status==="".concat(e,"ThresholdApproval")})},s=function(e,n){var t,i=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});if(Array.isArray(e)){var r=null;return e.forEach(function(e){r=(null==i?void 0:i.find(function(n){return n.status==="".concat(e,"ThresholdApproved")}))||r}),r}return null==i?void 0:i.find(function(n){return n.status==="".concat(e,"ThresholdApproved")})},u=function(e,n){var t,i=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});return null==i?void 0:i.find(function(n){return n.status==="".concat(e,"ThresholdRejected")})}},64732:function(e,n,t){"use strict";t.d(n,{n:function(){return f}});var i=t(26042),r=t(69396),o=t(85893),a=t(45697),s=t(11585),u=t(90951),l=t(28497),c=t(15214),d=t(9270),p=t(62140),m=t(99988),f=function(e){var n=e.errors,t=e.register,a=e.pricingWatch,f=e.hasServiceRate,v=e.isPPM,h={register:t,errors:n},b=m.Hu.filter(function(e){var n=e.value;return!v||"fixed"===n});return(0,o.jsxs)(s.Z,{dataSet:{"data-cy":"pricing"},open:!0,title:"Pricing",children:[(0,o.jsx)(u.Z,(0,r.Z)((0,i.Z)({},h),{data:b,legend:"Pricing",name:"pricing"})),"time-materials"===a&&(0,o.jsx)(l.Z,(0,r.Z)((0,i.Z)({},h),{label:"Spend Threshold",name:"customerSpendThreshold",vat:"Ex VAT"})),"fixed"===a&&(0,o.jsxs)(o.Fragment,{children:[f?(0,o.jsx)(c.Z,{content:"This customer has a service rate on their account. //@ts-ignore The customer amounts will be calculated using the relevant service rates.",context:"info"}):(0,o.jsx)(l.Z,(0,r.Z)((0,i.Z)({},h),{label:"Customer",name:"amount",vat:"Ex VAT"})),(0,o.jsxs)(d.Z,{children:[(0,o.jsx)(p.Z,{sm:12,md:6,children:(0,o.jsx)(l.Z,(0,r.Z)((0,i.Z)({},h),{label:"Supplier labour amount",name:"supplierLabourAmount",vat:"Ex VAT"}))}),(0,o.jsx)(p.Z,{sm:12,md:6,children:(0,o.jsx)(l.Z,(0,r.Z)((0,i.Z)({},h),{label:"Supplier materials amount",name:"supplierMaterialsAmount",vat:"Ex VAT"}))})]})]})]})};f.propTypes={errors:a.object.isRequired,pricingWatch:a.string,register:a.func.isRequired,hasServiceRate:a.bool,isPPM:a.bool}},79772:function(e,n,t){"use strict";t.d(n,{t:function(){return c}});var i=t(26042),r=t(69396),o=t(85893),a=t(45697),s=t(11585),u=t(536),l=t(20390),c=function(e){var n=e.control,t=e.errors,a={control:n,errors:t,register:e.register};return(0,o.jsxs)(s.Z,{dataSet:{"data-cy":"taxonomy"},open:!0,title:"Service",children:[(0,o.jsx)(l.l,(0,r.Z)((0,i.Z)({},a),{label:"Cost category",name:"costCategorySelected",type:"costCategory"})),(0,o.jsx)(u.P,(0,r.Z)((0,i.Z)({},a),{errors:(0,i.Z)({},t),name:"serviceSelected",label:"Service",type:"service"}))]})};c.propTypes={control:a.object.isRequired,errors:a.object.isRequired,register:a.func.isRequired}},72790:function(e,n,t){"use strict";t.d(n,{X:function(){return R}});var i=t(82670),r=t(26042),o=t(69396),a=t(85893),s=t(67294),u=t(45697),l=t(11585),c=t(49501),d=t(95103),p=t(90951),m=t(9270),f=t(62140),v=t(58594),h=t(40552),b=t(99988),g=[{text:"Select...",value:""},{text:"Today",value:"today"},{text:"This week",value:"thisWeek"},{text:"This month",value:"thisMonth"},{text:"Next Three month",value:"nextThreeMonth"}],x=t(4135),j=t(43703),y=t(11640),Z=t(83894),I=t(69119),S=t(67090),w=function(){var e=(0,x.Z)(new Date),n=(0,j.Z)(new Date),t=(0,x.Z)((0,y.Z)(new Date(n),2)),i=(0,Z.Z)(new Date),r=(0,I.Z)(new Date),o=(0,S.Z)(new Date);return{monthEnd:e,nextThreeEnd:t,todayEnd:i,todayStart:r,weekEnd:o}},C=b.KB,R=function(e){var n=e.control,t=e.errors,u=e.hasRole,x=e.query,j=e.register,y=e.setValue,Z=e.timingWatch,I=e.watch,S={control:n,errors:t,register:j},R=u("customer")&&!u("admin"),q=I("pricing"),_=I("timingStart"),T=I("timingEnd"),A=I("multipleDays"),E=I("timeSpan"),D=I("timing");(0,s.useEffect)(function(){R&&(C=b.KB.filter(function(e){return"at"!==e.value}),y("timing","between")),E&&P({time:E,setValue:y})},[E]),(0,s.useEffect)(function(){"at"===D&&y("timeSpan","")},[D]);var P=function(e){var n,t,i=e.time,r=e.setValue,o=w(),a=o.monthEnd,s=o.todayStart,u=o.weekEnd,l=o.todayEnd,c=o.nextThreeEnd;switch(i){case"today":n=s,t=l;break;case"thisWeek":n=s,t=u;break;case"thisMonth":n=s,t=a;break;case"nextThreeMonth":n=s,t=c}r("timing","between"),r("timingStart",n),r("timingEnd",t)},k=function(e){var n=new Date,t=new Date(e);return n.getTime()<t.getTime()},$=function(e){var n=_?new Date(_):new Date,t=new Date(e);return n.getTime()<t.getTime()};return(0,a.jsxs)(l.Z,{dataSet:{"data-cy":"timing"},open:!0,title:"Timing",children:[!(null==x?void 0:x.id)&&y&&(0,a.jsx)(c.Z,{label:"Select Time span",children:(0,a.jsx)(d.Z,(0,o.Z)((0,r.Z)({},S),{name:"timeSpan",options:g}))}),(0,a.jsx)(p.Z,(0,o.Z)((0,r.Z)({},S),{data:C,legend:"Timing",name:"timing"})),(0,a.jsxs)(m.Z,{children:[(0,a.jsxs)(f.Z,{md:12,children:[(0,a.jsx)(c.Z,{label:"Start time"}),(0,a.jsx)(h.M,(0,o.Z)((0,r.Z)({},S),{dateFormat:"d MMM yyyy HH:mm",maxDate:T?new Date(T):null,minDate:new Date,filterTime:k,name:"timingStart",placeholder:"Click to select Start time",showTimeSelect:!0,todayButton:!1}))]}),"at"!==Z&&(0,a.jsxs)(f.Z,{md:12,children:[(0,a.jsx)(c.Z,{label:"End time"}),(0,a.jsx)(h.M,(0,o.Z)((0,r.Z)({},S),{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,minDate:_?new Date(_):new Date,filterTime:$,name:"timingEnd",showTimeSelect:!0,todayButton:!1}))]})]}),(0,i.Z)(_,Date)&&"fixed"===q&&(0,a.jsx)(v.Z,(0,o.Z)((0,r.Z)({},S),{data:[{id:"multipleDays",label:"Multiple days"}],name:"multipleDays"})),A&&(0,a.jsx)(c.Z,{label:"End Date",children:(0,a.jsx)(h.M,(0,o.Z)((0,r.Z)({},S),{dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!0,filterTime:$,minDate:_?new Date(_):new Date,name:"endDate",showTimeSelect:!0,todayButton:!1}))}),u("admin")&&(0,a.jsx)(v.Z,(0,o.Z)((0,r.Z)({},S),{data:[{id:"allowTimingNormalHours",label:"Allow premium rates to be used",value:"allowTimingNormalHours"}],name:"allowTimingNormalHours"}))]})};R.propTypes={control:u.object.isRequired,errors:u.object.isRequired,query:u.object.isRequired,register:u.func.isRequired,setValue:u.func,timingWatch:u.string}},20725:function(e,n,t){"use strict";t.d(n,{H_:function(){return b},aL:function(){return f},pf:function(){return v},sW:function(){return j},wd:function(){return h},xY:function(){return g},yT:function(){return x}});var i=t(7297),r=t(75063),o=t(22666);function a(){var e=(0,i.Z)(["\n  fragment JobFields on Job {\n    access\n    issueReportedDescription\n    adminId\n    costCategory\n    createdAt\n    description\n    id\n    meta\n    pricing\n    reference\n    scheduledAt\n    status\n    supplierLabourAmount\n    supplierMaterialsAmount\n    timing\n    timingEnd\n    timingNormalHours\n    timingStart\n    title\n    type\n    siteVisitStart\n    siteVisitEnd\n    siteVisitWeekends\n    amount\n    number\n    quoted\n    timingStatus\n    correctDuration\n    correctStart\n    correctEnd\n  }\n"]);return a=function(){return e},e}function s(){var e=(0,i.Z)(["\n  fragment JobQuoteFields on Job {\n    quoted\n    quoteNumber\n    quoteDue\n    quoteDueSupplier\n    quoteCharge\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,i.Z)(["\n  fragment JobAdminFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]);return u=function(){return e},e}function l(){var e=(0,i.Z)(["\n  fragment JobSupplierFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]);return l=function(){return e},e}function c(){var e=(0,i.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n    $_append: Job_append_input = {}\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes, _append: $_append) {\n      id\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,i.Z)(["\n  mutation InsertJobTiming($timing: [JobTiming_insert_input!]!) {\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return d=function(){return e},e}function p(){var e=(0,i.Z)(['\n  query GetJobHistory(\n    $jobId: Int\n    $locationId: Int!\n    $limit: Int\n    $offset: Int\n    $serviceId: Int\n    $startDate: timestamptz!\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      id\n      title\n      status\n      scheduledAt\n      createdAt\n      meta\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return p=function(){return e},e}function m(){var e=(0,i.Z)(['\n  query GetJobOffCanvas($jobId: Int!) {\n    job: Job_by_pk(id: $jobId) {\n      access\n      costCategory\n      customerSpendThreshold\n      description\n      supplierLabourAmount\n      supplierMaterialsAmount\n      quoteDue\n      quoteNumber\n      id\n      number\n      meta\n      paymentMethod\n      reference\n      status\n      title\n      type\n      quoted\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n      }\n      quotations: SupplierQuotes {\n        id\n        quoteNumber\n        status\n        lineItems: SupplierQuoteLineItems {\n          id\n          description\n          item\n          qty\n          qtyUnit\n          quoteId\n          total\n          type\n          unitRate\n          supplierTotal\n        }\n        supplier: Supplier {\n          id\n          type\n          name\n          accountUsers: Account_Users {\n            user: User {\n              id\n              fullName\n              nameFirst\n              nameLast\n              phone\n              email\n              devices: UserDevices(where: { status: { _eq: "active" } }) {\n                id\n                playerId\n              }\n            }\n          }\n        }\n      }\n      admin: Admin {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      customer: Customer {\n        id\n        name\n        website\n        slas: SLAs(where: { entity: { _eq: "Account" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        nameFirst\n        nameLast\n        fullName\n        email\n        phone\n      }\n      supplier: Supplier {\n        id\n        name\n        contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n          id\n          role\n          position\n          isContact\n          lastSignInAt\n          userId\n          user: User {\n            id\n            fullName\n            nameFirst\n            nameLast\n            email\n            phone\n          }\n        }\n      }\n      supplierUser: SupplierUser {\n        id\n        fullName\n        nameFirst\n        nameLast\n        email\n        phone\n      }\n      location: Location {\n        id\n        name\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      costCategoryTaxonomy: CostCategory {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n  ',"\n  ","\n"]);return m=function(){return e},e}var f=(0,r.Ps)(a()),v=(0,r.Ps)(s()),h=(0,r.Ps)(u()),b=(0,r.Ps)(l()),g=(0,r.Ps)(c()),x=(0,r.Ps)(d()),j=(0,r.Ps)(p());(0,r.Ps)(m(),o.WW,o.MR)},97229:function(e,n,t){"use strict";t.d(n,{e:function(){return m}});var i,r=t(47568),o=t(97582),a=t(26186),s=t(26535),u=t(53600),l=t(96715),c=t(31312),d=t(35374),p=t(48764).Buffer,m=(i=(0,r.Z)(function(e){var n,t,i,r,m,f,v,h,b,g,x,j,y,Z,I,S,w,C,R,q,_,T,A,E,D,P,k,$,H,M;return(0,o.__generator)(this,function(o){switch(o.label){case 0:return n=e.adminId,t=e.job,r=void 0===(i=e.openReport)||i,E=function(){return t.media.filter(function(e){var n;return"image"===e.item.type&&!(null===(n=e.item.meta)||void 0===n?void 0:n.adminOnly)}).map(function(e){var n,t;if(null===(n=e.item)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:t.thumbnails){var i=e.item.meta.thumbnails.find(function(e){return"small"===e.name});if(i)return{filename:i.relativePath}}return{filename:e.item.filename}})},D=(0,s.WE)(t.location,"registered"),P=c.hD.find(function(e){var n;return e.value===(null===(n=t.report)||void 0===n?void 0:n.completion)}),$={job:{assets:t.assets,address:null==D?void 0:D.address,sublocation:t.sublocation,contractor:null===(m=t.supplier)||void 0===m?void 0:m.name,completedAt:"incorrect"===t.timingStatus?t.correctEnd:(0,a.Z)((0,u.E)(t,"completed")),customer:null===(f=t.customer)||void 0===f?void 0:f.name,description:p.from(t.description).toString("base64"),expenses:null===(v=t.expenses)||void 0===v?void 0:v.map(function(e){return e.description}),further:(null==P?void 0:P.text)||null,id:t.id,notes:(null===(h=t.report)||void 0===h?void 0:h.notes)?p.from(null==t?void 0:null===(b=t.report)||void 0===b?void 0:b.notes).toString("base64"):"",number:t.number,raisedBy:(0,l.j$)(t,"pending"),reference:t.reference,service:null===(g=t.service)||void 0===g?void 0:g.name,dateStart:"incorrect"===t.timingStatus?t.correctStart:(0,u.E)(t,"inProgress"),dateEnd:"incorrect"===t.timingStatus?t.correctEnd:(0,u.E)(t,"completed"),priority:null===(x=t.sla)||void 0===x?void 0:x.name,passFailStatus:null===(j=t.report)||void 0===j?void 0:j.passFailStatus,customerSignature:(null===(y=t.report)||void 0===y?void 0:null===(Z=y.meta)||void 0===Z?void 0:Z.customerSignatureName)?{name:null===(I=t.report)||void 0===I?void 0:I.meta.customerSignatureName,data:null===(S=t.report)||void 0===S?void 0:S.meta.customerSignatureTime}:null,supplierSignature:(null===(w=t.report)||void 0===w?void 0:null===(C=w.meta)||void 0===C?void 0:C.supplierSignatureName)?{name:null===(R=t.report)||void 0===R?void 0:R.meta.supplierSignatureName,data:null===(q=t.report)||void 0===q?void 0:q.meta.supplierSignatureTime}:null,recommendations:(null===(_=t.report)||void 0===_?void 0:_.recommendations)?p.from(null===(T=t.report)||void 0===T?void 0:T.recommendations).toString("base64"):""},jobReportId:null!==(k=null===(A=t.report)||void 0===A?void 0:A.id)&&void 0!==k?k:null,adminId:n,media:E()},!(0,d.a)()&&r&&(H=window.open("/download","_blank")),[4,window.fetch("".concat("https://aws.cleverly.works","/pdf/job-report/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify($)}).then(function(e){return e.json()}).then(function(e){if(r){var n,t,i;null==H||null===(n=H.location)||void 0===n||n.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)),(null==window?void 0:null===(t=window.Capacitor)||void 0===t?void 0:null===(i=t.Plugins)||void 0===i?void 0:i.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)})}return{blob:e,link:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)}})];case 1:return[2,o.sent()]}})}),function(e){return i.apply(this,arguments)})},51539:function(e,n,t){"use strict";t.d(n,{L:function(){return h},g:function(){return v}});var i=t(47568),r=t(7297),o=t(97582),a=t(26535),s=t(35374),u=t(75063),l=t(48764).Buffer;function c(){var e=(0,r.Z)(["\n  mutation PDFQuoteCreate($data: jsonb!) {\n    pdfQuoteCreate(data: $data) {\n      success\n      key\n    }\n  }\n"]);return c=function(){return e},e}var d,p,m,f=(d=(0,i.Z)(function(e,n){var t,i,r,s,u,c,d,p,m,f,v;return(0,o.__generator)(this,function(o){return(c=[],d=[],p=null,p=n?e.quotations.find(function(e){return e.id===n}):e.quotations.find(function(e){return"supplierQuoteSent"===e.status}))?(p.lineItems.forEach(function(e){var n={name:e.description,price:e.total,vatRate:.2,qty:e.qty,unit:e.qtyUnit,rate:e.unitRate};"Materials"===e.type?d.push(n):"Labour"===e.type&&c.push(n)}),m=(0,a.WE)(null==e?void 0:e.location,"registered"),f=(null===(t=p.meta)||void 0===t?void 0:t.terms)||(null==e?void 0:null===(i=e.admin)||void 0===i?void 0:null===(r=i.meta)||void 0===r?void 0:null===(s=r.quote)||void 0===s?void 0:s.terms)||"",[2,{id:p.id,job:{currency:"\xa3",customerName:null===(u=e.customer)||void 0===u?void 0:u.name,startDate:p.startDate,description:l.from(e.description).toString("base64"),duration:p.totalDuration?1===p.totalDuration?"".concat(p.totalDuration," ").concat(p.totalDurationUnit):"".concat(p.totalDuration," ").concat(p.totalDurationUnit,"s"):"-",number:e.number,reference:(null==e?void 0:e.reference)||"",labour:c,materials:d,methodStatement:p.methodStatement,propertyAddress:null==m?void 0:m.address,sublocation:e.sublocation,terms:l.from(f).toString("base64")}}]):[2,null]})}),function(e,n){return d.apply(this,arguments)}),v=(p=(0,i.Z)(function(e){var n,t,i,r,a,u,l,c=arguments;return(0,o.__generator)(this,function(o){switch(o.label){case 0:n=c.length>1&&void 0!==c[1]?c[1]:null,t=c.length>2?c[2]:void 0,o.label=1;case 1:return o.trys.push([1,3,,4]),(0,s.a)()||(a=window.open("/download","_blank")),[4,h(e,n,t)];case 2:if(!(u=o.sent()))throw Error("Failed to download quote");return(null==a?void 0:a.location)&&(null==a||null===(l=a.location)||void 0===l||l.assign(u)),(null==window?void 0:null===(i=window.Capacitor)||void 0===i?void 0:null===(r=i.Plugins)||void 0===r?void 0:r.Browser)&&window.Capacitor.Plugins.Browser.open({url:u}),[3,4];case 3:return o.sent(),[3,4];case 4:return[2]}})}),function(e){return p.apply(this,arguments)}),h=(m=(0,i.Z)(function(e){var n,t,i,r,a,s,u,l,c,d=arguments;return(0,o.__generator)(this,function(r){switch(r.label){case 0:return n=d.length>1&&void 0!==d[1]?d[1]:null,t=d.length>2?d[2]:void 0,[4,f(e,n)];case 1:if(!(i=r.sent()))return[3,3];return[4,t.mutate({mutation:b,variables:{data:i}})];case 2:if(l=(u=(void 0===(a=r.sent().data)?{pdfQuoteCreate:{}}:a).pdfQuoteCreate).success,c=u.key,!l)throw Error("Failed to create PDF");return[2,"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(c)];case 3:return[2,null]}})}),function(e){return m.apply(this,arguments)}),b=(0,u.Ps)(c())},70519:function(e,n,t){"use strict";t.d(n,{v:function(){return Z}});var i=t(14924),r=t(85893),o=t(45697),a=t.n(o),s=t(60888),u=t(59462),l=t(5616),c=t(11057),d=t(19370),p=t(51233),m=t(44472),f=t(14621),v=t(57249),h=t(10556),b=t(70490),g=t(66647),x=t(1698),j=t(15861),y=t(90948),Z=function(e){var n=e.steps,t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(function(e){return!!e.active})},i=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(function(e){var n=e.active,t=e.data;return!!n&&!!t})};return(0,r.jsx)(l.Z,{children:(0,r.jsx)(d.Z,{orientation:"vertical",connector:(0,r.jsx)(I,{}),children:n.filter(function(e){var n=e.active;return void 0===n||n}).map(function(e,n){var o=e.id,a=e.label,d=e.info,f=e.date,v=e.content,h=e.actions,b=!!f,g=i(v),x=t(h),y=b?(0,r.jsx)(s.Z,{color:"primary"}):(0,r.jsx)(u.Z,{color:"primary"});return(0,r.jsxs)(m.Z,{completed:b,expanded:!0,children:[(0,r.jsxs)(w,{icon:y,children:[(0,r.jsx)(j.Z,{sx:{fontSize:"13px",fontWeight:600},children:a}),(0,r.jsx)(j.Z,{sx:{fontSize:"10px",fontWeight:400,ml:3,opacity:.6},children:f})]}),(0,r.jsxs)(S,{children:[(0,r.jsx)(l.Z,{children:b||(null==g?void 0:g.length)>0?g.map(function(e){return"function"==typeof e.data?e.data():(0,r.jsx)(j.Z,{sx:{fontSize:"10px"},children:e.data})}):(0,r.jsx)(j.Z,{sx:{fontSize:"10px",fontStyle:"italic"},children:d})}),(null==x?void 0:x.length)>0&&(0,r.jsx)(p.Z,{mt:.5,spacing:.5,children:x.map(function(e){return"button"!==e.type?null:(0,r.jsx)(l.Z,{children:(0,r.jsx)(c.Z,{color:e.context,variant:"contained",size:"small",onClick:e.handleClick,children:e.content})})})})]})]},"".concat(a,"-").concat(o))})})})};Z.propTypes={steps:a().arrayOf(a().shape({id:a().number,label:a().string,info:a().string,date:a().oneOfType([a().string,a().bool]),active:a().bool,content:a().arrayOf(a().shape({id:a().number,active:a().bool,data:a().oneOfType([a().string,a().element])})),actions:a().arrayOf(a().shape({id:a().number,active:a().bool,content:a().string,context:a().string,handleClick:a().func,type:"button"}))}))};var I=(0,y.ZP)(f.Z)(function(e){var n,t=e.theme;return n={},(0,i.Z)(n,"&.".concat(v.Z.active),(0,i.Z)({},"& .".concat(v.Z.line),{borderColor:t.palette.primary.main})),(0,i.Z)(n,"&.".concat(v.Z.completed),(0,i.Z)({},"& .".concat(v.Z.line),{borderColor:t.palette.primary.main})),(0,i.Z)(n,"& .".concat(v.Z.line),{borderColor:t.palette.primary.main,borderLeftWidth:4,borderRadius:1,marginLeft:"-2px"}),n}),S=(0,y.ZP)(h.Z)(function(e){var n=e.theme;return(0,i.Z)({},"&.".concat(b.Z.root),{borderColor:n.palette.primary.main,borderLeftWidth:4,marginLeft:"10px"})}),w=(0,y.ZP)(g.Z)(function(e){var n;return e.theme,n={},(0,i.Z)(n,"&.".concat(x.Z.root),{padding:0}),(0,i.Z)(n,"& .".concat(x.Z.labelContainer),{color:"inherit"}),(0,i.Z)(n,"& .".concat(x.Z.label),{display:"flex",alignItems:"center",color:"inherit"}),n})},39710:function(e,n,t){"use strict";t.d(n,{D7:function(){return j},KQ:function(){return x},R7:function(){return g},j$:function(){return Z},kx:function(){return I},l1:function(){return b},lk:function(){return y},ys:function(){return h}});var i=t(7297),r=t(75063);function o(){var e=(0,i.Z)(['\n  query GetSuppliers(\n    $limit: Int\n    $offset: Int\n    $orderBy: Account_order_by!\n    $where: Account_bool_exp\n  ) {\n    suppliers: Account(limit: $limit, offset: $offset, where: $where, order_by: [$orderBy]) {\n      id\n      createdAt\n      name\n      status\n      companyNumber\n      vatId\n      website\n      jobs: SupplierJobs_aggregate {\n        aggregate {\n          count\n          max {\n            scheduledAt\n          }\n          sum {\n            amount\n          }\n        }\n      }\n      jobList: SupplierJobs(order_by: { createdAt: desc }) {\n        id\n      }\n      services: Services(where: { entity: { _eq: "Account" } }) {\n        id\n        service: Service {\n          id\n          name\n        }\n      }\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n      locations: Account_Locations {\n        id\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        id\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n    }\n    meta: Account_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return o=function(){return e},e}function a(){var e=(0,i.Z)(['\n  query GetSupplier($id: Int!) {\n    supplier: Account_by_pk(id: $id) {\n      id\n      companyNumber\n      createdAt\n      name\n      status\n      type\n      updatedAt\n      website\n      clientType\n      managerId\n      vatId\n      meta\n      statusLogs: StatusLog(where: { entity: { _eq: "Account" } }) {\n        id\n        status\n        createdAt\n      }\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      manager: Manager {\n        id\n        fullName\n      }\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n\n      details: SupplierDetail {\n        cisRegistered\n        quotingEmail\n        typeOfOrganisation\n        utrNumber\n        accountId\n      }\n\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n        }\n      }\n      usersMeta: Account_Users_aggregate {\n        aggregate {\n          count\n        }\n      }\n\n      coverage: PostcodeAreas(where: { entity: { _eq: "Account" }, status: { _eq: "active" } }) {\n        id\n        status\n        createdAt\n        area: PostcodeArea {\n          id\n          name\n          area\n        }\n      }\n      services: Services {\n        serviceId\n        createdAt\n      }\n      references: References {\n        id\n        createdAt\n      }\n    }\n  }\n']);return a=function(){return e},e}function s(){var e=(0,i.Z)(["\n  query GetSupplierManage($id: Int!) {\n    supplier: Account_by_pk(id: $id) {\n      id\n      name\n      website\n      companyNumber\n      vatId\n      status\n      meta\n      managerSelected: Manager {\n        id\n        label: fullName\n        value: id\n      }\n      supplierDetails: SupplierDetail {\n        id\n        cisRegistered\n        quotingEmail\n        typeOfOrganisation\n        utrNumber\n      }\n    }\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,i.Z)(["\n  mutation AddSupplier($objects: [Account_insert_input!]!) {\n    insert_Account(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return e},e}function l(){var e=(0,i.Z)(["\n  mutation AddSupplierDetail($objects: [SupplierDetail_insert_input!]!) {\n    insert_SupplierDetail(objects: $objects) {\n      returning {\n        id\n        accountId\n      }\n    }\n  }\n"]);return l=function(){return e},e}function c(){var e=(0,i.Z)(["\n  mutation AddSupplierOffer($objects: [SupplierOffer_insert_input!]!) {\n    insert_SupplierOffer(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,i.Z)(["\n  mutation UpdateSupplier(\n    $supplierId: Int!\n    $supplier: Account_set_input\n    $supplierDetails: SupplierDetail_set_input\n  ) {\n    update_SupplierDetail(where: { accountId: { _eq: $supplierId } }, _set: $supplierDetails) {\n      returning {\n        id\n      }\n    }\n\n    update_Account_by_pk(pk_columns: { id: $supplierId }, _set: $supplier) {\n      id\n    }\n  }\n"]);return d=function(){return e},e}function p(){var e=(0,i.Z)(['\n  query GetPostCodeAreas(\n    $limit: Int\n    $offset: Int\n    $q: String\n    $supplierId: Int\n    $status: String = "active"\n  ) {\n    coverage: PostcodeArea_Entity(\n      where: {\n        entity: { _eq: "Account" }\n        entityId: { _eq: $supplierId }\n        status: { _eq: $status }\n        PostcodeArea: { name: { _ilike: $q } }\n      }\n      order_by: { PostcodeArea: { name: asc } }\n      limit: $limit\n      offset: $offset\n    ) {\n      id\n      status\n      createdAt\n      area: PostcodeArea {\n        id\n        name\n        area\n      }\n    }\n    meta: PostcodeArea_Entity_aggregate(\n      where: {\n        entity: { _eq: "Account" }\n        entityId: { _eq: $supplierId }\n        status: { _eq: $status }\n        PostcodeArea: { name: { _ilike: $q } }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return p=function(){return e},e}function m(){var e=(0,i.Z)(["\n  query GetPostCodeAreaForSelect($countryId: Int, $q: String) {\n    items: PostcodeArea(\n      where: { name: { _ilike: $q }, countryId: { _eq: $countryId } }\n      order_by: { name: asc }\n    ) {\n      area\n      label: name\n      value: id\n    }\n  }\n"]);return m=function(){return e},e}function f(){var e=(0,i.Z)(['\n  query GetServicesForSelect($q: String, $limit: Int, $offset: Int) {\n    items: Service(\n      where: { name: { _ilike: $q }, status: { _eq: "active" } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']);return f=function(){return e},e}function v(){var e=(0,i.Z)(['\n  query GetFinancialJob(\n    $adminId: Int\n    $customerId: Int\n    $endDate: timestamptz\n    $startDate: timestamptz\n    $limit: Int\n    $status: [String]\n    $managerId: Int\n    $locationId: Int\n    $offset: Int\n    $supplierId: Int\n    $q: String\n    $orderBy: Job_order_by!\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      type\n      number\n      status\n      description\n      reference\n      timingStart\n      scheduledAt\n      createdAt\n\n      customerTotal: customerFinances(path: "amountInfo.total")\n      supplierTotal: supplierFinances(path: "amountInfo.total")\n      customerVatTotal: customerFinances(path: "amountInfo.vatTotal")\n      supplierVatTotal: supplierFinances(path: "amountInfo.vatTotal")\n      customerExpensesTotal: customerFinances(path: "expensesInfo.expensesTotal")\n      supplierExpensesTotal: supplierFinances(path: "expensesInfo.expensesTotal")\n      customerRebateAmount: customerFinances(path: "rebate.amount")\n\n      slaId\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        invoiceNumber\n      }\n      customer: Customer {\n        id\n        name\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      sla: SLA {\n        name\n      }\n      manager: Manager {\n        fullName\n        nameLast\n        nameFirst\n        id\n      }\n      service: Service {\n        id\n        name\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        type: { _in: ["reactive", "ppm"] }\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Invoices: { invoiceNumber: { _ilike: $q } } }\n            ]\n          }\n          {\n            _or: [\n              { _and: [{ timingStart: { _gte: $startDate } }, { timingStart: { _lte: $endDate } }] }\n              { _and: [{ scheduledAt: { _gte: $startDate } }, { scheduledAt: { _lte: $endDate } }] }\n            ]\n          }\n        ]\n        status: { _in: $status }\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        managerId: { _eq: $managerId }\n        adminId: { _eq: $adminId }\n        locationId: { _eq: $locationId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return v=function(){return e},e}var h=(0,r.Ps)(o()),b=(0,r.Ps)(a()),g=(0,r.Ps)(s()),x=(0,r.Ps)(u());(0,r.Ps)(l()),(0,r.Ps)(c());var j=(0,r.Ps)(d()),y=(0,r.Ps)(p()),Z=(0,r.Ps)(m()),I=(0,r.Ps)(f());(0,r.Ps)(v())},67860:function(e,n,t){"use strict";t.d(n,{T:function(){return u}});var i=t(85893),r=t(45697),o=t(11585),a=t(86036),s=t(19664),u=function(e){var n,t,r,u=e.open,l=e.supplier,c="";return s.E.forEach(function(e){var n;e.value===(null===(n=l.details)||void 0===n?void 0:n.typeOfOrganisation)&&(c=e.text)}),(0,i.jsxs)(o.Z,{open:u,title:"Company",children:[(0,i.jsx)(a.Z,{content:"Organization Type",text:c}),(0,i.jsx)(a.Z,{content:"Company Number",text:l.companyNumber}),(0,i.jsx)(a.Z,{content:"VAT Number",text:l.vatId}),(0,i.jsx)(a.Z,{content:"UTR Number",text:null===(n=l.details)||void 0===n?void 0:n.utrNumber}),(0,i.jsx)(a.Z,{content:"CIS registration number",text:null===(t=l.details)||void 0===t?void 0:t.cisRegistered}),(0,i.jsx)(a.Z,{content:"Website",text:l.website}),(null===(r=l.meta)||void 0===r?void 0:r.xeroContactId)&&(0,i.jsx)(a.Z,{content:"Xero Contact ID",text:l.meta.xeroContactId})]})};u.propTypes={open:r.bool,supplier:r.object.isRequired},u.defaultProps={open:!0}},81639:function(e,n,t){"use strict";t.d(n,{D:function(){return s}});var i=t(85893),r=t(11585),o=t(86036),a=t(55377),s=function(e){var n=e.supplier;return(0,i.jsx)(r.Z,{open:!0,title:"Contact",children:n.contactUsers.map(function(e){var t;return(0,i.jsxs)("div",{children:[(0,i.jsx)(o.Z,{content:"Name",text:"".concat(e.user.fullName)}),(0,i.jsx)(o.Z,{content:"Phone",text:e.user.phone}),(0,i.jsx)(o.Z,{content:"Email",text:e.user.email}),(0,i.jsx)(o.Z,{content:"Quoting Email",text:(null===(t=n.details)||void 0===t?void 0:t.quotingEmail)||"-"}),(0,i.jsx)(a.Z,{})]},e.user.id)})})}},86574:function(e,n,t){"use strict";t.d(n,{O:function(){return u}});var i=t(26042),r=t(85893),o=t(90948),a=t(40044),s=(0,o.ZP)(function(e){return(0,r.jsx)(a.Z,(0,i.Z)({disableRipple:!0},e))})(function(e){var n=e.theme;return{textTransform:"none",color:n.palette.text.primary,"&.Mui-selected":{fontWeight:600,color:n.palette.secondary.contrastText,backgroundColor:n.palette.secondary.main},"&.Mui-focusVisible":{backgroundColor:"rgba(100, 95, 228, 0.32)"}}}),u=function(e){return(0,r.jsx)(s,(0,i.Z)({},e))};u.defaultProps={},u.propTypes={}},86858:function(e,n,t){"use strict";t.d(n,{x:function(){return l}});var i=t(26042),r=t(69396),o=t(99534),a=t(85893),s=t(90948),u=t(5616),l=function(e){var n=e.children,t=e.value,s=e.index,l=e.boxProps,d=e.boxSx,p=(0,o.Z)(e,["children","value","index","boxProps","boxSx"]);return(0,a.jsx)(c,(0,r.Z)((0,i.Z)({role:"tabpanel",hidden:t!==s,id:"simple-tabpanel-".concat(s),"aria-labelledby":"simple-tab-".concat(s)},p),{children:t===s&&(0,a.jsx)(u.Z,(0,r.Z)((0,i.Z)({},l),{sx:(0,i.Z)({padding:"25px 0"},d),children:n}))}))};l.defaultProps={boxProps:{},boxSx:{}};var c=(0,s.ZP)(u.Z)(function(){return{"& .MuiTabs-root":{}}})},83336:function(e,n,t){"use strict";t.d(n,{m:function(){return f}});var i=t(26042),r=t(69396),o=t(99534),a=t(85893),s=t(45697),u=t.n(s),l=t(90948),c=t(3892),d=t(11163),p=t.n(d),m=(0,l.ZP)(function(e){return(0,a.jsx)(c.Z,(0,i.Z)({},e))})(function(e){var n=e.theme,t=e.size;return(0,r.Z)((0,i.Z)({},"small"===t&&{height:"32px",minHeight:"32px"}),{"& .MuiTabs-scroller":(0,i.Z)({overflow:"scroll !important"},"small"===t&&{height:"60px",minHeight:"60px"}),"& .MuiTabs-indicator":{display:"none"},"& .MuiTabs-flexContainer > .MuiTab-root":(0,r.Z)((0,i.Z)({},"small"===t&&{height:"32px",minHeight:"32px"}),{border:1,borderStyle:"solid",borderColor:n.palette.divider,"&:first-child":(0,i.Z)({borderTopLeftRadius:"10px",borderBottomLeftRadius:"10px"},"small"===t&&{borderTopLeftRadius:"5px",borderBottomLeftRadius:"5px"}),"&:last-child":(0,i.Z)({borderTopRightRadius:"10px",borderBottomRightRadius:"10px"},"small"===t&&{borderTopRightRadius:"5px",borderBottomRightRadius:"5px"})})})}),f=function(e){var n=e.onChange,t=e.changeQuery,r=(0,o.Z)(e,["onChange","changeQuery"]),s=(0,d.useRouter)(),u=function(e,i){n(e,i),t&&l(i)},l=function(e){var n=s.query;delete n.tab,n.tab=e,p().push({pathname:s.pathname,query:n,shallow:!0})};return(0,a.jsx)(m,(0,i.Z)({onChange:u},r))};f.defaultProps={size:"small"},f.propTypes={size:u().oneOf(["small",void 0])}},45451:function(e,n,t){"use strict";t.d(n,{i:function(){return w}});var i=t(14924),r=t(26042),o=t(69396),a=t(85893),s=t(67294),u=t(11163),l=t(45697),c=t.n(l),d=t(61870),p=t(5616),m=t(51233),f=t(15861),v=t(90948),h=t(41796),b=t(29217),g=t(45111),x=t(98209),j=t(70872),y=t(58886),Z=t(61730),I=function(e){var n=e.currentPage,t=e.totalCount,i=e.pageSize,o=e.onPageChange,s=(0,Z.Z)("(max-width:400px)"),u=(0,Z.Z)("(max-width:500px)");return(0,a.jsx)(S,{mb:2,page:n,count:Math.ceil(t/i),onChange:function(e,n){return o(n)},variant:"outlined",shape:"rounded",size:s?"small":"medium",hidePrevButton:1===n,hideNextButton:n===Math.ceil(t/i),siblingCount:u?0:1,renderItem:function(e){return(0,a.jsx)(y.Z,(0,r.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})};I.defaultProps={currentPage:1,totalCount:0,pageSize:50,onPageChange:function(){}},I.propTypes={currentPage:c().number,totalCount:c().number,pageSize:c().number,onPageChange:c().func};var S=(0,v.ZP)(j.Z)(function(e){var n,t=e.hidePrevButton,o=e.hideNextButton,a=e.theme;return n={},(0,i.Z)(n,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,i.Z)(n,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,i.Z)(n,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,i.Z)(n,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,i.Z)(n,"& button.Mui-selected",(0,r.Z)({color:a.palette.white.main,backgroundColor:a.palette.secondary.main},o?{borderRadius:"0 5px 5px 0"}:{},t?{borderRadius:"5px 0 0 5px"}:{})),n}),w=(0,s.forwardRef)(function(e,n){var t=e.columns,i=e.history,o=e.initialSort,l=e.meta,c=e.refetch,d=e.paginationSize,p=e.containerHeight,v=e.containerMaxHeight,h=e.noResultsMessage,j=e.autoHeight,y=(0,u.useRouter)(),Z=y.query,S=void 0===Z?{}:Z,w=(0,s.useState)(parseInt(null==S?void 0:S.page,10)||1),q=w[0],_=w[1],T=(0,s.useState)(d||x.C1.paginationSize),A=T[0],E=T[1],D=o;D||(D={item:"createdAt",order:"desc"});var P=(0,s.useState)({item:D.item,order:D.order}),k=P[0],$=P[1],H=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=y.query,t=void 0===n?{}:n;if(e>1?t.page=e:delete t.page,!(Object.keys(t).length>0))return{};var i=Object.keys(t).map(function(n){return"page"===n?"".concat(n,"=").concat(e):"".concat(n,"=").concat(t[n])}).join("&");return"?".concat(i)},M=function(){$({item:D.item,order:D.order}),_(1);var e=H();y.push(e),E(d||x.C1.paginationSize)};(0,s.useImperativeHandle)(n,function(){return{currentPage:q,pageSize:A,sort:k,resetPagination:function(){M()}}});var O=function(e){var n=H(e);i&&y.push(n),_(e),!i&&c&&c()},N=function(e){e&&e.field&&e.sort?($({item:t.find(function(n){return n.field===e.field}).sortName||e.field||e.item||D.item,order:e.sort||e.order||D.order}),c&&c()):($({item:D.item,order:D.order}),c&&c())};return(0,a.jsxs)(C,{containerHeight:p,containerMaxHeight:v,children:[(0,a.jsx)(R,(0,r.Z)({hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0,autoHeight:j,sortingMode:"server",onSortModelChange:function(e){return N(e[0])},columns:t,pageSize:A,slots:{columnSortedAscendingIcon:function(){return(0,a.jsx)(b.Z,{})},columnSortedDescendingIcon:function(){return(0,a.jsx)(g.Z,{})},columnUnsortedIcon:function(){return(0,a.jsxs)(m.Z,{alignItems:"center",sx:{width:"33px"},children:[(0,a.jsx)(b.Z,{sx:{marginBottom:"-15px"}}),(0,a.jsx)(g.Z,{})]})},noResultsOverlay:function(){return(0,a.jsx)(m.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(f.Z,{children:h})})},noRowsOverlay:function(){return(0,a.jsx)(m.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(f.Z,{children:h})})}}},e)),l&&Math.ceil(l.aggregate.totalCount/A)>1&&(0,a.jsx)(I,{currentPage:q,totalCount:l.aggregate.totalCount,pageSize:A,onPageChange:O})]})});w.propTypes={history:c().bool,initialSort:c().object,loading:c().bool,meta:c().object,refetch:c().func,paginationSize:c().number,noResultsMessage:c().string,columns:c().array.isRequired,rows:c().array.isRequired,autoHeight:c().bool},w.defaultProps={columns:[],history:!1,loading:!1,rows:[],noResultsMessage:"There are no results.",autoHeight:!0};var C=(0,v.ZP)(p.Z)(function(e){var n;return{height:e.containerHeight,maxHeight:e.containerMaxHeight,display:"flex",flexDirection:"column"}}),R=(0,v.ZP)(d.s)(function(e){var n,t=e.theme,a=e.hideHeader,s=(e.rows,e.loading,e.rowHeight),u=e.isPdf;return n={"--DataGrid-overlayHeight":"40px"},(0,i.Z)(n,"&.MuiDataGrid-root",(0,r.Z)({color:t.palette.black.main,border:"none"},u&&{"@media print":{display:"block"}})),(0,i.Z)(n,"& .MuiDataGrid-main",(0,r.Z)({},u&&{"@media print":{overflow:"visible !important"}})),(0,i.Z)(n,"& .MuiDataGrid-columnHeaders",(0,o.Z)((0,r.Z)({},a&&{display:"none"}),{"& .MuiDataGrid-iconButtonContainer":{visibility:"visible","& .MuiButtonBase-root.MuiIconButton-root":{backgroundColor:"inherit",color:t.palette.black.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}}})),(0,i.Z)(n,"& .MuiDataGrid-virtualScroller",(0,r.Z)({},a&&{marginTop:"0 !important"},u&&{"@media print":{overflow:"visible !important"}})),(0,i.Z)(n,"& .MuiDataGrid-iconSeparator",{opacity:0}),(0,i.Z)(n,"& .MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,i.Z)(n,"& .MuiButtonBase-root.MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,i.Z)(n,"& .MuiDataGrid-virtualScrollerContent",(0,r.Z)({},u&&{height:"initial !important",minHeight:"initial !important"})),(0,i.Z)(n,"& .MuiDataGrid-virtualScrollerRenderZone",(0,r.Z)({},u&&{position:"relative"})),(0,i.Z)(n,"& .MuiDataGrid-overlayWrapper",(0,i.Z)({},"& .MuiCircularProgress-root",{color:t.palette.secondary.main})),(0,i.Z)(n,"& .MuiDataGrid-row",(0,r.Z)({},u&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,i.Z)(n,"& .MuiDataGrid-row > .MuiDataGrid-cell",(0,r.Z)({},u&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,i.Z)(n,"& .MuiDataGrid-columnHeaderCheckbox",(0,i.Z)({},"& .MuiButtonBase-root.MuiCheckbox-root > .MuiSvgIcon-root",(0,i.Z)({color:t.palette.secondary.main},'&[data-testid="CheckBoxOutlineBlankIcon"]',{color:"currentColor"}))),(0,i.Z)(n,"& .MuiDataGrid-row > .MuiDataGrid-cellCheckbox",(0,i.Z)({},"& .MuiButtonBase-root.MuiCheckbox-root > .MuiSvgIcon-root",(0,i.Z)({color:t.palette.secondary.main},'&[data-testid="CheckBoxOutlineBlankIcon"]',{color:"currentColor"}))),(0,i.Z)(n,"& .MuiDataGrid-row.even",{backgroundColor:t.palette.muiLightGray.main,"&:hover, &.Mui-hovered":{backgroundColor:(0,h.Fq)(t.palette.muiLightGray.main,.3),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,h.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,h.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,h.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity)}}}}),n})},62247:function(e,n,t){"use strict";t.d(n,{y:function(){return p}});var i=t(85893),r=t(45697),o=t(55377),a=t(9270),s=t(62140),u=t(86036),l=t(16551),c=t(77439),d=t(97637),p=function(e){var n=e.answers,t=e.onEdit,r=e.entity,p=e.entityId,m=function(){t&&t(n)};return(0,i.jsxs)(i.Fragment,{children:[n&&n.length>0&&(0,i.jsx)(o.Z,{content:"Questions"}),n&&n.map(function(e){var n,t,l,c=e.meta;return(null==c?void 0:c.input)==="media"?(0,i.jsx)(a.Z,{children:(0,i.jsxs)(s.Z,{md:6,children:[(0,i.jsx)(d.G,{entity:r,entityId:p,showItemActions:!1,showActionButtons:!1,summary:null==c?void 0:c.label,category:"supplierQuestion",mediaMeta:{taxonomyId:e.id}}),(0,i.jsx)(o.Z,{})]})}):(0,i.jsx)(u.Z,{content:(null===(n=e.taxonomy)||void 0===n?void 0:n.name)||e.name,text:e.comments||(null===(t=e.taxonomy_entity)||void 0===t?void 0:null===(l=t[0])||void 0===l?void 0:l.comments)},e.id||e.taxonomyId)}),n&&n.length>0&&t&&(0,i.jsx)(l.Z,{align:"flex-end",children:(0,i.jsx)(c.Z,{content:"Edit Answers",size:"sm",context:"secondary",onClick:m})}),n&&n.length>0&&(0,i.jsx)(o.Z,{})]})};p.propTypes={answers:r.array}},76990:function(e,n,t){"use strict";t.d(n,{D:function(){return E}});var i=t(26042),r=t(69396),o=t(85893),a=t(67294),s=t(45697),u=t(42283),l=t(79665),c=t(76600),d=t(9270),p=t(62140),m=t(16551),f=t(77439),v=t(58594),h=t(28497),b=t(55563),g=t(90951),x=t(95103),j=t(6710),y=t(78289),Z=t(23233),I=t(49501),S=t(40826),w=t(40552),C=t(97637),R={checkbox:v.Z,currencyInput:h.Z,datepicker:w.M,input:b.Z,radio:g.Z,select:x.Z,textArea:j.Z,selectRange:x.Z},q=function(e){var n=e.control,t=e.entity,s=e.entityId,u=e.errors,l=e.input,c=e.inputType,d=e.key,p=e.label,m=e.mediaMeta,v=e.name,h=e.options,b=e.register,g=(0,a.useContext)(y.Z),x="select"===l&&h.length>0,j=["checkbox","radio"].includes(l)&&h.length>0,w=(0,r.Z)((0,i.Z)({control:n},j&&{data:h},x&&{options:h.map(function(e){return(0,r.Z)((0,i.Z)({},e),{text:e.label})})},"selectRange"===l&&{range:[10,0]}),{errors:u,key:d,label:Z.Z.camelize(p),name:v,register:b,type:j?l:c,minDate:"2020-04-19T08:29:04.839Z"}),q=function(){g.show({content:t&&s&&(0,o.jsx)(C.G,{entity:t,entityId:s,mediaMeta:m,category:"supplierQuestion"}),submit:!1,title:p})},_=R[l];return(0,o.jsx)(o.Fragment,{children:"currencyInput"===l?(0,o.jsx)(I.Z,{label:p,children:(0,o.jsx)(_,(0,r.Z)((0,i.Z)({},w),{label:""}))}):(0,o.jsx)(o.Fragment,{children:"media"===l?(0,o.jsx)(I.Z,{label:p,children:(0,o.jsx)(f.Z,{context:"info",content:(0,o.jsx)(S.Z,{icon:"file-upload"}),onClick:q,size:"sm"})}):(0,o.jsx)(I.Z,{label:p,children:(0,o.jsx)(_,(0,i.Z)({},w))})})})};q.propTypes={control:s.object.isRequired,entity:s.string,entityId:s.number,errors:s.object.isRequired,input:s.string,inputType:s.string,key:s.string,label:s.string.isRequired,mediaMeta:s.object,name:s.string.isRequired,options:s.array,register:s.func.isRequired},q.defaultProps={input:"input",options:[],inputType:"text",label:"label"};var _=t(16310),T=function(e,n){var t=n.object,r=n.string,o={};return null==e||e.forEach(function(e){var n;(null===(n=e.meta)||void 0===n?void 0:n.required)&&(o[e.name]=r().required())}),t().shape((0,i.Z)({},o))},A=function(e){var n=e.map(function(e){return(0,r.Z)((0,i.Z)({},e),{name:"".concat(e.name,"/id=").concat(e.taxonomyId)})}),t=(0,_.Ry)().shape({}),o=T(n,{object:_.Ry,string:_.Z_});return t.concat(o)},E=function(e){var n,t=e.entity,s=e.entityId,v=e.onSuccess,h=e.questions,b=e.hasChangeStatus,g=(0,u.cI)({defaultValues:(n={},h.forEach(function(e){var t=e.comments,i=e.taxonomyId,r=e.name;n["".concat(r,"/id=").concat(i)]=t}),n),resolver:(0,l.S)(A(h))}),x=g.control,j=g.errors,y=g.handleSubmit,Z={control:x,errors:j,register:g.register},I=function(e,n){var i=Object.keys(e).map(function(n){return{taxonomyId:parseInt(n.split("/id=")[1]),name:n.split("/id=")[0],comments:String(e[n]),entity:t,entityId:s}});v&&v(i,n)};return(0,o.jsx)(o.Fragment,{children:(0,o.jsx)(c.Z,{id:b?"offCanvasFormQuestions":"offCanvasForm",handleSubmit:y(function(e){return I(e,"supplierQuestionsSubmitted")}),children:(0,o.jsxs)(d.Z,{children:[h.map(function(e){var n,u,l,c;return(0,o.jsx)(p.Z,{md:12,children:(0,a.createElement)(q,(0,r.Z)((0,i.Z)({},Z),{input:null===(n=e.meta)||void 0===n?void 0:n.input,inputType:null===(u=e.meta)||void 0===u?void 0:u.inputType,key:e.taxonomyId,label:null===(l=e.meta)||void 0===l?void 0:l.label,name:"".concat(e.name,"/id=").concat(e.taxonomyId),options:null===(c=e.meta)||void 0===c?void 0:c.options,entity:t,entityId:s,mediaMeta:{taxonomyId:e.taxonomyId}}))})}),b&&(0,o.jsx)(p.Z,{md:12,children:(0,o.jsxs)(m.Z,{align:"flex-end",children:[(0,o.jsx)(f.Z,{content:"Save",context:"success",onClick:y(function(e){return I(e,"supplierQuestionsDraft")}),size:"sm"}),(0,o.jsx)(f.Z,{content:"Submit",context:"secondary",type:"submit",size:"sm"})]})})]})})})};E.propTypes={entity:s.string.isRequired,entityId:s.number,onSuccess:s.func,hasChangeStatus:s.bool,questions:s.array.isRequired},E.defaultProps={hasChangeStatus:!1}},22564:function(e,n,t){"use strict";t.d(n,{lt:function(){return i},pv:function(){return r}});var i=function(e,n){var t=Math.pow(10,n);return Math.round(e*t)/t},r=function(e){return parseInt(e).toLocaleString("en-GB",{minimumIntegerDigits:2,useGrouping:!1})}},49010:function(e,n,t){"use strict";t.d(n,{b:function(){return i}});var i=function(e){return String(e).toLowerCase().replace("gb","").length>=9}},58632:function(e,n,t){"use strict";t.d(n,{x:function(){return i}});var i=[{text:"Reactive",value:"reactive",context:"#2EE6CA"},{text:"Planned Maintenance",value:"ppm",context:"#D67EFF"},{text:"Quote",value:"quote",context:"#7D7"},{text:"Compliance",value:"cppm",context:"#CC7429"}]},99988:function(e,n,t){"use strict";t.d(n,{Hu:function(){return i},KB:function(){return r},M2:function(){return o}});var i=[{id:"time-materials",label:"Time & Materials",value:"time-materials"},{id:"fixed",label:"Fixed",value:"fixed"}],r=[{id:"at",label:"At",value:"at"},{id:"between",label:"Between",value:"between"}],o=[{id:"complete",label:"Job complete",value:"complete"},{id:"completeCertificate",label:"Job complete, certificate to follow",value:"completeCertificate"},{id:"returnVisit",label:"Return visit required",value:"returnVisit"},{id:"returnVisitByAnother",label:"Visit required by another supplier",value:"returnVisitByAnother"},{id:"couldNotDo",label:"Could not do",value:"couldNotDo"}]},19664:function(e,n,t){"use strict";t.d(n,{E:function(){return i}});var i=[{text:"Select Type Of Organisation",value:""},{text:"Sole trader",value:"soleTrader"},{text:"Limited company",value:"limitedCompany"},{text:"Partnership",value:"partnership"},{text:"LLP",value:"llp"},{text:"PLC",value:"plc"}]},69232:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return uy}});var i=t(26042),r=t(85893),o=t(67294),a=t(11163),s=t.n(a),u=t(73987),l=t(29815),c=t(6812),d=t(75436),p=t(64573),m=t(7297),f=t(75063),v=t(20725),h=t(17868),b=t(22666),g=t(94885);function x(){var e=(0,m.Z)(['\n  query GetJob($adminId: Int!, $number: String!) {\n    job: Job(where: { adminId: { _eq: $adminId }, number: { _eq: $number } }) {\n      ...JobFields\n      ...JobQuoteFields\n      ...JobSupplierFields\n      reportPassFail\n      reportPassFailTitle\n      requireReportRecommendations\n      estimatedDuration\n      estimatedDurationUnit\n      anyTimeOption\n      hourStart\n      hourEnd\n      meta\n      supplierVatTotal: supplierFinances(path: "amountInfo.vatTotal")\n      assets: Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        status\n        asset: Asset {\n          id\n          name\n        }\n      }\n      ppmInvoices: AccountEntries {\n        Invoices {\n          id\n          invoiceNumber\n          invoiceType\n          meta\n          createdAt\n          accountEntry: AccountEntry {\n            id\n          }\n        }\n      }\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n        invoiceType\n        createdAt\n        amounts\n        reconciledAmount: AccountEntry {\n          reconciliations: InvoiceReconciliations_aggregate {\n            aggregate {\n              sum {\n                amount\n              }\n            }\n          }\n        }\n      }\n      jobScheduleId\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      supplierId\n      customerId\n      customerUserId\n      locationId\n      parentJob: ParentJob {\n        createdAt\n        id\n        number\n        reference\n        status\n        title\n        type\n      }\n      childJobs: Jobs {\n        createdAt\n        id\n        number\n        reference\n        status\n        title\n        type\n      }\n      admin: Admin {\n        id\n        name\n        meta\n        bankAccounts: BankAccounts {\n          id\n          bank\n          stripeId\n          accountNumber\n          routingNumber\n          bic\n          iban\n          status\n          default\n          createdAt\n        }\n        addresses: Addresses {\n          id\n          registered\n          operating\n          trading\n          invoice\n          status\n          createdAt\n          address: Address {\n            id\n            name\n            addressLine1\n            addressLine2\n            addressLine3\n            city\n            county\n            geo\n            postCode\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n      }\n      customer: Customer {\n        id\n        name\n      }\n\n      compliance: Compliance {\n        id\n        name\n        complianceCategory: ComplianceCategory {\n          id\n          name\n        }\n        parentCompliance: ParentCompliance {\n          id\n          name\n        }\n      }\n\n      expenses: Expenses {\n        id\n        amount\n        description\n        markup\n        total\n        unit\n        vat\n        paid\n      }\n      location: Location {\n        id\n        name\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n        services: Services(where: { entity: { _eq: "Location" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n          service: Service {\n            id\n            name\n            countryId\n            currencyId\n            customerDayRate\n            customerDayRateOOH\n            customerDayRatePremium\n            customerHourRate\n            customerHourRateOOH\n            customerHourRatePremium\n            supplierDayRate\n            supplierDayRateOOH\n            supplierDayRatePremium\n            supplierHourRate\n            supplierHourRateOOH\n            supplierHourRatePremium\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      report: JobReport {\n        id\n        completion\n        notes\n        timing\n        passFailStatus\n        recommendations\n        comments\n        createdAt\n        updatedAt\n        meta\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n        customerDayRate\n        customerDayRateOOH\n        customerDayRatePremium\n        customerHourRate\n        customerHourRateOOH\n        customerHourRatePremium\n        supplierDayRate\n        supplierDayRateOOH\n        supplierDayRatePremium\n        supplierHourRate\n        supplierHourRateOOH\n        supplierHourRatePremium\n        minimumInterval\n        minimumLength\n        status\n        createdAt\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      media: Media {\n        id\n        item: Medium {\n          id\n          category\n          filename\n          meta\n          name\n          type\n        }\n      }\n      supplier: Supplier {\n        ...AccountFields\n        contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n          role\n          position\n          isContact\n          lastSignInAt\n          userId\n          user: User {\n            ...UserFields\n          }\n        }\n        services: Services(where: { entity: { _eq: "Account" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n          service: Service {\n            id\n            name\n            countryId\n            currencyId\n            customerDayRate\n            customerDayRateOOH\n            customerDayRatePremium\n            customerHourRate\n            customerHourRateOOH\n            customerHourRatePremium\n            supplierDayRate\n            supplierDayRateOOH\n            supplierDayRatePremium\n            supplierHourRate\n            supplierHourRateOOH\n            supplierHourRatePremium\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      financeLogs: JobFinanceLogs(order_by: { createdAt: desc }) {\n        id\n        type\n        value\n        difference\n        createdAt\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n        rate\n        dayRate\n        meta\n        notes\n        statusLog\n        account: Supplier {\n          id\n          type\n          name\n        }\n      }\n      manager: Manager {\n        ...UserFields\n      }\n      tenantUser: TenantUser {\n        ...UserFields\n      }\n      quotations: SupplierQuotes {\n        id\n        quoteNumber\n        accountId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        createdAt\n        updatedAt\n        siteVisitAt\n        type\n        lineItems: SupplierQuoteLineItems {\n          id\n          description\n          item\n          qty\n          qtyUnit\n          quoteId\n          total\n          type\n          unitRate\n          supplierTotal\n        }\n        supplier: Supplier {\n          id\n          type\n          name\n          accountUsers: Account_Users {\n            user: User {\n              id\n              fullName\n              nameFirst\n              nameLast\n              phone\n              email\n              devices: UserDevices(where: { status: { _eq: "active" } }) {\n                id\n                playerId\n              }\n            }\n          }\n        }\n      }\n      timings: JobTimings(order_by: { id: desc }) {\n        id\n        status\n        notes\n        meta\n        quoteId\n        createdAt\n        user: User {\n          id\n          fullName\n        }\n      }\n    }\n  }\n  ',"\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return x=function(){return e},e}function j(){var e=(0,m.Z)(['\n  query GetJob($adminId: Int!, $number: String!) {\n    job: Job(where: { adminId: { _eq: $adminId }, number: { _eq: $number } }) {\n      ...JobFields\n      ...JobQuoteFields\n      ...JobSupplierFields\n      reportPassFail\n      reportPassFailTitle\n      requireReportRecommendations\n      estimatedDuration\n      estimatedDurationUnit\n      anyTimeOption\n      hourStart\n      hourEnd\n      onSiteTimingEnd\n      meta\n      permitsLinks\n      relatedLinks\n      supplierVatTotal: supplierFinances(path: "amountInfo.vatTotal")\n      assets: Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        status\n        asset: Asset {\n          id\n          name\n        }\n      }\n      ppmInvoices: AccountEntries {\n        Invoices {\n          id\n          invoiceNumber\n          invoiceType\n          meta\n          createdAt\n          accountEntry: AccountEntry {\n            id\n          }\n        }\n      }\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n        invoiceType\n        createdAt\n        amounts\n        reconciledAmount: AccountEntry {\n          reconciliations: InvoiceReconciliations_aggregate {\n            aggregate {\n              sum {\n                amount\n              }\n            }\n          }\n        }\n      }\n      jobScheduleId\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      supplierId\n      customerId\n      customerUserId\n      locationId\n      parentJob: ParentJob {\n        createdAt\n        id\n        number\n        reference\n        status\n        title\n        type\n      }\n      childJobs: Jobs {\n        createdAt\n        id\n        number\n        reference\n        status\n        title\n        type\n      }\n      admin: Admin {\n        id\n        name\n        meta\n        bankAccounts: BankAccounts {\n          id\n          bank\n          stripeId\n          accountNumber\n          routingNumber\n          bic\n          iban\n          status\n          default\n          createdAt\n        }\n        addresses: Addresses {\n          id\n          registered\n          operating\n          trading\n          invoice\n          status\n          createdAt\n          address: Address {\n            id\n            name\n            addressLine1\n            addressLine2\n            addressLine3\n            city\n            county\n            geo\n            postCode\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n      }\n      customer: Customer {\n        id\n        name\n      }\n\n      compliance: Compliance {\n        id\n        name\n        complianceCategory: ComplianceCategory {\n          id\n          name\n        }\n        parentCompliance: ParentCompliance {\n          id\n          name\n        }\n      }\n\n      expenses: Expenses {\n        id\n        amount\n        description\n        markup\n        total\n        unit\n        vat\n        paid\n      }\n      location: Location {\n        id\n        name\n        permitsRequired\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n        services: Services(where: { entity: { _eq: "Location" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n          service: Service {\n            id\n            name\n            countryId\n            currencyId\n            customerDayRate\n            customerDayRateOOH\n            customerDayRatePremium\n            customerHourRate\n            customerHourRateOOH\n            customerHourRatePremium\n            supplierDayRate\n            supplierDayRateOOH\n            supplierDayRatePremium\n            supplierHourRate\n            supplierHourRateOOH\n            supplierHourRatePremium\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      report: JobReport {\n        id\n        completion\n        notes\n        timing\n        passFailStatus\n        recommendations\n        comments\n        createdAt\n        updatedAt\n        meta\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n        customerDayRate\n        customerDayRateOOH\n        customerDayRatePremium\n        customerHourRate\n        customerHourRateOOH\n        customerHourRatePremium\n        supplierDayRate\n        supplierDayRateOOH\n        supplierDayRatePremium\n        supplierHourRate\n        supplierHourRateOOH\n        supplierHourRatePremium\n        minimumInterval\n        minimumLength\n        status\n        createdAt\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      media: Media {\n        id\n        item: Medium {\n          id\n          category\n          filename\n          meta\n          name\n          type\n        }\n      }\n      supplier: Supplier {\n        ...AccountFields\n        contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n          role\n          position\n          isContact\n          lastSignInAt\n          userId\n          user: User {\n            ...UserFields\n          }\n        }\n        services: Services(where: { entity: { _eq: "Account" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n          service: Service {\n            id\n            name\n            countryId\n            currencyId\n            customerDayRate\n            customerDayRateOOH\n            customerDayRatePremium\n            customerHourRate\n            customerHourRateOOH\n            customerHourRatePremium\n            supplierDayRate\n            supplierDayRateOOH\n            supplierDayRatePremium\n            supplierHourRate\n            supplierHourRateOOH\n            supplierHourRatePremium\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      financeLogs: JobFinanceLogs(order_by: { createdAt: desc }) {\n        id\n        type\n        value\n        difference\n        createdAt\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n        rate\n        dayRate\n        meta\n        notes\n        statusLog\n        account: Supplier {\n          id\n          type\n          name\n        }\n      }\n      manager: Manager {\n        ...UserFields\n      }\n      tenantUser: TenantUser {\n        ...UserFields\n      }\n      quotations: SupplierQuotes {\n        id\n        quoteNumber\n        accountId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        createdAt\n        updatedAt\n        siteVisitAt\n        type\n        lineItems: SupplierQuoteLineItems {\n          id\n          description\n          item\n          qty\n          qtyUnit\n          quoteId\n          total\n          type\n          unitRate\n          supplierTotal\n        }\n        supplier: Supplier {\n          id\n          type\n          name\n          accountUsers: Account_Users {\n            user: User {\n              id\n              fullName\n              nameFirst\n              nameLast\n              phone\n              email\n              devices: UserDevices(where: { status: { _eq: "active" } }) {\n                id\n                playerId\n              }\n            }\n          }\n        }\n      }\n      timings: JobTimings(order_by: { id: desc }) {\n        id\n        status\n        notes\n        meta\n        quoteId\n        createdAt\n        user: User {\n          id\n          fullName\n        }\n      }\n    }\n  }\n  ',"\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return j=function(){return e},e}function y(){var e=(0,m.Z)(['\n  query GetJob($adminId: Int!, $number: String!) {\n    job: Job(where: { adminId: { _eq: $adminId }, number: { _eq: $number } }) {\n      ...JobFields\n      ...JobQuoteFields\n      ...JobSupplierFields\n      customerId\n      locationId\n      estimatedDuration\n      estimatedDurationUnit\n      meta\n      permitsLinks\n      relatedLinks\n      assets: Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        status\n        asset: Asset {\n          id\n          name\n        }\n      }\n      ppmInvoices: AccountEntries {\n        Invoices {\n          id\n          invoiceNumber\n          invoiceType\n          meta\n          createdAt\n          accountEntry: AccountEntry {\n            id\n          }\n        }\n      }\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n        invoiceType\n        createdAt\n        amounts\n        reconciledAmount: AccountEntry {\n          reconciliations: InvoiceReconciliations_aggregate {\n            aggregate {\n              sum {\n                amount\n              }\n            }\n          }\n        }\n      }\n      financeLogs: JobFinanceLogs(order_by: { createdAt: desc }) {\n        id\n        type\n        value\n        difference\n        createdAt\n      }\n      admin: Admin {\n        id\n        name\n        meta\n      }\n      customer: Customer {\n        id\n        name\n      }\n      compliance: Compliance {\n        id\n        name\n        complianceCategory: ComplianceCategory {\n          id\n          name\n        }\n        parentCompliance: ParentCompliance {\n          id\n          name\n        }\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        vat\n      }\n      location: Location {\n        id\n        name\n        permitsRequired\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n        services: Services(where: { entity: { _eq: "Location" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n          service: Service {\n            id\n            name\n            countryId\n            currencyId\n            customerDayRate\n            customerDayRateOOH\n            customerDayRatePremium\n            customerHourRate\n            customerHourRateOOH\n            customerHourRatePremium\n            supplierDayRate\n            supplierDayRateOOH\n            supplierDayRatePremium\n            supplierHourRate\n            supplierHourRateOOH\n            supplierHourRatePremium\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      report: JobReport {\n        id\n        completion\n        notes\n        timing\n        passFailStatus\n        recommendations\n        comments\n        createdAt\n        updatedAt\n        meta\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n        customerDayRate\n        customerDayRateOOH\n        customerDayRatePremium\n        customerHourRate\n        customerHourRateOOH\n        customerHourRatePremium\n        supplierDayRate\n        supplierDayRateOOH\n        supplierDayRatePremium\n        supplierHourRate\n        supplierHourRateOOH\n        supplierHourRatePremium\n        minimumInterval\n        minimumLength\n        status\n        createdAt\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      media: Media {\n        id\n        item: Medium {\n          id\n          category\n          filename\n          meta\n          name\n          type\n        }\n      }\n      supplier: Supplier {\n        ...AccountFields\n        contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n          role\n          position\n          isContact\n          lastSignInAt\n          userId\n          user: User {\n            ...UserFields\n          }\n        }\n        services: Services(where: { entity: { _eq: "Account" } }) {\n          id\n          dayRate\n          dayRateOOH\n          dayRatePremium\n          hourRate\n          hourRateOOH\n          hourRatePremium\n          minimumInterval\n          minimumLength\n          callOutHourRate\n          callOutHourRateOOH\n          callOutHourRatePremium\n          notes\n          delivery\n          createdAt\n          updatedAt\n          entity\n          entityId\n          serviceId\n          service: Service {\n            id\n            name\n            countryId\n            currencyId\n            customerDayRate\n            customerDayRateOOH\n            customerDayRatePremium\n            customerHourRate\n            customerHourRateOOH\n            customerHourRatePremium\n            supplierDayRate\n            supplierDayRateOOH\n            supplierDayRatePremium\n            supplierHourRate\n            supplierHourRateOOH\n            supplierHourRatePremium\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n        rate\n        dayRate\n        meta\n        notes\n        account: Supplier {\n          id\n          type\n          name\n        }\n      }\n      manager: Manager {\n        ...UserFields\n      }\n      tenantUser: TenantUser {\n        ...UserFields\n      }\n      quotations: SupplierQuotes(\n        where: { status: { _neq: "cancelled" } }\n        order_by: { quoteNumber: asc }\n      ) {\n        id\n        quoteNumber\n        accountId\n        methodStatement\n        notes\n        quoteNumber\n        recommended\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        createdAt\n        updatedAt\n        siteVisitAt\n        type\n        lineItems: SupplierQuoteLineItems {\n          id\n          description\n          item\n          qty\n          qtyUnit\n          quoteId\n          total\n          type\n          unitRate\n          supplierTotal\n        }\n        supplier: Supplier {\n          id\n          type\n          name\n        }\n      }\n      timings: JobTimings(order_by: { id: desc }) {\n        id\n        status\n        notes\n        meta\n        quoteId\n        createdAt\n        user: User {\n          id\n          fullName\n        }\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      answers: Taxonomy(\n        where: { Taxonomy: { type: { _eq: "jobQuestion" } } }\n        order_by: { taxonomyId: asc }\n      ) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      costCategoryTaxonomy: CostCategory {\n        id\n        name\n      }\n      parentJob: ParentJob {\n        createdAt\n        id\n        number\n        reference\n        status\n        title\n      }\n      childJobs: Jobs {\n        createdAt\n        id\n        number\n        reference\n        status\n        title\n      }\n    }\n  }\n  ',"\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return y=function(){return e},e}function Z(){var e=(0,m.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $_delete_key: Job_delete_key_input\n    $deleteTiming: JobTiming_bool_exp!\n    $insertTiming: [JobTiming_insert_input!]!\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes, _delete_key: $_delete_key) {\n      id\n    }\n    delete_JobTiming(where: $deleteTiming) {\n      returning {\n        id\n      }\n    }\n    insert_JobTiming(objects: $insertTiming) {\n      returning {\n        id\n      }\n    }\n    delete_JobFinanceLog(where: { system: { _eq: true }, jobId: { _eq: $id } }) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return Z=function(){return e},e}var I,S=(0,f.Ps)(x(),h.z,b.WW,b.MR,v.aL,v.pf,v.H_,g.Px),w=(0,f.Ps)(j(),h.z,b.WW,b.MR,v.aL,v.pf,v.H_,g.Px),C=(0,f.Ps)(y(),h.z,b.WW,b.MR,v.aL,v.pf,v.H_,g.Px),R=(0,f.Ps)(Z()),q=t(47568),_=t(828),T=t(97582),A=t(45697),E=t.n(A),D=t(66252),P=t(50319),k=t(86532),$=t(22797),H=t(38895),M=t(5616),O=t(11057),N=t(86886),F=t(51233),J=t(15861),L=t(98456),U=t(78289),V=t(70519),Q=t(77957),z=t(91613),Y=t(31181),B=t(25213),G=t(27434),W=t(53600),K=t(30381),X=t.n(K),ee=t(11082),en=t(26186),et=t(51539),ei=t(69396),er=t(42283),eo=t(79665),ea=t(76600),es=t(31113),eu=t(536),el=t(16310),ec=(0,el.Ry)().shape({serviceSelected:(0,el.Ry)().required()}),ed=function(e){var n,t=e.job,a=e.refetch,s=e.toggleShow,l=(0,o.useContext)(u.Z).user,c=(0,er.cI)({defaultValues:{serviceSelected:t.serviceId},resolver:(0,eo.S)(ec)}),d=c.errors,p=c.handleSubmit,m=c.register,f=c.control,h=(0,_.Z)((0,P.D)(v.xY,{onCompleted:function(){a&&a(),s()}}),1)[0],b=(n=(0,q.Z)(function(e){var n;return(0,T.__generator)(this,function(i){switch(i.label){case 0:return n={status:"raised",quoted:!1,type:"reactive",serviceId:e.serviceSelected.value},[4,h({variables:{id:t.id,changes:n,timing:{notes:e.comments,status:"raised",jobId:t.id,userId:l.id}}}).then(function(){return s()})];case 1:return i.sent(),[2]}})}),function(e){return n.apply(this,arguments)});return(0,r.jsxs)(ea.Z,{handleSubmit:p(b),children:[(0,r.jsx)(eu.P,(0,ei.Z)((0,i.Z)({},{control:f,errors:d,register:m}),{errors:(0,i.Z)({},d),name:"serviceSelected",label:"Service",type:"service"})),(0,r.jsx)(es.H,{content:"Submit",type:"submit"})]})};ed.propTypes={job:A.object.isRequired,refetch:A.func.isRequired,toggleShow:A.func.isRequired};var ep=(I=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(ed,{job:e,toggleShow:n.show,refetch:t}),submit:!1,title:"Make reactive"}),[2]})}),function(e,n,t){return I.apply(this,arguments)}),em=t(14924),ef=t(61582),ev=t(15214),eh=t(58594),eb=t(90951),eg=t(49501),ex=t(55563),ej=t(77439),ey=t(51466),eZ=function(){var e,n=(e=(0,q.Z)(function(){return(0,T.__generator)(this,function(e){return[2]})}),function(){return e.apply(this,arguments)});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ey.Z,{children:"No completed quotes"}),(0,r.jsx)(ej.Z,{content:"Resend notification to selected supplier(s)",size:"sm",onClick:n})]})},eI=t(18409),eS=t(52324),ew=t(96715),eC=function(e){var n,t=e.job,a=e.user,s=e.quotations,u=e.refetch,l=e.toggleShow,c=(0,D.x)(),d=(0,o.useContext)(U.Z),p=null==a?void 0:a.quoteThreshold,m=s.filter(function(e){return["supplierQuoteComplete","supplierQuoteSent","thresholdApproved","waitingThresholdApproval"].includes(e.status)}),f=(0,er.cI)({defaultValues:{selectedQuotes:t.selectedQuotes||[]}}),h=f.errors,b=f.handleSubmit,g=f.register,x=f.watch,j=(0,o.useState)(0),y=j[0],Z=j[1],I=(0,o.useState)([]),S=I[0],w=I[1],C=x(),R=C.selectedQuotes,A=C.sendQuote,E=R&&R.length>0;(0,o.useEffect)(function(){w(m.filter(function(e){var n=1.2*e.lineItems.reduce(function(e,n){return e+n.total},0);return!(!R.includes("".concat(e.id))||(0,ew.il)(p,n)||(0,eS.Pn)("adminCustomer",null==t?void 0:t.timings,e.id))&&(n>y&&Z(n),!0)}))},[R]);var k,$,H=(0,_.Z)((0,P.D)(ef.Dg),1)[0],M=(0,_.Z)((0,P.D)(v.xY,{onCompleted:function(){u&&u(),l()}}),1)[0],O=(0,_.Z)((0,P.D)(v.yT),1)[0],N=m.map(function(e){return{id:e.id,label:e.quoteNumber,value:e.id}}),F=($=(0,q.Z)(function(e){var n,r,o;return(0,T.__generator)(this,function(s){switch(s.label){case 0:var u;return n=(0,i.Z)({},t.meta),"string"==typeof e.selectedQuotes&&(e.selectedQuotes=[e.selectedQuotes]),r=[],[4,Promise.all(e.selectedQuotes.map((u=(0,q.Z)(function(e){var n,i;return(0,T.__generator)(this,function(o){switch(o.label){case 0:return n=N.find(function(n){return Number(e)===n.id}),[4,(0,et.L)(t,Number(e),c)];case 1:return i=o.sent(),r.push({label:n.label,url:i}),[2,H({variables:{id:e,changes:{status:"supplierQuoteSent"},supplierOffer:[]}})]}})}),function(e){return u.apply(this,arguments)})))];case 1:return s.sent(),o="quoteSent","sendQuote"===A&&e.sendQuote&&e.quotingEmail&&O({variables:{timing:{status:"quotePDFSent",jobId:t.id,userId:a.id,meta:{toEmail:e.quotingEmail,selectedQuotations:r}}}}),M({variables:{id:t.id,changes:{status:o,meta:n},timing:{status:o,jobId:t.id,userId:a.id},_append:{statusData:(0,em.Z)({},o,X()().toISOString())}}}),[2]}})}),function(e){return $.apply(this,arguments)});if(0===m.length)return(0,r.jsx)(eZ,{});var J={errors:h,register:g};return(0,r.jsxs)(ea.Z,{handleSubmit:b(F),children:[S.length>0&&(0,r.jsx)(ev.Z,{content:"Based on your user settings, this quote requires approval before it can be sent.\n          Please request approval by clicking the button below.",context:"warning"}),(0,r.jsx)(eh.Z,(0,ei.Z)((0,i.Z)({},J),{data:N,legend:"Select quotations",name:"selectedQuotes"})),(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},J),{data:[{id:"sendQuote",label:"Send quote via email",value:"sendQuote"},{id:"markAsQuoteSent",label:"Mark quote as sent",value:"markAsQuoteSent"}],name:"sendQuote",stacked:!0})),"sendQuote"===A&&(0,r.jsx)(eg.Z,{label:"Send to email address",children:(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},J),{defaultValue:null===(n=t.supplier)||void 0===n?void 0:n.details[0].quotingEmail,name:"quotingEmail"}))}),S.length>0?(0,r.jsx)(ej.Z,{content:"Request approval",size:"md",disabled:!E,onClick:function(){return(0,eI.I_)({type:"quote",role:"adminCustomer",quotations:S,jobId:t.id,accountId:a.accountId,amount:y,offCanvas:d})}}):(0,r.jsx)("div",{style:{marginTop:"10px"},children:(0,r.jsx)(ej.Z,{content:"Send Quotation(s)",size:"md",type:"submit",disabled:!E})})]})};eC.propTypes={job:A.object,quotations:A.array,setJob:A.func};var eR,eq=function(e,n,t,i){t.show({content:(0,r.jsx)(eC,{job:e,user:n,quotations:e.quotations,refetch:i,toggleShow:t.close}),submit:!1,title:"Send Quote"})},e_=t(6710),eT=t(64811),eA=function(e){var n,t=e.job,i=e.refetch,a=e.status,s=e.toggleShow,l=e.onClose,c=e.shouldCalculateFinance,d=(0,D.x)(),p=(0,o.useContext)(u.Z).user,m=(0,er.cI)({defaultValues:{comments:""}}),f=m.errors,h=m.handleSubmit,b=m.register,g=(0,_.Z)((0,P.D)(v.xY,{onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!c)return[3,2];return[4,(0,eT.F)(d,t.id)];case 1:e.sent(),i&&i(),s(),e.label=2;case 2:return[2]}})}),refetchQueries:["GetJob"]}),1)[0],x=(n=(0,q.Z)(function(e){return(0,T.__generator)(this,function(n){return g({variables:{id:t.id,changes:{status:a},_append:{statusData:(0,em.Z)({},a,new Date().toISOString())},timing:{notes:e.comments,status:a,jobId:t.id,userId:p.id}}}).then(function(){l()}).catch(function(e){}),[2]})}),function(e){return n.apply(this,arguments)});return(0,r.jsxs)(ea.Z,{handleSubmit:h(x),children:[(0,r.jsx)(eg.Z,{label:"Comments",children:(0,r.jsx)(e_.Z,{errors:f,name:"comments",register:b,rows:3})}),(0,r.jsx)(es.H,{content:"Submit",type:"submit"})]})};eA.propTypes={job:A.object.isRequired,refetch:A.func.isRequired,status:A.string.isRequired,toggleShow:A.func.isRequired};var eE=(eR=(0,q.Z)(function(e,n,t,i,o){var a;return(0,T.__generator)(this,function(s){return a=(null!=o?o:{shouldCalculateFinance:!0}).shouldCalculateFinance,t.show({content:(0,r.jsx)(eA,{job:e,status:n,toggleShow:t.show,refetch:i,onClose:t.close,shouldCalculateFinance:a}),submit:!1,title:"Job status change"}),[2]})}),function(e,n,t,i,r){return eR.apply(this,arguments)}),eD=t(95103),eP=t(40552),ek=[1,2,3].map(function(e){return{text:e,value:e,disabled:!1}}),e$=function(e){var n,t=e.job,o=e.toggleShow,a=e.updateJob,s=e.addJobTiming,u=e.user,c=(0,er.cI)(),d=c.control,p=c.errors,m=c.handleSubmit,f=c.register,v=(n=(0,q.Z)(function(e){var n;return(0,T.__generator)(this,function(n){switch(n.label){case 0:return e.status="quoteNew",e.type="quote",e.quoteDue=X()(e.quoteDue).format(),e.quoted=!0,[4,s({variables:{objects:[{notes:"Compliance to Quote",status:"quoteNew",jobId:t.id,userId:u.id}]}})];case 1:return n.sent(),[4,a({variables:{id:t.id,changes:e}}).then(function(){o()})];case 2:return n.sent(),[2]}})}),function(e){return n.apply(this,arguments)}),h={control:d,errors:p,register:f};return(0,r.jsxs)(ea.Z,{handleSubmit:m(v),children:[(0,r.jsx)(eg.Z,{label:"Number of Quotes",children:(0,r.jsx)(eD.Z,(0,ei.Z)((0,i.Z)({},h),{name:"quoteNumber",options:[{text:"Select Type",value:"",disabled:!1}].concat((0,l.Z)(ek))}))}),(0,r.jsx)(eg.Z,{label:"Quote due date"}),(0,r.jsx)(eP.M,(0,ei.Z)((0,i.Z)({},h),{name:"quoteDue"})),(0,r.jsx)(es.H,{content:"Create quote",size:"md",type:"submit"})]})},eH=t(9270),eM=t(62140),eO=t(11585);function eN(){var e=(0,m.Z)(["\n  mutation InsertExpense($objects: [Expense_insert_input!]!) {\n    insert_Expense(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return eN=function(){return e},e}function eF(){var e=(0,m.Z)(["\n  mutation UpdateExpense($id: Int!, $changes: Expense_set_input) {\n    update_Expense_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return eF=function(){return e},e}function eJ(){var e=(0,m.Z)(["\n  mutation UpdateExpense($parentId: Int!, $changes: Expense_set_input) {\n    parentExspense: update_Expense(where: { id: { _eq: $parentId } }, _set: $changes) {\n      returning {\n        id\n      }\n    }\n    childExpenses: update_Expense(where: { parentId: { _eq: $parentId } }, _set: $changes) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return eJ=function(){return e},e}function eL(){var e=(0,m.Z)(['\n  query GetExpenses($entity: String, $entityId: Int, $jobId: Int) {\n    expenses: Expense(\n      where: { jobId: { _eq: $jobId }, entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n    ) {\n      id\n      categoryId\n      description\n      amount\n      unit\n      markup\n      vat\n      paid\n      jobId\n      total\n      entity\n      entityId\n      occurredAt\n      recurring\n      category: Category {\n        name\n      }\n      media: Media(where: { entity: { _eq: "Expense" } }) {\n        id\n      }\n    }\n  }\n']);return eL=function(){return e},e}function eU(){var e=(0,m.Z)(["\n  mutation DeleteExpense($id: Int!) {\n    delete_Expense_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return eU=function(){return e},e}var eV=(0,f.Ps)(eN()),eQ=(0,f.Ps)(eF()),ez=(0,f.Ps)(eJ()),eY=(0,f.Ps)(eL()),eB=(0,f.Ps)(eU()),eG=t(52019),eW=t(68956),eK=t(16551),eX=t(33006),e0=t(86036),e1=t(16540),e2=t(97637),e4=t(28497),e3=t(32979),e6=(0,el.Ry)().shape({amount:(0,el.Rx)().required(),unit:(0,el.Rx)().required(),categoryId:(0,el.Ry)().required(),description:(0,el.Z_)().required(),markup:(0,el.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),paid:(0,el.Z_)().oneOf(["admin","supplier"]).required(),vatMarkup:(0,el.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable()}),e5=function(e){e.categories,e.currency;var n=e.defaultValues,t=e.submit,o=e.serviceRateExpenses,a=e.showRecurring;(null==n?void 0:n.vat)&&(null==n?void 0:n.vat)!=="20"&&(n.vatMarkup=n.vat,n.vat="custom");var s=(0,er.cI)({defaultValues:(0,i.Z)({vat:"20"},n),resolver:(0,eo.S)(e6)}),u=s.control,l=s.errors,c=s.handleSubmit,d=s.register,p=(0,s.watch)("vat"),m={control:u,errors:l,register:d};return(0,r.jsxs)(ea.Z,{id:"offCanvasForm",handleSubmit:c(t),children:[(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},m),{name:"paid",data:[{id:"admin",label:"Admin",value:"admin"},{id:"supplier",label:"Supplier",value:"supplier"}],legend:"Paid by"})),(0,r.jsx)(e4.Z,(0,ei.Z)((0,i.Z)({},m),{name:"amount",label:"Unit Cost",vat:"Ex VAT"})),(0,r.jsx)(eg.Z,{label:"Units",children:(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},m),{name:"unit"}))}),(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},m),{name:"vat",data:[{id:"default",label:"Default (20%)",value:20},{id:"custom",label:"Custom",value:"custom"}],legend:"VAT"})),"custom"===p&&(0,r.jsx)(e3.Z,(0,ei.Z)((0,i.Z)({},m),{label:"Custom VAT",name:"vatMarkup"})),o?(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},m),{name:"markup",type:"hidden"})):(0,r.jsx)(e3.Z,(0,ei.Z)((0,i.Z)({},m),{label:"Markup ".concat(o?"(Service Rate Expenses and Materials : ".concat(o,"%)"):""),name:"markup"})),(0,r.jsx)(eu.P,(0,ei.Z)((0,i.Z)({},m),{errors:(0,i.Z)({},l),label:"Category",name:"categoryId",type:"expenseCategory"})),(0,r.jsx)(eg.Z,{label:"Description",children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},m),{name:"description",rows:2}))}),a&&(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},m),{name:"recurring",data:[{id:"recurring",label:"Recurring",value:"recurring"},{id:"nextInvoice",label:"Only for next invoice",value:"nextInvoice"}]})),n.id&&(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},m),{name:"id",type:"hidden"}))]})};e5.propTypes={currency:A.string,defaultValues:A.object,serviceRateExpenses:A.number,submit:A.func.isRequired},e5.defaultProps={currency:"GBP",serviceRateExpenses:0,showRecurring:!1};var e7=function(e,n,t){var r=0,o=0,a=null==e?void 0:e.filter(function(e){return"supplier"===t&&"supplier"===e.paid||"supplier"!==t});return{preparedExpenses:null==a?void 0:a.map(function(e){var a=e.amount;"supplier"!==t&&(a+=e.markup/100*a,a/=1-n/100);var s=a*(e.unit||1),u=s+s*(e.vat/100);return o+=s,r+=u,(0,ei.Z)((0,i.Z)({},e),{id:e.id,name:e.description,unitCost:a,price:s,total:u,unit:e.unit||1,vatAmount:s*(e.vat/100),vatRate:e.vat/100,markup:e.markup})}),totalExpenses:r,totalExpensesExVAT:o}},e9=function(e,n,t){if(!n)return null;var i,r=null===(i=(0,l.Z)(n).sort(function(e,n){return e.createdAt-n.createdAt}).find(function(n){return n.type===e}))||void 0===i?void 0:i.value;return r||0===r?r:t||0},e8=t(74492),ne=function(e){var n,t,a,s,u,l,d=e.currency,p=e.enableUpdate,m=e.entity,f=e.entityId,v=e.job,h=e.jobs,b=e.refetchParent,g=e.tab,x=e.withDetails,j=e.showRecurring,y=(0,D.x)(),Z=(0,o.useContext)(eG.Z).hasRole,I=(0,e8.a)(),S=(0,W.E)(v,"invoiceSent"),w=(0,W.E)(v,"closed"),C=Z("customer")&&!S,R=!v||!w&&(Z(["admin"])&&!(0,W.E)(v,["validated","unvalidated"])||Z(["admin","supplier"])&&!(0,W.E)(v,"reportSent")||p),A=e9("serviceRateExpenses",null==v?void 0:v.financeLogs,null==v?void 0:null===(n=v.customer)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:null===(a=t.finance)||void 0===a?void 0:a.serviceRateExpenses)||0,E=g||(!Z("admin")&&Z("supplier")?"supplier":"admin"),k=(0,c.a)(eY,{variables:{entity:m,entityId:f,jobId:null==v?void 0:v.id},skip:C}),$=k.data,H=(void 0===$?{expenses:[]}:$).expenses,M=k.loading,O=k.refetch,N=e7(H,0,E),F=N.preparedExpenses,J=N.totalExpenses,L=N.totalExpensesExVAT,U=(0,_.Z)((0,P.D)(eB,{onCompleted:function(){v&&(0,eT.F)(y,v.id),"JobSchedule"===m&&f&&(0,eT.j)({client:y,scheduleId:f}),"Location"===m&&f&&(0,eT.j)({client:y,locationId:f}),b?b():O()}}),1)[0],V=(0,_.Z)((0,P.D)(eV,{onCompleted:function(){v&&(0,eT.F)(y,v.id),"JobSchedule"===m&&f&&(0,eT.j)({client:y,scheduleId:f}),"Location"===m&&f&&(0,eT.j)({client:y,locationId:f}),I.close(),b?b():O()}}),1)[0],Q=(0,_.Z)((0,P.D)(eQ,{onCompleted:function(){v&&(0,eT.F)(y,v.id),"JobSchedule"===m&&f&&(0,eT.j)({client:y,scheduleId:f}),"Location"===m&&f&&(0,eT.j)({client:y,locationId:f}),I.close(),b?b():O()}}),1)[0],z=(0,_.Z)((0,P.D)(ez,{onCompleted:function(){v&&(0,eT.F)(y,v.id),"JobSchedule"===m&&f&&(0,eT.j)({client:y,scheduleId:f}),"Location"===m&&f&&(0,eT.j)({client:y,locationId:f}),I.close(),b?b():O()}}),1)[0],Y=(s=(0,q.Z)(function(e){var n,t;return(0,T.__generator)(this,function(r){switch(r.label){case 0:if(!e.id)return[3,2];return delete(n=(0,i.Z)({},e)).id,[4,z({variables:{parentId:e.id,changes:n}})];case 1:return r.sent(),[3,4];case 2:return t=(0,ei.Z)((0,i.Z)({},e),{entity:m,entityId:f,Expenses:{data:h.map(function(n){return(0,ei.Z)((0,i.Z)({},e),{jobId:n.id})})}}),[4,V({variables:{objects:t}})];case 3:r.sent(),r.label=4;case 4:return[2]}})}),function(e){return s.apply(this,arguments)}),B=(u=(0,q.Z)(function(e){var n,t;return(0,T.__generator)(this,function(r){switch(r.label){case 0:if("custom"===e.vat&&(e.vat=e.vatMarkup),t=(n=e.unit*e.amount)*(e.markup/100)+n,e.total=t*(e.vat/100)+t,delete e.vatMarkup,e.categoryId=e.categoryId.value,"JobSchedule"!==m)return[3,2];return[4,Y(e)];case 1:case 3:return r.sent(),[3,6];case 2:if(!e.id)return[3,4];return[4,Q({variables:{id:e.id,changes:e}})];case 4:return[4,V({variables:{objects:(0,ei.Z)((0,i.Z)({},e),{jobId:null==v?void 0:v.id})}})];case 5:r.sent(),r.label=6;case 6:return[2]}})}),function(e){return u.apply(this,arguments)}),G=function(e){var n=e.item?(0,i.Z)({},null==e?void 0:e.item):{markup:A};(null==n?void 0:n.vat)&&(n.vat=String(n.vat)),I.show({content:(0,r.jsx)(e5,{currency:d,defaultValues:n,entityId:f,submit:B,serviceRateExpenses:A,showRecurring:j}),title:"Expenses"})},K=function(e,n){e.preventDefault(),e.stopPropagation(),U({variables:{id:n.item.id}})},X=function(e){I.show({content:(0,r.jsx)(e2.G,{entity:"Expenses",entityId:e.item.id}),submit:!1,title:"Media"})},en=[{text:"Description"},{formatter:function(e){var n=e.row;return(0,ee.Z)(n.total,d)},text:"Total"},{text:"Paid By"},{formatter:eW.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:function(e,n){return G(n)},tooltip:"Edit"},{context:"info",icon:["fas","file-upload"],numberOverlay:"mediaCount",onClick:function(e,n){return X(n)},tooltip:"Media"},{context:"danger",icon:["fas","trash"],onClick:function(e,n){return K(e,n)},tooltip:"Delete"}],hidden:!R,text:"Actions"},{hidden:!0},{hidden:!0}],et=function(){return(0,r.jsx)(eK.Z,{children:(0,r.jsx)(ej.Z,{context:"secondary",content:"Add",onClick:G,size:"sm"})})},er=function(){return(0,r.jsxs)(r.Fragment,{children:[!x&&(0,r.jsx)(eX.Z,{content:"Expenses",tag:"h3"}),(0,r.jsxs)(eH.Z,{children:[(0,r.jsx)(eM.Z,{md:6,children:(0,r.jsx)(e0.Z,{content:"Total",text:(0,ee.Z)(L,d)})}),(0,r.jsx)(eM.Z,{md:6,children:(0,r.jsx)(e0.Z,{content:"VAT Total",text:(0,ee.Z)(J,d)})})]}),(0,r.jsx)(e1.Z,{columns:en,loading:M,rows:null==F?void 0:F.map(function(e){var n,t;return{description:e.description,total:e.total,paid:e.paid.charAt(0).toUpperCase()+e.paid.slice(1),actions:"",item:(0,i.Z)({},e,{occurredAt:new Date(e.occurredAt)},{categoryId:{label:null===(n=e.category)||void 0===n?void 0:n.name,value:e.categoryId}}),mediaCount:null===(t=e.media)||void 0===t?void 0:t.length}})}),R&&!x&&(0,r.jsx)(eK.Z,{align:"flex-end",children:(0,r.jsx)(ej.Z,{context:"secondary",content:"Add",onClick:G,size:"sm"})})]})};return x?(0,r.jsx)(eO.Z,{toolbar:R&&(0,r.jsx)(et,{}),open:!0,title:"Expenses",children:er()}):er()};ne.propTypes={currency:A.string,enableUpdate:A.bool,entity:A.string,entityId:A.number,job:A.object,jobs:(0,A.arrayOf)(A.object),refetchParent:A.func,tab:A.string,withDetails:A.bool},ne.defaultProps={currency:"GBP",enableUpdate:!1,withDetails:!0,showRecurring:!1};var nn=function(e){return(0,el.Ry)().shape((0,em.Z)({},e,(0,el.Rx)().required()))},nt=t(70768),ni=t(26936),nr=function(e){var n=e.defaultValue,t=e.label,i=e.name,a=e.onSubmit,s=e.rightLabel,u=e.clearLogs,l=(0,er.cI)({resolver:(0,eo.S)(nn(i))}),c=l.errors,d=l.handleSubmit,p=l.control,m=l.reset,f=l.setValue;(0,o.useEffect)(function(){isNaN(n)||f(i,n)},[n,i,f]);var v=function(e){a(i,e[i]),m()};return(0,r.jsx)("form",{onSubmit:d(v),children:(0,r.jsxs)(N.ZP,{container:!0,children:[(0,r.jsx)(N.ZP,{item:!0,xs:4,children:t&&(0,r.jsxs)(J.Z,{children:[t,":"]})}),(0,r.jsx)(N.ZP,{item:!0,xs:8,children:(0,r.jsxs)(F.Z,{direction:"row",spacing:1,children:[(0,r.jsx)(er.Qr,{name:i,control:p,render:function(e){var n,t=e.value,o=e.onChange;return(0,r.jsx)(nt.I,{leftLabel:(0,r.jsx)(ni.Z,{sx:{height:"18px"}}),rightLabel:s,sx:{width:"80px"},type:"number",InputProps:{inputProps:{min:0,step:".01"}},value:t,onChange:o,error:c[i],helperText:null===(n=c[i])||void 0===n?void 0:n.message})}}),(0,r.jsx)(O.Z,{size:"small",variant:"contained",color:"danger",onClick:function(){u(i,m)},children:"Clear"}),(0,r.jsx)(O.Z,{size:"small",variant:"contained",type:"submit",children:"Save"})]})})]})})};nr.defaultProps={rightLabel:"Ex Vat"},nr.propTypes={defaultValue:A.object,label:A.string,name:A.string,onSubmit:A.func.isRequired,rightLabel:A.string,clearLogs:A.func.isRequired};var no=t(10367),na=t(43916),ns=t(19639);function nu(){var e=(0,m.Z)(["\n  display: flex;\n"]);return nu=function(){return e},e}function nl(){var e=(0,m.Z)(["\n  display: flex;\n  align-items: center;\n  margin-bottom: 9px;\n"]);return nl=function(){return e},e}var nc=function(e){var n=e.defaultValue,t=e.label,i=e.name,a=e.onSubmit,s=(0,er.cI)({resolver:(0,eo.S)(nn(i))}),u=s.errors,l=s.handleSubmit,c=s.register,d=s.reset,p=s.setValue;(0,o.useEffect)(function(){n&&p(i,n)},[n]);var m=function(e){a(i,e[i]),d()};return(0,r.jsx)(ea.Z,{handleSubmit:l(m),children:(0,r.jsx)(eH.Z,{align:"center",children:(0,r.jsx)(eM.Z,{md:12,children:(0,r.jsx)(eg.Z,{label:t,children:(0,r.jsxs)(nd,{children:[(0,r.jsx)(e3.Z,{errors:u,name:i,register:c}),(0,r.jsx)(np,{children:(0,r.jsx)(na.Z,{children:(0,r.jsx)(ns.Z,{addonType:"append",children:(0,r.jsx)(ej.Z,{content:"Save",context:"secondary",type:"submit",size:"sm"})})})})]})})})})})};nc.propTypes={defaultValue:A.object,label:A.string,name:A.string,onSubmit:A.func.isRequired};var nd=no.ZP.div.withConfig({displayName:"percentInput__StyledWrapper",componentId:"sc-1b47f400-0"})(nu()),np=no.ZP.div.withConfig({displayName:"percentInput__StyledInputGroup",componentId:"sc-1b47f400-1"})(nl()),nm=t(45451),nf=function(e){var n=e.loading,t=e.logs;return(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"h6",children:"Change Log"}),(0,r.jsx)(nm.i,{columns:[{flex:1,field:"type",headerName:"Type",sortable:!1},{flex:1,field:"value",headerName:"Value",sortable:!1},{flex:1,field:"user",headerName:"User",sortable:!1},{flex:1,field:"date",headerName:"Date",sortable:!1}],loading:n,rows:t.map(function(e){var n;return{id:e.id,type:e.type,value:e.value?"".concat(e.value," (").concat(e.difference>0?"+".concat(e.difference):e.difference||"-",")"):"clear",user:(null===(n=e.meta)||void 0===n?void 0:n.username)||"-",date:X()(e.createdAt).format("YYYY-MM-DD")}})})]})};nf.propTypes={logs:A.array.isRequired,loading:A.bool.isRequired};var nv=t(74944),nh=t(83336),nb=t(86574),ng=t(86858),nx=t(1691),nj=function(e){var n,t,i,a,s,u,l,d,m,f=e.job,v=e.refetchJob,h=e.activeTab,b=(0,nv.x)().user,g=(0,D.x)(),x=(0,o.useState)(0),j=x[0],y=x[1],Z=(!!(null===(n=f.customer)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:null===(i=t.finance)||void 0===i?void 0:i.serviceRateLabour)||!!(null===(a=f.customer)||void 0===a?void 0:null===(s=a.meta)||void 0===s?void 0:null===(u=s.finance)||void 0===u?void 0:u.serviceRateExpenses))&&"supplier"!==h,I=(0,c.a)(p.bZ,{variables:{jobId:f.id}}),S=I.loading,w=I.data,C=void 0===w?{logs:[],jobInfo:{}}:w,R=C.logs,A=C.jobInfo,E=I.refetch,k=(0,_.Z)((0,P.D)(p.Tw,{onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!f)return[3,2];return[4,(0,eT.F)(g,f.id)];case 1:e.sent(),e.label=2;case 2:return E(),v(),[2]}})})}),1)[0],$=(d=(0,q.Z)(function(e,n){var t,i;return(0,T.__generator)(this,function(i){switch(i.label){case 0:return t="timing"!==e?n-e9(e,R)||0:null,[4,k({variables:{objects:[{type:e,value:n,jobId:f.id,difference:t,meta:{username:"".concat(b.nameFirst," ").concat(b.nameLast),userId:b.id}}]}})];case 1:return i.sent(),[2]}})}),function(e,n){return d.apply(this,arguments)}),H=(m=(0,q.Z)(function(e,n){var t,i;return(0,T.__generator)(this,function(i){switch(i.label){case 0:return t=null,[4,k({variables:{objects:[{type:e,value:null,jobId:f.id,difference:t,meta:{username:"".concat(b.nameFirst," ").concat(b.nameLast),userId:b.id}}]}}).then(function(){return n()})];case 1:return i.sent(),[2]}})}),function(e,n){return m.apply(this,arguments)}),O=function(e,n){y(n)};return S?(0,r.jsx)(F.Z,{alignItems:"center",children:(0,r.jsx)(L.Z,{color:"secondary"})}):"ppm"===A.type&&(null===(l=A.jobSchedule)||void 0===l?void 0:l.invoiceBasis)==="fixedMonthlyAmount"?(0,r.jsx)(F.Z,{children:(0,r.jsx)(nx.Z,{variant:"filled",severity:"info",color:"info",children:"This work order is part of a PPM item that invoices a fixed monthly amount. If you would like to invoice an additional amount, please use the ad-hoc invoice option within this work order. To reduce the amount, you will need to issue a (partial) credit note against the relevant monthly invoice which can be seen in the customer's finance tab."})}):(0,r.jsxs)(F.Z,{children:[(0,r.jsxs)(M.Z,{sx:{width:"100%",height:"100%"},children:[(0,r.jsx)(M.Z,{children:(0,r.jsxs)(nh.m,{value:j,onChange:O,children:[(0,r.jsx)(nb.O,{label:"Customer"}),(0,r.jsx)(nb.O,{label:"Supplier"})]})}),(0,r.jsx)(ng.x,{value:j,index:0,children:(0,r.jsxs)(F.Z,{spacing:2,children:[Z&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(nc,{defaultValue:e9("serviceRateLabour",R),label:"Service Rate Labour ",name:"serviceRateLabour",onSubmit:$,clearLogs:H}),(0,r.jsx)(nc,{defaultValue:e9("serviceRateExpenses",R),label:"Service Rate Expenses and Materials",name:"serviceRateExpenses",onSubmit:$,clearLogs:H})]}),(0,r.jsx)(nr,{defaultValue:e9("discount",R),label:"Customer discount",name:"discount",onSubmit:$,clearLogs:H,vat:"Ex VAT"}),!Z&&"fixed"===f.pricing&&(0,r.jsx)(nr,{defaultValue:e9("amount",R),label:"Amount",name:"amount",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),"time-materials"===f.pricing&&!Z&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(J.Z,{variant:"h6",children:"Normal"}),(0,r.jsx)(nr,{defaultValue:e9("firstHourRateCustomerNormal",R),label:"First hour rate",name:"firstHourRateCustomerNormal",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),(0,r.jsx)(nr,{defaultValue:e9("subsequentHoursRateCustomerNormal",R),label:"Subsequent hours rate",name:"subsequentHoursRateCustomerNormal",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),(0,r.jsx)(J.Z,{variant:"h6",children:"OOH"}),(0,r.jsx)(nr,{defaultValue:e9("firstHourRateCustomerOOH",R),label:"First hour rate",name:"firstHourRateCustomerOOH",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),(0,r.jsx)(nr,{defaultValue:e9("subsequentHoursRateCustomerOOH",R),label:"Subsequent hours rate",name:"subsequentHoursRateCustomerOOH",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),(0,r.jsx)(J.Z,{variant:"h6",children:"Premium"}),(0,r.jsx)(nr,{defaultValue:e9("firstHourRateCustomerPremium",R),label:"First hour rate",name:"firstHourRateCustomerPremium",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),(0,r.jsx)(nr,{defaultValue:e9("subsequentHoursRateCustomerPremium",R),label:"Subsequent hours rate",name:"subsequentHoursRateCustomerPremium",onSubmit:$,clearLogs:H,vat:"Ex Vat"})]})]})}),(0,r.jsx)(ng.x,{value:j,index:1,children:(0,r.jsxs)(F.Z,{spacing:2,children:[(0,r.jsx)(nr,{defaultValue:e9("supplierDeduction",R),label:"Supplier deduction",name:"supplierDeduction",onSubmit:$,clearLogs:H,vat:"Ex VAT"}),"fixed"===f.pricing&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(nr,{defaultValue:e9("supplierLabourAmount",R),label:"Supplier labour amount",name:"supplierLabourAmount",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),(0,r.jsx)(nr,{defaultValue:e9("supplierMaterialsAmount",R),label:"Supplier materials amount",name:"supplierMaterialsAmount",onSubmit:$,clearLogs:H,vat:"Ex Vat"})]}),"time-materials"===f.pricing&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(J.Z,{variant:"h6",children:"Normal"}),(0,r.jsx)(nr,{defaultValue:e9("firstHourRateSupplierNormal",R),label:"First hour rate",name:"firstHourRateSupplierNormal",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),(0,r.jsx)(nr,{defaultValue:e9("subsequentHoursRateSupplierNormal",R),label:"Subsequent hours rate",name:"subsequentHoursRateSupplierNormal",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),(0,r.jsx)(J.Z,{variant:"h6",children:"OOH"}),(0,r.jsx)(nr,{defaultValue:e9("firstHourRateSupplierOOH",R),label:"First hour rate",name:"firstHourRateSupplierOOH",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),(0,r.jsx)(nr,{defaultValue:e9("subsequentHoursRateSupplierOOH",R),label:"Subsequent hours rate",name:"subsequentHoursRateSupplierOOH",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),(0,r.jsx)(J.Z,{variant:"h6",children:"Premium"}),(0,r.jsx)(nr,{defaultValue:e9("firstHourRateSupplierPremium",R),label:"First hour rate",name:"firstHourRateSupplierPremium",onSubmit:$,clearLogs:H,vat:"Ex Vat"}),(0,r.jsx)(nr,{defaultValue:e9("subsequentHoursRateSupplierPremium",R),label:"Subsequent hours rate",name:"subsequentHoursRateSupplierPremium",onSubmit:$,clearLogs:H,vat:"Ex Vat"})]})]})})]}),(0,r.jsx)(nf,{logs:R,loading:!1})]})};nj.propTypes={job:A.object.isRequired,refetchJob:A.func.isRequired};var ny=t(95124),nZ=t(62247),nI=t(50135),nS=t(69368),nw=t(50480),nC=t(6054),nR=t(76990),nq=t(20390),n_=function(e){var n,t,a,s,u,l,c,d,p,m,f,v=e.description,h=e.handleWorkDescriptionSubmit,b=e.job,g=e.currentQuestions,x=(0,o.useState)(g),j=x[0],y=x[1],Z={};b.shortJobDesc&&b.shortJobDesc.length>0&&(Z={value:b.shortJobDesc[0].taxonomyId,label:b.shortJobDesc[0].taxonomy.name});var I=(0,er.cI)({defaultValues:{description:v,taxonomyId_ShortDesc:Z,name:(null===(n=b.meta)||void 0===n?void 0:n.reporter)?"".concat(null===(t=b.meta)||void 0===t?void 0:null===(a=t.reporter)||void 0===a?void 0:a.nameFirst," ").concat(null===(s=b.meta)||void 0===s?void 0:null===(u=s.reporter)||void 0===u?void 0:u.nameLast):"",email:null===(l=b.meta)||void 0===l?void 0:null===(c=l.reporter)||void 0===c?void 0:c.email,phone:null===(d=b.meta)||void 0===d?void 0:null===(p=d.reporter)||void 0===p?void 0:p.phone,shouldSendNotifications:null===(m=b.meta)||void 0===m?void 0:null===(f=m.reporter)||void 0===f?void 0:f.shouldSendNotifications}}),S=I.control,w=I.errors,C=I.handleSubmit,R=I.register,q=I.setValue,_=(0,I.watch)("taxonomyId_ShortDesc",g),T=(0,nC.Z)(_);(0,o.useEffect)(function(){_!==T&&T&&y(_.childs||[])},[T,_]);var A={control:S,errors:w,register:R},E=function(e){h(e)},D=function(e){q("questions",JSON.stringify(e)),C(E)()};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(ea.Z,{handleSubmit:C(E),children:[(0,r.jsx)(nq.l,(0,ei.Z)((0,i.Z)({},A),{label:"Short Job Description",name:"taxonomyId_ShortDesc",type:"jobTags"})),(0,r.jsx)(eg.Z,{label:"Work description",children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},A),{name:"description",rows:3}))}),(0,r.jsxs)(F.Z,{rowGap:2,children:[(0,r.jsx)(J.Z,{typography:"h6",children:"Originator"}),(0,r.jsx)(nI.Z,{name:"name",placeholder:"Name",inputRef:R}),(0,r.jsx)(nI.Z,{name:"phone",placeholder:"Phone",inputRef:R}),(0,r.jsx)(nI.Z,{name:"email",placeholder:"Email",inputRef:R}),(0,r.jsx)(er.Qr,{control:S,name:"shouldSendNotifications",render:function(e){var n=e.value,t=e.onChange;return(0,r.jsx)(nw.Z,{label:"Should originator receive notifications",control:(0,r.jsx)(nS.Z,{checked:n,color:"secondary",onChange:function(e){var n;return t(null===(n=e.target)||void 0===n?void 0:n.checked)}})})}})]}),(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},A),{name:"questions",type:"hidden"}))]}),(0,r.jsx)(nR.D,{entity:"Job",entityId:b.id,onSuccess:D,questions:j})]})};n_.propTypes={description:A.string.isRequired,handleWorkDescriptionSubmit:A.func.isRequired};var nT=function(e){var n,t,i,a=e.isQuotes,s=e.edit,u=e.job,l=e.refetch,c=(0,o.useContext)(U.Z),d=u.shortJobDesc&&u.shortJobDesc.length?u.shortJobDesc[0].taxonomy.name:"",m=null===(n=u.answers)||void 0===n?void 0:n.map(function(e){var n;return{id:e.id,taxonomyId:e.taxonomyId,comments:e.comments,name:null===(n=e.taxonomy)||void 0===n?void 0:n.name}}),f=(0,_.Z)((0,P.D)(p.FA),1)[0],v=(i=(0,q.Z)(function(e){var n;return(0,T.__generator)(this,function(t){switch(t.label){case 0:return n=(0,ny.eD)(e,u.id),delete e.questions,delete e.taxonomyId_ShortDesc,[4,f({variables:{jobId:u.id,changes:e,questions:n,hasQuestions:n.length>0}})];case 1:return t.sent(),c.close(),l(),[2]}})}),function(e){return i.apply(this,arguments)}),h=function(){c.show({content:(0,r.jsx)(n_,{description:u.description||"",handleWorkDescriptionSubmit:v,job:u,currentQuestions:m}),title:"Work Description"})},b=function(){return(0,r.jsx)(ej.Z,{context:"secondary",onClick:h,size:"sm",children:"Edit"})};return(0,r.jsxs)(eO.Z,(t={fitParentHeight:!0,open:!0,title:"Sensors"},(0,em.Z)(t,"title","Issue Reported - Client"),(0,em.Z)(t,"toolbar",s&&(0,r.jsx)(b,{})),(0,em.Z)(t,"children",[!a&&(0,r.jsx)(e0.Z,{content:"Short Job Description",text:d}),(0,r.jsx)(e0.Z,{content:a?"Description":"Job Description",text:u.description}),(0,r.jsx)(nZ.y,{answers:m})]),t))};nT.propTypes={isQuotes:A.bool,edit:A.bool,job:A.object.isRequired},nT.defaultProps={edit:!1};var nA=function(e){var n=e.job,t=e.refetch;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(eH.Z,{children:[(0,r.jsx)(eM.Z,{md:6,children:(0,r.jsx)(ne,{enableUpdate:!0,job:n,open:!0,refetchParent:t},"expenses-".concat(n.id))}),(0,r.jsx)(eM.Z,{md:6,children:(0,r.jsx)(nT,{edit:!0,job:n,refetch:t},"workDescription-".concat(n.id))})]}),(0,r.jsx)(eO.Z,{title:"Amounts",open:!0,children:(0,r.jsx)(nj,{job:n,refetchJob:t})})]})};function nE(){var e=(0,m.Z)(['\n  mutation UpdateJobTiming(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    delete_JobTiming(\n      where: { status: { _in: ["accepted", "lateArrival", "timingChanged"] }, jobId: { _eq: $id } }\n    ) {\n      affected_rows\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n    update_SupplierOffer(where: { jobId: { _eq: $id } }, _set: { status: "offered" }) {\n      returning {\n        id\n      }\n    }\n  }\n']);return nE=function(){return e},e}var nD=(0,f.Ps)(nE()),nP=t(72790),nk=(0,el.Ry)().shape({timing:(0,el.Z_)().required().oneOf(["at","between"]),timingStart:(0,el.hT)().required(),timingEnd:(0,el.hT)().when("timing",{is:function(e){return"between"===e},then:function(){return(0,el.hT)().required()}}),timingNormalHours:(0,el.Z_)()}),n$=function(e){var n,t=e.job,s=e.refetch,l=e.toggleShow,c=(0,a.useRouter)().query,d=(0,D.x)(),p=(0,o.useContext)(u.Z).user,m=(0,o.useContext)(eG.Z).hasRole,f=(0,er.cI)({defaultValues:{timing:t.timing,timingEnd:t.timingEnd?new Date(t.timingEnd):null,allowTimingNormalHours:!t.timingNormalHours,timingStart:t.timingStart?new Date(t.timingStart):null},resolver:(0,eo.S)(nk)}),v=f.control,h=f.errors,b=f.handleSubmit,g=f.register,x=f.setValue,j=f.watch,y=j("timing",t.timing),Z=(0,_.Z)((0,P.D)(nD,{onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!t)return[3,2];return[4,(0,eT.F)(d,t.id)];case 1:e.sent(),e.label=2;case 2:return s&&s(),l(),[2]}})})}),1)[0],I=(n=(0,q.Z)(function(e){var n,r;return(0,T.__generator)(this,function(o){return r=e,["timingEnd","timingStart"].forEach(function(e){r[e]&&(r[e]=X()(r[e]).utc().format())}),"allowTimingNormalHours"===r.allowTimingNormalHours?r.timingNormalHours=!1:r.timingNormalHours=!0,delete r.allowTimingNormalHours,r.timing&&"at"===r.timing&&(r.timingEnd=null),r.scheduledAt=null,r.status="offered",(null===(n=t.meta)||void 0===n?void 0:n.arrivalAnytime)&&(r.meta=(0,ei.Z)((0,i.Z)({},t.meta),{arrivalAnytime:!1})),delete r.timeSpan,Z({variables:{id:t.id,changes:(0,i.Z)({},r),timing:{status:"timingChanged",meta:{timingEnd:X()(t.timingEnd).utc().format(),timingStart:X()(t.timingStart).utc().format()},jobId:t.id,userId:p.id}}}),[2]})}),function(e){return n.apply(this,arguments)});return(0,r.jsx)(ea.Z,{id:"offCanvasForm",handleSubmit:b(I),children:(0,r.jsx)(nP.X,(0,ei.Z)((0,i.Z)({},{control:v,errors:h,register:g}),{hasRole:m,timingWatch:y,setValue:x,watch:j,query:c}))})};function nH(){var e=(0,m.Z)(['\n  mutation UpdateJobPricing(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n    $offerId: Int!\n    $offerChanges: SupplierOffer_set_input\n    $hasOfferAccept: Boolean!\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    update_SupplierOffer_by_pk(pk_columns: { id: $offerId }, _set: $offerChanges)\n      @include(if: $hasOfferAccept) {\n      id\n    }\n    delete_JobTiming(\n      where: { status: { _in: ["accepted", "lateArrival", "pricingChanged"] }, jobId: { _eq: $id } }\n    ) {\n      affected_rows\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n']);return nH=function(){return e},e}n$.propTypes={job:A.object.isRequired,refetch:A.func.isRequired,toggleShow:A.func.isRequired};var nM=(0,f.Ps)(nH()),nO=t(64732),nN=t(79772),nF=function(e){var n={};return["amount","customerSpendThreshold","paymentMethod","pricing","supplierLabourAmount","supplierMaterialsAmount"].forEach(function(t){var i=e[t];"number"==typeof i&&(i=i.toString()),n[t]=i}),e.service&&(n.serviceSelected={value:e.service.id,label:e.service.name}),e.costCategoryTaxonomy&&(n.costCategorySelected={value:e.costCategoryTaxonomy.id,label:e.costCategoryTaxonomy.name}),n},nJ=(0,el.Ry)().shape({costCategorySelected:(0,el.Ry)().required(),serviceSelected:(0,el.Ry)().required(),pricing:(0,el.Z_)().oneOf(["time-materials","fixed"]),customerSpendThreshold:(0,el.Z_)(),amount:(0,el.Z_)(),supplierLabourAmount:(0,el.Z_)(),supplierMaterialsAmount:(0,el.Z_)(),paymentMethod:(0,el.Z_)().oneOf(["card","invoice","N/A"])}),nL=function(e){var n,t,a,s=e.job,c=e.refetch,d=e.toggleShow,p=(0,o.useContext)(u.Z).user,m=(0,D.x)(),f=(0,er.cI)({defaultValues:nF(s),resolver:(0,eo.S)(nJ)}),v=f.control,h=f.errors,b=f.handleSubmit,g=f.register,x=f.watch,j=x("pricing",s.pricing),y=x("serviceSelected",{value:null===(n=s.service)||void 0===n?void 0:n.id,label:null===(t=s.service)||void 0===t?void 0:t.name}),Z=(0,_.Z)((0,P.D)(nM,{onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!s)return[3,2];return[4,(0,eT.F)(m,s.id)];case 1:e.sent(),e.label=2;case 2:return c&&c(),d(),[2]}})})}),1)[0],I=(a=(0,q.Z)(function(e){var n,t,r,o,a;return(0,T.__generator)(this,function(u){var c;return c=e,(["amount","customerSpendThreshold","supplierLabourAmount","supplierMaterialsAmount"].forEach(function(e){c[e]?c[e]=parseInt(c[e]):c[e]=null}),["costCategory","service"].forEach(function(e){c[e+"Selected"]&&c[e+"Selected"].value&&(c[e+"Id"]=c[e+"Selected"].value),delete c[e+"Selected"]}),n=c).status="offered",r=(null==(t=s.supplierOffers.find(function(e){return"accepted"===e.status}))?void 0:t.statusLog)||[],o=(null==t?void 0:t.id)||0,a=(0,l.Z)(r).concat([{createdAt:new Date,status:"offered",userId:p.id}]),Z({variables:{id:s.id,changes:(0,i.Z)({},n),timing:{status:"pricingChanged",jobId:s.id,userId:p.id},offerId:o,hasOfferAccept:!!o,offerChanges:{status:"offered",statusLog:a}}}),[2]})}),function(e){return a.apply(this,arguments)}),S={control:v,errors:h,register:g};return(0,r.jsxs)(ea.Z,{id:"offCanvasForm",handleSubmit:b(I),children:[(0,r.jsx)(nN.t,(0,i.Z)({},S)),(0,r.jsx)(nO.n,(0,ei.Z)((0,i.Z)({},S),{pricingWatch:j,serviceSelectedWatch:y}))]})};function nU(){var e=(0,m.Z)(["\n  mutation AssignSupplier($object: AssignSupplierInput!) {\n    assignSupplier(assignSupplierInput: $object) {\n      data\n      success\n    }\n  }\n"]);return nU=function(){return e},e}function nV(){var e=(0,m.Z)(["\n  query GetSuppliersForAssign($jobId: Int!) {\n    data: getSuppliersForAssign(jobId: $jobId) {\n      job\n      customerRates\n      suppliers\n      hasArea\n      hasActiveOffer\n    }\n  }\n"]);return nV=function(){return e},e}nL.propTypes={job:A.object.isRequired,refetch:A.func.isRequired,toggleShow:A.func.isRequired};var nQ=(0,f.Ps)(nU()),nz=(0,f.Ps)(nV()),nY=t(72852),nB=t(50108),nG=function(e){var n=e.suppliers,t=e.customerRates,i=e.selected,a=e.setSelected,s=e.setError,u=(0,o.useMemo)(function(){return n.map(function(e){var n,i,r,o,a,s;return{id:e.id,name:e.name,normal:{firstHour:e.normal.firstHour,subsequentHours:e.normal.subsequentHours},ooh:{firstHour:e.ooh.firstHour,subsequentHours:e.ooh.subsequentHours},premium:{firstHour:e.premium.firstHour,subsequentHours:e.premium.subsequentHours},above:(null==t?void 0:null===(n=t.normal)||void 0===n?void 0:n.firstHour)<e.normal.firstHour||(null==t?void 0:null===(i=t.normal)||void 0===i?void 0:i.subsequentHours)<e.normal.subsequentHours||(null==t?void 0:null===(r=t.ooh)||void 0===r?void 0:r.firstHour)<e.ooh.firstHour||(null==t?void 0:null===(o=t.ooh)||void 0===o?void 0:o.subsequentHours)<e.ooh.subsequentHours||(null==t?void 0:null===(a=t.premium)||void 0===a?void 0:a.firstHour)<e.premium.firstHour||(null==t?void 0:null===(s=t.premium)||void 0===s?void 0:s.subsequentHours)<e.premium.subsequentHours}})},[n,t]),c=(0,o.useCallback)(function(e,n){n?(a((0,l.Z)(u.map(function(e){return e.id}))),u.some(function(e){return e.above})&&s({message:"Supplier rates are above customer rates.",severity:"error",color:"error"})):a([])},[u,s,a]),d=(0,o.useCallback)(function(e,n,t){n?(a((0,l.Z)(i).concat([t.id])),t.above&&s({message:"Supplier rates are above customer rates.",severity:"error",color:"error"})):a(i.filter(function(e){return e!==t.id}))},[i,s,a]),p=(0,o.useMemo)(function(){return[{flex:1,field:"name",headerName:"Supplier",sortable:!1},{flex:1,field:"normal",headerName:"Normal",sortable:!1,renderCell:function(e){var n=e.row;return(0,r.jsxs)(F.Z,{children:[(0,r.jsxs)(J.Z,{children:["First hour: ",(0,nB.T)(n.normal.firstHour)]}),(0,r.jsxs)(J.Z,{children:["Subsequent hours: ",(0,nB.T)(n.normal.subsequentHours)]})]})}},{flex:1,field:"ooh",headerName:"OOH",sortable:!1,renderCell:function(e){var n=e.row;return(0,r.jsxs)(F.Z,{children:[(0,r.jsxs)(J.Z,{children:["First hour: ",(0,nB.T)(n.ooh.firstHour)]}),(0,r.jsxs)(J.Z,{children:["Subsequent hours: ",(0,nB.T)(n.ooh.subsequentHours)]})]})}},{flex:1,field:"premium",headerName:"Premium",sortable:!1,renderCell:function(e){var n=e.row;return(0,r.jsxs)(F.Z,{children:[(0,r.jsxs)(J.Z,{children:["First hour: ",(0,nB.T)(n.premium.firstHour)]}),(0,r.jsxs)(J.Z,{children:["Subsequent hours: ",(0,nB.T)(n.premium.subsequentHours)]})]})}},{minWidth:60,field:"switch",headerName:"",sortable:!1,renderHeader:function(){return(0,r.jsx)(nY.Z,{color:"secondary",onChange:function(e,n){return c(e,n)}})},renderCell:function(e){var n=e.row;return(0,r.jsx)(nY.Z,{color:"secondary",checked:i.includes(n.id),onChange:function(e,t){return d(e,t,n)}})}}]},[c,d,i]);return(0,r.jsx)(nm.i,{autoHeight:!1,hideFooter:!1,columns:p,rows:u,pagination:!0,sortingMode:"client",paginationSize:10,initialState:{pagination:{paginationModel:{pageSize:10}}}})};nG.propTypes={customerRates:E().object,setError:E().func,setSelected:E().func,suppliers:E().array},nG.defaultProps={customerRates:{},setError:function(){},setSelected:function(){},suppliers:[]};var nW,nK=t(84808),nX=t(19512),n0=function(e){var n,t,i,a,s,u,l,d,p=e.jobId,m=e.repost,f=e.refetch,v=e.toggleShow,h=e.isSingleSupplier,b=(0,D.x)(),g=(0,nX.D)(),x=(0,o.useState)([]),j=x[0],y=x[1],Z=(0,o.useState)(null),I=Z[0],S=Z[1],w=(0,er.cI)().handleSubmit,C=(0,c.a)(nz,{variables:{jobId:p},onError:function(e){g.show({content:"Error: ".concat(e.message),severity:"error"})}}),R=C.data,A=(void 0===R?{data:{job:{},customerRates:null,suppliers:[],hasArea:!0,hasActiveOffer:!1}}:R).data,E=A.job,k=A.suppliers,$=A.customerRates,H=A.hasArea,M=A.hasActiveOffer,O=C.loading,N=(0,_.Z)((0,P.D)(nQ,{onCompleted:(l=(0,q.Z)(function(e){return(0,T.__generator)(this,function(e){switch(e.label){case 0:return[4,(0,eT.F)(b,p)];case 1:return e.sent(),g.show({content:"Supplier was assigned.",severity:"success"}),f(),v(),[2]}})}),function(e){return l.apply(this,arguments)}),onError:function(e){g.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),U=N[0],V=N[1].loading,Q=(d=(0,q.Z)(function(){return(0,T.__generator)(this,function(e){return j.length?h&&M||h&&j.length>1?[2,g.show({content:"Jobs can only be reallocated to one supplier.",severity:"warning",color:"info"})]:"quote"===E.type&&j.length>E.quoteNumber?[2,g.show({content:"Jobs can be assigned to a maximum of ".concat(E.quoteNumber," suppliers."),severity:"warning",color:"info"})]:(U({variables:{object:{jobId:p,repost:m,supplierIds:j}}}),[2]):[2,g.show({content:"Error: Select at least one supplier.",severity:"error"})]})}),function(){return d.apply(this,arguments)});return(0,r.jsxs)("form",{id:"offCanvasForm",onSubmit:w(Q),children:[(O||V)&&(0,r.jsx)(nK.Z,{sx:{zIndex:1e5},open:!0,children:(0,r.jsx)(L.Z,{color:"secondary"})}),(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{children:"Suppliers have been pruned based on the location of the customer and assigned services."}),(0,r.jsxs)(J.Z,{children:["Service: ",(0,r.jsx)("strong",{children:E.serviceName})]}),"quote"!==E.type&&$&&(0,r.jsxs)(J.Z,{children:["Customer rates:"," ",(0,r.jsxs)("strong",{children:[(0,nB.T)(null==$?void 0:null===(n=$.normal)||void 0===n?void 0:n.firstHour),"/",(0,nB.T)(null==$?void 0:null===(t=$.normal)||void 0===t?void 0:t.subsequentHours),"(Normal),","  "]}),(0,r.jsxs)("strong",{children:[(0,nB.T)(null==$?void 0:null===(i=$.ooh)||void 0===i?void 0:i.firstHour),"/",(0,nB.T)(null==$?void 0:null===(a=$.ooh)||void 0===a?void 0:a.subsequentHours),"(OOH),","  "]}),(0,r.jsxs)("strong",{children:[(0,nB.T)(null==$?void 0:null===(s=$.premium)||void 0===s?void 0:s.firstHour),"/",(0,nB.T)(null==$?void 0:null===(u=$.premium)||void 0===u?void 0:u.subsequentHours),"(Premium)"]})]}),"quote"===E.type&&E.quoteNumber&&(0,r.jsxs)(J.Z,{children:[(0,r.jsx)("strong",{children:E.quoteNumber})," supplier(s) needed for quote."]}),(0,r.jsxs)(F.Z,{spacing:1,mt:1,mb:1,children:[!H&&(0,r.jsx)(nx.Z,{variant:"filled",severity:"error",children:"This location does not have an address associated."}),m&&(0,r.jsx)(nx.Z,{variant:"filled",severity:"info",children:"Note: Reposting the job will cancel previous offers."}),I&&(0,r.jsx)(nx.Z,{variant:"filled",severity:I.severity,color:I.color,children:I.message})]}),(0,r.jsx)(nG,{suppliers:k,customerRates:$,selected:j,setSelected:y,setError:S})]})]})};n0.propTypes={jobId:E().string.isRequired,refetch:E().func.isRequired,repost:E().bool,toggleShow:E().func.isRequired,isSingleSupplier:E().bool},n0.defaultProps={repost:!1,isSingleSupplier:!1,refetch:function(){},toggleShow:function(){}};var n1,n2,n4,n3,n6,n5=(nW=(0,q.Z)(function(e){var n,t,i,o;return(0,T.__generator)(this,function(a){return n=e.jobId,t=e.offCanvas,i=e.refetch,o=e.isSingleSupplier,t.show({content:(0,r.jsx)(n0,{jobId:n,refetch:i,toggleShow:t.show,isSingleSupplier:o}),anchor:"left",title:"Assign Supplier",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"65vw",md2:"65vw",lg:"65vw",lg2:"65vw"}),[2]})}),function(e){return nW.apply(this,arguments)}),n7=(n1=(0,q.Z)(function(e,n,t,i,o){return(0,T.__generator)(this,function(a){return n.show({content:(0,r.jsx)(e$,{addJobTiming:i,job:e,toggleShow:n.show,updateJob:t,user:o}),placement:"left",title:"Create Quote",width:"50%"}),[2]})}),function(e,n,t,i,r){return n1.apply(this,arguments)}),n9=(n2=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(nL,{job:e,toggleShow:n.show,refetch:t}),title:"Change job pricing/service",width:"40%"}),[2]})}),function(e,n,t){return n2.apply(this,arguments)}),n8=(n4=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(n$,{job:e,toggleShow:n.show,refetch:t}),title:"Change job timing",width:"40%"}),[2]})}),function(e,n,t){return n4.apply(this,arguments)}),te=(n3=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(nA,{job:e,refetch:t}),submit:!1,title:"Change job finance",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"65vw",md2:"50vw",lg:"50vw",lg2:"50vw"}),[2]})}),function(e,n,t){return n3.apply(this,arguments)}),tn=(n6=(0,q.Z)(function(e){var n,t,i,o;return(0,T.__generator)(this,function(a){return n=e.jobId,e.repost,t=e.offCanvas,i=e.refetch,o=e.isSingleSupplier,t.show({content:(0,r.jsx)(n0,{jobId:n,repost:!0,refetch:i,toggleShow:t.show,isSingleSupplier:o}),anchor:"left",title:"Repost Job",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"65vw",md2:"65vw",lg:"65vw",lg2:"65vw"}),[2]})}),function(e){return n6.apply(this,arguments)}),tt=t(78200),ti=function(e){var n,t=e.job,o=e.quotation,a=e.refetch,s=e.toggleShow,u=(0,er.cI)({defaultValues:{siteVisitAt:o.siteVisitAt?new Date(o.siteVisitAt):null}}),l=u.control,c=u.errors,d=u.handleSubmit,p=u.register,m=t.siteVisitEnd,f=t.siteVisitStart,v=t.siteVisitWeekends,h=(0,_.Z)((0,P.D)(ef.HI,{onCompleted:function(e){a&&a(),s()}}),1)[0],b=(n=(0,q.Z)(function(e){return(0,T.__generator)(this,function(n){switch(n.label){case 0:return e.startDate&&(e.startDate=(0,tt.Z)(new Date(e.startDate))),[4,h({variables:{id:o.id,changes:e,recommend:!1}})];case 1:return n.sent(),[2]}})}),function(e){return n.apply(this,arguments)}),g=function(e){var n=new Date(e);return n.getHours()>=8&&17>n.getHours()&&n.getTime()<=new Date(m).getTime()&&n.getTime()>=new Date(f).getTime()},x=function(e){var n=e.getDay();return 0!==n&&6!==n};return(0,r.jsxs)(ea.Z,{handleSubmit:d(b),children:[(0,r.jsx)(eg.Z,{label:"Site visit time"}),(0,r.jsx)(eP.M,(0,ei.Z)((0,i.Z)({},{control:l,errors:c,register:p}),{register:p,dateFormat:"d MMM yyyy HH:mm",minDate:f?new Date(f):new Date,maxDate:m&&new Date(m),filterTime:g,filterDate:!v&&x,name:"siteVisitAt",showTimeSelect:!0,todayButton:!1})),(0,r.jsx)(es.H,{content:"Submit",type:"submit"})]})};ti.propTypes={job:A.object.isRequired,refetch:A.func.isRequired,status:A.string.isRequired,toggleShow:A.func.isRequired};var tr=function(e,n,t,i){t.show({content:(0,r.jsx)(ti,{job:e,quotation:n,refetch:i,toggleShow:t.close}),submit:!1,title:"Site visit time",width:"40%"})};function to(){var e=(0,m.Z)(["\n  mutation CreateRemedialQuote($jobId: Int!, $slaId: Int!, $description: String) {\n    createRemedialQuote(jobId: $jobId, slaId: $slaId, description: $description) {\n      data\n      success\n    }\n  }\n"]);return to=function(){return e},e}var ta,ts=(0,f.Ps)(to()),tu=el.Ry({slaId:el.Rx().integer().required()}),tl=function(e){var n,t,i=e.jobId,o=e.customerId,a=e.locationId,s=e.toggleShow,u=(0,er.cI)({defaultValues:{},resolver:(0,eo.S)(tu)}),l=u.watch,d=u.handleSubmit,m=u.errors,f=u.register,v=l("slaId"),h=(0,c.a)(p.Ab,{skip:!o||!a,variables:{customerId:o,locationId:a}}).data,b=(0,ny.GU)("quote",h),g=null===(n=null==b?void 0:b.find(function(e){return e.id===Number(v)}))||void 0===n?void 0:n.notes,x=(0,_.Z)((0,P.D)(ts,{onCompleted:function(){return s()},refetchQueries:["GetJob"]}),2),j=x[0],y=x[1].loading,Z=(t=(0,q.Z)(function(e){var n,t;return(0,T.__generator)(this,function(t){switch(t.label){case 0:return n=e.description,[4,j({variables:{jobId:i,slaId:e.slaId,description:n}})];case 1:return t.sent(),[2]}})}),function(e){return t.apply(this,arguments)});return y?(0,r.jsx)(F.Z,{width:"100%",alignItems:"center",children:(0,r.jsx)(L.Z,{color:"secondary"})}):(0,r.jsxs)(ea.Z,{id:"offCanvasForm",handleSubmit:d(Z),children:[(0,r.jsx)(eb.Z,{register:f,errors:m,data:b,legend:"Priority",name:"slaId"}),v&&(0,r.jsx)(ev.Z,{content:g||"-",context:"light"}),(0,r.jsx)(eg.Z,{label:"Description",children:(0,r.jsx)(e_.Z,{errors:m,name:"description",register:f,rows:3})}),(0,r.jsx)(es.H,{content:"Create remedial quote",type:"submit"})]})};tl.defaultProps={toggleShow:function(){}},tl.propTypes={jobId:A.object.isRequired,toggleShow:A.func};var tc,td=(ta=(0,q.Z)(function(e){var n,t,i,o;return(0,T.__generator)(this,function(a){return n=e.jobId,t=e.customerId,i=e.locationId,(o=e.offCanvas).show({content:(0,r.jsx)(tl,{jobId:n,customerId:t,locationId:i,toggleShow:o.close}),title:"Remedial quote",submit:!1}),[2]})}),function(e){return ta.apply(this,arguments)}),tp=(tc=(0,q.Z)(function(e){return(0,T.__generator)(this,function(n){return s().push("/dashboard/issues/view?id=".concat(e)),[2]})}),function(e){return tc.apply(this,arguments)}),tm=function(e){var n,t,i,o=e.user,a=(e.deleteJobTiming,e.job),s=e.offCanvas,u=e.offCanvasNew,l=e.refetch,c=e.updateJob,d=e.client,p=a.siteVisitStart,m=(null===(n=a.parentJob)||void 0===n?void 0:n.type)==="reactive";return"closed"===a.status?[{id:1,label:"New Quote",date:(0,W.E)(a,"quoteOffered")||(0,W.E)(a,"closed")},{id:2,label:"Quote Closed",date:(0,W.E)(a,"closed"),actions:[{id:1,active:(0,W.E)(a,"closed"),content:"Repost job",context:"danger",handleClick:function(){return eE(a,c,"quoteNew")},type:"button"}]}]:[{id:1,label:"New Quote",date:(0,W.E)(a,"quoteNew"),content:[{id:1,active:!0,data:"Created By ".concat((null===(t=null==a?void 0:a.timings[0])||void 0===t?void 0:null===(i=t.user)||void 0===i?void 0:i.fullName)||"")}],actions:[{id:1,active:(0,W.E)(a,"quoteNew")&&!(0,W.E)(a,"inProgress")&&!(0,W.E)(a,"quoteOffered"),content:"Make reactive",context:"secondary",handleClick:function(){return ep(a,s,l)},type:"button"},{id:2,active:m,content:"Related works",context:"info",handleClick:function(){var e;return tp(null===(e=a.parentJob)||void 0===e?void 0:e.number)},type:"button"}]},{id:2,label:"Sent to Supplier(s)",info:a.quotations.length<a.quoteNumber?"".concat(a.quoteNumber," supplier(s) needed for this quote\n            (").concat(a.quotations.length,"/").concat(a.quoteNumber," selected)"):"no assigned suppliers",date:a.quotations.length>0&&(0,W.E)(a,"quoteOffered"),actions:[{id:1,active:a.quotations.length<a.quoteNumber&&("quoteNew"===a.status||(0,W.E)(a,"quoteNew"))&&!(0,W.E)(a,"inProgress"),content:"Assign suppliers",context:"info",data:{"data-cy":"supplierAssign"},handleClick:function(){return n5({jobId:a.id,offCanvas:u,refetch:l})},type:"button"},{id:2,active:a.quotations.length>=a.quoteNumber&&(0,W.E)(a,"quoteOffered")&&!(0,W.E)(a,"quoteAccepted"),content:"Repost job",context:"danger",handleClick:function(){return tn({jobId:a.id,offCanvas:u,refetch:l})},type:"button"}]},{id:3,label:"Received from Supplier(s)",info:"waiting for supplier to submit",date:(0,W.E)(a,"quoteReceived"),content:a.quotations.map(function(e,n){return{id:n,active:!(0,W.E)(a,"supplierQuoteComplete")&&e.siteVisitAt&&"supplierQuoteComplete"!==e.status&&"supplierQuoteRefused"!==e.status,data:function(){return(0,r.jsxs)(r.Fragment,{children:["Site visit at ".concat(e.quoteNumber),":",(0,r.jsxs)("b",{children:[" ",(0,en.Z)(e.siteVisitAt,!0)]})]})}}}),actions:a.quotations.map(function(e,n){return{id:n,active:!(0,W.E)(a,"supplierQuoteComplete")&&p&&"supplierQuoteComplete"!==e.status&&"supplierQuoteRefused"!==e.status,content:e.siteVisitAt?"Edit site visit time ".concat(e.quoteNumber):"Select site visit time ".concat(e.quoteNumber),context:"secondary",handleClick:function(){return tr(a,e,s,l)},type:"button"}})},{id:4,label:"Sent to Customer",info:"not sent",date:(0,W.E)(a,"quoteSent"),actions:[{id:1,active:!!a.quotations.find(function(e){return"supplierQuoteSent"===e.status})&&(0,W.E)(a,"quoteSent"),content:"Download quote",context:"secondary",handleClick:function(){return(0,et.g)(a,null,d)},type:"button"},{id:2,active:(0,W.E)(a,"quoteReceived")&&!(0,W.E)(a,"quoteSent"),content:"Send quote",context:"secondary",handleClick:function(){return eq(a,o,s,l)},type:"button"}]},{id:5,label:"Accepted / Rejected",info:"waiting for customer to accept",date:(0,W.E)(a,"quoteAccepted")||"quoteRejected"===a.status&&(0,W.E)(a,"quoteRejected")},{id:6,label:"Closed",date:(0,W.E)(a,"quoteClosed")}]},tf=function(e){var n=e.job;return e.offCanvas,e.refetch,[{id:1,label:"Quote raised",info:"quote is with contractor for pricing",date:(0,W.E)(n,"quoteNew")||(0,W.E)(n,"quoteOffered")},{id:2,label:"In review",info:"currently being reviewed",date:(0,W.E)(n,"quoteReceived")},{id:3,label:"Awaiting acceptance",info:"awaiting your acceptance",date:(0,W.E)(n,"quoteSent")},{id:4,label:"Accept / Reject",date:(0,W.E)(n,"quoteAccepted")||"quoteRejected"===n.status&&(0,W.E)(n,"quoteRejected")},{id:5,label:"Closed",date:(0,W.E)(n,"quoteClosed")}]},tv=function(e){var n,t=e.job,i=e.offCanvas,o=e.refetch,a=e.user,s=(null===(n=t.parentJob)||void 0===n?void 0:n.type)==="reactive",u=t.quotations.length>0?t.quotations.find(function(e){return e.accountId===a.accountId}):{},l=u&&("supplierQuoteDraft"===u.status||"supplierQuoteComplete"===u.status)?u.updatedAt:null,c=u&&"supplierQuoteComplete"===u.status?u.updatedAt:null,d=t.siteVisitStart;return[{id:1,label:"Quotation offered",date:(0,W.E)(t,"quoteOffered"),actions:[{id:2,active:s,content:"Related works",context:"info",handleClick:function(){var e;return tp(null===(e=t.parentJob)||void 0===e?void 0:e.number)},type:"button"}]},{id:2,label:"Quotation",info:"need to complete the quotation",date:l,content:t.quotations.map(function(e,n){return{id:n,active:!(0,W.E)(t,"supplierQuoteComplete")&&e.siteVisitAt&&"supplierQuoteComplete"!==e.status&&"supplierQuoteRefused"!==e.status,data:function(){return(0,r.jsxs)(r.Fragment,{children:["Site visit at ".concat(e.quoteNumber),":",(0,r.jsxs)("b",{children:[" ",(0,en.Z)(e.siteVisitAt,!0)]})]})}}}),actions:t.quotations.map(function(e,n){return{id:n,active:!(0,W.E)(t,"supplierQuoteComplete")&&d&&"supplierQuoteComplete"!==e.status&&"supplierQuoteRefused"!==e.status,content:e.siteVisitAt?"Edit site visit time ".concat(e.quoteNumber):"Select site visit time ".concat(e.quoteNumber),context:"secondary",handleClick:function(){return tr(t,e,i,o)},type:"button"}})},{id:3,label:"Completed",date:c}]},th=function(e){var n=e.status,t=e.timings;return[{id:1,label:"Quote raised",info:"quote is with contractor for pricing",date:(0,W.E)({timings:t},"quoteNew")||(0,W.E)({timings:t},"quoteOffered")},{id:2,label:"In review",info:"currently being reviewed",date:(0,W.E)({timings:t},"quoteReceived")},{id:3,label:"Awaiting acceptance",info:"awaiting your acceptance",date:(0,W.E)({timings:t},"quoteSent")},{id:4,label:"Accept / Reject",date:(0,W.E)({timings:t},"quoteAccepted")||"quoteRejected"===n&&(0,W.E)({timings:t},"quoteRejected")},{id:5,label:"Closed",date:(0,W.E)({timings:t},"quoteClosed")}]},tb=function(e,n,t,i,r,o,a,s,u,l){var c;return t("admin")?c=tm({user:u,deleteJobTiming:n,job:i,offCanvas:r,offCanvasNew:o,refetch:a,updateJob:s,client:l}):t("supplier")?c=tv({job:i,offCanvas:r,refetch:a,user:u}):t("customer")?c=tf({job:i,offCanvas:r,refetch:a}):t("tenant")&&(c=th({status:i.status,timings:i.timings})),c.forEach(function(e){e.date&&(e.date=X()(e.date).format("D MMM YYYY HH:mm"))}),c},tg=function(e){var n=[];return n.push({label:"Scheduled start:",value:e.timingStart?X()(e.timingStart).format("D MMM YYYY HH:mm"):""}),e.timingEnd&&n.push({label:"Scheduled end:",value:e.timingEnd?X()(e.timingEnd).format("D MMM YYYY HH:mm"):""}),"chargable"===e.quoteCharge&&n.push({label:"Quote charge:",value:(0,ee.Z)(e.quoteChargeAmount)}),n},tx=t(73303),tj=t.n(tx);function ty(e){var n,t=e.autoStart,i=e.startTime,r=e.endTime,a=e.interval,s=void 0===a?1e3:a,u=(0,o.useState)((n=(r?X()(r):X()()).diff()-X()(i).diff())>-1?n:0),l=u[0],c=u[1],d=(0,o.useState)(t),p=d[0],m=d[1];(0,o.useEffect)(function(){var e=null;return p?e=setInterval(function(){c(X()().diff()-X()(i).diff())},s):clearInterval(e),function(){clearInterval(e)}},[p]);var f,v=function(){m(!0)},h=function(){m(!1)};return{time:{seconds:(f=X().duration(l)).seconds().toString().padStart(2,"0"),minutes:f.minutes().toString().padStart(2,"0"),hours:parseInt(f.asHours(),10),exactHours:f.asHours().toFixed(2)},start:v,stop:h}}ty.propTypes={autoStart:A.bool,startTime:A.string.isRequired,endTime:A.string,interval:A.number};var tZ=function(e){for(var n=null,t=(0,l.Z)(null==e?void 0:e.timings).sort(function(e,n){return e.id-n.id}),i=t.length-1;i>=0;i--){var r,o=t[i].status;if("inProgress"===o||"resumed"===o||"continued"===o){n=(null===(r=t[i])||void 0===r?void 0:r.createdAt)||n;break}}return n},tI=function(e){for(var n=null,t=(0,l.Z)(null==e?void 0:e.timings).sort(function(e,n){return e.id-n.id}),i=t.length-1;i>=0;i--){var r,o=t[i].status;if("paused"===o||"onHold"===o||"completed"===o){n=(null===(r=t[i])||void 0===r?void 0:r.createdAt)||n;break}}return n},tS=t(11699),tw=function(e){var n=e.slice().sort(function(e,n){return Number(e.id)-Number(n.id)}).filter(function(e){return"inProgress"===e.status||"paused"===e.status||"resumed"===e.status||"continued"===e.status||"completed"===e.status||"onHold"===e.status}),t=[],i=n.findIndex(function(e){return"inProgress"===e.status}),r=n.findIndex(function(e){return"completed"===e.status});if(-1===i&&-1===r)return t;-1===r&&(r=n.length-1);for(var o=i;o<=r;o+=2)if(("inProgress"===n[o].status||"resumed"===n[o].status||"continued"===n[o].status)&&o+1<n.length){var a=(0,tS.Z)(new Date(n[o+1].createdAt),new Date(n[o].createdAt));t.push({startDate:n[o].createdAt,endDate:n[o+1].createdAt,duration:Math.round(a)})}return t},tC=t(38944),tR=t(66292),tq=t(21023),t_=function(e){var n=e.job,t=(0,D.x)(),i=(0,o.useContext)(u.Z).user,a="fixed"===n.pricing,s="incorrect"===n.timingStatus,l=n.supplier,c=(0,tC.L)(n.timings),d=(0,W.E)(n,"accepted"),p=(0,W.E)(n,"inProgress")&&!(0,W.E)(n,"completed"),m="onHold"===c,f="paused"===c,v=!(n.media.filter(function(e){var n;return!(null===(n=e.item.meta)||void 0===n?void 0:n.adminOnly)}).length>0),h=(0,W.E)(n,"closed"),b=tw(n.timings),g=tj()(b,"duration"),x=ty({autoStart:!1,startTime:tZ(n),endTime:tI(n)}),j=x.time,y=j.seconds,Z=j.minutes,I=j.hours,S=x.start,w=x.stop,C=(0,_.Z)((0,P.D)(tR.xY,{refetchQueries:["GetJob"],onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!n)return[3,2];return[4,(0,eT.F)(t,n.id)];case 1:e.sent(),e.label=2;case 2:return[2]}})})}),2),R=C[0],A=C[1].loading,E=(0,_.Z)((0,P.D)(tR.Jw,{refetchQueries:["GetJob"],onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!n)return[3,2];return[4,(0,eT.F)(t,n.id)];case 1:e.sent(),e.label=2;case 2:return[2]}})})}),2),U=E[0],V=E[1].loading;(0,o.useEffect)(function(){!p||f||m?w():S()},[p,n,m,f,S,w]);var Q=function(e){return function(t){t.stopPropagation(),R({variables:{id:n.id,changes:{status:e},timing:{status:e,jobId:n.id,userId:i.id}}})}},z=function(e){e.stopPropagation(),R({variables:{id:n.id,changes:{status:"inProgress"},timing:{status:"inProgress",jobId:n.id,userId:i.id},_append:{statusData:{inProgress:X()().toISOString()}}}})},Y=function(e){e.stopPropagation(),U({variables:{jobId:n.id}})},B=b.map(function(e,n){return{id:n,startDate:e.startDate,endDate:e.endDate,duration:e.duration}});return(0,r.jsxs)(k.Z,{disableGutters:!0,children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),"aria-controls":"timer-content",id:"timer-header",children:(0,r.jsxs)(N.ZP,{container:!0,children:[(0,r.jsx)(N.ZP,{item:!0,xs:12,children:(0,r.jsx)(J.Z,{variant:"h6",children:"Timer"})}),(0,r.jsx)(N.ZP,{item:!0,xs:12,display:"flex",justifyContent:"center",sx:{marginTop:"-18px"},children:(0,r.jsxs)(J.Z,{sx:{fontSize:"24px",fontWeight:600},children:[I,":",Z,":",y]})}),(0,r.jsxs)(N.ZP,{item:!0,xs:12,display:"flex",justifyContent:"center",children:[p&&v&&(0,r.jsx)(nx.Z,{variant:"filled",severity:"info",sx:{mb:1},children:"You must add at least one photo in order to end the timer."}),s&&(0,r.jsx)(nx.Z,{variant:"filled",severity:"error",sx:{mb:1},children:"Timer has been marked as incorrect by supplier"})]}),(0,r.jsx)(N.ZP,{item:!0,xs:12,children:!h&&l&&(0,r.jsxs)(F.Z,{direction:"row",display:"flex",justifyContent:"center",spacing:2,children:[!m&&!!d&&!(0,W.E)(n,"inProgress")&&(0,r.jsx)(O.Z,{disabled:A||V,mt:2,color:"success",variant:"contained",onClick:z,children:A||V?(0,r.jsx)(L.Z,{size:24,color:"secondary"}):"Start"}),!!(0,W.E)(n,"inProgress")&&!(0,W.E)(n,"completed")&&!f&&!m&&(0,r.jsx)(O.Z,{disabled:A||V,mt:2,color:"danger",variant:"contained",onClick:Q("paused"),children:A||V?(0,r.jsx)(L.Z,{size:24,color:"secondary"}):"Pause"}),!(0,W.E)(n,"completed")&&f&&!m&&(0,r.jsx)(O.Z,{disabled:A,mt:2,variant:"contained",onClick:Q("continued"),children:A?(0,r.jsx)(L.Z,{size:24,color:"secondary"}):"Continue"}),!!(0,W.E)(n,"inProgress")&&!(0,W.E)(n,"completed")&&!m&&!f&&!v&&(0,r.jsx)(O.Z,{disabled:A||V,mt:2,variant:"contained",color:"danger",onClick:Y,children:A||V?(0,r.jsx)(L.Z,{size:24,color:"secondary"}):"End"})]})})]})}),(0,r.jsx)($.Z,{children:!a&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(nm.i,{rows:B,columns:[{field:"startDate",headerName:"Date",flex:1,sortable:!1,valueGetter:function(e){var n=e.row;return X()(n.startDate).format("YYYY-MM-DD")}},{field:"duration",headerName:"Minutes",flex:1,sortable:!1,renderCell:function(e){var n=e.row;return e.value,(0,r.jsx)(tq.Z,{title:(0,r.jsxs)(r.Fragment,{children:["From: ".concat(X()(n.startDate).format("YYYY-MM-DD HH:mm")),(0,r.jsx)("br",{}),"To: ".concat(X()(n.endDate).format("YYYY-MM-DD HH:mm")," ")]}),children:(0,r.jsx)("span",{children:Math.round(n.duration/60)})})}}]}),(0,r.jsxs)(F.Z,{direction:"row",pl:"10px",children:[(0,r.jsx)(J.Z,{children:"Total:"}),(0,r.jsx)(J.Z,{ml:.5,color:"secondary",children:Math.round(g/60)})]})]})})]})};t_.propTypes={job:E().object.isRequired};var tT,tA,tE=t(76140),tD=(tT=(0,q.Z)(function(e,n){return(0,T.__generator)(this,function(t){return n.show({content:(0,r.jsx)(e2.G,{entity:"JobTiming",entityId:e}),title:"Dispute media"}),[2]})}),function(e,n){return tT.apply(this,arguments)}),tP=t(452),tk=function(e){var n,t=e.job,i=e.refetch,a=e.status,s=e.toggleShow,l=(0,o.useContext)(U.Z),c=(0,o.useContext)(u.Z).user,d=(0,er.cI)({defaultValues:{comments:""}}),m=d.errors,f=d.handleSubmit,v=d.register,h=(0,_.Z)((0,P.D)(p.r2,{onCompleted:function(e){var n=e.insert_JobTiming.returning[0].id;n&&"inDispute"===a?b(n):(i&&i(),s())}}),1)[0],b=function(e){l.show({content:(0,r.jsx)(tP.z,{accept:"image/*",category:null,entity:"JobTiming",entityId:e,expiryShow:!1,onSuccess:function(){return g(e)},showSubmitButton:!0}),title:"Upload Photo",submit:!1})},g=function(e){i&&i(),s(),l.close()},x=(n=(0,q.Z)(function(e){var n;return(0,T.__generator)(this,function(i){return n={notes:e.comments,status:a,jobId:t.id,userId:c.id},h({variables:{objects:[n]}}),[2]})}),function(e){return n.apply(this,arguments)});return(0,r.jsx)(ea.Z,{id:"offCanvasForm",handleSubmit:f(x),children:(0,r.jsx)(eg.Z,{label:"Comments",children:(0,r.jsx)(e_.Z,{errors:m,name:"comments",register:v,rows:3})})})};tk.propTypes={job:A.object.isRequired,refetch:A.func.isRequired,status:A.string.isRequired,toggleShow:A.func.isRequired};var t$,tH,tM=(tA=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(tk,{job:e,status:"inDispute",toggleShow:n.show,refetch:t}),title:"Dispute"}),[2]})}),function(e,n,t){return tA.apply(this,arguments)}),tO=(t$=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(tk,{job:e,status:"disputeResolved",toggleShow:n.show,refetch:t}),title:"Resolve Dispute"}),[2]})}),function(e,n,t){return t$.apply(this,arguments)}),tN=t(97229),tF=function(e){var n,t=e.job,o=e.toggleShow,a=(0,er.cI)({defaultValues:{isRecall:!1}}),u=a.errors,l=a.handleSubmit,c=a.register,d=(n=(0,q.Z)(function(e){var n;return(0,T.__generator)(this,function(n){return"true"===e.isRecall?(0,tN.e)({adminId:t.adminId,job:t,openReport:!1}).then(function(e){s().push("/dashboard/issues/manage?recall=true&parentId=".concat(t.id,"&report=").concat(encodeURIComponent(e.blob.key)))}):s().push("/dashboard/issues/manage?recall=false&parentId=".concat(t.id)),o(),[2]})}),function(e){return n.apply(this,arguments)});return(0,r.jsx)(ea.Z,{id:"offCanvasForm",handleSubmit:l(d),children:(0,r.jsx)(eg.Z,{label:"",children:(0,r.jsx)(eh.Z,(0,ei.Z)((0,i.Z)({},{errors:u,register:c}),{name:"isRecall",data:[{label:"Is this a recall?",key:"recall",value:!0}]}))})})};tF.propTypes={job:A.object.isRequired,toggleShow:A.func.isRequired};var tJ=(tH=(0,q.Z)(function(e,n){return(0,T.__generator)(this,function(t){return n.show({content:(0,r.jsx)(tF,{job:e,toggleShow:n.close}),title:"Follow On"}),[2]})}),function(e,n){return tH.apply(this,arguments)}),tL=t(59505),tU=t(58632),tV=t(48795),tQ=t(53767),tz=t(84570),tY=function(e){var n,t=e.job,a=e.toggleShow,s=(0,o.useContext)(u.Z).user,l=(0,er.cI)({defaultValues:{comments:"",jobHoldReason:null}}),c=l.control,d=l.errors,p=l.handleSubmit,m=l.register,f=(0,_.Z)((0,P.D)(v.xY,{refetchQueries:["GetJob"],onCompleted:function(){a()}}),2),h=f[0],b=f[1].loading,g=(n=(0,q.Z)(function(e){var n,i,r;return(0,T.__generator)(this,function(o){return i="onHold",r={},(null===(n=e.jobHoldReason)||void 0===n?void 0:n.value)&&(r.jobHoldReason={},r.jobHoldReason.value=e.jobHoldReason.value,r.jobHoldReason.label=e.jobHoldReason.label),h({variables:{id:t.id,changes:{status:i},timing:{jobId:t.id,meta:r,notes:e.comments,status:i,userId:s.id}}}),[2]})}),function(e){return n.apply(this,arguments)}),x={errors:d,register:m,control:c};return(0,r.jsxs)(ea.Z,{handleSubmit:p(g),children:[(0,r.jsx)(nK.Z,{sx:{zIndex:1e5},open:b,children:(0,r.jsx)(L.Z,{color:"secondary"})}),(0,r.jsx)(nq.l,(0,ei.Z)((0,i.Z)({},x),{label:"Reason",name:"jobHoldReason",type:"jobHoldReason"})),(0,r.jsx)(eg.Z,{label:"Comments",children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},x),{name:"comments",rows:3}))}),(0,r.jsx)(es.H,{content:"Submit",type:"submit"})]})};function tB(){var e=(0,m.Z)(['\n  mutation UpdateSupplierOffer(\n    $jobId: Int!\n    $jobChanges: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n  ) {\n    delete_JobTiming(where: { jobId: { _eq: $jobId }, status: { _in: ["accepted", "offered"] } }) {\n      returning {\n        jobId\n      }\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n\n    update_SupplierOffer(where: { jobId: { _eq: $jobId } }, _set: { status: "cancelled" }) {\n      returning {\n        id\n      }\n    }\n\n    update_Job_by_pk(pk_columns: { id: $jobId }, _set: $jobChanges) {\n      id\n    }\n  }\n']);return tB=function(){return e},e}tY.propTypes={job:A.object.isRequired,toggleShow:A.func.isRequired};var tG=(0,f.Ps)(tB());function tW(){var e=(0,m.Z)(["\n  mutation AcceptJob($object: AcceptJobOfferInput!) {\n    acceptJobOffer(acceptOfferInput: $object) {\n      data\n      success\n    }\n  }\n"]);return tW=function(){return e},e}function tK(){var e=(0,m.Z)(['\n  mutation UpdateSupplierOffer(\n    $noAnotherOffers: Boolean!\n    $assignedReject: Boolean!\n    $changes: SupplierOffer_set_input\n    $id: Int!\n    $jobId: Int!\n    $jobChanges: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n  ) {\n    insert_JobTiming(objects: $timing) @include(if: $assignedReject) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n    delete_JobTiming(where: { jobId: { _eq: $jobId }, status: { _in: "offered" } })\n      @include(if: $noAnotherOffers) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n    update_Job_by_pk(pk_columns: { id: $jobId }, _set: $jobChanges) @include(if: $assignedReject) {\n      id\n    }\n    update_SupplierOffer_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n']);return tK=function(){return e},e}var tX=(0,f.Ps)(tW()),t0=(0,f.Ps)(tK()),t1=t(55377),t2=t(55843),t4=(0,el.Ry)().shape({arrivalTime:(0,el.hT)().required(),acceptedContractor:(0,el.Ry)().required(),time:(0,el.Xg)()}),t3=(0,el.Ry)().shape({rejectedNotes:(0,el.Z_)().required()}),t6=t(93282),t5=function(e){var n,t,a,s=e.accountId,u=e.job,l=e.offCanvas,c=e.refetch,d=e.edit,p=(0,o.useState)(),m=p[0],f=p[1],v=(0,nv.x)(),h=v.hasRole,b=v.user,g=(0,D.x)(),x=h("admin"),j=h("supplier"),y=s||"supplier"===b.accountType&&b.accountId,Z=(null===(n=null==u?void 0:u.quotations.find(function(e){return"quotationAccepted"===e.status}))||void 0===n?void 0:n.startDate)||new Date,I=u.quoted?Z:u.timingStart,S=(0,o.useState)(null),w=S[0],C=S[1],R=(0,o.useState)(null),A=R[0],E=R[1],k=(0,o.useState)(null),$=k[0],H=k[1],M=(0,o.useState)(null),O=M[0],N=M[1],F=(0,o.useState)(!1),J=F[0],L=F[1],U=(0,o.useState)(!1),V=U[0],Q=U[1],z=(0,o.useState)(!1),Y=z[0],B=z[1];(0,o.useEffect)(function(){var e=function(e,i,r,o){var a=n(e,r),s=n(i,o);t(e,i,a,s)},n=function(e,n){return e.set({hour:n.hour()||0,minute:n.minute()||0,second:n.second()||0,millisecond:n.millisecond()||0}).toISOString()},t=function(e,n,t,i){C(e?new Date(e):null),E(n?new Date(n):null),H(t?new Date(t):null),N(i?new Date(i):null)};if("ppm"===u.type&&u.timingStart&&u.timingEnd&&j){if(X()().isAfter(X()(u.timingStart))){var i=X()(u.timingStart),r=X()(u.timingEnd),o=X()(u.hourStart||X()().startOf("day"),"HH:mm:ssZ"),a=X()(u.hourEnd||X()().endOf("day"),"HH:mm:ssZ");e(i,r,o,a)}else if(X()().isAfter(X()(u.timingStart).subtract(7,"day"))){var s=X()().diff(X()(u.timingStart).subtract(7,"day"),"ms"),l=X()(u.timingStart),c=X()(u.timingStart).set({millisecond:s||0}),d=X()(u.hourStart||X()().startOf("day"),"HH:mm:ssZ"),p=X()(u.hourEnd||X()().endOf("day"),"HH:mm:ssZ");e(l,c,d,p)}else X()().isBefore(X()(u.timingStart).subtract(7,"day"))&&(t(),L(!0));Q(!0)}else if("ppm"===u.type&&u.timingStart&&u.timingEnd&&!j){var m=X()(u.timingStart),f=X()(u.timingEnd),v=X()(u.hourStart||X()().startOf("day"),"HH:mm:ssZ"),h=X()(u.hourEnd||X()().endOf("day"),"HH:mm:ssZ");e(m,f,v,h),Q(!1)}else"reactive"===u.type&&u.quoted?t(u.timingStart,X()(u.timingStart).add(60,"day")):"reactive"===u.type&&(x||j)&&t(u.timingStart,null)},[u.timingStart,u.timingEnd,u.type,u.quoted,u.hourStart,u.hourEnd,j,x]);var G,W=u.supplierOffers.filter(function(e){return"cancelled"!==e.status}),K=null;W.forEach(function(e){e.account.id===y&&(K=e)});var ee,en=(0,_.Z)((0,P.D)(tX,{onCompleted:(G=(0,q.Z)(function(e){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!u)return[3,2];return[4,(0,eT.F)(g,u.id)];case 1:e.sent(),e.label=2;case 2:return c&&c(),l.close(),[2]}})}),function(e){return G.apply(this,arguments)}),onError:function(e){f(e.message)}}),1)[0],et=(ee=(0,q.Z)(function(e){var n;return(0,T.__generator)(this,function(t){return en({variables:{object:{arrivalAnytime:!1,jobId:u.id,scheduledAt:e.arrivalTime?(0,t6.v)(e.arrivalTime):null,supplierId:y,supplierUserId:null===(n=e.acceptedContractor)||void 0===n?void 0:n.value,supplierOfferId:K.id,offerStatusLog:JSON.stringify(K.statusLog),userId:b.id,edit:d}}}),[2]})}),function(e){return ee.apply(this,arguments)}),el=(0,er.cI)({defaultValues:{arrivalTime:w,acceptedContractor:(null==u?void 0:null===(t=u.supplier)||void 0===t?void 0:null===(a=t.contactUsers)||void 0===a?void 0:a.length)?{value:u.supplier.contactUsers[0].user.id,label:u.supplier.contactUsers[0].user.fullName}:null},resolver:(0,eo.S)(t4)}),ec=el.control,ed=el.errors,ep=el.handleSubmit,em=el.register,ef=el.setValue,eh=(0,el.watch)("arrivalTime");(0,o.useEffect)(function(){ef("arrivalTime",w)},[w,ef]),(0,o.useEffect)(function(){eh&&u.onSiteTimingEnd&&X()(eh).isAfter(X()(u.onSiteTimingEnd))?B(!0):B(!1)},[eh,u.onSiteTimingEnd]);var eb={control:ec,errors:ed,register:em};return(0,r.jsxs)(ea.Z,{handleSubmit:ep(et),children:[V&&(0,r.jsx)(nx.Z,{variant:"filled",severity:"warning",color:"info",sx:{"& .MuiAlert-icon":{alignItems:"center"},mb:2},children:"Please be aware that you can only choose a date and time for attendance no more than 7 days prior, or any time within the calendar month of the job."}),Y&&(0,r.jsx)(nx.Z,{variant:"filled",severity:"warning",color:"info",sx:{"& .MuiAlert-icon":{alignItems:"center"},mb:2},children:"Warning: The selected time is beyond the relevant SLA."}),(0,r.jsxs)("div",{children:[(0,r.jsx)("strong",{children:"Scheduled:"})," ",(0,r.jsx)("span",{children:(0,tt.Z)(new Date(I),"d MMM yyyy HH:mm")}),u.timingEnd&&(0,r.jsxs)("span",{children:[" - ",(0,tt.Z)(new Date(u.timingEnd),"d MMM yyyy HH:mm")]})]}),(0,r.jsx)(t1.Z,{}),(0,r.jsx)(eg.Z,{label:"Arrival time"}),(0,r.jsx)(eP.M,(0,ei.Z)((0,i.Z)({},eb),{dateFormat:"d MMM yyyy HH:mm",readOnly:J,disabled:J,maxDate:A,minDate:w,maxTime:O,minTime:$,name:"arrivalTime",showTimeSelect:!0,timeIntervals:15,todayButton:!1})),(0,r.jsx)(t2.Z,{}),(0,r.jsx)(eu.P,(0,ei.Z)((0,i.Z)({},eb),{accountId:y,errors:(0,i.Z)({},ed),label:"Operative",name:"acceptedContractor",type:"user"})),(0,r.jsx)(es.H,{content:"Confirm",type:"submit"}),m&&(0,r.jsx)(ev.Z,{content:m,context:"danger"})]})};t5.propTypes={accountId:A.number,edit:A.bool,job:A.object.isRequired,offCanvas:A.object.isRequired,refetch:A.func},t5.defaultProps={edit:!1};var t7=(0,el.Ry)().shape({cancellingReason:(0,el.Z_)().required()}),t9=function(e){var n,t,a=e.job,l=e.refetch,c=e.offCanvas,d=(0,o.useContext)(u.Z).user,p=(0,er.cI)({defaultValues:{notes:""},resolver:(0,eo.S)(t7)}),m=p.errors,f=p.handleSubmit,v=p.register,h=(0,p.watch)("canNotMakeDate"),b={errors:m,register:v},g=(0,_.Z)((0,P.D)(tG,{onCompleted:function(e){c.close(),"supplier"===d.accountType?s().push("/dashboard"):l&&l()}}),1)[0],x=(t=(0,q.Z)(function(e){var n,t,i;return(0,T.__generator)(this,function(r){return i=null,i={scheduledAt:null,status:"raised",supplierId:null,supplierUserId:null},(t=[]).push({status:"supplierCancel",jobId:a.id,userId:d.id,notes:e.cancellingReason,meta:{supplierId:null===(n=a.supplier)||void 0===n?void 0:n.id}}),g({variables:{jobChanges:i,jobId:a.id,timing:t}}),[2]})}),function(e){return t.apply(this,arguments)});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},b),{data:[{id:"yes",label:"Yes",value:!0},{id:"no",label:"No",value:!1}],legend:"Are you cancelling because you cannot make the scheduled date and time?",name:"canNotMakeDate",stacked:!0})),"true"===h&&(0,r.jsx)(t5,{accountId:null===(n=a.supplier)||void 0===n?void 0:n.id,edit:!0,job:a,offCanvas:c,refetch:l}),"false"===h&&(0,r.jsxs)(ea.Z,{handleSubmit:f(x),children:[(0,r.jsx)(eg.Z,{label:"Please provide a reason for cancelling this job",children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},b),{name:"cancellingReason",rows:3}))}),(0,r.jsx)(es.H,{content:"Confirm",type:"submit"})]})]})};t9.propTypes={job:A.object.isRequired,refetch:A.func.isRequired,status:A.string.isRequired,offCanvas:A.func.isRequired};var t8,ie=t(39474),it=t(31249),ii=(t8=(0,q.Z)(function(e){var n,t,i,o,a;return(0,T.__generator)(this,function(s){switch(n=e.type,t=e.job,i=e.offCanvas,o=e.refetch,n){case"customer":a=t.customerId;break;case"supplier":a=t.supplierId;break;default:return[2]}return i.show({content:(0,r.jsx)(it.q,{type:n,accountId:a,jobId:t.id,refetch:o,close:i.show}),title:"Payment",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"80vw",md2:"80vw",lg:"80vw",lg2:"80vw"}),[2]})}),function(e){return t8.apply(this,arguments)}),ir=function(e){var n,t=e.job,i=e.refetch,a=e.status,s=e.toggleShow,l=(0,o.useContext)(u.Z).user,c=(0,er.cI)({defaultValues:{comments:""}}),d=c.errors,m=c.handleSubmit,f=c.register,v=(0,_.Z)((0,P.D)(p.r2,{onCompleted:function(){i&&i(),s()}}),1)[0],h=(n=(0,q.Z)(function(e){var n;return(0,T.__generator)(this,function(i){return n={notes:e.comments,status:a,jobId:t.id,userId:l.id},v({variables:{objects:[n]}}),[2]})}),function(e){return n.apply(this,arguments)});return(0,r.jsx)(ea.Z,{id:"offCanvasForm",handleSubmit:m(h),children:(0,r.jsx)(eg.Z,{label:"Comments",children:(0,r.jsx)(e_.Z,{errors:d,name:"comments",register:f,rows:3})})})};ir.propTypes={job:A.object.isRequired,refetch:A.func.isRequired,status:A.string.isRequired,toggleShow:A.func.isRequired};var io,ia,is,iu=function(e,n){var t=e.addJobTiming,i=e.entityId,o=e.job,a=e.onlyShow,s=void 0!==a&&a,u=e.userId,l={status:"complianceReportSent",jobId:o.id,userId:u};n.show({content:(0,r.jsx)(e2.G,{entity:"Compliance_Entity",entityId:i,showActionButtons:!s,showItemActions:!s,onMediaAdd:function(){t({variables:{objects:[l]}}),n.close()}}),submit:!1,title:s?"Compliance report":"Upload report"})},il=(io=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(ir,{job:e,refetch:t,status:"complianceApproved",toggleShow:n.show}),title:"Approve report"}),[2]})}),function(e,n,t){return io.apply(this,arguments)}),ic=(ia=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(ir,{job:e,refetch:t,status:"complianceRejected",toggleShow:n.show}),title:"Reject report"}),[2]})}),function(e,n,t){return ia.apply(this,arguments)}),id=function(e){var n=e.deleteJobTiming,t=e.job,i=e.userId;n({variables:{id:t.id,status:"complianceRequestedDocumentation",userId:i}})},ip=(is=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(ir,{job:e,refetch:t,status:"complianceRequestedDocumentation",toggleShow:n.show}),title:"Request Documentation"}),[2]})}),function(e,n,t){return is.apply(this,arguments)}),im=t(32791),iv=t(26535);function ih(){var e=(0,m.Z)(["\n  mutation ValidateJob($jobId: Int!, $invoiceIds: [Int], $notes: String) {\n    validateJob(jobId: $jobId, invoiceIds: $invoiceIds, notes: $notes) {\n      success\n      data\n    }\n  }\n"]);return ih=function(){return e},e}function ib(){var e=(0,m.Z)(['\n  query GetInvoicesByJobId($jobId: Int!, $invoiceTypes: [String!]!) {\n    invoices: Invoice(\n      where: {\n        invoiceType: { _in: $invoiceTypes }\n        entityId: { _eq: $jobId }\n        entity: { _eq: "Job" }\n      }\n    ) {\n      id\n      invoiceNumber\n      invoiceType\n    }\n  }\n']);return ib=function(){return e},e}function ig(){var e=(0,m.Z)(['\n  mutation UpdateJob($id: Int!, $timing: [JobTiming_insert_input!]!) {\n    delete_JobTiming(where: { jobId: { _eq: $id }, status: { _eq: "validated" } }) {\n      returning {\n        jobId\n      }\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n']);return ig=function(){return e},e}var ix=(0,f.Ps)(ih()),ij=(0,f.Ps)(ib()),iy=(0,f.Ps)(ig()),iZ=t(19192),iI=t(18531),iS=t(4438),iw=function(e){e.addJobTiming;var n=e.deleteJobTiming,t=e.job,i=e.refetch,s=e.status,u=e.toggleShow,l=(0,a.useRouter)().query,d=(0,nv.x)().user,p=(0,nX.D)(),m=(0,iZ.RM)(null==d?void 0:d.id),f=(0,W.E)(t,"unvalidated"),v=(0,iZ.BR)({adminId:d.id,xeroClientId:null==l?void 0:l.clientId,onSaveXeroTokenCallback:function(){return i&&i()}},[d]),h=v.tokenStatus,b=v.onCallAuthorize,g=v.onUpdateInvoiceInXero,x=(0,er.cI)({defaultValues:{notes:"",invoice:[]}}),j=x.errors,y=x.control,Z=x.handleSubmit;(0,o.useEffect)(function(){t.invoices.some(function(e){var n;return null===(n=e.accountEntry.meta)||void 0===n?void 0:n.xeroInvoiceId})&&!l.clientId&&m&&"unauthenticated"===h&&b(window.location.href)},[m,h]);var I,S=(0,c.a)(ij,{variables:{jobId:t.id,invoiceTypes:["customerVat","ProformaInvoiceCustomer"]}}).data,w=(void 0===S?{invoices:[]}:S).invoices,C=(0,_.Z)((0,P.D)(ix,{refetchQueries:function(){return["getInvoices"]},onError:function(e){p.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:(0,q.Z)(function(){var e,n,r,o,a,s,l,c;return(0,T.__generator)(this,function(d){switch(d.label){case 0:p.show({content:"Job was successfully validated.",severity:"success"}),e=!0,n=!1,r=void 0,d.label=1;case 1:d.trys.push([1,6,7,8]),o=t.invoices[Symbol.iterator](),d.label=2;case 2:if(e=(a=o.next()).done)return[3,5];if(s=a.value,!(m&&"authorized"===h&&(null===(l=s.accountEntry.meta)||void 0===l?void 0:l.xeroInvoiceId)))return[3,4];return[4,g({accountEntryId:s.accountEntry.id,invoiceType:s.invoiceType})];case 3:d.sent(),d.label=4;case 4:return e=!0,[3,2];case 5:return[3,8];case 6:return c=d.sent(),n=!0,r=c,[3,8];case 7:try{e||null==o.return||o.return()}finally{if(n)throw r}return[7];case 8:return i&&i(),u(),[2]}})})}),2),R=C[0],A=C[1].loading,E=(0,_.Z)((0,P.D)(iy,{refetchQueries:function(){return["getInvoices"]},onError:function(e){p.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){p.show({content:"Job was successfully un-validated.",severity:"success"}),i&&i(),u()}}),2),D=E[0],k=E[1].loading,$=(I=(0,q.Z)(function(e){var i,r,o,a;return(0,T.__generator)(this,function(r){return"validated"===s?R({variables:{jobId:t.id,invoiceIds:(null===(i=e.invoice)||void 0===i?void 0:i.map(function(e){return e.value}))||[],notes:e.notes}}):"unvalidated"===s&&(n({variables:{id:t.id,status:"waitingForThresholdApproval",userId:d.id}}),n({variables:{id:t.id,status:"thresholdRejected",userId:d.id}}),n({variables:{id:t.id,status:"thresholdApproved",userId:d.id}}),D({variables:{id:t.id,timing:{notes:e.notes,status:s,jobId:t.id,userId:d.id}}})),[2]})}),function(e){return I.apply(this,arguments)});if(A||k)return(0,r.jsx)(F.Z,{alignItems:"center",children:(0,r.jsx)(L.Z,{color:"secondary"})});var H=w.map(function(e){return{value:e.id,label:"".concat(e.invoiceNumber," ").concat(iS.Tq[e.invoiceType])}}),M="validated"===s?"Leave comments below, if appropriate, to provide context for other users.":"Please leave comments below to provide relevant context for other users.";return(0,r.jsx)("form",{id:"offCanvasForm",onSubmit:Z($),children:(0,r.jsxs)(F.Z,{spacing:2,children:["validated"===s&&(0,r.jsx)(nx.Z,{severity:"warning",color:"info",variant:"filled",children:f?"Please choose the invoices from the below\n    for which you would like to update the information.":"Once validated, you will not be able to amend financial information within the job.\n    Invoices already generated cannot be changed."}),"unvalidated"===s&&(0,r.jsx)(nx.Z,{children:"This enables you to update financial information within the job. However, please note that any previously generated invoices will remain unchanged."}),"validated"===s&&f&&(0,r.jsx)(er.Qr,{name:"invoice",control:y,render:function(e){var n=e.value,t=e.onChange;return(0,r.jsx)(iI.q,{multiple:!0,value:n,onChange:function(e,n){t(n)},options:H,textFieldProps:{fullWidth:!0,color:"secondary",variant:"filled",label:"Select invoices",error:j.invoice,helperText:j.invoice&&j.invoice.message}})}}),(0,r.jsx)(er.Qr,{name:"notes",control:y,render:function(e){var n=e.value,t=e.onChange;return(0,r.jsx)(nI.Z,{multiline:!0,fullWidth:!0,rows:4,color:"secondary",variant:"filled",label:"Notes",value:n,onChange:t,error:j.notes,helperText:M})}})]})})};function iC(){var e=(0,m.Z)(["\n  mutation InsertJobTiming($timing: [JobTiming_insert_input!]!) {\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return iC=function(){return e},e}function iR(){var e=(0,m.Z)(["\n  query GetInvoicePointer($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      id\n      name\n      type\n      meta\n    }\n  }\n"]);return iR=function(){return e},e}function iq(){var e=(0,m.Z)(["\n  mutation createCustomerInvoice(\n    $jobId: Int!\n    $customerEmail: String\n    $sendEmail: String\n    $dueDate: timestamptz!\n  ) {\n    createCustomerInvoice(\n      jobId: $jobId\n      customerEmail: $customerEmail\n      sendEmail: $sendEmail\n      dueDate: $dueDate\n    ) {\n      data\n    }\n  }\n"]);return iq=function(){return e},e}function i_(){var e=(0,m.Z)(["\n  mutation createSupplierInvoice(\n    $jobId: Int!\n    $supplierEmail: String\n    $sendEmail: String\n    $dueDate: timestamptz!\n  ) {\n    createSupplierInvoice(\n      jobId: $jobId\n      supplierEmail: $supplierEmail\n      sendEmail: $sendEmail\n      dueDate: $dueDate\n    ) {\n      data\n    }\n  }\n"]);return i_=function(){return e},e}iw.propTypes={addJobTiming:A.func.isRequired,deleteJobTiming:A.func.isRequired,job:A.object.isRequired,refetch:A.func.isRequired,status:A.string.isRequired,toggleShow:A.func.isRequired};var iT=(0,f.Ps)(iC());(0,f.Ps)(iR());var iA=(0,f.Ps)(iq()),iE=(0,f.Ps)(i_()),iD=t(73359),iP=t(93753),ik=t(82725),i$=t(1341);function iH(){var e=(0,m.Z)(["\n  align-self: center;\n"]);return iH=function(){return e},e}var iM=function(e){var n,t,o,a,s,u,l=e.defaultOptions,c=e.job,d=e.showSubmit,p=e.watch,m=(0,D.x)(),f=p("sendEmail"),v=p("revisions"),h=(0,_.Z)((0,iD.t)(ik.By,{onCompleted:function(e){var n,t,i=e.invoices,r=null==i?void 0:i[0];(null==r?void 0:null===(n=r.accountEntry)||void 0===n?void 0:n.type)==="customerPpmInvoice"?(0,i$.$)(null==r?void 0:null===(t=r.accountEntry)||void 0===t?void 0:t.meta):(0,iP._Z)({client:m,jobId:c.id,type:"customerVat",preview:d})}}),1)[0],b=(u=(0,q.Z)(function(){return(0,T.__generator)(this,function(e){return"reactive"===c.type?h({variables:{jobId:c.id,invoiceType:"customerVat"}}):h({variables:{jobId:c.id,invoiceType:"customerPpmInvoice"}}),[2]})}),function(){return u.apply(this,arguments)});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eH.Z,{children:(0,r.jsx)(iO,{md:10,children:(0,r.jsx)(ey.Z,{children:d?"Preview PDF":"Download PDF"})})}),(0,r.jsx)(t2.Z,{}),(0,r.jsx)(eK.Z,{align:"flex-start",children:(0,r.jsx)(ej.Z,{content:"reactive"===c.type?"Customer VAT":"Customer PPM",context:v&&"-1"!==v?"warning":"secondary",onClick:b,size:"sm"})}),d&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t2.Z,{}),(0,r.jsx)(e0.Z,{content:"Customer",text:null===(n=c.customer)||void 0===n?void 0:n.name}),(0,r.jsx)(e0.Z,{content:"Customer Contact",text:null===(t=c.customerUser)||void 0===t?void 0:t.fullName}),(0,r.jsx)(e0.Z,{content:"Phone",text:null===(o=c.customerUser)||void 0===o?void 0:o.phone}),(0,r.jsx)(e0.Z,{content:"Email",text:null===(a=c.customerUser)||void 0===a?void 0:a.email}),(0,r.jsx)(t2.Z,{}),(0,r.jsx)(eg.Z,{label:"Due date",children:(0,r.jsx)(eP.M,(0,ei.Z)((0,i.Z)({},l),{name:"dueDate",placeholder:"Due date"}))}),(0,r.jsx)(t2.Z,{}),(0,r.jsx)(t2.Z,{}),(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},l),{data:[{id:"sendEmail",label:"Send invoice via email",value:"sendEmail"},{id:"markAsInvoiceSent",label:"Mark invoice as sent",value:"markAsInvoiceSent"}],name:"sendEmail"})),"sendEmail"===f&&(0,r.jsx)(eg.Z,{label:"Send to email address",children:(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},l),{defaultValue:null===(s=c.customerUser)||void 0===s?void 0:s.email,name:"customerEmail"}))})]})]})};iM.propTypes={defaultOptions:A.object.isRequired,job:A.object.isRequired,showSubmit:A.bool};var iO=(0,no.ZP)(eM.Z).withConfig({displayName:"customer__StyledColumn",componentId:"sc-f0e892d6-0"})(iH()),iN=t(95839);function iF(){var e=(0,m.Z)(["\n  align-self: center;\n"]);return iF=function(){return e},e}var iJ=function(e){var n,t,o,a,s=e.defaultOptions,u=e.job,l=e.showSubmit,c=e.watch,d=(0,D.x)(),p=(null===(t=null==u?void 0:null===(n=u.supplier)||void 0===n?void 0:n.contactUsers[0])||void 0===t?void 0:t.user)||null,m=c("sendEmail"),f=c("revisions"),v=(0,_.Z)((0,iD.t)(ik.By,{onCompleted:function(e){var n,t,i=e.invoices,r=null==i?void 0:i[0];(null==r?void 0:null===(n=r.accountEntry)||void 0===n?void 0:n.type)==="supplierPpmInvoice"?(0,iN.W)({client:d,accountEntryId:null==r?void 0:null===(t=r.accountEntry)||void 0===t?void 0:t.id}):(0,iP._Z)({client:d,jobId:u.id,type:"supplier",preview:l})}}),1)[0],h=(a=(0,q.Z)(function(){return(0,T.__generator)(this,function(e){return"reactive"===u.type?v({variables:{jobId:u.id,invoiceType:"supplier"}}):v({variables:{jobId:u.id,invoiceType:"supplierPpmInvoice"}}),[2]})}),function(){return a.apply(this,arguments)});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eH.Z,{children:(0,r.jsx)(iL,{md:10,children:(0,r.jsx)(ey.Z,{children:l?"Preview PDF":"Download PDF"})})}),(0,r.jsx)(t2.Z,{}),(0,r.jsx)(ej.Z,{content:"Supplier",context:f&&"-1"!==f?"warning":"secondary",onClick:h,size:"md"}),l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t2.Z,{}),(0,r.jsx)(e0.Z,{content:"Supplier",text:null===(o=u.supplier)||void 0===o?void 0:o.name}),p&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e0.Z,{content:"Supplier Contact",text:p.fullName}),(0,r.jsx)(e0.Z,{content:"Phone",text:p.phone}),(0,r.jsx)(e0.Z,{content:"Email",text:p.email})]}),(0,r.jsx)(t2.Z,{}),(0,r.jsx)(eg.Z,{label:"Due date",children:(0,r.jsx)(eP.M,(0,ei.Z)((0,i.Z)({},s),{name:"dueDate",placeholder:"Due date"}))}),(0,r.jsx)(t2.Z,{}),(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},s),{data:[{id:"sendEmail",label:"Send invoice via email",value:"sendEmail"},{id:"markAsInvoiceSent",label:"Mark invoice as sent",value:"markAsInvoiceSent"}],name:"sendEmail"})),"sendEmail"===m&&(0,r.jsx)(eg.Z,{label:"Send to email address",children:(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},s),{defaultValue:p.email,name:"supplierEmail"}))})]})]})};iJ.propTypes={defaultOptions:A.object.isRequired,job:A.object.isRequired,showSubmit:A.bool};var iL=(0,no.ZP)(eM.Z).withConfig({displayName:"supplier__StyledColumn",componentId:"sc-55c6b858-0"})(iF()),iU=(0,el.Ry)().shape({sendEmail:(0,el.Z_)().required(),dueDate:(0,el.Z_)().required()}),iV=t(77349),iQ=function(e){var n,t,i,r,o,a,s,u,l,c=e.job,d=e.type,p=e.invoiceDate,m=parseInt(null===(n=c.admin)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:null===(i=t.finance)||void 0===i?void 0:i.invoiceDueDate)||30;return"customer"===d&&(m=parseInt(null===(r=c.customer)||void 0===r?void 0:null===(o=r.meta)||void 0===o?void 0:null===(a=o.finance)||void 0===a?void 0:a.invoiceDueDate)||parseInt(null===(s=c.admin)||void 0===s?void 0:null===(u=s.meta)||void 0===u?void 0:null===(l=u.finance)||void 0===l?void 0:l.invoiceDueDate)||30),(0,iV.Z)(new Date(p),m)},iz=function(e){var n,t=e.job,i=e.refetch,a=e.showSubmit,s=e.toggleShow,l=e.type,c=(0,o.useContext)(u.Z).user,d=(0,D.x)(),p=(0,nX.D)(),m=(0,er.cI)({resolver:(0,eo.S)(iU),defaultValues:{dueDate:iQ({job:t,type:l,invoiceDate:new Date})}}),f=m.errors,v=m.handleSubmit,h=m.register,b=m.control,g=m.watch,x=g("sendEmail"),j=g("customerEmail"),y=g("supplierEmail"),Z=(0,_.Z)((0,P.D)(iT,{onError:function(e){p.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){i&&i(),s()}}),1)[0],I=(0,_.Z)((0,P.D)(iA,{refetchQueries:function(){return["getInvoices"]},onError:function(e){p.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:(0,q.Z)(function(){var e;return(0,T.__generator)(this,function(n){switch(n.label){case 0:if("sendEmail"!==x)return[3,3];return[4,(0,iP._Z)({client:d,jobId:t.id,type:"customerVat",getUrl:!0})];case 1:return e=n.sent(),[4,Z({variables:{timing:{status:"invoicePDFSent",jobId:t.id,userId:c.id,meta:{toEmail:j,fileUrl:e}}}})];case 2:return n.sent(),[3,4];case 3:i&&i(),s(),n.label=4;case 4:return[2]}})})}),2),S=I[0],w=I[1].loading,C=(0,_.Z)((0,P.D)(iE,{refetchQueries:function(){return["getInvoices"]},onError:function(e){p.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:(0,q.Z)(function(){var e;return(0,T.__generator)(this,function(n){switch(n.label){case 0:if("sendEmail"!==x)return[3,3];return[4,(0,iP._Z)({client:d,jobId:t.id,type:"supplier",getUrl:!0})];case 1:return e=n.sent(),[4,Z({variables:{timing:{status:"invoicePDFSentSupplier",jobId:t.id,userId:c.id,meta:{toEmail:y,fileUrl:e}}}})];case 2:return n.sent(),[3,4];case 3:i&&i(),s(),n.label=4;case 4:return[2]}})})}),2),R=C[0],A=C[1].loading,E=(n=(0,q.Z)(function(e){return(0,T.__generator)(this,function(n){switch(n.label){case 0:if("customer"!==l)return[3,2];return[4,S({variables:{jobId:t.id,customerEmail:e.customerEmail,sendEmail:e.sendEmail,dueDate:new Date(e.dueDate)}})];case 1:return n.sent(),[3,4];case 2:if("supplier"!==l)return[3,4];return[4,R({variables:{jobId:t.id,supplierEmail:e.supplierEmail,sendEmail:e.sendEmail,dueDate:new Date(e.dueDate)}})];case 3:n.sent(),n.label=4;case 4:return[2]}})}),function(e){return n.apply(this,arguments)}),k={errors:f,register:h,control:b};return w||A?(0,r.jsx)(F.Z,{alignItems:"center",children:(0,r.jsx)(L.Z,{color:"secondary"})}):(0,r.jsxs)(ea.Z,{id:"offCanvasForm",handleSubmit:v(E),children:["customer"===l?(0,r.jsx)(iM,{defaultOptions:k,job:t,showSubmit:a,watch:g}):(0,r.jsx)(iJ,{defaultOptions:k,job:t,showSubmit:a,watch:g}),a&&(0,r.jsx)(es.H,{content:"Submit",type:"submit"})]})};iz.defaultProps={refetch:function(){},toggleShow:function(){}},iz.propTypes={job:E().object,refetch:E().func,showSubmit:E().bool,toggleShow:E().func,type:E().oneOf(["supplier","customer"]).isRequired};var iY,iB=function(e,n,t,i,o){i.show({content:(0,r.jsx)(iw,{job:e,addJobTiming:n,deleteJobTiming:t,refetch:o,status:"validated",toggleShow:i.close}),title:"Validate job"})},iG=function(e,n,t,i,o){i.show({content:(0,r.jsx)(iw,{addJobTiming:n,deleteJobTiming:t,job:e,refetch:o,status:"unvalidated",toggleShow:i.show}),title:"Unvalidate job"})},iW=function(e,n,t,i,o,a){t.show({content:(0,r.jsx)(iz,{job:n,refetch:i,showSubmit:o,toggleShow:t.close,type:e}),submit:!1,title:o?"Send ".concat(e," invoice"):"Download ".concat(e," invoice")})},iK=function(e,n,t){var i=(0,iv.Hv)(e,"customer"),o=function(e){e&&t()};n.show({content:(0,r.jsx)(im.H,{entity:"Location",entityId:e.location.id,id:i.id,onSubmit:o,addressId:i.address.id,type:"invoice"}),submit:!1,title:"Manage addresses"})},iX=function(e){var n,t=e.job,a=e.refetch,s=e.toggleShow,c=(0,o.useContext)(u.Z).user,d=(0,er.cI)({defaultValues:{comments:""}}),m=d.errors,f=d.handleSubmit,h=d.register,b=(0,_.Z)((0,P.D)(p.Tw,{onCompleted:function(){a&&a()}}),1)[0],g=(0,_.Z)((0,P.D)(v.xY,{onCompleted:function(){a&&a(),s()}}),1)[0],x=(n=(0,q.Z)(function(e){var n,r,o,a,s,u,d,p,m,f,v,h,x,j,y,Z,I,S,w,C,R,q,_,A;return(0,T.__generator)(this,function(T){switch(T.label){case 0:return n={value:0,jobId:t.id,difference:0,system:!0,meta:{username:"".concat(c.nameFirst," ").concat(c.nameLast),userId:c.id,notes:e.comments}},r=(0,i.Z)({type:"discount"},n),o=(0,i.Z)({type:"customerDeposit"},n),a=(0,i.Z)({type:"supplierDeposit"},n),s=(0,i.Z)({type:"supplierDeduction"},n),u=(0,i.Z)({type:"amount"},n),d=(0,i.Z)({type:"supplierMaterialsAmount"},n),p=(0,i.Z)({type:"supplierLabourAmount"},n),m=(0,i.Z)({type:"additions"},n),f=(0,i.Z)({type:"deductions"},n),v=(0,i.Z)({type:"firstHourRateCustomerNormal"},n),h=(0,i.Z)({type:"subsequentHoursRateCustomerNormal"},n),x=(0,i.Z)({type:"firstHourRateCustomerOOH"},n),j=(0,i.Z)({type:"subsequentHoursRateCustomerOOH"},n),y=(0,i.Z)({type:"firstHourRateCustomerPremium"},n),Z=(0,i.Z)({type:"subsequentHoursRateCustomerPremium"},n),I=(0,i.Z)({type:"firstHourRateSupplierNormal"},n),S=(0,i.Z)({type:"subsequentHoursRateSupplierNormal"},n),w=(0,i.Z)({type:"firstHourRateSupplierOOH"},n),C=(0,i.Z)({type:"subsequentHoursRateSupplierOOH"},n),R=(0,i.Z)({type:"firstHourRateSupplierPremium"},n),q=(0,i.Z)({type:"subsequentHoursRateSupplierPremium"},n),_=[r,a,s,o],A="fixed"===t.pricing?[u,d,p]:[m,f,v,h,x,j,y,Z,I,S,w,C,R,q],[4,b({variables:{objects:(0,l.Z)(_).concat((0,l.Z)(A))}}).then(function(n){g({variables:{id:t.id,changes:{status:"closed"},_append:{statusData:{closed:new Date().toISOString()}},timing:{notes:e.comments,status:"closed",jobId:t.id,userId:c.id}}})})];case 1:return T.sent(),[2]}})}),function(e){return n.apply(this,arguments)});return(0,r.jsxs)(ea.Z,{handleSubmit:f(x),children:[(0,r.jsx)(eg.Z,{label:"Comments",children:(0,r.jsx)(e_.Z,{errors:m,name:"comments",register:h,rows:3})}),(0,r.jsx)(es.H,{content:"Submit",type:"submit"})]})};iX.propTypes={job:A.object.isRequired,refetch:A.func.isRequired,toggleShow:A.func.isRequired};var i0,i1=(iY=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(iX,{job:e,toggleShow:n.show,refetch:t}),submit:!1,title:"Close and zero value job"}),[2]})}),function(e,n,t){return iY.apply(this,arguments)}),i2=function(e){var n,t,a=e.accountId,c=e.job,d=e.offCanvas,p=e.refetch,m=e.cancelMod,f=(0,o.useContext)(u.Z).user,v=(0,D.x)(),h=a||"supplier"===f.accountType&&f.accountId,b=!!(null===(n=c.supplier)||void 0===n?void 0:n.id)||!!(0,W.E)(c,"quoteNew"),g=c.supplierOffers.filter(function(e){return"cancelled"!==e.status}),x=null;g.forEach(function(e){e.account.id===h&&(x=e)});var j,y=(0,_.Z)((0,P.D)(t0,{onCompleted:(t=(0,q.Z)(function(e){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!c)return[3,2];return[4,(0,eT.F)(v,c.id)];case 1:e.sent(),e.label=2;case 2:return d.close(),"supplier"===f.accountType?s().push("/dashboard"):p&&p(),[2]}})}),function(e){return t.apply(this,arguments)})}),1)[0],Z=(j=(0,q.Z)(function(e){var n,t,i,r,o,a;return(0,T.__generator)(this,function(s){return n=[],t=null,i=null,r=!0,o="rejected",(null==g?void 0:g.length)>1&&(r=!1),a={createdAt:(0,t6.v)(),notes:e.rejectedNotes,status:"cancelled",userId:f.id},(null==x?void 0:x.statusLog)?(t=(0,l.Z)(x.statusLog)).push(a):t=[a],b&&(i={scheduledAt:null,status:o,supplierId:null,supplierUserId:null},n.push({status:o,jobId:c.id,userId:f.id,notes:e.rejectedNotes})),y({variables:{noAnotherOffers:r,assignedReject:b,changes:{status:"cancelled",notes:e.rejectedNotes,statusLog:t},id:x.id,jobChanges:i,jobId:c.id,timing:n,cancelMod:m}}),[2]})}),function(e){return j.apply(this,arguments)}),I=(0,er.cI)({defaultValues:{rejectedNotes:null==x?void 0:x.notes},resolver:(0,eo.S)(t3)}),S=I.control,w=I.errors,C=I.handleSubmit,R=I.register;return(0,r.jsx)(ea.Z,{id:"offCanvasForm",handleSubmit:C(Z),children:(0,r.jsx)(eg.Z,{label:"Notes",children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},{control:S,errors:w,register:R}),{name:"rejectedNotes",rows:3}))})})};i2.propTypes={accountId:A.number,cancelMod:A.bool,job:A.object.isRequired,offCanvas:A.object.isRequired,refetch:A.func},i2.defaultProps={cancelMod:!1};var i4,i3=(i0=(0,q.Z)(function(e){var n,t,i,o;return(0,T.__generator)(this,function(a){return n=e.job,t=e.offCanvas,i=e.refetch,o=e.accountId,t.show({content:(0,r.jsx)(t5,{accountId:o||null,job:n,offCanvas:t,refetch:i}),submit:!1,title:"Accept Job"}),[2]})}),function(e){return i0.apply(this,arguments)}),i6=(i4=(0,q.Z)(function(e){var n,t,i,o;return(0,T.__generator)(this,function(a){return n=e.job,t=e.offCanvas,i=e.refetch,o=e.accountId,t.show({content:(0,r.jsx)(i2,{accountId:o||null,job:n,offCanvas:t,refetch:i}),title:"Reject Job"}),[2]})}),function(e){return i4.apply(this,arguments)});function i5(){var e=(0,m.Z)(["\n  mutation UpdateJob($id: Int!, $update: Job_set_input!) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $update) {\n      id\n    }\n  }\n"]);return i5=function(){return e},e}function i7(){var e=(0,m.Z)(['\n  mutation UPSERT_JOB_REPORT_WITH_MEDIA(\n    $objects: [JobReport_insert_input!]!\n    $jobReportId: Int\n    $isNewCustomerSignature: Boolean!\n    $isNewSupplierSignature: Boolean!\n  ) {\n    deleteCustomerSignature: delete_Media(\n      where: {\n        category: { _eq: "customerSignature" }\n        Media_Entities: { JobReport: { id: { _eq: $jobReportId } } }\n      }\n    ) @skip(if: $isNewCustomerSignature) {\n      returning {\n        id\n      }\n    }\n    deleteSupplierSignature: delete_Media(\n      where: {\n        category: { _eq: "supplierSignature" }\n        Media_Entities: { JobReport: { id: { _eq: $jobReportId } } }\n      }\n    ) @skip(if: $isNewSupplierSignature) {\n      returning {\n        name\n        id\n      }\n    }\n    insert_JobReport(\n      objects: $objects\n      on_conflict: {\n        constraint: uc_JobReport_jobId\n        update_columns: [completion, meta, notes, timing, passFailStatus, recommendations]\n      }\n    ) {\n      returning {\n        id\n        completion\n        meta\n        notes\n        timing\n        createdAt\n        updatedAt\n      }\n    }\n  }\n']);return i7=function(){return e},e}var i9=(0,f.Ps)(i5()),i8=(0,f.Ps)(i7()),re=t(56815),rn=t(99988),rt=(0,el.Ry)({id:(0,el.Rx)(),completion:(0,el.Z_)().when("$completed",{is:!0,then:function(e){return e.oneOf(rn.M2.map(function(e){return e.value})).required()}}),notes:(0,el.Z_)().min(50,"Insufficient information added.\n    Please enter a minimum of 50 characters in the description before submitting your report."),timing:(0,el.Z_)().when("$completed",{is:!0,then:function(){return(0,el.Z_)().oneOf(["correct","incorrect"]).required()}}),completionNotes:(0,el.Z_)(),houseKeepingExpenses:(0,el.nK)(),houseKeepingPhotos:(0,el.nK)(),correctStart:(0,el.hT)().when("timing",function(e,n){return"incorrect"===(0,_.Z)(e,1)[0]?n.max(new Date):n.nullable()}),correctEnd:(0,el.hT)().when("correctStart",function(e,n){var t=(0,_.Z)(e,1)[0];return t?n.min(t).max(new Date):n.nullable()}),correctDuration:(0,el.Rx)().min(1).when(["correctStart","correctEnd"],function(e,n){var t=(0,_.Z)(e,2),i=t[0],r=t[1];if(i&&r){var o=X()(r).diff(i,"minutes");return n.max(o).required()}return n.nullable()}),recommendations:(0,el.Z_)().when(["passFailStatus","$requireRecommendations"],function(e,n){var t=(0,_.Z)(e,2),i=t[0],r=t[1];return"Failed"===i&&r?n.min(50,"Please enter a minimum of 50 characters in the\n          recommendations before submitting your report."):n.min(0)})}),ri=t(10166),rr=t(64666),ro=t(6514),ra=t(74721),rs=t(83372),ru=function(e){var n=e.status,t=e.open,i=e.onClose,o=e.onConfirm;return(0,r.jsx)(rl,{open:t,onClose:i,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:(0,r.jsxs)(ro.Z,{sx:{fontFamily:rs.Q.THEME_TYPOGRAPHY.newFont,padding:"32px 44px"},children:[(0,r.jsxs)(F.Z,{width:"100%",alignItems:"center",spacing:1,mb:"24px",children:[(0,r.jsx)(ra.Z,{sx:{color:rs.Q.COLOUR.warning}}),(0,r.jsx)(rd,{variant:"h6",children:"Please ensure that the job's Pass/Fail status below is correct."}),(0,r.jsx)(rd,{variant:"h6",color:"Passed"===n?"green":"red",children:n})]}),(0,r.jsxs)(F.Z,{width:"100%",direction:"row",justifyContent:"center",spacing:2,children:[(0,r.jsx)(rc,{variant:"outlined",onClick:i,children:"Cancel"}),(0,r.jsx)(rc,{type:"submit",form:"offCanvasForm",variant:"contained",onClick:o,children:"Confirm"})]})]})})};ru.propTypes={status:E().oneOf(["Failed","Passed"]),open:E().bool,onClose:E().func,onConfirm:E().func},ru.defaultProps={onClose:function(){},onConfirm:function(){}};var rl=(0,ri.Z)(rr.Z)(function(){return{"&.MuiDialog-root.MuiModal-root":{zIndex:1e4},"& .MuiPaper-root":{width:"400px"}}}),rc=(0,ri.Z)(O.Z)(function(){return{fontFamily:"inherit"}}),rd=(0,ri.Z)(J.Z)(function(){return{fontFamily:"inherit",fontWeight:600,textAlign:"center"}}),rp=t(37645),rm=t(61730);function rf(){var e=(0,m.Z)(['\n  query GET_SIGNATURES_TAXONOMY($signatureType: jsonb) {\n    Taxonomy(\n      where: {\n        type: { _eq: "signatures" }\n        status: { _eq: "active" }\n        meta: { _contains: $signatureType }\n      }\n    ) {\n      id\n      name\n      status\n      meta\n    }\n  }\n']);return rf=function(){return e},e}function rv(){var e=(0,m.Z)(['\n  query GET_SIGNATURES_MEDIA($jobReportId: Int) {\n    customerSignatureMedia: Media(\n      where: {\n        category: { _eq: "customerSignature" }\n        Media_Entities: { JobReport: { id: { _eq: $jobReportId } } }\n      }\n      order_by: { createdAt: desc }\n      limit: 1\n    ) {\n      filename\n      id\n      category\n    }\n    supplierSignatureMedia: Media(\n      where: {\n        category: { _eq: "supplierSignature" }\n        Media_Entities: { JobReport: { id: { _eq: $jobReportId } } }\n      }\n      order_by: { createdAt: desc }\n      limit: 1\n    ) {\n      filename\n      id\n      category\n    }\n    JobReport(where: { id: { _eq: $jobReportId } }) {\n      meta\n    }\n  }\n']);return rv=function(){return e},e}var rh=(0,f.Ps)(rf()),rb=(0,f.Ps)(rv()),rg=t(4595),rx=t(93362);function rj(){var e;return{width:window.innerWidth,height:window.innerHeight}}var ry=(0,rx.D)(),rZ={customer:{customerSignature:!0},supplier:{supplierSignature:!0}},rI=function(e){var n,t,i,a=e.label,s=e.title,u=e.signatureState,l=e.setSignatureState,d=e.signatureType,p=e.signatureError,m=(t=(n=(0,o.useState)(rj()))[0],i=n[1],(0,o.useEffect)(function(){var e=function(){i(rj())};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}},[]),t).width,f=(0,rm.Z)("(max-width: 600px)"),v=(0,_.Z)(o.useState(!1),2),h=v[0],b=v[1],g=(0,o.useState)([{label:"Select...",value:null}]),x=g[0],j=g[1],y=(0,o.useState)(!1),Z=y[0],I=y[1],S=(0,o.useState)((null==u?void 0:u.signer)||""),w=S[0],C=S[1],R=(0,o.useState)(!1),q=R[0],T=R[1],A=(0,o.useState)(!0),E=A[0],D=A[1],P=(0,o.useRef)(null),k=(0,c.a)(rh,{variables:{signatureType:rZ[d]},onCompleted:function(e){j(e.Taxonomy.map(function(e){return{label:e.name,value:e.name}}))}}).loading,$=function(){b(!1)},H=function(e){D(!1);var n=P.current,t=n.getContext("2d"),i=e.nativeEvent.changedTouches[0],r=i.clientX,o=i.clientY,a=n.getBoundingClientRect();t.beginPath(),t.moveTo(r-a.left,o-a.top),I(!0)},N=function(e){D(!1);var n=P.current.getContext("2d"),t=e.nativeEvent,i=t.offsetX,r=t.offsetY;n.beginPath(),n.moveTo(i,r),I(!0)},L=function(e){if(Z){var n=P.current.getContext("2d"),t=e.nativeEvent,i=t.offsetX,r=t.offsetY;n.lineTo(i,r),n.stroke()}},U=function(e){if(Z){var n=P.current,t=n.getContext("2d"),i=e.nativeEvent.changedTouches[0],r=i.clientX,o=i.clientY,a=n.getBoundingClientRect();t.lineTo(r-a.left,o-a.top),t.stroke()}},V=function(){I(!1)},Q=function(e){if(!w){T(!0);return}var n={signature:P.current.toDataURL("image/png"),signer:w.label,timestamp:X()().toISOString(),isBase64:!0,isBlank:E};l(function(){return n}),T(!1),b(!1)},z=function(){b(!1)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(F.Z,{direction:"row",spacing:2,alignItems:"center",children:[(0,r.jsx)(O.Z,{variant:"outlined",color:p?"error":"secondary",sx:{width:"40px",height:"40px",borderRadius:"20px",minWidth:0},onClick:function(){b(!0)},children:"+"}),(0,r.jsx)(J.Z,{sx:{color:"rgb(0,55,83)"},children:a}),(0,r.jsxs)(rS,{fullScreen:f,open:h,onClose:$,sx:{zIndex:1500},children:[(0,r.jsx)(rp.Z,{children:s}),(0,r.jsxs)(F.Z,{direction:"column",sx:{padding:2},spacing:2,children:[(0,r.jsx)("canvas",{ref:P,width:f?m:600,height:200,style:{border:"1px solid #000",padding:"10px"},onTouchStart:H,onTouchMove:U,onTouchEnd:V,onTouchCancel:V,onMouseDown:N,onMouseMove:L,onMouseUp:V,onMouseOut:V}),(0,r.jsxs)(F.Z,{direction:"row",spacing:2,sx:{height:"fit"},alignItems:"center",children:[(0,r.jsx)(J.Z,{children:"Name: "}),(0,r.jsx)(rg.F,{freeSolo:!0,error:q,sx:{width:"100%",zIndex:11e3},loading:k,placeholder:a,size:"medium",options:x,className:"responsive-fontSize",value:w,getOptionLabel:function(e){return"string"==typeof e?e:e.value?e.value:e.label},onChange:function(e,n){"string"==typeof n?C({label:n}):n&&n.value?C({label:n.value}):C(n)},filterOptions:function(e,n){var t=ry(e,n),i=n.inputValue,r=e.some(function(e){return i===e.title});return""===i||r||t.push({value:i,label:'Add "'.concat(i,'"')}),t}})]}),(0,r.jsxs)(F.Z,{direction:"row",spacing:3,justifyContent:"flex-end",children:[(0,r.jsx)(O.Z,{variant:"contained",color:"error",onClick:z,children:"Cancel"}),(0,r.jsx)(O.Z,{variant:"contained",color:"success",onClick:Q,children:"Submit"})]})]})]})]}),(null==u?void 0:u.signature)&&(0,r.jsxs)(F.Z,{direction:"column",children:[(0,r.jsx)(M.Z,{children:(0,r.jsx)("img",{src:null==u?void 0:u.signature,alt:"signature",width:400,height:200})}),(0,r.jsxs)(J.Z,{children:["Name: ",null==u?void 0:u.signer]}),(0,r.jsxs)(J.Z,{children:["Time: ",X()(null==u?void 0:u.timestamp).format("YYYY-MM-DD HH:mm")]})]})]})};rI.defaultProps={label:"",title:"Customer signature",signatureState:{signature:"",signer:"",timestamp:""},setSignatureState:function(){},signatureError:!1},rI.propTypes={label:E().string,title:E().string,signatureState:E().shape({signature:E().string,signer:E().string,timestamp:E().string}),setSignatureState:E().func,signatureType:E().oneOf(["customer","supplier"]),signatureError:E().bool};var rS=(0,ri.Z)(rr.Z)(function(){return{"&.MuiDialog-root.MuiModal-root":{zIndex:1e4},"& .MuiPaper-root":{width:"100%",maxWidth:"600px"}}}),rw=t(63973),rC=function(e){for(var n=atob(e.split(",")[1]),t=Array(n.length),i=0;i<n.length;i++)t[i]=n.charCodeAt(i);var r=new Uint8Array(t),o=new Blob([r],{type:"image/png"});return new File([o],"canvasImage.png",{type:"image/png"})};function rR(){var e=(0,m.Z)(["\n  margin-top: -0.75rem;\n  display: block;\n"]);return rR=function(){return e},e}var rq=function(e){var n,t,a,s,l,d,p,m,f,v,h,b,g,x,j,y,Z,I,S,w,C,R,A=e.job,E=e.offCanvas,k=e.refetch,$=(0,D.x)(),H=(0,nv.x)().user,M={id:null===(n=A.report)||void 0===n?void 0:n.id,completion:null===(t=A.report)||void 0===t?void 0:t.completion,notes:(null===(a=A.report)||void 0===a?void 0:a.notes)||"",timing:A.timingStatus,completionNotes:(null===(s=A.report)||void 0===s?void 0:null===(l=s.meta)||void 0===l?void 0:l.completionNotes)||"",houseKeepingExpenses:null===(d=A.report)||void 0===d?void 0:null===(p=d.meta)||void 0===p?void 0:p.houseKeepingExpenses,houseKeepingPhotos:null===(m=A.report)||void 0===m?void 0:null===(f=m.meta)||void 0===f?void 0:f.houseKeepingPhotos,correctDuration:A.correctDuration,correctStart:A.correctStart?new Date(A.correctStart):new Date,correctEnd:A.correctEnd?new Date(A.correctEnd):new Date,passFailStatus:(null===(v=A.report)||void 0===v?void 0:v.passFailStatus)||"Passed",recommendations:(null===(h=A.report)||void 0===h?void 0:h.recommendations)||""},O=(0,er.cI)({defaultValues:M,resolver:(0,eo.S)(rt),context:{completed:!!(0,W.E)(A,"completed"),requireRecommendations:A.requireReportRecommendations}}),N=O.errors,U=O.handleSubmit,V=O.register,Q=O.watch,z=O.control,Y=O.setValue,B=(0,o.useState)(!1),G=B[0],K=B[1],en=(0,o.useState)(!1),et=en[0],ea=en[1],es=(0,o.useState)(!1),eu=es[0],el=es[1],ec=(0,o.useState)(!1),ed=ec[0],ep=ec[1],em=(0,o.useState)(!1),ef=em[0],ev=em[1],ey=Q("notes"),eZ=Q("timing"),eI=Q("completion"),eS=Q("correctStart"),ew=Q("correctEnd"),eC=Q("recommendations"),eR=Q("passFailStatus"),eq=(0,o.useState)({signature:"",signer:"",timestamp:"",isBase64:!1,isBlank:!0}),eA=eq[0],eE=eq[1],eD=(0,o.useState)({signature:"",signer:"",timestamp:"",isBase64:!1,isBlank:!0}),ek=eD[0],e$=eD[1];(0,o.useEffect)(function(){return!A.reportPassFail||M.id?el(!0):el(!1)},[]),(0,o.useEffect)(function(){var e,n;(null===(e=A.report)||void 0===e?void 0:e.passFailStatus)&&((null===(n=A.report)||void 0===n?void 0:n.passFailStatus)!==eR?el(!1):el(!0))},[null===(b=A.report)||void 0===b?void 0:b.passFailStatus,eR]),(0,o.useEffect)(function(){var e;eA.signature&&(null==A?void 0:null===(e=A.meta)||void 0===e?void 0:e.customerSignature)&&ep(!1)},[eA,null==A?void 0:null===(g=A.meta)||void 0===g?void 0:g.customerSignature]),(0,o.useEffect)(function(){var e;ek.signature&&(null==A?void 0:null===(e=A.meta)||void 0===e?void 0:e.supplierSignature)&&ev(!1)},[null==A?void 0:null===(x=A.meta)||void 0===x?void 0:x.supplierSignature,ek]);var eM=ty({autoStart:!1,startTime:(0,W.E)(A,"inProgress"),endTime:(0,W.E)(A,"completed")}).time,eO=eM.seconds,eN=eM.minutes,eF=eM.hours,eJ=(0,_.Z)((0,P.D)(i9,{onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!A)return[3,2];return[4,(0,eT.F)($,A.id)];case 1:e.sent(),e.label=2;case 2:return E.close(),k&&k(),[2]}})})}),1)[0];(0,c.a)(rb,{skip:!(null===(j=A.report)||void 0===j?void 0:j.id),variables:{jobReportId:null===(y=A.report)||void 0===y?void 0:y.id},onCompleted:function(e){if(e.customerSignatureMedia.length>0){var n={};n.signature="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.customerSignatureMedia[0].filename),n.signer=e.JobReport[0].meta.customerSignatureName,n.timestamp=e.JobReport[0].meta.customerSignatureTime,n.isBlank=!1,eE(n)}if(e.supplierSignatureMedia.length>0){var t={};t.signature="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.supplierSignatureMedia[0].filename),t.signer=e.JobReport[0].meta.supplierSignatureName,t.timestamp=e.JobReport[0].meta.supplierSignatureTime,t.isBlank=!1,e$(t)}}});var eL,eU=(0,_.Z)((0,P.D)(i8,{onCompleted:function(){E.close(),k&&k()}}),1)[0],eV=(0,o.useContext)(u.Z).user,eQ=(eL=(0,q.Z)(function(e){var n,t,i,r,o,a,s,u,l,c,d;return(0,T.__generator)(this,function(o){switch(o.label){case 0:if(o.trys.push([0,,5,6]),ep(!1),ev(!1),!eu)return[2,ea(!0)];if(!eA.signature&&(null==A?void 0:null===(n=A.meta)||void 0===n?void 0:n.customerSignature)&&(0,W.E)(A,"completed"))return ep(!0),[2];if(!ek.signature&&(null==A?void 0:null===(t=A.meta)||void 0===t?void 0:t.supplierSignature)&&(0,W.E)(A,"completed"))return ev(!0),[2];if(K(!0),r=[],!eA.isBase64)return[3,2];return[4,(0,rw.V)(rC(eA.signature),"image")];case 1:a=o.sent().key,(s={entity:"JobReport"}).Medium={data:{adminId:H.adminId,category:"customerSignature",caption:"test",expiryAt:null,extension:null==a?void 0:a.split(".").pop(),userId:eV.id,filename:a,meta:{},type:"image"}},r.push(s),o.label=2;case 2:if(!ek.isBase64)return[3,4];return[4,(0,rw.V)(rC(ek.signature),"image")];case 3:l=o.sent().key,(c={entity:"JobReport"}).Medium={data:{adminId:H.adminId,category:"supplierSignature",caption:"test",expiryAt:null,extension:null==l?void 0:l.split(".").pop(),userId:eV.id,filename:l,meta:{},type:"image"}},r.push(c),o.label=4;case 4:return d={id:e.id,jobId:A.id,completion:e.completion,notes:e.notes,passFailStatus:e.passFailStatus,recommendations:e.recommendations,meta:{houseKeepingExpenses:e.houseKeepingExpenses,houseKeepingPhotos:e.houseKeepingPhotos,customerSignatureName:eA.signer,customerSignatureTime:eA.timestamp,customerSignatureIsBlank:eA.isBlank,supplierSignatureName:ek.signer,supplierSignatureTime:ek.timestamp,supplierSignatureIsBlank:ek.isBlank},Media_Entity:{data:r.length>0?r:[]}},e.completionNotes&&(d.meta.completionNotes=e.completionNotes),eU({variables:{jobReportId:null==A?void 0:null===(i=A.report)||void 0===i?void 0:i.id,objects:[d],isNewCustomerSignature:!eA.isBase64,isNewSupplierSignature:!ek.isBase64}}),(0,W.E)(A,"completed")&&eJ({variables:{id:A.id,update:{timingStatus:e.timing,correctDuration:"incorrect"===e.timing?e.correctDuration:null,correctStart:"incorrect"===e.timing?e.correctStart:null,correctEnd:"incorrect"===e.timing?e.correctEnd:null}}}),[3,6];case 5:return K(!1),[7];case 6:return[2]}})}),function(e){return eL.apply(this,arguments)}),ez=(null==A?void 0:null===(Z=A.media)||void 0===Z?void 0:Z.length)||0,eY={control:z,errors:N,register:V},eB=null;switch(eI){case"returnVisit":eB="Please provide description of works and time required in hours/days";break;case"returnVisitByAnother":eB="Please indicate the type of works and engineer required";break;case"couldNotDo":eB="Please advise why you were unable to do these works"}var eG,eW=function(e){e.target.checked?Y("passFailStatus","Failed"):Y("passFailStatus","Passed")},eK=function(){ea(!1)},eX=function(){el(!0),ea(!1)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ru,{status:eR,open:et,onClose:eK,onConfirm:eX}),G?(0,r.jsx)(F.Z,{alignItems:"center",children:(0,r.jsx)(L.Z,{color:"secondary"})}):(0,r.jsxs)("form",{id:"offCanvasForm",onSubmit:U(eQ),children:[(0,r.jsxs)(eg.Z,{label:"Detailed description of works",children:[(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},eY),{name:"notes",rows:4})),(null==N?void 0:N.notes)&&(0,r.jsx)(re.Z,{sx:{m:0},children:null==N?void 0:null===(I=N.notes)||void 0===I?void 0:I.message}),(0,r.jsxs)(J.Z,{children:[null==ey?void 0:ey.length,"/50"]})]}),!(0,W.E)(A,"completed")&&(0,r.jsx)(eH.Z,{style:{margin:0,justifyContent:"flex-end"},children:(0,r.jsx)(ej.Z,{content:"Save",context:"secondary",type:"submit",size:"sm"})}),!(0,W.E)(A,"completed")&&(0,r.jsx)(F.Z,{spacing:1,children:(null==A?void 0:null===(S=A.meta)||void 0===S?void 0:S.customerSignature)&&(0,r.jsx)(rI,{label:"Add customer signature",title:"Add customer signature",name:"customerSignature",jobReport:A.report,onCancel:function(){},signatureState:eA,setSignatureState:eE,signatureType:"customer",signatureError:ed})}),(0,W.E)(A,"completed")&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t1.Z,{}),(0,r.jsx)(eg.Z,{label:"Timing",children:(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},eY),{data:[{id:"correct",label:"I confirm that the job took ".concat(eF,":").concat(eN,":").concat(eO),value:"correct"},{id:"incorrect",label:"The timing is incorrect",value:"incorrect"}],name:"timing",stacked:!0}))}),"incorrect"===eZ&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eg.Z,{label:"Enter correct time of starting ",children:(0,r.jsx)(eP.M,(0,ei.Z)((0,i.Z)({},eY),{errors:N,dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,placeholder:"Click to select Start time",name:"correctStart",showTimeSelect:!0,todayButton:!1,maxDate:ew?new Date(ew):new Date,onChange:function(e){Y("correctStart",e),Y("correctDuration",X()(ew).diff(e,"minutes"))}}))}),(0,r.jsx)(eg.Z,{label:"Enter correct time of ending ",children:(0,r.jsx)(eP.M,(0,ei.Z)((0,i.Z)({},eY),{errors:N,dateFormat:"d MMM yyyy HH:mm",disableInitialDateBackground:!1,placeholder:"Click to select End time",name:"correctEnd",showTimeSelect:!0,todayButton:!1,minDate:eS?new Date(eS):new Date,maxDate:new Date,onChange:function(e){Y("correctEnd",e),Y("correctDuration",X()(e).diff(eS,"minutes"))}}))}),(0,r.jsx)(eg.Z,{label:"Enter correct job duration",children:(0,r.jsxs)(na.Z,{children:[(0,r.jsx)(ex.Z,{errors:N,min:0,name:"correctDuration",register:V,type:"number"}),(0,r.jsx)(ns.Z,(0,ei.Z)((0,i.Z)({},eY),{addonType:"append",size:"sm",text:!0,children:"Minutes"}))]})})]}),A.reportPassFail&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t1.Z,{}),(0,r.jsx)(J.Z,{sx:{color:"rgb(0,55,83)"},children:A.reportPassFailTitle}),(0,r.jsxs)(F.Z,{direction:"row",spacing:1,alignItems:"center",children:[(0,r.jsx)(J.Z,{children:"Pass"}),(0,r.jsx)(er.Qr,{name:"passFailStatus",control:z,render:function(e){var n=e.value;return(0,r.jsx)(rT,{checked:"Passed"!==n,onChange:eW})}}),(0,r.jsx)(J.Z,{children:"Fail"})]}),(0,r.jsxs)(eg.Z,{label:"Recommendations",children:[(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},eY),{name:"recommendations",rows:4})),(null==N?void 0:N.recommendations)&&(0,r.jsx)(re.Z,{sx:{m:0},children:null==N?void 0:null===(w=N.recommendations)||void 0===w?void 0:w.message}),(0,r.jsxs)(J.Z,{children:[null==eC?void 0:eC.length,"/50"]})]})]}),(0,r.jsx)(t1.Z,{}),(0,r.jsx)(eg.Z,{label:"Job status",children:(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},eY),{data:rn.M2,name:"completion",stacked:!0}))}),eB&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(eg.Z,{label:eB,children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},eY),{name:"completionNotes",rows:2}))})}),(0,r.jsx)(t1.Z,{}),(0,r.jsxs)(eg.Z,{label:"Requirements",children:[(0,r.jsx)(eh.Z,(0,ei.Z)((0,i.Z)({},eY),{data:[{id:"expensesAdded",label:"Expenses added",value:"expensesAdded"}],name:"houseKeepingExpenses"})),(0,r.jsxs)(r_,{children:["Confirm all expenses have been added, expenses not added before completing a job may not be paid",(eG=e7(A.expenses,0,"supplier").totalExpenses,(0,r.jsx)(e0.Z,{content:"Total submitted",text:(0,ee.Z)(eG)}))]}),(0,r.jsx)(eh.Z,(0,ei.Z)((0,i.Z)({},eY),{data:[{id:"photosAdded",label:"Photos added",value:"photosAdded"}],name:"houseKeepingPhotos"})),(0,r.jsxs)(r_,{children:["You must add at least 1 photo, but please include before and after photos as a minimum (",ez," Photo(s) added)"]}),(0,r.jsx)(t1.Z,{}),(0,r.jsxs)(F.Z,{spacing:1,children:[(null==A?void 0:null===(C=A.meta)||void 0===C?void 0:C.customerSignature)&&(0,r.jsx)(rI,{label:"Add customer signature",title:"Add customer signature",name:"customerSignature",jobReport:A.report,onCancel:function(){},signatureState:eA,setSignatureState:eE,signatureType:"customer",signatureError:ed}),(null==A?void 0:null===(R=A.meta)||void 0===R?void 0:R.supplierSignature)&&(0,r.jsx)(rI,{label:"Add engineer signature",title:"Add engineer signature",jobReport:A.report,name:"supplierSignature",onCancel:function(){},signatureState:ek,setSignatureState:e$,signatureType:"supplier",signatureError:ef})]})]})]})]})]})},r_=no.ZP.small.withConfig({displayName:"form__StyledSmall",componentId:"sc-ffa33e97-0"})(rR()),rT=(0,ri.Z)(nY.Z)(function(e){var n=e.checked;return{"&.MuiSwitch-root":{"& .MuiSwitch-thumb":{backgroundColor:n?"red":"green"},"& .MuiSwitch-track":{backgroundColor:n?"red":"green"},"& .Mui-checked+.MuiSwitch-track":{backgroundColor:n?"red":"green"}}}}),rA=t(70136),rE=t(34613),rD=t(40826);function rP(){var e=(0,m.Z)(["\n  display: block;\n"]);return rP=function(){return e},e}function rk(){var e=(0,m.Z)(["\n  display: flex;\n  align-items: center;\n"]);return rk=function(){return e},e}var r$=function(e){var n,t,i,o,a,s,u,l,c,d,p,m,f,v=e.job,h={completion:null===(t=v.report)||void 0===t?void 0:t.completion,notes:null===(i=v.report)||void 0===i?void 0:i.notes,timing:v.timingStatus,completionNotes:(null===(o=v.report)||void 0===o?void 0:null===(a=o.meta)||void 0===a?void 0:a.completionNotes)||"",houseKeepingExpenses:null===(s=v.report)||void 0===s?void 0:null===(u=s.meta)||void 0===u?void 0:u.houseKeepingExpenses,houseKeepingPhotos:null===(l=v.report)||void 0===l?void 0:null===(c=l.meta)||void 0===c?void 0:c.houseKeepingPhotos,correctDuration:v.correctDuration,correctStart:v.correctStart?new Date(v.correctStart):"",correctEnd:v.correctEnd?new Date(v.correctEnd):"",passFailStatus:null===(d=v.report)||void 0===d?void 0:d.passFailStatus,reportPassFailTitle:v.reportPassFailTitle||"",recommendations:(null===(p=v.report)||void 0===p?void 0:p.recommendations)||"",comments:(null===(m=v.report)||void 0===m?void 0:m.comments)||""},b=(0,rA.Z)({autoStart:!1,startTime:(0,W.E)(v,"inProgress"),endTime:(0,W.E)(v,"completed")}).time,g=b.seconds,x=b.minutes,j=b.hours,y=null;switch(h.completionNotes){case"returnVisit":y="Please provide description of works and time required in hours/days";break;case"returnVisitByAnother":y="Please indicate the type of works and engineer required";break;case"couldNotDo":y="Please advise why you were unable to do these works"}return(0,r.jsxs)("div",{children:[(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e0.Z,{content:"Notes",text:h.notes}),(0,r.jsx)(t1.Z,{})]}),(0,W.E)(v,"completed")&&(0,r.jsxs)(r.Fragment,{children:["correct"===h.timing&&(0,r.jsx)(e0.Z,{content:"Timing",text:"I confirm that the job took ".concat(j,":").concat(x,":").concat(g)}),"incorrect"===h.timing&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e0.Z,{content:"The timing is incorrect",text:"incorrect"}),h.correctStart&&(0,r.jsx)(e0.Z,{content:"Correct start",text:"".concat((0,en.Z)(h.correctStart)," - ").concat((0,rE.Z)(h.correctStart))}),h.correctEnd&&(0,r.jsx)(e0.Z,{content:"Correct end",text:"".concat((0,en.Z)(h.correctEnd)," - ").concat((0,rE.Z)(h.correctEnd))}),h.correctDuration&&(0,r.jsx)(e0.Z,{content:"Correct duration",text:"".concat(h.correctDuration," - minutes")})]}),h.passFailStatus&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e0.Z,{content:h.reportPassFailTitle,text:h.passFailStatus}),(0,r.jsx)(e0.Z,{content:"Recommendations",text:h.recommendations}),h.comments&&(0,r.jsx)(e0.Z,{content:"Comments",text:h.comments})]}),(0,r.jsx)(t1.Z,{}),(0,r.jsx)(e0.Z,{content:"Job status",text:null===(f=rn.M2.find(function(e){return e.value===h.completion}))||void 0===f?void 0:f.label}),y&&(0,r.jsx)(e0.Z,{content:y,text:h.completionNotes}),(0,r.jsx)(t1.Z,{}),(0,r.jsx)(eX.Z,{tag:"h4",content:"Requirements"}),"expensesAdded"===h.houseKeepingExpenses&&(0,r.jsxs)(rM,{children:[(0,r.jsx)(rD.Z,{context:"success",icon:"check",size:"sm"}),(0,r.jsx)(e0.Z,{content:"",text:"Expenses added"}),(0,r.jsx)(rH,{children:(n=e7(v.expenses,0,"supplier").totalExpenses,(0,r.jsx)(e0.Z,{content:"Total submitted",text:(0,ee.Z)(n)}))})]}),"photosAdded"===h.houseKeepingPhotos&&(0,r.jsxs)(rM,{children:[(0,r.jsx)(rD.Z,{context:"success",icon:"check",size:"sm"}),(0,r.jsx)(e0.Z,{content:"",text:"Photos added"})]})]})]})},rH=no.ZP.small.withConfig({displayName:"details__StyledSmall",componentId:"sc-3c3dc0f8-0"})(rP()),rM=no.ZP.div.withConfig({displayName:"details__StyledIconBox",componentId:"sc-3c3dc0f8-1"})(rk());r$.propTypes={job:A.object.isRequired};var rO,rN=function(e){var n,t,a,s,l,c,d=e.job,p=e.refetch,m=e.toggleShow,f=(0,o.useContext)(u.Z).user,h=(0,er.cI)({defaultValues:{email:null===(n=d.customerUser)||void 0===n?void 0:n.email}}),b=h.errors,g=h.control,x=h.handleSubmit,j=h.register,y=h.watch,Z=y("sendEmail"),I=y("email"),S=(0,_.Z)((0,P.D)(v.yT),1)[0],w=(0,_.Z)((0,P.D)(v.xY,{onCompleted:(0,q.Z)(function(){var e;return(0,T.__generator)(this,function(n){switch(n.label){case 0:if(!(I&&"sendEmail"===Z))return[3,2];return[4,(0,tN.e)({adminId:d.adminId,job:d,openReport:!1})];case 1:e=n.sent(),S({variables:{timing:{status:"reportPDFSentSupplier",jobId:d.id,userId:f.id,meta:{toEmail:I,fileUrl:e.link}}}}),n.label=2;case 2:return p&&p(),m(),[2]}})})}),1)[0],C=(c=(0,q.Z)(function(e){var n,t;return(0,T.__generator)(this,function(e){return n="reportSent",t=d.meta||{},w({variables:{id:d.id,changes:{meta:t,status:n},timing:{status:n,jobId:d.id,userId:f.id},_append:{statusData:(0,em.Z)({},n,X()().toISOString())}}}),[2]})}),function(e){return c.apply(this,arguments)});return(0,r.jsxs)(ea.Z,{handleSubmit:x(C),children:[(0,r.jsx)(e0.Z,{content:"Customer",text:null===(t=d.customer)||void 0===t?void 0:t.name}),(0,r.jsx)(e0.Z,{content:"Customer Contact",text:null===(a=d.customerUser)||void 0===a?void 0:a.fullName}),(0,r.jsx)(e0.Z,{content:"Phone",text:null===(s=d.customerUser)||void 0===s?void 0:s.phone}),(0,r.jsx)(e0.Z,{content:"Email",text:null===(l=d.customerUser)||void 0===l?void 0:l.email}),(0,r.jsx)(t2.Z,{}),(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},{errors:b,register:j,control:g}),{data:[{id:"sendEmail",label:"Send report via email",value:"sendEmail"},{id:"markAsReportSent",label:"Mark report as sent",value:"markAsReportSent"}],name:"sendEmail"})),"sendEmail"===Z&&(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(nI.Z,{fullWidth:!0,inputRef:j,label:"Send to email address",name:"email"})}),(0,r.jsx)(es.H,{content:"Submit",type:"submit"})]})};rN.propTypes={job:A.object.isRequired,refetch:A.func.isRequired,toggleShow:A.func.isRequired};var rF,rJ,rL=(rO=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(rN,{job:e,refetch:t,toggleShow:n.show}),submit:!1,title:"Send Report"}),[2]})}),function(e,n,t){return rO.apply(this,arguments)}),rU=(rF=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(rq,{job:e,offCanvas:n,refetch:t}),title:e.report?"Update Report":"Create Report"}),[2]})}),function(e,n,t){return rF.apply(this,arguments)}),rV=(rJ=(0,q.Z)(function(e,n){return(0,T.__generator)(this,function(t){return n.show({submit:!1,content:(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(r$,{job:e})}),title:"Details Report"}),[2]})}),function(e,n){return rJ.apply(this,arguments)});function rQ(){var e=(0,m.Z)(["\n  mutation AddQuotation($objects: [SupplierQuote_insert_input!]!) {\n    insert_SupplierQuote(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return rQ=function(){return e},e}function rz(){var e=(0,m.Z)(["\n  mutation UpdateQuotation(\n    $id: Int!\n    $changes: SupplierQuote_set_input\n    $jobId: Int\n    $objectJobTiming: [JobTiming_insert_input!]!\n  ) {\n    update_SupplierQuote_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      status\n    }\n    insert_JobTiming(objects: $objectJobTiming) {\n      returning {\n        id\n        status\n        notes\n        createdAt\n      }\n    }\n  }\n"]);return rz=function(){return e},e}function rY(){var e=(0,m.Z)(["\n  mutation UpdateQuotation(\n    $id: Int!\n    $changes: SupplierQuote_set_input\n    $supplierOffer: [SupplierOffer_insert_input!]!\n  ) {\n    update_SupplierQuote_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_SupplierOffer(objects: $supplierOffer) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return rY=function(){return e},e}(0,f.Ps)(rQ());var rB=(0,f.Ps)(rz());function rG(){var e=(0,m.Z)(["\n  query GetQuotationLineItems($quotationId: Int!, $type: String) {\n    lineItems: SupplierQuoteLineItem(\n      where: { quoteId: { _eq: $quotationId }, type: { _eq: $type } }\n    ) {\n      id\n      description\n      item\n      qty\n      qtyUnit\n      quoteId\n      supplierTotal\n      total\n      type\n      unitRate\n    }\n  }\n"]);return rG=function(){return e},e}function rW(){var e=(0,m.Z)(['\n  query GetQuoteUplift($jobId: Int) {\n    SupplierQuote: SupplierQuote(where: { jobId: { _eq: $jobId }, type: { _eq: "uplift" } }) {\n      status\n      quotationId: id\n      jobId\n      totalDuration\n      totalDurationUnit\n      startDate\n      methodStatement\n      notes\n    }\n  }\n']);return rW=function(){return e},e}function rK(){var e=(0,m.Z)(["\n  mutation InsertSupplierQuoteLineItem($objects: [SupplierQuoteLineItem_insert_input!]!) {\n    insert_SupplierQuoteLineItem(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return rK=function(){return e},e}function rX(){var e=(0,m.Z)(["\n  mutation UpdateSupplierQuoteLineItem($id: Int!, $changes: SupplierQuoteLineItem_set_input) {\n    update_SupplierQuoteLineItem_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return rX=function(){return e},e}function r0(){var e=(0,m.Z)(["\n  mutation DeleteSupplierQuoteLineItem($id: Int!) {\n    delete_SupplierQuoteLineItem_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return r0=function(){return e},e}function r1(){var e=(0,m.Z)(["\n  mutation InsertSupplierQuoteLineItem(\n    $objects: [SupplierQuote_insert_input!]!\n    $objectJobTiming: [JobTiming_insert_input!]!\n  ) {\n    insert_SupplierQuote(objects: $objects) {\n      returning {\n        id\n        status\n      }\n    }\n    insert_JobTiming(objects: $objectJobTiming) {\n      returning {\n        id\n        status\n        notes\n        createdAt\n      }\n    }\n  }\n"]);return r1=function(){return e},e}(0,f.Ps)(rY());var r2=(0,f.Ps)(rG()),r4=(0,f.Ps)(rW()),r3=(0,f.Ps)(rK()),r6=(0,f.Ps)(rX()),r5=(0,f.Ps)(r0()),r7=(0,f.Ps)(r1()),r9=t(11587),r8=t(49432),oe=function(e){var n,t,o=e.editMode,a=e.onSuccess,s=e.rawData,u=e.quotationId,l=(e.setQuote,e.supplierId),c=e.type,d=e.toggleShow,p=e.jobId,m=e.refetchView,f=(0,nv.x)(),v=f.hasRole,h=f.user,b=(0,er.cI)({defaultValues:{description:o?s.description:"",qty:o?s.qty:"",qtyUnit:o?s.qtyUnit:"hours",unitRate:o?s.unitRate:"",item:o?s.item:"",total:o?s.total:null},resolver:(0,eo.S)((n=c,(0,el.Ry)().shape({qty:(0,el.Rx)().required(),unitRate:(0,el.Rx)().required(),qtyUnit:"Labour"===n&&(0,el.Z_)().oneOf(["hours","days"]).required()})))}),g=b.control,x=b.errors,j=b.handleSubmit,y=b.register,Z=b.watch,I={control:g,errors:x,register:y},S=Z("qty"),w=Z("unitRate"),C=Z("total"),R=(0,_.Z)((0,P.D)(r3,{onCompleted:function(e){var n=e.insert_SupplierQuoteLineItem.returning[0].id;a&&a(n)}}),2),A=R[0],E=R[1].loading,D=(0,_.Z)((0,P.D)(r7),2),k=D[0],$=D[1].loadingInsert,H=(0,_.Z)((0,P.D)(r6,{onCompleted:function(e){var n=e.update_SupplierQuoteLineItem_by_pk.id;a&&a(n)}}),2),M=H[0],O=H[1].loadingUpdate,N=(t=(0,q.Z)(function(e){var n,t,r,a;return(0,T.__generator)(this,function(r){switch(r.label){case 0:if(e.total=Number(e.total),!o)return[3,2];return e.supplierTotal=e.qty*e.unitRate,[4,M({variables:{id:null==s?void 0:s.id,changes:e}})];case 1:case 3:return r.sent(),[3,8];case 2:if(e.accountId=Number(l),e.type=c,e.quoteId=Number(u),e.supplierTotal=e.qty*e.unitRate,!u)return[3,4];return[4,A({variables:{objects:[e]}})];case 4:return n={accountId:l,jobId:p,status:"upliftDraft",quoteNumber:"Uplift",type:"uplift"},t={notes:"Create uplift draft with insert line item",status:"upliftDraft",jobId:p,userId:h.id},[4,k({variables:{objects:[n],objectJobTiming:[t]}})];case 5:return[4,r.sent().data.insert_SupplierQuote.returning[0]];case 6:return a=r.sent().id,[4,A({variables:{objects:[(0,ei.Z)((0,i.Z)({},e),{quoteId:a})]}})];case 7:r.sent(),m(),r.label=8;case 8:return[2]}})}),function(e){return t.apply(this,arguments)});return(0,r.jsxs)(ea.Z,{handleSubmit:j(N),children:[(0,r.jsx)(eH.Z,{children:(0,r.jsx)(eM.Z,{md:12,children:(0,r.jsx)(eg.Z,{label:"Description",children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},I),{name:"description",rows:2}))})})}),(0,r.jsxs)(eH.Z,{children:[(0,r.jsx)(eM.Z,{md:4,children:(0,r.jsx)(eg.Z,{label:"Quantity",children:(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},I),{name:"qty",type:"number"}))})}),"Labour"===c&&(0,r.jsx)(eM.Z,{md:4,children:(0,r.jsx)(eg.Z,{label:"Quantity Unit",children:(0,r.jsx)(eD.Z,(0,ei.Z)((0,i.Z)({},I),{name:"qtyUnit",options:[{text:"Hours",value:"hours",disabled:!1},{text:"Days",value:"days",disabled:!1}]}))})}),(0,r.jsx)(eM.Z,{md:4,children:(0,r.jsx)(e4.Z,(0,ei.Z)((0,i.Z)({},I),{label:v("supplier")?"Unit Rate":"Supplier Unit Rate",name:"unitRate",vat:"Ex VAT"}))})]}),(0,r.jsxs)(ey.Z,{children:["Supplier Total: ",(0,ee.Z)(S*w)]}),(0,r.jsx)(t1.Z,{}),v("admin")&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eH.Z,{children:(0,r.jsx)(eM.Z,{md:12,children:(0,r.jsx)(e4.Z,(0,ei.Z)((0,i.Z)({},I),{label:"Customer Unit Rate",name:"total",vat:"Ex VAT"}))})}),(0,r.jsxs)(ey.Z,{children:["Customer Total (Labour Item): ",(0,ee.Z)(S*C)]}),(0,r.jsx)(t1.Z,{})]}),(0,r.jsxs)(eH.Z,{justify:"end",style:{margin:"0 5px"},children:[(0,r.jsx)(ej.Z,{content:"Cancel",onClick:d,style:{margin:"0 5px"}}),(0,r.jsx)(ej.Z,{content:o?"Save":"Add",disabled:E||O||$,type:"submit"})]}),(0,r.jsx)("div",{style:{clear:"both"}})]})};function on(){var e=(0,m.Z)(["\n  margin: 0 5px;\n"]);return on=function(){return e},e}function ot(){var e=(0,m.Z)(["\n  margin: 0;\n"]);return ot=function(){return e},e}oe.propTypes={editMode:A.bool,onSuccess:A.func,rawData:A.object,quotationId:A.number,supplierId:A.number,type:A.string,toggleShow:A.func},oe.defaultProps={rawData:{}};var oi=function(e){var n=e.type,t=e.updateTotal,i=e.quotationId,a=e.jobId,s=e.supplierId,u=e.success,l=e.readOnly,d=e.refetchView,p=(0,o.useContext)(eG.Z).hasRole,m=(0,o.useContext)(U.Z),f=(0,c.a)(r2,{skip:!i,variables:{quotationId:i,type:n}}),v=f.data,h=(void 0===v?{lineItems:[]}:v).lineItems,b=f.loading,g=f.refetch,x=(0,_.Z)((0,P.D)(r5,{onCompleted:function(e){g(),u()}}),1)[0];(0,o.useEffect)(function(){(null==h?void 0:h.length)&&t(h)},[h]);var j=function(){g(),u(),m.close()},y=function(e,t){m.show({content:(0,r.jsx)(oe,{editMode:!!(null==t?void 0:t.rawData),onSuccess:j,rawData:null==t?void 0:t.rawData,toggleShow:m.close,quotationId:i,supplierId:s,type:n,jobId:a,readOnly:l,refetchView:d}),submit:!1,title:"".concat(t?"Edit":"Insert"," ").concat(n," Item")})},Z=function(e,n){x({variables:{id:n.id}})},I=[{text:"ID",hidden:!0},{text:"Description"},{hidden:!p(["admin","supplier","customer"]),text:"Qty"},{hidden:!p(["admin","supplier"]),text:"Supplier Rate"},{hidden:!p(["admin","supplier"]),text:"Supplier Total"},{hidden:!p(["admin","customer"]),text:"Customer Rate"},{hidden:!p(["admin","customer"]),text:"Customer Total"},{hidden:!p(["admin","supplier"])||l,formatter:eW.Z,formatterData:(0,r8.N)("",{onEditClick:y,onDeleteClick:Z}),text:"Actions"},{text:"Raw Data",hidden:!0}],S=h.reduce(function(e,n){return e+n.total*n.qty},0),w=h.reduce(function(e,n){return e+n.supplierTotal},0);return b?(0,r.jsx)(nK.Z,{sx:{zIndex:1e5},open:!0,children:(0,r.jsx)(L.Z,{color:"secondary"})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eX.Z,{content:(0,r.jsxs)(or,{align:"center",justify:"between",children:[(0,r.jsx)("span",{children:n}),p(["admin","supplier"])&&!l&&(0,r.jsx)(ej.Z,{content:"Insert ".concat(n," Item"),context:"secondary",onClick:y,size:"sm"})]}),tag:"h4"}),(0,r.jsx)(e1.Z,{columns:I,rows:h.map(function(e){return{id:e.id,description:e.description,qty:"Labour"===e.type?"".concat(e.qty," ").concat(e.qtyUnit):e.qty,rate:(0,ee.Z)(e.unitRate),supplierTotal:(0,ee.Z)(e.supplierTotal),customerRate:e.total,total:(0,ee.Z)(e.total*e.qty),action:"",rawData:e}})}),(0,r.jsxs)("div",{style:{textAlign:"right"},children:[p(["admin","supplier"])&&(0,r.jsxs)(oo,{children:["Subtotal - ",n," ",p(["admin"])&&"- Supplier",": ",(0,ee.Z)(w)]}),p(["admin","customer"])&&(0,r.jsxs)(oo,{children:["Subtotal - ",n,": ",(0,ee.Z)(S)]})]})]})},or=(0,no.ZP)(eH.Z).attrs(function(){return{align:"center",justify:"between"}}).withConfig({displayName:"lineItemTable__StyledRow",componentId:"sc-47870a73-0"})(on()),oo=no.ZP.p.withConfig({displayName:"lineItemTable__StyledP",componentId:"sc-47870a73-1"})(ot());oi.propTypes={success:A.func.isRequired,supplierId:A.number.isRequired,type:A.string,updateTotal:A.func.isRequired,readOnly:A.bool};var oa=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0;return e.reduce(function(e,t){return"total"===n?e+=t[n]*t.qty:e+=t[n]},0)},os=function(e){var n=e.quotationId,t=e.jobId,a=e.supplierId,s=e.success,u=e.readOnly,l=e.refetchView,c=e.total,d=e.setTotal,p=(e.supplierTotal,e.setSupplierTotal),m=(e.customerTotal,e.setCustomerTotal),f=(0,o.useContext)(eG.Z).hasRole,v=function(e,n){return d(function(t){return(0,ei.Z)((0,i.Z)({},t),(0,em.Z)({},e,oa(n,"total")))})},h=function(e,n){return p(function(t){return(0,ei.Z)((0,i.Z)({},t),(0,em.Z)({},e,oa(n,"supplierTotal")))})},b=function(e,n){return m(function(t){return(0,ei.Z)((0,i.Z)({},t),(0,em.Z)({},e,oa(n,"total")))})},g=c.labour+c.materials,x=.2*g;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eH.Z,{children:(0,r.jsx)(eM.Z,{md:12,children:(0,r.jsx)(oi,{jobId:t,quotationId:n,readOnly:u,success:s,supplierId:a,type:"Labour",updateTotal:function(e){v("labour",e),h("labour",e),b("labour",e)},refetchView:l})})}),(0,r.jsx)(t1.Z,{}),(0,r.jsx)(eH.Z,{children:(0,r.jsx)(eM.Z,{md:12,children:(0,r.jsx)(oi,{jobId:t,quotationId:n,readOnly:u,success:s,supplierId:a,type:"Materials",updateTotal:function(e){v("materials",e),h("materials",e),b("materials",e)},refetchView:l})})}),(0,r.jsx)(t1.Z,{}),f(["admin","customer"])&&(0,r.jsx)(eH.Z,{children:(0,r.jsxs)(eM.Z,{md:12,style:{textAlign:"right"},children:[(0,r.jsxs)("div",{children:["Sub Total: ",(0,ee.Z)(g)]}),(0,r.jsxs)("div",{children:["VAT (20%): ",(0,ee.Z)(x)]}),(0,r.jsxs)("div",{children:["Total: ",(0,ee.Z)(g+x)]})]})})]})},ou=(0,el.Ry)().shape({notes:(0,el.Z_)()}),ol=t(31312),oc=function(e){var n,t,a,s,u=e.jobId,d=e.onSuccess,p=e.supplierId,m=e.readOnly,f=e.refetchView,v=(0,o.useContext)(U.Z),h=(0,D.x)(),b=(0,nv.x)(),g=b.hasRole,x=b.user,j=(0,o.useState)(),y=j[0],Z=j[1],I=(0,o.useState)(),S=I[0],w=I[1],C=(0,o.useState)({text:"-",context:"info"}),R=C[0],A=C[1],E=(0,o.useState)({labour:0,materials:0}),k=E[0],$=E[1],H=(0,o.useState)({labour:0,materials:0}),M=H[0],O=H[1],N=(0,o.useState)({labour:0,materials:0}),F=N[0],J=N[1],L=(0,_.Z)((0,P.D)(rB,{skip:m,onCompleted:(n=(0,q.Z)(function(e){var n,t,i;return(0,T.__generator)(this,function(r){switch(r.label){case 0:if(!u)return[3,2];return[4,(0,eT.F)(h,u)];case 1:r.sent(),r.label=2;case 2:return t=(n=e.update_SupplierQuote_by_pk).id,i=n.status,d&&d({id:t,status:i}),v.close(),[2]}})}),function(e){return n.apply(this,arguments)})}),1)[0],V=(0,_.Z)((0,P.D)(r7,{skip:m,onCompleted:(t=(0,q.Z)(function(e){var n,t,i;return(0,T.__generator)(this,function(r){switch(r.label){case 0:if(!u)return[3,2];return[4,(0,eT.F)(h,u)];case 1:r.sent(),r.label=2;case 2:return t=(n=e.insert_SupplierQuote.returning[0]).id,i=n.status,d&&d({id:t,status:i}),v.close(),[2]}})}),function(e){return t.apply(this,arguments)})}),1)[0],Q=(0,c.a)(r4,{variables:{jobId:u},onCompleted:(a=(0,q.Z)(function(e){var n;return(0,T.__generator)(this,function(t){switch(t.label){case 0:if(!u)return[3,2];return[4,(0,eT.F)(h,u)];case 1:t.sent(),t.label=2;case 2:return Z(null===(n=e.SupplierQuote[0])||void 0===n?void 0:n.quotationId),w(e.SupplierQuote[0]),[2]}})}),function(e){return a.apply(this,arguments)})}).refetch,z=(0,er.cI)({resolver:(0,eo.S)(ou)}),Y=z.handleSubmit,B=z.setValue;(0,o.useEffect)(function(){B("totalDuration",null==S?void 0:S.totalDuration),B("totalDurationUnit",null==S?void 0:S.totalDurationUnit),B("methodStatement",null==S?void 0:S.methodStatement),S&&A(ol.AK.find(function(e){return e.value===(null==S?void 0:S.status)}))},[S]);var G=(s=(0,q.Z)(function(e){var n,t,r,o;return(0,T.__generator)(this,function(a){switch(a.label){case 0:if(e.status=g("supplier")?"supplierUpliftRequested":"upliftRequestSendCustomer",n={jobId:u,userId:x.id,notes:"Supplier Uplift requested ",status:"supplierUpliftRequested",meta:{total:M.labour+M.materials}},t={jobId:u,userId:x.id,notes:"Uplift requested sent customer ",status:"upliftRequestSendCustomer",meta:{total:(k.labour+k.materials)*1.2}},r=g("supplier")?[n]:(null==S?void 0:S.status)==="supplierUpliftRequested"?[t]:(0,l.Z)([n]).concat((0,l.Z)([t])),!y)return[3,2];return[4,L({variables:{id:y,changes:e,objectJobTiming:r}})];case 1:return a.sent(),[3,4];case 2:return o=(0,ei.Z)((0,i.Z)({},e),{accountId:p,jobId:u,quoteNumber:"Uplift",type:"uplift"}),[4,V({variables:{objects:[o],objectJobTiming:r}})];case 3:a.sent(),a.label=4;case 4:return[2]}})}),function(e){return s.apply(this,arguments)}),W=function(){v.close(),f()};return(0,r.jsxs)(ea.Z,{handleSubmit:Y(G),children:[(0,r.jsxs)(eH.Z,{children:[(0,r.jsx)(eM.Z,{md:12,children:(0,r.jsx)(ev.Z,{content:"This is the total amount to be paid for the job and includes any time spent on the job thus far.",context:"info"})}),(0,r.jsxs)(eM.Z,{md:12,children:["Status: ",(0,r.jsx)(r9.Z,{content:null==R?void 0:R.text,size:"md",context:null==R?void 0:R.context})]})]}),(0,r.jsx)(t1.Z,{}),(0,r.jsx)(os,{quotationId:y,jobId:u,supplierId:p,success:Q,readOnly:m,refetchView:f,total:k,setTotal:$,supplierTotal:M,setSupplierTotal:O,customerTotal:F,setCustomerTotal:J}),(0,r.jsx)(eH.Z,{justify:"end",style:{margin:"0 5px"},children:(0,r.jsxs)(eK.Z,{children:[g(["admin","supplier"])&&!m&&(0,r.jsx)(ej.Z,{content:"Cancel",context:"danger",onClick:W,type:"button",size:"sm"}),g(["admin","supplier"])&&!m&&(0,r.jsx)(ej.Z,{content:"Submit ".concat(g(["admin"])?"(send to customer)":""),type:"submit",size:"sm"})]})}),(0,r.jsx)("div",{style:{clear:"both"}})]})};oc.propTypes={jobId:A.number,onSuccess:A.func,supplierId:A.number,readOnly:A.bool,refetchView:A.func},oc.defaultProps={readOnly:!1};var od,op=function(e){var n=e.jobId,t=e.onSuccess,i=e.readOnly,o=e.supplierId,a=e.refetch;return(0,r.jsx)(oc,{jobId:n,onSuccess:t,supplierId:o,readOnly:i,refetchView:a})},om=function(e){var n,t,a,s=e.job,l=e.refetch,c=e.status,d=e.toggleShow,m=(0,o.useContext)(u.Z).user,f=null===(n=s.quotations.find(function(e){return"uplift"===e.type}))||void 0===n?void 0:n.lineItems,v="customerUpliftApproved"===c,h=null==s?void 0:s.financeLogs,b=(0,er.cI)({defaultValues:{comments:""}}),g=b.errors,x=b.handleSubmit,j=b.register,y=(0,_.Z)((0,P.D)(p.wU,{onCompleted:function(){l&&l(),d()}}),1)[0],Z=f.reduce(function(e,n){return e+n.total*n.qty},0),I=f.filter(function(e){return"Materials"===e.type}).reduce(function(e,n){return e+n.supplierTotal},0),S=f.filter(function(e){return"Labour"===e.type}).reduce(function(e,n){return e+n.supplierTotal},0),w=(t=(0,q.Z)(function(){var e,n;return(0,T.__generator)(this,function(t){return e={jobId:s.id,meta:{username:"".concat(m.nameFirst," ").concat(m.nameLast),userId:m.id}},(n=[]).push((0,ei.Z)((0,i.Z)({},e),{type:"supplierLabourAmount",value:S,difference:S-e9("supplierLabourAmount",h)})),n.push((0,ei.Z)((0,i.Z)({},e),{type:"supplierMaterialsAmount",value:I,difference:I-e9("supplierMaterialsAmount",h)})),n.push((0,ei.Z)((0,i.Z)({},e),{type:"amount",value:Z,difference:Z-e9("amount",h)})),[2,n]})}),function(){return t.apply(this,arguments)}),C=(a=(0,q.Z)(function(e){var n,t;return(0,T.__generator)(this,function(i){switch(i.label){case 0:if(n={notes:e.comments,status:c,jobId:s.id,userId:m.id},!(t=v))return[3,2];return[4,w()];case 1:t=i.sent(),i.label=2;case 2:return y({variables:{financeLog:t,hasFinanceLog:v,jobChange:{pricing:"fixed"},jobId:s.id,timing:[n]}}),[2]}})}),function(e){return a.apply(this,arguments)});return(0,r.jsx)(ea.Z,{id:"offCanvasForm",handleSubmit:x(C),children:(0,r.jsx)(eg.Z,{label:"Comments",children:(0,r.jsx)(e_.Z,{errors:g,name:"comments",register:j,rows:3})})})};om.propTypes={job:A.object.isRequired,refetch:A.func.isRequired,status:A.string.isRequired,toggleShow:A.func.isRequired};var of,ov,oh=(od=(0,q.Z)(function(e,n,t){var i,o,a=arguments;return(0,T.__generator)(this,function(s){return i=a.length>3&&void 0!==a[3]&&a[3],o=function(){n.close(),t()},n.show({content:(0,r.jsx)(op,{jobId:e.id,onSuccess:o,readOnly:i,supplierId:e.supplier.id,refetch:t}),submit:!1,title:"".concat(i?"Uplift details":"Uplift request"),width:"50%"}),[2]})}),function(e,n,t){return od.apply(this,arguments)}),ob=(of=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(om,{job:e,refetch:t,status:"customerUpliftApproved",toggleShow:n.show}),title:"Approve uplift"}),[2]})}),function(e,n,t){return of.apply(this,arguments)}),og=(ov=(0,q.Z)(function(e,n,t){return(0,T.__generator)(this,function(i){return n.show({content:(0,r.jsx)(om,{job:e,refetch:t,status:"customerUpliftRejected",toggleShow:n.show}),title:"Reject uplift"}),[2]})}),function(e,n,t){return ov.apply(this,arguments)}),ox=function(e){var n,t=e.job,i=e.offCanvas,a=e.refetch,s=(0,o.useContext)(u.Z).user,l=(0,er.cI)({defaultValues:{comments:""}}),c=l.errors,d=l.handleSubmit,p=l.register,m=(0,_.Z)((0,P.D)(R,{onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){return a&&a(),i&&i.close(),[2]})})}),1)[0],f=(n=(0,q.Z)(function(e){var n;return(0,T.__generator)(this,function(i){return n=(0,tE.e)(t,["onHold","closed"]),m({variables:{id:t.id,changes:{status:null==n?void 0:n.status},_delete_key:{statusData:"closed"},deleteTiming:{jobId:{_eq:t.id},status:{_eq:"closed"}},insertTiming:{notes:e.comments,status:"reopened",jobId:t.id,userId:s.id}}}),[2]})}),function(e){return n.apply(this,arguments)});return(0,r.jsxs)(ea.Z,{handleSubmit:d(f),children:[(0,r.jsx)(eg.Z,{label:"Comments",children:(0,r.jsx)(e_.Z,{errors:c,name:"comments",register:p,rows:3})}),(0,r.jsx)(es.H,{content:"Submit",type:"submit"})]})};ox.propTypes={job:A.object.isRequired,offCanvas:A.object.isRequired,refetch:A.func.isRequired},ox.defaultProps={job:{},offCanvas:{},refetch:function(){}};var oj=function(e){var n=e.job,t=e.offCanvas,i=e.refetch;t.show({content:(0,r.jsx)(ox,{job:n,offCanvas:t,refetch:i}),submit:!1,title:"Reopen job"})};function oy(){var e=(0,m.Z)(["\n  mutation AcceptCustomerIssue($jobId: Int!, $notes: String) {\n    acceptCustomerIssue(jobId: $jobId, notes: $notes) {\n      data\n      success\n    }\n  }\n"]);return oy=function(){return e},e}var oZ=(0,f.Ps)(oy()),oI=nI.Z,oS=function(e){var n,t=e.jobId,i=e.refetch,o=e.close,a=(0,nX.D)(),s=(0,er.cI)({defaultValues:{notes:""}}),u=s.control,l=s.errors,c=s.handleSubmit,d=(0,_.Z)((0,P.D)(oZ,{onError:function(e){a.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){i(),o()}}),1)[0],p=(n=(0,q.Z)(function(e){return(0,T.__generator)(this,function(n){switch(n.label){case 0:return[4,d({variables:{jobId:t,notes:e.notes}})];case 1:return n.sent(),[2]}})}),function(e){return n.apply(this,arguments)});return(0,r.jsx)("form",{id:"offCanvasForm",onSubmit:c(p),children:(0,r.jsx)(er.Qr,{control:u,name:"notes",render:function(e){var n,t=e.value,i=e.onChange;return(0,r.jsx)(oI,{fullWidth:!0,multiline:!0,minRows:6,variant:"filled",color:"secondary",label:"Please insert any relevant information for this approval.",value:t,onChange:i,error:l.notes,helperText:null===(n=l.notes)||void 0===n?void 0:n.message})}})})};oS.defaultProps={refetch:function(){},close:function(){}},oS.propTypes={jobId:E().number.isRequired,refetch:E().func,close:E().func};var ow,oC=(ow=(0,q.Z)(function(e){var n,t;return(0,T.__generator)(this,function(i){return n=e.jobId,(t=e.offCanvas).show({content:(0,r.jsx)(oS,{jobId:n,close:t.close}),submit:!0,title:"Issue approval"}),[2]})}),function(e){return ow.apply(this,arguments)}),oR=O.Z,oq=function(e){var n,t=e.timings,i=(void 0===t?[]:t).find(function(e){return"reportSentSupplier"===e.status});return i&&"Report Sent by ".concat((null==i?void 0:null===(n=i.user)||void 0===n?void 0:n.fullName)||"")},o_=function(e){var n,t=e.timings,i=void 0===t?[]:t,r=null==i?void 0:i.find(function(e){return"invoiceSent"===e.status});return r&&"Invoice sent by ".concat((null==r?void 0:null===(n=r.user)||void 0===n?void 0:n.fullName)||"")},oT=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,t=null==e?void 0:e.reduce(function(e,t){return"total"===n?e+=t[n]*t.qty:e+=t[n]},0);return isNaN(t)?null:t},oA=function(e){var n,t,i,o,a,s,u,l,c,d,p,m,f,v,h,b,g,x=e.addJobTiming,j=e.deleteJobTiming,y=e.job,Z=e.offCanvas,I=e.offCanvasNew,S=e.updateJob,w=e.refetch,C=e.hasRole,R=e.user,q=(0,D.x)(),_=null;C(["admin","superadmin"])&&R.accountId&&(_=R.accountId);var T=null==R?void 0:R.invoiceThreshold,A=null==y?void 0:null===(n=y.quotations)||void 0===n?void 0:n.find(function(e){return"quotationRejected"!==e.status}),E=oT(null==A?void 0:A.lineItems,"total"),P=E+.2*E,k=null==y?void 0:null===(t=y.customerFinances)||void 0===t?void 0:null===(i=t.amountInfo)||void 0===i?void 0:i.vatTotal,$="onHold"===(0,tC.L)(y.timings),H=(0,W.E)(y,"accepted"),M=(0,W.E)(y,"closed"),O="incorrect"===y.timingStatus?y.correctEnd:(0,W.E)(y,"completed"),N=(0,W.E)(y,"complianceRejected"),F=(0,W.E)(y,"complianceApproved"),J=((0,W.E)(y,"complianceRequestedDocumentation"),(0,W.E)(y,"customerPaid")),L="incorrect"===y.timingStatus?y.correctStart:(0,W.E)(y,"inProgress"),U=(0,W.E)(y,"supplierUpliftRequested"),V=(0,W.E)(y,"upliftRequestSendCustomer"),Q=(0,W.E)(y,"customerUpliftApproved"),z=(0,W.E)(y,"customerUpliftRejected"),Y=(0,W.E)(y,"invoiceSent"),B=(0,W.E)(y,"invoiceSentSupplier"),G=(0,W.E)(y,"ppmInvoiceCreated"),K=(0,W.E)(y,"offered"),en=(0,W.E)(y,"pending"),et=(0,W.E)(y,"pricingChanged"),ei=(0,W.E)(y,"quoteAccepted"),er=(0,W.E)(y,"quoteNew"),eo=(0,W.E)(y,"raised"),ea=(0,W.E)(y,"rejected"),es=(0,W.E)(y,"reportSent"),eu=(0,W.E)(y,"reportSentSupplier"),el=(0,W.E)(y,"supplierPaid"),ec=(0,W.E)(y,"timingChanged"),ed=(0,W.E)(y,"unvalidated"),ep=(0,W.E)(y,"validated"),em=null===(o=y.childJobs)||void 0===o?void 0:o.find(function(e){return"quote"===e.type}),ef=(0,W.E)(y,"updateAcceptOfferInput"),ev=(0,W.E)(y,"supplierCancel"),eh=(0,W.E)(y,"expensesPendingAmount"),eb=(0,W.E)(y,"expensesPendingAmountResolved"),eg=y.scheduledAt?(null===(a=y.meta)||void 0===a?void 0:a.arrivalAnytime)?"".concat(X()(y.scheduledAt).format("D MMM YYYY")," (anytime)"):X()(y.scheduledAt).format("D MMM YYYY HH:mm"):X()(ei||H).format("D MMM YYYY HH:mm"),ex=y.supplierOffers.filter(function(e){return"cancelled"!==e.status}).length,ej=(0,eS.Xd)("adminUplift",null==y?void 0:y.timings),ey=(0,eS.nN)("adminUplift",null==y?void 0:y.timings),eZ=(0,eS.OQ)("adminUplift",null==y?void 0:y.timings),eC=(0,eS.Xd)("adminInvoice",null==y?void 0:y.timings),eR=(0,eS.nN)(["adminUplift","adminInvoice"],null==y?void 0:y.timings),eq=(0,eS.OQ)("adminInvoice",null==y?void 0:y.timings),e_=null==y?void 0:null===(s=y.invoices)||void 0===s?void 0:s.filter(function(e){return iS.SR.customer.includes(e.invoiceType)}),eT=null==y?void 0:null===(u=y.invoices)||void 0===u?void 0:u.filter(function(e){return iS.SR.supplier.includes(e.invoiceType)}),eA=(null==e_?void 0:e_.reduce(function(e,n){var t,i,r,o;return e+((null==n?void 0:null===(t=n.reconciledAmount)||void 0===t?void 0:null===(i=t.reconciliations)||void 0===i?void 0:null===(r=i.aggregate)||void 0===r?void 0:null===(o=r.sum)||void 0===o?void 0:o.amount)||0)},0))||null,eD=(null==eT?void 0:eT.reduce(function(e,n){var t,i,r,o;return e+((null==n?void 0:null===(t=n.reconciledAmount)||void 0===t?void 0:null===(i=t.reconciliations)||void 0===i?void 0:null===(r=i.aggregate)||void 0===r?void 0:null===(o=r.sum)||void 0===o?void 0:o.amount)||0)},0))||null,eP=(null==e_?void 0:e_.reduce(function(e,n){var t;return e+((null==n?void 0:null===(t=n.amounts)||void 0===t?void 0:t.vatTotal)||0)},0))||null,ek=(null==eT?void 0:eT.reduce(function(e,n){var t;return e+((null==n?void 0:null===(t=n.amounts)||void 0===t?void 0:t.vatTotal)||0)},0))||null;return"pending"!==y.status&&"closed"!==y.status||eo||er?[{id:1,label:"Job raised",date:(0,W.E)(y,["raised","quoteNew"]),content:[{id:1,active:!0,data:"Created By ".concat((null===(l=null==y?void 0:y.timings[0])||void 0===l?void 0:null===(c=l.user)||void 0===c?void 0:c.fullName)||"")}]},{id:2,label:"Job offered",info:"no assigned suppliers",date:K,content:[{id:1,active:!$&&K&&!L&&!H&&!ec&&!et&&y.supplierOffers&&y.supplierOffers.length>0,data:"Offered to ".concat(ex," suppliers")},{id:2,active:!$&&ea,data:"Job rejected by supplier"}],actions:[{id:1,active:!$&&eo&&!L&&!K&&!y.jobScheduleId,content:"Create Quote",context:"secondary",handleClick:function(){return n7(y,Z,S,x,R)},type:"button"},{id:2,active:!M&&!$&&(0,W.E)(y,["raised","quoteNew"])&&!L&&!H&&!y.supplier,content:"Assign Suppliers",context:"info",data:{"data-cy":"supplierAssign"},handleClick:function(){return n5({jobId:y.id,offCanvas:I,refetch:w,isSingleSupplier:(0,W.E)(y,"quoteNew")})},type:"button"},{id:3,active:!(0,W.E)(y,"quoteAccepted")&&!$&&!L&&y.supplier&&(K||ea),content:"Repost Job",context:"danger",handleClick:function(){return tn({jobId:y.id,offCanvas:I,refetch:w})},type:"button"}]},{id:3,label:"Accepted",info:"waiting for supplier to accept",date:"quote"!==y.type?(0,W.E)(y,"accepted"):(0,W.E)(y,"quoteAccepted"),content:[{id:1,active:(H||ei||ec||et)&&y.supplier,data:"Assigned to ".concat(null===(d=y.supplier)||void 0===d?void 0:d.name)},{id:2,active:(H||ei)&&y.supplierUser,data:"Operative: ".concat(null===(p=y.supplierUser)||void 0===p?void 0:p.fullName)},{id:3,active:H||ei,data:"Arrival time: ".concat(eg)},{id:4,active:ec&&!H&&y.supplier,data:"Job timing has changed, supplier needs to Accept the job again and set new\n          attendance time"},{id:5,active:et&&!H&&y.supplier,data:"Job service or pricing has changed, supplier needs to Accept the job again and\n          confirm attendance and operative"},{id:6,active:ef,data:"Attendance and operative has changed by ".concat((0,ew.j$)(y,"updateAcceptOfferInput"))},{id:7,active:ev,data:"Job canceled by ".concat((0,ew.j$)(y,"supplierCancel"))},{id:8,active:!0,data:function(){var e;return!M&&"offered"===y.status&&(null===(e=y.supplier)||void 0===e?void 0:e.id)&&!H&&(0,r.jsxs)(ie.Z,{size:"small",children:[(0,r.jsx)(oR,{variant:"contained",color:"primary",onClick:function(){var e;return i3({job:y,offCanvas:Z,refetch:w,accountId:null==y?void 0:null===(e=y.supplier)||void 0===e?void 0:e.id})},size:"small",children:"Accept job"}),(0,r.jsx)(oR,{variant:"contained",color:"danger",onClick:function(){var e;return i6({job:y,offCanvas:Z,refetch:w,accountId:null==y?void 0:null===(e=y.supplier)||void 0===e?void 0:e.id})},size:"small",children:"Reject job"})]})}}],actions:[{id:1,active:!M&&!$&&!L&&(H||ec||et)&&y.supplier,content:"Change job timing",context:"danger",handleClick:function(){return n8(y,Z,w)},type:"button"},{id:2,active:!M&&!$&&!L&&(H||ec||et)&&y.supplier,content:"Change job pricing or service",context:"danger",handleClick:function(){return n9(y,Z,w)},type:"button"}]},{id:4,label:"In progress",info:"waiting for supplier to start",date:L,actions:[{id:1,active:!M&&!$&&L&&!(Q||z)&&"reactive"===y.type&&!O,content:"".concat(U?"Edit":"Request"," uplift"),context:"danger",handleClick:function(){return oh(y,Z,w,!1)},type:"button"},{id:2,active:L&&!em,content:"Create remedial quote",context:"success",handleClick:function(){return td({jobId:y.id,customerId:y.customerId,locationId:y.locationId,offCanvas:Z})},type:"button"},{id:3,active:em,content:"Remedial quote Q ".concat(null==em?void 0:em.number),context:"info",handleClick:function(){return tp(null==em?void 0:em.number)},type:"button"}]},{id:5,label:"Uplift requested",info:"waiting for customer",date:L&&(V||U),active:!!(L&&(V||U))&&"reactive"===y.type,content:[{id:1,active:Q,data:"Uplift approved by ".concat((0,ew.j$)(y,"customerUpliftApproved"))},{id:2,active:z,data:"Uplift rejected by ".concat((0,ew.j$)(y,"customerUpliftRejected"))},{id:4,active:U,data:function(){var e=V&&!(Q||z);return(0,r.jsxs)(ie.Z,{size:"small",children:[e&&(0,r.jsx)(oR,{variant:"contained",color:"primary",onClick:function(){return(0,ew.il)(T,P)||ey?ob(y,Z,w):(0,eI.I_)({type:"issue",role:"adminUplift",jobId:y.id,accountId:R.accountId,quotationId:null==A?void 0:A.id,amount:P,offCanvas:Z})},size:"small",children:"Approve"}),(V||U)&&(0,r.jsx)(oR,{variant:"contained",color:"info",onClick:function(){return oh(y,Z,w,!0)},size:"small",children:"Details"}),e&&(0,r.jsx)(oR,{variant:"contained",color:"danger",onClick:function(){(0,ew.il)(T,P)||ey?og(y,Z,w):(0,eI.I_)({type:"issue",role:"adminUplift",jobId:y.id,accountId:R.accountId,quotationId:null==A?void 0:A.id,amount:P,offCanvas:Z})},size:"small",children:"Reject"})]})}}]},{id:6,label:"Threshold approval",info:"",date:(null==ey?void 0:ey.createdAt)||(null==eZ?void 0:eZ.createdAt),active:!!(ej||ey||eZ),content:[{id:1,active:ej&&!ey&&!eZ,data:"Awaiting threshold approval"},{id:2,active:ey,data:"Threshold approved by ".concat(null==ey?void 0:null===(m=ey.user)||void 0===m?void 0:m.fullName)},{id:3,active:eZ,data:"Threshold rejected by ".concat(null==eZ?void 0:null===(f=eZ.user)||void 0===f?void 0:f.fullName)},{id:4,active:!$&&ej&&(0,ew.il)(T,P),data:function(){return(0,r.jsxs)(ie.Z,{size:"small",children:[ej&&!Y&&!ey&&(0,r.jsx)(oR,{variant:"contained",color:"primary",onClick:function(){return(0,eI.i$)({type:"issue",role:"adminUplift",job:y,quoteId:null==A?void 0:A.id,offCanvas:Z,refetch:w})},size:"small",children:"Approve"}),ej&&!Y&&!ey&&!eZ&&(0,r.jsx)(oR,{variant:"contained",color:"danger",onClick:function(){return(0,eI.Ii)({type:"issue",role:"adminUplift",job:y,quoteId:null==A?void 0:A.id,offCanvas:Z,refetch:w})},size:"small",children:"Reject"})]})}}]},{id:7,label:"Complete",info:"waiting for supplier to complete",date:O,content:[{id:1,active:O&&!1,data:(0,r.jsx)(ie.Z,{size:"small",children:(0,r.jsx)(oR,{variant:"contained",color:"info",onClick:function(){var e;return iu({addJobTiming:x,job:y,entityId:null===(e=y.compliance)||void 0===e?void 0:e.id,userId:R.id},Z)},size:"small",children:"Upload compliance Documentation"})})}],actions:[{id:1,active:!$&&O&&!1,content:"Request Documentation",context:"secondary",handleClick:function(){return ip(y,Z,w)},type:"button"},{id:2,active:!$&&O&&!1,content:"No Documentation Required",context:"info",handleClick:function(){return id({job:y,userId:R.id,deleteJobTiming:j})},type:"button"},{id:3,active:null===y.pricing&&!$&&O&&!M,content:"Change job pricing or service",context:"danger",handleClick:function(){return n9(y,Z,w)},type:"button"}]},{id:8,label:"Report sent",info:"after job complete",date:es,content:[{id:1,active:eu,data:"Report submitted by supplier"},{id:2,active:!0,data:oq(y)}],actions:[{id:1,active:y.report&&(eu||es),content:"Download job report",context:"secondary",handleClick:function(){return(0,tN.e)({job:y,adminId:_})},type:"button"},{id:2,active:y.report&&!$&&(eu||es)&&!M,content:y.report?"Update report":"Create report",context:"info",handleClick:function(){return rU(y,Z,w)},type:"button"},{id:3,active:y.report&&!$&&eu&&!es&&!M,content:"Send to customer",context:"primary",handleClick:function(){return rL(y,Z,w)},type:"button"}]},{id:9,label:"Customer Sign Off",info:"",date:!1,active:!1,content:[{id:1,active:F,data:"Compliance sing off by ".concat((0,ew.j$)(y,"complianceApproved"))},{id:2,active:N,data:"Compliance rejected by ".concat((0,ew.j$)(y,"complianceRejected"))},{id:3,active:!$&&!1,data:function(){return(0,r.jsxs)(ie.Z,{size:"small",children:[(0,r.jsx)(oR,{variant:"contained",color:"primary",onClick:function(){return il(y,Z,w)},size:"small",children:"Approve"}),(0,r.jsx)(oR,{variant:"contained",color:"danger",onClick:function(){return ic(y,Z,w)},size:"small",children:"Reject"})]})}}]},{id:10,label:"Threshold approval",info:"",date:(null==eR?void 0:eR.createdAt)||(null==eq?void 0:eq.createdAt),active:!!(eC||eR||eq),content:[{id:1,active:eC&&!eR&&!eq,data:"Awaiting threshold approval"},{id:2,active:eR,data:"Threshold approved by ".concat(null==eR?void 0:null===(v=eR.user)||void 0===v?void 0:v.fullName)},{id:3,active:eq,data:"Threshold rejected by ".concat(null==eq?void 0:null===(h=eq.user)||void 0===h?void 0:h.fullName)},{id:4,active:!$&&eC&&(0,ew.il)(T,k),data:function(){return(0,r.jsxs)(ie.Z,{size:"small",children:[eC&&!ep&&!eR&&(0,r.jsx)(oR,{variant:"contained",color:"primary",onClick:function(){return(0,eI.i$)({type:"issue",role:"adminInvoice",job:y,quoteId:null==A?void 0:A.id,offCanvas:Z,refetch:w})},size:"small",children:"Approve"}),eC&&!ep&&!eR&&!eq&&(0,r.jsx)(oR,{variant:"contained",color:"danger",onClick:function(){return(0,eI.Ii)({type:"issue",role:"adminInvoice",job:y,quoteId:null==A?void 0:A.id,offCanvas:Z,refetch:w})},size:"small",children:"Reject"})]})}}]},{id:11,label:"Awaiting expenses pricing",info:"",date:eb,active:!!(eh||eb)},{id:12,label:"Invoices sent",info:"after validation",date:Y,content:[{id:1,active:ep,data:"Job validated"},{id:2,active:"ppm"!==y.type&&Y,data:"Invoice number ".concat(null==y?void 0:null===(b=y.invoices)||void 0===b?void 0:null===(g=b[0])||void 0===g?void 0:g.invoiceNumber," sent")},{id:3,active:!0,data:o_(y)}],actions:"ppm"===y.type?[{id:1,active:Y,content:"Download customer invoice",context:"secondary",handleClick:function(){return iW("customer",y,I,w,!1,q)},type:"button"},{id:2,active:B,content:"Download supplier invoice",context:"secondary",handleClick:function(){return iW("supplier",y,I,w,!1,q)},type:"button"}]:[{id:1,active:!M&&!$&&ed&&!ep,content:"Change finance",context:"danger",handleClick:function(){return te(y,I,w)},type:"button"},{id:2,active:!M&&!$&&ed&&!ep,content:"Update invoice address",context:"danger",handleClick:function(){return iK(y,I,w)},type:"button"},{id:3,active:!$&&!ep&&es&&(!eh||eb)&&!M,content:"Validate job",context:"info",handleClick:function(){return(0,ew.il)(T,k)||eR?iB(y,x,j,I,w):(0,eI.I_)({type:"issue",role:"adminInvoice",jobId:y.id,accountId:R.accountId,quotationId:null==A?void 0:A.id,amount:k,offCanvas:Z})},type:"button"},{id:5,active:!$&&ep&&!M,content:"Un-Validate job",context:"danger",handleClick:function(){return iG(y,x,j,I,w)},type:"button"},{id:6,active:!$&&!Y&&ep&&!M,content:"Send customer invoice",context:"primary",handleClick:function(){return iW("customer",y,I,w,!0)},type:"button"},{id:7,active:!$&&Y&&!B&&ep&&!M,content:"Send supplier invoice",context:"primary",handleClick:function(){return iW("supplier",y,I,w,!0)},type:"button"},{id:8,active:ep&&Y,content:"Download customer invoice",context:"secondary",handleClick:function(){return iW("customer",y,I,w,!1,q)},type:"button"},{id:9,active:ep&&B,content:"Download supplier invoice",context:"secondary",handleClick:function(){return iW("supplier",y,I,w,!1,q)},type:"button"}]},{id:13,label:"Customer ".concat(J?"paid":eA>0?"partially paid":"not paid"),date:J,active:"quote"!==y.type,actions:[{id:1,active:!M&&!$&&!J&&(Y||G)&&ep,content:"Mark customer paid",context:"info",handleClick:function(){return ii({type:"customer",job:y,offCanvas:I,refetch:w})},type:"button"}],content:[{id:1,active:!J&&eA,data:"Reconciled amount ".concat((0,ee.Z)(eA))},{id:2,active:!J&&eA,data:"Amount outstanding ".concat((0,ee.Z)(eP))}]},{id:14,label:"Supplier ".concat(el?"paid":eD>0?"partially paid":"not paid"),date:el,active:"quote"!==y.type,actions:[{id:1,active:!M&&!$&&!el&&(B||G)&&ep,content:"Mark supplier paid",context:"info",handleClick:function(){return ii({type:"supplier",job:y,offCanvas:I,refetch:w})},type:"button"}],content:[{id:1,active:!el&&eD,data:"Reconciled amount ".concat((0,ee.Z)(eD))},{id:2,active:!el&&eD,data:"Amount outstanding ".concat((0,ee.Z)(ek))}]},{id:15,label:"Closed",info:"automatically after steps complete",date:M,actions:[{id:1,active:!$&&!M,content:"Close job",context:"danger",handleClick:function(){return eE(y,"closed",Z,w)},type:"button"},{id:2,active:!$&&!L&&!M,content:"Close and zero value job",context:"danger",handleClick:function(){return i1(y,Z,w)},type:"button"},{id:3,active:M,content:"Re-open job",context:"danger",handleClick:function(){return oj({job:y,offCanvas:Z,refetch:w})},type:"button"}]}]:[{id:1,label:"Issue Reported",date:en,actions:[{id:1,active:!eo&&!M,content:"Approve job",context:"primary",handleClick:function(){return oC({jobId:y.id,offCanvas:I})},type:"button"}]},{id:2,label:"Closed",date:M,actions:[{id:1,active:!M,content:"Close request",context:"danger",handleClick:function(){return eE(y,"closed",Z,w)},type:"button"}]}]},oE=O.Z,oD=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,t=null==e?void 0:e.reduce(function(e,t){return"total"===n?e+=t[n]*t.qty:e+=t[n]},0);return isNaN(t)?null:t},oP=function(e){var n,t,i,o=e.job,a=e.user,s=e.offCanvas,u=e.offCanvasNew,l=e.refetch,c=(0,tQ.q)().hasUserModule,d=(0,nv.x)().hasRole,p=(0,D.x)(),m=d("customer_user"),f=c("finances"),v=c("jobReports"),h=null==a?void 0:a.invoiceThreshold,b=null==o?void 0:null===(n=o.quotations)||void 0===n?void 0:n.find(function(e){return"quotationRejected"!==e.status}),g=oD(null==b?void 0:b.lineItems,"total"),x=g+.2*g,j=(0,tC.L)(o.timings),y="incorrect"===o.timingStatus?o.correctEnd:(0,W.E)(o,"completed"),Z=((0,W.E)(o,"complianceRejected"),(0,W.E)(o,"complianceApproved")),I=(0,W.E)(o,"inDispute"),S=(0,W.E)(o,"reportSent"),w=(0,W.E)(o,"invoiceSent"),C=((0,W.E)(o,"complianceRequestedDocumentation"),"incorrect"===o.timingStatus?o.correctStart:(0,W.E)(o,"inProgress")),R=(0,W.E)(o,"upliftRequestSendCustomer"),q=(0,W.E)(o,"customerUpliftApproved"),_=(0,W.E)(o,"customerUpliftRejected"),T=(0,W.E)(o,"closed"),A=(0,eS.Xd)("customer",null==o?void 0:o.timings),E=(0,eS.nN)("customer",null==o?void 0:o.timings),P=(0,eS.OQ)("customer",null==o?void 0:o.timings),k=(0,W.E)(o,"raised"),$=(0,W.E)(o,"quoteNew"),H=(0,W.E)(o,"pending"),M=o.timings.find(function(e){return"reportedByNonLoggedUser"===e.status});return"pending"!==o.status&&"closed"!==o.status||k||$||!M?[{id:1,label:"Issue reported",info:"no assigned suppliers",date:(0,W.E)(o,"pending")||(0,W.E)(o,"raised")||(0,W.E)(o,"quoteNew")},{id:2,label:"Job offered",info:"no assigned suppliers",date:(0,W.E)(o,"offered")||(0,W.E)(o,"quoteNew")},{id:3,label:"Accepted",info:"waiting for supplier to accept the job",date:"quote"!==o.type?(0,W.E)(o,"accepted"):(0,W.E)(o,"quoteAccepted")},{id:4,label:"In progress",info:"waiting for supplier to start the job",date:C},{id:44,label:"Uplift requested",info:"waiting for you",date:C&&R,active:!!(C&&R)&&"reactive"===o.type,content:[{id:1,active:q,data:"Uplift approved by ".concat((0,ew.j$)(o,"customerUpliftApproved"))},{id:2,active:_,data:"Uplift rejected by ".concat((0,ew.j$)(o,"customerUpliftRejected"))},{id:4,active:R&&"reactive"===o.type,data:function(){var e=R&&!(q||_);return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(ie.Z,{size:"small",children:[e&&(0,r.jsx)(oE,{variant:"contained",color:"primary",onClick:function(){return(0,ew.il)(h,x)||E?ob(o,s,l):(0,eI.I_)({type:"issue",role:"customer",jobId:null==o?void 0:o.id,accountId:null==a?void 0:a.accountId,quotationId:null==b?void 0:b.id,amount:x,offCanvas:s})},size:"small",children:"Approve"}),R&&(0,r.jsx)(oE,{variant:"contained",color:"info",onClick:function(){return oh(o,s,l,!0)},size:"small",children:"Details"}),e&&(0,r.jsx)(oE,{variant:"contained",color:"danger",onClick:function(){return(0,ew.il)(h,x)||E?og(o,s,l):(0,eI.I_)({type:"issue",role:"customer",jobId:null==o?void 0:o.id,accountId:null==a?void 0:a.accountId,quotationId:null==b?void 0:b.id,amount:x,offCanvas:s})},size:"small",children:"Reject"})]})})}}]},{id:8,label:"Threshold approval",info:"",date:(null==E?void 0:E.createdAt)||(null==P?void 0:P.createdAt),active:!!(A||E||P),content:[{id:1,active:A&&!E&&!P,data:"Awaiting threshold approval"},{id:2,active:E,data:"Threshold approved by ".concat(null==E?void 0:null===(t=E.user)||void 0===t?void 0:t.fullName)},{id:3,active:P,data:"Threshold rejected by ".concat(null==P?void 0:null===(i=P.user)||void 0===i?void 0:i.fullName)},{id:4,active:"onHold"!==j&&A&&(0,ew.il)(h,x),data:function(){return(0,r.jsxs)(ie.Z,{size:"small",children:[A&&!w&&!E&&(0,r.jsx)(oE,{variant:"contained",color:"primary",onClick:function(){return(0,eI.i$)({type:"issue",role:"customer",job:o,quoteId:null==b?void 0:b.id,offCanvas:s,refetch:l})},size:"small",children:"Approve"}),A&&!w&&!E&&!P&&(0,r.jsx)(oE,{variant:"contained",color:"danger",onClick:function(){return(0,eI.Ii)({type:"issue",role:"customer",job:o,quoteId:null==b?void 0:b.id,offCanvas:s,refetch:l})},size:"small",children:"Reject"})]})}}]},{id:5,label:"Complete",info:"waiting for supplier to complete the job",date:y,actions:[{id:1,active:!T&&y&&!I&&(v||!m),content:"Dispute",context:"danger",handleClick:function(){return tM(o,s,l)},type:"button"}],content:[{id:1,active:I&&(v||!m),data:(0,r.jsx)(oE,{variant:"contained",color:"info",onClick:function(){return tD((0,ew.wo)(o,"inDispute"),s)},size:"small",children:"Dispute media"})}]},{id:6,label:"Report sent",info:"waiting for supplier to send report",date:S,actions:[{id:1,active:S&&(v||!m),content:"Download job report",context:"secondary",handleClick:function(){return(0,tN.e)({adminId:o.adminId,job:o})},type:"button"}]},{id:7,label:"Customer Sign Off",info:"",date:!1,active:!1,content:[{id:1,active:Z,data:"Compliance report sang off by ".concat((0,ew.j$)(o,"complianceApproved"))},{id:3,active:!1,data:function(){return(0,r.jsxs)(ie.Z,{size:"small",children:[(0,r.jsx)(oE,{variant:"contained",color:"primary",onClick:function(){return il(o,s,l)},size:"small",children:"Approve"}),(0,r.jsx)(oE,{variant:"contained",color:"danger",onClick:function(){return ic(o,s,l)},size:"small",children:"Reject"})]})}}]},{id:8,label:"Invoice sent",info:"",date:w,actions:[{id:1,active:"ppm"!==o.type&&w&&(f||!m),content:"Download invoice",context:"secondary",handleClick:function(){return iW("customer",o,u,l,!1,p)},type:"button"},{id:2,active:"ppm"===o.type&&w&&(f||!m),content:"Download invoice",context:"secondary",handleClick:function(){return iW("customer",o,u,l,!1,p)},type:"button"}]}]:[{id:1,label:"Issue Reported",date:H,actions:[{id:1,active:!k&&!T,content:"Approve job",context:"primary",handleClick:function(){return oC({jobId:o.id,offCanvas:u})},type:"button"}]},{id:2,label:"Closed",date:T,actions:[{id:1,active:!T,content:"Close request",context:"danger",handleClick:function(){return eE(o,"closed",s,l,{shouldCalculateFinance:!1})},type:"button"}]}]},ok=O.Z,o$=function(e){var n,t,i,o,a,s=e.addJobTiming,u=e.job,l=e.offCanvas,c=e.offCanvasNew,d=e.refetch,p=e.user,m=null==p?void 0:p.invoiceThreshold,f=null==u?void 0:null===(n=u.quotations)||void 0===n?void 0:n.find(function(e){return"quotationRejected"!==e.status}),v=null==f?void 0:null===(t=f.lineItems)||void 0===t?void 0:t.reduce(function(e,n){return e+n.supplierTotal},0),h=(0,D.x)(),b=((0,W.E)(u,"complianceRequestedDocumentation"),"incorrect"===u.timingStatus?u.correctEnd:(0,W.E)(u,"completed")),g="incorrect"===u.timingStatus?u.correctStart:(0,W.E)(u,"inProgress"),x=(0,W.E)(u,"closed"),j=(0,W.E)(u,"accepted"),y=(0,W.E)(u,"supplierUpliftRequested"),Z=(0,W.E)(u,"customerUpliftApproved"),I=(0,W.E)(u,"customerUpliftRejected"),S=(0,W.E)(u,"invoiceSent"),w=(0,W.E)(u,"invoiceSentSupplier"),C=(0,W.E)(u,"upliftRequestSendCustomer"),R=null===(i=u.childJobs)||void 0===i?void 0:i.find(function(e){return"quote"===e.type}),q=(0,eS.Xd)("supplier",null==u?void 0:u.timings),_=(0,eS.nN)("supplier",null==u?void 0:u.timings),T=(0,eS.OQ)("supplier",null==u?void 0:u.timings),A=(0,W.E)(u,"expensesPendingAmount"),E=(0,W.E)(u,"expensesPendingAmountResolved");return[{id:1,label:"Job offered",info:"no assigned suppliers",date:(0,W.E)(u,"offered"),active:"quote"!==u.type&&!(0,W.E)(u,"quoteAccepted")},{id:2,label:"Accepted",info:"need to accept the job",date:"quote"!==u.type?(0,W.E)(u,"accepted"):(0,W.E)(u,"quoteAccepted"),content:[{id:1,active:(0,W.E)(u,"timingChanged")&&!(0,W.E)(u,"accepted")&&u.supplier,data:"Job timing has changed, click Accept to set new attendance time or Reject if you\n          can\n        not make it"},{id:2,active:(0,W.E)(u,"pricingChanged")&&!(0,W.E)(u,"accepted")&&u.supplier,data:"Job service or pricing has changed, click Accept to confirm attendance"},{id:3,active:!0,data:function(){return!x&&"offered"===u.status&&!j&&(0,r.jsxs)(ie.Z,{size:"small",children:[(0,r.jsx)(ok,{variant:"contained",color:"primary",onClick:function(){return i3({job:u,offCanvas:l,refetch:d,accountId:p.accountId})},size:"small",children:"Accept job"}),(0,r.jsx)(ok,{variant:"contained",color:"danger",onClick:function(){return i6({job:u,offCanvas:l,refetch:d,accountId:p.accountId})},size:"small",children:"Reject job"})]})}}]},{id:3,label:"In progress",info:"click the timer to start",date:(0,W.E)(u,"inProgress"),actions:[{id:1,active:!x&&g&&!(Z||I)&&"reactive"===u.type&&!b&&!C,content:"".concat(y?"Edit":"Request"," uplift"),context:"danger",handleClick:function(){return oh(u,l,d,!1)},type:"button"},{id:2,active:g&&!R,content:"Create remedial quote",context:"success",handleClick:function(){return td({jobId:u.id,customerId:u.customerId,locationId:u.locationId,offCanvas:l})},type:"button"},{id:3,active:R,content:"Remedial quote Q ".concat(null==R?void 0:R.number),context:"info",handleClick:function(){return tp(null==R?void 0:R.number)},type:"button"}]},{id:44,label:"Uplift requested",info:"",date:"reactive"===u.type&&g&&y,active:!!(g&&y),content:[{id:1,active:Z,data:"Uplift request approved"},{id:2,active:I,data:"Uplift request rejected"},{id:3,active:y,data:function(){return(0,r.jsx)(ok,{variant:"contained",color:"info",onClick:function(){return oh(u,l,d,!0)},size:"small",children:"Uplift details"})}}]},{id:4,label:"Complete",info:"upload a photo and stop timer",date:b,content:[{id:1,active:!1,data:(0,r.jsx)(ok,{variant:"contained",color:"info",onClick:function(){var e;return iu({addJobTiming:s,job:u,entityId:null===(e=u.compliance)||void 0===e?void 0:e.id,userId:p.id},l)},size:"small",children:"Upload compliance Documentation"})}]},{id:8,label:"Threshold approval",info:"",date:(null==_?void 0:_.createdAt)||(null==T?void 0:T.createdAt),active:!!(q||_||T),content:[{id:1,active:q&&!_&&!T,data:"Awaiting threshold approval"},{id:2,active:_,data:"Threshold approved by ".concat(null==_?void 0:null===(o=_.user)||void 0===o?void 0:o.fullName)},{id:3,active:T,data:"Threshold rejected by ".concat(null==T?void 0:null===(a=T.user)||void 0===a?void 0:a.fullName)},{id:4,active:q&&(0,ew.il)(m,v),data:function(){return(0,r.jsxs)(ie.Z,{size:"small",children:[q&&!_&&(0,r.jsx)(ok,{variant:"contained",color:"primary",onClick:function(){return(0,eI.i$)({type:"issue",role:"supplier",job:u,quoteId:null==f?void 0:f.id,offCanvas:l,refetch:d})},size:"small",children:"Approve"}),q&&!_&&!T&&(0,r.jsx)(ok,{variant:"contained",color:"danger",onClick:function(){return(0,eI.Ii)({type:"issue",role:"supplier",job:u,quoteId:null==f?void 0:f.id,offCanvas:l,refetch:d})},size:"small",children:"Reject"})]})}}]},{id:5,label:"Report sent",info:"after job complete",date:(0,W.E)(u,"reportSentSupplier"),actions:[{id:1,active:(0,W.E)(u,"reportSentSupplier")||S||w,content:"View job report",context:"info",handleClick:function(){return rV(u,l)},type:"button"}]},{id:6,label:"Awaiting expenses pricing",info:"",date:E,active:!!(A||E)},{id:7,label:"Invoice sent",info:"",date:w,actions:[{id:1,active:"ppm"!==u.type&&w,content:"Download invoice",context:"secondary",handleClick:function(){return iW("supplier",u,c,d,!1,h)},type:"button"},{id:2,active:"ppm"===u.type&&w,content:"Download invoice",context:"secondary",handleClick:function(){return iW("supplier",u,c,d,!1,h)},type:"button"}]}]},oH=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,t=null==e?void 0:e.reduce(function(e,t){return"total"===n?e+=t[n]*t.qty:e+=t[n]},0);return isNaN(t)?null:t},oM=function(e){var n,t,i,o,a=e.job,s=e.user,u=e.offCanvas,l=e.refetch,c=e.hasUserModule,d=null==s?void 0:s.invoiceThreshold,p=null==a?void 0:null===(n=a.quotations)||void 0===n?void 0:n.find(function(e){return"quotationRejected"!==e.status}),m=oH(null==p?void 0:p.lineItems,"total"),f=(0,tC.L)(a.timings),v="incorrect"===a.timingStatus?a.correctEnd:(0,W.E)(a,"completed"),h=((0,W.E)(a,"complianceRejected"),(0,W.E)(a,"complianceApproved")),b=(0,W.E)(a,"inDispute"),g=(0,W.E)(a,"reportSent"),x=(0,W.E)(a,"invoiceSent"),j=((0,W.E)(a,"complianceRequestedDocumentation"),"incorrect"===a.timingStatus?a.correctStart:(0,W.E)(a,"inProgress")),y=(0,W.E)(a,"upliftRequestSendCustomer"),Z=(0,W.E)(a,"customerUpliftApproved"),I=(0,W.E)(a,"customerUpliftRejected"),S=(0,W.E)(a,"closed"),w=(0,eS.Xd)("customer",null==a?void 0:a.timings),C=(0,eS.nN)("customer",null==a?void 0:a.timings),R=(0,eS.OQ)("customer",null==a?void 0:a.timings);return[{id:1,label:"Issue reported",info:"no assigned suppliers",date:(0,W.E)(a,"pending")||(0,W.E)(a,"raised")||(0,W.E)(a,"quoteNew")},{id:2,label:"Job offered",info:"no assigned suppliers",date:(0,W.E)(a,"offered")||(0,W.E)(a,"quoteNew")},{id:3,label:"Accepted",info:"waiting for supplier to accept the job",date:"quote"!==a.type?(0,W.E)(a,"accepted"):(0,W.E)(a,"quoteAccepted")},{id:4,label:"In progress",info:"waiting for supplier to start the job",date:j},{id:44,label:"Uplift requested",info:"waiting for you",date:j&&y,active:!!(j&&y)&&"reactive"===a.type,content:[{id:1,active:Z,data:"Uplift approved by ".concat((0,ew.j$)(a,"customerUpliftApproved"))},{id:2,active:I,data:"Uplift rejected by ".concat((0,ew.j$)(a,"customerUpliftRejected"))},{id:4,active:y&&"reactive"===a.type,data:"Uplift requested by ".concat((0,ew.j$)(a,"upliftRequestSendCustomer"))}]},{id:8,label:"Threshold approval",info:"",date:(null==C?void 0:C.createdAt)||(null==R?void 0:R.createdAt),active:!!(w||C||R),content:[{id:1,active:w&&!C&&!R,data:"Awaiting threshold approval"},{id:2,active:C,data:"Threshold approved by ".concat(null==C?void 0:null===(t=C.user)||void 0===t?void 0:t.fullName)},{id:3,active:R,data:"Threshold rejected by ".concat(null==R?void 0:null===(i=R.user)||void 0===i?void 0:i.fullName)},{id:4,active:"onHold"!==f&&w&&(0,ew.il)(d,m+.2*m),data:"Threshold requested by ".concat(null==w?void 0:null===(o=w.user)||void 0===o?void 0:o.fullName)}]},{id:5,label:"Complete",info:"waiting for supplier to complete the job",date:v,actions:[{id:1,active:!S&&v&&!b,content:"Dispute",context:"danger",handleClick:function(){return tM(a,u,l)},type:"button"}],content:[{id:1,active:b,data:(0,r.jsx)(O.Z,{variant:"contained",color:"info",onClick:function(){return tD((0,ew.wo)(a,"inDispute"),u)},size:"small",children:"Dispute media"})}]},{id:6,label:"Report sent",info:"waiting for supplier to send report",date:g,actions:c("jobReports")?[{id:1,active:g,content:"Download job report",context:"secondary",handleClick:function(){return(0,tN.e)({adminId:a.adminId,job:a})},type:"button"}]:[]},{id:7,label:"Customer Sign Off",info:"",date:!1,active:!1,content:[{id:1,active:h,data:"Compliance report sang off by ".concat((0,ew.j$)(a,"complianceApproved"))},{id:3,active:!1,data:"Compliance report sang off by ".concat((0,ew.j$)(a,"complianceRequestedDocumentation"))}]},{id:8,label:"Invoice sent",info:"",date:x}]},oO=function(e,n,t,i,r,o,a,s,u,l){var c;return t("admin")?c=oA({addJobTiming:e,deleteJobTiming:n,job:i,offCanvas:r,offCanvasNew:o,updateJob:a,refetch:s,hasRole:t,user:u}):t("supplier")?c=o$({addJobTiming:e,job:i,offCanvas:r,offCanvasNew:o,refetch:s,user:u}):t("customer")?c=oP({job:i,user:u,offCanvas:r,offCanvasNew:o,refetch:s}):t("tenant")&&(c=oM({addJobTiming:e,job:i,offCanvas:r,offCanvasNew:o,refetch:s,user:u,hasUserModule:l})),c.forEach(function(e){e.date&&(e.date=X()(e.date).format("D MMM YYYY HH:mm"))}),c},oN=function(e){var n,t=[],i=(null===(n=e.meta)||void 0===n?void 0:n.arrivalAnytime)?"".concat(X()(e.scheduledAt).format("D MMM YYYY")," (anytime)"):X()(e.scheduledAt).format("D MMM YYYY HH:mm");return t.push({label:"Scheduled start:",value:e.timingStart?X()(e.timingStart).format("D MMM YYYY HH:mm"):""}),e.timingEnd&&t.push({label:"Scheduled end:",value:e.timingEnd?X()(e.timingEnd).format("D MMM YYYY HH:mm"):""}),t.push({label:"Supplier arrival:",value:i}),t};function oF(){var e=(0,m.Z)(['\n  mutation UpdateSupplierOffer(\n    $jobId: Int!\n    $jobChanges: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n  ) {\n    delete_JobTiming(where: { jobId: { _eq: $jobId }, status: { _in: ["accepted", "offered"] } }) {\n      returning {\n        jobId\n      }\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n\n    update_SupplierOffer(where: { jobId: { _eq: $jobId } }, _set: { status: "cancelled" }) {\n      returning {\n        id\n      }\n    }\n\n    update_Job_by_pk(pk_columns: { id: $jobId }, _set: $jobChanges) {\n      id\n    }\n  }\n']);return oF=function(){return e},e}var oJ=(0,f.Ps)(oF()),oL=function(e){var n=e.job,t=e.refetch,i=e.offCanvas,o=(0,nv.x)().user,a=(0,_.Z)((0,P.D)(oJ,{onCompleted:function(){i.close(),t()}}),1)[0],s=function(){var e;a({variables:{jobId:n.id,jobChanges:{scheduledAt:null,status:"raised",supplierId:null,supplierUserId:null},timing:[{status:"supplierCancel",jobId:n.id,userId:o.id,notes:null,meta:{supplierId:null===(e=n.supplier)||void 0===e?void 0:e.id}}]}})};return(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(nx.Z,{color:"info",severity:"info",variant:"filled",children:"Please confirm that you want to revert this job to a raised status."}),(0,r.jsxs)(F.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,mt:2,children:[(0,r.jsx)(O.Z,{color:"danger",variant:"contained",onClick:function(){return i.close()},children:"Cancel"}),(0,r.jsx)(O.Z,{color:"secondary",variant:"contained",onClick:s,children:"Confirm"})]})]})},oU=t(21813),oV=z.Z,oQ=Y.Z,oz=B.Z,oY=G.Z,oB=N.ZP,oG=function(e){var n,t,i,a,u,l,c,d,m,f,h=e.job,b=e.refetch,g=(0,tQ.q)(),x=(0,D.x)(),j=null===(n=g.admin)||void 0===n?void 0:null===(t=n.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,y=null===(i=g.admin)||void 0===i?void 0:null===(a=i.jobSetting)||void 0===a?void 0:a.jobNumberSuffix,Z=(0,o.useContext)(U.Z),I=(0,e8.a)(),S=(0,nv.x)(),w=S.user,C=S.hasRole,R=C("admin"),A=(0,tC.L)(h.timings),E="onHold"===A,N=(0,W.E)(h,"quoteOffered"),z=(0,W.E)(h,"accepted"),Y="incorrect"===h.timingStatus?h.correctEnd:(0,W.E)(h,"completed"),B="incorrect"===h.timingStatus?h.correctStart:(0,W.E)(h,"inProgress"),G=(0,W.E)(h,"disputeResolved"),K=(0,W.E)(h,"inDispute"),X=(0,W.E)(h,"reportSent"),ee=(0,W.E)(h,"quoteClosed"),en=(0,W.E)(h,"closed"),et=(0,_.Z)((0,P.D)(p.qD,{refetchQueries:["GetJob"],onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!h)return[3,2];return[4,(0,eT.F)(x,h.id)];case 1:e.sent(),e.label=2;case 2:return[2]}})})}),1)[0],ei=(0,_.Z)((0,P.D)(ef.j6,{refetchQueries:["GetJob"],onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!h)return[3,2];return[4,(0,eT.F)(x,h.id)];case 1:e.sent(),e.label=2;case 2:return[2]}})})}),1)[0],er=(0,_.Z)((0,P.D)(p.r2,{refetchQueries:["GetJob"],onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!h)return[3,2];return[4,(0,eT.F)(x,h.id)];case 1:e.sent(),e.label=2;case 2:return[2]}})})}),1)[0],eo=(0,_.Z)((0,P.D)(v.xY,{refetchQueries:["GetJob"]}),2),ea=eo[0],es=eo[1].loading,eu=(0,_.Z)((0,P.D)(p.k7,{refetchQueries:["GetJob"],onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!h)return[3,2];return[4,(0,eT.F)(x,h.id)];case 1:e.sent(),e.label=2;case 2:return[2]}})})}),1)[0],el="quote"===h.type?tg(h):oN(h),ec=function(){s().push("quote"===h.type?"/dashboard/issues/manage?id=".concat(h.number,"&quoted=1"):"/dashboard/issues/manage?id=".concat(h.number))},ed=function(){Z.show({content:(0,r.jsx)(tY,{job:h,toggleShow:Z.show}),submit:!1,title:"Put the job on hold"})},ep=function(){var e;ea({variables:{id:h.id,changes:{status:null===(e=(0,tE.e)(h,"onHold"))||void 0===e?void 0:e.status},timing:{status:"resumed",jobId:h.id,userId:w.id}}})},em=function(){Z.show({content:(0,r.jsx)(t9,{job:h,refetch:b,offCanvas:Z}),submit:!1,title:"Cancel"})},ev=function(){Z.show({content:(0,r.jsx)(oL,{job:h,refetch:b,offCanvas:Z}),submit:!1,title:"Revert"})},eh=(0,o.useCallback)(function(){I.show({content:(0,r.jsx)(oU.h,{jobId:h.id,completed:!!Y,close:I.close}),title:"Roll back"})},[I,h.id,Y]),eb=(C("admin")||C("supplier")&&!!(z||N))&&"paused"!==A&&!E&&"quote"!==h.type,eg=(C("admin")||C("supplier")&&!!(z||N))&&E&&"quote"!==h.type;return(0,r.jsxs)(M.Z,{children:[(0,r.jsxs)(k.Z,{expanded:!0,children:[(0,r.jsx)(H.Z,{children:(0,r.jsx)(J.Z,{variant:"h6",children:(null==h?void 0:null===(u=h.shortJobDesc)||void 0===u?void 0:u.length)>0&&(null===(l=null==h?void 0:h.shortJobDesc[0])||void 0===l?void 0:l.taxonomy.name)||h.title})}),(0,r.jsx)($.Z,{sx:{pt:0},children:(0,r.jsxs)(oB,{container:!0,rowGap:1,columnSpacing:1,children:[(0,r.jsxs)(oB,{item:!0,xs:12,xs3:5,pt:0,display:"flex",alignItems:"center",children:[(0,r.jsx)(oV,{sx:{width:"24px"}}),(0,r.jsx)(J.Z,{ml:1.5,children:"Type "})," ",(0,r.jsx)(J.Z,{ml:.5,color:"secondary",children:(null===(c=tU.x.find(function(e){return e.value===h.type}))||void 0===c?void 0:c.text)||"-"})]}),(0,r.jsxs)(oB,{item:!0,xs:12,xs3:7,pt:0,display:"flex",alignItems:"center",children:[(0,r.jsx)(oz,{sx:{width:"24px"}}),(0,r.jsx)(J.Z,{ml:1.5,children:"Order"})," ",(0,r.jsx)(J.Z,{ml:.5,color:"secondary",children:(0,r.jsx)(tV.D,{id:h.id,number:h.number,invoiceNumber:null==h?void 0:null===(d=h.invoices)||void 0===d?void 0:null===(m=d[0])||void 0===m?void 0:m.invoiceNumber,type:h.type,numberPrefix:j,numberSuffix:y,isQuote:h.quoted})})]}),(0,r.jsxs)(oB,{item:!0,xs:12,xs3:5,display:"flex",alignItems:"center",children:[(0,r.jsx)(oQ,{sx:{width:"24px"}}),(0,r.jsx)(J.Z,{ml:1.5,children:"Source "}),(0,r.jsx)(J.Z,{ml:.5,color:"secondary",children:null===(f=tz.Y.find(function(e){return e.value===h.source}))||void 0===f?void 0:f.text})]}),h&&C(["admin","customer_owner","customer_manager"])&&(0,r.jsx)(oB,{item:!0,xs:12,xs3:7,children:(0,r.jsx)(O.Z,{variant:"contained",color:"secondary",startIcon:(0,r.jsx)(Q.Z,{}),onClick:ec,sx:{height:"30px"},children:"Edit"})})]})})]}),C(["admin","supplier"])&&(0,W.E)(h,["accepted","quoteAccepted"])&&(0,r.jsx)(t_,{job:h}),(0,r.jsxs)(k.Z,{children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(oY,{}),children:(0,r.jsxs)(F.Z,{direction:"row",spacing:3,children:[(0,r.jsx)(J.Z,{variant:"h6",children:"Workflow"}),(0,r.jsx)(tL.B,{value:h.status})]})}),(0,r.jsxs)($.Z,{children:[(0,r.jsx)(V.v,{steps:"quote"!==h.type||(0,W.E)(h,"quoteAccepted")?oO(er,eu,C,h,Z,I,et,b,w,g.hasUserModule):tb(ei,eu,C,h,Z,I,b,et,w,x)}),(0,r.jsx)(F.Z,{mt:2,children:el.map(function(e){var n=e.label,t=e.value;return(0,r.jsxs)(F.Z,{direction:"row",spacing:1,children:[(0,r.jsx)(J.Z,{sx:{fontSize:"14px"},children:n}),(0,r.jsx)(J.Z,{sx:{fontSize:"14px",color:"secondary.main"},children:t})]})})}),(0,r.jsxs)(F.Z,{direction:"row",sx:{flexWrap:"wrap",rowGap:"8px",columnGap:"8px"},mt:2,children:[C("admin")&&!E&&Y&&(0,r.jsx)(O.Z,{variant:"contained",color:"secondary",onClick:function(){tJ(h,Z)},size:"medium",children:"Follow On"}),C("supplier")&&!en&&!E&&!B&&z&&"quote"!==h.type&&(0,r.jsx)(O.Z,{variant:"contained",color:"danger",onClick:em,size:"medium",children:"Cancel"}),C("admin")&&!en&&!E&&!B&&z&&"quote"!==h.type&&(0,r.jsx)(O.Z,{variant:"contained",color:"danger",onClick:ev,size:"medium",children:"Revert job"}),C(["admin","customer"])&&"quote"===h.type&&!ee&&!en&&(0,r.jsx)(O.Z,{variant:"contained",color:"danger",onClick:function(){eE(h,"quoteClosed",Z,b)},size:"medium",children:"Close"}),!E&&Y&&!K&&(0,r.jsx)(O.Z,{variant:"contained",color:"secondary",onClick:function(){tM(h,Z,b)},size:"medium",children:"Dispute"}),(C("admin")||C("supplier"))&&K&&!G&&"onHold"!==A&&(0,r.jsx)(O.Z,{variant:"contained",color:"secondary",onClick:function(){tO(h,Z,b)},size:"medium",children:"Resolve Dispute"}),!en&&eb&&(0,r.jsx)(O.Z,{variant:"contained",onClick:ed,size:"medium",children:"On Hold"}),!en&&eg&&(0,r.jsx)(O.Z,{disabled:es,variant:"contained",onClick:ep,size:"medium",children:es?(0,r.jsx)(L.Z,{size:24,color:"secondary"}):"Resume"}),!E&&K&&!G&&(0,r.jsx)(O.Z,{variant:"contained",color:"info",onClick:function(){return tD((0,ew.wo)(h,"inDispute"),Z)},size:"medium",children:"Dispute media"}),R&&(Y||B)&&!X&&!E&&!en&&(0,r.jsx)(O.Z,{variant:"outlined",color:"danger",onClick:eh,size:"medium",children:"Roll back"})]})]})]})]})};oG.propTypes={job:E().object.isRequired,refetch:E().func.isRequired};var oW=t(90948),oK=t(12978),oX=t(93946),o0=t(98209),o1=t(99534),o2=function(e){var n=e.apiKey,t=e.center,a=e.zoom,s=e.size,u=e.scale,l=e.mapType,c=e.format,d=e.language,p=e.markers,m=e.path,f=e.region,v=(0,o1.Z)(e,["apiKey","center","zoom","size","scale","mapType","format","language","markers","path","region"]),h=(0,o.useState)(""),b=h[0],g=h[1];return(0,o.useEffect)(function(){var e=new URLSearchParams;e.append("center",t),e.append("zoom",a.toString()),e.append("size",s),e.append("scale",u),e.append("maptype",l),e.append("format",c),e.append("language",d),p&&e.append("markers",p),m&&e.append("path",m),f&&e.append("region",f),e.append("key",n),g("".concat("https://maps.googleapis.com/maps/api/staticmap","?").concat(e.toString()))},[n,t,a,s,l,c,d,p,m,f]),(0,r.jsx)("img",(0,ei.Z)((0,i.Z)({},v),{src:b,alt:"Static Map"}))};o2.propTypes={apiKey:E().string.isRequired,center:E().string.isRequired,zoom:E().number,size:E().string,scale:E().number,mapType:E().string,format:E().string,language:E().string,path:E().string,region:E().string},o2.defaultProps={apiKey:"YOUR_DEFAULT_API_KEY",center:"0,0",zoom:15,size:"400x200",scale:1,mapType:"roadmap",format:"png",language:"en",path:"",region:""};var o4=t(60120),o3=function(e){var n=e.access,t=e.address,o=e.edit,a=e.entity,s=e.entityId,u=e.id,l=e.name,c=e.refetch,d=e.showMap,p=e.showLink,m=e.title,f=e.type,v=e.expanded,h=e.onChangeExpanded,b=e.hideExpandIcon,g=(0,e8.a)(),x=function(e){e&&c&&c()},j=function(e){e.stopPropagation(),g.show({content:(0,r.jsx)(im.H,{entity:a,entityId:s,id:u,onSubmit:x,addressId:t.id,type:f}),submit:!1,title:"Manage addresses"})},y=function(){g.show({title:"Property information",content:(0,r.jsx)(o4.w,{propertyId:s,toggleShow:g.close})})},Z=(0,iv.UC)(t);return(0,r.jsxs)(k.Z,{disableGutters:!0,expanded:v,onChange:h,children:[(0,r.jsx)(o6,(0,ei.Z)((0,i.Z)({},b?{}:{expandIcon:(0,r.jsx)(G.Z,{})}),{"aria-controls":"address-content",id:"address-header",sx:{mb:0},children:(0,r.jsxs)(F.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(J.Z,{variant:"h6",children:m}),o&&(0,r.jsx)(oX.Z,{size:"small",onClick:j,children:(0,r.jsx)(Q.Z,{sx:{height:"17px",width:"17px"}})})]})})),(0,r.jsx)($.Z,{children:(0,r.jsxs)(N.ZP,{container:!0,children:[(0,r.jsxs)(N.ZP,{container:!0,item:!0,xs:12,rowSpacing:1,columnSpacing:1,children:[l&&(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Property"}),(0,r.jsx)(oK.O,(0,ei.Z)((0,i.Z)({maxLength:17},p&&{color:"secondary",sx:{"&:hover":{cursor:"pointer"}},onClick:y}),{children:l}))]}),"invoice"===f&&t.invoicingEntity&&(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Property"}),(0,r.jsx)(oK.O,{maxLength:17,children:t.invoicingEntity})]}),"invoice"!==f&&t.name&&(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Name"}),(0,r.jsx)(oK.O,{maxLength:17,children:t.name})]})]}),(0,r.jsxs)(N.ZP,{container:!0,item:!0,xs:6,rowSpacing:1,columnSpacing:1,children:[(0,r.jsxs)(N.ZP,{item:!0,xs:12,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Address"}),(0,r.jsx)(J.Z,{children:t.addressLine1}),(0,r.jsx)(J.Z,{children:t.addressLine2}),(0,r.jsx)(J.Z,{children:t.addressLine3}),(0,r.jsx)(J.Z,{children:t.city}),(0,r.jsx)(J.Z,{children:t.county}),(0,r.jsx)(J.Z,{children:t.postCode})]}),n&&(0,r.jsxs)(N.ZP,{item:!0,xs:12,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Access"}),(0,r.jsx)(oK.O,{maxLength:17,children:n})]})]}),(0,r.jsx)(N.ZP,{container:!0,item:!0,xs:6,children:d&&o0.ie.map&&(0,r.jsx)(N.ZP,{item:!0,xs:12,children:(0,r.jsx)(o5,{apiKey:o0.ie.map,center:Z,markers:[Z],size:"400x300",style:{display:"block",maxWidth:"250px",width:"100%",height:"auto"}})})})]})})]})};o3.propTypes={access:E().string,address:E().object.isRequired,edit:E().bool,entity:E().string.isRequired,entityId:E().number.isRequired,id:E().number,name:E().string,open:E().bool,refetch:E().func,showMap:E().bool,showLink:E().bool,title:E().string,type:E().string,expanded:E().bool,onChangeExpanded:E().func,hideExpandIcon:E().bool},o3.defaultProps={edit:!1,open:!0,showMap:!1,showLink:!0,title:"Address",expanded:void 0,onChangeExpanded:function(){},hideExpandIcon:!1};var o6=(0,oW.ZP)(H.Z)(function(){return{"&.MuiButtonBase-root.Mui-expanded":{minHeight:"auto"},"& .MuiAccordionSummary-content.Mui-expanded":{marginBottom:0}}}),o5=(0,oW.ZP)(o2)(function(e){var n=e.theme;return{marginLeft:"4px",border:"1px solid ".concat(n.palette.secondary.main),borderRadius:"10px"}}),o7=t(83162),o9=function(e){var n,t,a,s,u,c,d,p,m=e.job,f=e.refetch,v=(0,nv.x)().hasRole,h=(0,o.useState)(["job-location"]),b=h[0],g=h[1],x=((null===(n=m.location)||void 0===n?void 0:n.name)||"")+(m.sublocation?" (".concat(m.sublocation.name,")"):""),j=(0,iv.WE)(null==m?void 0:m.location,"registered"),y=null;y=(0,W.E)(m,"validated")&&(null===(t=m.meta)||void 0===t?void 0:null===(a=t.customerVATInvoice)||void 0===a?void 0:null===(s=a.invoiceInfo)||void 0===s?void 0:s.invoiceToAddress)?{address:(0,i.Z)({},m.meta.customerVATInvoice.invoiceInfo.invoiceToAddress)}:(0,iv.Hv)(m,"customer");var Z=function(e){return function(n,t){t?g(function(n){return(0,l.Z)(n).concat([e])}):g(function(n){return n.filter(function(n){return n!==e})})}};return(0,r.jsxs)(o8,{children:[m.customer&&v(["admin"])&&(0,r.jsxs)(k.Z,{expanded:b.includes("customer-content"),onChange:Z("customer-content"),children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),"aria-controls":"customer-content",id:"customer-header",children:(0,r.jsxs)(F.Z,{width:"100%",children:[(0,r.jsx)(J.Z,{variant:"h6",children:"Customer"}),!b.includes("customer-content")&&(0,r.jsxs)(N.ZP,{container:!0,columnSpacing:2,children:[(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Name"}),(0,r.jsx)(oK.O,{href:"/dashboard/customers/view?id=".concat(m.customer.id),maxLength:17,children:m.customer.name})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Contact"}),(0,r.jsx)(oK.O,{maxLength:17,children:null===(u=m.customerUser)||void 0===u?void 0:u.fullName})]})]})]})}),(0,r.jsx)($.Z,{sx:{pt:0},children:(0,r.jsxs)(F.Z,{spacing:1,children:[(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Name"}),(0,r.jsx)(o7.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(m.customer.id),children:(0,r.jsx)(J.Z,{children:m.customer.name})})]}),(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Contact"}),(0,r.jsx)(J.Z,{children:null===(c=m.customerUser)||void 0===c?void 0:c.fullName})]}),(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Email"}),(0,r.jsx)(J.Z,{children:null===(d=m.customerUser)||void 0===d?void 0:d.email})]}),(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Phone"}),(0,r.jsx)(J.Z,{children:null===(p=m.customerUser)||void 0===p?void 0:p.phone})]}),(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Spend Threshold"}),(0,r.jsx)(J.Z,{children:(0,nB.T)(m.customerSpendThreshold)})]})]})})]}),m.customer&&y&&v(["admin"])&&b.includes("customer-content")&&(0,r.jsx)(o3,{hideExpandIcon:!0,expanded:b.includes("customer-content"),address:y.address,edit:!(0,W.E)(m,"validated"),entity:"Location",entityId:m.location.id,id:y.id,refetch:f,title:"Invoice Address",type:"invoice"}),j&&(0,r.jsx)(o3,{expanded:b.includes("job-location"),onChangeExpanded:Z("job-location"),access:m.access,address:j.address,edit:v(["admin","customer"]),entity:"Location",entityId:m.location.id,id:j.id,name:x,showMap:!0,showLink:v(["admin","customer","tenant"]),title:"Job Location",type:"registered"}),m.customer&&y&&v(["customer","tenant"])&&(0,r.jsx)(o3,{expanded:b.includes("customer-content"),onChangeExpanded:Z("customer-content"),address:y.address,entity:"Location",entityId:m.location.id,id:y.id,refetch:f,title:"Invoice Address",type:"invoice"})]})};o9.propTypes={job:E().object.isRequired,refetch:E().func.isRequired};var o8=(0,oW.ZP)(M.Z)(function(e){var n=e.theme;return{"&.MuiBox-root":{borderLeft:"5px solid ".concat(n.palette.secondary.main),borderTopLeftRadius:"5px",borderBottomLeftRadius:"5px"}}}),ae=function(e){var n,t,i,a,s,u,c,d,p=e.job,m=e.refetch,f=(0,o.useState)(["operating-location"]),v=f[0],h=f[1],b=(0,iv.WE)(p.supplier,"registered"),g=(0,iv.WE)(p.supplier,"operating"),x=p.supplier.contactUsers[0],j=(null===(n=p.supplierUser)||void 0===n?void 0:n.id)&&(null==x?void 0:x.user)&&(null===(t=p.supplierUser)||void 0===t?void 0:t.id)!==(null==x?void 0:x.user.id),y=function(e){return function(n,t){t?h(function(n){return(0,l.Z)(n).concat([e])}):h(function(n){return n.filter(function(n){return n!==e})})}};return(0,r.jsxs)(an,{children:[(0,r.jsxs)(k.Z,{expanded:v.includes("supplier-content"),onChange:y("supplier-content"),children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),"aria-controls":"supplier-content",id:"supplier-header",children:(0,r.jsxs)(F.Z,{width:"100%",children:[(0,r.jsx)(J.Z,{variant:"h6",children:"Supplier"}),!v.includes("supplier-content")&&(0,r.jsxs)(N.ZP,{container:!0,columnSpacing:2,children:[(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Name"}),(0,r.jsx)(oK.O,{href:"/dashboard/suppliers/view?id=".concat(p.supplier.id),maxLength:17,children:p.supplier.name})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:j?"Contact":"Contact / Operative"}),(0,r.jsx)(oK.O,{maxLength:17,children:x.user.fullName})]})]})]})}),(0,r.jsx)($.Z,{sx:{pt:0},children:(0,r.jsxs)(F.Z,{spacing:1,children:[(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Name"}),(0,r.jsx)(o7.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(p.supplier.id),children:(0,r.jsx)(J.Z,{children:p.supplier.name})})]}),(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:j?"Contact":"Contact / Operative"}),(0,r.jsx)(J.Z,{children:x.user.fullName})]}),(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:j?"Contact email":"Email"}),(0,r.jsx)(J.Z,{children:null==x?void 0:null===(i=x.user)||void 0===i?void 0:i.email})]}),(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:j?"Contact phone":"Phone"}),(0,r.jsx)(J.Z,{children:null==x?void 0:null===(a=x.user)||void 0===a?void 0:a.phone})]}),p.supplierUser&&j&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Operative"}),(0,r.jsx)(J.Z,{children:p.supplierUser.fullName})]}),(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Operative email"}),(0,r.jsx)(J.Z,{children:null===(s=p.supplierUser)||void 0===s?void 0:s.email})]}),(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Operative phone"}),(0,r.jsx)(J.Z,{children:null===(u=p.supplierUser)||void 0===u?void 0:u.phone})]})]})]})})]}),b&&v.includes("supplier-content")&&(0,r.jsx)(o3,{hideExpandIcon:!0,expanded:v.includes("supplier-content"),showMap:!0,address:b.address,entity:"Account",entityId:null===(c=p.supplier)||void 0===c?void 0:c.id,id:b.id,refetch:m,title:"Registered Address",type:"registered"}),g&&(0,r.jsx)(o3,{expanded:v.includes("operating-location"),onChangeExpanded:y("operating-location"),showMap:!0,address:g.address,entity:"Account",entityId:null===(d=p.supplier)||void 0===d?void 0:d.id,id:g.id,refetch:m,title:"Operating Address",type:"operating"})]})};ae.defaultProps={},ae.propTypes={job:E().object.isRequired,refetch:E().func.isRequired};var an=(0,oW.ZP)(M.Z)(function(e){var n=e.theme;return{"&.MuiBox-root":{borderLeft:"5px solid ".concat(n.palette.primary.main),borderTopLeftRadius:"5px",borderBottomLeftRadius:"5px"}}}),at=t(90263),ai=t(67720),ar=t(24519),ao=t(22564),aa=function(e,n,t){var o,a,s,u,l=e.invoiceType,c=e.customerInfo.customerSpendThreshold,d=e.addendum,p=d.additions,m=d.deductions,f=d.discount,v=d.deposit,h=e.amountInfo,b=h.supplierAmountByTiming,g=h.vatAmount,x=h.vatRate,j=h.vatTotal,y=h.total,Z=e.expensesInfo,I=Z.expenses,S=Z.expensesTotalExVAT,w=e.rateInfo,C=w.normalRate,R=w.oohRate,q=w.premiumRate,_=w.calcWithServiceRate,T=(w.costWithServiceRateExVat,w.totalbyAmount,w.totalByTiming),A=w.timeSegmentsNormalRateDuration,E=w.timeSegmentsOohRateDuration,D=w.timeSegmentsPremiumRateDuration,P=w.timeSegmentsTotalDuration,k=w.pricing,$=w.selectedSla,H=w.serviceRateExpenses,M=w.serviceRateLabour,O=w.supplierService,N=w.selectedService,F=e.rebate,J=e.hidden,L=n.reconciledAmount,U=n.invoicedToDate,V=t.type,Q=function(e){return e?"".concat(e>0?"+":"-").concat((0,nB.T)(Math.abs(e))):""},z="supplier"===l?O:N,Y=P>z.minimumDuration?"actual":"minimum length",B=null==I?void 0:I.find(function(e){return e.vatRate!==x}),G=U-L,W=j-U,K=[{key:"Labour",value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(b)})},show:_},{key:"Service Rate Labour",value:"".concat(M,"%"),calcAmount:null,show:_},{key:"Service Rate Expenses and Materials",value:"".concat(H,"%"),calcAmount:null,show:_},{key:"Time",value:"".concat((0,ao.pv)(P/60),":").concat((0,ao.pv)(P%60)," (").concat(Y,")"),calcAmount:null,show:!_},{key:"First hour rate",value:"".concat((0,nB.T)(null==C?void 0:C.firstHour)," ").concat((null==F?void 0:F.percent)?"(+".concat(null==F?void 0:F.percent,"% rebate)"):""),calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(null==A?void 0:A.firstHourTotal)})},show:!_},{key:"Rate \xa3/H",value:"".concat((0,nB.T)(null==C?void 0:C.subsequentHours)," ").concat((null==F?void 0:F.percent)?"(+".concat(null==F?void 0:F.percent,"% rebate)"):""),calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(null==A?void 0:A.subsequentHoursTotal)})},show:!_},{key:"First hour rate(OOH)",value:"".concat((0,nB.T)(null==R?void 0:R.firstHour)," ").concat((null==F?void 0:F.percent)?"(+".concat(null==F?void 0:F.percent,"% rebate)"):""),calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(null==E?void 0:E.firstHourTotal)})},show:!_},{key:"Rate \xa3/H(OOH)",value:"".concat((0,nB.T)(null==R?void 0:R.subsequentHours)," ").concat((null==F?void 0:F.percent)?"(+".concat(null==F?void 0:F.percent,"% rebate)"):""),calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(null==E?void 0:E.subsequentHoursTotal)})},show:!_},{key:"First hour rate(Premium)",value:"".concat((0,nB.T)(null==q?void 0:q.firstHour)," ").concat((null==F?void 0:F.percent)?"(+".concat(null==F?void 0:F.percent,"% rebate)"):""),calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(null==D?void 0:D.firstHourTotal)})},show:!_},{key:"Rate \xa3/H(Premium)",value:"".concat((0,nB.T)(null==q?void 0:q.subsequentHours)," ").concat((null==F?void 0:F.percent)?"(+".concat(null==F?void 0:F.percent,"% rebate)"):""),calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(null==D?void 0:D.subsequentHoursTotal)})},show:!_},{key:"SLA",value:"(".concat(null==$?void 0:$.name," -").concat(null==$?void 0:$.entity,")"),calcAmount:function(){return""},show:!_&&"ppm"!==V},{key:"Labour",value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(T)})},show:!_&&"supplier"!==l},{key:"Expenses",value:(null==F?void 0:F.percent)?"".concat((0,nB.T)(S*(1-F.percent/100))," (+").concat(F.percent,"% rebate)"):"",calcAmount:function(){return Q(S)},show:S||!1},{key:"Additions",value:null,calcAmount:function(){return Q(p)},show:p&&"supplier"!==l||!1},{key:"Deductions",value:null,calcAmount:function(){return Q(-1*m)},show:m&&"supplier"!==l||!1},{key:"supplier"===l?"Deductions":"Discount",value:null,calcAmount:function(){return Q(-1*f)},show:f||!1},{key:(0,r.jsx)(r.Fragment,{children:"Net"}),value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:"=".concat((0,nB.T)(y))})},show:!0},{key:"VAT",value:!B&&"(".concat(100*x,"%)"),calcAmount:function(){return Q(g)},show:!0},{key:(0,r.jsx)(r.Fragment,{children:"Gross"}),value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:"=".concat((0,nB.T)(j))})},show:!0},{key:"Rebate",value:(null==F?void 0:F.percent)?"(".concat(F.percent,"%)"):"",calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(null==F?void 0:F.amount)})},show:(null==F?void 0:F.percent)||!1},{key:"Due from Customer",value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(j-(null==F?void 0:F.amount))})},show:!_&&(null==F?void 0:F.percent)||!1},{key:"Deposit",value:null,calcAmount:function(){return(0,nB.T)(v)},show:!!v},{key:"Reconciled Amount",value:null,calcAmount:(0,r.jsx)(r.Fragment,{children:(0,nB.T)(L)}),show:L>0},{key:"Amount outstanding",value:null,calcAmount:function(){return(0,nB.T)(G)},show:!0},{key:"Amount to be invoiced",value:null,calcAmount:function(){return(0,nB.T)(W)},show:!0}],X=[{id:1,key:"Pricing",value:_?"Service Rate":"time-materials"===k?"Time & Materials":"Fixed"},{id:2,key:"Threshold",value:c&&(0,nB.T)(c)},{id:3,key:_?"":"Rate \xa3/H",value:_?"":"Adjusted by ".concat((a=(o={entity:z.entity,rebate:F}).entity,u=(null==(s=o.rebate)?void 0:s.amount)>0?"/ Rebate":"","".concat(a," ").concat("Service"," ").concat(u)))}];return{amounts:K.map(function(e,n){return(0,ei.Z)((0,i.Z)({},e),{id:n+1,calcAmount:J||e.calcAmount})}).filter(function(e){return e.show}),texts:X}};aa.propTypes={job:E().object.isRequired,isOOH:E().string,multiplier:E().string,rate:E().string,selectedSla:E().string,selectedService:E().string};var as=function(e,n,t){var o,a=e.invoiceType,s=e.customerInfo.customerSpendThreshold,u=e.addendum,l=u.additions,c=u.deductions,d=u.discount,p=u.deposit,m=e.amountInfo,f=m.amount,v=m.amountIncludingRebate,h=m.supplierLabourAmount,b=m.supplierMaterialsAmount,g=m.vatAmount,x=m.vatRate,j=m.total,y=m.vatTotal,Z=e.expensesInfo,I=Z.expenses,S=Z.expensesTotalExVAT,w=e.rateInfo,C=w.calcWithServiceRate,R=w.pricing,q=w.selectedSla,_=w.serviceRateExpenses,T=w.serviceRateLabour,A=e.rebate,E=e.hidden,D=n.reconciledAmount,P=n.invoicedToDate,k=t.type,$=function(e){return e?"".concat(e>0?"+":"-").concat((0,nB.T)(Math.abs(e))):""},H=null==I?void 0:I.find(function(e){return e.vatRate!==x}),M=P-D,O=y-P,N=[{key:"Labour",value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(h)})},show:C},{key:"Service Rate Labour",value:"",calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:"".concat(T,"%")})},show:C},{key:"Materials",value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(b)})},show:C},{key:"Service Rate Expenses and Materials",value:"",calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:"".concat(_,"%")})},show:C},{key:"Amount",value:(null==A?void 0:A.percent)?"".concat(f," (+").concat(A.percent,"% rebate)"):"",calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(v)})},show:!("supplier"===a||C)},{key:"Labour",value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(h)})},show:"supplier"===a},{key:"Materials",value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(b)})},show:"supplier"===a},{key:"Expenses",value:(null==A?void 0:A.percent)?"".concat((0,nB.T)(S*(1-A.percent/100))," (+").concat(A.percent,"% rebate)"):"",calcAmount:function(){return $(S)},show:!0},{key:"Additions",value:null,calcAmount:function(){return $(l)},show:l&&"supplier"!==a||!1},{key:"Deductions",value:null,calcAmount:function(){return $(-1*c)},show:c&&"supplier"!==a||!1},{key:"supplier"===a?"Deductions":"Discount",value:null,calcAmount:function(){return $(-1*d)},show:!!d},{key:(0,r.jsx)(r.Fragment,{children:"Net"}),value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:"=".concat((0,nB.T)(j))})},show:!0},{key:"VAT",value:!H&&"(".concat(100*x,"%)"),calcAmount:function(){return $(g)},show:!0},{key:(0,r.jsx)(r.Fragment,{children:"Gross"}),value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:"=".concat((0,nB.T)(y))})},show:!0},{key:"Rebate",value:(null==A?void 0:A.percent)?"(".concat(A.percent,"%)"):"",calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(null==A?void 0:A.amount)})},show:(null==A?void 0:A.percent)||!1},{key:"Due from Customer",value:null,calcAmount:function(){return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(y-(null==A?void 0:A.amount))})},show:(null==A?void 0:A.percent)||!1},{key:"Deposit",value:null,calcAmount:function(){return(0,nB.T)(p)},show:!!p},{key:"Reconciled Amount",value:null,calcAmount:(0,r.jsx)(r.Fragment,{children:(0,nB.T)(D)}),show:D>0},{key:"Amount outstanding",value:null,calcAmount:function(){return(0,nB.T)(M)},show:!0},{key:"Amount to be invoiced",value:null,calcAmount:function(){return(0,nB.T)(O)},show:!0}],F=[{id:1,key:"Pricing",value:C?"Service Rate":R||"Fixed"},{id:2,key:"Threshold",value:s&&(0,nB.T)(s)},{id:3,key:"SLA",value:"ppm"!==k?(null==q?void 0:q.name)||(null==q?void 0:null===(o=q.sla)||void 0===o?void 0:o.name):"N/A"}];return{amounts:N.map(function(e,n){return(0,ei.Z)((0,i.Z)({},e),{id:n+1,calcAmount:E||e.calcAmount})}).filter(function(e){return e.show}),texts:F}};as.propTypes={job:E().object.isRequired,selectedSla:E().string};var au=t(19504),al=function(e){var n=e.filter(function(e){return iS.cJ.includes(e.invoiceType)});return{invoicedToDate:null==e?void 0:e.reduce(function(e,n){var t;return e+(Number(null===(t=n.amounts)||void 0===t?void 0:t.vatTotal)||0)},0),reconciledAmount:null==e?void 0:e.reduce(function(e,n){var t,i,r,o;return e+(Number(null==n?void 0:null===(t=n.reconciledAmount)||void 0===t?void 0:null===(i=t.reconciliations)||void 0===i?void 0:null===(r=i.aggregate)||void 0===r?void 0:null===(o=r.sum)||void 0===o?void 0:o.amount)||0)},0),proformaInvoiceVatTotal:null==n?void 0:n.reduce(function(e,n){var t;return e+(Number(null===(t=n.amounts)||void 0===t?void 0:t.vatTotal)||0)},0)}},ac=function(e){var n,t,i,r,o,a,s=e.financeSupplier,u=e.financeCustomer,l=null==s?void 0:null===(n=s.amountInfo)||void 0===n?void 0:n.total,c=null==u?void 0:null===(t=u.amountInfo)||void 0===t?void 0:t.total,d=(null==u?void 0:null===(i=u.amountInfo)||void 0===i?void 0:i.vatTotal)-(null==u?void 0:null===(r=u.rebate)||void 0===r?void 0:r.amount),p=(0,au.l)(c-l,2),m=(0,au.l)(p/c*100,2),f=(0,au.l)(d-l,2),v=(0,au.l)(f/d*100,2);return!(null==u?void 0:null===(o=u.rateInfo)||void 0===o?void 0:o.calcWithServiceRate)&&(null==u?void 0:null===(a=u.rebate)||void 0===a?void 0:a.percent)?{netProfitAmount:f,netProfitMargin:v}:{netProfitAmount:p,netProfitMargin:m}},ad=function(e){var n=e.job,t=e.type,i=e.financeSupplier,a=e.financeCustomer,s=(0,nv.x)().hasRole,u=s("customer"),l=s("tenant"),c=(0,o.useState)([]),d=c[0],p=c[1],m=(0,o.useState)([]),f=m[0],v=m[1],h=(0,o.useState)(),b=h[0],g=h[1],x=(0,o.useState)(),j=x[0],y=x[1],Z=(0,W.E)(n,"invoiceSent");(0,o.useEffect)(function(){var e,r="supplier"===t?i:a;(u||l)&&!Z&&(r.hidden="N/A");var o=null==n?void 0:null===(e=n.invoices)||void 0===e?void 0:e.filter(function(e){return iS.SR[t].includes(e.invoiceType)}),s=al(o),c="time-materials"===n.pricing?aa(r,s,n):as(r,s,n),d=c.amounts;v(c.texts),p(d);var m=ac({financeCustomer:a,financeSupplier:i}),f=m.netProfitAmount,h=m.netProfitMargin;g((0,nB.T)(f||0)),y("".concat(h||0,"%"))},[u,n,t,Z,i,a,l]);var I=(0,o.useMemo)(function(){return[{field:"key",flex:1,sortable:!1,renderCell:function(e){var n=e.value,t="function"==typeof n?n():n;return(0,r.jsx)(tq.Z,{title:t,children:t})}},{field:"value",flex:1,sortable:!1,renderCell:function(e){var n=e.value,t="function"==typeof n?n():n;return(0,r.jsx)(tq.Z,{title:t,children:t})}},{field:"calcAmount",flex:1,sortable:!1,align:"right",renderCell:function(e){var n=e.value,t="function"==typeof n?n():n;return(0,r.jsx)(tq.Z,{title:t,children:t})}}]},[]);return(0,r.jsxs)(F.Z,{spacing:2,children:[f.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(F.Z,{direction:"row",justifyContent:"space-between",spacing:2,sx:{pl:"10px",pr:"10px"},children:f.map(function(e){var n=e.key,t=e.value;return(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:n}),(0,r.jsx)(J.Z,{children:t})]})})}),(0,r.jsx)(ai.Z,{})]}),d.length>0&&(0,r.jsx)(nm.i,{hideHeader:!0,columns:I,rows:d,getRowClassName:function(e){return e.row.id%2==0?"odd":"even"}}),s("admin")&&"customer"===t&&(0,r.jsxs)(N.ZP,{container:!0,pl:"10px",pr:"10px",children:[(0,r.jsxs)(N.ZP,{item:!0,xs:4,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Net Profit"}),(0,r.jsx)(J.Z,{children:b})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:8,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Net Profit Margin"}),(0,r.jsx)(J.Z,{children:j})]})]})]})};function ap(){var e=(0,m.Z)(['\n  query GetExpenses($entity: String, $entityId: Int, $jobId: Int) {\n    expenses: Expense(\n      where: { jobId: { _eq: $jobId }, entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n    ) {\n      id\n      categoryId\n      description\n      amount\n      unit\n      markup\n      vat\n      paid\n      jobId\n      total\n      entity\n      entityId\n      occurredAt\n      recurring\n      pendingAmount\n      category: Category {\n        name\n      }\n      media: Media(where: { entity: { _eq: "Expense" } }) {\n        id\n      }\n    }\n  }\n']);return ap=function(){return e},e}function am(){var e=(0,m.Z)(["\n  mutation InsertExpense(\n    $objects: [Expense_insert_input!]!\n    $pendingAmountJobTiming: [JobTiming_insert_input!]!\n    $pendingAmountJobTimingWhere: JobTiming_bool_exp!\n    $shouldAddPendingAmount: Boolean!\n    $shouldRemovePendingAmountResolved: Boolean!\n  ) {\n    insert_Expense(objects: $objects) {\n      returning {\n        id\n      }\n    }\n    insert_JobTiming(objects: $pendingAmountJobTiming) @include(if: $shouldAddPendingAmount) {\n      returning {\n        id\n      }\n    }\n    delete_JobTiming(where: $pendingAmountJobTimingWhere)\n      @include(if: $shouldRemovePendingAmountResolved) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return am=function(){return e},e}function af(){var e=(0,m.Z)(["\n  mutation UpdateExpense(\n    $id: Int!\n    $changes: Expense_set_input\n    $pendingAmountJobTiming: [JobTiming_insert_input!]!\n    $pendingAmountJobTimingWhere: JobTiming_bool_exp!\n    $shouldAddPendingAmount: Boolean!\n    $shouldRemovePendingAmountResolved: Boolean!\n  ) {\n    update_Expense_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_JobTiming(objects: $pendingAmountJobTiming) @include(if: $shouldAddPendingAmount) {\n      returning {\n        id\n      }\n    }\n    delete_JobTiming(where: $pendingAmountJobTimingWhere)\n      @include(if: $shouldRemovePendingAmountResolved) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return af=function(){return e},e}function av(){var e=(0,m.Z)(["\n  mutation DeleteExpense(\n    $id: Int!\n    $pendingAmountJobTimingWhere: JobTiming_bool_exp!\n    $shouldRemovePendingAmount: Boolean!\n  ) {\n    delete_Expense_by_pk(id: $id) {\n      id\n    }\n    delete_JobTiming(where: $pendingAmountJobTimingWhere) @include(if: $shouldRemovePendingAmount) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return av=function(){return e},e}ad.defaultProps={},ad.propTypes={job:E().object.isRequired,type:E().oneOf(["customer","supplier"]).isRequired,financeSupplier:E().object.isRequired,financeCustomer:E().object.isRequired};var ah=(0,f.Ps)(ap()),ab=(0,f.Ps)(am()),ag=(0,f.Ps)(af()),ax=(0,f.Ps)(av()),aj=(0,el.Ry)().shape({amount:(0,el.Rx)().when("pendingAmount",{is:function(e){return!1===e},then:function(e){return e.required()}}),unit:(0,el.Rx)().min(0).required(),categoryId:(0,el.Ry)().required(),description:(0,el.Z_)().required(),markup:(0,el.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),paid:(0,el.Z_)().when("isAdmin",{is:function(e){return!0===e},then:function(){return(0,el.Z_)().oneOf(["admin","supplier"]).required()}}),vatMarkup:(0,el.Rx)().transform(function(e){return isNaN(e)?null:e}).nullable(),pendingAmount:(0,el.O7)()}),ay=[{id:"admin",label:"Admin",value:"admin"},{id:"supplier",label:"Supplier",value:"supplier"}],aZ=[{id:"pendingAmount",label:"Pending amount",value:!0}],aI=[{id:"default",label:"Default (20%)",value:"20"},{id:"custom",label:"Custom",value:"custom"}],aS=function(e){var n,t=e.defaultValues,a=e.submit,s=e.serviceRateExpenses,u=(0,(0,nv.x)().hasRole)("admin"),l=(0,er.cI)({defaultValues:(0,i.Z)({vat:"20"},t),resolver:(0,eo.S)(aj),context:{isAdmin:u}}),c=l.control,d=l.errors,p=l.handleSubmit,m=l.register,f=l.watch,v=l.setValue,h=(0,o.useState)(!1),b=h[0],g=h[1],x=f("vat"),j=f("pendingAmount");(0,o.useEffect)(function(){(null==t?void 0:t.vat)&&(null==t?void 0:t.vat)!=="20"?(v("vatMarkup",t.vat),v("vat","custom")):v("vat","20")},[j]);var y=(n=(0,q.Z)(function(e){var n;return(0,T.__generator)(this,function(t){switch(t.label){case 0:n=(0,ei.Z)((0,i.Z)({},e),{paid:u?e.paid:"supplier"}),t.label=1;case 1:return t.trys.push([1,,3,4]),g(!0),[4,a(n)];case 2:return t.sent(),[3,4];case 3:return g(!1),[7];case 4:return[2]}})}),function(e){return n.apply(this,arguments)}),Z={control:c,errors:d,register:m};return b?(0,r.jsx)(F.Z,{direction:"row",justifyContent:"center",children:(0,r.jsx)(L.Z,{color:"secondary"})}):(0,r.jsxs)(ea.Z,{id:"offCanvasForm",handleSubmit:p(y),children:[u&&(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},Z),{name:"paid",data:ay,legend:"Paid by"})),(0,r.jsx)(eh.Z,(0,ei.Z)((0,i.Z)({},Z),{data:aZ,name:"pendingAmount"})),!j&&(0,r.jsx)(e4.Z,(0,ei.Z)((0,i.Z)({},Z),{name:"amount",label:"Unit Cost",vat:"Ex VAT"})),(0,r.jsx)(eg.Z,{label:"Units",children:(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},Z),{name:"unit"}))}),!j&&(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},Z),{name:"vat",data:aI,legend:"VAT"})),!j&&"custom"===x&&(0,r.jsx)(e3.Z,(0,ei.Z)((0,i.Z)({},Z),{label:"Custom VAT",name:"vatMarkup"})),!j&&!!s&&(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},Z),{name:"markup",type:"hidden"})),!j&&!s&&u&&(0,r.jsx)(e3.Z,(0,ei.Z)((0,i.Z)({},Z),{label:"Markup ".concat(s?"(Service Rate Expenses and Materials : ".concat(s,"%)"):""),name:"markup"})),(0,r.jsx)(eu.P,(0,ei.Z)((0,i.Z)({},Z),{errors:(0,i.Z)({},d),label:"Category",name:"categoryId",type:"expenseCategory"})),(0,r.jsx)(eg.Z,{label:"Description",children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},Z),{name:"description",rows:2}))}),t.id&&(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},Z),{name:"id",type:"hidden"}))]})};aS.propTypes={defaultValues:A.object,serviceRateExpenses:A.number,submit:A.func.isRequired,submitting:A.bool.isRequired},aS.defaultProps={serviceRateExpenses:0,submitting:!1};var aw=function(e,n,t){var r=0,o=0,a=null==e?void 0:e.filter(function(e){return"supplier"===t&&"supplier"===e.paid||"supplier"!==t});return{preparedExpenses:null==a?void 0:a.map(function(e){var a=e.amount;"supplier"!==t&&(a+=e.markup/100*a,a/=1-n/100);var s=a*(e.unit||1),u=s+s*(e.vat/100);return o+=s,r+=u,(0,ei.Z)((0,i.Z)({},e),{id:e.id,name:e.description,unitCost:a,price:s,total:u,unit:e.unit||1,vatAmount:s*(e.vat/100),vatRate:e.vat/100,markup:e.markup})}),totalExpenses:r,totalExpensesExVAT:o}},aC=t(21830),aR=t(41687),aq=function(e){var n,t,a,s,u,l=e.job,d=e.refetchParent,p=e.tab,m=e.expanded,f=e.onChangeExpanded,v=(0,D.x)(),h=(0,nv.x)(),b=h.hasRole,g=h.user,x=(0,o.useContext)(U.Z),j=(0,W.E)(l,"invoiceSent"),y=(0,W.E)(l,"closed"),Z=b("customer")&&!j,I=!l||!y&&(b(["admin"])&&!(0,W.E)(l,["validated","unvalidated"])||b(["admin","supplier"])&&!(0,W.E)(l,"reportSent")),S=e9("serviceRateExpenses",null==l?void 0:l.financeLogs,null==l?void 0:null===(n=l.customer)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:null===(a=t.finance)||void 0===a?void 0:a.serviceRateExpenses)||0,w=p||(!b("admin")&&b("supplier")?"supplier":"admin"),C=(0,c.a)(ah,{variables:{jobId:l.id},skip:Z}),R=C.data,A=(void 0===R?{expenses:[]}:R).expenses,E=C.loading,M=C.refetch,O=aw(A,0,w),L=O.preparedExpenses,V=O.totalExpenses,Q=O.totalExpensesExVAT,z=L.length>0&&L.length===L.filter(function(e){return e.pendingAmount}).length,Y=(0,_.Z)((0,P.D)(ax,{onCompleted:function(){l&&(0,eT.F)(v,l.id),d(),M()}}),1)[0],B=(0,_.Z)((0,P.D)(ab,{onCompleted:function(){l&&(0,eT.F)(v,l.id),x.close(),d(),M()}}),1)[0],G=(0,_.Z)((0,P.D)(ag,{onCompleted:function(){l&&(0,eT.F)(v,l.id),x.close(),d(),M()}}),1)[0],K=(s=(0,q.Z)(function(e){var n,t,r,o,a,s,u,c,d,p,m,f,h;return(0,T.__generator)(this,function(a){switch(a.label){case 0:return"custom"===e.vat&&(e.vat=e.vatMarkup),r=(t=(n=(e.unit||0)*(e.amount||0))*((e.markup||0)/100)+n)*((e.vat||0)/100)+t,o={id:e.id,paid:e.paid,markup:e.markup||0,description:e.description,categoryId:e.categoryId.value,unit:e.unit,pendingAmount:e.pendingAmount,amount:e.amount||0,vat:e.vat||0,total:r},[4,v.query({query:ah,variables:{jobId:l.id}})];case 1:if(c=(u=(void 0===(s=a.sent().data)?{expenses:[]}:s).expenses).find(function(n){return n.id===+e.id})||{},d=u.filter(function(n){var t=n.id;return n.pendingAmount&&t!==+e.id}),p=e.pendingAmount,m=c.pendingAmount&&!e.pendingAmount&&d.length<=0,f=[],h={},p&&(f.push({status:"expensesPendingAmount",notes:e.description,userId:g.id,jobId:l.id}),h.status={_eq:"expensesPendingAmountResolved"},h.jobId={_eq:l.id}),m&&f.push({status:"expensesPendingAmountResolved",userId:g.id,jobId:l.id}),!o.id)return[3,3];return[4,G({variables:{id:o.id,changes:o,pendingAmountJobTiming:f,pendingAmountJobTimingWhere:h,shouldAddPendingAmount:!!p||!!m,shouldRemovePendingAmountResolved:!!p}})];case 2:return a.sent(),[3,5];case 3:return[4,B({variables:{objects:(0,ei.Z)((0,i.Z)({},o),{jobId:null==l?void 0:l.id}),pendingAmountJobTiming:f,pendingAmountJobTimingWhere:h,shouldAddPendingAmount:!!p||!!m,shouldRemovePendingAmountResolved:!!p}})];case 4:a.sent(),a.label=5;case 5:return[2]}})}),function(e){return s.apply(this,arguments)}),X=function(e){return function(n){n.stopPropagation();var t=(null==e?void 0:e.item)?(0,i.Z)({},null==e?void 0:e.item):{markup:S};(null==t?void 0:t.vat)&&(t.vat=String(t.vat)),x.show({content:(0,r.jsx)(aS,{defaultValues:t,submit:K,serviceRateExpenses:S}),title:"Expenses"})}},ee=(u=(0,q.Z)(function(e,n){var t,i,r,o,a,s;return(0,T.__generator)(this,function(t){switch(t.label){case 0:return e.preventDefault(),e.stopPropagation(),[4,v.query({query:ah,variables:{jobId:l.id}})];case 1:return o=(0,(void 0===(i=t.sent().data)?{expenses:[]}:i).expenses).filter(function(e){var t=e.id;return e.pendingAmount&&t!==+n.id}),a=n.pendingAmount&&o.length<=0,s={},a&&(s.status={_eq:"expensesPendingAmount"},s.jobId={_eq:l.id}),[4,Y({variables:{id:n.item.id,shouldRemovePendingAmount:a,pendingAmountJobTimingWhere:s}})];case 2:return t.sent(),[2]}})}),function(e,n){return u.apply(this,arguments)}),en=function(e){x.show({content:(0,r.jsx)(e2.G,{entity:"Expenses",entityId:e.item.id}),submit:!1,title:"Media"})},et=function(e){return[{context:"secondary",icon:"edit",onClick:function(n){return X(e)(n)},tooltip:"Edit"},{context:"info",icon:"uploadFile",onClick:function(n){return en(e)},tooltip:"Media"},{context:"danger",icon:"delete",onClick:function(n){return ee(n,e)},tooltip:"Delete"}]};return(0,r.jsxs)(k.Z,{expanded:m,onChange:f,children:[(0,r.jsx)(H.Z,{children:(0,r.jsxs)(F.Z,{width:"100%",spacing:2,children:[(0,r.jsx)(J.Z,{variant:"h6",children:" Expenses"}),(0,r.jsxs)(N.ZP,{container:!0,children:[(0,r.jsxs)(N.ZP,{item:!0,xs:4,children:[(0,r.jsx)(J.Z,{children:"Total"}),(0,r.jsx)(J.Z,{children:z?"N/A":(0,nB.T)(Q)})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:8,children:[(0,r.jsx)(J.Z,{children:"VAT Total"}),(0,r.jsx)(J.Z,{children:z?"N/A":(0,nB.T)(V)})]})]})]})}),(0,r.jsx)($.Z,{sx:{pt:0},children:(0,r.jsxs)(F.Z,{width:"100%",children:[(0,r.jsx)(nm.i,{columns:[{field:"description",headerName:"Description",flex:1,sortable:!1},{field:"total",headerName:"Total",flex:1,sortable:!1,renderCell:function(e){var n=e.value;return e.row.pendingAmount?"Pending":(0,nB.T)(n)}},{field:"paid",headerName:"Paid By",flex:1,sortable:!1},{field:"actions",headerName:"",width:50,sortable:!1,renderCell:function(e){var n=e.row;return(0,r.jsx)(aC.C,{actionsData:et,row:n})},hide:!I}],rows:null==L?void 0:L.map(function(e){var n,t;return{id:e.id,description:e.description,total:e.total,paid:e.paid.charAt(0).toUpperCase()+e.paid.slice(1),actions:"",item:(0,i.Z)({},e,{occurredAt:new Date(e.occurredAt)},{categoryId:{label:null===(n=e.category)||void 0===n?void 0:n.name,value:e.categoryId}}),mediaCount:null===(t=e.media)||void 0===t?void 0:t.length,pendingAmount:e.pendingAmount}}),loading:E,noResultsMessage:"There are currently no expenses.",columnVisibilityModel:{actions:I}}),I&&(0,r.jsx)(oX.Z,{onClick:X(),sx:{alignSelf:"center"},children:(0,r.jsx)(aR.Z,{})})]})})]})};aq.defaultProps={refetchParent:function(){},onChangeExpanded:function(){}},aq.propTypes={job:E().object,refetchParent:E().func,tab:E().oneOf(["supplier","customer"]),expanded:E().bool,onChangeExpanded:E().func};var a_=t(43800);function aT(){var e=(0,m.Z)(["\n  query getReconciliation($accountEntryId: Int!) {\n    reconciliation: Reconciliation(where: { InvoiceEntry: { id: { _eq: $accountEntryId } } }) {\n      amount\n      createdAt\n      id\n      creditEntity\n      creditEntityId\n      meta\n      paymentEntry: PaymentEntry {\n        id\n        meta\n        credit\n      }\n    }\n    meta: Reconciliation_aggregate(where: { InvoiceEntry: { id: { _eq: $accountEntryId } } }) {\n      aggregate {\n        total: sum {\n          amount\n        }\n      }\n    }\n  }\n"]);return aT=function(){return e},e}function aA(){var e=(0,m.Z)(["\n  mutation AddCreditNote(\n    $job: Job_set_input!\n    $jobId: Int!\n    $timing: [JobTiming_insert_input!]!\n    $isPaid: Boolean!\n  ) {\n    update_Job_by_pk(pk_columns: { id: $jobId }, _set: $job) @include(if: $isPaid) {\n      id\n    }\n\n    insert_JobTiming(objects: $timing) @include(if: $isPaid) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return aA=function(){return e},e}var aE=(0,f.Ps)(aT());(0,f.Ps)(aA());var aD=function(e){var n=e.loading,t=e.reconciliation;return(0,r.jsx)(e1.Z,{columns:[{hidden:!0},{hidden:!0},{text:"Type"},{formatter:function(e){var n=e.row;return(0,ee.Z)(n.amountReceived)},text:"Payment Amount "},{formatter:function(e){var n=e.row;return(0,ee.Z)(n.reconciledAmount)},text:"Reconciled"},{text:"Date"},{hidden:!0,text:"Reference"},{hidden:!0},{hidden:!0}],loading:n,rows:t.map(function(e){var n,t,i,r;return{id:e.id,creditEntityId:e.creditEntityId,creditEntity:e.creditEntity,amountReceived:e.paymentEntry.credit,reconciledAmount:e.amount,dateReceived:(0,en.Z)(e.createdAt),paymentReference:(null===(n=e.paymentEntry)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:t.paymentReference)||"-",comment:(null===(i=e.paymentEntry)||void 0===i?void 0:null===(r=i.meta)||void 0===r?void 0:r.comment)||"-",meta:e.meta}})})};aD.propTypes={loading:A.bool,reconciliation:A.array};var aP=function(e){var n=e.accountEntryId,t=e.currency,i=(0,c.a)(aE,{variables:{accountEntryId:n}}),o=i.loading,a=i.data,s=void 0===a?{reconciliation:[],meta:{aggregate:{total:{amount:0}}}}:a,u=s.reconciliation,l=s.meta;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("strong",{children:"Reconciliation"}),(0,r.jsx)(e0.Z,{content:"Total",text:(0,ee.Z)(l.aggregate.total.amount,t)}),(0,r.jsx)(aD,{loading:o,reconciliation:u})]})};aP.propTypes={currency:A.string.isRequired,accountEntryId:A.number.isRequired};var ak=t(49010),a$=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{items:[]};return(null==n?void 0:null===(e=n.items)||void 0===e?void 0:e.map(function(e){return{type:e.type,unit:e.minutes,description:e.name,price:e.itemTotal,gross:e.itemTotalIncVAT,unitCost:e.rate,net:e.minutes*(e.rate||1),vat:e.rate*e.minutes*1.2-(e.rate*e.minutes||1),vatPercent:100*e.vatRate}}))||[]},aH=function(e){var n=e.unit,t=void 0===n?0:n,i=e.unitCost,r=void 0===i?0:i,o=e.vatPercent,a=void 0===o?0:o;return{net:t*r||0,vatTotal:r*t*(1+a)-r*t||0,gross:r*t*(1+a)||0,price:r*(t||1)}},aM=function(e){var n=e.type,t=e.invoiceType,i=e.vatId,r={type:n,vat:"default",vatPercent:20,vatDefault:20};return"ProformaInvoiceSupplier"!==t||(0,ak.b)(i)||(r.vatPercent=0,r.vatDefault=0),r},aO=function(e){var n=e.rowData,t=e.invoiceType,r=e.vatId,o=(0,ei.Z)((0,i.Z)({},n),{vat:"default",vatDefault:20});return 20!==Number(n.vatPercent)&&(o.vat="custom"),"ProformaInvoiceSupplier"!==t||(0,ak.b)(r)||0===Number(n.vatPercent)||(o.vat="custom",o.vatDefault=0),o},aN=(0,el.Ry)().shape({type:(0,el.Z_)().oneOf((0,l.Z)(iS.cJ)).required(),description:(0,el.Z_)(),dueDate:(0,el.Z_)().required()}),aF=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20;return[{id:"default",label:"Default (".concat(e,"%)"),value:"default"},{id:"custom",label:"Custom",value:"custom"}]},aJ=function(e){var n=e.defaultValues,t=e.editMode,a=e.toggleShow,s=e.onSuccess,u=n.vat,l=n.vatPercent,c=n.vatDefault,d=(0,er.cI)({defaultValues:(0,ei.Z)((0,i.Z)({},n),{vat:u,vatPercent:l})}),p=d.control,m=d.errors,f=d.handleSubmit,v=d.register,h=d.watch,b=d.setValue,g=h("unitCost"),x=h("unit"),j=h("vat"),y=h("vatPercent");(0,o.useEffect)(function(){"default"===j&&b("vatPercent",c)},[j]);var Z,I=aH({unit:x,unitCost:g,vatPercent:y/100}),S=I.net,w=I.vatTotal,C=I.gross,R=I.price,_=(Z=(0,q.Z)(function(e){return(0,T.__generator)(this,function(n){return s((0,ei.Z)((0,i.Z)({},e),{price:R,net:S,vat:w,gross:C,vatPercent:y})),[2]})}),function(e){return Z.apply(this,arguments)}),A={control:p,errors:m,register:v};return(0,r.jsxs)(ea.Z,{handleSubmit:f(_),children:[(0,r.jsx)(eH.Z,{children:(0,r.jsx)(eM.Z,{md:12,children:(0,r.jsx)(eg.Z,{label:"Description",children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},A),{name:"description",rows:2}))})})}),(0,r.jsxs)(eH.Z,{children:[(0,r.jsx)(eM.Z,{md:8,children:(0,r.jsx)(e4.Z,(0,ei.Z)((0,i.Z)({},A),{name:"unitCost",label:"Unit Cost",vat:"Ex VAT",min:.01}))}),(0,r.jsx)(eM.Z,{md:4,children:(0,r.jsx)(eg.Z,{label:"Units",children:(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},A),{name:"unit",type:"number",step:"1",min:1}))})})," ",(0,r.jsxs)(eM.Z,{md:12,children:[(0,r.jsx)(eg.Z,{label:"VAT %"}),(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},A),{name:"vat",data:aF(c)})),(0,r.jsx)(e3.Z,(0,ei.Z)((0,i.Z)({},A),{label:"Custom VAT",name:"vatPercent",show:"custom"===j}))]})]}),(0,r.jsxs)(ey.Z,{children:["Net: ",(0,ee.Z)(S)]}),(0,r.jsxs)(ey.Z,{children:["VAT: ",(0,ee.Z)(w)]}),(0,r.jsxs)(ey.Z,{children:["Gross: ",(0,ee.Z)(C)]}),(0,r.jsxs)(eH.Z,{justify:"end",style:{margin:"0 5px"},children:[(0,r.jsx)(ej.Z,{content:"Back",onClick:a,style:{margin:"0 5px"},context:"danger"}),(0,r.jsx)(ej.Z,{content:t?"Save":"Add",type:"submit"})]}),(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},A),{name:"id",type:"hidden"})),(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},A),{name:"type",type:"hidden"})),(0,r.jsx)("div",{style:{clear:"both"}})]})};function aL(){var e=(0,m.Z)(["\n  width: 100%;\n  margin: 1rem 0;\n"]);return aL=function(){return e},e}function aU(){var e=(0,m.Z)(["\n  margin: 0;\n  display: flex;\n  justify-content: space-between;\n"]);return aU=function(){return e},e}function aV(){var e=(0,m.Z)(["\n  margin: 0 0 0 auto;\n  display: flex;\n  flex-direction: column;\n  width: 144px;\n"]);return aV=function(){return e},e}aJ.propTypes={defaultValues:A.object,editMode:A.bool,toggleShow:A.func,type:A.string,onSuccess:A.func};var aQ=[{id:"ProformaInvoiceCustomer",label:"Customer invoice",value:"ProformaInvoiceCustomer"},{id:"ProformaInvoiceSupplier",label:"Supplier invoice",value:"ProformaInvoiceSupplier"}],az=function(e){var n,t,a,s,u=e.job,c=e.showDetails,d=e.defaultValues,p=e.toggleShow,m=(0,e8.a)(),f=(0,nX.D)(),v=(0,er.cI)({resolver:(0,eo.S)(aN),defaultValues:{description:null==d?void 0:null===(n=d.configs)||void 0===n?void 0:n.descriptionInvoice,type:"ProformaInvoiceCustomer"}}),h=v.control,b=v.errors,g=v.handleSubmit,x=v.register,j=v.watch,y=v.setValue,Z=j("type");(0,o.useEffect)(function(){c||("ProformaInvoiceCustomer"===Z?y("dueDate",iQ({job:u,type:"customer",invoiceDate:new Date})):y("dueDate",iQ({job:u,type:"supplier",invoiceDate:new Date})))},[Z]);var I,S=(0,o.useState)(a$(null==d?void 0:null===(t=d.accountEntry)||void 0===t?void 0:t.meta)),w=S[0],C=S[1],R=(0,_.Z)((0,P.D)(ik.bK,{refetchQueries:["getInvoices","GetJob"],onCompleted:function(){f.show({content:"Ad-hoc invoice was created"}),p()},onError:function(e){f.show({content:"Error: ".concat(e.message),color:"error"})}}),2),A=R[0],E=R[1].loading,D=(I=(0,q.Z)(function(e){var n,t,i;return(0,T.__generator)(this,function(r){switch(r.label){case 0:return n=e.type,t=e.description,i=e.dueDate,[4,A({variables:{jobId:u.id,invoiceType:n,description:t,dueDate:X()(i).toISOString(),items:w}})];case 1:return r.sent(),[2]}})}),function(e){return I.apply(this,arguments)}),k=function(e){if(e.id){var n=Number(e.id),t=w.map(function(t){return t.id!==n?t:(0,i.Z)({},e)});C((0,l.Z)(t))}else{e.id=(null==w?void 0:w.length)+1;var r=w.concat(e);C((0,l.Z)(r))}m.close()},$=function(e){var n,t=aM({type:e,invoiceType:Z,vatId:null===(n=u.supplier)||void 0===n?void 0:n.vatId});m.show({content:(0,r.jsx)(aJ,{onSuccess:k,toggleShow:m.close,defaultValues:t}),submit:!1,title:"Insert Item",xs3:"100vw",sm:"100vw",sm2:"80vw",sm3:"70vw",md2:"60vw",lg:"50vw",lg2:"40vw"})},H=function(e,n){var t,i=aO({rowData:n.rowData,invoiceType:Z,vatId:null===(t=u.supplier)||void 0===t?void 0:t.vatId});m.show({content:(0,r.jsx)(aJ,{editMode:!0,onSuccess:k,toggleShow:m.close,defaultValues:i}),submit:!1,title:"Edit Item",xs3:"100vw",sm:"100vw",sm2:"80vw",sm3:"70vw",md2:"60vw",lg:"50vw",lg2:"40vw"})},M=function(e,n){w.splice(w.findIndex(function(e){return e.id===n.id}),1),C((0,l.Z)(w))},O=[{text:"ID",hidden:!0},{text:"Description"},{hidden:!1,text:"Quantity"},{hidden:!1,text:"Rate"},{hidden:!1,text:"Net"},{hidden:!1,text:"VAT % "},{hidden:!1,text:"VAT"},{hidden:!1,text:"Gross"},{hidden:!0},{formatter:eW.Z,formatterData:(0,r8.N)(null,{onEditClick:H,onDeleteClick:M}),text:"Actions",hidden:c}],N=w.reduce(function(e,n){return e+(n.net||0)},0),F=w.reduce(function(e,n){return e+(n.vat||0)},0),J=w.reduce(function(e,n){return e+(n.gross||0)},0),U={control:h,errors:b,register:x};return E?(0,r.jsx)(eH.Z,{style:{justifyContent:"center",alignItems:"center"},children:(0,r.jsx)(L.Z,{size:30})}):(0,r.jsxs)(ea.Z,{id:"offCanvasForm",handleSubmit:g(D),children:[!(0,l.Z)(iS.pX).concat((0,l.Z)(iS.YK)).includes(null==d?void 0:d.invoiceType)&&(0,r.jsxs)(r.Fragment,{children:[!c&&(0,r.jsx)(eH.Z,{children:(0,r.jsx)(eM.Z,{md:12,children:(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},U),{name:"type",data:aQ}))})}),(0,r.jsx)(eH.Z,{children:(0,r.jsxs)(eM.Z,{md:12,children:[(0,r.jsx)(t1.Z,{}),(0,r.jsxs)(aY,{align:"center",justify:"between",children:[(0,r.jsx)(ey.Z,{children:"Labour"}),!c&&(0,r.jsx)(ej.Z,{content:"Insert Labour Item",context:"secondary",onClick:function(){return $("Labour")},size:"sm"})]}),(0,r.jsx)(e1.Z,{columns:O,rows:w.filter(function(e){return"Labour"===e.type}).map(function(e,n){return{id:n,description:e.description,units:e.unit,unitCost:(0,ee.Z)(null==e?void 0:e.unitCost),net:(0,ee.Z)(e.net),vatPercent:"".concat(e.vatPercent,"%"),vat:(0,ee.Z)(e.vat),gross:(0,ee.Z)(e.gross),rowData:e,action:""}})}),(0,r.jsx)(t1.Z,{}),(0,r.jsxs)(aY,{align:"center",justify:"between",children:[(0,r.jsx)(ey.Z,{children:"Materials"}),!c&&(0,r.jsx)(ej.Z,{content:"Insert Materials Item",context:"secondary",onClick:function(){return $("Materials")},size:"sm"})]}),(0,r.jsx)(e1.Z,{columns:O,rows:w.filter(function(e){return"Materials"===e.type}).map(function(e){return{id:e.id,description:e.description,units:e.unit,unitCost:(0,ee.Z)(null==e?void 0:e.unitCost),net:(0,ee.Z)(e.net),vatPercent:"".concat(e.vatPercent,"%"),vat:(0,ee.Z)(e.vat),gross:(0,ee.Z)(e.gross),rowData:e,action:""}})}),(0,r.jsxs)(aG,{children:[(0,r.jsxs)(aB,{children:[(0,r.jsx)("div",{children:"Net Total :"})," ",(0,r.jsx)("div",{children:(0,ee.Z)(N)})]}),(0,r.jsxs)(aB,{children:[(0,r.jsx)("div",{children:"VAT Total :"})," ",(0,r.jsx)("div",{children:(0,ee.Z)(F)})]}),(0,r.jsxs)(aB,{children:[(0,r.jsx)("div",{children:"Gross Total :"})," ",(0,r.jsx)("div",{children:(0,ee.Z)(J)})]})]})]})}),(0,r.jsx)(t1.Z,{}),(0,r.jsx)(eH.Z,{children:(0,r.jsx)(eM.Z,{md:12,children:c?(0,r.jsx)(e0.Z,{content:"Description",text:null==d?void 0:null===(a=d.configs)||void 0===a?void 0:a.descriptionInvoice}):(0,r.jsx)(eg.Z,{label:"Description",children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},U),{name:"description",rows:2,disabled:c}))})})}),(0,r.jsx)(t1.Z,{}),(0,r.jsx)(eH.Z,{children:(0,r.jsx)(eM.Z,{md:6,children:!c&&(0,r.jsx)(eg.Z,{label:"Due date",children:(0,r.jsx)(eP.M,(0,ei.Z)((0,i.Z)({},U),{name:"dueDate",placeholder:"Due date"}))})})})]}),(null==d?void 0:null===(s=d.accountEntry)||void 0===s?void 0:s.id)&&(0,r.jsx)(aP,{currency:"GBP",accountEntryId:d.accountEntry.id})]})};az.propTypes={job:A.object,showDetails:A.bool,defaultValues:A.object,refetch:A.func,toggleShow:A.func};var aY=(0,no.ZP)(eH.Z).withConfig({displayName:"addInvoiceForm__StyledRow",componentId:"sc-5ce6a642-0"})(aL()),aB=no.ZP.div.withConfig({displayName:"addInvoiceForm__StyledText",componentId:"sc-5ce6a642-1"})(aU()),aG=no.ZP.div.withConfig({displayName:"addInvoiceForm__StyledTextBox",componentId:"sc-5ce6a642-2"})(aV()),aW=t(9367),aK=function(e){var n,t,i,a=e.job,u=e.refetch,l=e.type,d=e.financeSupplier,p=e.financeCustomer,m=e.expanded,f=e.onChangeExpanded,v=(0,e8.a)(),h=(0,D.x)(),b=(0,W.E)(a,"closed"),g=(0,c.a)(ik.Rm,{variables:{jobId:a.id}}),x=g.loading,j=g.data,y=void 0===j?{invoices:[],meta:{aggregate:{totalCount:0}}}:j,Z=y.invoices,I=y.meta,S=g.refetch,w=(0,o.useMemo)(function(){return Z.filter(function(e){return iS.SR[l].includes(e.invoiceType)})},[l,Z]),C=(0,o.useMemo)(function(){return al(w)},[w]),R=C.invoicedToDate,_=C.reconciledAmount,A="customer"===l?(null==p?void 0:null===(n=p.amountInfo)||void 0===n?void 0:n.vatTotal)||0:(null==d?void 0:null===(t=d.amountInfo)||void 0===t?void 0:t.vatTotal)||0,E=function(e){e.stopPropagation(),v.show({content:(0,r.jsx)(az,{job:a,refetch:function(){S(),u()},toggleShow:v.close}),title:"Create invoice",xs3:"100vw",sm:"100vw",sm2:"80vw",sm3:"70vw",md2:"60vw",lg:"50vw",lg2:"40vw"})},P=(i=(0,q.Z)(function(e,n){var t,i,r,o,a,s,u;return(0,T.__generator)(this,function(a){switch(a.label){case 0:if(e.stopPropagation(),i=(t=n.rowData).invoiceType,r=t.accountEntry,!iS.cJ.includes(i))return[3,2];return[4,h.query({query:ik.WG,variables:{id:t.id}})];case 1:return u=a.sent().data.invoice,(0,aW.u)({meta:null==u?void 0:null===(o=u.accountEntry)||void 0===o?void 0:o.meta,invoice:u}),[3,3];case 2:iS.pX.includes(i)?(0,iP._Z)({client:h,jobId:t.entityId,type:i}):"customerPpmInvoice"===r.type?(0,i$.$)(r.meta):"supplierPpmInvoice"===r.type&&(0,iN.W)({client:h,accountEntryId:r.id}),a.label=3;case 3:return[2]}})}),function(e,n){return i.apply(this,arguments)}),M=function(e){v.show({content:(0,r.jsx)(az,{showDetails:!0,defaultValues:e.rowData}),submit:!1,title:"Items Details",xs3:"100vw",sm:"100vw",sm2:"80vw",sm3:"70vw",md2:"60vw",lg:"50vw",lg2:"40vw"})},L=function(e){return[{context:"secondary",icon:"download",onClick:function(n){return P(n,e)},tooltip:"Download"},{context:"secondary",icon:"info",onClick:function(n){return M(e)},tooltip:"Details",disabled:"Location"===e.entity}]},U=function(e){e.stopPropagation(),s().push(aX[l](a))};return(0,r.jsxs)(k.Z,{expanded:m,onChange:f,children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),children:(0,r.jsxs)(F.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(J.Z,{variant:"h6",children:"Invoices"}),(0,r.jsx)(oX.Z,{size:"small",onClick:U,children:(0,r.jsx)(a_.Z,{sx:{height:"17px",width:"17px"}})})]})}),(0,r.jsx)($.Z,{children:(0,r.jsxs)(F.Z,{spacing:2,children:[(0,r.jsxs)(N.ZP,{container:!0,columnSpacing:1,children:[(0,r.jsxs)(N.ZP,{item:!0,xs:4,children:[(0,r.jsx)(J.Z,{children:"Invoiced to date"}),(0,r.jsx)(J.Z,{children:(0,nB.T)(R)})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:4,children:[(0,r.jsx)(J.Z,{children:"Amount outstanding"}),(0,r.jsx)(J.Z,{children:(0,nB.T)(R-_)})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:4,children:[(0,r.jsx)(J.Z,{children:"Amount to be invoiced"}),(0,r.jsx)(J.Z,{children:(0,nB.T)(A-R)})]})]}),(0,r.jsx)(nm.i,{columns:[{field:"number",headerName:"Number",minWidth:100,sortable:!1},{field:"type",headerName:"Type",minWidth:200,sortable:!1},{field:"vatTotal",headerName:"VAT total",minWidth:100,sortable:!1,renderCell:function(e){var n=e.value;return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(n)})}},{field:"date",headerName:"Date",minWidth:150,sortable:!1},{field:"dueDate",headerName:"Due Date",minWidth:150,sortable:!1},{field:"status",headerName:"Status",minWidth:100,sortable:!1},{field:"actions",headerName:"",width:50,sortable:!1,renderCell:function(e){var n=e.row;return(0,r.jsx)(aC.C,{actionsData:L,row:n})}}],rows:null==w?void 0:w.map(function(e){var n,t,i,r,o,a,s,u;return{id:e.id,number:e.invoiceNumber,type:e.invoiceType,entity:e.entity,total:(null===(n=e.amounts)||void 0===n?void 0:n.vatRate)?(null===(t=e.amounts)||void 0===t?void 0:t.vatTotal)/(1+(null===(i=e.amounts)||void 0===i?void 0:i.vatRate)):null===(r=e.amounts)||void 0===r?void 0:r.vatTotal,vatRate:null===(o=e.amounts)||void 0===o?void 0:o.vatRate,date:X()(e.createdAt).format("YYYY-MM-DD"),dueDate:X()(null===(a=e.accountEntry)||void 0===a?void 0:a.dueDate).format("YYYY-MM-DD"),status:null===(s=e.accountEntry)||void 0===s?void 0:s.paymentStatus,vatTotal:null===(u=e.amounts)||void 0===u?void 0:u.vatTotal,rowData:e,action:""}}),meta:I,loading:x,noResultsMessage:"There are currently no invoices."}),!b&&(0,r.jsx)(O.Z,{color:"secondary",variant:"contained",sx:{alignSelf:"center"},onClick:E,children:"Create ad-hoc invoice"})]})})]})};aK.defaultProps={onChangeExpanded:function(){}},aK.propTypes={job:E().object.isRequired,refetch:E().func.isRequired,type:E().oneOf(["customer","supplier"]),expanded:E().bool,onChangeExpanded:E().func};var aX={customer:function(e){var n;return"/dashboard/customers/view?id=".concat(null===(n=e.customer)||void 0===n?void 0:n.id,"&tab=finance")},supplier:function(e){var n;return"/dashboard/suppliers/view?id=".concat(null===(n=e.supplier)||void 0===n?void 0:n.id,"&tab=finance")}},a0=O.Z,a1=function(e){var n,t,i,a=e.job,u=e.refetch,c=(0,D.x)(),d=(0,nv.x)().hasRole,p=(0,o.useContext)(U.Z),m=(0,e8.a)(),f=d("admin"),v=d("supplier"),h=d("customer"),b=d("tenant"),g=(0,W.E)(a,["validated","unvalidated"]),x=(0,W.E)(a,"invoiceSent"),j="pending"===a.status,y=(0,W.E)(a,"closed"),Z=(0,o.useState)(!f&&v?"supplier":"customer"),I=Z[0],S=Z[1],w=(0,o.useState)([]),C=w[0],R=w[1],_=(0,o.useState)(null),A=_[0],E=_[1],P=(0,o.useState)(null),O=P[0],L=P[1],V=(null===(n=a.media)||void 0===n?void 0:n.filter(function(e){var n;return(null===(n=e.item)||void 0===n?void 0:n.category)==="invoice"}).length)||0,z=ac({financeCustomer:O,financeSupplier:A}),Y=z.netProfitAmount,B=z.netProfitMargin,K=function(){s().push("quote"===a.type?"/dashboard/issues/manage?id=".concat(a.number,"&quoted=1"):"/dashboard/issues/manage?id=".concat(a.number))};(0,o.useEffect)(function(){(0,q.Z)(function(){var e,n,t;return(0,T.__generator)(this,function(i){switch(i.label){case 0:return[4,(0,eT.F)(c,a.id)];case 1:return n=(e=i.sent()).financeSupplier,t=e.financeCustomer,E(n),L(t),[2]}})})()},[E,L,a.expenses,a.financeLogs,c,a.id]);var X,ee=function(e){e.stopPropagation(),p.show({content:(0,r.jsx)(e2.G,{category:"invoice",entity:"Job",entityId:a.id,onMediaAdd:u,type:"document"}),submit:!1,title:"Upload Invoice"})},en=function(e){e.stopPropagation(),m.show({content:(0,r.jsx)(nj,{job:a,refetchJob:u,activeTab:I}),title:"Update Amounts",submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"65vw",md2:"50vw",lg:"50vw",lg2:"50vw"})},et=function(e){return function(n){n.stopPropagation(),S(e)}},ei=[{id:1,label:"Gross",value:"customer"===I?null==O?void 0:null===(t=O.amountInfo)||void 0===t?void 0:t.vatTotal:null==A?void 0:null===(i=A.amountInfo)||void 0===i?void 0:i.vatTotal}];return(0,r.jsxs)(M.Z,{children:[(0,r.jsxs)(k.Z,{expanded:C.includes("finance-content"),onChange:(X="finance-content",function(e,n){n?R(function(e){return(0,l.Z)(e).concat([X])}):R(function(e){return e.filter(function(e){return e!==X})})}),children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),children:(0,r.jsxs)(F.Z,{width:"100%",spacing:1,children:[(0,r.jsxs)(F.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,r.jsxs)(F.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(J.Z,{variant:"h6",children:"Finance"}),f&&null!==a.pricing&&!y&&!g&&(0,r.jsx)(oX.Z,{size:"small",onClick:en,children:(0,r.jsx)(Q.Z,{sx:{height:"17px",width:"17px"}})})]}),!y&&!g&&!h&&!b&&(0,r.jsx)(at.Z,{color:"info",badgeContent:V,showZero:!0,children:(0,r.jsx)(a0,{disableMinWidth:!0,color:"info",variant:"contained",size:"small",onClick:ee,children:(0,r.jsx)(ar.Z,{})})})]}),f&&null!==a.pricing&&(0,r.jsxs)(ie.Z,{children:[(0,r.jsx)(a2,{color:"secondary",variant:"customer"===I?"contained":"outlined",onClick:et("customer"),children:"Customer"}),(0,r.jsx)(a2,{color:"primary",variant:"supplier"===I?"contained":"outlined",onClick:et("supplier"),children:"Supplier"})]}),!C.includes("finance-content")&&null!==a.pricing&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(nm.i,{hideHeader:!0,columns:[{field:"label",flex:1,sortable:!1,renderCell:function(e){var n=e.value;return(0,r.jsx)(J.Z,{fontWeight:700,children:n})}},{field:"value",flex:1,sortable:!1,align:"right",renderCell:function(e){var n=e.value;return(0,r.jsx)(r.Fragment,{children:(h||b)&&!x?"N/A":(0,nB.T)(n)})}}],rows:ei}),(0,r.jsx)(ai.Z,{})]}),d("admin")&&"customer"===I&&(0,r.jsxs)(N.ZP,{container:!0,children:[(0,r.jsxs)(N.ZP,{item:!0,xs:4,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Net Profit"}),(0,r.jsx)(J.Z,{children:(0,nB.T)(Y||0)})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:8,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Net Profit Margin"}),(0,r.jsxs)(J.Z,{children:[B||0,"%"]})]})]})]}),null===a.pricing&&(0,r.jsxs)(F.Z,{spacing:2,children:[(0,r.jsx)(nx.Z,{severity:"error",children:"Finance information will only be available once job has been created."}),f&&!j&&!y&&(0,r.jsx)(a0,{color:"danger",variant:"contained",size:"large",onClick:function(e){e.stopPropagation(),d("admin")?K():n9(a,p,u)},children:"Change job pricing or service"})]})]})}),(0,r.jsx)($.Z,{sx:{pt:0},children:null!==a.pricing&&(O&&"customer"===I||A&&"supplier"===I)&&(0,r.jsx)(ad,{job:a,type:I,financeSupplier:A,financeCustomer:O})})]}),C.includes("finance-content")&&(0,W.E)(a,"accepted")&&(0,r.jsx)(aq,{expanded:C.includes("finance-content"),job:a,refetchParent:u,tab:I}),d("admin")&&"quote"!==a.type&&(0,r.jsx)(aK,{job:a,refetch:u,type:I,financeSupplier:A,financeCustomer:O})]})};a1.defaultProps={},a1.propTypes={job:E().object.isRequired,refetch:E().func.isRequired};var a2=(0,oW.ZP)(a0)(function(){return{height:"30px"}}),a4=t(49418),a3=(0,el.Ry)().shape({relatedSelected:(0,el.Ry)().required(),relType:(0,el.Z_)().required()}),a6=function(e){var n,t,o,a,s,u=e.job,l=e.submit,c=(0,er.cI)({resolver:(0,eo.S)(a3)}),d=c.control,p=c.errors,m=c.handleSubmit,f=c.register,v=c.watch,h={control:d,errors:p,register:f},b=v("relatedSelected"),g=v("relType"),x=function(e){l(e)};return(0,r.jsxs)(ea.Z,{id:"offCanvasForm",handleSubmit:m(x),children:[(0,r.jsx)(eb.Z,(0,ei.Z)((0,i.Z)({},h),{legend:"Relation Type",name:"relType",data:[{id:"parent",label:"Parent",value:"parent"},{id:"child",label:"Child",value:"child"}]})),(0,r.jsx)(eu.P,(0,ei.Z)((0,i.Z)({},h),{errors:(0,i.Z)({},p),label:"Work Orders",locationId:u.locationId,name:"relatedSelected",type:"job"})),b&&(0,r.jsxs)("div",{children:[(0,r.jsx)(e0.Z,{content:"Id",text:b.number}),(0,r.jsx)(e0.Z,{content:"Title",text:b.title}),(0,r.jsx)(e0.Z,{content:"Date",text:(0,en.Z)(null==b?void 0:b.timingStart)}),(0,r.jsx)(e0.Z,{content:"Short Job Description",text:(null==b?void 0:b.Taxonomy.length)>0&&null!==(a=null===(n=null==b?void 0:b.Taxonomy[0].Taxonomy)||void 0===n?void 0:n.shortJobDescription)&&void 0!==a?a:"-"}),(0,r.jsx)(e0.Z,{content:"Address",text:null!==(s=null==b?void 0:null===(t=b.Location)||void 0===t?void 0:t.name)&&void 0!==s?s:""}),(0,r.jsx)(e0.Z,{content:"Status",text:null===(o=ol.yW.find(function(e){return e.value===b.status}))||void 0===o?void 0:o.text}),(0,r.jsx)("br",{})]}),"parent"===g&&u.parentId&&(0,r.jsx)(ev.Z,{content:"This job already has a parent job defined. Do you want to update it?",context:"warning"})]})};a6.propTypes={submit:A.func.isRequired};var a5=function(e){var n,t,i,a,s=e.job,u=e.refetch,l=e.expanded,c=e.onChangeExpanded,d=(0,tQ.q)(),m=(0,nv.x)().hasRole,f=(0,o.useContext)(U.Z),v=null===(n=d.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,h=null===(t=d.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,b=[],g=(0,_.Z)((0,P.D)(p.qD),1)[0],x=function(e){return[{context:"danger",icon:"delete",onClick:function(n){return Z(n,e)},tooltip:"Delete"}]},j=[{field:"relType",headerName:"Relation",flex:1,sortable:!1},{field:"number",headerName:"Number",flex:1,sortable:!0,renderCell:function(e){var n=e.row;return(0,r.jsx)(tV.D,{id:n.id,number:n.number,openCanvas:!0,type:n.type,numberPrefix:v,numberSuffix:h})}},{field:"actions",headerName:"",width:50,sortable:!1,hide:!m("admin"),renderCell:function(e){var n=e.row;return(0,r.jsx)(aC.C,{actionsData:x,row:n})}}];s.parentJob&&b.push({relType:"parent",id:s.parentJob.id,type:s.parentJob.type,number:s.parentJob.number,reference:s.parentJob.reference,status:(null===(i=ol.yW.find(function(e){return e.value===s.parentJob.status}))||void 0===i?void 0:i.text)||"",date:X()(s.parentJob.createdAt).format("YYYY-MM-DD"),actions:""}),(null===(a=s.childJobs)||void 0===a?void 0:a.length)&&s.childJobs.forEach(function(e){var n=(ol.yW.find(function(n){return n.value===e.status})||"").text;b.push({relType:"child",id:e.id,type:e.type,number:e.number,reference:e.reference,status:n,date:X()(e.createdAt).format("YYYY-MM-DD"),actions:""})});var y,Z=function(e,n){g({variables:{id:"child"===n.relType?n.id:s.id,changes:{parentId:null}}}),e.stopPropagation(),u()},I=(y=(0,q.Z)(function(e){var n,t;return(0,T.__generator)(this,function(i){return n=e.relatedSelected,"parent"===(t=e.relType)&&n.value?g({variables:{id:s.id,changes:{parentId:n.value}}}):"child"===t&&n.value&&g({variables:{id:n.value,changes:{parentId:s.id}}}),u(),f.close(),[2]})}),function(e){return y.apply(this,arguments)}),S=function(e){f.show({content:(0,r.jsx)(a6,{job:s,submit:I,type:e}),title:"Related Works"})},w={actions:m("admin")};return(0,r.jsxs)(k.Z,{expanded:l,onChange:c,children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),children:(0,r.jsx)(J.Z,{variant:"h6",children:"Related Works"})}),(0,r.jsx)($.Z,{children:(0,r.jsxs)(F.Z,{width:"100%",children:[(0,r.jsx)(nm.i,{columns:j,rows:b,columnVisibilityModel:w}),m(["admin"])&&(0,r.jsx)(oX.Z,{sx:{alignSelf:"center"},onClick:function(){return S("parent")},children:(0,r.jsx)(aR.Z,{})})]})})]})};a5.defaultProps={onChangeExpanded:function(){}},a5.propTypes={job:E().object.isRequired,refetch:E().func.isRequired,expanded:E().bool,onChangeExpanded:E().func};var a7=t(87918),a9=a7.Z,a8=function(e){var n,t,o=e.job,a=(null===(n=rn.M2.find(function(e){var n;return e.value===(null==o?void 0:null===(n=o.report)||void 0===n?void 0:n.completion)}))||void 0===n?void 0:n.label)||"Unconfirmed";return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(a9,{color:function(){var e;switch(null==o?void 0:null===(e=o.report)||void 0===e?void 0:e.completion){case"complete":return"success";case"couldNotDo":return"danger";default:return"info"}}(),label:a,size:"small"}),(0,r.jsx)(a9,(0,ei.Z)((0,i.Z)({},function(){switch(null==o?void 0:o.timingStatus){case"correct":return{color:"success",label:"Timing: Correct"};case"incorrect":return{color:"danger",label:"Timing: Incorrect"};default:return{color:"info",label:"Timing: Unconfirmed"}}}()),{size:"small"})),(null===(t=o.report)||void 0===t?void 0:t.passFailStatus)&&(0,r.jsx)(a9,(0,ei.Z)((0,i.Z)({},function(){var e;switch(null===(e=o.report)||void 0===e?void 0:e.passFailStatus){case"Passed":return{label:"Passed",color:"success"};case"Failed":return{label:"Failed",color:"warning"};case"Failure resolved":return{label:"Failure resolved",color:"info"}}}()),{size:"small"}))]})};function se(){var e=(0,m.Z)(["\n  mutation ResolveJobReport(\n    $id: Int!\n    $changes: JobReport_set_input!\n    $timings: [JobTiming_insert_input!]!\n  ) {\n    update_JobReport(where: { id: { _eq: $id } }, _set: $changes) {\n      returning {\n        id\n      }\n    }\n    insert_JobTiming(objects: $timings) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return se=function(){return e},e}a8.propTypes={job:A.object},a8.defaultProps={job:{}};var sn=(0,f.Ps)(se()),st=el.Ry({comments:el.Z_().min(30,"Comments must have a minimum of 30 characters.").required()}),si=nI.Z,sr=function(e){var n,t,i=e.id,o=e.jobId,a=e.offCanvas,s=e.refetch,u=(0,er.cI)({defaultValues:{comments:""},resolver:(0,eo.S)(st)}),l=u.register,c=u.errors,d=u.handleSubmit,p=(0,_.Z)((0,P.D)(sn,{onCompleted:function(){a.close(),s()}}),1)[0],m=function(e){p({variables:{id:i,changes:{passFailStatus:"Failure resolved",comments:e.comments},timings:[{status:"reportFailureResolved",jobId:o,notes:e.comments,userId:1}]}})};return(0,r.jsx)("form",{id:"offCanvasForm",onSubmit:d(m),children:(0,r.jsx)(M.Z,{children:(0,r.jsx)(si,{fullWidth:!0,label:"Comments",multiline:!0,rows:4,maxRows:4,name:"comments",inputRef:l,error:null===(n=c.comments)||void 0===n?void 0:n.message,helperText:null===(t=c.comments)||void 0===t?void 0:t.message})})})};sr.defaultProps={offCanvas:{},refetch:function(){}},sr.propTypes={id:E().number.isRequired,jobId:E().number.isRequired,offCanvas:E().object.isRequired,refetch:E().func};var so=function(e){var n,t,i,o,a,s,u,l,c,d,p=e.job,m=e.refetch,f=e.expanded,h=e.onChangeExpanded,b=(0,e8.a)(),g=(0,nv.x)(),x=g.hasRole,j=g.user,y=null==j?void 0:j.invoiceThreshold,Z=null==p?void 0:p.supplierVatTotal,I=(0,tC.L)(p.timings),S=(0,W.E)(p,"inProgress"),w=(0,W.E)(p,"reportSentSupplier"),C=(0,W.E)(p,"closed"),R=(0,eS.nN)("supplier",null==p?void 0:p.timings),q=(0,_.Z)((0,P.D)(v.xY,{onCompleted:function(){m&&m()}}),1)[0],T=function(){b.show({content:(0,r.jsx)(rq,{job:p,offCanvas:b,refetch:m}),title:"Job Report",submit:(0,W.E)(p,"completed")})},A=function(){var e,n,t=[{jobId:p.id,status:"reportSentSupplier",userId:j.id}];(null===(e=p.report)||void 0===e?void 0:e.passFailStatus)==="Failed"&&t.push({jobId:p.id,status:"reportFailed",notes:null===(n=p.report)||void 0===n?void 0:n.recommendations,userId:j.id}),q({variables:{id:p.id,changes:{},timing:t}})},E=function(e){e.stopPropagation(),(0,tN.e)({job:p,adminId:j.adminId})},D=function(e){var n;e.stopPropagation(),b.show({content:(0,r.jsx)(sr,{id:null===(n=p.report)||void 0===n?void 0:n.id,jobId:p.id,offCanvas:b,refetch:m}),title:"Resolve",submit:!0})};return(0,r.jsxs)(k.Z,{expanded:f,onChange:h,children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),children:(0,r.jsxs)(F.Z,{direction:"row",children:[(0,r.jsx)(J.Z,{variant:"h6",children:"Report"}),(0,r.jsx)(sa,{direction:"row",alignItems:"center",flexWrap:"wrap",children:p.report&&(0,W.E)(p,"completed")&&(0,r.jsx)(a8,{job:p})})]})}),(0,r.jsx)($.Z,{children:(0,r.jsxs)(F.Z,{width:"100%",spacing:2,children:[(null===(n=p.report)||void 0===n?void 0:n.notes)?(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Notes"}),(0,r.jsx)(J.Z,{children:p.report.notes})]}):(0,r.jsx)(M.Z,{children:(0,r.jsx)(J.Z,{children:"The job report has not yet been created"})}),((null===(t=p.report)||void 0===t?void 0:t.passFailStatus)==="Failed"||(null===(i=p.report)||void 0===i?void 0:i.passFailStatus)==="Failure resolved")&&(null===(o=p.report)||void 0===o?void 0:o.recommendations)&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",sx:{fontWeight:700},children:"Recommendations"}),(0,r.jsx)(J.Z,{sx:{fontWeight:700},children:p.report.recommendations})]}),(null===(a=p.report)||void 0===a?void 0:a.passFailStatus)==="Failure resolved"&&(null===(s=p.report)||void 0===s?void 0:s.comments)&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",sx:{fontWeight:700},children:"Comments"}),(0,r.jsx)(J.Z,{sx:{fontWeight:700},children:p.report.comments})]}),S&&!w&&"onHold"!==I&&!C&&(0,r.jsxs)(F.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,r.jsx)(O.Z,{color:"secondary",variant:"contained",onClick:T,children:p.report?"Update Report":"Create Report"}),x("supplier")&&((0,ew.il)(y,Z)||R)&&(0,r.jsx)(O.Z,{variant:"contained",onClick:A,disabled:!(null===(u=p.report)||void 0===u?void 0:u.completion),children:"Submit Report"}),x("supplier")&&!((0,ew.il)(y,Z)||R)&&(0,r.jsx)(O.Z,{variant:"contained",onClick:function(){return(0,eI.I_)({type:"issue",role:"supplier",jobId:p.id,accountId:j.accountId,amount:Z,offCanvas:b})},disabled:!(null===(l=p.report)||void 0===l?void 0:l.completion),children:"Request approval"}),!x("supplier")&&(0,r.jsx)(O.Z,{variant:"contained",onClick:A,disabled:!(null===(c=p.report)||void 0===c?void 0:c.completion),children:"Submit Report"})]}),(0,r.jsxs)(F.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[p.report&&w&&x("admin")&&(0,r.jsx)(O.Z,{color:"secondary",variant:"contained",onClick:E,children:"Download report"}),(null===(d=p.report)||void 0===d?void 0:d.passFailStatus)==="Failed"&&w&&x("admin")&&(0,r.jsx)(O.Z,{color:"secondary",variant:"contained",onClick:D,children:"Resolve"})]})]})})]})};so.defaultProps={onChangeExpanded:function(){}},so.propTypes={job:E().object.isRequired,refetch:E().func.isRequired,expanded:E().bool,onChangeExpanded:E().func};var sa=(0,ri.Z)(F.Z)(function(){return{rowGap:"4px","& .MuiChip-root":{marginLeft:"16px"}}}),ss=function(e){var n,t,o,a,s,u,l,c,d,m,f,v,h,b,g,x=e.job,j=e.refetch,y=(0,e8.a)(),Z=(0,nv.x)().hasRole,I=x.shortJobDesc&&x.shortJobDesc.length?x.shortJobDesc[0].taxonomy.name:"",S=x.assets||[],w=null===(n=x.answers)||void 0===n?void 0:n.map(function(e){var n;return{id:e.id,taxonomyId:e.taxonomyId,comments:e.comments,name:null===(n=e.taxonomy)||void 0===n?void 0:n.name}}),C=(0,_.Z)((0,P.D)(p.FA),1)[0],R=(g=(0,q.Z)(function(e){var n,t,r;return(0,T.__generator)(this,function(o){switch(o.label){case 0:return n=(0,ny.eD)(e,x.id),t=(0,ny.G2)(e),r=(0,ny.a6)(x,e).meta,delete e.questions,delete e.taxonomyId_ShortDesc,[4,C({variables:{jobId:x.id,originatorEmail:t.email,originatorChanges:t,changes:(0,ei.Z)((0,i.Z)({},e),{meta:r}),questions:n,hasQuestions:n.length>0}})];case 1:return o.sent(),y.close(),j(),[2]}})}),function(e){return g.apply(this,arguments)}),A=function(e){e.stopPropagation(),y.show({content:(0,r.jsx)(n_,{description:x.description||"",handleWorkDescriptionSubmit:R,job:x,currentQuestions:w}),title:"Work Description"})};return(0,r.jsxs)(M.Z,{children:[(0,r.jsxs)(k.Z,{children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),children:(0,r.jsx)(F.Z,{width:"100%",spacing:2,children:(0,r.jsxs)(F.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,r.jsx)(J.Z,{variant:"h6",children:"Issue Reported"}),Z(["admin"])&&!(0,W.E)(x,"validated")&&(0,r.jsx)(oX.Z,{size:"small",onClick:A,children:(0,r.jsx)(Q.Z,{sx:{height:"17px",width:"17px"}})})]})})}),(0,r.jsxs)($.Z,{children:[(0,r.jsxs)(N.ZP,{container:!0,children:[(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Short Job Description"}),(0,r.jsx)(oK.O,{maxLength:20,children:I||"-"})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Job Description"}),(0,r.jsx)(oK.O,{maxLength:20,children:x.description||"-"})]}),S.length>0&&(0,r.jsxs)(N.ZP,{item:!0,xs:12,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Asset(s)"}),(0,r.jsx)(oK.O,{maxLength:100,children:S.map(function(e){var n=e.asset;return(0,r.jsxs)(o7.r,{color:"secondary",href:"/dashboard/assets/view?id=".concat(n.id),noWrap:Z("tenant"),children:[(null==n?void 0:n.name)||"-",";"]})})})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:12,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Issue description"}),(0,r.jsx)(oK.O,{maxLength:20,children:x.issueReportedDescription||"-"})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:12,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Issue type"}),(0,r.jsx)(oK.O,{maxLength:20,children:(null===(t=x.issueTypes)||void 0===t?void 0:null===(o=t[0])||void 0===o?void 0:null===(a=o.issue)||void 0===a?void 0:a.name)||"-"})]}),(null===(s=x.meta)||void 0===s?void 0:null===(u=s.reporter)||void 0===u?void 0:u.email)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.ZP,{item:!0,xs:12,mt:1,mb:1,children:(0,r.jsx)(J.Z,{typography:"subtitle1",children:"Originator"})}),(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Email"}),(0,r.jsx)(oK.O,{maxLength:20,children:(null===(l=x.meta)||void 0===l?void 0:null===(c=l.reporter)||void 0===c?void 0:c.email)||"-"})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Name"}),(0,r.jsx)(oK.O,{maxLength:20,children:"".concat(null===(d=x.meta)||void 0===d?void 0:null===(m=d.reporter)||void 0===m?void 0:m.nameFirst," ").concat(null===(f=x.meta)||void 0===f?void 0:null===(v=f.reporter)||void 0===v?void 0:v.nameLast)||"-"})]}),(0,r.jsxs)(N.ZP,{item:!0,xs:6,children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Phone"}),(0,r.jsx)(oK.O,{maxLength:20,children:(null===(h=x.meta)||void 0===h?void 0:null===(b=h.reporter)||void 0===b?void 0:b.phone)||"-"})]})]})]}),(0,r.jsx)(a4.y,{answers:w})]})]}),Z(["admin","customer","tenant"])&&(0,r.jsx)(a5,{job:x,refetch:j}),Z(["admin","supplier"])&&(0,r.jsx)(so,{job:x,refetch:j})]})};ss.defaultProps={},ss.propTypes={job:E().object.isRequired,refetch:E().func.isRequired};var su=t(83704),sl=t.n(su),sc=t(96486),sd=(0,el.Ry)().shape({assignedTo:(0,el.Ry)().required()}),sp=function(e){var n,t=e.defaultValues,o=e.onSuccess,a=e.user,s=(0,er.cI)({defaultValues:t,resolver:(0,eo.S)(sd)}),u=s.control,l=s.errors,c=s.handleSubmit,d={control:u,errors:l,register:s.register},p=(n=(0,q.Z)(function(e){return(0,T.__generator)(this,function(n){return o(e),[2]})}),function(e){return n.apply(this,arguments)});return(0,r.jsxs)(ea.Z,{id:"offCanvasForm",handleSubmit:c(p),children:[(0,r.jsx)(eu.P,(0,ei.Z)((0,i.Z)({},d),{accountId:a.accountId,errors:(0,i.Z)({},l),label:"Assigned to",name:"assignedTo",type:"user"})),(0,r.jsx)(eg.Z,{label:"Customer reference",children:(0,r.jsx)(ex.Z,(0,ei.Z)((0,i.Z)({},d),{name:"reference"}))})]})};sp.propTypes={defaultValues:A.object,onSuccess:A.func.isRequired,user:A.object.isRequired};var sm=t(62547),sf=t(74833),sv=t(52666);sl()(X());var sh=function(e){var n,t,a,s,u,l,c,d,m,f,v,h,b,g,x,j,y=e.job,Z=e.refetch,I=e.isQuotes,S=e.showOrder,w=e.expanded,C=e.onChangeExpanded,R=(0,tQ.q)(),A=(0,nv.x)(),E=A.hasRole,N=A.user,L=(0,D.x)(),V=(0,o.useContext)(U.Z),z=(0,er.cI)({defaultValues:{relatedLinks:(null==y?void 0:y.relatedLinks)||[]}}),Y=z.setValue,B=z.watch,W=z.register,K=z.handleSubmit,ee=(0,sv.b)(y),en=null==R?void 0:null===(n=R.admin)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:null===(a=t.supplierInstructions)||void 0===a?void 0:a.terms,et=null===(s=R.admin)||void 0===s?void 0:null===(u=s.jobSetting)||void 0===u?void 0:u.jobNumberPrefix,ei=null===(l=R.admin)||void 0===l?void 0:null===(c=l.jobSetting)||void 0===c?void 0:c.jobNumberSuffix,eo=B("relatedLinks"),ea=(0,_.Z)((0,P.D)(p.qD,{onCompleted:(0,q.Z)(function(){return(0,T.__generator)(this,function(e){switch(e.label){case 0:if(!y)return[3,2];return[4,(0,eT.F)(L,y.id)];case 1:e.sent(),e.label=2;case 2:return Z(),[2]}})})}),1)[0],es=function(e){ea({variables:{id:y.id,changes:e}})},eu=function(e){e.stopPropagation();var n,t,i,o,a={reference:y.reference,location:y.location};(null===(n=y.manager)||void 0===n?void 0:n.id)&&(a.assignedTo={value:null===(t=y.manager)||void 0===t?void 0:t.id,label:"".concat(null===(i=y.manager)||void 0===i?void 0:i.nameFirst," ").concat(null===(o=y.manager)||void 0===o?void 0:o.nameLast)}),V.show({content:(0,r.jsx)(sp,{defaultValues:a,onSuccess:el,user:N}),title:"Edit Assignee"})},el=(j=(0,q.Z)(function(e){return(0,T.__generator)(this,function(n){return ea({variables:{id:y.id,changes:{managerId:e.assignedTo.value,reference:e.reference}}}),Z(),V.close(),[2]})}),function(e){return j.apply(this,arguments)});return(0,r.jsxs)(k.Z,{expanded:w,onChange:C,children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),children:(0,r.jsxs)(F.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(J.Z,{variant:"h6",children:"Details"}),E("admin")&&(0,r.jsx)(oX.Z,{size:"small",onClick:eu,children:(0,r.jsx)(Q.Z,{sx:{height:"17px",width:"17px"}})})]})}),(0,r.jsx)($.Z,{children:(0,r.jsx)(F.Z,{direction:"row",children:(0,r.jsxs)(F.Z,{spacing:1,sx:{width:"100%",height:"auto"},children:[E(["admin","supplier"])&&en&&(0,r.jsx)(M.Z,{children:(0,r.jsx)(nx.Z,{severity:"warning",children:en})}),S&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Order"}),(0,r.jsx)(J.Z,{children:(0,r.jsx)(tV.D,{id:y.id,number:y.number,numberPrefix:et,numberSuffix:ei,type:y.type})})]}),y.tenantUser&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Tenant"}),(0,r.jsx)(J.Z,{children:y.tenantUser&&y.tenantUser.fullName})]}),!I&&y.reference&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Reference"}),(0,r.jsx)(J.Z,{children:y.reference})]}),(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:I?"Description":"Short Job Description"}),(0,r.jsx)(J.Z,{children:(null==y?void 0:null===(d=y.shortJobDesc)||void 0===d?void 0:d.length)>0&&(null===(m=null==y?void 0:y.shortJobDesc[0])||void 0===m?void 0:m.taxonomy.name)||y.title})]}),(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Status"}),(0,r.jsx)(tL.B,{value:y.status})]}),I&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Quote due date"}),(0,r.jsxs)(J.Z,{children:[X()(y.quoteDue).format("YYYY-MM-DD")," "]})]}),I&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Supplier(s)"}),y.quotations.map(function(e){return(0,r.jsxs)(J.Z,{children:[e.supplier.name," "]})})]}),I&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Quotation"}),(0,r.jsxs)(J.Z,{children:[y.quotations.length," "]})]}),I&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Received"}),(0,r.jsx)(J.Z,{children:"".concat((y.quotations||[]).reduce(function(e,n){return"supplierQuoteComplete"===n.status?e+1:e},0),"/").concat((null===(f=y.quotations)||void 0===f?void 0:f.length)||0)})]}),!I&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Cost Category"}),(0,r.jsx)(J.Z,{children:null===(v=y.costCategoryTaxonomy)||void 0===v?void 0:v.name})]}),!I&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Service"}),(0,r.jsx)(J.Z,{children:null===(h=y.service)||void 0===h?void 0:h.name})]}),y.estimatedDuration&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Estimated duration"}),(0,r.jsx)(J.Z,{children:X().duration(y.estimatedDuration).format()})]}),!I&&"ppm"!==y.type&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Priority"}),(0,r.jsx)(J.Z,{children:(0,r.jsx)(r.Fragment,{children:"".concat((null==ee?void 0:ee.name)||"Not Specified "," (").concat((null==ee?void 0:ee.entity)||"Default",")")})})]}),(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Assigned To"}),(0,r.jsx)(J.Z,{children:y.manager?"".concat(y.manager.nameFirst," ").concat(y.manager.nameLast," "):"Unassigned"})]}),E(["admin","customer","supplier"])&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Permits required"}),(0,r.jsx)(J.Z,{children:(null===(b=y.location)||void 0===b?void 0:b.permitsRequired)?"Yes":"No"})]}),E("admin")&&(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{typography:"subtitle2",children:"Tags"}),(0,r.jsx)(F.Z,{direction:"row",columnGap:1,rowGap:2,sx:{marginTop:"5px",flexWrap:"wrap"},children:null===(g=y.tags)||void 0===g?void 0:g.map(function(e){var n;return(0,r.jsx)(sf.V,{tagEntityId:e.id,name:e.tag.name,color:null===(n=e.tag.meta)||void 0===n?void 0:n.color},null==e?void 0:e.tag.id)})})]}),y.compliance&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Compliance Category"}),(0,r.jsx)(J.Z,{children:y.compliance.complianceCategory.name}),(0,r.jsx)(J.Z,{children:y.compliance.parentCompliance.name})]}),(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(J.Z,{variant:"subtitle2",children:"Compliance"}),(0,r.jsx)(J.Z,{children:y.compliance.name})]})]}),(0,r.jsxs)("form",{id:"relatedLinksForm",onSubmit:K(es),children:[(0,r.jsx)(sm.V,{setValue:Y,values:eo,name:"relatedLinks",noDeleteEdit:!0,titleSx:{fontSize:"12px!important"}}),((null===(x=y.relatedLinks)||void 0===x?void 0:x.length)>0||(null==eo?void 0:eo.length)>0)&&!sc.isEqual(y.relatedLinks,eo)&&(0,r.jsx)(O.Z,{type:"submit",variant:"contained",color:"secondary",sx:{marginTop:"30px"},children:"Submit"}),(0,r.jsx)("input",(0,i.Z)({type:"hidden"},W("relatedLinks")))]})]})})})]})};sh.propTypes={isQuotes:E().bool,job:E().object.isRequired,refetch:E().func.isRequired,showOrder:E().bool,expanded:E().bool,onChangeExpanded:E().func},sh.defaultProps={showOrder:!0,onChangeExpanded:function(){}};var sb=t(57779),sg=function(e){var n=e.job,t=e.refetch,i=(0,o.useState)([]),a=i[0],s=i[1];(0,o.useEffect)(function(){var e=(0,W.E)(n,"inProgress")&&!(0,W.E)(n,"completed"),t=!n.media||0===n.media.length;e&&t&&u("issues-details")(null,!0)},[n]);var u=function(e){return function(n,t){t?s(function(n){return(0,l.Z)(n).concat([e])}):s(function(n){return n.filter(function(n){return n!==e})})}};return(0,r.jsxs)(M.Z,{children:[(0,r.jsx)(sh,{expanded:a.includes("issues-details"),onChangeExpanded:u("issues-details"),job:n,refetch:t,showOrder:!1}),a.includes("issues-details")&&(0,r.jsx)(sb.G,{hideExpandIcon:!0,expanded:a.includes("issues-details"),entity:"Job",entityId:n.id,onMediaAdd:function(){return t()},onMediaRemove:function(){return t()}})]})};sg.defaultProps={},sg.propTypes={job:E().object.isRequired,refetch:E().func.isRequired};var sx=t(39710),sj=t(19611),sy=t(74280),sZ=t(81777),sI=t(67860),sS=t(81639),sw=function(e){var n=e.supplierId,t=e.toggleShow,i=(0,a.useRouter)();(0,o.useEffect)(function(){var e=function(e){t()};return i.events.on("routeChangeComplete",e),function(){i.events.off("routeChangeComplete",e)}},[]);var s=(0,c.a)(sx.l1,{variables:{id:n}}),u=s.loading,l=s.refetch,d=s.data,p=(void 0===d?{supplier:{}}:d).supplier;if(u)return(0,r.jsx)(nK.Z,{sx:{zIndex:1e5},open:!0,children:(0,r.jsx)(L.Z,{color:"secondary"})});var m=(0,iv.WE)(p,"registered"),f=(0,iv.WE)(p,"operating");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(sZ.g,{avatar:(0,sy.Q)(p.media),editable:!1,entity:p,entityName:"Account",linkTitleTo:"/dashboard/suppliers/view?id=".concat(p.id)}),(0,r.jsx)(sS.D,{supplier:p}),(0,r.jsx)(sI.T,{open:!1,supplier:p}),m&&(0,r.jsx)(sj.f,{address:m.address,entity:"Account",entityId:p.id,id:m.id,open:!1,refetch:l,title:"Registered Address",type:"registered"}),f&&(0,r.jsx)(sj.f,{address:f.address,entity:"Account",entityId:p.id,id:f.id,open:!1,refetch:l,title:"Operating Address",type:"operating"})]})};sw.propTypes={supplierId:A.number.isRequired,toggleShow:A.func.isRequired};var sC=function(e){var n=e.job,t=e.refetch,i=(0,o.useContext)(U.Z),a=(0,nv.x)().hasRole,s=(0,tC.L)(n.timings),u=function(e,o,a){e.stopPropagation(),"accepted"===a?i.show({content:(0,r.jsx)(t5,{accountId:o.accountId,job:n,offCanvas:i,refetch:t}),submit:!1,title:"Accept Job"}):i.show({content:(0,r.jsx)(i2,{accountId:o.accountId,job:n,offCanvas:i,refetch:t}),title:"Reject Job"})},l=function(e){return[{context:"primary",icon:"check",onClick:function(n){return u(n,e,"accepted")},tooltip:"Accept"},{context:"danger",icon:"delete",onClick:function(n){return u(n,e,"rejected")},tooltip:"Reject"}]},c=n.supplierOffers.filter(function(e){return"cancelled"!==e.status}).map(function(e){var n=e.account,t=e.dayRate,i=e.id,r=e.status,o=e.rate;return{id:i,accountId:n.id,name:n.name,rate:o,dayRate:t,status:r||"pending",actions:""}}),d=function(e){var n=e.row;i.show({title:"Supplier information",content:(0,r.jsx)(sw,{supplierId:n.accountId,toggleShow:i.close})})};return"onHold"!==s&&n.supplierOffers&&n.supplierOffers.length>0&&(null==c?void 0:c.length)>0&&(0,r.jsx)(M.Z,{children:(0,r.jsxs)(k.Z,{children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),children:(0,r.jsx)(J.Z,{variant:"h6",children:"Supplier Offers"})}),(0,r.jsx)($.Z,{children:a("admin")&&n.supplierOffers&&n.supplierOffers.length>0&&(0,r.jsx)(nm.i,{columns:[{field:"name",headerName:"Supplier",flex:1,sortable:!1},{field:"rate",headerName:"Rate/h",flex:1,sortable:!1,renderCell:function(e){var n=e.value;return(0,r.jsx)(r.Fragment,{children:(0,nB.T)(n)})}},{field:"status",headerName:"Status",flex:1,sortable:!1},{field:"actions",headerName:"",width:50,sortable:!1,renderCell:function(e){var n=e.row;return(0,r.jsx)(aC.C,{actionsData:l,row:n})}}],rows:c,onRowClick:d})})]})})};sC.defaultProps={},sC.propTypes={job:E().object.isRequired,refetch:E().func.isRequired};var sR=t(23855),sq=t(29383),s_=t(76972),sT=t(69690),sA=el.Ry({slaId:el.Rx().integer().required()}),sE=function(e){var n,t,o=e.customerId,a=e.locationId,s=e.onSuccess,u=(0,er.cI)({resolver:(0,eo.S)(sA)}),l=u.control,d=u.errors,m=u.handleSubmit,f=u.register,v=(0,u.watch)("slaId"),h=(0,c.a)(p.Ab,{skip:!o||!a,variables:{customerId:o,locationId:a}}).data,b=(0,ny.GU)("reactive",h),g=null===(n=null==b?void 0:b.find(function(e){return e.id===Number(v)}))||void 0===n?void 0:n.notes,x=(t=(0,q.Z)(function(e){return(0,T.__generator)(this,function(n){return s(e),[2]})}),function(e){return t.apply(this,arguments)});return(0,r.jsxs)(ea.Z,{handleSubmit:m(x),children:[(0,r.jsx)(eb.Z,{register:f,errors:d,data:b,legend:"Priority",name:"slaId"}),v&&(0,r.jsx)(ev.Z,{content:g||"-",context:"light"}),(0,r.jsx)(eg.Z,{label:"Notes",children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},{control:l,errors:d,register:f}),{name:"notes",rows:3}))}),(0,r.jsx)(ej.Z,{content:"Accept",context:"primary",type:"submit"})]})},sD=function(e){e.accountId,e.quotationId;var n,t=e.onSuccess,o=(0,er.cI)(),a=o.control,s=o.errors,u=o.handleSubmit,l=o.register,c=(n=(0,q.Z)(function(e){return(0,T.__generator)(this,function(n){return t(e.acceptedNotes),[2]})}),function(e){return n.apply(this,arguments)});return(0,r.jsxs)(ea.Z,{handleSubmit:u(c),children:[(0,r.jsx)(eg.Z,{label:"Notes",children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},{control:a,errors:s,register:l}),{name:"acceptedNotes",rows:3}))}),(0,r.jsx)(ej.Z,{content:"Reject",context:"danger",type:"submit"})]})},sP=t(48996),sk=(0,el.Ry)().shape({terms:(0,el.Z_)().required()}),s$=function(e){var n,t,o,a,s=e.refetch,u=e.quotation,l=e.toggleShow,c=e.PublicQuoteTerms,d=(0,_.Z)((0,P.D)(ef.Dg,{onCompleted:function(){l(),s&&s()}}),1)[0],p=(0,er.cI)({defaultValues:{terms:null!==(o=null!==(t=null===(n=u.meta)||void 0===n?void 0:n.terms)&&void 0!==t?t:c)&&void 0!==o?o:""},resolver:(0,eo.S)(sk)}),m=p.control,f=p.errors,v=p.handleSubmit,h=p.register,b=(a=(0,q.Z)(function(e){var n;return(0,T.__generator)(this,function(t){switch(t.label){case 0:return(n=(0,i.Z)({},u.meta)).terms=e.terms,[4,d({variables:{changes:{meta:n},supplierOffer:[],id:u.id}})];case 1:return t.sent(),[2]}})}),function(e){return a.apply(this,arguments)});return(0,r.jsx)(ea.Z,{id:"offCanvasForm",handleSubmit:v(b),children:(0,r.jsx)(e_.Z,(0,ei.Z)((0,i.Z)({},{control:m,errors:f,register:h}),{name:"terms",rows:8}))})},sH=t(53625),sM=t(63441);function sO(){var e=(0,m.Z)(["\n  mutation AcceptQuote($quoteId: Int!, $notes: String, $slaId: Int!) {\n    acceptQuote(quoteId: $quoteId, notes: $notes, slaId: $slaId) {\n      data\n      success\n    }\n  }\n"]);return sO=function(){return e},e}function sN(){var e=(0,m.Z)(["\n  mutation RejectQuote($quoteId: Int!, $notes: String) {\n    rejectQuote(quoteId: $quoteId, notes: $notes) {\n      data\n      success\n    }\n  }\n"]);return sN=function(){return e},e}var sF=(0,f.Ps)(sO()),sJ=(0,f.Ps)(sN()),sL=O.Z,sU=N.ZP;sl()(X());var sV=function(e){var n,t,a,s,u,d,p,m,f,h=e.job,b=e.quote,x=e.quotes,j=e.refetch,y=e.isHideAllQuotation,Z=e.expanded,I=e.onChangeExpanded,S=e.hideExpandIcon,w=(0,o1.Z)(e,["job","quote","quotes","refetch","isHideAllQuotation","expanded","onChangeExpanded","hideExpandIcon"]),C=(0,D.x)(),R=(0,rm.Z)("(max-width: 500px)"),A=(0,nX.D)(),E=(0,nv.x)(),M=E.user,O=E.hasRole,N=O("admin"),L=O((0,l.Z)(sH.Sf)),V=O(["admin","supplier"]),Q=O("customer"),z=O((0,l.Z)(sH.n)),Y=O("supplier"),B=O((0,l.Z)(sH.nx)),W=O("tenant"),K=(0,c.a)(g.nh,{variables:{id:M.id}}).data,ee=(void 0===K?{user:{}}:K).user,en=(0,i.Z)({},M,ee),er=null==en?void 0:en.quoteThreshold,eo=b.lineItems.reduce(function(e,n){return e+n.supplierTotal},0),ea=(null==b?void 0:null===(n=b.lineItems)||void 0===n?void 0:n.reduce(function(e,n){return e+n.total},0))||0,es=ea+.2*ea,eu=(0,o.useContext)(U.Z),el=(0,e8.a)(),ec=["supplierQuoteRequested","thresholdApproved","quotationRejected"].includes(b.status),ed=(0,_.Z)((0,P.D)(v.xY,{onCompleted:function(){j&&j()}}),1)[0],ep=(0,_.Z)((0,P.D)(sF,{refetchQueries:["GetJob"],onCompleted:function(){el.close()},onError:function(e){A.show({content:"Error: ".concat(e.message),color:"error"})}}),1)[0],em=(0,_.Z)((0,P.D)(sJ,{refetchQueries:["GetJob"],onCompleted:function(){el.close()},onError:function(e){A.show({content:"Error: ".concat(e.message),color:"error"})}}),1)[0],ef=(0,c.a)(g.nE,{variables:{id:en.adminId}}),ev=ef.data,eh=ef.loading,eb=null==ev?void 0:null===(t=ev.account)||void 0===t?void 0:null===(a=t.meta)||void 0===a?void 0:null===(s=a.quote)||void 0===s?void 0:s.terms,eg=function(e){e.stopPropagation(),el.show({content:(0,r.jsx)(sb.G,{entity:"Quotation",entityId:b.id}),submit:!1,title:"View media"})},ex=function(e){var n=e.status;if(("supplierQuoteComplete"===n||"supplierQuoteRefused"===n||"waitingThresholdApproval"===n)&&("quoteOffered"===h.status||"waitingThresholdApproval"===h.status)){var t="quoteReceived";ed({variables:{id:h.id,changes:{status:t},timing:{status:t,jobId:h.id,userId:en.id,quoteId:b.id}}})}else j&&j();eu.close()},ej=ol.E6.find(function(e){return e.value===b.status})||{text:"-",context:"info"},ey=function(){eu.show({title:"Quotation Number: ".concat(b.quoteNumber),content:(0,r.jsx)(sP.m,{onSuccess:ex,quotationId:b.id}),width:"50%",submit:!1})},eZ=(m=(0,q.Z)(function(e){var n,t;return(0,T.__generator)(this,function(i){switch(i.label){case 0:return n=e.notes,t=e.slaId,[4,ep({variables:{quoteId:b.id,notes:n,slaId:t}})];case 1:return i.sent(),[2]}})}),function(e){return m.apply(this,arguments)}),eC=(f=(0,q.Z)(function(e){return(0,T.__generator)(this,function(n){switch(n.label){case 0:return[4,em({variables:{quoteId:b.id,notes:e}})];case 1:return n.sent(),[2]}})}),function(e){return f.apply(this,arguments)}),eR=function(){el.show({title:"Accept Quotation Number: ".concat(b.quoteNumber),submit:!1,content:(0,r.jsx)(sE,{customerId:h.customerId,locationId:h.locationId,onSuccess:eZ})})},eq=function(){el.show({title:"Reject Quotation Number: ".concat(b.quoteNumber),submit:!1,content:(0,r.jsx)(sD,{accountId:b.supplier.id,quotationId:b.id,quote:b,toggleShow:eu.close,onSuccess:eC})})},e_=function(){eu.show({content:(0,r.jsx)(s$,{refetch:j,quotation:b,toggleShow:eu.close,PublicQuoteTerms:eb}),title:"Terms of quote",width:"30%"})},eT=(0,o.useCallback)(function(){var e,n,t,r;return[{key:"Status",value:ej.text},{key:"Supplier",hidden:Q||W,value:(null==b?void 0:null===(e=b.supplier)||void 0===e?void 0:e.name)||(null===(n=h.quotations)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:null===(r=t.supplier)||void 0===r?void 0:r.name)},{hidden:Y,key:"Quote due by Customer",value:X()(h.quoteDue).format("YYYY-MM-DD")},{hidden:Q||W,key:"Quote due from Supplier",value:X()(h.quoteDueSupplier).format("YYYY-MM-DD")},{key:"Date received",value:X()(b.createdAt).format("YYYY-MM-DD")},{hidden:!N&&!Q&&!W,key:"Labour Total",value:(0,nB.T)(b.lineItems.filter(function(e){return"Labour"===e.type}).reduce(function(e,n){return e+n.total*n.qty},0))},{hidden:!N&&!Q&&!W,key:"Materials Total",value:(0,nB.T)(b.lineItems.filter(function(e){return"Materials"===e.type}).reduce(function(e,n){return e+n.total*n.qty},0))},{hidden:!N&&!Q&&!W,key:"Quote Total",value:(0,nB.T)(b.lineItems.reduce(function(e,n){return e+n.total*n.qty},0))},{hidden:!V,key:"Labour Supplier Total",value:(0,nB.T)(b.lineItems.filter(function(e){return"Labour"===e.type}).reduce(function(e,n){return e+n.supplierTotal},0))},{hidden:!V,key:"Materials Supplier Total",value:(0,nB.T)(b.lineItems.filter(function(e){return"Materials"===e.type}).reduce(function(e,n){return e+n.supplierTotal},0))},{hidden:!V,key:"Supplier Total",value:(0,nB.T)(b.lineItems.reduce(function(e,n){return e+n.supplierTotal},0))},{key:"Duration",value:b.totalDuration?"".concat(b.totalDuration," ").concat(b.totalDurationUnit):"-"},{key:"Start date",value:b.startDate?X()(b.startDate).format("YYYY-MM-DD"):"-"},{key:"Site Visit",value:b.siteVisitAt&&X()(b.siteVisitAt,!0).format("YYYY-MM-DD"),hidden:!h.siteVisitStart||!b.siteVisitAt}].filter(function(e){return!e.hidden}).map(function(e,n){return(0,ei.Z)((0,i.Z)({},e),{id:n})})},[N,V,Q,Y,W,h.quotations,h.quoteDue,h.quoteDueSupplier,h.siteVisitStart,b.createdAt,b.lineItems,b.siteVisitAt,b.startDate,null==b?void 0:null===(u=b.supplier)||void 0===u?void 0:u.name,b.totalDuration,b.totalDurationUnit,ej.text]);return eh?null:(0,r.jsxs)(k.Z,(0,ei.Z)((0,i.Z)({},w),{expanded:Z,onChange:I,children:[(0,r.jsx)(H.Z,(0,ei.Z)((0,i.Z)({},!S&&{expandIcon:(0,r.jsx)(G.Z,{})}),{children:(0,r.jsxs)(J.Z,{variant:"h6",children:["Quotation ",b.quoteNumber,b.recommended?" (Recommended)":"","quotationAccepted"===b.status?" (Accepted)":""]})})),(0,r.jsx)($.Z,{children:(0,r.jsxs)(F.Z,{spacing:2,children:[(0,r.jsxs)(sU,{container:!0,display:"flex",alignItems:"center",columnGap:2,children:[(0,r.jsx)(sU,{item:!0,xs:4,children:(0,r.jsx)(J.Z,{children:"Quotation"})}),(0,r.jsx)(sU,{item:!0,xs:7,display:"flex",children:(0,r.jsx)(sL,{variant:"contained",color:"secondary",onClick:ey,children:"View Quotation"})})]}),!y&&!ec&&N&&(0,r.jsxs)(sU,{container:!0,display:"flex",alignItems:"center",columnGap:2,children:[(0,r.jsx)(sU,{item:!0,xs:4,children:(0,r.jsx)(J.Z,{children:"Accept / Reject"})}),(0,r.jsxs)(sU,{item:!0,xs:7,display:"flex",columnGap:1,children:[(0,r.jsx)(sL,{variant:"contained",color:"primary",size:"small",onClick:function(){return(0,ew.il)(er,es)||(0,eS.Pn)("adminSupplier",null==h?void 0:h.timings,b.id)?eR():(0,eI.I_)({type:"quote",role:"adminSupplier",quotations:x,quotationId:b.id,jobId:h.id,accountId:h.adminId,amount:es,offCanvas:eu})},children:"Accept"}),(0,r.jsx)(sL,{variant:"contained",color:"danger",size:"small",onClick:eq,children:"Reject"})]})]}),!y&&!ec&&Q&&(0,r.jsxs)(sU,{container:!0,display:"flex",alignItems:"center",columnGap:2,children:[(0,r.jsx)(sU,{item:!0,xs:4,children:(0,r.jsx)(J.Z,{children:"Accept / Reject"})}),(0,r.jsxs)(sU,{item:!0,xs:7,display:"flex",columnGap:1,children:[(0,r.jsx)(sL,{variant:"contained",color:"primary",size:"small",onClick:function(){return(0,ew.il)(er,es)||(0,eS.Pn)(en.accountType,null==h?void 0:h.timings,b.id)?eR():(0,eI.I_)({type:"quote",role:"customer",quotations:x,quotationId:b.id,jobId:h.id,accountId:h.customer.id,amount:es,offCanvas:eu})},children:"Accept"}),(0,r.jsx)(sL,{variant:"contained",color:"danger",size:"small",onClick:eq,children:"Reject"})]})]}),(B||z)&&(0,eS.aH)(en.accountType,null==h?void 0:h.timings,b.id)&&(0,ew.il)(er,"supplier"===en.accountType?eo:es)&&(0,r.jsxs)(sU,{container:!0,display:"flex",alignItems:"center",columnGap:2,children:[(0,r.jsx)(sU,{item:!0,xs:4,children:(0,r.jsx)(J.Z,{children:"Threshold approval"})}),(0,r.jsxs)(sU,{item:!0,xs:7,display:"flex",columnGap:1,children:[!(0,eS.Pn)(en.accountType,null==h?void 0:h.timings,b.id)&&(0,r.jsx)(sL,{variant:"contained",color:"primary",size:"small",onClick:function(){return(0,eI.i$)({type:"quote",role:en.accountType,job:h,quoteId:b.id,offCanvas:eu,refetch:j})},children:"Approve"}),!(0,eS.Pn)(en.accountType,null==h?void 0:h.timings,b.id)&&!(0,eS.TT)(en.accountType,null==h?void 0:h.timings,b.id)&&(0,r.jsx)(sL,{variant:"contained",color:"danger",size:"small",onClick:function(){return(0,eI.Ii)({type:"quote",role:en.accountType,job:h,quoteId:b.id,offCanvas:eu,refetch:j})},children:"Reject"})]})]}),L&&(0,eS.aH)("adminSupplier",null==h?void 0:h.timings,b.id)&&(0,ew.il)(er,eo)&&(0,r.jsxs)(sU,{container:!0,display:"flex",alignItems:"center",columnGap:2,children:[(0,r.jsx)(sU,{item:!0,xs:4,children:(0,r.jsx)(J.Z,{children:"Permission request to accept quote"})}),(0,r.jsxs)(sU,{item:!0,xs:7,display:"flex",columnGap:1,children:[!(0,eS.Pn)("adminSupplier",null==h?void 0:h.timings,b.id)&&(0,r.jsx)(sL,{variant:"contained",color:"primary",size:"small",onClick:function(){return(0,eI.i$)({type:"quote",role:"adminSupplier",job:h,quoteId:b.id,offCanvas:eu,refetch:j})},children:"Approve"}),!(0,eS.Pn)("adminSupplier",null==h?void 0:h.timings,b.id)&&!(0,eS.TT)("adminSupplier",null==h?void 0:h.timings,b.id)&&(0,r.jsx)(sL,{variant:"contained",color:"danger",size:"small",onClick:function(){return(0,eI.Ii)({type:"quote",role:"adminSupplier",job:h,quoteId:b.id,offCanvas:eu,refetch:j})},children:"Reject"})]})]}),L&&(0,eS.aH)("adminCustomer",null==h?void 0:h.timings,b.id)&&(0,ew.il)(er,es)&&(0,r.jsxs)(sU,{container:!0,display:"flex",alignItems:"center",columnGap:2,children:[(0,r.jsxs)(sU,{item:!0,xs:4,children:[" ",(0,r.jsx)(J.Z,{children:"Permission request to send quote to customer"})]}),(0,r.jsxs)(sU,{item:!0,xs:7,display:"flex",columnGap:1,children:[!(0,eS.Pn)("adminCustomer",null==h?void 0:h.timings,b.id)&&(0,r.jsx)(sL,{variant:"contained",color:"primary",size:"small",onClick:function(){return(0,eI.i$)({type:"quote",role:"adminCustomer",job:h,quoteId:b.id,offCanvas:eu,refetch:j})},children:"Approve"}),!(0,eS.Pn)("adminCustomer",null==h?void 0:h.timings,b.id)&&!(0,eS.TT)("adminCustomer",null==h?void 0:h.timings,b.id)&&(0,r.jsx)(sL,{variant:"contained",color:"danger",size:"small",onClick:function(){return(0,eI.Ii)({type:"quote",role:"adminCustomer",job:h,quoteId:b.id,offCanvas:eu,refetch:j})},children:"Reject"})]})]}),(0,r.jsx)(ai.Z,{}),(0,r.jsx)(nm.i,{hideHeader:!0,columns:[{field:"key",flex:1,sortable:!1,renderCell:function(e){var n=e.value;return"function"==typeof n?n():n}},{field:"value",flex:1,sortable:!1,renderCell:function(e){var n=e.value;return"function"==typeof n?n():n}}],rows:eT(),getRowClassName:function(e){return e.row.id%2==0?"odd":"even"}}),(0,r.jsx)(ai.Z,{}),(0,r.jsxs)(sU,{container:!0,rowSpacing:2,children:[(0,r.jsxs)(sU,{item:!0,xs:12,xs3:8,display:"flex",alignItems:"center",columnGap:2,children:[(0,r.jsx)(J.Z,{children:"Attachments"}),(0,r.jsx)(at.Z,{color:"secondary",badgeContent:(null==b?void 0:null===(d=b.media)||void 0===d?void 0:d.length)>0?null==b?void 0:null===(p=b.media)||void 0===p?void 0:p.length:0,children:(0,r.jsx)(sL,{variant:"contained",color:"secondary",size:"small",onClick:eg,children:"View Attachments"})})]}),("quoteSent"===h.status||"quoteReceived"===h.status||"quotationAccepted"===b.status)&&(0,r.jsxs)(sU,{item:!0,xs:12,xs3:4,display:"flex",alignItems:"center",columnGap:2,children:[(0,r.jsx)(J.Z,(0,ei.Z)((0,i.Z)({},R&&{sx:{width:"80px"}}),{children:"PDF"})),(0,r.jsx)(sL,{variant:"contained",color:"info",size:"small",onClick:function(){return(0,et.g)(h,b.id,C)},children:(0,r.jsx)(sM.Z,{})})]}),N&&(0,r.jsxs)(sU,{item:!0,xs:12,xs3:12,display:"flex",alignItems:"center",columnGap:2,children:[(0,r.jsx)(J.Z,{width:"80px",children:"Terms"}),(0,r.jsx)(sL,{variant:"contained",color:"secondary",size:"small",onClick:e_,children:"Terms of the Quote"})]})]})]})})]}))};sV.defaultProps={onChangeExpanded:function(){}},sV.propTypes={job:E().object.isRequired,quote:E().object.isRequired,quotes:E().arrayOf(E().object).isRequired,refetch:E().func.isRequired,isHideAllQuotation:E().bool,expanded:E().bool,onChangeExpanded:E().func,hideExpandIcon:E().bool};var sQ=function(e){var n,t=e.job,i=e.refetch,a=(0,nv.x)().hasRole,s=(0,o.useState)([]),u=s[0],c=s[1],d=(0,o.useState)(0),p=d[0],m=d[1],f=t.quotations.slice().filter(function(e){return"uplift"!==e.type}).sort(function(e){return"quotationAccepted"===e.status?-1:0}),v=!!f.find(function(e){return"quotationAccepted"===e.status}),h=t.siteVisitStart&&X()(t.siteVisitStart,!0).format("YYYY-MM-DD"),b=t.siteVisitEnd&&X()(t.siteVisitEnd,!0).format("YYYY-MM-DD"),g=t.siteVisitWeekends,x=function(e){var n=(0,sq.Z)((0,sR.Z)((0,W.E)(e,"quoteAccepted")),(0,sR.Z)((0,W.E)(e,"quoteReceived"))),t=(0,s_.Z)((0,sR.Z)((0,W.E)(e,"quoteAccepted")),(0,sR.Z)((0,W.E)(e,"quoteReceived"))),i=(0,sT.Z)((0,sR.Z)((0,W.E)(e,"quoteAccepted")),(0,sR.Z)((0,W.E)(e,"quoteReceived")));return"".concat(n>0?n+" day ":"").concat(t>0?t+" hours ":"").concat(i+" minutes")},j=(0,o.useCallback)(function(){var e,n;return[{id:1,key:"Status",value:function(){return(0,r.jsx)(tL.B,{value:t.status})}},{id:2,key:"Required quotes",value:t.quoteNumber},{id:3,key:"Quote due by Customer",value:X()(t.quoteDue).format("YYYY-MM-DD")},{id:4,key:"Quote due from Supplier",value:X()(t.quoteDueSupplier).format("YYYY-MM-DD")},{hidden:t.quotations.find(function(e){return"quotationAccepted"===e.status}),id:5,key:"Sent quotations",value:(null===(e=t.quotations)||void 0===e?void 0:e.filter(function(e){return"supplierQuoteSent"===e.status}).map(function(e){return e.quoteNumber}).join(", "))||"-"},{hidden:!t.quotations.find(function(e){return"quotationAccepted"===e.status}),id:6,key:"Accepted quotation",value:null===(n=t.quotations.find(function(e){return"quotationAccepted"===e.status}))||void 0===n?void 0:n.quoteNumber},{hidden:!t.quotations.find(function(e){return"quotationAccepted"===e.status}),id:7,key:"Acceptance time",value:x(t)},{id:8,key:"Site Visit Start",value:h,hidden:!h},{id:9,key:"Site Visit End",value:b,hidden:!b},{id:10,key:"Include Weekends",value:g&&"Yes",hidden:!g}].filter(function(e){return!e.hidden})},[JSON.stringify(t)]);return(0,r.jsxs)(M.Z,{children:[(0,r.jsxs)(k.Z,{expanded:u.includes("quote-details"),onChange:(n="quote-details",function(e,t){t?c(function(e){return(0,l.Z)(e).concat([n])}):c(function(e){return e.filter(function(e){return e!==n})})}),children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),children:(0,r.jsx)(J.Z,{variant:"h6",children:"Quote details"})}),(0,r.jsxs)($.Z,{sx:{pb:0},children:[(0,r.jsx)(M.Z,{mb:2,children:(0,r.jsx)(nm.i,{hideHeader:!0,columns:[{field:"key",flex:1,sortable:!1,renderCell:function(e){var n=e.value;return"function"==typeof n?n():n}},{field:"value",flex:1,sortable:!1,renderCell:function(e){var n=e.value;return"function"==typeof n?n():n}}],rows:j(),getRowClassName:function(e){return e.row.id%2==0?"odd":"even"}})}),a("admin")&&f.length>1&&(0,r.jsx)(ie.Z,{children:f.map(function(e,n){var t;return(0,r.jsx)(sz,{color:"secondary",variant:p===n?"contained":"outlined",onClick:function(e){e.stopPropagation(),m(n)},children:e.quoteNumber})})})]})]}),u.includes("quote-details")&&a("admin")&&f.map(function(e,n){return p===n?(0,r.jsx)(sV,{job:t,quote:e,refetch:i,quotes:f,isHideAllQuotation:v,expanded:!0,hideExpandIcon:!0,sx:{"&.MuiAccordion-root.Mui-expanded":{borderTop:0,boxShadow:"none"}}},e.quoteNumber):null})]})};sQ.propTypes={job:E().object.isRequired,refetch:E().func.isRequired};var sz=(0,oW.ZP)(O.Z)(function(){return{height:"30px"}});function sY(){var e=(0,m.Z)(["\n  fragment TaskFields on Task {\n    id\n    archived\n    status\n    priority\n    statusLog\n    meta\n    relatedLinks\n    title\n    content\n    dueDate\n    createdAt\n    updatedAt\n    adminId\n    userId\n    assignedAccountId\n    assignedUser: AssignedUser {\n      id\n      fullName\n    }\n    jobId\n  }\n"]);return sY=function(){return e},e}function sB(){var e=(0,m.Z)(["\n  query GetTasks(\n    $jobId: Int\n    $assignedUserId: Int\n    $limit: Int\n    $offset: Int\n    $orderBy: Task_order_by!\n  ) {\n    tasks: Task(\n      where: { jobId: { _eq: $jobId }, assignedUserId: { _eq: $assignedUserId } }\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n    ) {\n      ...TaskFields\n    }\n    meta: Task_aggregate(\n      where: { jobId: { _eq: $jobId }, assignedUserId: { _eq: $assignedUserId } }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n\n  ","\n"]);return sB=function(){return e},e}function sG(){var e=(0,m.Z)(["\n  subscription GetTasks(\n    $jobId: Int\n    $assignedUserId: Int\n    $limit: Int\n    $offset: Int\n    $orderBy: Task_order_by!\n  ) {\n    tasks: Task(\n      where: { jobId: { _eq: $jobId }, assignedUserId: { _eq: $assignedUserId } }\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n    ) {\n      ...TaskFields\n    }\n  }\n  ","\n"]);return sG=function(){return e},e}var sW=(0,f.Ps)(sY()),sK=(0,f.Ps)(sB(),sW),sX=(0,f.Ps)(sG(),sW),s0=t(12632),s1=t(66242),s2=t(62023),s4=t(44267),s3=t(41796),s6=t(61472),s5=function(e){var n,t=(n=e.priority,s6.FX.find(function(e){return e.value===n})),i=t.icon,o=t.label;return(0,r.jsx)(M.Z,{display:"flex",alignItems:"center",children:(0,r.jsxs)(F.Z,{direction:"row",alignItems:"center",children:[i,(0,r.jsx)(J.Z,{ml:1,children:o})]})})};s5.defaultProps={},s5.propTypes={priority:E().string};var s7=function(e){var n,t=(n=e.status,s6.jb.find(function(e){return e.value===n})),i=t.icon,o=t.label,a=t.color,s=t.bgcolor,u=t.value;return(0,r.jsx)(a7.Z,{size:"small",label:o,icon:i,sx:{color:a,bgcolor:s}},u)};s7.defaultProps={},s7.propTypes={status:E().oneOf(["open","closed","resolved"])};var s9=function(e){var n=e.dueDate,t=e.priority,i=e.status,o=e.title,a=e.content,s=e.assigned,u=e.onView;return(0,r.jsxs)(s8,{variant:"outlined",children:[(0,r.jsxs)(s4.Z,{sx:{padding:1},children:[(0,r.jsxs)(F.Z,{direction:"row",justifyContent:"space-between",children:[(0,r.jsx)(s5,{priority:t}),(0,r.jsx)(s7,{status:i})]}),(0,r.jsxs)(J.Z,{mt:1,variant:"h6",sx:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:[o," \xa0"]}),(0,r.jsx)(J.Z,{mt:1,sx:{height:"63px",overflow:"hidden"},children:a}),(0,r.jsxs)(J.Z,{variant:"subtitle2",children:["Assigned by ",s]})]}),(0,r.jsxs)(s2.Z,{sx:{display:"flex",justifyContent:"space-between",pt:0},children:[(0,r.jsx)(O.Z,{variant:"contained",color:"secondary",onClick:u,sx:{height:"30px"},children:"View"}),(0,r.jsx)(ue,{variant:"subtitle2",children:n})]})]})};s9.defaultProps={title:"",onView:function(){}},s9.propTypes={dueDate:E().string.isRequired,priority:E().oneOf([1,2,3,4,5]).isRequired,status:E().oneOf(["open","closed","resolved"]).isRequired,title:E().string.isRequired,content:E().string.isRequired,assigned:E().string.isRequired,onView:E().func.isRequired};var s8=(0,oW.ZP)(s1.Z)(function(e){return{display:"flex",flexDirection:"column",justifyContent:"space-between",maxHeight:"210px",minWidth:"280px",backgroundColor:e.theme.palette.muiCardGray.main}}),ue=(0,oW.ZP)(J.Z)(function(e){var n=e.theme;return{alignSelf:"flex-end",fontWeight:700,color:(0,s3.$n)(n.palette.black.main,.46)}}),un=t(43759),ut=t(62155),ui={item:"dueDate",order:"desc"},ur=function(e){var n=e.jobId,t=e.subscription,a=e.showMyTaskButton,s=e.expanded,u=e.onChangeExpanded,l=(0,e8.a)(),p=(0,nv.x)().user,m=(0,s0.x)({filters:{jobId:n},initialSort:ui}).initialData,f=(0,o.useState)(!1),v=f[0],h=f[1],b=(0,ei.Z)((0,i.Z)({},m),{assignedUserId:v?p.id:m.userId}),g=(0,c.a)(sK,{variables:(0,i.Z)({},b),skip:t}),x=g.loading,j=g.data,y=(void 0===j?{tasks:[],meta:{aggregate:{totalCount:0}}}:j).tasks,Z=(0,d.m)(sX,{variables:(0,i.Z)({},b),skip:!t}),I=Z.loading,S=Z.data,w=(void 0===S?{tasks:[]}:S).tasks,C=function(e,n){e.preventDefault(),e.stopPropagation(),l.show({content:(0,r.jsx)(un.J,{id:n,close:l.close}),title:"Task Details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"100vw",lg:"90vw",lg2:"80vw"})},R=function(e){e.preventDefault(),e.stopPropagation(),l.show({content:(0,r.jsx)(ut.G,{jobId:n,close:l.close}),title:"Create Task",xs3:"100vw",sm:"100vw",sm2:"80vw",sm3:"70vw",md2:"60vw",lg:"50vw",lg2:"40vw"})},q=(t?w:y).map(function(e){var n;return{id:e.id,status:e.status,priority:e.priority,title:e.title,content:e.content,dueDate:X()(e.dueDate).format("YYYY-MM-DD"),assignedUser:null===(n=e.assignedUser)||void 0===n?void 0:n.fullName,item:e,actions:""}}),_=function(e){e.stopPropagation(),h(function(e){return!e})};return(0,r.jsx)(M.Z,{children:(0,r.jsxs)(k.Z,{expanded:s,onChange:u,children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),children:(0,r.jsx)(J.Z,{variant:"h6",children:"Tasks"})}),(0,r.jsx)($.Z,{sx:{paddingTop:0},children:(0,r.jsxs)(F.Z,{width:"100%",spacing:1,children:[(0,r.jsxs)(F.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,r.jsx)(J.Z,{children:"Current task in progress"}),a&&(0,r.jsx)(nw.Z,{control:(0,r.jsx)(nS.Z,{color:"secondary",checked:v,onChange:_}),label:"My Tasks"})]}),(0,r.jsx)(F.Z,{width:"100%",direction:"row",spacing:2,pb:1,sx:{overflowX:"scroll"},children:x||I?(0,r.jsx)(F.Z,{width:"100%",direction:"row",justifyContent:"center",children:(0,r.jsx)(L.Z,{color:"secondary"})}):q.map(function(e){return(0,r.jsx)(s9,{dueDate:e.dueDate,priority:e.priority,status:e.status,title:e.title,content:e.content,assigned:e.assignedUser,onView:function(n){return C(n,e.id)}})})}),(0,r.jsx)(F.Z,{direction:"row",justifyContent:"center",children:(0,r.jsx)(O.Z,{variant:"contained",color:"secondary",onClick:R,children:"Add new task"})})]})})]})})};ur.propTypes={jobId:E().number,showMyTaskButton:E().bool,subscription:E().bool,expanded:E().bool,onChangeExpanded:E().func},ur.defaultProps={showMyTaskButton:!1,onChangeExpanded:function(){}};var uo=t(8539);function ua(){var e=(0,m.Z)(["\n  query GetUserLocations($accountId: Int, $jobId: Int) {\n    supplierLocations: UserLocation(\n      limit: 10\n      order_by: { id: desc }\n      where: { jobId: { _eq: $jobId }, accountId: { _eq: $accountId } }\n    ) {\n      id\n      geo\n      meta\n      createdAt\n    }\n  }\n"]);return ua=function(){return e},e}var us=(0,f.Ps)(ua()),uu=t(28499),ul=function(e){var n=e.children,t=e.defaultCenter,i=e.defaultZoom,o=function(e){return{fullscreenControl:!0,mapTypeControl:!0,mapTypeId:e.MapTypeId.ROADMAP,scaleControl:!0,scrollwheel:!1,streetViewControl:!0}};return(0,r.jsx)(uu.ZP,{options:o,bootstrapURLKeys:{key:o0.ie.map},defaultCenter:t,defaultZoom:i,children:n})};ul.defaultProps={defaultZoom:14},ul.propTypes={children:E().node,defaultCenter:E().shape({lat:E().number.isRequired,lng:E().number.isRequired}).isRequired,defaultZoom:E().number};var uc=function(e){var n,t=e.job,o=(0,iv.WE)(null==t?void 0:t.location,"registered"),a=null,s=null;(null==o?void 0:null===(n=o.address)||void 0===n?void 0:n.geo)&&(a=(0,iv.Pk)(o.address.geo));var u={jobId:t.id,accountId:t.supplier.id},l=(0,c.a)(us,{skip:!a,variables:(0,i.Z)({},u)}).data,d=(void 0===l?{supplierLocations:[]}:l).supplierLocations;if(d.length){var p=d[0];s=(0,iv.Pk)(p.geo)}return a&&s?(0,r.jsx)(M.Z,{children:(0,r.jsxs)(k.Z,{children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),children:(0,r.jsx)(J.Z,{variant:"h6",children:"Supplier Operative Location"})}),(0,r.jsx)($.Z,{children:(0,r.jsxs)(F.Z,{children:[(0,r.jsx)(M.Z,{sx:{height:"300px",width:"100%"},children:(0,r.jsxs)(ul,{defaultCenter:a,children:[a&&(0,r.jsx)(M.Z,(0,i.Z)({component:"img",src:"https://maps.google.com/mapfiles/ms/icons/red-dot.png"},a)),s&&(0,r.jsx)(M.Z,(0,i.Z)({component:"img",src:"https://maps.google.com/mapfiles/ms/icons/blue-dot.png"},s))]})}),(0,r.jsx)(nm.i,{rows:d.map(function(e){var n,t,i=e.meta;return{id:e.id,distance:(null==i?void 0:null===(n=i.distance)||void 0===n?void 0:n.text)?i.distance.text:"-",duration:(null==i?void 0:null===(t=i.duration)||void 0===t?void 0:t.text)?i.duration.text:"-",time:X()(e.createdAt).format("YYYY-MM-DD")}}),columns:[{field:"distance",headerName:"Distance",flex:1,sortable:!1},{field:"duration",headerName:"Arrival",flex:1,sortable:!1},{field:"time",headerName:"Last update",flex:1,sortable:!1}]})]})})]})}):null};uc.defaultProps={},uc.propTypes={job:E().object.isRequired};var ud=function(e){var n=e.job,t=e.refetch,i=(0,nv.x)().hasRole,o=["supplierQuoteSent","quotationAccepted","supplierQuoteUpdated","waitingThresholdApproval"],a=!0,s=n.quotations.slice().filter(function(e){return i("customer")?"uplift"!==e.type&&o.find(function(n){return n===e.status}):"uplift"!==e.type});return a=!!s.find(function(e){return"quotationAccepted"===e.status}),s.sort(function(e){return"quotationAccepted"===e.status?-1:0}).map(function(e){return(0,r.jsx)(M.Z,{children:(0,r.jsx)(sV,{job:n,quote:e,refetch:t,quotes:s,isHideAllQuotation:a},e.quoteNumber)})})};ud.defaultProps={},ud.propTypes={job:E().object.isRequired,refetch:E().func.isRequired};var up=function(e){var n=e.job,t=e.onUpdateJob,o=(0,er.cI)({defaultValues:{permitsLinks:n.permitsLinks}}),a=o.setValue,s=o.register,u=o.watch,l=o.handleSubmit,c=u("permitsLinks");return(0,r.jsxs)("form",{id:"supportingDocumentsFrom",onSubmit:l(t),children:[(0,r.jsx)(sm.V,{setValue:a,values:c,name:"permitsLinks",title:"Permit links",noDeleteEdit:!0}),(0,r.jsx)("input",(0,i.Z)({type:"hidden"},s("permitsLinks"))),(0,r.jsx)(O.Z,{type:"submit",variant:"contained",color:"secondary",sx:um.submitButton,children:"Submit"})]})},um={submitButton:{marginTop:"20px"}},uf=function(e){var n=e.job,t=e.refetch,i=(0,e8.a)(),o=(0,_.Z)((0,P.D)(p.qD,{}),1)[0],a=function(e){o({variables:{id:n.id,changes:e}}).then(function(){t(),i.close()})},s=function(e){e.stopPropagation(),i.show({content:(0,r.jsx)(up,{job:n,onUpdateJob:a}),title:"Supporting documents",submit:!1})};return(0,r.jsx)(uh,{children:(0,r.jsxs)(k.Z,{children:[(0,r.jsx)(H.Z,{expandIcon:(0,r.jsx)(G.Z,{}),children:(0,r.jsxs)(F.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,r.jsx)(J.Z,{typography:"h6",children:"Supporting Documents"}),(0,r.jsx)(oX.Z,{onClick:s,size:"small",children:(0,r.jsx)(Q.Z,{sx:uv.editIcon})})]})}),(0,r.jsxs)($.Z,{children:[(0,r.jsx)(M.Z,{sx:uv.boxContainer,children:(0,r.jsx)(sm.V,{values:n.permitsLinks,title:"Permit links",displayMode:!0})}),(0,r.jsx)(ai.Z,{}),(0,r.jsx)(M.Z,{sx:uv.boxContainer,children:(0,r.jsx)(sb.G,{entity:"Job",entityId:n.id,carousel:!0,category:"supportingDocuments"})})]})]})})},uv={editIcon:{height:"17px",width:"17px"},boxContainer:{padding:"15px 10px"}},uh=(0,oW.ZP)(M.Z)(function(e){var n=e.theme;return{"&.MuiBox-root":{borderLeft:"5px solid ".concat(n.palette.error.light),borderTopLeftRadius:"5px",borderBottomLeftRadius:"5px"}}}),ub=N.ZP,ug=function(e){var n,t,a,u,m=e.id,f=(0,o.useState)(["task-board","messaging-comonent"]),v=f[0],h=f[1],b=(0,tQ.q)().hasUserModule,x=(0,nv.x)(),j=x.hasRole,y=x.user,Z=j("tenant"),I=j("customer_user"),R=b("quotes"),q=b("finances"),_=(0,c.a)(g.nh,{variables:{id:y.id}}).data,T=(void 0===_?{user:{}}:_).user,A=(0,i.Z)({},y,T),E=p.E6;j("supplier")&&(E=w),j("customer")&&(E=C),j("tenant")&&(E=S);var D=(0,c.a)(E,{skip:!m,variables:{number:m,adminId:A.adminId}}),P=D.loading,k=D.data,$=(void 0===k?{job:null}:k).job,H=D.refetch,M=(0,d.m)(p.$6,{skip:!m,variables:{number:m,adminId:A.adminId}}).data,O=(void 0===M?{timings:[]}:M).timings;if(!m)return null;if(!P&&!$)return s().push("/404"),!1;var N=$?(0,i.Z)({},$[0]):{};if((null==O?void 0:O.length)>0&&(N.timings=O),!R&&I&&"quote"===N.type)throw Error("No access to quotes module");var J=function(e){return function(n,t){t?h(function(n){return(0,l.Z)(n).concat([e])}):h(function(n){return n.filter(function(n){return n!==e})})}};return!P&&(0,r.jsxs)(ub,{container:!0,spacing:4,children:[(0,r.jsx)(ub,{item:!0,xs:12,md:6,lg2:4,children:(0,r.jsxs)(F.Z,{spacing:4,children:[(0,r.jsx)(oG,{job:N,refetch:H}),(0,r.jsx)(o9,{job:N,refetch:H}),N.supplier&&j(["admin"])&&(0,r.jsx)(ae,{job:N,refetch:H})]})}),(0,r.jsxs)(ub,{item:!0,container:!0,xs:12,md:6,lg2:8,spacing:4,children:[(0,r.jsx)(ub,{item:!0,xs:12,lg2:6,children:(0,r.jsxs)(F.Z,{spacing:4,children:["quote"!==N.type&&(!I||q)&&(!Z||q)&&(0,r.jsx)(a1,{job:N,refetch:H}),(0,r.jsx)(ss,{job:N,refetch:H}),(0,r.jsx)(sg,{job:N,refetch:H}),N.supplier&&j(["admin","customer"])&&(0,r.jsx)(uc,{job:N}),!N.supplier&&(null==N?void 0:null===(n=N.supplierOffers)||void 0===n?void 0:n.length)>0&&j(["admin"])&&!(0,W.E)(N,"rejected")&&!(0,W.E)(N,"closed")&&(0,r.jsx)(sC,{job:N,refetch:H}),(0,W.E)(N,"quoteNew")&&j("admin")&&(0,r.jsx)(sQ,{job:N,refetch:H}),(0,W.E)(N,"quoteNew")&&j(["customer","supplier","tenant"])&&(!I&&!Z||q)&&(!I&&!Z||R)&&(0,r.jsx)(ud,{job:N,refetch:H})]})}),(0,r.jsx)(ub,{item:!0,xs:12,lg2:6,children:(0,r.jsxs)(F.Z,{spacing:4,children:[!Z&&(0,r.jsx)(ur,{jobId:N.id,subscription:!0,showMyTaskButton:!0,expanded:v.includes("task-board"),onChangeExpanded:J("task-board")}),(0,r.jsx)(uo.b,{id:N.id,adminId:N.adminId,customerId:null===(t=N.customer)||void 0===t?void 0:t.id,supplierId:null===(a=N.supplier)||void 0===a?void 0:a.id,scope:"job",expanded:v.includes("messaging-comonent"),onChangeExpanded:J("messaging-comonent")}),(null==N?void 0:null===(u=N.location)||void 0===u?void 0:u.permitsRequired)&&(0,r.jsx)(uf,{job:N,refetch:H})]})})]})]})},ux=t(24716),uj=function(){var e=(0,o.useContext)(u.Z).user,n=(0,a.useRouter)().query;return e?(0,r.jsx)(ux.Z,{children:(0,r.jsx)(ug,(0,i.Z)({},n))}):(s().push("/account/sign-in"),null)};uj.getLayout=function(e){return e};var uy=uj}},function(e){e.O(0,[3662,367,2283,212,8890,9511,2583,6310,4599,4135,8579,4244,7645,3776,1564,2329,778,3054,1023,3911,1417,9957,6540,3425,1870,5037,8062,1352,4043,2429,1207,5117,9313,2600,4211,3704,1121,5926,2955,3699,4716,8359,6557,3762,3057,1650,8395,8682,9774,2888,179],function(){return e(e.s=33152)}),_N_E=e.O()}]);