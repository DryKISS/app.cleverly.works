(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8971],{14651:function(e,t,n){"use strict";var r=n(64836);t.Z=void 0;var i=r(n(64938)),o=n(85893);t.Z=(0,i.default)((0,o.jsx)("circle",{cx:"12",cy:"12",r:"10"}),"Brightness1")},50594:function(e,t,n){"use strict";var r=n(64836);t.Z=void 0;var i=r(n(64938)),o=n(85893);t.Z=(0,i.default)((0,o.jsx)("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close")},34193:function(e,t,n){"use strict";var r=n(64836);t.Z=void 0;var i=r(n(64938)),o=n(85893);t.Z=(0,i.default)((0,o.jsx)("path",{d:"m12 5.69 5 4.5V18h-2v-6H9v6H7v-7.81zM12 3 2 12h3v8h6v-6h2v6h6v-8h3z"}),"HomeOutlined")},58951:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var r=n(63366),i=n(87462),o=n(67294),a=n(63961),s=n(58510),c=n(90948),l=n(14136),d=n(71657),u=n(15861),m=n(1977),v=n(8027);function f(e){return(0,v.ZP)("MuiDialogContentText",e)}(0,m.Z)("MuiDialogContentText",["root"]);var p=n(85893);let h=["children","className"],b=e=>{let{classes:t}=e,n=(0,s.Z)({root:["root"]},f,t);return(0,i.Z)({},t,n)},g=(0,c.ZP)(u.Z,{shouldForwardProp:e=>(0,l.Z)(e)||"classes"===e,name:"MuiDialogContentText",slot:"Root",overridesResolver:(e,t)=>t.root})({}),x=o.forwardRef(function(e,t){let n=(0,d.Z)({props:e,name:"MuiDialogContentText"}),{className:o}=n,s=(0,r.Z)(n,h),c=b(s);return(0,p.jsx)(g,(0,i.Z)({component:"p",variant:"body1",color:"text.secondary",ref:t,ownerState:s,className:(0,a.Z)(c.root,o)},n,{classes:c}))});var y=x},37645:function(e,t,n){"use strict";var r=n(87462),i=n(63366),o=n(67294),a=n(63961),s=n(58510),c=n(15861),l=n(90948),d=n(71657),u=n(4472),m=n(34182),v=n(85893);let f=["className","id"],p=e=>{let{classes:t}=e;return(0,s.Z)({root:["root"]},u.a,t)},h=(0,l.ZP)(c.Z,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,t)=>t.root})({padding:"16px 24px",flex:"0 0 auto"}),b=o.forwardRef(function(e,t){let n=(0,d.Z)({props:e,name:"MuiDialogTitle"}),{className:s,id:c}=n,l=(0,i.Z)(n,f),u=p(n),{titleId:b=c}=o.useContext(m.Z);return(0,v.jsx)(h,(0,r.Z)({component:"h2",className:(0,a.Z)(u.root,s),ownerState:n,ref:t,variant:"h6",id:null!=c?c:b},l))});t.Z=b},90951:function(e,t,n){"use strict";n.d(t,{Z:function(){return w}});var r,i,o,a,s,c,l,d=n(51174),u=n(18391),m=n(66080),v=n(67294),f=n(45697),p=n(10367),h=n(64522),b=["disabled"],g=(0,v.forwardRef)(function(e,t){var n=e.disabled,r=(0,m.Z)(e,b);return v.createElement(x,(0,u.Z)({disabled:n,type:"radio",ref:t},r))}),x=p.ZP.input(r||(r=(0,d.Z)(["\n  cursor: pointer;\n  margin-right: 0.5rem;\n"])));g.propTypes={disabled:f.bool},g.defaultProps={stacked:!1};var y=n(92415),Z=["data","errors","legend","stacked"],j=["disabled","label"],C=function(e){var t=e.data,n=e.errors,r=e.legend,i=e.stacked,o=(0,m.Z)(e,Z);return v.createElement(S,{error:n[o.name]},r&&v.createElement(T,{error:n[o.name]},r),t.map(function(e){var t=e.disabled,r=e.label,a=(0,m.Z)(e,j);return v.createElement(A,{htmlFor:a.id,key:a.id,stacked:i},v.createElement(h.Z,(0,u.Z)({component:g,disabled:t,errors:n[o.name],showError:!1},a,o)),r)}))};C.displayName="RadioField";var S=p.ZP.fieldset(i||(i=(0,d.Z)(["\n  border-radius: 0.25rem;\n  color: ",";\n  ","\n"])),function(e){return e.theme.COLOUR.dark},function(e){return e.error&&(0,p.iv)(o||(o=(0,d.Z)(["\n      ","\n      padding: 0.5rem;\n    "])),function(e){return(0,y.Z)(e)})}),T=p.ZP.legend(a||(a=(0,d.Z)(["\n  ","\n"])),function(e){return e.error&&(0,p.iv)(s||(s=(0,d.Z)(["\n      padding: 0 0.5rem;\n    "])))}),A=p.ZP.label(c||(c=(0,d.Z)(["\n  cursor: pointer;\n  margin-right: 1.25rem;\n  position: relative;\n  ","\n"])),function(e){return e.stacked&&(0,p.iv)(l||(l=(0,d.Z)(["\n      display: block;\n      margin: 0.5rem 0;\n    "])))});C.propTypes={data:f.array.isRequired,legend:f.string,stacked:f.bool},C.defaultProps={data:[],stacked:!1};var w=C},41085:function(e,t,n){"use strict";n.d(t,{Z:function(){return _}});var r,i,o,a,s,c,l,d,u,m,v,f,p=n(51174),h=n(18391),b=n(76702),g=n(67294),x=n(45697),y=n(11163),Z=n.n(y),j=n(10367),C=function(e){return e.toString().toLowerCase().trim().normalize("NFKD").replace(/\s+/g,"-").replace(/[^\w-]+/g,"").replace(/--+/g,"-").replace(RegExp("-$"),"")},S=function(e){var t=e.activeTab,n=e.childClick,r=e.context,i=e.data,o=e.disabled,a=e.gap,s=e.index,c=e.indicatorSize,l=e.label,d=e.onClick,u=e.scrollToActiveTab,m=(0,g.useRef)(null),v=C(l),f=t.label===v;(0,g.useEffect)(function(){u&&m.current&&m.current.scrollIntoView({behavior:"smooth",block:"end"})},[f]);var p=function(e){!f&&(d&&d({index:s,label:v}),n&&n())};return i||(i={"data-cy":"".concat(v,"Tab")}),g.createElement(T,(0,h.Z)({active:f,context:r},i,{disabled:o,indicatorSize:c,onClick:p,ref:f&&u?m:null,gap:a}),l)};S.displayName="Tab";var T=j.ZP.li(r||(r=(0,p.Z)(["\n  ","\n\n  ","\n\n  ","\n\n  ","\n\n  &:hover {\n    ","\n\n    ","\n  }\n\n  &:last-of-type {\n    border-top-right-radius: ",";\n    border-top-left-radius: inherit;\n    border-right: 1px solid ",";\n  }\n\n  &:first-child {\n    border-top-left-radius: ",";\n    border-top-right-radius: inherit;\n    border-right: 0px;\n  }\n\n  min-width: fit-content;\n  display: inline-block;\n  list-style: none;\n  margin-bottom: -1px;\n  padding: 0.5rem 0.75rem;\n"])),function(e){var t=e.context,n=e.theme,r=e.gap;return(0,j.iv)(i||(i=(0,p.Z)(["\n    background-color: ",";\n    border-left: 1px solid ",";\n    border-bottom: 1px solid ",";\n    border-top: 1px solid ",";\n    color: ",";\n    ","\n  "])),n.TABS.colour,n.TABS.borderColour,t?n.COLOUR[t]:n.TABS.borderColour,n.TABS.borderColour,n.TABS.tabTextColour,0!==r&&(0,j.iv)(o||(o=(0,p.Z)(["\n      border-right: 1px solid ",";\n    "])),n.TABS.borderColour))},function(e){var t=e.active,n=(e.context,e.indicatorSize),r=e.theme;return t&&(0,j.iv)(a||(a=(0,p.Z)(["\n      background-color: ",";\n      border-bottom: ","px solid ",";\n      color: ",";\n    "])),r.TABS.activeColour,n,r.COLOUR.primary,r.TABS.activeTabTextColour)},function(e){var t=e.active;return e.theme,!t&&(0,j.iv)(s||(s=(0,p.Z)(["\n      cursor: pointer;\n    "])))},function(e){var t=e.disabled,n=e.theme;return t&&(0,j.iv)(c||(c=(0,p.Z)(["\n      background-color: ",";\n      cursor: not-allowed;\n    "])),n.TABS.disabledColour)},function(e){var t=e.active,n=e.theme;return!t&&(0,j.iv)(l||(l=(0,p.Z)(["\n        background-color: ",";\n      "])),n.TABS.hoverColour)},function(e){var t=e.disabled,n=e.theme;return t&&(0,j.iv)(d||(d=(0,p.Z)(["\n        background-color: ",";\n      "])),n.TABS.disabledColour)},function(e){return e.theme.TABS.borderRadius},function(e){return e.theme.TABS.borderColour},function(e){return e.theme.TABS.borderRadius});S.propTypes={activeTab:x.string.isRequired,childClick:x.func,context:(0,x.oneOfType)([x.bool,x.string]),data:x.object,disabled:x.bool,index:x.number,label:x.string.isRequired,onClick:(0,x.oneOfType)([x.bool,x.func]).isRequired,scrollToActiveTab:x.bool},S.defaultProps={context:!1,scrollToActiveTab:!0};var A=function(e,t,n){var r,i,o,a=e,s=!1,c=!1;a.addEventListener("mousedown",function(e){r=e.timeStamp,s=!0,i=e.pageX-a.offsetLeft,o=a.scrollLeft}),a.addEventListener("mouseleave",function(){s=!1,c=!1,a.classList.remove("active")}),a.addEventListener("mouseup",function(){s=!1,c=!1,a.classList.remove("active")}),a.addEventListener("mousemove",function(e){if(c||s&&e.timeStamp-r>n){e.preventDefault(),a.classList.add("active");var l=e.pageX-a.offsetLeft-i;c=!0,a.scrollLeft=o-l+t}})},w=function(e){var t=e.activeTab;return e.children[t.index].props.children},I="",k=function(e){var t=e.centerTabs,n=e.children,r=e.className,i=e.indicatorSize,o=e.gap,a=e.grabbable,s=e.grabWalkSpeed,c=e.grabTimeout,l=e.handleChange,d=e.onTabChange,u=e.scrollToActiveTab,m=(0,y.useRouter)(),v=(0,g.createRef)();(0,g.useEffect)(function(){a&&A(v.current,s,c)},[]),Array.isArray(n)||(n=g.Children.toArray(n)),n.length>1?n.forEach(function(e,t){!0===e.props.active&&(I={index:t,label:C(e.props.label)})}):I={index:0,label:C(n[0].props.label)};var f=(0,g.useState)(I),p=(0,b.Z)(f,2),x=p[0],j=p[1],T=function(e){var t=e.index,n=C(e.label);j({index:t,label:n}),l&&k(n),d&&d(n)},k=function(e){var t=m.query;delete t.tab,t.tab=e,Z().push({pathname:m.pathname,query:t,shallow:!0})};return g.createElement(g.Fragment,null,g.createElement(q,{centerTabs:t,className:r,gap:o,grabbable:a,ref:v},n.map(function(e,t){var n=e.props;return g.createElement(S,(0,h.Z)({activeTab:x,index:t,key:n.label,onClick:!n.disabled&&T,scrollToActiveTab:u,gap:o,indicatorSize:i},n))})),g.createElement(w,{activeTab:x,children:n}))},q=j.ZP.ol(u||(u=(0,p.Z)(["\n  align-items: flex-end;\n  border-bottom: 1px solid ",";\n  display: flex;\n  ","\n\n  ","\n\n  margin: 0 0 1rem 0;\n  padding-left: 0;\n  overflow-x: scroll;\n  user-select: none;\n  white-space: nowrap;\n  -ms-overflow-style: none;\n  &&::-webkit-scrollbar {\n    display: none;\n  }\n\n  ","\n"])),function(e){return e.theme.TABS.borderColour},function(e){var t=e.gap;return 0!==t&&(0,j.iv)(m||(m=(0,p.Z)(["\n      gap: ","px;\n    "])),t)},function(e){return e.centerTabs&&(0,j.iv)(v||(v=(0,p.Z)(["\n      justify-content: center;\n    "])))},function(e){return e.grabbable&&(0,j.iv)(f||(f=(0,p.Z)(["\n      &.active {\n        cursor: grabbing;\n\n        li {\n          cursor: grabbing;\n          pointer-events: none;\n        }\n      }\n    "])))});k.propTypes={centerTabs:x.bool,children:(0,x.oneOfType)([x.array,x.object]).isRequired,className:x.string,gap:x.number,grabbable:x.bool,grabWalkSpeed:x.number,grabTimeout:x.number,handleChange:x.bool,indicatorSize:x.number,scrollToActiveTab:x.bool},k.defaultProps={centerTabs:!1,gap:0,grabbable:!0,grabWalkSpeed:25,grabTimeout:100,handleChange:!0,indicatorSize:1,scrollToActiveTab:!0};var _=k},59090:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/customers/view",function(){return n(94124)}])},53600:function(e,t,n){"use strict";n.d(t,{E:function(){return r}});var r=function(e,t){if(Array.isArray(t)){var n,r=null;return t.forEach(function(t){var n,i=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});r=(null==i?void 0:i.createdAt)||r}),r}var i=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});return(null==i?void 0:i.createdAt)||null}},58632:function(e,t,n){"use strict";n.d(t,{x:function(){return r}});var r=[{text:"Reactive",value:"reactive",context:"#2EE6CA"},{text:"Planned Maintenance",value:"ppm",context:"#D67EFF"},{text:"Quote",value:"quote",context:"#7D7"},{text:"Compliance",value:"cppm",context:"#CC7429"}]},68550:function(e,t,n){"use strict";n.d(t,{V:function(){return ec}});var r=n(26042),i=n(828),o=n(85893),a=n(67294),s=n(45697),c=n(30381),l=n.n(c),d=n(11163),u=n.n(d),m=n(57460),v=n.n(m),f=n(6812),p=n(73359),h=n(7297),b=n(75063);function g(){var e=(0,h.Z)(['\n  query GetLocations(\n    $accountId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Location_order_by!\n  ) {\n    properties: Location(\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      id\n      access\n      contactUserId\n      createdAt\n      name\n      status\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n      customer: Account_Locations {\n        id\n        account: Account {\n          id\n          name\n        }\n      }\n      bookings: Jobs(\n        where: { Invoices: { invoiceType: { _in: ["customerVat", "ProformaInvoiceCustomer"] } } }\n      ) {\n        id\n      }\n      user: User {\n        id\n        fullName\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return g=function(){return e},e}var x=(0,b.Ps)(g()),y=n(90629),Z=n(15861),j=n(98456),C=n(51233),S=n(11057),T=n(93946),A=n(5616),w=n(61730),I=n(2548),k=n(81261),q=n(14924),_=n(69396),L=n(96486),E=n(98209),N=n(59577),F=function(e){var t,n,i,o,s,c,l,d,u,m,v,f=e.filters,p=e.newFilters,h=e.initialSort,b=(0,a.useRef)(),g=(0,a.useState)({}),x=g[0],y=g[1],Z=(0,a.useState)({}),j=Z[0],C=Z[1],S=h||{item:"createdAt",order:"desc"},T=(0,q.Z)({},(null===(t=b.current)||void 0===t?void 0:t.sort.item)||S.item,S.inneritem?(0,q.Z)({},S.inneritem,(null===(n=b.current)||void 0===n?void 0:n.sort.order)||S.order):(null===(i=b.current)||void 0===i?void 0:i.sort.order)||S.order);return(0,a.useEffect)(function(){var e=!(0,L.isEqual)(x,f),t=!(0,L.isEqual)(j,p);if(e&&(y(f),null==b||null===(r=b.current)||void 0===r||r.resetPagination()),t&&(C(p),null==b||null===(i=b.current)||void 0===i||i.resetPagination()),(null==b?void 0:null===(n=b.current)||void 0===n?void 0:n.setSort)&&!(e||t)){var n,r,i,o,a,s,c,l,d,u,m,v=(null===(o=b.current)||void 0===o?void 0:null===(a=o.sort)||void 0===a?void 0:a.item)&&(null===(s=b.current)||void 0===s?void 0:null===(c=s.sort)||void 0===c?void 0:c.order)?{item:null===(l=b.current)||void 0===l?void 0:null===(d=l.sort)||void 0===d?void 0:d.item,order:null===(u=b.current)||void 0===u?void 0:null===(m=u.sort)||void 0===m?void 0:m.order}:T;b.current.setSort(v)}},[f,p]),{initialData:(0,_.Z)((0,r.Z)({},f),{newFilters:(null==p?void 0:p.length)>0?p:void 0,limit:(null===(o=b.current)||void 0===o?void 0:o.pageSize)==="Infinity"?null:parseInt(null===(s=b.current)||void 0===s?void 0:s.pageSize,10)||E.C1.paginationSize,offset:((null===(c=b.current)||void 0===c?void 0:c.currentPage)-1||0)*((null===(l=b.current)||void 0===l?void 0:l.pageSize)||E.C1.paginationSize),orderBy:(0,N.c)(null===(d=b.current)||void 0===d?void 0:null===(u=d.sort)||void 0===u?void 0:null===(m=u.item)||void 0===m?void 0:m.replace(/ORDER/i,null===(v=b.current)||void 0===v?void 0:v.sort.order))||T}),initialSort:h,ref:b}},M=n(74492),P=n(35374),R=n(16605),O=n(78067),H=n(83162),W=n(50108),D=n(42283),U=n(11994),B=n(90948),$=n(50135),z=n(82670),V=n(50319),Y=n(53767);function Q(){var e=(0,h.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]);return Q=function(){return e},e}function X(){var e=(0,h.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"]);return X=function(){return e},e}var J=(0,b.Ps)(Q()),G=(0,b.Ps)(X()),K=n(57493),ee=n(18531),et=S.Z,en=function(e){var t=e.initialFilters,n=e.filters,s=e.setFilters,c=e.open,l=e.onClose,u=(0,d.useRouter)().query,m=(0,w.Z)("(max-width: 400px)"),v=(0,a.useMemo)(function(){return(null==u?void 0:u.tab)==="locations"},[u]),h=(0,i.Z)(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",r=(0,Y.q)().user,o=(0,a.useState)(function(){try{switch(n){case"network":case"state":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||t}}catch(r){return t}}),s=o[0],c=o[1],l=function(t){try{var i=(0,z.Z)(t,Function)?t(s):t;switch(c(i),n){case"network":d({variables:{accountUserId:null==r?void 0:r.accountUserId,filters:(0,q.Z)({},e,i)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(i))}}catch(o){}};(0,f.a)(J,{variables:{accountUserId:null==r?void 0:r.accountUserId},skip:"network"!==n,onCompleted:function(n){var r=n.accountUser;r&&c(r.filters[e]||t)}});var d=(0,i.Z)((0,V.D)(G),1)[0];return[s,l]}("form_data_".concat(t.filterType).concat(v?"_".concat(t.accountId):""),t),2),b=h[0],g=h[1],x=(0,a.useState)(),Z=x[0],j=x[1],S=(0,D.cI)({defaultValues:b}),T=S.control,A=S.handleSubmit,I=S.register,k=S.reset,L=S.errors,E=(0,i.Z)((0,p.t)(K.SW,{variables:{where:{name:{_ilike:""!==Z?"%".concat(Z,"%"):null}}}}),2),N=E[0],F=E[1],M=F.loading,P=F.data,R=(void 0===P?{items:[]}:P).items,O=function(){s(t),k(),l(),g((0,_.Z)((0,r.Z)({},t),{filterType:t.filterType}))},H=function(e){var i,o=(0,_.Z)((0,r.Z)({},n,e),{accountId:v?t.accountId:null===(i=e.customer)||void 0===i?void 0:i.value,q:e.q});s((0,_.Z)((0,r.Z)({},o),{q:e.q?"%".concat(e.q,"%"):null})),g((0,_.Z)((0,r.Z)({},o),{customer:v?null:e.customer,filterType:t.filterType})),k(),l()};return(0,o.jsx)(er,{open:c,onClose:l,children:(0,o.jsx)(y.Z,{sx:{minWidth:m?"300px":"400px",padding:"20px 40px"},children:(0,o.jsxs)("form",{onSubmit:A(H),children:[(0,o.jsxs)(C.Z,{spacing:v?8:4,children:[(0,o.jsx)($.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search...",name:"q",inputRef:I}),!v&&(0,o.jsx)(D.Qr,{name:"customer",control:T,render:function(e){var t,n=e.value,r=e.onChange;return(0,o.jsx)(ee.q,{limitTags:6,color:"secondary",value:n,onChange:function(e,t){return r(t)},label:"Select customer",loading:M,onOpen:function(){return N()},options:R,setSearch:j,textFieldProps:{label:"Select customer",variant:"standard",color:"secondary",error:L.customer,helperText:null===(t=L.customer)||void 0===t?void 0:t.message}})}})]}),(0,o.jsxs)(C.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,sx:{margin:"20px 0"},children:[(0,o.jsx)(et,{variant:"contained",color:"danger",onClick:function(){return O()},children:"Cancel"}),(0,o.jsx)(et,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})},er=(0,B.ZP)(U.Z)(function(){return{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}});en.propTypes={open:s.bool,onClose:s.func,initialFilters:s.object,setFilters:s.func.isRequired};var ei=n(34187),eo=n(45451),ea=S.Z,es=function(e){return l()(e).format("YYYY-MM-DD")},ec=function(e){var t,n=e.accountId,s=e.accountName,c=e.initialFilters,l=e.columnVisibilityModel,d=e.tableContainerHeight,m=(0,a.useState)(!1),h=m[0],b=m[1],g=(0,a.useState)(!1),S=g[0],q=g[1],_=(0,a.useState)((0,r.Z)({},c)),L=_[0],E=_[1],N=F({filters:L}),D=N.initialData,U=N.ref,B=(0,M.a)(),$=(0,w.Z)("(max-width: 400px)"),z=(0,P.s)(),V=(0,f.a)(x,{variables:D}),Y=V.data,Q=void 0===Y?{properties:[],meta:{aggregate:{totalCount:0}}}:Y,X=Q.properties,J=Q.meta,G=V.loading,K=V.refetch,ee=(0,i.Z)((0,p.t)(x,{fetchPolicy:"no-cache",variables:{accountId:D.accountId,q:D.q,orderBy:D.orderBy},onCompleted:function(e){try{var t=v().unparse(el(e.properties)),n="data:application/octet-stream,"+encodeURIComponent(t);(0,R.S)(n,"locations.csv")}finally{q(!1)}}}),1)[0],et=function(e){e.stopPropagation(),q(!0),ee()},er=(0,a.useCallback)(function(e,t){e.stopPropagation(),B.show({content:(0,o.jsx)(O.m,{accountId:n,accountName:s,data:null==t?void 0:t.data,entity:"Location",refetch:K}),title:(null==t?void 0:t.data)?"Edit location":"Create location"})},[B,n,s,K]),ec=function(e){var t=e.row;u().push("".concat("/dashboard/properties/","view?id=").concat(t.data.id,"&tab=details"))},el=function(e){return e.map(function(e){var t,n,r=null===(t=null==e?void 0:e.addresses[0])||void 0===t?void 0:t.address;return{name:e.name||"Not Specified",customer:e.customer[0].account.name,address:r?"".concat(r.addressLine1," - ").concat(r.postCode):"",bookings:null===(n=e.bookings)||void 0===n?void 0:n.length,totalSpent:(0,W.T)(0),createdAt:es(e.createdAt)}})},ed=(0,a.useCallback)(function(){return X.map(function(e){var t,n,r,i;return{id:e.id,data:e,name:e.name||"Not Specified",address:(null===(t=e.addresses[0])||void 0===t?void 0:t.address)?"\n            ".concat(null===(n=e.addresses[0])||void 0===n?void 0:n.address.addressLine1," -\n            ").concat(null===(r=e.addresses[0])||void 0===r?void 0:r.address.postCode):"Please Add",customer:e.customer[0].account.name,customerId:e.customer[0].account.id,workOrders:null===(i=e.bookings)||void 0===i?void 0:i.length,totalSpent:(0,W.T)(0),createdAt:es(e.createdAt),status:e.status,actions:""}})},[X]),eu=(0,a.useMemo)(function(){var e={};return!ed().length&&(null==D?void 0:D.q)?{title:"No results",subtitleFirstLine:"The filters you have applied have returned no results",subtitleSecondLine:"Please amend and try again if necessary."}:{title:"No locations",subtitleFirstLine:"You currently have no locations set up in the system",subtitleSecondLine:"Click\xa0create location\xa0to get started building.",buttonText:"Create location",onAction:er}},[er,null==D?void 0:D.q,ed]),em=(0,r.Z)({},l);return(0,o.jsxs)(o.Fragment,{children:[h&&(0,o.jsx)(en,{initialFilters:c,open:h,filters:L,setFilters:E,onClose:function(){return b(!1)}}),(0,o.jsxs)(C.Z,{width:"100%",spacing:2,sx:{height:"100%"},children:[(0,o.jsxs)(C.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,o.jsx)(ea,{variant:"contained",startIcon:(0,o.jsx)(k.Z,{}),onClick:function(){return b(!0)},children:"Filters"}),(0,o.jsxs)(C.Z,{direction:"row",spacing:2,children:[(0,o.jsx)(ea,{variant:"contained",color:"secondary",onClick:er,children:"Create Location"}),!z&&(0,o.jsx)(ea,{startIcon:!S&&(0,o.jsx)("img",{src:"/static/icons/csv.svg"}),disabled:S,variant:"contained",color:"success",onClick:et,children:S?(0,o.jsx)(j.Z,{size:20,color:"secondary"}):"Export"})]})]}),(0,o.jsxs)(y.Z,{sx:{padding:"16px 0px",height:d},children:[(0,o.jsx)(Z.Z,{ml:2,variant:"h5",sx:{fontWeight:600,marginBottom:"15px"},children:"Locations"}),(null===(t=ed())||void 0===t?void 0:t.length)?(0,o.jsx)(eo.i,{ref:U,loading:G,columns:[{headerName:"Name",field:"name",minWidth:370,flex:1},{headerName:"Address",field:"address",minWidth:300,flex:1,sortable:!1},{headerName:"Customer",field:"customer",sortable:!1,flex:1,minWidth:$?100:"auto",renderCell:function(e){var t=e.row,n=t.customer,r=t.customerId;return(0,o.jsx)(H.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(r),children:n})}},{headerName:"Work Orders",field:"workOrders",sortable:!1,minWidth:$?100:"auto",renderCell:function(e){var t=e.row.workOrders;return(0,o.jsx)(A.Z,{sx:{marginLeft:"3em"},children:t})},flex:1},{headerName:"Total Spent",field:"totalSpent",sortable:!1,minWidth:$?140:"auto",renderCell:function(e){var t=e.row.totalSpent;return(0,o.jsx)(A.Z,{sx:{marginLeft:"1.5em"},children:t})},flex:1},{field:"createdAt",headerName:"Created At",minWidth:$?200:"auto",flex:1,sortable:!0},{field:"actions",headerName:"Actions",sortable:!1,minWidth:$?80:"auto",renderCell:function(e){var t=e.row;return(0,o.jsx)(T.Z,{sx:{marginLeft:"1em"},onClick:function(){return ec({row:t})},children:(0,o.jsx)(I.Z,{})})},flex:1}],rows:ed(),columnVisibilityModel:em,meta:J,refetch:K,autoHeight:!1,containerHeight:"calc(100% - 52px)",onRowClick:ec}):!G&&(0,o.jsx)(ei.C,(0,r.Z)({imageSrc:"/static/icons/no_locations_found.svg"},eu))]})]})]})};ec.propTypes={accountId:s.number,accountName:s.string,initialFilters:s.object,columnVisibilityModel:s.object,tableContainerHeight:s.string},ec.defaultProps={columnVisibilityModel:{},tableContainerHeight:"calc(100% - 52px)"}},94124:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return ed}});var r=n(85893),i=n(24716),o=n(9270),a=n(62140),s=n(67294),c=n(11163),l=n.n(c),d=n(6812),u=n(22181),m=n(41085),v=n(66267),f=n(45697),p=n.n(f),h=n(11585),b=n(16540),g=n(19611),x=n(74280),y=function(){return(0,r.jsx)(h.Z,{open:!0,title:"Compliance Score"})};y.propTypes={customerId:f.number.isRequired};var Z=n(41890),j=n(30381),C=n.n(j),S=n(32791),T=n(26535),A=function(e){var t,n,i,o,a,s,c,d,u,m,v,f,p=e.customer,h=e.offCanvas,b=e.refetch,g=(0,T.WE)(p,"registered"),x=(0,T.WE)(p,"trading"),y=(0,T.WE)(p,"invoice"),Z=function(e){e&&b()};return[{id:1,label:"Create account",date:p.createdAt},{id:2,label:"Complete profile",info:"",date:(null==g?void 0:g.createdAt)||null,actions:[{id:1,active:!0,content:"Registered address",context:"secondary",handleClick:function(){var e;h.show({content:(0,r.jsx)(S.H,{addressId:(null==g?void 0:null===(e=g.address)||void 0===e?void 0:e.id)||null,entity:"Account",entityId:p.id,id:(null==g?void 0:g.id)||null,onSubmit:Z,type:"registered"}),submit:!1,title:"Manage addresses"})},type:"button"},{id:2,active:!0,content:"Trading address",context:"secondary",handleClick:function(){var e;h.show({content:(0,r.jsx)(S.H,{addressId:(null==x?void 0:null===(e=x.address)||void 0===e?void 0:e.id)||null,entity:"Account",entityId:p.id,id:(null==x?void 0:x.id)||null,onSubmit:Z,type:"trading"}),submit:!1,title:"Manage addresses"})},type:"button"},{id:3,active:!0,content:"Invoice address",context:"secondary",handleClick:function(){var e;h.show({content:(0,r.jsx)(S.H,{addressId:(null==y?void 0:null===(e=y.address)||void 0===e?void 0:e.id)||null,entity:"Account",entityId:p.id,id:(null==y?void 0:y.id)||null,onSubmit:Z,type:"invoice"}),submit:!1,title:"Manage addresses",width:"50%"})},type:"button"}]},{id:3,label:"Add location",info:"",date:(null===(t=p.propertiesMeta)||void 0===t?void 0:null===(n=t.aggregate)||void 0===n?void 0:n.count)?p.createdAt:null,content:[{id:1,active:(null===(i=p.propertiesMeta)||void 0===i?void 0:null===(o=i.aggregate)||void 0===o?void 0:o.count)>0,data:"".concat(null===(a=p.propertiesMeta)||void 0===a?void 0:null===(s=a.aggregate)||void 0===s?void 0:s.count," properties added")}],actions:[{id:1,active:!0,content:"Submit location",context:"secondary",handleClick:function(){l().push("".concat("/dashboard/customers/","view?id=").concat(p.id,"&tab=locations"))},type:"button"}]},{id:6,label:"Start issuing work orders",info:"submit work orders",date:(null===(c=p.jobsMeta)||void 0===c?void 0:null===(d=c.aggregate)||void 0===d?void 0:d.count)?p.createdAt:null,content:[{id:1,active:(null===(u=p.jobsMeta)||void 0===u?void 0:null===(m=u.aggregate)||void 0===m?void 0:m.count)>0,data:"".concat(null===(v=p.jobsMeta)||void 0===v?void 0:null===(f=v.aggregate)||void 0===f?void 0:f.count," jobs created")}]}]},w=function(e,t,n){var r=A({customer:e,offCanvas:t,refetch:n});return r.forEach(function(e){e.date&&(e.date=C()(e.date).format("D MMM YYYY HH:mm"))}),r},I=n(74492),k=function(e){var t,n=e.customer,i=e.refetch,o=(0,I.a)();return(0,r.jsx)(h.Z,{open:!0,title:"Profile",children:(0,r.jsx)(Z.Z,{items:w(n,o,i),summary:(t=n,[{label:"Account manager: ",value:t.manager?"".concat(t.manager.nameFirst," ").concat(t.manager.nameLast," "):"Unassigned"},{label:"Users: ",value:t.usersMeta?t.usersMeta.aggregate.count:0},{label:"Status: ",value:t.status||""}])},"stepper-".concat(n.id))})},q=n(97637),_=n(32725),L=n(81777),E=n(22378),N=function(e){var t,n=e.customer,i=e.hasRole,s=e.refetch,c=(0,T.WE)(n,"registered"),l=(0,T.WE)(n,"trading"),d=[{key:"Company Number",value:n.companyNumber},{key:"VAT",value:n.vatId}];return n.clientType&&d.push({key:"Customer Type",value:n.clientType.name}),(null===(t=n.meta)||void 0===t?void 0:t.xeroContactId)&&d.push({key:"Xero Contact ID",value:n.meta.xeroContactId}),(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(o.Z,{children:[(0,r.jsxs)(a.Z,{md:4,children:[(0,r.jsx)(L.g,{avatar:(0,x.Q)(n.media),editable:i("admin"),entity:n,entityName:"Account",icons:i("admin")?(0,E.Y)(n):[]}),n.contactUsers&&(0,r.jsx)(h.Z,{title:"Contact",children:n.contactUsers.map(function(e){var t;return(0,r.jsxs)("div",{children:[(0,r.jsx)(b.Z,{rows:[{key:"Name",value:"".concat(e.user.nameFirst," ").concat(e.user.nameLast)},{key:"Phone",value:e.user.phone},{key:"Email",value:e.user.email}]}),(0,r.jsx)("br",{})]},e.userId)})}),(0,r.jsx)(h.Z,{title:"Company",children:(0,r.jsx)(b.Z,{rows:d})}),c&&(0,r.jsx)(g.f,{address:c.address,entity:"Account",entityId:n.id,id:c.id,refetch:s,title:"Registered Address",type:"registered"}),l&&(0,r.jsx)(g.f,{address:l.address,entity:"Account",entityId:n.id,id:l.id,refetch:s,title:"Trading Address",type:"trading"}),i("admin")&&(0,r.jsx)(_.E,{entity:"Account",entityId:n.id,open:!0,title:"Notes"})]}),(0,r.jsx)(a.Z,{md:4,children:(0,r.jsx)(k,{refetch:s,customer:n})}),(0,r.jsxs)(a.Z,{md:4,children:[(0,r.jsx)(q.G,{details:!0,entity:"Account",entityId:n.id}),(0,r.jsx)(y,{customerId:n.id})]})]})})};N.propTypes={customer:f.object.isRequired};var F=n(39453),M=n(246),P=n(43427),R=n(15487),O=n(70323),H=n(74944),W=n(53767),D=n(21913),U=n(26042),B=n(69396),$=n(828),z=n(12632),V=n(11057),Y=n(87918),Q=n(90629),X=n(51233),J=n(15861),G=n(45451),K=n(25040),ee=n(67797),et=n(21830),en=n(74301),er=n(79217),ei=n(15843),eo=function(e){var t=e.editable,n=e.initialFilters,i=e.parentEntity,o=e.entity,a=e.entityId,c=e.tableHeight,l=e.paperHeight,u=(0,$.Z)((0,ee.d)(),2),m=u[0],v=u[1],f=(0,s.useState)({}),p=f[0],h=f[1],b=(0,s.useState)(!1),g=b[0],x=b[1],y=(0,z.x)({filters:p}),Z=y.ref,j=y.initialData,C=(0,d.a)(K.MD,{variables:(0,B.Z)((0,U.Z)({},j),{entity:i,childEntityId:a,childEntity:o,includeLocations:"Customer"===o})}),S=C.data,T=void 0===S?{schedules:[],meta:{aggregate:{totalCount:0}}}:S,A=T.schedules,w=T.meta,I=C.loading,k=C.refetch,q=(0,s.useCallback)(function(e){t&&v({content:function(t){var n=t.onClose;return(0,r.jsx)(en.t,{isEdit:e.isChild,scheduleId:e.id,entity:o,entityId:a,close:n})}})},[o,a,t,v]),_=(0,s.useCallback)(function(e){return[{icon:"edit",onClick:function(t){t.stopPropagation(),q(e)},tooltip:"Edit Schedule"}]},[q]),L=(0,s.useMemo)(function(){return[{sortable:!1,flex:1,minWidth:180,field:"serviceLine",headerName:"Service line"},{sortable:!1,flex:1,minWidth:180,field:"schedule",headerName:"Schedule"},{sortable:!1,flex:1,minWidth:180,field:"rate",headerName:"\xa3/H",renderCell:function(e){var t=e.row;return(0,r.jsxs)(X.Z,{children:[(0,r.jsxs)(J.Z,{children:["First hour: \xa3 ",t.rate.firstHour]}),(0,r.jsxs)(J.Z,{children:["Subsequent hours: \xa3 ",t.rate.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:180,field:"rateOOH",headerName:"\xa3/H OOH",renderCell:function(e){var t=e.row;return(0,r.jsxs)(X.Z,{children:[(0,r.jsxs)(J.Z,{children:["First hour: \xa3 ",t.rateOOH.firstHour]}),(0,r.jsxs)(J.Z,{children:["Subsequent hours: \xa3 ",t.rateOOH.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:180,field:"ratePremium",headerName:"\xa3/H Premium",renderCell:function(e){var t=e.row;return(0,r.jsxs)(X.Z,{children:[(0,r.jsxs)(J.Z,{children:["First hour: \xa3 ",t.ratePremium.firstHour]}),(0,r.jsxs)(J.Z,{children:["Subsequent hours: \xa3 ",t.ratePremium.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:150,field:"locations",headerName:"Locations"},{sortable:!1,flex:1,minWidth:150,field:"coverageArea",headerName:"Coverage area"},{sortable:!1,flex:1,field:"minimumDuration",headerName:"Min duration"},{sortable:!1,flex:1,field:"minimumIncrement",headerName:"Min increment"},{sortable:!1,flex:1,minWidth:100,field:"status",headerName:"Status",renderCell:function(e){var t=e.row;return(0,r.jsx)(Y.Z,{label:"active"===t.status?"Active":"Inactive",color:"active"===t.status?"success":"danger",size:"small"})}},{sortable:!1,width:100,field:"actions",headerName:"Actions",renderCell:function(e){var t=e.row;return(0,r.jsx)(et.C,{row:t,actionsData:_})}}]},[_]),E=(0,s.useMemo)(function(){return A.map(function(e){var t,n,r=null===(t=e.childSchedules)||void 0===t?void 0:t[0];return r?{id:r.id,serviceLine:e.service.name,schedule:r.name,rate:r.normal,rateOOH:r.ooh,ratePremium:r.premium,locations:(null===(n=r.locations)||void 0===n?void 0:n.map(function(e){return e.location.name}).join(", "))||"-",coverageArea:e.postcodeAreas.map(function(e){return e.postcode.area}).join(", "),minimumDuration:r.minimumDuration,minimumIncrement:r.minimumIncrement,status:r.status,serviceId:r.serviceId,isChild:!0}:{id:e.id,serviceLine:e.service.name,schedule:e.name,rate:e.normal,rateOOH:e.ooh,ratePremium:e.premium,locations:"-",coverageArea:e.postcodeAreas.map(function(e){return e.postcode.area}).join(", "),minimumDuration:e.minimumDuration,minimumIncrement:e.minimumIncrement,status:e.status,serviceId:e.serviceId}})},[A]);return(0,r.jsxs)(r.Fragment,{children:[m,(0,r.jsx)(er.X,{open:g,close:function(){return x(!1)},initialFilters:n,setFilters:h}),(0,r.jsx)(X.Z,{width:"100%",spacing:2,children:(0,r.jsxs)(Q.Z,{sx:{paddingTop:"16px",paddingBottom:"16px",height:l},children:[(0,r.jsxs)(X.Z,{direction:"row",justifyContent:"space-between",pl:2,pr:2,children:[(0,r.jsx)(J.Z,{variant:"h5",sx:{fontWeight:600},children:"Services"}),(0,r.jsx)(V.Z,{startIcon:(0,r.jsx)(ei.Z,{}),variant:"contained",onClick:function(){return x(!0)},children:"Filters"})]}),(0,r.jsx)(G.i,{autoHeight:!1,loading:I,ref:Z,columns:L,rows:E,meta:w,refetch:k,containerHeight:c,columnVisibilityModel:{locations:"Customer"===o,actions:t},onRowClick:function(e){return q(e.row)}})]})})]})};eo.propTypes={editable:p().bool,initialFilters:p().object,parentEntity:p().oneOf(["System-Customer"]).isRequired,entity:p().oneOf(["Customer","Location"]).isRequired,entityId:p().string,tableHeight:p().string,paperHeight:p().string},eo.defaultProps={editable:!1,tableHeight:"calc(100% - 42px)",paperHeight:"calc(100% - 32px)"};var ea=n(68550),es=function(){var e,t=(0,H.x)(),n=t.hasRole,i=t.user,o=(0,W.q)(),a=o.hasUserModule,l=o.admin,f=(0,c.useRouter)().query,p=(0,s.useMemo)(function(){return f.tab||"details"},[f.tab]),h=(null==l?void 0:null===(e=l.modules)||void 0===e?void 0:e.sageIntegration)||!1,b="customer"===i.accountType?i.accountId:f.id,g=n("admin"),x=n("customer_user"),y=a("finances"),Z=a("quotes"),j=(0,d.a)(u.UB,{fetchPolicy:"no-cache",variables:{id:b}}),C=j.loading,S=j.data,T=(void 0===S?{customer:{}}:S).customer,A=j.error,w=j.refetch;if(A)return"Error! ".concat(A);var I={accountId:T.id,q:null,filterType:"customer_locations_tab"},k=[(0,r.jsx)("div",{active:"details"===p||!p,label:"Details",children:(0,r.jsx)(N,{customer:T,hasRole:n,refetch:w})}),(0,r.jsx)("div",{hide:x&&!y,active:"finance"===p,label:"Finance",children:(0,r.jsx)(F.b,{type:"customer",accountId:T.id,accountName:T.name,accountRefetch:w,meta:T.meta,hasSageIntegration:h})}),(0,r.jsx)("div",{active:"users"===p,label:"Users",children:(0,r.jsx)(O.q,{accountType:"customer",filters:{accountId:T.id}})}),(0,r.jsx)("div",{active:"locations"===p,label:"Locations",children:(0,r.jsx)(ea.V,{accountId:T.id,accountName:T.name,columnVisibilityModel:{customer:!1,totalSpent:!x||y},initialFilters:I,tableContainerHeight:"calc(80vh - 22px)"})}),(0,r.jsx)("div",{active:"work-orders"===p,label:"Work Orders",children:(0,r.jsx)(M.A,{filtersVisibilityModel:{customer:!1,user:n("customer"),location:n(["admin","customer"]),accountManager:!1,manager:!1,customerManager:!1},entityRelationToFetch:{customerId:T.id},initialFilters:{startDate:null,endDate:null,status:null,customerId:T.id,locationId:null,supplierId:null,noAssignToMeFilter:!0,id:null,filterType:"locations_work_orders_tab"},columnVisibilityModel:{customerNet:Boolean(!x||y),amountOutstanding:Boolean(!x||y)}})}),(0,r.jsx)("div",{active:"slas"===p,label:"SLAs",children:(0,r.jsxs)(m.Z,{handleChange:!1,children:[(0,r.jsx)("div",{active:!0,label:"Work Order SLAs",children:(0,r.jsx)(D.H,{title:"Work Order SLAs",subtype:"reactive",isEntity:!0,entity:"Account",entityId:T.id})}),(0,r.jsx)("div",{label:"Quote SLAs",children:(0,r.jsx)(D.H,{title:"Quote SLAs",subtype:"quote",isEntity:!0,entity:"Account",entityId:T.id})})]})}),(0,r.jsx)("div",{hide:x&&!y,active:"services"===p,label:"Services",children:(0,r.jsx)(eo,{editable:g,initialFilters:{filterType:"customer"},parentEntity:"System-Customer",entity:"Customer",entityId:T.id,paperHeight:"calc(100vh - 90px)"})}),(0,r.jsx)("div",{hide:x&&!Z,active:"quotes"===p,label:"Quotes",children:(0,r.jsx)(v.J,{FiltersComp:P.r,initialFilters:{customerId:T.id,supplierId:null,status:null,id:null,filterType:"customer_quote_tab"},TableComp:R.v})})];return!C&&(0,r.jsx)(m.Z,{children:k.filter(function(e){return!e.props.hide})},p)},ec=function(){return(0,r.jsx)(o.Z,{children:(0,r.jsx)(a.Z,{md:12,children:(0,r.jsx)(es,{})})})},el=function(){return(0,r.jsx)(ec,{})};el.getLayout=function(e){return(0,r.jsx)(i.Z,{children:e})};var ed=el},40872:function(e,t,n){"use strict";function r(){return(r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}function i(){return r.apply(this,arguments)}n.d(t,{Z:function(){return i}})}},function(e){e.O(0,[3662,367,2283,212,8890,9511,2583,6310,4599,4135,8579,4244,7645,3776,1564,2329,778,3054,1023,3911,1417,9957,6540,3425,1870,5037,8062,1352,4043,2429,1207,5117,9313,4211,2461,6043,4716,8359,6557,6937,3762,4664,3057,1650,825,9223,1913,3351,8565,9774,2888,179],function(){return e(e.s=59090)}),_N_E=e.O()}]);