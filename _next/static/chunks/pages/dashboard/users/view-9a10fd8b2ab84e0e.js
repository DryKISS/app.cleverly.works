(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5524,7493],{76570:function(e,n,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/users/view",function(){return t(48269)}])},74280:function(e,n,t){"use strict";t.d(n,{Q:function(){return r}});var r=function(e){var n,t,r=e&&e.length>0&&e.find(function(e){var n;return(null===(n=e.medium)||void 0===n?void 0:n.category)==="avatar"});if(!r)return null;var i="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(r.medium.filename),o=null==r?void 0:null===(n=r.medium)||void 0===n?void 0:null===(t=n.meta)||void 0===t?void 0:t.thumbnails;if(null==o?void 0:o.length){var a=o.find(function(e){return"small"===e.name});(null==a?void 0:a.relativePath)&&(i="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(a.relativePath))}return i}},97637:function(e,n,t){"use strict";t.d(n,{G:function(){return U}});var r=t(26042),i=t(69396),o=t(7297),a=t(85893),s=t(67294),c=t(45697),u=t(6812),d=t(92711),l=t(10367),m=t(78289),f=t(41564),p=t(34953),h=t(62466),y=t(68956),v=t(73373),g=t(11585),x=t(18678),_=t(55377),Z=t(16551),b=t(77439),I=t(74297),q=t(11013),$=t(3770),j=t(452),w=t(71072),S=t(87336),C=t(12632),A=t(74944);function k(){var e=(0,o.Z)(["\n  width: 24px;\n"]);return k=function(){return e},e}function P(){var e=(0,o.Z)(["\n  border: 1px solid #eee;\n"]);return P=function(){return e},e}var U=function(e){var n=e.carousel,t=e.category,o=e.children,c=e.data,l=(e.details,e.entity),k=e.entityId,P=e.filters,U=(e.limit,e.listView),D=e.mediaMeta,M=e.onMediaAdd,F=e.onMediaRemove,R=(e.pagination,e.showActionButtons),G=e.showEntityColumn,N=e.showItemActions,H=e.summary,z=e.type,O=(0,C.x)({filters:P}),E=O.initialData,B=O.ref,V=(0,A.x)(),W=V.hasRole,Q=V.user,J=(0,s.useContext)(m.Z),X=(0,u.a)(d.t,{variables:(0,i.Z)((0,r.Z)({},E),{entity:l,entityId:k,category:t,adminId:Q.adminId,meta:D})}),Y=X.data,K=void 0===Y?{items:[],meta:{aggregate:{totalCount:0}}}:Y,ee=K.items,en=K.meta,et=X.loading,er=X.refetch,ei=function(e){J.close(),c.length||er(),M&&M(e)},eo=function(e){J.close(),c.length||er(),F&&F(e)},ea=function(e){e.stopPropagation(),J.show({content:(0,a.jsx)(j.z,{accept:"image/*",adminId:Q.adminId,category:t,entity:l,entityId:k,expiryShow:!1,mediaMeta:D,multiple:!0,onSuccess:ei,type:"image"}),title:"Upload Photos"})},es=function(e){e.stopPropagation(),J.show({content:(0,a.jsx)(j.z,{accept:".pdf, .doc, .docx, .xlsx",adminId:Q.adminId,category:t,entity:l,entityId:k,expiryShow:!1,mediaMeta:D,onSuccess:ei,type:"document"}),title:"Upload Documents"})},ec=function(e){J.show({content:(0,a.jsx)(q.d,{mediaId:e.data.id,onSuccess:eo}),submit:!1,title:"Delete Media"})},eu=function(e){J.show({content:(0,a.jsx)($.z,{media:e.data,toggleShow:J.close}),submit:!1,title:"Media Details",width:"50%"})},ed=[{context:"primary",icon:["fas","info-circle"],onClick:function(e,n){return eu(n)},tooltip:"Details"}];W("admin")&&ed.push({context:"danger",icon:["fas","trash"],onClick:function(e,n){return ec(n)},tooltip:"Delete"});var el=[{hidden:!0},{hidden:!0},{hidden:!0,text:"Caption"},{hidden:!1,text:"File"},{hidden:!G,text:"Entity"},{formatter:function(e){var n,t=e.row;return(0,a.jsx)(T,{children:(null==t?void 0:null===(n=t.authority)||void 0===n?void 0:n.adminOnly)&&(0,a.jsx)(f.Z,{content:"Admin user only",children:(0,a.jsx)(p.Z,{alt:"Admin Only",src:"/messaging/admin-only.svg"})})})},text:"",tooltip:"Only Admin can see"},{formatter:(0,h.Z)("/dashboard/users/view","userId","uploaded"),text:"Uploaded by"},{hidden:!U,text:"Thumbnails"},{hidden:!N,formatter:y.Z,formatterData:ed,text:"Actions"}],em=function(e,n){e.preventDefault(),window.open("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n))},ef=[],ep=ee.map(function(e){var n=e.entity,t=e.entityId,r=e.id,i=e.item,o=i.caption,s=i.filename,c=i.meta,u=i.name,d=i.type,l=i.user;return{data:i,id:r,userId:null==l?void 0:l.id,file:function(){return(0,a.jsx)(v.Z,{onClick:function(e){return em(e,s)},children:o||u||s})},entity:n&&"".concat(n,"#").concat(t),authority:c,uploaded:"".concat(null==l?void 0:l.nameFirst," ").concat(null==l?void 0:l.nameLast),thumbnails:(0,w.S)(d,c),actions:""}}),eh=(ee.forEach(function(e){var n=e.item,t=n.caption,r=n.filename;"image"===n.type&&ef.push({caption:t,filename:r})}),ef),ey=eh.length;return(0,a.jsxs)(g.Z,{fitParentHeight:!0,open:!0,title:H,children:[o,n&&ey>0&&(0,a.jsx)(L,{children:(0,a.jsx)(x.Z,{fullWidth:!0,height:"200px",numberOfItems:1,showNavs:!1,showPagination:!0,slides:eh.map(function(e){var n=e.caption,t=e.filename;return{node:(0,a.jsx)(p.Z,{alt:n,src:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(t)}),text:" "}})})}),(0,a.jsx)(S.t,{columns:el,loading:et,fullHeight:!0,paginationSize:!1,meta:en,ref:B,refetch:er,rows:ep}),R&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(_.Z,{size:"sm"}),(0,a.jsxs)(Z.Z,{align:"flex-end",children:[(!z||"document"===z)&&!W("supplier")&&(0,a.jsx)(b.Z,{content:"Add Document",context:"secondary",onClick:es,size:"sm"}),(!z||"image"===z||"avatar"===z)&&!W("supplier")&&(0,a.jsx)(b.Z,{content:"Add ".concat((0,I.Z)(z||"Image")),context:"secondary",onClick:ea,size:"sm"})]})]})]})},T=l.ZP.div.withConfig({displayName:"table__StyledIcon",componentId:"sc-fc77535-0"})(k()),L=l.ZP.div.withConfig({displayName:"table__StyledCarousel",componentId:"sc-fc77535-1"})(P());U.propTypes={carousel:c.bool,category:c.string,children:c.node,data:c.array,details:c.bool,entity:c.string,entityId:c.number,filters:c.object,limit:c.number,listView:c.bool,mediaMeta:c.object,onMediaAdd:c.func,onMediaRemove:c.func,pagination:c.object,showActionButtons:c.bool,showEntityColumn:c.bool,showItemActions:c.bool,summary:c.string,type:c.string},U.defaultProps={carousel:!0,category:null,data:[],details:!1,filters:{},limit:20,listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,summary:"Media",type:null}},81777:function(e,n,t){"use strict";t.d(n,{g:function(){return O}});var r=t(7297),i=t(85893),o=t(67294),a=t(45697),s=t(10367),c=t(78289),u=t(74147),d=t(9270),l=t(62140),m=t(65414),f=t(55843),p=t(45481),h=t(97303),y=t(33006),v=t(40826),g=t(55171),x=t.n(g),_=t(6812),Z=t(75063);function b(){var e=(0,r.Z)(["\n  query GetLog($entityId: bigint!, $entityName: String!) {\n    activity: audit_Activity(\n      where: { _and: [{ entityid: { _eq: $entityId } }, { entity: { _eq: $entityName } }] }\n    ) {\n      eventId\n      userId\n      user: User {\n        fullName\n      }\n      sessionUserName\n      transactionStart\n      statementStart\n      applicationName\n      clientAddr\n      clientPort\n      action\n      changedFields\n    }\n  }\n"]);return b=function(){return e},e}var I=(0,Z.Ps)(b()),q=t(11585),$=t(26186),j=t(86036),w=t(49501),S={U:"Update",I:"Insert",D:"Delete"},C=function(e){var n=e.entityId,t=e.entityName,r=(0,_.a)(I,{variables:{entityId:n,entityName:t}}),o=r.loading,a=r.data,s=(void 0===a?{activity:[]}:a).activity;return!o&&(0,i.jsx)(d.Z,{children:(0,i.jsx)(l.Z,{md:12,children:s.map(function(e){var n,t;return(0,i.jsxs)(q.Z,{title:"".concat((null===(n=e.user)||void 0===n?void 0:n.fullName)||"Backend"," - ").concat((0,$.Z)(e.transactionStart,!0)),children:[(0,i.jsx)(j.Z,{content:"Action:",text:S[t=e.action]||"-"}),(0,i.jsx)(f.Z,{}),(0,i.jsx)(w.Z,{label:"Changed:",children:(0,i.jsx)(x(),{collapsed:!0,displayDataTypes:!1,src:e.changedFields||"-"})}),(0,i.jsx)(j.Z,{content:"Application:",text:e.applicationName||"-"})]},e.userId)})})})};C.propTypes={entityId:a.number.isRequired,entityName:a.string.isRequired};var A=t(97637),k=t(58632),P=t(48795),U=t(84570),T=t(74944),L=function(e){var n,t,r,o,a=e.job,s=e.numberPrefix,c=e.numberSuffix,u=(0,T.x)().hasRole;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(j.Z,{content:"Type",text:(null===(n=k.x.find(function(e){return e.value===a.type}))||void 0===n?void 0:n.text)||"-"}),(0,i.jsx)(j.Z,{content:"Order",text:(0,i.jsx)(P.D,{id:a.id,number:a.number,invoiceNumber:null==a?void 0:null===(t=a.invoices)||void 0===t?void 0:null===(r=t[0])||void 0===r?void 0:r.invoiceNumber,type:a.type,numberPrefix:s,numberSuffix:c,isQuote:a.quoted})}),u("admin")&&a.source&&(0,i.jsx)(j.Z,{content:"Source",text:null===(o=U.Y.find(function(e){return e.value===a.source}))||void 0===o?void 0:o.text})]})};function D(){var e=(0,r.Z)(["\n  background-color: #fff;\n  border: 1px solid #eee;\n  box-shadow: rgba(45, 62, 80, 0.12) 0 1px 5px 0;\n  margin-bottom: 0.5rem;\n  padding: 1rem 0;\n"]);return D=function(){return e},e}function M(){var e=(0,r.Z)(["\n  font-size: 1rem;\n  margin-top: 0.5rem;\n"]);return M=function(){return e},e}function F(){var e=(0,r.Z)(["\n  font-size: 0.9rem;\n  margin-top: 0.5rem;\n"]);return F=function(){return e},e}function R(){var e=(0,r.Z)(["\n  margin-bottom: 1rem;\n"]);return R=function(){return e},e}function G(){var e=(0,r.Z)(["\n  margin-right: 0.5rem;\n"]);return G=function(){return e},e}function N(){var e=(0,r.Z)(["\n  display: inline;\n"]);return N=function(){return e},e}function H(){var e=(0,r.Z)(["\n  display: flex;\n  justify-content: center;\n"]);return H=function(){return e},e}function z(){var e=(0,r.Z)(["\n  cursor: pointer;\n"]);return z=function(){return e},e}L.propTypes={job:a.object,numberPrefix:a.string,numberSuffix:a.string},L.defaultProps={numberPrefix:"",numberSuffix:""};var O=function(e){var n=e.avatar,t=e.editable,r=e.entity,a=e.entityName,s=e.icons,y=e.job,v=e.linkTitleTo,g=e.log,x=e.numberPrefix,_=e.numberSuffix,Z=e.prefix,b=(0,o.useContext)(c.Z),I=(0,o.useState)(n),q=I[0],$=I[1],j=function(e){b.close(),(null==e?void 0:e.filename)?$("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(null==e?void 0:e.filename)):$(null)},w=function(){b.show({content:(0,i.jsx)(A.G,{category:"avatar",entity:a,entityId:null==r?void 0:r.id,filters:{category:"avatar"},limit:1,onMediaAdd:j,onMediaRemove:j,type:"image"}),title:"Avatar"})},S=function(){return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(Q,{context:"primary",icon:"building"}),v?(0,i.jsx)(J,{border:!1,passHref:!0,to:v,children:null==r?void 0:r.name}):null==r?void 0:r.name]})},k=function(){b.show({content:(0,i.jsx)(C,{entityId:Number(null==g?void 0:g.entityId),entityName:null==g?void 0:g.entityName}),submit:!1,title:"Log Details",width:"50%"})};return(0,i.jsxs)(E,{children:[(0,i.jsx)(u.Z,{children:(0,i.jsxs)(d.Z,{children:[(0,i.jsx)(l.Z,{md:3,children:(0,i.jsx)(m.Z,{action:t?"Edit":null,actionClick:w,content:(null==r?void 0:r.name)||"test",context:"primary",gmail:null==r?void 0:r.email,src:q})}),(0,i.jsxs)(l.Z,{md:9,children:[(0,i.jsx)(B,{content:(0,i.jsx)(S,{}),noMargin:!0}),(null==r?void 0:r.description)&&(0,i.jsx)(V,{content:null==r?void 0:r.description,noMargin:!0}),(null==r?void 0:r.website)&&(0,i.jsxs)(W,{href:null==r?void 0:r.website,rel:"nofollow noopener noreferrer",target:"_blank",children:[(0,i.jsx)(Q,{context:"primary",icon:"window-maximize"}),"Visit website"]})]}),y&&(0,i.jsx)(l.Z,{md:12,children:(0,i.jsx)(L,{job:y,numberPrefix:x,numberSuffix:_})})]})}),(0,i.jsx)(f.Z,{marginTop:"sm"}),s&&(0,i.jsxs)(X,{children:[s.map(function(e){var n=e.icon,t=e.onClick,r=e.to;return(0,i.jsxs)("div",{children:[t&&(0,i.jsx)(Y,{onClick:t,children:(0,i.jsx)(p.Z,{icon:n,prefix:Z})}),r&&(0,i.jsx)(h.Z,{border:!1,passHref:!0,to:r,children:(0,i.jsx)(p.Z,{icon:n,prefix:Z})})]},n)}),g&&(0,i.jsx)(Y,{onClick:k,children:(0,i.jsx)(p.Z,{icon:"history",size:"lg"})})]})]})},E=s.ZP.div.withConfig({displayName:"profileHeader__StyledHeader",componentId:"sc-bf764e90-0"})(D()),B=(0,s.ZP)(y.Z).withConfig({displayName:"profileHeader__StyledHeading",componentId:"sc-bf764e90-1"})(M()),V=(0,s.ZP)(y.Z).withConfig({displayName:"profileHeader__StyledDescription",componentId:"sc-bf764e90-2"})(F()),W=s.ZP.a.withConfig({displayName:"profileHeader__StyledLink",componentId:"sc-bf764e90-3"})(R()),Q=(0,s.ZP)(v.Z).withConfig({displayName:"profileHeader__StyledIcon",componentId:"sc-bf764e90-4"})(G()),J=(0,s.ZP)(h.Z).withConfig({displayName:"profileHeader__StyledTitle",componentId:"sc-bf764e90-5"})(N()),X=s.ZP.div.withConfig({displayName:"profileHeader__StyledIconContainer",componentId:"sc-bf764e90-6"})(H()),Y=s.ZP.div.withConfig({displayName:"profileHeader__Click",componentId:"sc-bf764e90-7"})(z());O.propTypes={avatar:a.string,editable:a.bool,entity:a.object.isRequired,entityName:a.string.isRequired,icons:a.array,job:a.object,linkTitleTo:a.string,log:a.object,prefix:a.string,numberPrefix:a.string,numberSuffix:a.string},O.defaultProps={avatar:"",editable:!0,numberPrefix:"",numberSuffix:""}},57493:function(e,n,t){"use strict";t.d(n,{A5:function(){return es},Ak:function(){return H},Cj:function(){return X},K4:function(){return er},Oq:function(){return ea},Qn:function(){return G},RJ:function(){return J},SW:function(){return R},T_:function(){return V},UH:function(){return F},UM:function(){return en},Ve:function(){return Y},_d:function(){return O},_f:function(){return et},by:function(){return W},cz:function(){return L},he:function(){return N},j$:function(){return z},kB:function(){return K},kx:function(){return E},nD:function(){return M},nP:function(){return eo},pY:function(){return ei},qd:function(){return D},t1:function(){return B},yR:function(){return Q},zR:function(){return ee}});var r=t(7297),i=t(75063);function o(){var e=(0,r.Z)(["\n  query GetAddressForSelect($q: String, $entity: String!, $entityId: Int!) {\n    items: Address(\n      where: {\n        Address_Entities: { entity: { _eq: $entity }, entityId: { _eq: $entityId } }\n        _or: [\n          { addressLine1: { _eq: $q } }\n          { addressLine2: { _eq: $q } }\n          { addressLine3: { _eq: $q } }\n          { county: { _eq: $q } }\n          { postCode: { _eq: $q } }\n          { city: { _eq: $q } }\n        ]\n      }\n    ) {\n      label: addressLine1\n      value: id\n      id\n      name\n      addressLine1\n      addressLine2\n      addressLine3\n      postCode\n      county\n      country: Country {\n        name\n      }\n      city\n      Address_Entities {\n        invoice\n      }\n    }\n  }\n"]);return o=function(){return e},e}function a(){var e=(0,r.Z)(["\n  query GetAccountsForSelect($q: String, $type: String, $limit: Int, $offset: Int) {\n    items: Account(\n      where: { name: { _ilike: $q }, type: { _eq: $type } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]);return a=function(){return e},e}function s(){var e=(0,r.Z)(['\n  query GetTaxonomy($q: String, $id: Int) {\n    items: Taxonomy(\n      where: { type: { _eq: "assetCategory" }, status: { _eq: "active" } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      options: Taxonomies(\n        where: {\n          type: { _eq: "assetCategory" }\n          name: { _ilike: $q }\n          id: { _eq: $id }\n          status: { _eq: "active" }\n        }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']);return s=function(){return e},e}function c(){var e=(0,r.Z)(["\n  query GetAssetsForSelect(\n    $locationId: Int\n    $q: String\n    $categoryId: Int\n    $bookable: String\n    $limit: Int\n    $offset: Int\n  ) {\n    items: Asset(\n      where: {\n        categoryId: { _eq: $categoryId }\n        locationId: { _eq: $locationId }\n        name: { _ilike: $q }\n        bookable: { _eq: $bookable }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n      sublocation: Sublocation {\n        name\n      }\n    }\n  }\n"]);return c=function(){return e},e}function u(){var e=(0,r.Z)(['\n  query GetCustomersForSelect($q: String, $limit: Int, $offset: Int) {\n    items: Account(\n      where: { name: { _ilike: $q }, type: { _eq: "customer" } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      admin: Admins {\n        id: adminId\n      }\n      label: name\n      spendThreshold: meta(path: "$.finance.spendThreshold")\n      serviceRateLabour: meta(path: "$.finance.serviceRateLabour")\n      serviceRateExpenses: meta(path: "$.finance.serviceRateExpenses")\n      value: id\n    }\n  }\n']);return u=function(){return e},e}function d(){var e=(0,r.Z)(["\n  query GetJobsForSelect($_q: Int, $locationId: Int) {\n    items: Job(\n      where: {\n        Location: { id: { _eq: $locationId } }\n        _or: [{ id: { _eq: $_q } }, { Invoices: { id: { _eq: $_q } } }]\n      }\n      order_by: { title: asc }\n    ) {\n      label: label\n      value: id\n      number\n      createdAt\n      description\n      status\n      timingStart\n      title\n      type\n      Location {\n        name\n      }\n      Taxonomy {\n        Taxonomy {\n          shortJobDescription: name\n        }\n      }\n    }\n  }\n"]);return d=function(){return e},e}function l(){var e=(0,r.Z)(['\n  query GetManagersForSelect($userId: Int, $accountId: Int!, $q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          role: { _in: ["owner", "manager"] }\n          status: { _eq: "active" }\n          Account: { id: { _eq: $accountId } }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        id: { _neq: $userId }\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']);return l=function(){return e},e}function m(){var e=(0,r.Z)(['\n  query GetManagersForSelect(\n    $userId: Int\n    $accountId: Int!\n    $q: String\n    $invoiceThreshold: numeric\n    $quoteThreshold: numeric\n  ) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          role: { _in: ["owner", "manager"] }\n          status: { _eq: "active" }\n          Account: { id: { _eq: $accountId } }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        id: { _neq: $userId }\n        _and: [\n          {\n            _or: [\n              { invoiceThreshold: { _gt: $invoiceThreshold } }\n              { invoiceThreshold: { _is_null: true } }\n            ]\n          }\n          {\n            _or: [\n              { quoteThreshold: { _gt: $quoteThreshold } }\n              { quoteThreshold: { _is_null: true } }\n            ]\n          }\n        ]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']);return m=function(){return e},e}function f(){var e=(0,r.Z)(["\n  query GetPostCodeAreaForSelect($countryId: Int, $q: String) {\n    items: PostcodeArea(\n      where: { name: { _ilike: $q }, countryId: { _eq: $countryId } }\n      order_by: { name: asc }\n    ) {\n      area\n      label: name\n      value: id\n    }\n  }\n"]);return f=function(){return e},e}function p(){var e=(0,r.Z)(['\n  query GetPropertiesForSelect($where: Location_bool_exp, $limit: Int, $offset: Int) {\n    items: Location(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      label: name\n      value: id\n      access\n      permitsRequired\n      registeredAddress: Addresses(\n        where: { entity: { _eq: "Location" }, registered: { _eq: true } }\n      ) {\n        address: Address {\n          id\n          addressLine1\n          addressLine2\n          addressLine3\n          county\n          country: Country {\n            name\n          }\n          postCode\n          city\n        }\n      }\n    }\n  }\n']);return p=function(){return e},e}function h(){var e=(0,r.Z)(['\n  query GetServicesForSelect($q: String, $limit: Int, $offset: Int) {\n    items: Service(\n      where: { name: { _ilike: $q }, status: { _eq: "active" } }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']);return h=function(){return e},e}function y(){var e=(0,r.Z)(["\n  query GetSlasForSelect($q: String, $adminId: Int, $type: String, $subtype: sla_subtype) {\n    items: SLA(\n      where: {\n        name: { _ilike: $q }\n        type: { _eq: $type }\n        adminId: { _eq: $adminId }\n        subtype: { _eq: $subtype }\n      }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]);return y=function(){return e},e}function v(){var e=(0,r.Z)(["\n  query GetSlasForSelectNew($where: SLA_bool_exp, $limit: Int, $offset: Int) {\n    items: SLA(where: $where, order_by: { name: asc }, limit: $limit, offset: $offset) {\n      label: name\n      value: id\n    }\n  }\n"]);return v=function(){return e},e}function g(){var e=(0,r.Z)(["\n  query GetSuppliersForSelect($where: Account_bool_exp, $limit: Int, $offset: Int) {\n    items: Account(where: $where, limit: $limit, offset: $offset, order_by: { name: asc }) {\n      label: name\n      value: id\n    }\n  }\n"]);return g=function(){return e},e}function x(){var e=(0,r.Z)(['\n  query GetUsersForSelect($accountId: Int, $q: String, $limit: Int, $offset: Int) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: {\n          accountId: { _eq: $accountId }\n          isContact: { _eq: true }\n          status: { _eq: "active" }\n        }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']);return x=function(){return e},e}function _(){var e=(0,r.Z)(['\n  query GetUsersForSelect($q: String) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n      email\n      phone\n    }\n  }\n']);return _=function(){return e},e}function Z(){var e=(0,r.Z)(["\n  query GetTaxonomyGroupForSelect($q: String, $type: String!) {\n    items: Taxonomy(\n      where: { isGroup: { _eq: true }, name: { _ilike: $q }, type: { _eq: $type } }\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]);return Z=function(){return e},e}function b(){var e=(0,r.Z)(['\n  query GetTaxonomy($q: String) {\n    items: Taxonomy(where: { type: { _eq: "expenseCategoryGroup" } }, order_by: { name: asc }) {\n      label: name\n      options: Taxonomies(\n        where: { type: { _eq: "expenseCategory" }, name: { _ilike: $q } }\n        order_by: { name: asc }\n      ) {\n        value: id\n        label: name\n      }\n    }\n  }\n']);return b=function(){return e},e}function I(){var e=(0,r.Z)(["\n  query GetUserRole($userId: Int!, $accountId: Int!) {\n    accountUsers: Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n    ) {\n      role\n    }\n  }\n"]);return I=function(){return e},e}function q(){var e=(0,r.Z)(["\n  query GetSublocationsForSelect($locationId: Int!, $q: String, $limit: Int, $offset: Int) {\n    items: Sublocation(\n      where: { name: { _ilike: $q }, locationId: { _eq: $locationId }, active: { _eq: true } }\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n"]);return q=function(){return e},e}function $(){var e=(0,r.Z)(['\n  query GetTaxonomy($q: String, $limit: Int, $offset: Int) {\n    items: Taxonomy(\n      where: {\n        type: { _eq: "assetCategory" }\n        isGroup: { _eq: false }\n        status: { _eq: "active" }\n        name: { _ilike: $q }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']);return $=function(){return e},e}function j(){var e=(0,r.Z)(["\n  query GetTaxonomyForSelect(\n    $where: Taxonomy_bool_exp\n    $limit: Int\n    $offset: Int\n    $orderBy: Taxonomy_order_by!\n    $includeMeta: Boolean! = false\n  ) {\n    items: Taxonomy(where: $where, limit: $limit, offset: $offset, order_by: [$orderBy]) {\n      value: id\n      label: name\n      meta @include(if: $includeMeta)\n    }\n  }\n"]);return j=function(){return e},e}function w(){var e=(0,r.Z)(['\n  query GetTagsForTask($q: String!, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: { name: { _ilike: $q }, status: { _eq: "active" }, type: { _eq: "taskTags" } }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n']);return w=function(){return e},e}function S(){var e=(0,r.Z)(['\n  query GetTagsForEntity(\n    $entityId: Int\n    $entity: String!\n    $q: String!\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    tags: Taxonomy(\n      where: {\n        name: { _ilike: $q }\n        status: { _eq: "active" }\n        type: { _eq: "taskTags" }\n        _not: { Taxonomy_Entities: { entity: { _eq: $entity }, entityId: { _eq: $entityId } } }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { id: desc }\n    ) {\n      id\n      name\n      meta\n    }\n  }\n']);return S=function(){return e},e}function C(){var e=(0,r.Z)(['\n  query GetEntityTags($entityId: Int!, $entity: String!) {\n    tags: Taxonomy_Entity(\n      where: {\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n        Taxonomy: { status: { _eq: "active" }, type: { _eq: "taskTags" } }\n      }\n      order_by: { id: desc }\n    ) {\n      id\n      tag: Taxonomy {\n        id\n        name\n        meta\n      }\n    }\n  }\n']);return C=function(){return e},e}function A(){var e=(0,r.Z)(["\n  query GetCustomerManagers($accountId: Int, $q: String, $limit: Int, $offset: Int) {\n    items: User(\n      where: { Account_Users: { accountId: { _eq: $accountId } }, fullName: { _ilike: $q } }\n      order_by: { fullName: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n"]);return A=function(){return e},e}function k(){var e=(0,r.Z)(["\n  query GetServiceSchedulesForSelect(\n    $q: String\n    $serviceId: Int\n    $entity: service_schedule_entity\n    $entityId: Int\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    items: ServiceSchedule(\n      where: {\n        name: { _ilike: $q }\n        serviceId: { _eq: $serviceId }\n        entity: { _eq: $entity }\n        entityId: { _eq: $entityId }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]);return k=function(){return e},e}function P(){var e=(0,r.Z)(['\n  query GetPropertyById($id: Int!) {\n    item: Location_by_pk(id: $id) {\n      label: name\n      value: id\n      access\n      registeredAddress: Addresses(\n        where: { entity: { _eq: "Location" }, registered: { _eq: true } }\n      ) {\n        address: Address {\n          id\n          addressLine1\n          addressLine2\n          addressLine3\n          county\n          country: Country {\n            name\n            code\n          }\n          postCode\n          city\n        }\n      }\n    }\n  }\n']);return P=function(){return e},e}function U(){var e=(0,r.Z)(["\n  query GetCompliancesForSelectNew($q: String, $locationId: Int, $limit: Int, $offset: Int) {\n    items: Compliance(\n      where: { name: { _ilike: $q }, locationId: { _eq: $locationId } }\n      order_by: { name: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      value: id\n      label: name\n      category: ComplianceCategory {\n        label: name\n      }\n    }\n  }\n"]);return U=function(){return e},e}function T(){var e=(0,r.Z)(['\n  query GetTaskAssignedToForSelect(\n    $accountId: Int\n    $q: String\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    items: User(\n      where: {\n        status: { _eq: "active" }\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { nameFirst: asc }\n    ) {\n      label: fullName\n      value: id\n    }\n  }\n']);return T=function(){return e},e}var L=(0,i.Ps)(o()),D=(0,i.Ps)(a()),M=(0,i.Ps)(s()),F=(0,i.Ps)(c()),R=(0,i.Ps)(u()),G=(0,i.Ps)(d()),N=(0,i.Ps)(l()),H=(0,i.Ps)(m()),z=(0,i.Ps)(f()),O=(0,i.Ps)(p()),E=(0,i.Ps)(h()),B=(0,i.Ps)(y()),V=(0,i.Ps)(v()),W=(0,i.Ps)(g()),Q=(0,i.Ps)(x()),J=(0,i.Ps)(_()),X=(0,i.Ps)(Z()),Y=(0,i.Ps)(b()),K=(0,i.Ps)(I()),ee=(0,i.Ps)(q()),en=(0,i.Ps)($()),et=(0,i.Ps)(j());(0,i.Ps)(w()),(0,i.Ps)(S()),(0,i.Ps)(C());var er=(0,i.Ps)(A()),ei=(0,i.Ps)(k()),eo=(0,i.Ps)(P()),ea=(0,i.Ps)(U()),es=(0,i.Ps)(T())},536:function(e,n,t){"use strict";t.d(n,{P:function(){return $}});var r=t(47568),i=t(26042),o=t(69396),a=t(99534),s=t(7297),c=t(97582),u=t(85893),d=t(67294),l=t(45697),m=t(10367),f=t(66252),p=t(57493),h=t(78289),y=t(52019),v=t(49501),g=t(9270),x=t(62140),_=t(84043),Z=t(77439);function b(){var e=(0,s.Z)(["\n  position: relative;\n  right: 25px;\n  top: 2px;\n"]);return b=function(){return e},e}var I=function(e,n){var t,r,i,o=!0;return(null===(t=e.errors[e.name])||void 0===t?void 0:t.message)!==(null===(r=n.errors[n.name])||void 0===r?void 0:r.message)&&(o=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach(function(t){e[t]!==n[t]&&(o=!1)}),o},q=function(e){var n=e.accountId,t=e.area,r=e.assetCategoryId,i=e.entity,o=e.entityId,a=(e.hasRole,e.id),s=e.locationId,c=e.serviceId,u=e.taxonomyGroupType,d=e.customerId,l=e.customerRole,m=e.type,f=e.userId,h=e.invoiceThreshold,y=e.quoteThreshold,v=m;switch(l&&(v="".concat(m,"_").concat(l)),v){case"address":return{query:p.cz,variables:{entity:i,entityId:o}};case"asset":return{query:p.UH,variables:{categoryId:r,locationId:s}};case"assetBookable":return{query:p.UH,variables:{categoryId:r,locationId:s,bookable:"yes"}};case"assetCategory":return{query:p.nD,variables:{id:a}};case"assetSublocation":return{query:p.UH,variables:{category:"sublocation",adminId:n,locationId:s}};case"coverage":return{query:p.j$};case"customer":return{query:p.SW};case"job":return{query:p.Qn,variables:{locationId:s}};case"manager":return{query:p.he,variables:{accountId:n,userId:f}};case"thresholdManagers":return{query:p.Ak,variables:{accountId:n,userId:f,invoiceThreshold:h,quoteThreshold:y}};case"product":return{query:p.UH,variables:{category:"product",locationId:s}};case"property":return{query:p._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n}}}}};case"property_user":return{query:p._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:n},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:d}}},User_Account_Locations:{Account_User:{userId:{_eq:d},accountId:{_eq:n}}}}}}};case"sensor":return{query:p.UH,variables:{category:"sensor",locationId:s}};case"service":return{query:p.kx};case"sla":return{query:p.t1,variables:{type:"priority",adminId:n}};case"sublocation":return{query:p.zR,variables:{locationId:s}};case"supplier":var g={type:{_eq:"supplier"}};return t&&(g.PostcodeAreas={PostcodeArea:{area:{_eq:t}},entity:{_eq:"Account"},status:{_eq:"active"}}),c&&(g.ServiceSchedule={status:{_eq:"active"},entity:{_eq:"Supplier"},serviceId:{_eq:c}},t&&(g.ServiceSchedule.PostcodeAreas={PostcodeArea:{area:{_eq:t}}})),{query:p.by,variables:{where:g}};case"user":return{query:p.yR,variables:{accountId:n}};case"usersForBookings":return{query:p.yR,variables:{accountId:f}};case"tenant":return{query:p.RJ};case"taxonomyGroup":return{query:p.Cj,variables:{type:u}};case"expenseCategory":return{query:p.Ve};default:return{query:p.qd}}},$=(0,d.memo)(function(e){var n,t=e.AddForm,s=e.accountId,l=e.area,m=e.assetCategoryId,p=e.control,b=e.entity,I=e.entityId,$=e.errors,w=e.id,S=e.isClearable,C=e.isDisabled,A=e.label,k=e.locationId,P=e.name,U=e.serviceId,T=e.taxonomyGroupType,L=e.customerId,D=e.customerRole,M=e.type,F=e.userId,R=e.invoiceThreshold,G=e.quoteThreshold,N=(0,a.Z)(e,["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId","invoiceThreshold","quoteThreshold"]),H=(0,f.x)(),z=(0,d.useState)(!1),O=z[0],E=z[1],B=(0,d.useState)(),V=B[0],W=B[1],Q=(0,d.useState)(!1),J=Q[0],X=Q[1],Y=(0,d.useContext)(h.Z),K=(0,d.useContext)(y.Z).hasRole,ee=(0,d.useState)(!1),en=ee[0],et=ee[1];(0,d.useEffect)(function(){return et(!1),X(!1),function(){}},[s,m,b,I,k,U,M,L,D,F]);var er=(n=(0,r.Z)(function(){var e,n,t,r,a,u,d,f;return(0,c.__generator)(this,function(a){switch(a.label){case 0:if(J)return et(!0),[2,null];return E(!0),n=(e=q({accountId:s,area:l,assetCategoryId:m,entity:b,entityId:I,hasRole:K,id:w,locationId:k,serviceId:U,taxonomyGroupType:T,customerId:L,customerRole:D,type:M,userId:F,invoiceThreshold:R,quoteThreshold:G})).query,r=void 0===(t=e.variables)?{}:t,[4,H.query({query:n,variables:(0,i.Z)({},r)})];case 1:var c,d;return c=(void 0===(u=a.sent().data)?{items:[]}:u).items,f="asset"===(d=M)?c.map(function(e){return(0,o.Z)((0,i.Z)({},e),{label:"".concat(e.label," ").concat(e.sublocation?"- ".concat(e.sublocation.name):"")})}):c,W(f),E(!1),X(!0),et(!0),[2]}})}),function(){return n.apply(this,arguments)}),ei=function(){Y.show({content:(0,u.jsx)("div",{children:(0,u.jsx)(t,{})}),title:"Add form"})};return(0,u.jsx)(v.Z,{id:P,label:A,children:(0,u.jsxs)(g.Z,{children:[(0,u.jsx)(x.Z,{md:t?11:12,children:(0,u.jsx)(_.Z,(0,i.Z)({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:p,errors:$,isDisabled:C,isClearable:S,isLoading:O,menuIsOpen:en,options:V,onFocus:er,onBlur:function(){et(!1)},name:P,searchable:!0},N),N.defaultValue)}),t&&(0,u.jsx)(x.Z,{md:1,children:(0,u.jsx)(j,{children:(0,u.jsx)(Z.Z,{content:null,startIcon:"plus",size:"sm",onClick:ei})})})]})})},I),j=m.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-f7921e38-0"})(b());$.propTypes={AddForm:l.object,area:l.string,accountId:l.number,assetCategoryId:l.number,control:l.object.isRequired,errors:l.object.isRequired,entity:l.string,entityId:l.number,id:l.number,isClearable:l.bool,label:l.string.isRequired,locationId:l.number,name:l.string.isRequired,serviceId:l.number,taxonomyGroupType:(0,l.oneOf)(["expenseCategory","costCategory","jobTags"]),type:l.string},$.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},45451:function(e,n,t){"use strict";t.d(n,{i:function(){return $}});var r=t(14924),i=t(26042),o=t(69396),a=t(85893),s=t(67294),c=t(11163),u=t(45697),d=t.n(u),l=t(61870),m=t(5616),f=t(51233),p=t(15861),h=t(90948),y=t(41796),v=t(29217),g=t(45111),x=t(98209),_=t(70872),Z=t(58886),b=t(61730),I=function(e){var n=e.currentPage,t=e.totalCount,r=e.pageSize,o=e.onPageChange,s=(0,b.Z)("(max-width:400px)"),c=(0,b.Z)("(max-width:500px)");return(0,a.jsx)(q,{mb:2,page:n,count:Math.ceil(t/r),onChange:function(e,n){return o(n)},variant:"outlined",shape:"rounded",size:s?"small":"medium",hidePrevButton:1===n,hideNextButton:n===Math.ceil(t/r),siblingCount:c?0:1,renderItem:function(e){return(0,a.jsx)(Z.Z,(0,i.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})};I.defaultProps={currentPage:1,totalCount:0,pageSize:50,onPageChange:function(){}},I.propTypes={currentPage:d().number,totalCount:d().number,pageSize:d().number,onPageChange:d().func};var q=(0,h.ZP)(_.Z)(function(e){var n,t=e.hidePrevButton,o=e.hideNextButton,a=e.theme;return n={},(0,r.Z)(n,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,r.Z)(n,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,r.Z)(n,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,r.Z)(n,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,r.Z)(n,"& button.Mui-selected",(0,i.Z)({color:a.palette.white.main,backgroundColor:a.palette.secondary.main},o?{borderRadius:"0 5px 5px 0"}:{},t?{borderRadius:"5px 0 0 5px"}:{})),n}),$=(0,s.forwardRef)(function(e,n){var t=e.columns,r=e.history,o=e.initialSort,u=e.meta,d=e.refetch,l=e.paginationSize,m=e.containerHeight,h=e.containerMaxHeight,y=e.noResultsMessage,_=e.autoHeight,Z=(0,c.useRouter)(),b=Z.query,q=void 0===b?{}:b,$=(0,s.useState)(parseInt(null==q?void 0:q.page,10)||1),S=$[0],C=$[1],A=(0,s.useState)(l||x.C1.paginationSize),k=A[0],P=A[1],U=o;U||(U={item:"createdAt",order:"desc"});var T=(0,s.useState)({item:U.item,order:U.order}),L=T[0],D=T[1],M=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=Z.query,t=void 0===n?{}:n;if(e>1?t.page=e:delete t.page,!(Object.keys(t).length>0))return{};var r=Object.keys(t).map(function(n){return"page"===n?"".concat(n,"=").concat(e):"".concat(n,"=").concat(t[n])}).join("&");return"?".concat(r)},F=function(){D({item:U.item,order:U.order}),C(1);var e=M();Z.push(e),P(l||x.C1.paginationSize)};(0,s.useImperativeHandle)(n,function(){return{currentPage:S,pageSize:k,sort:L,resetPagination:function(){F()}}});var R=function(e){var n=M(e);r&&Z.push(n),C(e),!r&&d&&d()},G=function(e){e&&e.field&&e.sort?(D({item:t.find(function(n){return n.field===e.field}).sortName||e.field||e.item||U.item,order:e.sort||e.order||U.order}),d&&d()):(D({item:U.item,order:U.order}),d&&d())};return(0,a.jsxs)(j,{containerHeight:m,containerMaxHeight:h,children:[(0,a.jsx)(w,(0,i.Z)({hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0,autoHeight:_,sortingMode:"server",onSortModelChange:function(e){return G(e[0])},columns:t,pageSize:k,slots:{columnSortedAscendingIcon:function(){return(0,a.jsx)(v.Z,{})},columnSortedDescendingIcon:function(){return(0,a.jsx)(g.Z,{})},columnUnsortedIcon:function(){return(0,a.jsxs)(f.Z,{alignItems:"center",sx:{width:"33px"},children:[(0,a.jsx)(v.Z,{sx:{marginBottom:"-15px"}}),(0,a.jsx)(g.Z,{})]})},noResultsOverlay:function(){return(0,a.jsx)(f.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(p.Z,{children:y})})},noRowsOverlay:function(){return(0,a.jsx)(f.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(p.Z,{children:y})})}}},e)),u&&Math.ceil(u.aggregate.totalCount/k)>1&&(0,a.jsx)(I,{currentPage:S,totalCount:u.aggregate.totalCount,pageSize:k,onPageChange:R})]})});$.propTypes={history:d().bool,initialSort:d().object,loading:d().bool,meta:d().object,refetch:d().func,paginationSize:d().number,noResultsMessage:d().string,columns:d().array.isRequired,rows:d().array.isRequired,autoHeight:d().bool},$.defaultProps={columns:[],history:!1,loading:!1,rows:[],noResultsMessage:"There are no results.",autoHeight:!0};var j=(0,h.ZP)(m.Z)(function(e){var n;return{height:e.containerHeight,maxHeight:e.containerMaxHeight,display:"flex",flexDirection:"column"}}),w=(0,h.ZP)(l.s)(function(e){var n,t=e.theme,a=e.hideHeader,s=(e.rows,e.loading,e.rowHeight),c=e.isPdf;return n={"--DataGrid-overlayHeight":"40px"},(0,r.Z)(n,"&.MuiDataGrid-root",(0,i.Z)({color:t.palette.black.main,border:"none"},c&&{"@media print":{display:"block"}})),(0,r.Z)(n,"& .MuiDataGrid-main",(0,i.Z)({},c&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(n,"& .MuiDataGrid-columnHeaders",(0,o.Z)((0,i.Z)({},a&&{display:"none"}),{"& .MuiDataGrid-iconButtonContainer":{visibility:"visible","& .MuiButtonBase-root.MuiIconButton-root":{backgroundColor:"inherit",color:t.palette.black.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}}})),(0,r.Z)(n,"& .MuiDataGrid-virtualScroller",(0,i.Z)({},a&&{marginTop:"0 !important"},c&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(n,"& .MuiDataGrid-iconSeparator",{opacity:0}),(0,r.Z)(n,"& .MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(n,"& .MuiButtonBase-root.MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(n,"& .MuiDataGrid-virtualScrollerContent",(0,i.Z)({},c&&{height:"initial !important",minHeight:"initial !important"})),(0,r.Z)(n,"& .MuiDataGrid-virtualScrollerRenderZone",(0,i.Z)({},c&&{position:"relative"})),(0,r.Z)(n,"& .MuiDataGrid-overlayWrapper",(0,r.Z)({},"& .MuiCircularProgress-root",{color:t.palette.secondary.main})),(0,r.Z)(n,"& .MuiDataGrid-row",(0,i.Z)({},c&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,r.Z)(n,"& .MuiDataGrid-row > .MuiDataGrid-cell",(0,i.Z)({},c&&{minHeight:"".concat(s,"cm !important"),maxHeight:"".concat(s,"cm !important")})),(0,r.Z)(n,"& .MuiDataGrid-columnHeaderCheckbox",(0,r.Z)({},"& .MuiButtonBase-root.MuiCheckbox-root > .MuiSvgIcon-root",(0,r.Z)({color:t.palette.secondary.main},'&[data-testid="CheckBoxOutlineBlankIcon"]',{color:"currentColor"}))),(0,r.Z)(n,"& .MuiDataGrid-row > .MuiDataGrid-cellCheckbox",(0,r.Z)({},"& .MuiButtonBase-root.MuiCheckbox-root > .MuiSvgIcon-root",(0,r.Z)({color:t.palette.secondary.main},'&[data-testid="CheckBoxOutlineBlankIcon"]',{color:"currentColor"}))),(0,r.Z)(n,"& .MuiDataGrid-row.even",{backgroundColor:t.palette.muiLightGray.main,"&:hover, &.Mui-hovered":{backgroundColor:(0,y.Fq)(t.palette.muiLightGray.main,.3),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,y.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,y.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity+t.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,y.Fq)(t.palette.muiLightGray.main,.3+t.palette.action.selectedOpacity)}}}}),n})},87336:function(e,n,t){"use strict";t.d(n,{t:function(){return u}});var r=t(85893),i=t(67294),o=t(45697),a=t(11163),s=t(98209),c=t(16540),u=(0,i.forwardRef)(function(e,n){var t=e.columns,o=e.history,u=e.initialSort,d=e.loading,l=e.meta,m=e.paginationSize,f=e.refetch,p=e.rowClick,h=e.rows,y=e.xeroPageSize,v=(0,a.useRouter)(),g=v.query,x=void 0===g?{}:g,_=(0,i.useState)(parseInt(null==x?void 0:x.page,10)||1),Z=_[0],b=_[1],I=(0,i.useState)(y||s.C1.paginationSize),q=I[0],$=I[1];u||(u={item:"createdAt",order:"desc"});var j=(0,i.useState)({item:u.item,order:u.order}),w=j[0],S=j[1],C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=v.query,t=void 0===n?{}:n;if(e>1?t.page=e:delete t.page,!(Object.keys(t).length>0))return{};var r=Object.keys(t).map(function(n){return"page"===n?"".concat(n,"=").concat(e):"".concat(n,"=").concat(t[n])}).join("&");return"?".concat(r)},A=function(){S({item:u.item,order:u.order}),b(1);var e=C();v.push(e),$(y||s.C1.paginationSize)};(0,i.useImperativeHandle)(n,function(){return{currentPage:Z,pageSize:q,sort:w,resetPagination:function(){A()}}});var k=function(e){var n=C(e);o&&v.push(n),b(e),!o&&f&&f()},P=function(e){e!==s.C1.paginationSize&&($(e),f&&f())},U=function(e){var n;S({item:e.item,order:e.order}),f&&f()};return(0,r.jsx)(c.Z,{columns:t,loading:d,paginationSize:m,pagination:l&&!0,paginationProps:l&&{currentPage:Z,onPageChange:k,onPageSizeChange:P,pageCount:Math.ceil(l.aggregate.totalCount/q),perPage:q},rowClick:p,rows:h,sort:w,setSort:U})});u.propTypes={columns:o.array.isRequired,history:o.bool,initialSort:o.object,loading:o.bool,meta:o.object,refetch:o.func,rowClick:o.func,rows:o.array.isRequired},u.defaultProps={history:!0,loading:!0,paginationSize:!1}},87407:function(e,n,t){"use strict";t.d(n,{H:function(){return V}});var r=t(26042),i=t(69396),o=t(29815),a=t(85893),s=t(67294),c=t(45697),u=t(6812),d=t(42283),l=t(79665),m=t(5616),f=t(69368),p=t(98456),h=t(94054),y=t(56815),v=t(51233),g=t(50135),x=t(15861),_=t(76600),Z=t(49501),b=t(95103),I=t(55563),q=t(90951),$=t(43724),j=t(31765),w=t(828),S=t(16310),C=(0,S.Ry)().shape({nameFirst:(0,S.Z_)().required(),nameLast:(0,S.Z_)().required(),email:(0,S.Z_)().required().email(),phone:(0,S.Z_)().required(),status:(0,S.Z_)().when("$hasRole",function(e,n){return(0,w.Z)(e,1)[0]?n.oneOf(["active","inactive"]).required():n}),invoiceThreshold:(0,S.Rx)().nullable().transform(function(e){return isNaN(e)?null:e}),quoteThreshold:(0,S.Rx)().nullable().transform(function(e){return isNaN(e)?null:e}),role:(0,S.Z_)().when(["$hasRole","$hasOneOwner","accountId"],function(e,n){var t=(0,w.Z)(e,3),r=t[0],i=t[1],o=t[2];return r?i?n.oneOf(["owner"],"Each account must have a designated owner.\n          If you would like to change the account type on this user,\n          please create another user account and designate this new account as an owner."):o&&o.length>0&&n.required():n}),position:(0,S.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:function(){return(0,S.Z_)()}}),isContact:(0,S.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:function(){return(0,S.Z_)().oneOf(["yes","no"]).required()}}),location:(0,S.IX)().when("$hasLocation",function(e,n){return(0,w.Z)(e,1)[0]?n.of((0,S.Rx)().integer().required()).required():n})}),A=t(74944),k=t(94885),P=t(12632),U=t(83372),T=t(90878),L=t(50480),D=function(e){var n=e.name,t=e.control,r=e.permissions,i=e.styles;return(0,a.jsxs)(m.Z,{sx:i,children:[(0,a.jsx)(x.Z,{variant:"h6",color:"dark.main",sx:{fontFamily:"Arial, sans-serif, sans-serif",fontWeight:"normal"},children:"Permissions"}),(0,a.jsx)(v.Z,{spacing:1,direction:"row",children:r.map(function(e){return(0,a.jsx)(d.Qr,{name:"".concat(n?n+".":"").concat(e.name),control:t,render:function(n){var t=n.value,r=n.onChange;return(0,a.jsx)(L.Z,{color:"dark.main",control:(0,a.jsx)(f.Z,{color:"secondary",checked:t,onChange:function(e){return r(e.target.checked)}}),label:e.label})}})})})]})};D.defaultProps={permissions:[]},D.propTypes={name:c.string,control:c.object.isRequired,permissions:c.object,styles:c.object};var M={customer_user:[{label:"Job reports",name:"jobReports"},{label:"PPM Schedules",name:"ppmSchedules"},{label:"Quotes",name:"quotes"},{label:"Finances",name:"finances"}]},F=t(7297),R=t(75063);function G(){var e=(0,F.Z)(["\n  query GetUserEditOffCanvas($userId: Int!, $accountId: Int, $includeAccount: Boolean!) {\n    user: User_by_pk(id: $userId) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      accounts: Account_Users(where: { accountId: { _eq: $accountId } })\n        @include(if: $includeAccount) {\n        id\n        role\n        position\n        isContact\n        status\n        modules\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n  }\n"]);return G=function(){return e},e}function N(){var e=(0,F.Z)(['\n  query FindOwnersByAccount($accountId: Int, $userId: Int) {\n    accountUsers: Account_User(\n      where: { role: { _eq: "owner" }, accountId: { _eq: $accountId }, userId: { _neq: $userId } }\n    ) {\n      id\n      role\n    }\n  }\n']);return N=function(){return e},e}var H=(0,R.Ps)(G()),z=(0,R.Ps)(N()),O=t(45451),E=["customer_user"],B=["customer_user","tenant_user"],V=function(e){var n,t=e.userId,c=e.accountId,w=e.accountType,S=e.submit,L=(0,A.x)(),F=L.hasRole,R=L.user,G=(0,P.x)({filters:{}}),N=G.initialData,V=G.ref,W=(0,s.useState)(!0),Q=W[0],J=W[1],X=(0,s.useState)(""),Y=X[0],K=X[1],ee=(0,s.useState)(null),en=ee[0],et=ee[1],er=(0,d.cI)({defaultValues:{id:t,accountId:c},resolver:(0,l.S)(C),context:{hasRole:(0,T.t4)(w,F),hasLocation:!E.includes(R.role)&&E.includes(Y),hasOneOwner:Q}}),ei=er.control,eo=er.errors,ea=er.handleSubmit,es=er.register,ec=er.watch,eu=er.reset,ed=er.setValue,el=ec("role"),em=ec("location");(0,s.useEffect)(function(){K("".concat(w,"_").concat(el))},[w,el]);var ef=(0,u.a)(H,{skip:!t,variables:{userId:t,accountId:c,includeAccount:!!c},onCompleted:function(e){var n,t=e.user,r={id:t.id,accountId:t.accountId,nameFirst:t.nameFirst||"",nameLast:t.nameLast||"",email:t.email||"",phone:t.phone||"",invoiceThreshold:t.invoiceThreshold,quoteThreshold:t.quoteThreshold,role:"",position:"",isContact:"",status:"active",meta:t.meta},i=null===(n=t.accounts)||void 0===n?void 0:n.find(function(e){return e.account.id===c});i&&(r.accountUserId=i.id,r.accountId=i.account.id,r.role=i.role,r.position=i.position,r.isContact=!0===i.isContact?"yes":"no",r.status=i.status,r.location=i.userLocations.map(function(e){return e.accountLocationId}),r.modules=i.modules),eu(r),K("".concat(w,"_").concat(r.role)),et(r.accountUserId)}}),ep=ef.data,eh=(void 0===ep?{}:ep).user,ey=ef.loading;(0,u.a)(z,{skip:!c,variables:{accountId:c,userId:t},onCompleted:function(e){J(!(e.accountUsers.length>0))}});var ev=(0,u.a)(k.ZA,{variables:(0,i.Z)((0,r.Z)({},N),{accountId:c})}),eg=ev.data,ex=void 0===eg?{location:[],meta:{aggregate:{totalCount:0}}}:eg,e_=ex.location,eZ=ex.meta,eb=ev.loading,eI=ev.refetch,eq=(0,o.Z)(j.I);switch(w){case"supplier":eq.push({text:"Operative",value:"contractor"});break;case"admin":eq.push({text:"Helpdesk",value:"helpdesk"})}var e$={control:ei,errors:eo,register:es},ej=function(e){S(e,null==eh?void 0:eh.meta)},ew=(0,s.useCallback)(function(e){return function(n){n.target.checked?ed("location",(0,o.Z)(null!=em?em:[]).concat([e])):ed("location",em.filter(function(n){return n!==e}))}},[em,ed]),eS=(0,s.useMemo)(function(){return[{sortable:!1,minWidth:10,field:"id",headerName:"",renderCell:function(e){var n=e.row;return(0,a.jsx)(f.Z,{color:"secondary",checked:null==em?void 0:em.includes(n.id),onChange:ew(n.id)})}},{sortable:!1,flex:1,field:"name",headerName:"Name"},{sortable:!1,flex:1,field:"address",headerName:"Address",renderCell:function(e){var n=e.row;return n.address?(0,a.jsxs)(v.Z,{children:[(0,a.jsx)(x.Z,{children:n.address.addressLine1}),(0,a.jsx)(x.Z,{children:n.address.postCode})]}):(0,a.jsx)(x.Z,{children:"Please add"})}}]},[em,ew]);if(ey)return(0,a.jsx)(v.Z,{widht:"100%",alignItems:"center",children:(0,a.jsx)(p.Z,{color:"secondary"})});var eC={id:(0,T.t4)(w,F)};return(0,a.jsxs)(_.Z,{id:"offCanvasForm",handleSubmit:ea(ej),children:[(0,a.jsx)($.q,(0,r.Z)({},e$)),c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(m.Z,{children:[(0,T.t4)(w,F)&&(0,a.jsx)(h.Z,{fullWidth:!0,error:eo.role,children:(0,a.jsxs)(Z.Z,{label:"Role",children:[(0,a.jsx)(b.Z,(0,i.Z)((0,r.Z)({},e$),{name:"role",options:eq})),(0,a.jsx)(y.Z,{sx:{margin:0},children:null===(n=eo.role)||void 0===n?void 0:n.message})]})}),(0,a.jsx)(Z.Z,{label:"Position / Job title",children:(0,a.jsx)(I.Z,(0,i.Z)((0,r.Z)({},e$),{name:"position"}))}),(0,T.pP)({accountType:w,role:el,hasRole:F})&&(null==eh?void 0:eh.id)!==R.id&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(Z.Z,{label:"Threshold limit / Invoice",children:(0,a.jsx)(g.Z,{inputRef:es,inputProps:{min:0},size:"small",name:"invoiceThreshold",type:"number",sx:{width:"100%",fieldset:{border:"1px solid ".concat(U.Q.COLOUR.dark)}},InputProps:{sx:{input:{padding:"0 0.725rem",height:"2.25rem"}}}})}),(0,a.jsx)(Z.Z,{label:"Threshold limit / Quote",children:(0,a.jsx)(g.Z,{inputRef:es,inputProps:{min:0},size:"small",name:"quoteThreshold",type:"number",sx:{width:"100%",fieldset:{border:"1px solid ".concat(U.Q.COLOUR.dark)}},InputProps:{sx:{input:{padding:"0 0.725rem",height:"2.25rem"}}}})})]}),(0,a.jsx)(q.Z,(0,i.Z)((0,r.Z)({},e$),{data:[{id:"yes",label:"Yes",value:"yes"},{id:"no",label:"No",value:"no"}],legend:"Contact User",name:"isContact",stacked:!0})),B.includes(Y)&&t!==R.id&&(0,a.jsx)(D,{name:"modules",control:ei,permissions:M[Y],styles:{mb:2}})]}),(0,a.jsx)(m.Z,{children:E.includes(Y)&&t!==R.id&&(0,a.jsxs)(Z.Z,{label:"Locations",children:[(0,a.jsx)(O.i,{columnVisibilityModel:eC,columns:eS,loading:eb,meta:eZ,ref:V,refetch:eI,rows:e_.map(function(e){var n;return{id:e.accountLocations[0].id,name:e.name,address:null===(n=e.addresses[0])||void 0===n?void 0:n.address}})}),(0,a.jsx)("input",(0,i.Z)((0,r.Z)({},es("location")),{type:"hidden"}))]})})]}),t&&(0,a.jsx)(I.Z,(0,i.Z)((0,r.Z)({},e$),{name:"id",type:"hidden"})),c&&(0,a.jsx)(I.Z,(0,i.Z)((0,r.Z)({},e$),{name:"accountId",type:"hidden"})),en&&(0,a.jsx)(I.Z,(0,i.Z)((0,r.Z)({},e$),{name:"accountUserId",type:"hidden"}))]})};V.propTypes={accountType:c.string,defaultValues:c.object,submit:c.func.isRequired}},90878:function(e,n,t){"use strict";t.d(n,{pP:function(){return u},qF:function(){return s},t4:function(){return c},te:function(){return a}});var r=t(26042),i=t(29815),o=t(53625),a=function(e,n,t){var i={};return e.id?(i.id=parseInt(e.id),i.changes={nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,meta:(0,r.Z)({},n),invoiceThreshold:e.invoiceThreshold||null,quoteThreshold:e.quoteThreshold||null},e.accountUserId?(i.updateAccountUser=!0,i.accountUserId=parseInt(e.accountUserId),i.accountUserChanges={role:e.role,position:e.position,isContact:"yes"===e.isContact,status:e.status,modules:e.modules}):(i.accountUserId=0,i.updateAccountUser=!1)):(i.role=e.role||"user",i.position=e.position,i.isContact="yes"===e.isContact,i.status=e.status,i.accountId=e.accountId,i.modules=e.modules,t?i.userId=t.id:i.User={data:{nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,status:e.status,meta:{sendDefaultWelcomeEmail:!0},invoiceThreshold:e.invoiceThreshold||null,quoteThreshold:e.quoteThreshold||null}}),i},s=function(e){return{accountUserId:e.accountUserId,objects:e.location.map(function(n){return{accountUserId:e.accountUserId,accountLocationId:n}})}},c=function(e,n){return"customer"!==e&&"supplier"!==e||n((0,i.Z)(o.td).concat((0,i.Z)(o.Sf),(0,i.Z)(o.n),(0,i.Z)(o.nx)))},u=function(e){var n=e.accountType,t=e.role,r=e.hasRole;return r(["admin_owner","customer_owner","supplier_owner"])?!["admin_owner","customer_owner","supplier_owner"].includes("".concat(n,"_").concat(t)):r(["customer_manager","supplier_manager"])?["admin_user","customer_user","supplier_user"].includes("".concat(n,"_").concat(t)):!!r(["admin_manager"])&&["admin_user","customer_user","supplier_user","customer_manager","supplier_manager"].includes("".concat(n,"_").concat(t))}},43724:function(e,n,t){"use strict";t.d(n,{q:function(){return v}});var r=t(26042),i=t(69396),o=t(29815),a=t(85893),s=t(45697),c=t(9270),u=t(62140),d=t(49501),l=t(55563),m=t(70982),f=t(95103),p=t(15897),h=t(74944),y=t(53625),v=function(e){var n=e.errors,t=e.prefix,s=e.register,v=(0,h.x)().hasRole,g={errors:n,register:s};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(c.Z,{children:[(0,a.jsx)(u.Z,{md:6,children:(0,a.jsx)(d.Z,{label:"First name",children:(0,a.jsx)(l.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"nameFirst")}))})}),(0,a.jsx)(u.Z,{md:6,children:(0,a.jsx)(d.Z,{label:"Last name",children:(0,a.jsx)(l.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"nameLast")}))})}),(0,a.jsx)(u.Z,{md:6,children:(0,a.jsxs)(d.Z,{label:"Email",children:[(0,a.jsx)(l.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"email"),type:"email"})),n["".concat(t,"email")]&&"duplicate"===n["".concat(t,"email")].type&&(0,a.jsx)(m.Z,{message:n["".concat(t,"email")].message})]})}),(0,a.jsx)(u.Z,{md:6,children:(0,a.jsx)(d.Z,{label:"Mobile",children:(0,a.jsx)(l.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"phone")}))})})]}),v((0,o.Z)(y.td).concat((0,o.Z)(y.Sf),(0,o.Z)(y.n),(0,o.Z)(y.nx)))&&(0,a.jsx)(d.Z,{label:"Status",children:(0,a.jsx)(f.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"status"),options:p.bg}))}),(0,a.jsx)(l.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"userId"),type:"hidden"}))]})};v.propTypes={errors:s.object.isRequired,prefix:s.string,register:s.func.isRequired},v.defaultProps={prefix:""}},94885:function(e,n,t){"use strict";t.d(n,{$E:function(){return D},AX:function(){return q},I4:function(){return I},JA:function(){return j},MT:function(){return k},Px:function(){return S},WF:function(){return w},ZA:function(){return R},a8:function(){return C},fA:function(){return L},fo:function(){return $},ge:function(){return F},iM:function(){return T},nE:function(){return P},nh:function(){return U},r1:function(){return A},tW:function(){return G},uz:function(){return M}});var r=t(7297),i=t(75063);function o(){var e=(0,r.Z)(["\n  mutation InsertAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return o=function(){return e},e}function a(){var e=(0,r.Z)(["\n  mutation UpdateUser(\n    $id: Int!\n    $accountUserId: Int!\n    $accountUserChanges: Account_User_set_input\n    $changes: User_set_input\n    $updateAccountUser: Boolean!\n  ) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _set: $accountUserChanges)\n      @include(if: $updateAccountUser) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return a=function(){return e},e}function s(){var e=(0,r.Z)(["\n  query GetUsers(\n    $accountId: Int\n    $accountType: String\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: User_order_by!\n    $status: String\n  ) {\n    users: User(\n      limit: $limit\n      offset: $offset\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [\n          { email: { _ilike: $q } }\n          { nameFirst: { _ilike: $q } }\n          { nameLast: { _ilike: $q } }\n        ]\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n    meta: User_aggregate(\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return s=function(){return e},e}function c(){var e=(0,r.Z)(["\n  query GetUser($id: Int!) {\n    user: User_by_pk(id: $id) {\n      id\n      fullName\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return c=function(){return e},e}function u(){var e=(0,r.Z)(["\n  query CheckDuplicateEmail($email: String!) {\n    users: User_public(where: { email: { _eq: $email } }) {\n      id\n      nameFirst\n      nameLast\n      email\n      phone\n    }\n  }\n"]);return u=function(){return e},e}function d(){var e=(0,r.Z)(["\n  fragment UserFields on User {\n    id\n    email\n    nameFirst\n    nameLast\n    fullName\n    phone\n    status\n  }\n"]);return d=function(){return e},e}function l(){var e=(0,r.Z)(["\n  mutation SendGoogleAuthCode($code: String!, $id: Int!, $type: String!) {\n    createGoogleToken(code: $code, id: $id, type: $type) {\n      success\n      tokens\n      error\n    }\n  }\n"]);return l=function(){return e},e}function m(){var e=(0,r.Z)(["\n  mutation GenerateMSURL($type: String!, $id: Int!) {\n    genenrateMSURL(id: $id, type: $type) {\n      url\n    }\n  }\n"]);return m=function(){return e},e}function f(){var e=(0,r.Z)(["\n  mutation signoutMS($id: Int!, $type: String!, $email: String!) {\n    signoutMS(id: $id, type: $type, email: $email) {\n      error\n      msId\n      success\n    }\n  }\n"]);return f=function(){return e},e}function p(){var e=(0,r.Z)(["\n  query getAccountMeta($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      meta\n    }\n  }\n"]);return p=function(){return e},e}function h(){var e=(0,r.Z)(["\n  query user($id: Int!) {\n    user: User_by_pk(id: $id) {\n      meta\n      invoiceThreshold\n      quoteThreshold\n    }\n  }\n"]);return h=function(){return e},e}function y(){var e=(0,r.Z)(["\n  query GetAccountUserMeta($userId: Int!, $accountId: Int!) {\n    accountUser: Account_User(where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }) {\n      meta\n    }\n  }\n"]);return y=function(){return e},e}function v(){var e=(0,r.Z)(["\n  mutation UpdateAccountUserByUserIdAccoutId(\n    $userId: Int!\n    $accountId: Int!\n    $changes: Account_User_set_input!\n  ) {\n    update_Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n      _set: $changes\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return v=function(){return e},e}function g(){var e=(0,r.Z)(["\n  mutation updateAccount($accountId: Int!, $set: Account_set_input!) {\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $set) {\n      id\n    }\n  }\n"]);return g=function(){return e},e}function x(){var e=(0,r.Z)(["\n  mutation updateUserMeta($userId: Int!, $meta: jsonb!) {\n    update_User_by_pk(pk_columns: { id: $userId }, _set: { meta: $meta }) {\n      id\n      meta\n    }\n  }\n"]);return x=function(){return e},e}function _(){var e=(0,r.Z)(['\n  query userDevices($accountId: Int!) {\n    users: User(\n      where: {\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        UserDevices: { status: { _eq: "active" } }\n        status: { _eq: "active" }\n      }\n    ) {\n      id\n      fullName\n      devices: UserDevices(\n        order_by: { updatedAt: desc_nulls_last }\n        where: { status: { _eq: "active" } }\n        limit: 1\n      ) {\n        id\n        playerId\n      }\n    }\n  }\n']);return _=function(){return e},e}function Z(){var e=(0,r.Z)(['\n  query GetAccountLocations($accountId: Int, $limit: Int, $offset: Int) {\n    location: Location(\n      offset: $offset\n      limit: $limit\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      id\n      name\n      accountLocations: Account_Locations {\n        id\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return Z=function(){return e},e}function b(){var e=(0,r.Z)(["\n  mutation InsertUserAccountLocations(\n    $accountUserId: Int!\n    $objects: [User_Account_Location_insert_input!]!\n  ) {\n    delete_User_Account_Location(where: { accountUserId: { _eq: $accountUserId } }) {\n      affected_rows\n    }\n    insert_User_Account_Location(objects: $objects) {\n      affected_rows\n      returning {\n        id\n      }\n    }\n  }\n"]);return b=function(){return e},e}var I=(0,i.Ps)(o()),q=(0,i.Ps)(a()),$=(0,i.Ps)(s()),j=(0,i.Ps)(c()),w=(0,i.Ps)(u()),S=(0,i.Ps)(d()),C=(0,i.Ps)(l()),A=(0,i.Ps)(m()),k=(0,i.Ps)(f()),P=(0,i.Ps)(p()),U=(0,i.Ps)(h()),T=(0,i.Ps)(y()),L=(0,i.Ps)(v()),D=(0,i.Ps)(g()),M=(0,i.Ps)(x()),F=(0,i.Ps)(_()),R=(0,i.Ps)(Z()),G=(0,i.Ps)(b())},12261:function(e,n,t){"use strict";t.d(n,{i:function(){return y}});var r=t(47568),i=t(828),o=t(97582),a=t(85893),s=t(45697),c=t(93645),u=t(50319),d=t(94885),l=t(77439),m=t(26042),f=t(69396),p=t(29815),h=function(e,n){var t=Object.values(e.integration.google).filter(function(e){return e.profile.email!==n});return Object.assign({},e,{integration:(0,f.Z)((0,m.Z)({},e.integration),{google:(0,p.Z)(t)})})},y=function(e){var n,t,s=e.credentials,m=s.id,f=s.type,p=e.isLoggedIn,y=e.refetch,v=e.meta,g=e.email,x=(0,i.Z)((0,u.D)(d.a8,{onCompleted:y}),1)[0],_=(0,i.Z)((0,u.D)(d.$E,{onCompleted:y}),1)[0],Z=(0,i.Z)((0,u.D)(d.uz,{onCompleted:y}),1)[0],b=(n=(0,r.Z)(function(e){return(0,o.__generator)(this,function(n){switch(n.label){case 0:if(!e.code)return[3,4];if("admin"!==f)return[3,2];return[4,x({variables:{code:e.code,id:m,type:f}})];case 1:return n.sent(),[3,4];case 2:return[4,x({variables:{code:e.code,id:m,type:f}})];case 3:n.sent(),n.label=4;case 4:return[2]}})}),function(e){return n.apply(this,arguments)}),I=(t=(0,r.Z)(function(){var e;return(0,o.__generator)(this,function(n){switch(n.label){case 0:switch(e=h(v,g),f){case"admin":return[3,1];case"user":return[3,3]}return[3,5];case 1:return[4,_({variables:{accountId:m,set:{meta:e}}})];case 2:case 4:return n.sent(),[3,6];case 3:return[4,Z({variables:{userId:m,meta:e}})];case 5:return[3,6];case 6:return[2]}})}),function(){return t.apply(this,arguments)});return p?(0,a.jsx)(c.GoogleLogout,{clientId:"69900974658-9rikek80a7b20gcigfeo3fv0r3qilqtp.apps.googleusercontent.com",onLogoutSuccess:I,render:function(e){return(0,a.jsx)(l.Z,{context:"secondary",content:"Sign Out",onClick:e.onClick,size:"sm"})}}):(0,a.jsx)(c.GoogleLogin,{accessType:"offline",prompt:"select_account",clientId:"69900974658-9rikek80a7b20gcigfeo3fv0r3qilqtp.apps.googleusercontent.com",isSignedIn:!0,onSuccess:b,onFailure:b,render:function(e){return(0,a.jsx)(l.Z,{context:"secondary",content:"Sign In",onClick:e.onClick,size:"sm"})},responseType:"code",scope:"https://mail.google.com"})};y.propTypes={credentials:s.object.isRequired,isLoggedIn:s.bool,refetch:s.func.isRequired}},47218:function(e,n,t){"use strict";t.d(n,{e:function(){return f}});var r=t(47568),i=t(828),o=t(97582),a=t(85893),s=t(45697),c=t(50319),u=t(94885),d=t(77439),l=function(e){var n=e.signOutHandler;return(0,a.jsx)(d.Z,{context:"secondary",content:"Sign Out",onClick:n,size:"sm"})},m=function(e){var n=e.handleLogin;return(0,a.jsx)(d.Z,{context:"secondary",content:"Sign In",onClick:n,size:"sm"})},f=function(e){var n,t,s=e.credentials,d=s.id,f=s.type,p=e.isLoggedIn,h=e.refetch,y=e.email,v=(0,i.Z)((0,c.D)(u.r1),1)[0],g=(0,i.Z)((0,c.D)(u.MT,{onCompleted:h}),1)[0],x=(n=(0,r.Z)(function(){var e,n,t,r;return(0,o.__generator)(this,function(i){switch(i.label){case 0:return e=function(e){var n=e.url,t=e.title,r=e.w,i=e.h,o=void 0!==window.screenLeft?window.screenLeft:window.screenX,a=void 0!==window.screenTop?window.screenTop:window.screenY,s=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:screen.width,c=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:screen.height,u=s/window.screen.availWidth,d=window.open(n,t,"\n\n        width=".concat(r/u,",\n        height=").concat(i/u,",\n        top=").concat((c-i)/2/u+a,",\n        left=").concat((s-r)/2/u+o,"\n        "));window.focus&&d.focus()},[4,v({variables:{id:d,type:f}})];case 1:if((n=i.sent()).error)return[2,console.error("Error:",n.error)];return(r=(null==n?void 0:null===(t=n.data)||void 0===t?void 0:t.genenrateMSURL).url)&&e({url:r,title:"microsoft",h:690,w:650}),[2]}})}),function(){return n.apply(this,arguments)}),_=(t=(0,r.Z)(function(){return(0,o.__generator)(this,function(e){switch(e.label){case 0:return[4,g({variables:{id:d,type:f,email:y}})];case 1:return e.sent(),[2]}})}),function(){return t.apply(this,arguments)});return p?(0,a.jsx)(l,{signOutHandler:_}):(0,a.jsx)(m,{handleLogin:x})};f.propTypes={credentials:s.object.isRequired,isLoggedIn:s.bool,refetch:s.func.isRequired}},58632:function(e,n,t){"use strict";t.d(n,{x:function(){return r}});var r=[{text:"Reactive",value:"reactive",context:"#2EE6CA"},{text:"Planned Maintenance",value:"ppm",context:"#D67EFF"},{text:"Quote",value:"quote",context:"#7D7"},{text:"Compliance",value:"cppm",context:"#CC7429"}]},84570:function(e,n,t){"use strict";t.d(n,{Y:function(){return r}});var r=[{text:"Select...",value:""},{text:"Call",value:"call"},{text:"Email",value:"email"},{text:"Portal",value:"portal"},{text:"Other",value:"other"}]},15897:function(e,n,t){"use strict";t.d(n,{bg:function(){return r}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},31765:function(e,n,t){"use strict";t.d(n,{I:function(){return r}});var r=[{text:"Select Role",value:""},{text:"Owner",value:"owner"},{text:"Manager",value:"manager"},{text:"User",value:"user"}]},48269:function(e,n,t){"use strict";t.r(n),t.d(n,{default:function(){return ez}});var r=t(85893),i=t(19076),o=t(67294),a=t(11163),s=t(6812),c=t(94885),u=t(52019),d=t(9270),l=t(62140),m=t(74280),f=t(26042),p=t(45697),h=t(7297),y=t(75063);function v(){var e=(0,h.Z)(["\n  mutation addHoliday($objects: [Holiday_insert_input!]!) {\n    insert_Holiday(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return v=function(){return e},e}function g(){var e=(0,h.Z)(["\n  mutation updateHoliday($changes: Holiday_set_input = {}, $id: Int!) {\n    update_Holiday_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return g=function(){return e},e}function x(){var e=(0,h.Z)(["\n  query GetHoliday($userId: Int!, $meta: jsonb_comparison_exp = {},$limit: Int,$offset: Int) {\n    Holiday(\n      limit: $limit\n      offset: $offset\n      where: ","\n    ) {\n      createdAt\n      endDate\n      id\n      notes\n      startDate\n      status\n      userId\n      AlternativeUser {\n        id\n        fullName\n        nameFirst\n        nameLast\n      }\n      User {\n        id\n        nameFirst\n        nameLast\n        fullName\n      }\n    }\n    meta: Holiday_aggregate(where:",") {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return x=function(){return e},e}function _(){var e=(0,h.Z)(['\n  query Holiday($startDate: timestamptz = "", $endDate: timestamptz = "", $userId: Int) {\n    events: Holiday(\n      where: {\n        _and: { startDate: { _gte: $startDate }, endDate: { _lte: $endDate } }\n        User: { id: { _eq: $userId } }\n      }\n    ) {\n      startDate\n      endDate\n      createdAt\n      id\n      notes\n      status\n      userId\n      User {\n        id\n        nameFirst\n        nameLast\n        fullName\n      }\n      AlternativeUser {\n        id\n        fullName\n        nameFirst\n        nameLast\n      }\n    }\n  }\n']);return _=function(){return e},e}var Z=(0,y.Ps)(v()),b=(0,y.Ps)(g()),I="{ User: { id: { _eq: $userId } }, meta: $meta }\norder_by: { startDate: asc, endDate: asc }",q=(0,y.Ps)(x(),I,I);(0,y.Ps)(_());var $=t(78289),j=t(26186),w=t(34613),S=t(68956),C=t(16551),A=t(77439),k=t(11585),P=t(87336),U=t(47568),T=t(69396),L=t(828),D=t(97582),M=t(50319),F=t(42283),R=t(79665),G=t(76600),N=t(49501),H=t(95103),z=t(6710),O=t(40552),E=t(536),B=t(15897),V=t(16310),W=t(74944),Q=function(e){var n,t,i=e.defaultValues,o=e.userId,a=e.onSuccess,s=(0,W.x)(),c=s.hasRole,u=s.user,d=c(["admin","superadmin"])&&!o,l=(0,F.cI)({defaultValues:i,resolver:(0,R.S)((0,V.Ry)().shape({startDate:(0,V.hT)().required(),endDate:(0,V.hT)().required().min((0,V.iH)("startDate"),"start date should be greater than end date"),meta:(0,V.Z_)(),notes:(0,V.Z_)(),alternativeUser:(0,V.Ry)().required(),user:d?(0,V.Ry)().required():(0,V.Ry)(),status:(0,V.Z_)().oneOf(["active","inactive"]).required()}))}),m=l.control,p=l.errors,h=l.handleSubmit,y=l.register,v=(0,L.Z)((0,M.D)(Z,{onCompleted:function(){a&&a()}}),1)[0],g=(0,L.Z)((0,M.D)(b,{onCompleted:function(){a&&a()}}),1)[0],x=(t=(0,U.Z)(function(e){var n;return(0,D.__generator)(this,function(t){switch(t.label){case 0:if((n=e).alternativeUserId=e.alternativeUser.value,n.user&&n.user.value?n.userId=n.user.value:n.userId=o,delete n.alternativeUser,n.user&&delete n.user,!i.id)return[3,2];return[4,g({variables:{id:i.id,changes:n}})];case 1:return t.sent(),[3,4];case 2:return[4,v({variables:{objects:[n]}})];case 3:t.sent(),t.label=4;case 4:return[2]}})}),function(e){return t.apply(this,arguments)}),_={control:m,errors:p,register:y};return(0,r.jsxs)(G.Z,{id:"offCanvasForm",handleSubmit:h(x),children:[d&&(0,r.jsx)(E.P,(0,T.Z)((0,f.Z)({},_),{errors:(0,f.Z)({},p),accountId:u.accountId,label:"User",name:"user",type:"user"})),(0,r.jsx)(E.P,(0,T.Z)((0,f.Z)({},_),{errors:(0,f.Z)({},p),accountId:u.accountId,label:"Alternative User",name:"alternativeUser",type:"user"})),(0,r.jsx)(N.Z,{label:"Start date",children:(0,r.jsx)(O.M,(0,T.Z)((0,f.Z)({},_),{dateFormat:"d MMM yyyy HH:mm",name:"startDate",placeholderText:"Click to select start date",showTimeSelect:!0}))}),(0,r.jsx)(N.Z,{label:"End date",children:(0,r.jsx)(O.M,(0,T.Z)((0,f.Z)({},_),{name:"endDate",dateFormat:"d MMM yyyy HH:mm",placeholderText:"Click to select end date",showTimeSelect:!0}))}),(0,r.jsx)(N.Z,{label:"Status",children:(0,r.jsx)(H.Z,(0,T.Z)((0,f.Z)({},_),{name:"status",options:B.bg}))}),(0,r.jsx)(N.Z,{label:"Notes",children:(0,r.jsx)(z.Z,(0,T.Z)((0,f.Z)({},_),{name:"notes"}))})]})};Q.propTypes={defaultValues:p.object,userId:p.number,onSuccess:p.number.isRequired};var J=function(e){var n=e.row,t=e.initialDate;return n?{id:n.id,alternativeUser:{value:n.AlternativeUser.id,label:n.AlternativeUser.fullName},user:{value:n.User.id,label:n.User.fullName},startDate:new Date(n.startDate),endDate:new Date(n.endDate),status:n.status.toLowerCase(),notes:n.notes}:{status:"active",startDate:t,endDate:t}};J.propTypes={row:p.object,initialDate:p.date};var X=t(12632),Y=function(e){var n=e.userId,t=(0,X.x)({filters:{}}),i=t.initialData,a=t.ref,c=(0,o.useContext)($.Z),u=(0,s.a)(q,{variables:(0,f.Z)({userId:parseInt(n)},i)}),d=u.data,l=void 0===d?{Holiday:[],meta:{aggregate:{totalCount:0}}}:d,m=l.Holiday,p=l.meta,h=u.refetch,y=u.loading,v=function(){h(),c.close()},g=function(e,t){e.stopPropagation(),c.show({content:(0,r.jsx)(Q,{defaultValues:J({row:t}),userId:n,onSuccess:v}),title:t?"Edit":"Add Holiday"})},x=[{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(e){var n=e.row;return"".concat((0,j.Z)(n.startDate)," ").concat((0,w.Z)(n.startDate))},sortable:!0,sortName:"startDate",text:"Start date"},{formatter:function(e){var n=e.row;return"".concat((0,j.Z)(n.endDate)," ").concat((0,w.Z)(n.endDate))},text:"End date"},{formatter:function(e){return e.row.AlternativeUser.fullName},text:"Alternative User"},{text:"Status"},{formatter:function(e){var n=e.row;return(0,j.Z)(n.createdAt)},text:"Created At"},{formatter:S.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:g,tooltip:"Edit"}],text:"Actions"}],_=function(){return(0,r.jsx)(C.Z,{children:(0,r.jsx)(A.Z,{context:"secondary",content:"Add Holiday",onClick:g,size:"sm"})})};return(0,r.jsx)(k.Z,{toolbar:(0,r.jsx)(_,{}),open:!0,title:"Holidays",children:(0,r.jsx)(P.t,{columns:x,loading:y,meta:p,ref:a,refetch:h,rows:m.map(function(e){return{id:e.id,userId:e.userId,AlternativeUser:e.AlternativeUser,User:e.User,notes:e.notes,startDate:e.startDate,endDate:e.endDate,status:e.status,createdAt:e.createdAt,actions:""}})})})};function K(){var e=(0,h.Z)(["\n  query GetLogs($id: Int!) {\n    logs: audit_Session(order_by: { createdAt: desc }, where: { userId: { _eq: $id } }) {\n      id\n      app\n      appVersion\n      createdAt\n      userAgent\n    }\n    meta: audit_Session_aggregate {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return K=function(){return e},e}Y.propTypes={userId:p.number.isRequired};var ee=(0,y.Ps)(K()),en=t(86036),et=function(e){var n=e.log;return(0,r.jsxs)(G.Z,{id:"offCanvasForm",children:[(0,r.jsx)(en.Z,{content:"App:",text:n.app}),(0,r.jsx)(en.Z,{content:"Date:",text:n.createdAt}),(0,r.jsx)(en.Z,{content:"App Version:",text:n.appVersion}),(0,r.jsx)(en.Z,{content:"User Agent:",text:n.userAgent})]})};et.propTypes={log:p.object};var er=function(e){var n=e.userId,t=(0,X.x)({filters:{}}).ref,i=(0,o.useContext)($.Z),a=(0,s.a)(ee,{variables:{id:parseInt(n)}}),c=a.data,u=void 0===c?{logs:[],meta:{aggregate:{totalCount:0}}}:c,d=u.logs,l=u.meta,m=a.loading,f=a.refetch,p=function(e){i.show({content:(0,r.jsx)(et,{log:e}),submit:!1,title:"Log Details"})};return!m&&(0,r.jsx)(k.Z,{open:!0,title:"User Logs",children:(0,r.jsx)(P.t,{columns:[{hidden:!0},{text:"App"},{text:"Date"},{hidden:!0,text:"User Agent"},{text:"App Version"}],history:!1,loading:m,meta:l,ref:t,refetch:f,rowClick:p,rows:d.map(function(e){return{id:e.id,app:e.app,createdAt:(0,j.Z)(e.createdAt,!0),userAgent:e.userAgent,appVersion:e.appVersion}})})})};er.propTypes={userId:p.string.isRequired};var ei=t(81777),eo=t(62466),ea=t(74297),es=t(16540),ec=t(29815);function eu(){var e=(0,h.Z)(["\n  mutation addAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return eu=function(){return e},e}function ed(){var e=(0,h.Z)(["\n  mutation UpdateAccountUser($id: Int!, $changes: Account_User_set_input) {\n    update_Account_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return ed=function(){return e},e}var el=(0,y.Ps)(eu()),em=(0,y.Ps)(ed()),ef=t(55563),ep=t(90951),eh=t(31765),ey=(0,V.Ry)().shape({accountSelected:(0,V.Ry)().required(),position:(0,V.Z_)().required(),role:(0,V.Z_)().required(),isContact:(0,V.Z_)().oneOf(["yes","no"]).required(),status:(0,V.Z_)().oneOf(["active","inactive"]).required()}),ev=function(e){var n,t,i=e.defaultValues,o=e.onSuccess,a=(0,F.cI)({defaultValues:i,resolver:(0,R.S)(ey)}),s=a.control,c=a.errors,u=a.handleSubmit,d=a.register,l=a.watch,m=(0,L.Z)((0,M.D)(el,{onCompleted:function(e){var n=e.insert_Account_User.returning[0].id;o&&o(n)}}),1)[0],p=(0,L.Z)((0,M.D)(em,{onCompleted:function(e){var n=e.update_Account_User_by_pk.id;o&&o(n)}}),1)[0],h=l("accountSelected"),y=(t=(0,U.Z)(function(e){var n;return(0,D.__generator)(this,function(t){switch(t.label){case 0:if((n=e).isContact="yes"===n.isContact,n.accountId=n.accountSelected.value,delete n.accountSelected,!i.id)return[3,2];return[4,p({variables:{id:i.id,changes:n}})];case 1:return t.sent(),[3,4];case 2:return[4,m({variables:{objects:[n]}})];case 3:t.sent(),t.label=4;case 4:return[2]}})}),function(e){return t.apply(this,arguments)}),v="supplier"===((null==h?void 0:h.type)||(null==h?void 0:null===(n=h.account)||void 0===n?void 0:n.type))?(0,ec.Z)(eh.I).concat([{text:"Operative",value:"contractor"}]):eh.I,g={control:s,errors:c,register:d};return(0,r.jsxs)(G.Z,{id:"offCanvasForm",handleSubmit:u(y),children:[(0,r.jsx)(E.P,(0,T.Z)((0,f.Z)({},g),{errors:(0,f.Z)({},c),label:"Account",name:"accountSelected"})),!!h&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(N.Z,{label:"Role",children:(0,r.jsx)(H.Z,(0,T.Z)((0,f.Z)({},g),{name:"role",options:v}))}),(0,r.jsx)(N.Z,{label:"Position / Job title",children:(0,r.jsx)(ef.Z,(0,T.Z)((0,f.Z)({},g),{name:"position"}))}),(0,r.jsx)(ep.Z,(0,T.Z)((0,f.Z)({},g),{data:[{id:"yes",label:"Yes",value:"yes"},{id:"no",label:"No",value:"no"}],legend:"Contact User",name:"isContact",stacked:!0})),(0,r.jsx)(N.Z,{label:"Status",children:(0,r.jsx)(H.Z,(0,T.Z)((0,f.Z)({},g),{name:"status",options:B.bg}))}),i.id?(0,r.jsx)(ef.Z,(0,T.Z)((0,f.Z)({},g),{name:"id",type:"hidden"})):(0,r.jsx)(ef.Z,(0,T.Z)((0,f.Z)({},g),{name:"userId",type:"hidden"}))]})]})};ev.propTypes={defaultValues:p.object,onSuccess:p.func.isRequired};var eg=function(e){var n=e.refetch,t=e.user,i=(0,o.useContext)(u.Z).hasRole,a=(0,o.useContext)($.Z),s=Object.assign({},t);s.name="".concat(s.nameFirst," ").concat(s.nameLast);var c=function(){n(),a.close()},d=function(e,n){e.stopPropagation(),(null==n?void 0:n.id)?(n.isContact=null==n?void 0:n.isContact.toLowerCase(),n.role=n.role.toLowerCase(),n.status=n.status.toLowerCase()):((n={}).isContact="no",n.status="active",n.userId=t.id),a.show({content:(0,r.jsx)(ev,{defaultValues:n,onSuccess:c}),title:n.id?"Edit":"Assign Account"})},l=[{hidden:!0},{formatter:(0,eo.Z)("","accountId","name","url"),text:"Account"},{text:"Type"},{text:"Role"},{text:"Position"},{text:"Contact"},{text:"Status"},{hidden:!0},{hidden:!i("admin"),formatter:S.Z,formatterData:[{context:"secondary",icon:["fas","edit"],onClick:d,tooltip:"Edit"}],text:"Actions"},{hidden:!0},{hidden:!0}],m=function(){return(0,r.jsx)(C.Z,{children:(0,r.jsx)(A.Z,{context:"secondary",content:"Assign Account",onClick:d,size:"sm"})})};return(0,r.jsx)(k.Z,{toolbar:i("admin")&&(0,r.jsx)(m,{}),open:!0,title:"Accounts",children:(0,r.jsx)(es.Z,{columns:l,rows:s.accounts.filter(function(e){return null!==e.account}).map(function(e){return{id:e.id,name:e.account.name,type:(0,ea.Z)(e.account.type),role:(0,ea.Z)(e.role),position:e.position||"N/A",isContact:e.isContact?"Yes":"No",status:(0,ea.Z)(e.status),accountId:e.account.id,actions:"",url:"tenant"===e.account.type.toLowerCase()?"":"/dashboard/".concat(e.account.type.toLowerCase(),"s/view"),accountSelected:{label:e.account.name,type:e.account.type,value:e.account.id}}})})})},ex=t(87407),e_=function(e){var n,t,i=e.refetch,a=e.user,s=(0,W.x)(),u=s.user.id,d=s.hasRole,l=(0,o.useContext)($.Z),m=Object.assign({},a),p=(0,L.Z)((0,M.D)(c.AX,{onCompleted:function(e){l.close(),i()}}),1)[0],h=function(e){var n=(0,f.Z)({},e);delete n.userId,p({variables:{accountUserId:0,changes:n,id:n.id,updateAccountUser:!1}})},y=function(e){e.stopPropagation(),l.show({content:(0,r.jsx)(ex.H,{userId:a.id,submit:h}),title:"Edit user"})},v=function(){return(0,r.jsx)(C.Z,{children:(0,r.jsx)(A.Z,{context:"secondary",content:"Edit",onClick:y,size:"sm"})})};m.name="".concat(m.nameFirst," ").concat(m.nameLast);var g=(null==m?void 0:null===(n=m.accounts)||void 0===n?void 0:n.filter(function(e){return!!e.account}))||[],x=d(["superadmin","admin"])||m.id===u;return(0,r.jsxs)(k.Z,{toolbar:d("admin")&&(0,r.jsx)(v,{}),open:!0,title:"Details",children:[(0,r.jsx)(en.Z,{content:"Name",text:m.name}),x&&(0,r.jsx)(en.Z,{content:"Email",text:m.email}),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(en.Z,{content:"Position",text:""}),g.length>1?g.map(function(e){return(0,r.jsx)(en.Z,{content:"",text:"".concat(e.account.name,": ").concat(e.position||"N/A")})}):(0,r.jsx)(en.Z,{content:"",text:(null===(t=g[0])||void 0===t?void 0:t.position)||"N/A"})]}),x&&(0,r.jsx)(en.Z,{content:"Phone",text:m.phone}),(0,r.jsx)(en.Z,{content:"Status",text:m.status}),(0,r.jsx)(en.Z,{content:"Date Added",text:(0,j.Z)(m.createdAt)})]})},eZ=t(34953),eb=t(51466),eI=t(47218),eq=t(12261);function e$(e){var n,t,r,i,o,a,u,d=(0,s.a)(c.nh,{variables:{id:e}}),l=d.loading,m=d.data,f=d.refetch,p={};p=null==m?void 0:null===(n=m.user)||void 0===n?void 0:n.meta;var h={google:!1,microsoft:!1,sage:!1};return l||(h={google:!!(null==p?void 0:null===(t=p.integration)||void 0===t?void 0:null===(r=t.google)||void 0===r?void 0:null===(i=r.tokens)||void 0===i?void 0:i.access_token),microsoft:!!(null==p?void 0:null===(o=p.integration)||void 0===o?void 0:null===(a=o.microsoft)||void 0===a?void 0:a.id),sage:!!((null==p?void 0:null===(u=p.modules)||void 0===u?void 0:u.sageIntegration)&&p.modules.sageIntegration.length>0)}),{loading:l,data:{integration:h,meta:p},refetch:f}}e$.propTypes={accountId:p.number.isRequired};var ej=function(e){var n=e.id,t=e$(n),i=t.data,o=i.integration,a=i.meta,s=t.refetch;return(0,r.jsxs)(k.Z,{fitParentHeight:!0,open:!0,title:"Integrations",children:[(0,r.jsxs)(d.Z,{align:"center",children:[(0,r.jsx)(l.Z,{md:2,children:(0,r.jsx)(eZ.Z,{alt:"Microsoft Outlook",src:"/static/logo/Microsoft_Outlook-Logo.svg"})}),(0,r.jsxs)(l.Z,{md:6,children:[(0,r.jsx)(eb.Z,{content:"Microsoft Outlook"}),(0,r.jsx)(eb.Z,{content:"Add asset bookings to your calendar",size:"sm"})]}),(0,r.jsx)(l.Z,{md:4,children:(0,r.jsx)(eI.e,{credentials:{id:n,type:"user"},isLoggedIn:o.microsoft,refetch:s})})]}),(0,r.jsxs)(d.Z,{align:"center",children:[(0,r.jsx)(l.Z,{md:2,children:(0,r.jsx)(eZ.Z,{alt:"Google Calendar",src:"/static/logo/Google_Calendar-Logo.svg"})}),(0,r.jsxs)(l.Z,{md:6,children:[(0,r.jsx)(eb.Z,{content:"Google Calendar"}),(0,r.jsx)(eb.Z,{content:"Add asset bookings to your calendar",size:"sm"})]}),(0,r.jsx)(l.Z,{md:4,children:(0,r.jsx)(eq.i,{credentials:{id:n,type:"user"},isLoggedIn:o.google,refetch:s,meta:a})})]})]})};ej.propTypes={id:p.number.isRequired};var ew,eS=t(10367),eC=t(76312),eA=t(15214),ek=t(55843),eP=t(13439),eU=function(e){var n,t,r,i,o,a=e.userMeta,s=e.data,c=e.documentSide,u=null,d=(0,f.Z)({},a);(null==d?void 0:d.identityDocument)||(d=(0,T.Z)((0,f.Z)({},d),{identityDocument:{}}));var l=s.key,m=s.data.find(function(e){return"large"===e.name});u=m?m.relativePath:l;var p={key:s.key,extension:null==u?void 0:u.split(".").pop(),thumbnails:s.data||null};switch(c){case"documentFrontSide":n=null===(t=d.identityDocument)||void 0===t?void 0:null===(r=t.front)||void 0===r?void 0:r.key,d.identityDocument=(0,T.Z)((0,f.Z)({},d.identityDocument),{front:p});break;case"documentBackSide":n=null===(i=d.identityDocument)||void 0===i?void 0:null===(o=i.back)||void 0===o?void 0:o.key,d.identityDocument=(0,T.Z)((0,f.Z)({},d.identityDocument),{back:p})}return{meta:d,key:n}},eT=t(63973),eL=(0,V.Ry)().shape({dropzone:(0,V.nK)().required()}),eD=t(34155),eM=(ew=(0,U.Z)(function(e){var n,t,r;return(0,D.__generator)(this,function(r){switch(r.label){case 0:return n="cleverly-media",t=eD.env.NEXT_PUBLIC_S3_DELETE_URL,[4,window.fetch(t,{method:"POST",body:{bucket:n,keys:(0,ec.Z)(e)}})];case 1:return[2,r.sent().json()]}})}),function(e){return ew.apply(this,arguments)});function eF(){var e=(0,h.Z)(["\n  height: 85vh;\n  padding: 0;\n  margin: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n"]);return eF=function(){return e},e}var eR=function(e){var n,t=e.userId,i=e.onSuccess,a=e.userMeta,s=e.documentSide,u=(0,o.useState)(!1),d=u[0],l=u[1],m=(0,o.useState)(""),p=m[0],h=m[1],y=(0,F.cI)({resolver:(0,R.S)(eL)}),v=y.control,g=y.errors,x=y.handleSubmit,_=y.register,Z=(0,L.Z)((0,M.D)(c.uz,{onCompleted:i,update:function(e,n){var r=n.data.update_User_by_pk.meta;e.readQuery({query:c.JA,variables:{id:t}}),e.writeQuery({query:c.JA,variables:{id:t},data:{meta:r}})}}),2),b=Z[0],I=Z[1].loading,q=(n=(0,U.Z)(function(e){var n,r,i,o,c,u,d;return(0,D.__generator)(this,function(d){switch(d.label){case 0:n=e.dropzone,d.label=1;case 1:if(d.trys.push([1,7,,8]),l(!0),!(r=n[0]))return[3,6];return[4,(0,eT.V)(r,"image")];case 2:if(!(i=d.sent()).success)return[2,h(i.message)];if(c=(o=eU({userMeta:a,data:i,documentSide:s})).meta,!(u=o.key))return[3,4];return[4,eM(u)];case 3:d.sent(),d.label=4;case 4:return[4,b({variables:{userId:t,meta:c}})];case 5:d.sent(),d.label=6;case 6:return[3,8];case 7:return h(d.sent()),[3,8];case 8:return[2]}})}),function(e){return n.apply(this,arguments)});return d||I?(0,r.jsx)(eG,{children:(0,r.jsx)(eC.Z,{})}):(0,r.jsxs)(G.Z,{id:"offCanvasForm",handleSubmit:x(q),children:[p.length>0&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(eA.Z,{content:p,context:"warning"}),(0,r.jsx)(ek.Z,{})]}),(0,r.jsx)(N.Z,{label:"Media"}),(0,r.jsx)(F.Qr,(0,T.Z)((0,f.Z)({},{control:v,errors:g,register:_}),{as:(0,r.jsx)(eP.Z,{accept:"image/*, .heic",multiple:!1}),name:"dropzone"}))]})},eG=eS.ZP.div.withConfig({displayName:"form__StyledLoading",componentId:"sc-5897afed-0"})(eF());eR.propTypes={accept:p.string,onSuccess:p.any},eR.defaultProps={accept:eP.Z.defaultProps.accept};var eN=function(e){var n=e.userId,t=e.userMeta,i=(0,o.useContext)($.Z),a=function(e){i.show({content:(0,r.jsx)(eR,{userId:n,userMeta:t,onSuccess:i.close,documentSide:e}),title:"Upload Identity Document ".concat("documentFrontSide"===e?"Front":"Back")})};return(0,r.jsx)(k.Z,{open:!0,title:"Identity document",children:(0,r.jsx)(es.Z,{rows:[{key:"Identity Card Front",value:null,calcAmount:function(){var e;return(0,r.jsxs)(d.Z,{children:[(0,r.jsx)(l.Z,{sm:6,children:(0,r.jsx)(eb.Z,{size:"sm",children:(null==t?void 0:null===(e=t.identityDocument)||void 0===e?void 0:e.front)?"Already Assigned":"Not Assigned"})}),(0,r.jsx)(l.Z,{size:6,children:(0,r.jsx)(A.Z,{context:"secondary",content:"Assign",size:"sm","data-cy":"AssignIdentityDocument",onClick:function(){return a("documentFrontSide")}})})]})},show:!0},{key:"Identity Card Back",value:null,calcAmount:function(){var e;return(0,r.jsxs)(d.Z,{children:[(0,r.jsx)(l.Z,{sm:6,children:(0,r.jsx)(eb.Z,{size:"sm",children:(null==t?void 0:null===(e=t.identityDocument)||void 0===e?void 0:e.back)?"Already Assigned":"Not Assigned"})}),(0,r.jsx)(l.Z,{size:6,children:(0,r.jsx)(A.Z,{context:"secondary",content:"Assign",size:"sm","data-cy":"AssignIdentityDocument",onClick:function(){return a("documentBackSide")}})})]})},show:!0}]})})},eH=function(){var e=(0,o.useContext)(u.Z).hasRole,n=(0,a.useRouter)().query,t=(0,s.a)(c.JA,{variables:{id:parseInt(n.id)}}),i=t.data,f=(void 0===i?{user:{}}:i).user,p=t.loading,h=t.refetch;return!p&&(0,r.jsxs)(d.Z,{children:[(0,r.jsxs)(l.Z,{md:6,children:[(0,r.jsx)(ei.g,{avatar:(0,m.Q)(f.media),editable:e("admin"),entity:{name:"".concat(f.nameFirst," ").concat(f.nameLast)},entityName:"User",prefix:"/dashboard/users/"}),(0,r.jsx)(e_,{refetch:h,user:f}),e("supplier")&&(0,r.jsx)(eN,{userId:n.id,userMeta:f.meta}),e("admin")&&(0,r.jsx)(er,{userId:n.id})]}),(0,r.jsxs)(l.Z,{md:6,children:[(0,r.jsx)(eg,{refetch:h,user:f}),e("admin")&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Y,{userId:f.id}),(0,r.jsx)(ej,{id:f.id})]})]})]})},ez=function(){return(0,r.jsx)(i.Z,{View:(0,r.jsx)(eH,{})})}}},function(e){e.O(0,[3662,367,2283,212,8890,9511,2583,6310,4599,4135,8579,4244,7645,3776,1564,2329,778,3054,1023,3911,1417,6540,3425,1870,5037,1352,4043,1207,4844,8359,6557,9774,2888,179],function(){return e(e.s=76570)}),_N_E=e.O()}]);