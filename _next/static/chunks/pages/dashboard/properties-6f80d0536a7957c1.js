(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1052],{5828:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/properties",function(){return n(8463)}])},74492:function(e,t,n){"use strict";n.d(t,{a:function(){return i}});var r=n(55508),o=n(67294),i=function(){var e=(0,o.useContext)(r.d);if(!e)throw Error("useOffCanvasContext must be used within the OffCanvasProvider");return e}},16951:function(e,t,n){"use strict";n.d(t,{k:function(){return b}});var r=n(26042),o=n(69396),i=n(85893),a=n(45697),c=n(42283),s=n(79665),u=n(76600),l=n(9270),d=n(62140),m=n(49501),p=n(55563),v=n(6710),h=n(95103),f=n(16310),g=(0,f.Ry)().shape({name:(0,f.Z_)(),invoicingEntity:(0,f.Z_)(),addressLine1:(0,f.Z_)().required(),addressLine2:(0,f.Z_)(),addressLine3:(0,f.Z_)(),city:(0,f.Z_)().required(),postCode:(0,f.Z_)().matches("^([Gg][Ii][Rr] 0[Aa]{2})|((([A-Za-z][0-9]{1,2})|(([A-Za-z][A-Ha-hJ-Yj-y][0-9]{1,2})|(([A-Za-z][0-9][A-Za-z])|([A-Za-z][A-Ha-hJ-Yj-y][0-9][A-Za-z]?))))\\s?[0-9][A-Za-z]{2})$|^([AC-FHKNPRTV-Y]\\d{2}|D6W)\\s[0-9AC-FHKNPRTV-Y]{4}$").required(),county:(0,f.Z_)(),countryId:(0,f.Z_)().required()}),x=n(31113),Z=n(98521),b=function(e){var t=e.defaultValues,n=e.onSubmit,a=e.type,f=(0,c.cI)({defaultValues:(0,r.Z)({},t),resolver:(0,s.S)(g)}),b=f.control,y=f.errors,j=f.handleSubmit,I={control:b,errors:y,register:f.register};return(0,i.jsxs)(u.Z,{id:"offCanvasForm",handleSubmit:j(n),children:[(0,i.jsxs)(l.Z,{children:[(0,i.jsx)(d.Z,{md:12,children:(0,i.jsx)(m.Z,{label:"Address name",children:(0,i.jsx)(p.Z,(0,o.Z)((0,r.Z)({},I),{name:"name"}))})}),"invoice"===a&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(d.Z,{md:12,children:(0,i.jsx)(m.Z,{label:"invoicing email",children:(0,i.jsx)(p.Z,(0,o.Z)((0,r.Z)({},I),{name:"invoicingEmail",type:"email"}))})}),(0,i.jsx)(d.Z,{md:12,children:(0,i.jsx)(m.Z,{label:"Invoicing entity",children:(0,i.jsx)(v.Z,(0,o.Z)((0,r.Z)({},I),{name:"invoicingEntity",rows:4}))})})]}),(0,i.jsx)(d.Z,{md:6,children:(0,i.jsx)(m.Z,{label:"Address Line 1",children:(0,i.jsx)(p.Z,(0,o.Z)((0,r.Z)({},I),{name:"addressLine1"}))})}),(0,i.jsx)(d.Z,{md:6,children:(0,i.jsx)(m.Z,{label:"Address Line 2",children:(0,i.jsx)(p.Z,(0,o.Z)((0,r.Z)({},I),{name:"addressLine2"}))})}),(0,i.jsx)(d.Z,{md:6,children:(0,i.jsx)(m.Z,{label:"Address Line 3",children:(0,i.jsx)(p.Z,(0,o.Z)((0,r.Z)({},I),{name:"addressLine3"}))})}),(0,i.jsx)(d.Z,{md:6,children:(0,i.jsx)(m.Z,{label:"City",children:(0,i.jsx)(p.Z,(0,o.Z)((0,r.Z)({},I),{name:"city"}))})}),(0,i.jsx)(d.Z,{md:6,children:(0,i.jsx)(m.Z,{label:"Post Code",children:(0,i.jsx)(p.Z,(0,o.Z)((0,r.Z)({},I),{name:"postCode"}))})}),(0,i.jsx)(d.Z,{md:6,children:(0,i.jsx)(m.Z,{label:"County",children:(0,i.jsx)(p.Z,(0,o.Z)((0,r.Z)({},I),{name:"county"}))})}),(0,i.jsx)(d.Z,{md:6,children:(0,i.jsx)(m.Z,{label:"Country",children:(0,i.jsx)(h.Z,(0,o.Z)((0,r.Z)({},I),{name:"countryId",options:Z.O}))})})]}),(0,i.jsx)(l.Z,{justify:"end",children:(0,i.jsx)(d.Z,{md:12,children:(0,i.jsx)(x.H,{content:"Submit",type:"submit"})})}),(null==t?void 0:t.id)&&(0,i.jsx)(p.Z,(0,o.Z)((0,r.Z)({},I),{name:"id",type:"hidden"})),(null==t?void 0:t.meta)&&(0,i.jsx)(p.Z,(0,o.Z)((0,r.Z)({},I),{name:"meta",type:"hidden"}))]})};b.propTypes={defaultValues:a.object,onCancel:a.func.isRequired,onSubmit:a.func.isRequired,type:a.string}},18531:function(e,t,n){"use strict";n.d(t,{q:function(){return v}});var r=n(26042),o=n(69396),i=n(99534),a=n(85893),c=n(87918),s=n(98456),u=n(23776),l=n(50135),d=n(67294),m=n(45697),p=n.n(m),v=function(e){var t=e.loading,n=e.setSearch,m=e.textFieldProps,p=(e.disableClearable,(0,i.Z)(e,["loading","setSearch","textFieldProps","disableClearable"])),v=(0,d.useState)(""),h=v[0],f=v[1];return(0,d.useEffect)(function(){var e=setTimeout(function(){n(h)},500);return function(){return clearTimeout(e)}},[h,n]),(0,a.jsx)(u.Z,(0,o.Z)((0,r.Z)({isOptionEqualToValue:function(e,t){return e.value===t.value}},p),{loading:t,onInputChange:function(e,t){f(t)},getOptionLabel:function(e){return"".concat(e.label)},renderTags:function(e,t){return e.map(function(e,n){return(0,a.jsx)(c.Z,(0,r.Z)({size:"small",label:e.label},t({index:n})))})},renderInput:function(e){return(0,a.jsx)(l.Z,(0,o.Z)((0,r.Z)({},e,m),{InputProps:(0,o.Z)((0,r.Z)({},e.InputProps,m.InputProps||{}),{endAdornment:(0,a.jsxs)(a.Fragment,{children:[t?(0,a.jsx)(s.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}}))};v.defaultProps={color:"secondary",onChange:function(){},options:[],onOpen:function(){},setSearch:function(){},textFieldProps:{}},v.propTypes={multiple:p().bool,limitTags:p().number,filterSelectedOptions:p().bool,color:p().string,loading:p().bool,value:p().oneOf([p().array,p().object]),onChange:p().func,options:p().arrayOf(p().shape({value:p().any.isRequired,label:p().string.isRequired})).isRequired,onOpen:p().func,setSearch:p().func,textFieldProps:p().shape({label:p().string,variant:p().oneOf(["standard"]),color:p().string,error:p().bool,helperText:p().string})}},31113:function(e,t,n){"use strict";n.d(t,{H:function(){return u}});var r=n(26042),o=n(85893),i=n(45697),a=n(55377),c=n(16551),s=n(77439),u=function(e){var t=e.children,n=e.content,i=e.context,u=e.data,l=e.disabled,d=e.handleClick,m=e.size,p=e.type;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(a.Z,{size:"sm"}),(0,o.jsxs)(c.Z,{align:"flex-end",children:[t,(0,o.jsx)(s.Z,(0,r.Z)({content:n,context:i,disabled:l,onClick:d,size:m,type:p},u))]})]})};u.propTypes={children:i.node,content:i.string,context:i.string,data:i.object,disabled:i.bool,handleClick:i.func,size:i.string,type:i.string},u.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},53600:function(e,t,n){"use strict";n.d(t,{E:function(){return r}});var r=function(e,t){if(Array.isArray(t)){var n,r=null;return t.forEach(function(t){var n,o=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});r=(null==o?void 0:o.createdAt)||r}),r}var o=null==e?void 0:null===(n=e.timings)||void 0===n?void 0:n.find(function(e){return e.status===t});return(null==o?void 0:o.createdAt)||null}},83162:function(e,t,n){"use strict";n.d(t,{r:function(){return m}});var r=n(26042),o=n(69396),i=n(99534),a=n(85893),c=n(45697),s=n.n(c),u=n(41664),l=n.n(u),d=n(23795),m=function(e){var t=e.children,n=e.href,c=e.noWrap,s=e.target,u=e.sx,m=void 0===u?{}:u,p=(0,i.Z)(e,["children","href","noWrap","target","sx"]);return c?(0,a.jsx)(a.Fragment,{children:t}):n?(0,a.jsx)(l(),{href:n,target:s,passHref:!0,children:(0,a.jsx)(d.Z,(0,o.Z)((0,r.Z)({sx:m,children:t,href:n,noWrap:c,target:s},p),{children:t}))}):(0,a.jsx)(d.Z,(0,o.Z)((0,r.Z)({sx:m,children:t,href:n,noWrap:c,target:s},p),{children:t}))};m.defaultProps={onClick:function(e){e.stopPropagation()}},m.propTypes={onClick:s().func,href:s().string,noWrap:s().bool,color:s().string}},34187:function(e,t,n){"use strict";n.d(t,{C:function(){return p}});var r=n(26042),o=n(69396),i=n(85893);n(67294);var a=n(45697),c=n(90948),s=n(15861),u=n(51233),l=n(11057),d=n(61730),m=(0,c.ZP)("img")({width:"300px",height:"250px"}),p=function(e){var t=e.imageSrc,n=e.sx,a=e.imageSx,c=e.title,p=e.titleSx,v=e.subtitleFirstLine,h=e.subtitleFirstLineSx,f=e.subtitleSecondLine,g=e.subtitleSecondLineSx,x=e.buttonText,Z=e.onAction,b=(0,d.Z)("(max-width: 400px)");return(0,i.jsxs)(u.Z,{sx:(0,o.Z)((0,r.Z)({},n),{width:"100%",height:"100%"}),justifyContent:"center",alignItems:"center",spacing:2,color:"#757575",children:[(0,i.jsx)(m,{src:t,sx:(0,o.Z)((0,r.Z)({},a),{width:b?"250px":"300px"})}),(0,i.jsx)(s.Z,{typography:"h5",sx:(0,r.Z)({},p),children:c}),(0,i.jsxs)(u.Z,{alignItems:"center",sx:{padding:"0px 10px",textAlign:"center"},children:[(0,i.jsx)(s.Z,{sx:(0,r.Z)({},h),children:v}),(0,i.jsx)(s.Z,{sx:(0,r.Z)({},g),children:f})]}),x&&Z&&(0,i.jsx)(l.Z,{variant:"contained",color:"secondary",onClick:Z,children:x})]})};p.propTypes={imageSrc:a.string,title:a.string,subtitleFirstLine:a.string,subtitleSecondLine:a.string,onAction:a.func,sx:a.object,imageSx:a.object,titleSx:a.object,subtitleFirstLineSx:a.object,subtitleSecondLineSx:a.object},p.defaultProps={title:"",subtitleFirstLine:"",subtitleSecondLine:"",sx:{},imageSx:{},titleSx:{},subtitleFirstLineSx:{},subtitleSecondLineSx:{},onAction:null}},536:function(e,t,n){"use strict";n.d(t,{P:function(){return _}});var r=n(47568),o=n(26042),i=n(69396),a=n(99534),c=n(7297),s=n(97582),u=n(85893),l=n(67294),d=n(45697),m=n(10367),p=n(66252),v=n(57493),h=n(78289),f=n(52019),g=n(49501),x=n(9270),Z=n(62140),b=n(84043),y=n(77439);function j(){var e=(0,c.Z)(["\n  position: relative;\n  right: 25px;\n  top: 2px;\n"]);return j=function(){return e},e}var I=function(e,t){var n,r,o,i=!0;return(null===(n=e.errors[e.name])||void 0===n?void 0:n.message)!==(null===(r=t.errors[t.name])||void 0===r?void 0:r.message)&&(i=!1),["accountId","assetCategoryId","entity","entityId","locationId","serviceId","type","value","customerId","customerRole"].forEach(function(n){e[n]!==t[n]&&(i=!1)}),i},C=function(e){var t=e.accountId,n=e.area,r=e.assetCategoryId,o=e.entity,i=e.entityId,a=(e.hasRole,e.id),c=e.locationId,s=e.serviceId,u=e.taxonomyGroupType,l=e.customerId,d=e.customerRole,m=e.type,p=e.userId,h=e.invoiceThreshold,f=e.quoteThreshold,g=m;switch(d&&(g="".concat(m,"_").concat(d)),g){case"address":return{query:v.cz,variables:{entity:o,entityId:i}};case"asset":return{query:v.UH,variables:{categoryId:r,locationId:c}};case"assetBookable":return{query:v.UH,variables:{categoryId:r,locationId:c,bookable:"yes"}};case"assetCategory":return{query:v.nD,variables:{id:a}};case"assetSublocation":return{query:v.UH,variables:{category:"sublocation",adminId:t,locationId:c}};case"coverage":return{query:v.j$};case"customer":return{query:v.SW};case"job":return{query:v.Qn,variables:{locationId:c}};case"manager":return{query:v.he,variables:{accountId:t,userId:p}};case"thresholdManagers":return{query:v.Ak,variables:{accountId:t,userId:p,invoiceThreshold:h,quoteThreshold:f}};case"product":return{query:v.UH,variables:{category:"product",locationId:c}};case"property":return{query:v._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:t}}}}};case"property_user":return{query:v._d,variables:{where:{status:{_eq:"active"},Account_Locations:{accountId:{_eq:t},Account:{type:{_eq:"customer"},Account_Users:{role:{_eq:"user"},userId:{_eq:l}}},User_Account_Locations:{Account_User:{userId:{_eq:l},accountId:{_eq:t}}}}}}};case"sensor":return{query:v.UH,variables:{category:"sensor",locationId:c}};case"service":return{query:v.kx};case"sla":return{query:v.t1,variables:{type:"priority",adminId:t}};case"sublocation":return{query:v.zR,variables:{locationId:c}};case"supplier":var x={type:{_eq:"supplier"}};return n&&(x.PostcodeAreas={PostcodeArea:{area:{_eq:n}},entity:{_eq:"Account"},status:{_eq:"active"}}),s&&(x.ServiceSchedule={status:{_eq:"active"},entity:{_eq:"Supplier"},serviceId:{_eq:s}},n&&(x.ServiceSchedule.PostcodeAreas={PostcodeArea:{area:{_eq:n}}})),{query:v.by,variables:{where:x}};case"user":return{query:v.yR,variables:{accountId:t}};case"usersForBookings":return{query:v.yR,variables:{accountId:p}};case"tenant":return{query:v.RJ};case"taxonomyGroup":return{query:v.Cj,variables:{type:u}};case"expenseCategory":return{query:v.Ve};default:return{query:v.qd}}},_=(0,l.memo)(function(e){var t,n=e.AddForm,c=e.accountId,d=e.area,m=e.assetCategoryId,v=e.control,j=e.entity,I=e.entityId,_=e.errors,q=e.id,w=e.isClearable,A=e.isDisabled,k=e.label,P=e.locationId,L=e.name,R=e.serviceId,M=e.taxonomyGroupType,T=e.customerId,F=e.customerRole,O=e.type,$=e.userId,D=e.invoiceThreshold,N=e.quoteThreshold,H=(0,a.Z)(e,["AddForm","accountId","area","assetCategoryId","control","entity","entityId","errors","id","isClearable","isDisabled","label","locationId","name","serviceId","taxonomyGroupType","customerId","customerRole","type","userId","invoiceThreshold","quoteThreshold"]),U=(0,p.x)(),G=(0,l.useState)(!1),z=G[0],B=G[1],V=(0,l.useState)(),E=V[0],W=V[1],J=(0,l.useState)(!1),Y=J[0],X=J[1],K=(0,l.useContext)(h.Z),Q=(0,l.useContext)(f.Z).hasRole,ee=(0,l.useState)(!1),et=ee[0],en=ee[1];(0,l.useEffect)(function(){return en(!1),X(!1),function(){}},[c,m,j,I,P,R,O,T,F,$]);var er=(t=(0,r.Z)(function(){var e,t,n,r,a,u,l,p;return(0,s.__generator)(this,function(a){switch(a.label){case 0:if(Y)return en(!0),[2,null];return B(!0),t=(e=C({accountId:c,area:d,assetCategoryId:m,entity:j,entityId:I,hasRole:Q,id:q,locationId:P,serviceId:R,taxonomyGroupType:M,customerId:T,customerRole:F,type:O,userId:$,invoiceThreshold:D,quoteThreshold:N})).query,r=void 0===(n=e.variables)?{}:n,[4,U.query({query:t,variables:(0,o.Z)({},r)})];case 1:var s,l;return s=(void 0===(u=a.sent().data)?{items:[]}:u).items,p="asset"===(l=O)?s.map(function(e){return(0,i.Z)((0,o.Z)({},e),{label:"".concat(e.label," ").concat(e.sublocation?"- ".concat(e.sublocation.name):"")})}):s,W(p),B(!1),X(!0),en(!0),[2]}})}),function(){return t.apply(this,arguments)}),eo=function(){K.show({content:(0,u.jsx)("div",{children:(0,u.jsx)(n,{})}),title:"Add form"})};return(0,u.jsx)(g.Z,{id:L,label:k,children:(0,u.jsxs)(x.Z,{children:[(0,u.jsx)(Z.Z,{md:n?11:12,children:(0,u.jsx)(b.Z,(0,o.Z)({autoload:!1,blurInputOnSelect:!0,cacheOptions:!0,control:v,errors:_,isDisabled:A,isClearable:w,isLoading:z,menuIsOpen:et,options:E,onFocus:er,onBlur:function(){en(!1)},name:L,searchable:!0},H),H.defaultValue)}),n&&(0,u.jsx)(Z.Z,{md:1,children:(0,u.jsx)(S,{children:(0,u.jsx)(y.Z,{content:null,startIcon:"plus",size:"sm",onClick:eo})})})]})})},I),S=m.ZP.div.withConfig({displayName:"select__ButtonWrapper",componentId:"sc-f7921e38-0"})(j());_.propTypes={AddForm:d.object,area:d.string,accountId:d.number,assetCategoryId:d.number,control:d.object.isRequired,errors:d.object.isRequired,entity:d.string,entityId:d.number,id:d.number,isClearable:d.bool,label:d.string.isRequired,locationId:d.number,name:d.string.isRequired,serviceId:d.number,taxonomyGroupType:(0,d.oneOf)(["expenseCategory","costCategory","jobTags"]),type:d.string},_.defaultProps={isClearable:!0,label:"Account",name:"account",type:"account"}},45451:function(e,t,n){"use strict";n.d(t,{i:function(){return _}});var r=n(14924),o=n(26042),i=n(69396),a=n(85893),c=n(67294),s=n(11163),u=n(45697),l=n.n(u),d=n(61870),m=n(5616),p=n(51233),v=n(15861),h=n(90948),f=n(41796),g=n(29217),x=n(45111),Z=n(98209),b=n(70872),y=n(58886),j=n(61730),I=function(e){var t=e.currentPage,n=e.totalCount,r=e.pageSize,i=e.onPageChange,c=(0,j.Z)("(max-width:400px)"),s=(0,j.Z)("(max-width:500px)");return(0,a.jsx)(C,{mb:2,page:t,count:Math.ceil(n/r),onChange:function(e,t){return i(t)},variant:"outlined",shape:"rounded",size:c?"small":"medium",hidePrevButton:1===t,hideNextButton:t===Math.ceil(n/r),siblingCount:s?0:1,renderItem:function(e){return(0,a.jsx)(y.Z,(0,o.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},e))}})};I.defaultProps={currentPage:1,totalCount:0,pageSize:50,onPageChange:function(){}},I.propTypes={currentPage:l().number,totalCount:l().number,pageSize:l().number,onPageChange:l().func};var C=(0,h.ZP)(b.Z)(function(e){var t,n=e.hidePrevButton,i=e.hideNextButton,a=e.theme;return t={},(0,r.Z)(t,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,r.Z)(t,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,r.Z)(t,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,r.Z)(t,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,r.Z)(t,"& button.Mui-selected",(0,o.Z)({color:a.palette.white.main,backgroundColor:a.palette.secondary.main},i?{borderRadius:"0 5px 5px 0"}:{},n?{borderRadius:"5px 0 0 5px"}:{})),t}),_=(0,c.forwardRef)(function(e,t){var n=e.columns,r=e.history,i=e.initialSort,u=e.meta,l=e.refetch,d=e.paginationSize,m=e.containerHeight,h=e.containerMaxHeight,f=e.noResultsMessage,b=e.autoHeight,y=(0,s.useRouter)(),j=y.query,C=void 0===j?{}:j,_=(0,c.useState)(parseInt(null==C?void 0:C.page,10)||1),w=_[0],A=_[1],k=(0,c.useState)(d||Z.C1.paginationSize),P=k[0],L=k[1],R=i;R||(R={item:"createdAt",order:"desc"});var M=(0,c.useState)({item:R.item,order:R.order}),T=M[0],F=M[1],O=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=y.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var r=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(r)},$=function(){F({item:R.item,order:R.order}),A(1);var e=O();y.push(e),L(d||Z.C1.paginationSize)};(0,c.useImperativeHandle)(t,function(){return{currentPage:w,pageSize:P,sort:T,resetPagination:function(){$()}}});var D=function(e){var t=O(e);r&&y.push(t),A(e),!r&&l&&l()},N=function(e){e&&e.field&&e.sort?(F({item:n.find(function(t){return t.field===e.field}).sortName||e.field||e.item||R.item,order:e.sort||e.order||R.order}),l&&l()):(F({item:R.item,order:R.order}),l&&l())};return(0,a.jsxs)(S,{containerHeight:m,containerMaxHeight:h,children:[(0,a.jsx)(q,(0,o.Z)({hideFooter:!0,disableColumnMenu:!0,disableSelectionOnClick:!0,autoHeight:b,sortingMode:"server",onSortModelChange:function(e){return N(e[0])},columns:n,pageSize:P,slots:{columnSortedAscendingIcon:function(){return(0,a.jsx)(g.Z,{})},columnSortedDescendingIcon:function(){return(0,a.jsx)(x.Z,{})},columnUnsortedIcon:function(){return(0,a.jsxs)(p.Z,{alignItems:"center",sx:{width:"33px"},children:[(0,a.jsx)(g.Z,{sx:{marginBottom:"-15px"}}),(0,a.jsx)(x.Z,{})]})},noResultsOverlay:function(){return(0,a.jsx)(p.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(v.Z,{children:f})})},noRowsOverlay:function(){return(0,a.jsx)(p.Z,{height:"100%",alignItems:"center",justifyContent:"center",spacing:1,p:1,children:(0,a.jsx)(v.Z,{children:f})})}}},e)),u&&Math.ceil(u.aggregate.totalCount/P)>1&&(0,a.jsx)(I,{currentPage:w,totalCount:u.aggregate.totalCount,pageSize:P,onPageChange:D})]})});_.propTypes={history:l().bool,initialSort:l().object,loading:l().bool,meta:l().object,refetch:l().func,paginationSize:l().number,noResultsMessage:l().string,columns:l().array.isRequired,rows:l().array.isRequired,autoHeight:l().bool},_.defaultProps={columns:[],history:!1,loading:!1,rows:[],noResultsMessage:"There are no results.",autoHeight:!0};var S=(0,h.ZP)(m.Z)(function(e){var t;return{height:e.containerHeight,maxHeight:e.containerMaxHeight,display:"flex",flexDirection:"column"}}),q=(0,h.ZP)(d.s)(function(e){var t,n=e.theme,a=e.hideHeader,c=(e.rows,e.loading,e.rowHeight),s=e.isPdf;return t={"--DataGrid-overlayHeight":"40px"},(0,r.Z)(t,"&.MuiDataGrid-root",(0,o.Z)({color:n.palette.black.main,border:"none"},s&&{"@media print":{display:"block"}})),(0,r.Z)(t,"& .MuiDataGrid-main",(0,o.Z)({},s&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(t,"& .MuiDataGrid-columnHeaders",(0,i.Z)((0,o.Z)({},a&&{display:"none"}),{"& .MuiDataGrid-iconButtonContainer":{visibility:"visible","& .MuiButtonBase-root.MuiIconButton-root":{backgroundColor:"inherit",color:n.palette.black.main,"&:hover":{backgroundColor:"rgba(0, 0, 0, 0.1)"}}}})),(0,r.Z)(t,"& .MuiDataGrid-virtualScroller",(0,o.Z)({},a&&{marginTop:"0 !important"},s&&{"@media print":{overflow:"visible !important"}})),(0,r.Z)(t,"& .MuiDataGrid-iconSeparator",{opacity:0}),(0,r.Z)(t,"& .MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(t,"& .MuiButtonBase-root.MuiDataGrid-columnHeaderTitle",{fontWeight:700}),(0,r.Z)(t,"& .MuiDataGrid-virtualScrollerContent",(0,o.Z)({},s&&{height:"initial !important",minHeight:"initial !important"})),(0,r.Z)(t,"& .MuiDataGrid-virtualScrollerRenderZone",(0,o.Z)({},s&&{position:"relative"})),(0,r.Z)(t,"& .MuiDataGrid-overlayWrapper",(0,r.Z)({},"& .MuiCircularProgress-root",{color:n.palette.secondary.main})),(0,r.Z)(t,"& .MuiDataGrid-row",(0,o.Z)({},s&&{minHeight:"".concat(c,"cm !important"),maxHeight:"".concat(c,"cm !important")})),(0,r.Z)(t,"& .MuiDataGrid-row > .MuiDataGrid-cell",(0,o.Z)({},s&&{minHeight:"".concat(c,"cm !important"),maxHeight:"".concat(c,"cm !important")})),(0,r.Z)(t,"& .MuiDataGrid-columnHeaderCheckbox",(0,r.Z)({},"& .MuiButtonBase-root.MuiCheckbox-root > .MuiSvgIcon-root",(0,r.Z)({color:n.palette.secondary.main},'&[data-testid="CheckBoxOutlineBlankIcon"]',{color:"currentColor"}))),(0,r.Z)(t,"& .MuiDataGrid-row > .MuiDataGrid-cellCheckbox",(0,r.Z)({},"& .MuiButtonBase-root.MuiCheckbox-root > .MuiSvgIcon-root",(0,r.Z)({color:n.palette.secondary.main},'&[data-testid="CheckBoxOutlineBlankIcon"]',{color:"currentColor"}))),(0,r.Z)(t,"& .MuiDataGrid-row.even",{backgroundColor:n.palette.muiLightGray.main,"&:hover, &.Mui-hovered":{backgroundColor:(0,f.Fq)(n.palette.muiLightGray.main,.3),"@media (hover: none)":{backgroundColor:"transparent"}},"&.Mui-selected":{backgroundColor:(0,f.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity),"&:hover, &.Mui-hovered":{backgroundColor:(0,f.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity+n.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:(0,f.Fq)(n.palette.muiLightGray.main,.3+n.palette.action.selectedOpacity)}}}}),t})},16605:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});var r=function(e,t){var n=document.createElement("a");"string"==typeof n.download?(document.body.appendChild(n),n.download=t,n.href=e,n.click(),document.body.removeChild(n)):location.replace(e)}},50108:function(e,t,n){"use strict";function r(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GBP";return new Intl.NumberFormat(["en-GB"],{currency:t,currencyDisplay:"symbol",style:"currency"}).format(e)}n.d(t,{T:function(){return r}})},59577:function(e,t,n){"use strict";n.d(t,{c:function(){return r}});var r=function(e){try{return JSON.parse(e)}catch(t){return!1}}},98521:function(e,t,n){"use strict";n.d(t,{O:function(){return r},v:function(){return o}});var r=[{text:"Country",value:""},{text:"United Kingdom",value:1},{text:"Ireland",value:4}],o=[{label:"United Kingdom",value:1},{label:"Ireland",value:4}]},15897:function(e,t,n){"use strict";n.d(t,{bg:function(){return r}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},68550:function(e,t,n){"use strict";n.d(t,{V:function(){return es}});var r=n(26042),o=n(828),i=n(85893),a=n(67294),c=n(45697),s=n(30381),u=n.n(s),l=n(11163),d=n.n(l),m=n(57460),p=n.n(m),v=n(6812),h=n(73359),f=n(7297),g=n(75063);function x(){var e=(0,f.Z)(['\n  query GetLocations(\n    $accountId: Int\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: Location_order_by!\n  ) {\n    properties: Location(\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      id\n      access\n      contactUserId\n      createdAt\n      name\n      status\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n      customer: Account_Locations {\n        id\n        account: Account {\n          id\n          name\n        }\n      }\n      bookings: Jobs(\n        where: { Invoices: { invoiceType: { _in: ["customerVat", "ProformaInvoiceCustomer"] } } }\n      ) {\n        id\n      }\n      user: User {\n        id\n        fullName\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n        _or: [\n          { name: { _ilike: $q } }\n          { Addresses: { Address: { city: { _ilike: $q } }, entity: { _eq: "Location" } } }\n          { Addresses: { Address: { postCode: { _ilike: $q } }, entity: { _eq: "Location" } } }\n        ]\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return x=function(){return e},e}var Z=(0,g.Ps)(x()),b=n(90629),y=n(15861),j=n(98456),I=n(51233),C=n(11057),_=n(93946),S=n(5616),q=n(61730),w=n(2548),A=n(81261),k=n(14924),P=n(69396),L=n(96486),R=n(98209),M=n(59577),T=function(e){var t,n,o,i,c,s,u,l,d,m,p,v=e.filters,h=e.newFilters,f=e.initialSort,g=(0,a.useRef)(),x=(0,a.useState)({}),Z=x[0],b=x[1],y=(0,a.useState)({}),j=y[0],I=y[1],C=f||{item:"createdAt",order:"desc"},_=(0,k.Z)({},(null===(t=g.current)||void 0===t?void 0:t.sort.item)||C.item,C.inneritem?(0,k.Z)({},C.inneritem,(null===(n=g.current)||void 0===n?void 0:n.sort.order)||C.order):(null===(o=g.current)||void 0===o?void 0:o.sort.order)||C.order);return(0,a.useEffect)(function(){var e=!(0,L.isEqual)(Z,v),t=!(0,L.isEqual)(j,h);if(e&&(b(v),null==g||null===(r=g.current)||void 0===r||r.resetPagination()),t&&(I(h),null==g||null===(o=g.current)||void 0===o||o.resetPagination()),(null==g?void 0:null===(n=g.current)||void 0===n?void 0:n.setSort)&&!(e||t)){var n,r,o,i,a,c,s,u,l,d,m,p=(null===(i=g.current)||void 0===i?void 0:null===(a=i.sort)||void 0===a?void 0:a.item)&&(null===(c=g.current)||void 0===c?void 0:null===(s=c.sort)||void 0===s?void 0:s.order)?{item:null===(u=g.current)||void 0===u?void 0:null===(l=u.sort)||void 0===l?void 0:l.item,order:null===(d=g.current)||void 0===d?void 0:null===(m=d.sort)||void 0===m?void 0:m.order}:_;g.current.setSort(p)}},[v,h]),{initialData:(0,P.Z)((0,r.Z)({},v),{newFilters:(null==h?void 0:h.length)>0?h:void 0,limit:(null===(i=g.current)||void 0===i?void 0:i.pageSize)==="Infinity"?null:parseInt(null===(c=g.current)||void 0===c?void 0:c.pageSize,10)||R.C1.paginationSize,offset:((null===(s=g.current)||void 0===s?void 0:s.currentPage)-1||0)*((null===(u=g.current)||void 0===u?void 0:u.pageSize)||R.C1.paginationSize),orderBy:(0,M.c)(null===(l=g.current)||void 0===l?void 0:null===(d=l.sort)||void 0===d?void 0:null===(m=d.item)||void 0===m?void 0:m.replace(/ORDER/i,null===(p=g.current)||void 0===p?void 0:p.sort.order))||_}),initialSort:f,ref:g}},F=n(74492),O=n(35374),$=n(16605),D=n(78067),N=n(83162),H=n(50108),U=n(42283),G=n(11994),z=n(90948),B=n(50135),V=n(82670),E=n(50319),W=n(53767);function J(){var e=(0,f.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]);return J=function(){return e},e}function Y(){var e=(0,f.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"]);return Y=function(){return e},e}var X=(0,g.Ps)(J()),K=(0,g.Ps)(Y()),Q=n(57493),ee=n(18531),et=C.Z,en=function(e){var t=e.initialFilters,n=e.filters,c=e.setFilters,s=e.open,u=e.onClose,d=(0,l.useRouter)().query,m=(0,q.Z)("(max-width: 400px)"),p=(0,a.useMemo)(function(){return(null==d?void 0:d.tab)==="locations"},[d]),f=(0,o.Z)(function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",r=(0,W.q)().user,i=(0,a.useState)(function(){try{switch(n){case"network":case"state":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||t}}catch(r){return t}}),c=i[0],s=i[1],u=function(t){try{var o=(0,V.Z)(t,Function)?t(c):t;switch(s(o),n){case"network":l({variables:{accountUserId:null==r?void 0:r.accountUserId,filters:(0,k.Z)({},e,o)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(o))}}catch(i){}};(0,v.a)(X,{variables:{accountUserId:null==r?void 0:r.accountUserId},skip:"network"!==n,onCompleted:function(n){var r=n.accountUser;r&&s(r.filters[e]||t)}});var l=(0,o.Z)((0,E.D)(K),1)[0];return[c,u]}("form_data_".concat(t.filterType).concat(p?"_".concat(t.accountId):""),t),2),g=f[0],x=f[1],Z=(0,a.useState)(),y=Z[0],j=Z[1],C=(0,U.cI)({defaultValues:g}),_=C.control,S=C.handleSubmit,w=C.register,A=C.reset,L=C.errors,R=(0,o.Z)((0,h.t)(Q.SW,{variables:{where:{name:{_ilike:""!==y?"%".concat(y,"%"):null}}}}),2),M=R[0],T=R[1],F=T.loading,O=T.data,$=(void 0===O?{items:[]}:O).items,D=function(){c(t),A(),u(),x((0,P.Z)((0,r.Z)({},t),{filterType:t.filterType}))},N=function(e){var o,i=(0,P.Z)((0,r.Z)({},n,e),{accountId:p?t.accountId:null===(o=e.customer)||void 0===o?void 0:o.value,q:e.q});c((0,P.Z)((0,r.Z)({},i),{q:e.q?"%".concat(e.q,"%"):null})),x((0,P.Z)((0,r.Z)({},i),{customer:p?null:e.customer,filterType:t.filterType})),A(),u()};return(0,i.jsx)(er,{open:s,onClose:u,children:(0,i.jsx)(b.Z,{sx:{minWidth:m?"300px":"400px",padding:"20px 40px"},children:(0,i.jsxs)("form",{onSubmit:S(N),children:[(0,i.jsxs)(I.Z,{spacing:p?8:4,children:[(0,i.jsx)(B.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search...",name:"q",inputRef:w}),!p&&(0,i.jsx)(U.Qr,{name:"customer",control:_,render:function(e){var t,n=e.value,r=e.onChange;return(0,i.jsx)(ee.q,{limitTags:6,color:"secondary",value:n,onChange:function(e,t){return r(t)},label:"Select customer",loading:F,onOpen:function(){return M()},options:$,setSearch:j,textFieldProps:{label:"Select customer",variant:"standard",color:"secondary",error:L.customer,helperText:null===(t=L.customer)||void 0===t?void 0:t.message}})}})]}),(0,i.jsxs)(I.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,sx:{margin:"20px 0"},children:[(0,i.jsx)(et,{variant:"contained",color:"danger",onClick:function(){return D()},children:"Cancel"}),(0,i.jsx)(et,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})},er=(0,z.ZP)(G.Z)(function(){return{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}});en.propTypes={open:c.bool,onClose:c.func,initialFilters:c.object,setFilters:c.func.isRequired};var eo=n(34187),ei=n(45451),ea=C.Z,ec=function(e){return u()(e).format("YYYY-MM-DD")},es=function(e){var t,n=e.accountId,c=e.accountName,s=e.initialFilters,u=e.columnVisibilityModel,l=e.tableContainerHeight,m=(0,a.useState)(!1),f=m[0],g=m[1],x=(0,a.useState)(!1),C=x[0],k=x[1],P=(0,a.useState)((0,r.Z)({},s)),L=P[0],R=P[1],M=T({filters:L}),U=M.initialData,G=M.ref,z=(0,F.a)(),B=(0,q.Z)("(max-width: 400px)"),V=(0,O.s)(),E=(0,v.a)(Z,{variables:U}),W=E.data,J=void 0===W?{properties:[],meta:{aggregate:{totalCount:0}}}:W,Y=J.properties,X=J.meta,K=E.loading,Q=E.refetch,ee=(0,o.Z)((0,h.t)(Z,{fetchPolicy:"no-cache",variables:{accountId:U.accountId,q:U.q,orderBy:U.orderBy},onCompleted:function(e){try{var t=p().unparse(eu(e.properties)),n="data:application/octet-stream,"+encodeURIComponent(t);(0,$.S)(n,"locations.csv")}finally{k(!1)}}}),1)[0],et=function(e){e.stopPropagation(),k(!0),ee()},er=(0,a.useCallback)(function(e,t){e.stopPropagation(),z.show({content:(0,i.jsx)(D.m,{accountId:n,accountName:c,data:null==t?void 0:t.data,entity:"Location",refetch:Q}),title:(null==t?void 0:t.data)?"Edit location":"Create location"})},[z,n,c,Q]),es=function(e){var t=e.row;d().push("".concat("/dashboard/properties/","view?id=").concat(t.data.id,"&tab=details"))},eu=function(e){return e.map(function(e){var t,n,r=null===(t=null==e?void 0:e.addresses[0])||void 0===t?void 0:t.address;return{name:e.name||"Not Specified",customer:e.customer[0].account.name,address:r?"".concat(r.addressLine1," - ").concat(r.postCode):"",bookings:null===(n=e.bookings)||void 0===n?void 0:n.length,totalSpent:(0,H.T)(0),createdAt:ec(e.createdAt)}})},el=(0,a.useCallback)(function(){return Y.map(function(e){var t,n,r,o;return{id:e.id,data:e,name:e.name||"Not Specified",address:(null===(t=e.addresses[0])||void 0===t?void 0:t.address)?"\n            ".concat(null===(n=e.addresses[0])||void 0===n?void 0:n.address.addressLine1," -\n            ").concat(null===(r=e.addresses[0])||void 0===r?void 0:r.address.postCode):"Please Add",customer:e.customer[0].account.name,customerId:e.customer[0].account.id,workOrders:null===(o=e.bookings)||void 0===o?void 0:o.length,totalSpent:(0,H.T)(0),createdAt:ec(e.createdAt),status:e.status,actions:""}})},[Y]),ed=(0,a.useMemo)(function(){var e={};return!el().length&&(null==U?void 0:U.q)?{title:"No results",subtitleFirstLine:"The filters you have applied have returned no results",subtitleSecondLine:"Please amend and try again if necessary."}:{title:"No locations",subtitleFirstLine:"You currently have no locations set up in the system",subtitleSecondLine:"Click\xa0create location\xa0to get started building.",buttonText:"Create location",onAction:er}},[er,null==U?void 0:U.q,el]),em=(0,r.Z)({},u);return(0,i.jsxs)(i.Fragment,{children:[f&&(0,i.jsx)(en,{initialFilters:s,open:f,filters:L,setFilters:R,onClose:function(){return g(!1)}}),(0,i.jsxs)(I.Z,{width:"100%",spacing:2,sx:{height:"100%"},children:[(0,i.jsxs)(I.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,i.jsx)(ea,{variant:"contained",startIcon:(0,i.jsx)(A.Z,{}),onClick:function(){return g(!0)},children:"Filters"}),(0,i.jsxs)(I.Z,{direction:"row",spacing:2,children:[(0,i.jsx)(ea,{variant:"contained",color:"secondary",onClick:er,children:"Create Location"}),!V&&(0,i.jsx)(ea,{startIcon:!C&&(0,i.jsx)("img",{src:"/static/icons/csv.svg"}),disabled:C,variant:"contained",color:"success",onClick:et,children:C?(0,i.jsx)(j.Z,{size:20,color:"secondary"}):"Export"})]})]}),(0,i.jsxs)(b.Z,{sx:{padding:"16px 0px",height:l},children:[(0,i.jsx)(y.Z,{ml:2,variant:"h5",sx:{fontWeight:600,marginBottom:"15px"},children:"Locations"}),(null===(t=el())||void 0===t?void 0:t.length)?(0,i.jsx)(ei.i,{ref:G,loading:K,columns:[{headerName:"Name",field:"name",minWidth:370,flex:1},{headerName:"Address",field:"address",minWidth:300,flex:1,sortable:!1},{headerName:"Customer",field:"customer",sortable:!1,flex:1,minWidth:B?100:"auto",renderCell:function(e){var t=e.row,n=t.customer,r=t.customerId;return(0,i.jsx)(N.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(r),children:n})}},{headerName:"Work Orders",field:"workOrders",sortable:!1,minWidth:B?100:"auto",renderCell:function(e){var t=e.row.workOrders;return(0,i.jsx)(S.Z,{sx:{marginLeft:"3em"},children:t})},flex:1},{headerName:"Total Spent",field:"totalSpent",sortable:!1,minWidth:B?140:"auto",renderCell:function(e){var t=e.row.totalSpent;return(0,i.jsx)(S.Z,{sx:{marginLeft:"1.5em"},children:t})},flex:1},{field:"createdAt",headerName:"Created At",minWidth:B?200:"auto",flex:1,sortable:!0},{field:"actions",headerName:"Actions",sortable:!1,minWidth:B?80:"auto",renderCell:function(e){var t=e.row;return(0,i.jsx)(_.Z,{sx:{marginLeft:"1em"},onClick:function(){return es({row:t})},children:(0,i.jsx)(w.Z,{})})},flex:1}],rows:el(),columnVisibilityModel:em,meta:X,refetch:Q,autoHeight:!1,containerHeight:"calc(100% - 52px)",onRowClick:es}):!K&&(0,i.jsx)(eo.C,(0,r.Z)({imageSrc:"/static/icons/no_locations_found.svg"},ed))]})]})]})};es.propTypes={accountId:c.number,accountName:c.string,initialFilters:c.object,columnVisibilityModel:c.object,tableContainerHeight:c.string},es.defaultProps={columnVisibilityModel:{},tableContainerHeight:"calc(100% - 52px)"}},78067:function(e,t,n){"use strict";n.d(t,{m:function(){return X}});var r=n(47568),o=n(26042),i=n(69396),a=n(828),c=n(97582),s=n(85893),u=n(67294),l=n(45697),d=n(6812),m=n(50319),p=n(11163),v=n.n(p),h=n(42283),f=n(79665),g=n(76600),x=n(15214),Z=n(9270),b=n(62140),y=n(49501),j=n(55563),I=n(6710),C=n(95103),_=n(84043),S=n(11057),q=n(69368),w=n(50480),A=n(6054),k=n(536),P=function(e){var t=e.accountId,n=e.accountName,r=e.canSelectAccount,a=e.control,c=e.errors,l=e.setValue,d=e.watch,m=t?{value:t,label:n}:d("propertyOwner"),p=(0,A.Z)(m),v=function(e){l("contactUser",null)};(0,u.useEffect)(function(){m!==p&&p&&v(m)},[m]);var h={control:a,errors:c};return(0,s.jsxs)(Z.Z,{children:[(0,s.jsx)(b.Z,{md:6,children:(0,s.jsx)(k.P,(0,i.Z)((0,o.Z)({},h),{defaultValue:t&&{value:t,label:n},errors:(0,o.Z)({},c),isDisabled:!r,label:"Client",name:"propertyOwner",placeholder:"Select",type:"customer"}))}),(0,s.jsx)(b.Z,{md:6,children:(0,s.jsx)(k.P,(0,i.Z)((0,o.Z)({},h),{accountId:(null==m?void 0:m.value)||null,errors:(0,o.Z)({},c),isDisabled:!m,label:"Contact Name",name:"contactUser",placeholder:m?"Select":"Select the location owner",type:"user"}))})]})};P.propTypes={accountId:l.number,accountName:l.string,canSelectAccount:l.bool.isRequired,control:l.func.isRequired,errors:l.object.isRequired,setValue:l.func.isRequired,watch:l.func.isRequired};var L=n(53600),R=function(e,t){var n=e.propertyOwner,r=e.contactUser;return e.Account_Locations={data:{accountId:n.value}},delete e.propertyOwner,e.contactUserId=(null==r?void 0:r.value)||null,delete e.contactUser,t&&delete e.Account_Locations,e},M=function(e,t,n,r){var o={location:R(e,!0),locationId:t.locationId,accountId:t.accountId,newAccountId:t.newAccountId,hasChanged:t.hasChanged};r({variables:o})},T=n(16310),F=n(74492),O=n(74944),$=n(7297),D=n(75063);function N(){var e=(0,$.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"]);return N=function(){return e},e}function H(){var e=(0,$.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]);return H=function(){return e},e}function U(){var e=(0,$.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]);return U=function(){return e},e}function G(){var e=(0,$.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return G=function(){return e},e}var z=(0,D.Ps)(N()),B=(0,D.Ps)(H()),V=(0,D.Ps)(U()),E=(0,D.Ps)(G()),W=n(16951),J=n(15897),Y="/dashboard/properties/",X=function(e){var t,n,l,p,A=e.accountId,k=e.accountName,$=e.entity,D=e.data,N=e.refetch,H=e.onAddressCreated,U=e.isPropsComponent,G=e.initialValues,X=e.xeroContactId,K=e.displayXeroContacts,Q=e.xeroContacts,ee=e.displaySignin,et=e.handleXeroAuthorize,en=e.onClose,er=(0,F.a)(),eo=(0,O.x)().hasRole,ei=(0,u.useState)(!1),ea=ei[0],ec=ei[1],es=null==Q?void 0:Q.find(function(e){return e.value===X}),eu=(0,i.Z)((0,o.Z)({},D?(location.propertyOwner={label:D.customer[0].account.name,value:D.customer[0].account.id},location.contactUser=(null==D?void 0:D.user)&&D.customer[0].account.id&&{label:D.user.fullName,value:D.user.id},location.access=D.access,location.name=D.name,location.status=D.status,location.permitsRequired=D.permitsRequired,location):{},G),{xeroContact:es}),el=(0,h.cI)({defaultValues:eu,resolver:(0,f.S)((0,T.Ry)().shape({access:(0,T.Z_)().required(),contactUser:(0,T.Ry)().required(),name:(0,T.Z_)().required(),propertyOwner:(0,T.Ry)().required(),status:eo("admin")&&(0,T.Z_)().required(),permitsRequired:(0,T.O7)()}))}),ed=el.control,em=el.errors,ep=el.handleSubmit,ev=el.register,eh=el.setValue,ef=el.getValues,eg=el.watch,ex=(0,d.a)(z,{variables:{id:null==D?void 0:D.id},skip:!(null==D?void 0:D.id)}).data,eZ=(void 0===ex?{property:{}}:ex).property,eb=(l=(0,r.Z)(function(e){var t,n,r,i,a,s,u,l,d,m,p;return(0,c.__generator)(this,function(a){switch(a.label){case 0:var c,u;return t=e.addressFormData,n=e.outerFormData,r={Addresses:{data:{Address:{data:(0,o.Z)({},t)},entity:$}}},i=(0,o.Z)({},ef(),r,n),eo("customer")&&(i.status="active"),[4,eI({variables:{objects:[R(c=i)]}})];case 1:return p=void 0===(m=(void 0===(l=(void 0===(s=a.sent().data)?{}:s).insert_Location)?{}:l).returning)?{}:m,H&&H(p),er.close(),[2]}})}),function(e){return l.apply(this,arguments)}),ey=(p=(0,r.Z)(function(e){return(0,c.__generator)(this,function(t){return er.show({title:"Add new address",content:(0,s.jsx)(W.k,{onCancel:function(){},onSubmit:function(t){eb({addressFormData:t,outerFormData:e})},type:"text"}),submit:!1}),[2]})}),function(e){return p.apply(this,arguments)}),ej=(0,a.Z)((0,m.D)(B,{onCompleted:function(e){if(!U){var t=e.insert_Location.returning[0].id;er.close(),N?N():v().push("".concat(Y,"view?id=").concat(t))}}}),2),eI=ej[0],eC=ej[1].loading,e_=(0,a.Z)((0,m.D)(V,{onCompleted:function(e){var t=e.update_Location_by_pk.id;er.close(),N?N():v().push("".concat(Y,"view?id=").concat(t))}}),2),eS=e_[0],eq=e_[1].loading,ew=(0,a.Z)((0,m.D)(E),1)[0],eA=function(e){if(ec(!1),D){if("inactive"===e.status&&!(t=eZ.jobs).every(function(e){return!!(0,L.E)(e,["completed","closed"])})){ec(!0);return}e.xeroContact&&ew({variables:{id:null===(c=null==D?void 0:D.customer[0])||void 0===c?void 0:c.account.id,changes:{meta:(0,i.Z)((0,o.Z)({},null===(s=null==D?void 0:D.customer[0])||void 0===s?void 0:s.account.meta),{xeroContactId:e.xeroContact.value})}}});var t,n,r,a,c,s,u={locationId:null==D?void 0:D.id,accountId:null===(n=null==D?void 0:D.customer[0])||void 0===n?void 0:n.account.id,newAccountId:null==e?void 0:null===(r=e.propertyOwner)||void 0===r?void 0:r.value,hasChanged:(null===(a=null==D?void 0:D.customer[0])||void 0===a?void 0:a.account.id)!==(null==e?void 0:e.propertyOwner.value)};M((0,i.Z)((0,o.Z)({},e),{xeroContact:void 0}),u,D.id,eS),en&&en()}else ey(e),en&&en()},ek={control:ed,errors:em,register:ev};return(0,s.jsxs)(g.Z,{disabled:eC||eq,id:"offCanvasForm",handleSubmit:ep(eA),children:[ea&&(0,s.jsx)(x.Z,{context:"info",content:" This location cannot be made inactive, it has active jobs."}),(0,s.jsx)(Z.Z,{children:(0,s.jsx)(b.Z,{md:12,children:(0,s.jsx)(P,(0,i.Z)((0,o.Z)({},ek),{accountId:A,accountName:k,canSelectAccount:!A,setValue:eh,watch:eg}))})}),(0,s.jsx)(y.Z,{label:"Name",children:(0,s.jsx)(j.Z,(0,i.Z)((0,o.Z)({},ek),{name:"name"}))}),(0,s.jsx)(y.Z,{label:"Access information",children:(0,s.jsx)(I.Z,(0,i.Z)((0,o.Z)({},ek),{name:"access",rows:4}))}),eo("admin")&&(0,s.jsx)(y.Z,{label:"Status",children:(0,s.jsx)(C.Z,(0,i.Z)((0,o.Z)({},ek),{name:"status",options:J.bg}))}),(0,s.jsx)(h.Qr,{name:"permitsRequired",control:ed,render:function(e){var t=e.value,n=e.onChange;return(0,s.jsx)(w.Z,{control:(0,s.jsx)(q.Z,{color:"secondary",checked:t||!1,onChange:function(e){return n(e.target.checked)}}),label:"Permits required"})}}),eo("admin")&&void 0!==K&&K&&(0,s.jsx)(y.Z,{label:"Xero Contact",children:ee?(0,s.jsx)(S.Z,{variant:"contained",onClick:function(){et()},children:"Connect to Xero to select Contact"}):(0,s.jsx)(_.Z,(0,i.Z)((0,o.Z)({options:Q},ek),{name:"xeroContact"}))})]})};P.propTypes={accountId:l.number,accountName:l.string,data:l.object,refetch:l.func,offCanvas:l.func}},8463:function(e,t,n){"use strict";n.r(t);var r=n(85893),o=n(68550),i=n(53767),a=n(74944),c=n(24716),s={accountId:null,q:null,filterType:"locations_table"},u=function(){var e=(0,i.q)().hasUserModule,t=(0,(0,a.x)().hasRole)("customer_user"),n=e("finances");return(0,r.jsx)(o.V,{initialFilters:s,columnVisibilityModel:{totalSpent:!t||n}})};u.getLayout=function(e){return(0,r.jsxs)(c.Z,{children:[e," "]})},t.default=u}},function(e){e.O(0,[3662,2283,212,8890,9511,2583,6310,4599,4135,8579,4244,7645,3776,2329,778,1023,1417,9957,1870,4043,5497,9777,4716,7493,9774,2888,179],function(){return e(e.s=5828)}),_N_E=e.O()}]);