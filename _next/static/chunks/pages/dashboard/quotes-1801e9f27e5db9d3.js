(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4064],{46586:function(n,e,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/quotes",function(){return t(8110)}])},17868:function(n,e,t){"use strict";t.d(e,{z:function(){return a}});var r=t(7297),i=t(75063);function o(){var n=(0,r.Z)(["\n  fragment AccountFields on Account {\n    id\n    type\n    name\n    status\n    vatId\n  }\n"]);return o=function(){return n},n}var a=(0,i.Ps)(o())},4595:function(n,e,t){"use strict";t.d(e,{F:function(){return Z}});var r=t(14924),i=t(26042),o=t(69396),a=t(85893),u=t(45697),s=t.n(u),d=t(10166),l=t(80482),c=t(23776),m=t(98456),p=t(16143),f=t(50135),v=t(99534),g=t(29815),h=t(74061),_=t(6498),I=t(75438),y=t(15861),$=t(61730),b=t(67294),q=(0,b.createContext)({}),x=(0,b.forwardRef)(function(n,e){var t=(0,b.useContext)(q);return(0,a.jsx)("div",(0,i.Z)({ref:e},n,t))}),S=(0,b.forwardRef)(function(n,e){var t=n.children,r=(0,v.Z)(n,["children"]),i=[];t.forEach(function(n){i.push(n),i.push.apply(i,(0,g.Z)(n.children||[]))});var o,u,s=(0,_.u)(),d=(0,$.Z)(s.breakpoints.up("sm"),{noSsr:!0}),l=i.length,c=d?36:48,m=function(n){return n.hasOwnProperty("group")?48:c},p=(u=(0,b.useRef)(null),(0,b.useEffect)(function(){null!=u.current&&u.current.resetAfterIndex(0,!0)},[l]),u);return(0,a.jsx)("div",{ref:e,children:(0,a.jsx)(q.Provider,{value:r,children:(0,a.jsx)(h.S_,{itemData:i,height:(l>8?8*c:i.map(m).reduce(function(n,e){return n+e},0))+16,width:"100%",ref:p,outerElementType:x,innerElementType:"ul",itemSize:function(n){return m(i[n])},overscanCount:5,itemCount:l,children:A})})})});function A(n){var e=n.data,t=n.index,r=n.style,u=e[t],s=(0,o.Z)((0,i.Z)({},r),{top:r.top+8});return u.hasOwnProperty("group")?(0,a.jsx)(I.Z,{component:"div",style:s,children:u.group},u.key):(0,a.jsx)(y.Z,(0,o.Z)((0,i.Z)({component:"li"},u[0]),{noWrap:!0,style:s,children:u[1].label}))}var Z=function(n){var e=n.label,t=n.loading,r=n.placeholder,u=n.error,s=n.helperText,d=n.inputProps;return(0,a.jsx)(w,(0,o.Z)((0,i.Z)({},n),{disableListWrap:!0,PopperComponent:j,ListboxComponent:S,renderInput:function(n){return(0,a.jsx)(f.Z,(0,o.Z)((0,i.Z)({},n,d),{error:u,helperText:s,label:e,placeholder:r,color:"secondary",variant:"standard",InputProps:(0,o.Z)((0,i.Z)({},n.InputProps,(null==d?void 0:d.InputProps)||{}),{endAdornment:(0,a.jsxs)(a.Fragment,{children:[t?(0,a.jsx)(m.Z,{color:"inherit",size:20}):null,n.InputProps.endAdornment]})})}))},renderOption:function(n,e,t){return[n,e,t.index]},renderGroup:function(n){return n}}))};Z.defaultProps={value:null,onChange:function(){},label:"",loading:!1,error:!1,onOpen:function(){},options:[],inputProps:{},withoutSelectIcon:!1},Z.propTypes={value:s().shape({value:s().any,label:s().string}),onChange:s().func,label:s().string,loading:s().bool,onOpen:s().func,options:s().arrayOf(s().shape({value:s().any,label:s().string})),inputProps:s().object,withoutSelectIcon:s().bool,inputValue:s().string,onInputChange:s().func};var j=(0,d.Z)(p.Z)((0,r.Z)({zIndex:"12000 !important"},"& .".concat(l.Z.listbox),{boxSizing:"border-box","& ul":{padding:0,margin:0}})),w=(0,d.Z)(c.Z)(function(n){var e=n.withoutSelectIcon;return{"& .MuiAutocomplete-root":{cursor:"pointer"},"& .MuiAutocomplete-popper":{zIndex:"12000 "},"& .MuiAutocomplete-endAdornment":{"& .MuiButtonBase-root.MuiIconButton-root.MuiAutocomplete-popupIndicator":{"& .MuiSvgIcon-root":(0,i.Z)({},e&&{display:"none"})}}}})},18531:function(n,e,t){"use strict";t.d(e,{q:function(){return f}});var r=t(26042),i=t(69396),o=t(99534),a=t(85893),u=t(87918),s=t(98456),d=t(23776),l=t(50135),c=t(67294),m=t(45697),p=t.n(m),f=function(n){var e=n.loading,t=n.setSearch,m=n.textFieldProps,p=(n.disableClearable,(0,o.Z)(n,["loading","setSearch","textFieldProps","disableClearable"])),f=(0,c.useState)(""),v=f[0],g=f[1];return(0,c.useEffect)(function(){var n=setTimeout(function(){t(v)},500);return function(){return clearTimeout(n)}},[v,t]),(0,a.jsx)(d.Z,(0,i.Z)((0,r.Z)({isOptionEqualToValue:function(n,e){return n.value===e.value}},p),{loading:e,onInputChange:function(n,e){g(e)},getOptionLabel:function(n){return"".concat(n.label)},renderTags:function(n,e){return n.map(function(n,t){return(0,a.jsx)(u.Z,(0,r.Z)({size:"small",label:n.label},e({index:t})))})},renderInput:function(n){return(0,a.jsx)(l.Z,(0,i.Z)((0,r.Z)({},n,m),{InputProps:(0,i.Z)((0,r.Z)({},n.InputProps,m.InputProps||{}),{endAdornment:(0,a.jsxs)(a.Fragment,{children:[e?(0,a.jsx)(s.Z,{color:"inherit",size:20}):null,n.InputProps.endAdornment]})})}))}}))};f.defaultProps={color:"secondary",onChange:function(){},options:[],onOpen:function(){},setSearch:function(){},textFieldProps:{}},f.propTypes={multiple:p().bool,limitTags:p().number,filterSelectedOptions:p().bool,color:p().string,loading:p().bool,value:p().oneOf([p().array,p().object]),onChange:p().func,options:p().arrayOf(p().shape({value:p().any.isRequired,label:p().string.isRequired})).isRequired,onOpen:p().func,setSearch:p().func,textFieldProps:p().shape({label:p().string,variant:p().oneOf(["standard"]),color:p().string,error:p().bool,helperText:p().string})}},20725:function(n,e,t){"use strict";t.d(e,{H_:function(){return h},aL:function(){return f},pf:function(){return v},sW:function(){return y},wd:function(){return g},xY:function(){return _},yT:function(){return I}});var r=t(7297),i=t(75063),o=t(22666);function a(){var n=(0,r.Z)(["\n  fragment JobFields on Job {\n    access\n    issueReportedDescription\n    adminId\n    costCategory\n    createdAt\n    description\n    id\n    meta\n    pricing\n    reference\n    scheduledAt\n    status\n    supplierLabourAmount\n    supplierMaterialsAmount\n    timing\n    timingEnd\n    timingNormalHours\n    timingStart\n    title\n    type\n    siteVisitStart\n    siteVisitEnd\n    siteVisitWeekends\n    amount\n    number\n    quoted\n    timingStatus\n    correctDuration\n    correctStart\n    correctEnd\n  }\n"]);return a=function(){return n},n}function u(){var n=(0,r.Z)(["\n  fragment JobQuoteFields on Job {\n    quoted\n    quoteNumber\n    quoteDue\n    quoteDueSupplier\n    quoteCharge\n  }\n"]);return u=function(){return n},n}function s(){var n=(0,r.Z)(["\n  fragment JobAdminFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]);return s=function(){return n},n}function d(){var n=(0,r.Z)(["\n  fragment JobSupplierFields on Job {\n    supplierId\n    supplierUserId\n  }\n"]);return d=function(){return n},n}function l(){var n=(0,r.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n    $_append: Job_append_input = {}\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes, _append: $_append) {\n      id\n    }\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return l=function(){return n},n}function c(){var n=(0,r.Z)(["\n  mutation InsertJobTiming($timing: [JobTiming_insert_input!]!) {\n    insert_JobTiming(objects: $timing) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return c=function(){return n},n}function m(){var n=(0,r.Z)(['\n  query GetJobHistory(\n    $jobId: Int\n    $locationId: Int!\n    $limit: Int\n    $offset: Int\n    $serviceId: Int\n    $startDate: timestamptz!\n  ) {\n    jobs: Job(\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      id\n      title\n      status\n      scheduledAt\n      createdAt\n      meta\n      service: Service {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        createdAt: { _gte: $startDate }\n        id: { _neq: $jobId }\n        locationId: { _eq: $locationId }\n        serviceId: { _eq: $serviceId }\n        status: { _nin: ["pending", "raised", "offered", "accepted", "inProgress"] }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return m=function(){return n},n}function p(){var n=(0,r.Z)(['\n  query GetJobOffCanvas($jobId: Int!) {\n    job: Job_by_pk(id: $jobId) {\n      access\n      costCategory\n      customerSpendThreshold\n      description\n      supplierLabourAmount\n      supplierMaterialsAmount\n      quoteDue\n      quoteNumber\n      id\n      number\n      meta\n      paymentMethod\n      reference\n      status\n      title\n      type\n      quoted\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n      }\n      quotations: SupplierQuotes {\n        id\n        quoteNumber\n        status\n        lineItems: SupplierQuoteLineItems {\n          id\n          description\n          item\n          qty\n          qtyUnit\n          quoteId\n          total\n          type\n          unitRate\n          supplierTotal\n        }\n        supplier: Supplier {\n          id\n          type\n          name\n          accountUsers: Account_Users {\n            user: User {\n              id\n              fullName\n              nameFirst\n              nameLast\n              phone\n              email\n              devices: UserDevices(where: { status: { _eq: "active" } }) {\n                id\n                playerId\n              }\n            }\n          }\n        }\n      }\n      admin: Admin {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n      manager: Manager {\n        id\n        nameFirst\n        nameLast\n      }\n      customer: Customer {\n        id\n        name\n        website\n        slas: SLAs(where: { entity: { _eq: "Account" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        nameFirst\n        nameLast\n        fullName\n        email\n        phone\n      }\n      supplier: Supplier {\n        id\n        name\n        contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n          id\n          role\n          position\n          isContact\n          lastSignInAt\n          userId\n          user: User {\n            id\n            fullName\n            nameFirst\n            nameLast\n            email\n            phone\n          }\n        }\n      }\n      supplierUser: SupplierUser {\n        id\n        fullName\n        nameFirst\n        nameLast\n        email\n        phone\n      }\n      location: Location {\n        id\n        name\n        addresses: Addresses(where: { entity: { _eq: "Location" } }) {\n          ...AddressEntityFields\n          address: Address {\n            ...AddressFields\n            country: Country {\n              id\n              name\n            }\n          }\n        }\n        slas: SLAs(where: { entity: { _eq: "Location" } }) {\n          id\n          entity\n          entityId\n          onSite\n          onSiteUnit\n          jobReport\n          jobReportUnit\n          completion\n          completionUnit\n          notes\n          inUse\n          normalRate\n          oohRate\n          premiumRate\n          minimumInterval\n          minimumLength\n          slaId\n          sla: SLA {\n            id\n            name\n            notes\n            normalRate\n            oohRate\n            premiumRate\n            onSite\n            onSiteUnit\n            jobReport\n            jobReportUnit\n            completion\n            completionUnit\n            minimumInterval\n            minimumLength\n          }\n        }\n      }\n      sla: SLA {\n        id\n        name\n        notes\n        normalRate\n        oohRate\n        premiumRate\n        onSite\n        onSiteUnit\n        jobReport\n        jobReportUnit\n        completion\n        completionUnit\n        minimumInterval\n        minimumLength\n      }\n      costCategoryTaxonomy: CostCategory {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n  ',"\n  ","\n"]);return p=function(){return n},n}var f=(0,i.Ps)(a()),v=(0,i.Ps)(u()),g=(0,i.Ps)(s()),h=(0,i.Ps)(d()),_=(0,i.Ps)(l()),I=(0,i.Ps)(c()),y=(0,i.Ps)(m());(0,i.Ps)(p(),o.WW,o.MR)},40577:function(n,e,t){"use strict";t.d(e,{w:function(){return v},L:function(){return f}});var r=t(7297),i=t(75063),o=t(17868),a=t(20725),u=t(22666);function s(){var n=(0,r.Z)(["\n  fragment QuoteFields on Job {\n    quoteNumber\n    quoteDue\n    quoteCharge\n  }\n"]);return s=function(){return n},n}function d(){var n=(0,r.Z)(["\n  query Quote($id: Int!) {\n    job: Job_by_pk(id: $id) {\n      id\n      title\n      description\n      costCategory\n      status\n      workStatus\n      scheduledAt\n      createdAt\n      customerId\n      customerUserId\n      locationId\n      managerId\n      parentId\n      serviceId\n      slaId\n      tenantId\n      reference\n      amount\n      accountByTenantid {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      customer: Account {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        vat\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n      }\n      messages: Messages {\n        id\n        message\n        priority\n        taskId\n        jobId\n        locationId\n        description\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n      }\n      supplier: Suplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      manager: Manager {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return d=function(){return n},n}var l=(0,i.Ps)(s());(0,i.Ps)(d());var c=t(94885);function m(){var n=(0,r.Z)(["\n  query GetQuotes(\n    $endDate: timestamptz\n    $limit: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $type: String\n  ) {\n    quotes: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n      }\n      order_by: [$orderBy]\n    ) {\n      ...JobFields\n      ...JobSupplierFields\n      ...QuoteFields\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n      timings: JobTimings {\n        id\n        status\n        notes\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return m=function(){return n},n}function p(){var n=(0,r.Z)(["\n  query GetQuotes(\n    $customerId: Int\n    $date: timestamptz\n    $endDate: timestamptz\n    $limit: Int\n    $locationId: Int\n    $managerId: Int\n    $customerManagerId: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $supplierId: Int\n    $type: String\n    $userId: Int\n    $slaId: [Int!]\n  ) {\n    quotes: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        ",'\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        type: { _eq: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        slaId: {_in: $slaId}\n        managerId: { _eq: $managerId }\n        Customer: { managerId: { _eq: $customerManagerId } }\n        supplierId: { _eq: $supplierId }\n        quoted: { _eq: true }\n        customerUserId: { _eq: $userId }\n      }\n      order_by: [$orderBy]\n    ) {\n      ...JobFields\n      ...JobAdminFields\n      ...QuoteFields\n      statusLog\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n        lineItems: SupplierQuoteLineItems {\n          id\n          qty\n          total\n        }\n      }\n      supplier: Supplier {\n        ...AccountFields\n      }\n      admin: Admin {\n        id\n        name\n      }\n      customer: Customer {\n        ...AccountFields\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      manager: Manager {\n        ...UserFields\n      }\n      service: Service {\n        id\n        name\n      }\n      timings: JobTimings {\n        id\n        status\n        notes\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: {\n            _and: [\n              {status: { _eq: "active" }}\n              {type: { _eq: "tags" }}\n            ]\n          }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        ',"\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        slaId: {_in: $slaId}\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        Customer: { managerId: { _eq: $customerManagerId } }\n        supplierId: { _eq: $supplierId }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n        customerUserId: { _eq: $userId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return p=function(){return n},n}var f=(0,i.Ps)(m(),o.z,a.aL,l,a.H_,c.Px),v=function(n){var e=n.tagsWhere;return(0,i.Ps)(p(),e,e,o.z,u.WW,a.aL,a.wd,l,c.Px)}},72530:function(n,e,t){"use strict";var r=t(7297),i=t(75063),o=t(17868),a=t(20725),u=t(22666),s=t(94885);function d(){var n=(0,r.Z)(["\n  query GetDashboardList(\n    $accountId: Int\n    $adminId: Int\n    $customerId: Int\n    $supplierId: Int\n    $locationId: Int\n    $managerId: Int\n    $number: String\n    $asAt: timestamptz\n    $jobHoldReasonId: Int\n    $limit: Int\n    $monthStart: timestamptz\n    $offset: Int\n    $orderBy: dashboard_home_details_order_by!\n    $q: String\n    $tileName: String\n    $dayStart: timestamptz\n    $userId: Int\n    $status: [String!]\n    $yearStart: timestamptz\n    $type: String\n  ) {\n    quotes: getDashboard_HomeTile_Details(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n        locationId: $locationId\n        managerId: $managerId\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { number: { _eq: $number } }\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        ",'\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        status: { _in: $status }\n        Job: { type: { _eq: $type } }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n      }\n      order_by: [$orderBy]\n      limit: $limit\n      offset: $offset\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n        __typename\n      }\n      ...JobFields\n      ...JobAdminFields\n      admin: Admin {\n        id\n        name\n        __typename\n      }\n      customer: Customer {\n        ...AccountFields\n        __typename\n      }\n      location: Location {\n        id\n        name\n        __typename\n      }\n      manager: Manager {\n        ...UserFields\n        __typename\n      }\n      service: Service {\n        id\n        name\n        __typename\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n          __typename\n        }\n        __typename\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: {\n            _and: [\n              {status: { _eq: "active" }}\n              {type: { _eq: "tags" }}\n            ]\n          }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n      sla: SLA {\n        id\n        name\n        __typename\n      }\n      supplier: Supplier {\n        ...AccountFields\n        __typename\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n          __typename\n        }\n        __typename\n      }\n      job: Job {\n        type\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n          __typename\n        }\n        __typename\n      }\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      id: jobId\n      number\n      # location\n      priority\n      scheduledAt\n      assignedTo\n      jobHoldReason\n      locationId\n      meta\n      managerId\n      description\n      customerName\n      customerId\n      reference\n      serviceName\n      status\n      supplierId\n      supplierName\n      timingStart\n      type\n      quoteNumber\n      quoteDue\n      createdAt\n    }\n    meta: getDashboard_HomeTile_Details_aggregate(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        ',"\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        number: { _eq: $number }\n        status: { _in: $status }\n        Job: { type: { _eq: $type } }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n        __typename\n      }\n      __typename\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return d=function(){return n},n}var l=function(n){var e=n.tagsWhere;return(0,i.Ps)(d(),e,e,o.z,u.WW,a.aL,a.wd,s.Px)};e.Z=l},12632:function(n,e,t){"use strict";t.d(e,{x:function(){return l}});var r=t(14924),i=t(26042),o=t(69396),a=t(67294),u=t(96486),s=t(98209),d=t(59577),l=function(n){var e,t,l,c,m,p,f,v,g,h,_,I=n.filters,y=n.newFilters,$=n.initialSort,b=(0,a.useRef)(),q=(0,a.useState)({}),x=q[0],S=q[1],A=(0,a.useState)({}),Z=A[0],j=A[1],w=$||{item:"createdAt",order:"desc"},C=(0,r.Z)({},(null===(e=b.current)||void 0===e?void 0:e.sort.item)||w.item,w.inneritem?(0,r.Z)({},w.inneritem,(null===(t=b.current)||void 0===t?void 0:t.sort.order)||w.order):(null===(l=b.current)||void 0===l?void 0:l.sort.order)||w.order);return(0,a.useEffect)(function(){var n=!(0,u.isEqual)(x,I),e=!(0,u.isEqual)(Z,y);if(n&&(S(I),null==b||null===(r=b.current)||void 0===r||r.resetPagination()),e&&(j(y),null==b||null===(i=b.current)||void 0===i||i.resetPagination()),(null==b?void 0:null===(t=b.current)||void 0===t?void 0:t.setSort)&&!(n||e)){var t,r,i,o,a,s,d,l,c,m,p,f=(null===(o=b.current)||void 0===o?void 0:null===(a=o.sort)||void 0===a?void 0:a.item)&&(null===(s=b.current)||void 0===s?void 0:null===(d=s.sort)||void 0===d?void 0:d.order)?{item:null===(l=b.current)||void 0===l?void 0:null===(c=l.sort)||void 0===c?void 0:c.item,order:null===(m=b.current)||void 0===m?void 0:null===(p=m.sort)||void 0===p?void 0:p.order}:C;b.current.setSort(f)}},[I,y]),{initialData:(0,o.Z)((0,i.Z)({},I),{newFilters:(null==y?void 0:y.length)>0?y:void 0,limit:(null===(c=b.current)||void 0===c?void 0:c.pageSize)==="Infinity"?null:parseInt(null===(m=b.current)||void 0===m?void 0:m.pageSize,10)||s.C1.paginationSize,offset:((null===(p=b.current)||void 0===p?void 0:p.currentPage)-1||0)*((null===(f=b.current)||void 0===f?void 0:f.pageSize)||s.C1.paginationSize),orderBy:(0,d.c)(null===(v=b.current)||void 0===v?void 0:null===(g=v.sort)||void 0===g?void 0:null===(h=g.item)||void 0===h?void 0:h.replace(/ORDER/i,null===(_=b.current)||void 0===_?void 0:_.sort.order))||C}),initialSort:$,ref:b}}},71559:function(n,e,t){"use strict";t.d(e,{Y:function(){return r}});var r=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Job",t="";return(null==n?void 0:n.length)&&(t="\n      Taxonomy: {\n      _and: [\n        { entity: { _eq: ".concat(e,' } }\n        {\n          Taxonomy: {\n            status: { _eq: "active" }\n            _and: [{ id: { _in: [').concat(n,'] } }, { type: { _eq: "tags" } }]\n          }\n        }\n      ]\n    }\n  ')),t}},94885:function(n,e,t){"use strict";t.d(e,{$E:function(){return P},AX:function(){return x},I4:function(){return q},JA:function(){return A},MT:function(){return U},Px:function(){return j},WF:function(){return Z},ZA:function(){return M},a8:function(){return w},fA:function(){return D},fo:function(){return S},ge:function(){return R},iM:function(){return N},nE:function(){return k},nh:function(){return T},r1:function(){return C},tW:function(){return L},uz:function(){return F}});var r=t(7297),i=t(75063);function o(){var n=(0,r.Z)(["\n  mutation InsertAccountUser($objects: [Account_User_insert_input!]!) {\n    insert_Account_User(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return o=function(){return n},n}function a(){var n=(0,r.Z)(["\n  mutation UpdateUser(\n    $id: Int!\n    $accountUserId: Int!\n    $accountUserChanges: Account_User_set_input\n    $changes: User_set_input\n    $updateAccountUser: Boolean!\n  ) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _set: $accountUserChanges)\n      @include(if: $updateAccountUser) {\n      id\n    }\n    update_User_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return a=function(){return n},n}function u(){var n=(0,r.Z)(["\n  query GetUsers(\n    $accountId: Int\n    $accountType: String\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $q: String\n    $orderBy: User_order_by!\n    $status: String\n  ) {\n    users: User(\n      limit: $limit\n      offset: $offset\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [\n          { email: { _ilike: $q } }\n          { nameFirst: { _ilike: $q } }\n          { nameLast: { _ilike: $q } }\n        ]\n        status: { _eq: $status }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n    meta: User_aggregate(\n      where: {\n        Account_Users: { Account: { id: { _eq: $accountId }, type: { _eq: $accountType } } }\n        createdAt: { _eq: $date }\n        _or: [{ nameFirst: { _ilike: $q } }, { nameLast: { _ilike: $q } }]\n        status: { _eq: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return u=function(){return n},n}function s(){var n=(0,r.Z)(["\n  query GetUser($id: Int!) {\n    user: User_by_pk(id: $id) {\n      id\n      fullName\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      media: Media {\n        id\n        medium: Medium {\n          id\n          category\n          filename\n          meta\n          type\n        }\n      }\n      accounts: Account_Users {\n        id\n        role\n        position\n        isContact\n        status\n        account: Account {\n          id\n          name\n          type\n        }\n      }\n    }\n  }\n"]);return s=function(){return n},n}function d(){var n=(0,r.Z)(["\n  query CheckDuplicateEmail($email: String!) {\n    users: User_public(where: { email: { _eq: $email } }) {\n      id\n      nameFirst\n      nameLast\n      email\n      phone\n    }\n  }\n"]);return d=function(){return n},n}function l(){var n=(0,r.Z)(["\n  fragment UserFields on User {\n    id\n    email\n    nameFirst\n    nameLast\n    fullName\n    phone\n    status\n  }\n"]);return l=function(){return n},n}function c(){var n=(0,r.Z)(["\n  mutation SendGoogleAuthCode($code: String!, $id: Int!, $type: String!) {\n    createGoogleToken(code: $code, id: $id, type: $type) {\n      success\n      tokens\n      error\n    }\n  }\n"]);return c=function(){return n},n}function m(){var n=(0,r.Z)(["\n  mutation GenerateMSURL($type: String!, $id: Int!) {\n    genenrateMSURL(id: $id, type: $type) {\n      url\n    }\n  }\n"]);return m=function(){return n},n}function p(){var n=(0,r.Z)(["\n  mutation signoutMS($id: Int!, $type: String!, $email: String!) {\n    signoutMS(id: $id, type: $type, email: $email) {\n      error\n      msId\n      success\n    }\n  }\n"]);return p=function(){return n},n}function f(){var n=(0,r.Z)(["\n  query getAccountMeta($id: Int!) {\n    account: Account_by_pk(id: $id) {\n      meta\n    }\n  }\n"]);return f=function(){return n},n}function v(){var n=(0,r.Z)(["\n  query user($id: Int!) {\n    user: User_by_pk(id: $id) {\n      meta\n      invoiceThreshold\n      quoteThreshold\n    }\n  }\n"]);return v=function(){return n},n}function g(){var n=(0,r.Z)(["\n  query GetAccountUserMeta($userId: Int!, $accountId: Int!) {\n    accountUser: Account_User(where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }) {\n      meta\n    }\n  }\n"]);return g=function(){return n},n}function h(){var n=(0,r.Z)(["\n  mutation UpdateAccountUserByUserIdAccoutId(\n    $userId: Int!\n    $accountId: Int!\n    $changes: Account_User_set_input!\n  ) {\n    update_Account_User(\n      where: { userId: { _eq: $userId }, accountId: { _eq: $accountId } }\n      _set: $changes\n    ) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return h=function(){return n},n}function _(){var n=(0,r.Z)(["\n  mutation updateAccount($accountId: Int!, $set: Account_set_input!) {\n    update_Account_by_pk(pk_columns: { id: $accountId }, _set: $set) {\n      id\n    }\n  }\n"]);return _=function(){return n},n}function I(){var n=(0,r.Z)(["\n  mutation updateUserMeta($userId: Int!, $meta: jsonb!) {\n    update_User_by_pk(pk_columns: { id: $userId }, _set: { meta: $meta }) {\n      id\n      meta\n    }\n  }\n"]);return I=function(){return n},n}function y(){var n=(0,r.Z)(['\n  query userDevices($accountId: Int!) {\n    users: User(\n      where: {\n        Account_Users: { accountId: { _eq: $accountId }, status: { _eq: "active" } }\n        UserDevices: { status: { _eq: "active" } }\n        status: { _eq: "active" }\n      }\n    ) {\n      id\n      fullName\n      devices: UserDevices(\n        order_by: { updatedAt: desc_nulls_last }\n        where: { status: { _eq: "active" } }\n        limit: 1\n      ) {\n        id\n        playerId\n      }\n    }\n  }\n']);return y=function(){return n},n}function $(){var n=(0,r.Z)(['\n  query GetAccountLocations($accountId: Int, $limit: Int, $offset: Int) {\n    location: Location(\n      offset: $offset\n      limit: $limit\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      id\n      name\n      accountLocations: Account_Locations {\n        id\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n        id\n        status\n        address: Address {\n          id\n          name\n          addressLine1\n          postCode\n        }\n      }\n    }\n    meta: Location_aggregate(\n      where: {\n        Account_Locations: {\n          accountId: { _eq: $accountId }\n          Account: { type: { _eq: "customer" } }\n        }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return $=function(){return n},n}function b(){var n=(0,r.Z)(["\n  mutation InsertUserAccountLocations(\n    $accountUserId: Int!\n    $objects: [User_Account_Location_insert_input!]!\n  ) {\n    delete_User_Account_Location(where: { accountUserId: { _eq: $accountUserId } }) {\n      affected_rows\n    }\n    insert_User_Account_Location(objects: $objects) {\n      affected_rows\n      returning {\n        id\n      }\n    }\n  }\n"]);return b=function(){return n},n}var q=(0,i.Ps)(o()),x=(0,i.Ps)(a()),S=(0,i.Ps)(u()),A=(0,i.Ps)(s()),Z=(0,i.Ps)(d()),j=(0,i.Ps)(l()),w=(0,i.Ps)(c()),C=(0,i.Ps)(m()),U=(0,i.Ps)(p()),k=(0,i.Ps)(f()),T=(0,i.Ps)(v()),N=(0,i.Ps)(g()),D=(0,i.Ps)(h()),P=(0,i.Ps)(_()),F=(0,i.Ps)(I()),R=(0,i.Ps)(y()),M=(0,i.Ps)($()),L=(0,i.Ps)(b())},16605:function(n,e,t){"use strict";t.d(e,{S:function(){return r}});var r=function(n,e){var t=document.createElement("a");"string"==typeof t.download?(document.body.appendChild(t),t.download=e,t.href=n,t.click(),document.body.removeChild(t)):location.replace(n)}},59577:function(n,e,t){"use strict";t.d(e,{c:function(){return r}});var r=function(n){try{return JSON.parse(n)}catch(e){return!1}}},58632:function(n,e,t){"use strict";t.d(e,{x:function(){return r}});var r=[{text:"Reactive",value:"reactive",context:"#2EE6CA"},{text:"Planned Maintenance",value:"ppm",context:"#D67EFF"},{text:"Quote",value:"quote",context:"#7D7"},{text:"Compliance",value:"cppm",context:"#CC7429"}]},8110:function(n,e,t){"use strict";t.r(e),t.d(e,{default:function(){return nv}});var r=t(85893),i=t(11163),o=t.n(i),a=t(24716),u=t(26042),s=t(69396),d=t(828),l=t(67294),c=t(6812),m=t(73359),p=t(11057),f=t(98456),v=t(90629),g=t(51233),h=t(15861),_=t(81261),I=t(65817),y=t(30381),$=t.n(y),b=t(57460),q=t.n(b),x=t(45697),S=t.n(x),A=t(53767),Z=t(74944),j=t(12632),w=t(16605),C=t(11994),U=t(50135),k=t(42283),T=t(90948),N=t(33754),D=t(45307),P=t(31312),F=t(53625),R=t(57493),M=t(4595),L=t(4585),J=t(18531),O=p.Z,W=function(n){var e=n.open,t=n.setOpen,i=n.initialFilters,o=(n.filters,n.setFilters),a=(0,Z.x)(),p=a.hasRole,f=a.user,v=(0,d.Z)((0,D.X)("form_data_".concat(i.filterType),i),2),h=v[0],_=v[1],I=(0,k.cI)({defaultValues:h}),y=I.control,$=I.handleSubmit,b=I.register,q=I.reset,x=I.watch,S=I.setValue,A=I.getValues,j=x("startDate"),w=(0,l.useState)(""),C=w[0],T=w[1],N=P.iz.map(function(n){return p("supplier")?{label:n.supplierText,value:n.value}:p("customer")?{label:n.customerText,value:n.value}:{label:n.text,value:n.value}}).filter(function(n){return null!==n.label}),M=(0,d.Z)((0,m.t)(R.yR),2),J=M[0],W=M[1],G=W.loading,H=W.data,X=(void 0===H?{items:[]}:H).items,K=(0,d.Z)((0,m.t)(R.t1,{variables:{subtype:"quote",adminId:f.adminId}}),2),nn=K[0],ne=K[1],nt=ne.loading,nr=ne.data,ni=(void 0===nr?{items:[]}:nr).items,no=(0,d.Z)((0,m.t)(R.SW),2),na=no[0],nu=no[1],ns=nu.loading,nd=nu.data,nl=(void 0===nd?{items:[]}:nd).items,nc=(0,d.Z)((0,m.t)(R._d),2),nm=nc[0],np=nc[1],nf=np.loading,nv=np.data,ng=(void 0===nv?{items:[]}:nv).items,nh=(0,d.Z)((0,m.t)(R.by,{variables:{where:{type:{_eq:"supplier"}}}}),2),n_=nh[0],nI=nh[1],ny=nI.loading,n$=nI.data,nb=(void 0===n$?{items:[]}:n$).items,nq=(0,c.a)(R.K4,{skip:!e,variables:{accountId:f.accountId,limit:50,offset:0,q:""!==C?"%".concat(C,"%"):null}}),nx=nq.data,nS=(void 0===nx?{items:[]}:nx).items,nA=nq.loading;(0,l.useEffect)(function(){var n=N.filter(function(n){return"quoteOffered"===n.value});S("status",j?n:[])},[j,S,N]);var nZ=function(n){try{var e,r,a,s,d,l,c,m,p,f,v={slaId:null===(e=n.slaId)||void 0===e?void 0:e.map(function(n){return n.value}),locationId:null!==(f=null===(r=n.location)||void 0===r?void 0:r.value)&&void 0!==f?f:null,startDate:n.startDate,endDate:n.endDate,status:null===(a=n.status)||void 0===a?void 0:a.map(function(n){return n.value}),customerId:null===(s=n.customerId)||void 0===s?void 0:s.value,supplierId:null===(d=n.supplierId)||void 0===d?void 0:d.value,userId:null===(l=n.userId)||void 0===l?void 0:l.value,tags:null===(c=n.tags)||void 0===c?void 0:c.map(function(n){return n.value}),customerManagerId:null===(m=n.customerManager)||void 0===m?void 0:m.value},g=n.q;if(g){v.q="%".concat(g,"%")||0;var h=/^\d+$/.test(g);"id"in i&&(v.id=h?Number(g):null),"meta"in i&&(v.meta=h?{invoiceNumbers:[g]}:null),"jobNumber"in i&&(v.jobNumber=h?String(g):null,v.invoiceNumber=h?Number(g):null)}(null===(p=v.status)||void 0===p?void 0:p.length)&&(v.isChangedStatusSelect=!0),o(function(n){return(0,u.Z)({},n,v)});var I=A();_(function(n){return(0,u.Z)({},n,I)})}finally{t(!1)}},nj=function(){o(i),q(i),t(!1)};return(0,r.jsx)(E,{keepMounted:!0,open:e,onClose:function(){return t(!1)},children:(0,r.jsx)("form",{onSubmit:$(nZ),children:(0,r.jsxs)(Q,{children:[(0,r.jsx)(U.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search...",name:"q",inputRef:b}),(0,r.jsx)(k.Qr,{name:"startDate",control:y,render:function(n){return(0,r.jsx)(z,(0,s.Z)((0,u.Z)({},n),{label:"Quote offered date",renderInput:function(n){return(0,r.jsx)(U.Z,(0,s.Z)((0,u.Z)({},n),{variant:"standard"}))}}))}}),(0,r.jsx)(k.Qr,{name:"endDate",control:y,render:function(n){return(0,r.jsx)(z,(0,s.Z)((0,u.Z)({},n),{label:"Quote due date",renderInput:function(n){return(0,r.jsx)(U.Z,(0,s.Z)((0,u.Z)({},n),{variant:"standard"}))}}))}}),(0,r.jsx)(k.Qr,{name:"status",control:y,render:function(n){var e=n.value,t=n.onChange;return(0,r.jsx)(B,{disabled:Boolean(j),multiple:!0,limitTags:1,value:e,onChange:function(n,e){return t(e)},label:"Select status",options:N})}}),!p(["customer","supplier","tenant"])&&(0,r.jsx)(k.Qr,{name:"customerId",control:y,render:function(n){var e=n.value,t=n.onChange;return(0,r.jsx)(B,{value:e,onChange:function(n,e){return t(e)},label:"Select customer",loading:ns,onOpen:function(){return na()},options:nl})}}),p(F.n)&&(0,r.jsx)(k.Qr,{name:"userId",control:y,render:function(n){var e=n.value,t=n.onChange;return(0,r.jsx)(B,{value:e,onChange:function(n,e){return t(e)},label:"Select user",loading:G,onOpen:function(){return J()},options:X})}}),!p(["tenant"])&&(0,r.jsx)(k.Qr,{name:"location",control:y,render:function(n){var e=n.value,t=n.onChange;return(0,r.jsx)(B,{value:e,onChange:function(n,e){return t(e)},label:"Select location",loading:nf,onOpen:function(){return nm()},options:ng})}}),p("admin")&&(0,r.jsx)(Y,{children:(0,r.jsx)(L.r,{control:y})}),p("admin")&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(k.Qr,{name:"supplierId",control:y,render:function(n){var e=n.value,t=n.onChange;return(0,r.jsx)(B,{disabled:j,value:e,onChange:function(n,e){return t(e)},label:"Select supplier",loading:ny,onOpen:function(){return n_()},options:nb})}}),(0,r.jsx)(k.Qr,{name:"customerManager",control:y,render:function(n){var e=n.value,t=n.onChange;return(0,r.jsx)(V,{value:e,onChange:function(n,e){return t(e)},loading:nA,options:nS,setSearch:T,textFieldProps:{color:"secondary",variant:"standard",label:"Select account manager"}})}})]}),(0,r.jsx)(k.Qr,{name:"slaId",control:y,render:function(n){var e=n.value,t=n.onChange;return(0,r.jsx)(B,{disabled:j,multiple:!0,limitTags:1,value:e||[],onChange:function(n,e){return t(e)},label:"Select priority",loading:nt,onOpen:function(){return nn()},options:ni})}}),(0,r.jsxs)(g.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,r.jsx)(O,{variant:"contained",color:"danger",onClick:function(){return nj()},children:"Cancel"}),(0,r.jsx)(O,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})};W.defaultProps={open:!1,setOpen:function(){},initialFilters:{},filters:{},setFilters:function(){}},W.propTypes={open:S().bool,setOpen:S().func,initialFilters:S().object,filters:S().object,setFilters:S().func};var E=(0,T.ZP)(C.Z)(function(){return{display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%"}}),Q=(0,T.ZP)(v.Z)(function(){return{padding:"24px",maxWidth:"700px",maxHeight:"100vh",overflowY:"scroll",display:"flex",flexDirection:"row",flexWrap:"wrap",rowGap:"16px",columnGap:"16px","@media (max-width: 600px)":{flexDirection:"column",flexWrap:"nowrap",columnGap:0,width:"100vw",height:"100vh"}}}),z=(0,T.ZP)(N.M)(function(){return{"&.MuiFormControl-root.MuiTextField-root":{width:"calc(50% - 8px)","@media (max-width: 600px)":{width:"100%"}}}}),B=(0,T.ZP)(M.F)(function(){return{"&.MuiAutocomplete-root":{width:"calc(50% - 8px)","@media (max-width: 600px)":{width:"100%"}}}}),V=(0,T.ZP)(J.q)(function(){return{"&.MuiAutocomplete-root":{width:"calc(50% - 8px)","@media (max-width: 600px)":{width:"100%"}}}}),Y=(0,T.ZP)("div")(function(){return{width:"calc(50% - 8px)","@media (max-width: 600px)":{width:"100%"},"& .MuiAutocomplete-root":{width:"100%"}}}),G=t(29815),H=t(58632),X=t(72530),K=t(40577),nn=function(n){var e=n.data,t=n.isCSV,r=n.hasRole,i=r("admin"),o=r("customer"),a=r("supplier");return e.map(function(n){var e,r,d,l,c,m,p,f,v,g,h,_,I,y,b,q,x=(0,G.Z)(P.iz).find(function(e){return e.value===n.status})||{text:"Accepted",supplierText:"Accepted",customerText:"Accepted"},S=x.text,A=x.supplierText,Z=x.customerText,j=S;o?j=Z:a&&(j=A);var w,C=((0,G.Z)(H.x).find(function(e){return e.value===n.type})||{text:"Quote"}).text,U=n.manager?"".concat(n.manager.nameFirst," ").concat(n.manager.nameLast):"Unassigned",k=n.scheduledAt?$()(n.scheduledAt,!0).format("YYYY-MM-DD"):"-",T=t&&(i||o)?(null===(e=n.sublocation)||void 0===e?void 0:e.name)||"-":void 0;return(0,s.Z)((0,u.Z)({id:n.id,description:(null==n?void 0:n.description)?null==n?void 0:n.description:"-",number:n.number,type:C,status:n.status,propertyId:null===(r=n.location)||void 0===r?void 0:r.id,managerId:null===(d=n.manager)||void 0===d?void 0:d.id,customerId:null===(l=n.customer)||void 0===l?void 0:l.id,supplierId:n.supplier?n.supplier.id:"",siteVisitStart:n.siteVisitStart,siteVisitEnd:n.siteVisitEnd,siteVisitWeekends:n.siteVisitWeekends,service:(null===(c=n.service)||void 0===c?void 0:c.name)||"-",manager:U,location:(null===(m=n.location)||void 0===m?void 0:m.name)||"-",property:(null===(p=n.location)||void 0===p?void 0:p.name)||"-",sublocation:T,tags:null==n?void 0:n.tags,customer:(null===(f=n.customer)||void 0===f?void 0:f.name)||"-",customerManager:(null===(v=n.customer)||void 0===v?void 0:null===(g=v.manager)||void 0===g?void 0:g.fullName)||"-"},!t&&{customerManagerId:null===(h=n.customer)||void 0===h?void 0:null===(_=h.manager)||void 0===_?void 0:_.id}),{acceptSupplier:n.supplier?n.supplier.name:"-",offeredSupplier:(null==n?void 0:null===(I=n.quotations)||void 0===I?void 0:I.length)>0?(w=n.quotations,t?w.map(function(n){var e;return null==n?void 0:null===(e=n.supplier)||void 0===e?void 0:e.name}).join(" / "):w):[],quotations:"".concat((null===(y=n.quotations)||void 0===y?void 0:y.length)||0,"/").concat(n.quoteNumber),received:"".concat(null===(b=n.quotations||[])||void 0===b?void 0:b.reduce(function(n,e){return"supplierQuoteComplete"===e.status?n+1:n},0),"/").concat((null===(q=n.quotations)||void 0===q?void 0:q.length)||0),range:ne(n.quotations),due:$()(n.quoteDue).format("YYYY-MM-DD"),scheduleDate:k,date:$()(n.createdAt).format("YYYY-MM-DD"),statusText:j,quoted:n.quoted||!1,quotationsId:n.quotations[0]&&n.quotations[0].id,actions:""})})},ne=function(n){var e=null;if(n.length>1){var t,r,i=n.map(function(n){var e;return null===(e=n.lineItems)||void 0===e?void 0:e.reduce(function(n,e){return n+(e.total||0)*e.qty},0)});e={high:(t=Math).max.apply(t,(0,G.Z)(i||[])),low:(r=Math).min.apply(r,(0,G.Z)(i||[]))}}return e},nt=function(n){var e=n.variables,t=n.user,r=n.queryParams,i=n.hasRole,o=e.limit,a=e.offset,d=e.orderBy,l=e.q,c=e.status,m=e.userId,p=e.asAt,f=e.locationId,v=e.managerId,g=e.tagsWhere,h=r.hasOwnProperty("tileName");if(!e.isChangedStatusSelect)switch(r.show){case"unsent":e.status=["quoteOffered","quoteNew"];break;case"unsentQuote":e.status=["quoteOffered","quoteReceived"];break;case"overdueQuote":e.status=["quoteNew","quoteOffered","quoteReceived","quoteSent"];break;default:e.status=r.show}if(h){var _=m||+r.userId,I=+r.accountId;return i(["customer","supplier"])&&(_=t.id,I=t.accountId),{query:(0,X.Z)({tagsWhere:g}),variables:(0,s.Z)((0,u.Z)({},e),{accountId:I,locationId:f||r.locationId,managerId:v||r.managerId,asAt:p,tileName:null==r?void 0:r.tileName,monthStart:e.monthStart,dayStart:e.todayStart,yearStart:e.yearStart,adminId:null==t?void 0:t.adminId,userId:_})}}return"supplier"===t.accountType?{query:K.L,variables:(0,u.Z)({limit:o,offset:a,orderBy:d,q:l,status:c},e)}:{query:(0,K.w)({tagsWhere:g}),variables:(0,u.Z)({},e)}},nr=t(48795),ni=t(45451),no=t(21830),na=t(35374),nu=t(50108),ns=t(83162),nd=t(79928),nl=t(71559),nc=t(59505),nm=function(n){var e,t,a,y,b,x=n.title,S=n.subtitle,C=n.initialFilters,U=(0,A.q)(),k=(0,Z.x)(),T=k.hasRole,N=k.user,D=(0,i.useRouter)().query,P=(0,l.useState)((0,u.Z)({},C)),F=P[0],R=P[1],M=(0,l.useState)(!1),L=M[0],J=M[1],O=(0,l.useState)(!1),E=O[0],Q=O[1],z=null===(e=U.admin)||void 0===e?void 0:null===(t=e.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,B=null===(a=U.admin)||void 0===a?void 0:null===(y=a.jobSetting)||void 0===y?void 0:y.jobNumberSuffix,V=T("admin"),Y=T("supplier"),G=T("tenant"),H=T(["admin","customer"]),X=T(["admin","supplier"]),K=(0,j.x)({filters:F}),ne=K.initialData,nm=K.ref,np=nt({variables:(0,s.Z)((0,u.Z)({},ne),{monthStart:$()(D.asAt).startOf("month"),todayEnd:$()(D.asAt).endOf("day"),todayStart:$()(D.asAt).startOf("day"),yearStart:$()(D.asAt).startOf("year"),asAt:$()(D.asAt).endOf("day"),tagsWhere:(0,nl.Y)(ne.tags)}),user:N,queryParams:D,hasRole:T}),nf=np.query,nv=np.variables;"Accepted"===nv.status?(nv.type="reactive",delete nv.status):delete nv.type;var ng=(0,c.a)(nf,{variables:nv}),nh=ng.data,n_=void 0===nh?{quotes:[],meta:{aggregate:{totalCount:0}}}:nh,nI=n_.quotes,ny=n_.meta,n$=ng.loading,nb=ng.refetch,nq=(0,d.Z)((0,m.t)(nf,{variables:(0,s.Z)((0,u.Z)({},nv),{limit:(null==ny?void 0:null===(b=ny.aggregate)||void 0===b?void 0:b.totalCount)||150}),onCompleted:function(n){var e=n.quotes;try{var t=q().unparse(nj(e,!0)),r="data:application/octet-stream,"+encodeURIComponent(t);(0,w.S)(r,"quotes.csv")}finally{Q(!1)}},skip:!0}),1)[0],nx=function(n){n.stopPropagation(),Q(!0),nq()},nS=function(n){var e=[];return V&&(e.push({context:"secondary",icon:"edit",onClick:function(e){return o().push("/dashboard/issues/manage?id=".concat(n.number,"&quoted=1"))},tooltip:"Edit"}),e.push({context:"secondary",icon:"info",onClick:function(){return o().push("/dashboard/issues/view?id=".concat(n.number))},tooltip:"Info"})),e},nA=[{sortable:!0,minWidth:100,field:"id",headerName:"ID",sortName:"id",renderCell:function(n){var e=n.row;return(0,r.jsx)(nr.D,{id:e.id,number:e.number,numberPrefix:z,numberSuffix:B,openCanvas:!0,type:e.type,isQuote:e.quoted})}},{sortable:!1,flex:1,minWidth:80,field:"type",headerName:"Type",sortName:"type"},{minWidth:300,field:"tags",headerName:"Tags",sortable:!1,flex:1,renderCell:function(n){var e=n.row;return(0,r.jsx)(nd.K,{row:e,refetchQueries:["GetQuotes","GetDashboardList"],entity:"Job"})}},{sortable:!1,flex:1,minWidth:180,field:"description",headerName:"Description"},{sortable:!0,hide:!V,sortName:'{"Manager": {"nameFirst": "ORDER"}}',flex:1,minWidth:180,field:"manager",headerName:"Assigned to",renderCell:function(n){var e=n.row;return(0,r.jsx)(ns.r,{color:"secondary",href:"/dashboard/users/view?id=".concat(e.managerId),children:e.manager})}},{sortable:!0,hide:!H,flex:1,minWidth:180,field:"location-admin-customer",headerName:"Location",sortName:'{"Location": {"name": "ORDER"}}',renderCell:function(n){var e=n.row;return(0,r.jsx)(ns.r,{color:"secondary",href:"/dashboard/properties/view?id=".concat(e.propertyId),children:e.location})}},{sortable:!0,hide:H,flex:1,minWidth:180,field:"location",headerName:"Location",sortName:'{"Location": {"name": "ORDER"}}'},{sortable:!0,hide:!V,flex:1,minWidth:180,field:"customer",headerName:"Customer",sortName:'{"Customer": {"name": "ORDER"}}',renderCell:function(n){var e=n.row;return(0,r.jsx)(ns.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(e.customerId),children:e.customer})}},{minWidth:180,flex:1,field:"customerManager",headerName:"Account Manager",sortName:'{"Customer": {"Manager": {"fullName": "ORDER"}}}',renderCell:function(n){var e=n.row;return(0,r.jsx)(ns.r,{noWrap:!e.customerManagerId,color:"secondary",href:"/dashboard/users/view?id=".concat(e.customerManagerId),children:e.customerManager})}},{sortable:!0,hide:!V&&!Y,flex:1,minWidth:180,field:"acceptSupplier",headerName:"Accepted Supplier",sortName:'{"Supplier": {"name": "ORDER"}}',renderCell:function(n){var e=n.row;return(0,r.jsx)(ns.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(e.supplierId),children:e.acceptSupplier})}},{sortable:!0,hide:!V&&!Y,flex:1,minWidth:180,field:"offeredSupplier",headerName:"Offered Supplier",sortName:'{"Supplier": {"name": "ORDER"}}',renderCell:function(n){var e,t=n.row;return(0,r.jsx)(r.Fragment,{children:(null==t?void 0:null===(e=t.offeredSupplier)||void 0===e?void 0:e.length)>0?(0,r.jsx)(g.Z,{children:((null==t?void 0:t.offeredSupplier)||[]).map(function(n){var e,t;return(0,r.jsx)(ns.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(null==n?void 0:null===(e=n.supplier)||void 0===e?void 0:e.id),children:null==n?void 0:null===(t=n.supplier)||void 0===t?void 0:t.name})})}):"-"})}},{sortable:!1,hide:!V,flex:1,minWidth:100,field:"quotations",headerName:"Quotations"},{sortable:!1,hide:!V&&!Y,flex:1,minWidth:80,field:"received",headerName:"Quotations (Received)"},{sortable:!1,hide:!V,flex:1,minWidth:140,field:"range",headerName:"Quotations Range",renderCell:function(n){var e=n.row.range;return e?(0,r.jsxs)(g.Z,{children:[(0,r.jsxs)(h.Z,{sx:{whiteSpace:"nowrap"},children:["high: ",(0,nu.T)(e.high)]}),(0,r.jsxs)(h.Z,{sx:{whiteSpace:"nowrap"},children:["low: ",(0,nu.T)(e.low)]})]}):"N/A"}},{sortable:!0,headerName:"Quote Due",flex:1,minWidth:120,field:"due",sortName:"quoteDue",renderCell:function(n){var e=n.row,t=$()().format("YYYY-MM-DD"),i="Quote"===e.type,o=e.status.includes("quoteSent");if(i&&e.due<t&&!o)return(0,r.jsxs)(g.Z,{alignItems:"center",children:[(0,r.jsx)(I.Z,{color:"error",sx:{height:"20px"}}),(0,r.jsx)(h.Z,{children:e.due})]})}},{flex:1,minWidth:120,field:"scheduleDate",headerName:"Scheduled",sortable:!0,sortName:"scheduledAt"},{flex:1,minWidth:120,field:"date",headerName:"Created",sortable:!0,sortName:"createdAt"},{flex:1,minWidth:140,field:"statusText",headerName:"Status",sortable:!0,sortName:"status",renderCell:function(n){var e=n.row,t=null;return t=(null==e?void 0:e.offeredSupplier.length)>0&&(null==e?void 0:e.offeredSupplier.every(function(n){return"quotationRejected"===n.status}))?"rejected":e.status,(0,r.jsx)(nc.B,{value:t})}},{sortable:!1,hide:!V,flex:1,field:"actions",headerName:"",maxWidth:50,renderCell:function(n){var e=n.row;return(0,r.jsx)(no.C,{actionsData:nS,row:e})}}],nZ=function(n){n.stopPropagation(),o().push("/dashboard/issues/manage?quoted=1")},nj=function(n,e){return nn({data:n,isCSV:e,hasRole:T})};return(0,r.jsxs)(g.Z,{width:"100%",spacing:2,sx:{height:"100%"},children:[(0,r.jsxs)(g.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,r.jsx)(p.Z,{variant:"contained",startIcon:(0,r.jsx)(_.Z,{}),onClick:function(){return J(!0)},children:"Filters"}),(0,r.jsxs)(g.Z,{direction:"row",spacing:2,children:[V&&(0,r.jsx)(p.Z,{variant:"contained",color:"secondary",onClick:nZ,children:"Create Quote"}),!(0,na.s)()&&!G&&(0,r.jsx)(p.Z,{startIcon:!E&&(0,r.jsx)("img",{src:"/static/icons/csv.svg"}),disabled:E,variant:"contained",color:"success",onClick:nx,children:E?(0,r.jsx)(f.Z,{size:20,color:"secondary"}):"Export Quote"})]})]}),(0,r.jsxs)(v.Z,{sx:{paddingTop:"16px",paddingBottom:"16px",height:"calc(100% - 52px)"},children:[(0,r.jsxs)(g.Z,{children:[(0,r.jsx)(h.Z,{ml:2,variant:"h5",sx:{fontWeight:600},children:x}),S&&(0,r.jsx)(h.Z,{typography:"subtitle1",ml:2,children:S})]}),(0,r.jsx)(W,{open:L,setOpen:J,initialFilters:C,filters:F,setFilters:R}),(0,r.jsx)(ni.i,{autoHeight:!1,loading:n$,ref:nm,columns:nA,rows:nj(nI),meta:ny,refetch:nb,containerHeight:"calc(100% - 32px)",columnVisibilityModel:{manager:V,"location-admin-customer":H,location:!H,customer:V,customerManager:V,acceptSupplier:X,offeredSupplier:X,quotations:V,received:!Y,range:V,actions:V,tags:V}})]})]})};nm.defaultProps={initialFilters:{},title:"",subtitle:""},nm.propTypes={initialFilters:S().object,title:S().string,subtitle:S().string};var np={id:null,q:null,startDate:null,endDate:null,status:[],customerId:null,supplierId:null,userId:null,isChangedStatusSelect:!1,customerManager:null,filterType:"quotes_table"},nf=function(){var n,e=(0,A.q)().hasUserModule,t=(0,Z.x)().hasRole,a=(0,i.useRouter)().query,u=e("quotes"),s=t("customer_user"),d=t("tenant");return!u&&(s||d)&&o().push("/403"),(0,r.jsx)(nm,{title:null!==(n=null==a?void 0:a.title)&&void 0!==n?n:"Quotes",subtitle:null==a?void 0:a.subtitle,initialFilters:np})};nf.getLayout=function(n){return(0,r.jsx)(a.Z,{children:n})};var nv=nf}},function(n){n.O(0,[3662,2283,212,8890,9511,2583,6310,4599,4135,8579,4244,3776,1564,2329,778,1023,3911,9957,3425,1870,8062,2429,5497,5117,1956,4716,8359,6937,9774,2888,179],function(){return n(n.s=46586)}),_N_E=n.O()}]);