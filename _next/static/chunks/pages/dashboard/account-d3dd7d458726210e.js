(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7130],{10869:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/dashboard/account",function(){return n(83965)}])},31113:function(e,t,n){"use strict";n.d(t,{H:function(){return c}});var r=n(26042),i=n(85893),o=n(45697),s=n(55377),a=n(16551),u=n(77439),c=function(e){var t=e.children,n=e.content,o=e.context,c=e.data,l=e.disabled,d=e.handleClick,f=e.size,p=e.type;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.Z,{size:"sm"}),(0,i.jsxs)(a.Z,{align:"flex-end",children:[t,(0,i.jsx)(u.Z,(0,r.Z)({content:n,context:o,disabled:l,onClick:d,size:f,type:p},c))]})]})};c.propTypes={children:o.node,content:o.string,context:o.string,data:o.object,disabled:o.bool,handleClick:o.func,size:o.string,type:o.string},c.defaultProps={content:"Add",context:"secondary",disabled:!1,size:"sm",type:"button"}},67101:function(e,t,n){"use strict";n.d(t,{r:function(){return s}});var r=n(85893),i=n(45697),o=n(95103),s=function(e){var t=e.errors,n=e.name,i=e.onChange,s=e.options,a=e.register;return(0,r.jsx)(o.Z,{errors:t,name:n,onChange:i,options:s,register:a})};s.propTypes={errors:i.object.isRequired,name:i.string,onChange:i.func,options:i.array.isRequired,register:i.func.isRequired},s.defaultProps={name:"status"}},87336:function(e,t,n){"use strict";n.d(t,{t:function(){return c}});var r=n(85893),i=n(67294),o=n(45697),s=n(11163),a=n(98209),u=n(16540),c=(0,i.forwardRef)(function(e,t){var n=e.columns,o=e.history,c=e.initialSort,l=e.loading,d=e.meta,f=e.paginationSize,p=e.refetch,v=e.rowClick,g=e.rows,m=e.xeroPageSize,y=(0,s.useRouter)(),h=y.query,b=void 0===h?{}:h,x=(0,i.useState)(parseInt(null==b?void 0:b.page,10)||1),Z=x[0],S=x[1],j=(0,i.useState)(m||a.C1.paginationSize),C=j[0],_=j[1];c||(c={item:"createdAt",order:"desc"});var w=(0,i.useState)({item:c.item,order:c.order}),q=w[0],$=w[1],A=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,t=y.query,n=void 0===t?{}:t;if(e>1?n.page=e:delete n.page,!(Object.keys(n).length>0))return{};var r=Object.keys(n).map(function(t){return"page"===t?"".concat(t,"=").concat(e):"".concat(t,"=").concat(n[t])}).join("&");return"?".concat(r)},k=function(){$({item:c.item,order:c.order}),S(1);var e=A();y.push(e),_(m||a.C1.paginationSize)};(0,i.useImperativeHandle)(t,function(){return{currentPage:Z,pageSize:C,sort:q,resetPagination:function(){k()}}});var F=function(e){var t=A(e);o&&y.push(t),S(e),!o&&p&&p()},I=function(e){e!==a.C1.paginationSize&&(_(e),p&&p())},T=function(e){var t;$({item:e.item,order:e.order}),p&&p()};return(0,r.jsx)(u.Z,{columns:n,loading:l,paginationSize:f,pagination:d&&!0,paginationProps:d&&{currentPage:Z,onPageChange:F,onPageSizeChange:I,pageCount:Math.ceil(d.aggregate.totalCount/C),perPage:C},rowClick:v,rows:g,sort:q,setSort:T})});c.propTypes={columns:o.array.isRequired,history:o.bool,initialSort:o.object,loading:o.bool,meta:o.object,refetch:o.func,rowClick:o.func,rows:o.array.isRequired},c.defaultProps={history:!0,loading:!0,paginationSize:!1}},12632:function(e,t,n){"use strict";n.d(t,{x:function(){return l}});var r=n(14924),i=n(26042),o=n(69396),s=n(67294),a=n(96486),u=n(98209),c=n(59577),l=function(e){var t,n,l,d,f,p,v,g,m,y,h,b=e.filters,x=e.newFilters,Z=e.initialSort,S=(0,s.useRef)(),j=(0,s.useState)({}),C=j[0],_=j[1],w=(0,s.useState)({}),q=w[0],$=w[1],A=Z||{item:"createdAt",order:"desc"},k=(0,r.Z)({},(null===(t=S.current)||void 0===t?void 0:t.sort.item)||A.item,A.inneritem?(0,r.Z)({},A.inneritem,(null===(n=S.current)||void 0===n?void 0:n.sort.order)||A.order):(null===(l=S.current)||void 0===l?void 0:l.sort.order)||A.order);return(0,s.useEffect)(function(){var e=!(0,a.isEqual)(C,b),t=!(0,a.isEqual)(q,x);if(e&&(_(b),null==S||null===(r=S.current)||void 0===r||r.resetPagination()),t&&($(x),null==S||null===(i=S.current)||void 0===i||i.resetPagination()),(null==S?void 0:null===(n=S.current)||void 0===n?void 0:n.setSort)&&!(e||t)){var n,r,i,o,s,u,c,l,d,f,p,v=(null===(o=S.current)||void 0===o?void 0:null===(s=o.sort)||void 0===s?void 0:s.item)&&(null===(u=S.current)||void 0===u?void 0:null===(c=u.sort)||void 0===c?void 0:c.order)?{item:null===(l=S.current)||void 0===l?void 0:null===(d=l.sort)||void 0===d?void 0:d.item,order:null===(f=S.current)||void 0===f?void 0:null===(p=f.sort)||void 0===p?void 0:p.order}:k;S.current.setSort(v)}},[b,x]),{initialData:(0,o.Z)((0,i.Z)({},b),{newFilters:(null==x?void 0:x.length)>0?x:void 0,limit:(null===(d=S.current)||void 0===d?void 0:d.pageSize)==="Infinity"?null:parseInt(null===(f=S.current)||void 0===f?void 0:f.pageSize,10)||u.C1.paginationSize,offset:((null===(p=S.current)||void 0===p?void 0:p.currentPage)-1||0)*((null===(v=S.current)||void 0===v?void 0:v.pageSize)||u.C1.paginationSize),orderBy:(0,c.c)(null===(g=S.current)||void 0===g?void 0:null===(m=g.sort)||void 0===m?void 0:null===(y=m.item)||void 0===y?void 0:y.replace(/ORDER/i,null===(h=S.current)||void 0===h?void 0:h.sort.order))||k}),initialSort:Z,ref:S}}},59577:function(e,t,n){"use strict";n.d(t,{c:function(){return r}});var r=function(e){try{return JSON.parse(e)}catch(t){return!1}}},45307:function(e,t,n){"use strict";n.d(t,{X:function(){return v}});var r=n(14924),i=n(82670),o=n(828),s=n(7297),a=n(67294),u=n(6812),c=n(50319),l=n(75063),d=n(53767);function f(){var e=(0,s.Z)(["\n  query GetAccountUserFilters($accountUserId: Int!) {\n    accountUser: Account_User_by_pk(id: $accountUserId) {\n      filters\n    }\n  }\n"]);return f=function(){return e},e}function p(){var e=(0,s.Z)(["\n  mutation SetAccountUserFilters($accountUserId: Int!, $filters: jsonb) {\n    update_Account_User_by_pk(pk_columns: { id: $accountUserId }, _append: { filters: $filters }) {\n      id\n    }\n  }\n"]);return p=function(){return e},e}function v(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"sessionStorage",s=(0,d.q)().user,l=(0,a.useState)(function(){try{switch(n){case"network":case"state":return t;case"sessionStorage":return JSON.parse(window.sessionStorage.getItem(e))||t}}catch(r){return t}}),f=l[0],p=l[1],v=function(t){try{var o=(0,i.Z)(t,Function)?t(f):t;switch(p(o),n){case"network":y({variables:{accountUserId:null==s?void 0:s.accountUserId,filters:(0,r.Z)({},e,o)}});break;case"sessionStorage":window.sessionStorage.setItem(e,JSON.stringify(o))}}catch(a){}};(0,u.a)(g,{variables:{accountUserId:null==s?void 0:s.accountUserId},skip:"network"!==n,onCompleted:function(n){var r=n.accountUser;r&&p(r.filters[e]||t)}});var y=(0,o.Z)((0,c.D)(m),1)[0];return[f,v]}var g=(0,l.Ps)(f()),m=(0,l.Ps)(p())},22378:function(e,t,n){"use strict";n.d(t,{Y:function(){return i},l:function(){return r}});var r=[{text:"Account Type",value:""},{text:"Admin",value:"admin"},{text:"Customer",value:"customer"},{text:"Supplier",value:"supplier"},{text:"Tenant",value:"tenant"}],i=function(e){return[{icon:"edit",tooltip:"Edit",to:"/dashboard/".concat(e.type,"s/").concat("supplier"===e.type?"edit":"manage","?id=").concat(e.id)}]}},15897:function(e,t,n){"use strict";n.d(t,{bg:function(){return r}});var r=[{text:"Status",value:""},{text:"Active",value:"active"},{text:"Inactive",value:"inactive"}]},66267:function(e,t,n){"use strict";n.d(t,{J:function(){return S}});var r=n(26042),i=n(69396),o=n(99534),s=n(828),a=n(85893),u=n(11163),c=n(67294),l=n(45697),d=n(9270),f=n(62140),p=n(42283),v=n(76600),g=n(11585),m=n(49501),y=n(75903),h=n(77439),b=n(31113),x=n(45307),Z=function(e){var t=e.initialValues,n=e.renderFilters,o=e.setFilters,u=e.lastQuery,l=e.filters,Z=(0,s.Z)((0,x.X)("form_data_".concat(t.filterType),t),2),S=Z[0],j=Z[1],C=(0,p.cI)({defaultValues:S||t}),_=C.control,w=C.errors,q=C.handleSubmit,$=C.register,A=C.reset,k=C.watch,F=C.setValue,I=k(),T=(0,i.Z)((0,r.Z)({},I),{filterType:t.filterType});(0,c.useEffect)(function(){A(T)},[A]),(0,c.useEffect)(function(){j(T)},[l]);var z=function(e){var n=e.query;if(n!==u){var i={q:"%".concat(n,"%")||0},s=/^\d+$/.test(n);"id"in t&&(i.id=s?Number(n):null),"meta"in t&&(i.meta=s?{invoiceNumbers:[n]}:null),"jobNumber"in t&&(i.jobNumber=s?String(n):null,i.invoiceNumber=s?Number(n):null),o(function(e){return(0,r.Z)({},e,i)})}},P=function(e){Object.keys(t).map(function(e){return F(e,null)}),o(t),A(t),z("")};return(0,a.jsx)(v.Z,{handleSubmit:q(z),children:(0,a.jsxs)(g.Z,{title:"Filters",children:[(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(f.Z,{sm:12,lg:12,children:(0,a.jsx)(m.Z,{label:"",children:(0,a.jsx)(y.Z,{errors:w,label:"Search",name:"email",placeholder:"Search...",prependSearchIcon:!0,register:$,type:"search"})})}),(0,a.jsx)(f.Z,{sm:12,lg:12,children:n({control:_,errors:w,initialValues:t,register:$,setFilters:o,watch:k,setValue:F,reset:A})})]}),(0,a.jsx)(b.H,{content:"Search",context:"secondary",handleClick:z,type:"submit",children:(0,a.jsx)(h.Z,{content:"Clear",context:"danger",onClick:P,size:"sm"})})]})})};Z.propTypes={initialValues:l.object,renderFilters:l.func.isRequired,setFilters:l.func.isRequired};var S=function(e){var t=e.FiltersComp,n=e.initialFilters,l=e.TableComp,p=(0,o.Z)(e,["FiltersComp","initialFilters","TableComp"]),v=(0,s.Z)((0,x.X)("form_data_".concat(n.filterType),n),2),g=v[0],m=v[1],y=(0,c.useState)(g||n),h=y[0],b=y[1],S=(0,u.useRouter)().query.show;return(0,c.useEffect)(function(){m(h)},[h,m]),(0,a.jsx)(d.Z,{children:(0,a.jsxs)(f.Z,{sm:12,lg:12,children:[(0,a.jsx)(Z,{initialValues:n,renderFilters:function(e){return(0,a.jsx)(t,(0,i.Z)((0,r.Z)({},e,p),{show:S}))},setFilters:b,filters:h}),(0,a.jsx)(l,(0,r.Z)({filters:h,initialFilters:n},p))]})})};S.propTypes={FiltersComp:l.func,initialFilters:l.object.isRequired,TableComp:l.func}},83965:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return k}});var r=n(85893),i=n(19076),o=n(66267),s=n(45697),a=n(6812),u=n(7297),c=n(75063);function l(){var e=(0,u.Z)(['\n  query Accounts(\n    $assignedUser: Int\n    $date: timestamptz\n    $limit: Int\n    $offset: Int\n    $orderBy: Account_order_by!\n    $q: String\n    $status: String\n    $type: String\n  ) {\n    accounts: Account(\n      limit: $limit\n      offset: $offset\n      where: {\n        createdAt: { _eq: $date }\n        managerId: { _eq: $assignedUser }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n      }\n      order_by: [$orderBy]\n    ) {\n      id\n      name\n      type\n      createdAt\n      status\n      addresses: Addresses(where: { entity: { _eq: "Account" } }) {\n        id\n        registered\n        operating\n        trading\n        invoice\n        status\n        createdAt\n        address: Address {\n          id\n          name\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n          geo\n          postCode\n          country: Country {\n            id\n            name\n          }\n        }\n      }\n    }\n    meta: Account_aggregate(\n      where: {\n        createdAt: { _eq: $date }\n        managerId: { _eq: $assignedUser }\n        name: { _ilike: $q }\n        status: { _eq: $status }\n        type: { _eq: $type }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return l=function(){return e},e}var d=(0,c.Ps)(l()),f=n(62466),p=n(74297),v=n(26186),g=n(11585),m=n(26535),y=n(87336),h=n(12632),b=function(e){var t=e.filters,n=(0,h.x)({filters:t}),i=n.initialData,o=n.ref,s=(0,a.a)(d,{variables:i}),u=s.data,c=void 0===u?{accounts:[],meta:{aggregate:{totalCount:0}}}:u,l=c.accounts,b=c.meta,x=s.loading,Z=s.refetch,S=[{hidden:!0},{formatter:(0,f.Z)("","id","name","url"),text:"Name"},{text:"Type"},{text:"City"},{sortable:!0,sortName:"createdAt",text:"Created"},{text:"Status"},{hidden:!0}];return(0,r.jsx)(g.Z,{open:!0,title:"Accounts",children:(0,r.jsx)(y.t,{columns:S,loading:x,meta:b,ref:o,refetch:Z,rows:l.map(function(e){var t,n=(0,m.WE)(e,"registered"),r=null==n?void 0:null===(t=n.address)||void 0===t?void 0:t.city;return{id:e.id,name:e.name,type:(0,p.Z)(e.type),city:r||"",createdAt:(0,v.Z)(e.createdAt),status:(0,p.Z)(e.status),url:["superadmin","tenant"].includes(e.type.toLowerCase())?"":"/dashboard/".concat(e.type.toLowerCase(),"s/view")}})})})};b.propTypes={filters:s.object};var x=n(26042),Z=n(69396),S=n(67101),j=n(22378),C=n(15897),_=n(9270),w=n(62140),q=n(74944),$=function(e){var t=e.errors,n=e.register,i=e.setFilters,o=(0,q.x)().hasRole,s={errors:t,register:n};return(0,r.jsxs)(_.Z,{children:[(0,r.jsx)(w.Z,{md:6,children:(0,r.jsx)(S.r,(0,Z.Z)((0,x.Z)({},s),{onChange:function(e){return i(function(t){return(0,Z.Z)((0,x.Z)({},t),{status:e.target.value||null})})},options:C.bg}))}),!o("superadmin")&&(0,r.jsx)(w.Z,{md:6,children:(0,r.jsx)(S.r,(0,Z.Z)((0,x.Z)({},s),{name:"type",onChange:function(e){return i(function(t){return(0,Z.Z)((0,x.Z)({},t),{type:e.target.value||null})})},options:j.l}))})]})};$.propTypes={errors:s.object.isRequired,register:s.func.isRequired,setFilters:s.func.isRequired};var A=function(){var e;return e="superadmin"===(0,q.x)().user.accountType?{q:null,status:"active",type:"admin",filterType:"account_table"}:{q:null,status:"active",type:null,filterType:"account_table"},(0,r.jsx)(o.J,{FiltersComp:$,initialFilters:e,TableComp:b})},k=function(){return(0,r.jsx)(i.Z,{pageHeading:{heading:"Accounts"},View:(0,r.jsx)(A,{})})}}},function(e){e.O(0,[3662,2283,7645,3054,6540,5091,9774,2888,179],function(){return e(e.s=10869)}),_N_E=e.O()}]);