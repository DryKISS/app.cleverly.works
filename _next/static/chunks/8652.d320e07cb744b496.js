"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8652],{29422:function(e,t,n){n.d(t,{Z:function(){return l}});var o=n(77349),a=n(11640),r=n(19013),s=n(13882),i=n(83946);function l(e,t){if((0,s.Z)(2,arguments),!t||"object"!=typeof t)return new Date(NaN);var n=t.years?(0,i.Z)(t.years):0,l=t.months?(0,i.Z)(t.months):0,c=t.weeks?(0,i.Z)(t.weeks):0,d=t.days?(0,i.Z)(t.days):0,u=t.hours?(0,i.Z)(t.hours):0,h=t.minutes?(0,i.Z)(t.minutes):0,m=t.seconds?(0,i.Z)(t.seconds):0,p=(0,r.Z)(e),v=l||n?(0,a.Z)(p,l+12*n):p,y=d||c?(0,o.Z)(v,d+7*c):v;return new Date(y.getTime()+1e3*(m+60*(h+60*u)))}},8652:function(e,t,n){n.r(t),n.d(t,{default:function(){return eh}});var o=n(47568),a=n(14924),r=n(26042),s=n(69396),i=n(828),l=n(7297),c=n(97582),d=n(85893),u=n(67294),h=n(45697),m=n(66252),p=n(6812),v=n(50319),y=n(75063);function b(){var e=(0,l.Z)(["\n  query GetDashboard(\n    $accountId: Int\n    $adminId: Int\n    $timezone: String\n    $asAt: timestamptz\n    $monthStart: timestamptz\n    $dayStart: timestamptz\n    $userId: Int\n    $currentUserId: Int\n    $yearStart: timestamptz\n  ) {\n    dashboardTilesData: getDashboard_HomeTiles(\n      args: {\n        adminId: $adminId\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      thresholdApprovals\n      quotesNotSubmitted\n      reactiveJobsToday\n      plannedJobsToday\n      complianceJobToday\n      reportUnsent\n      liveP1Jobs\n      liveP2Jobs\n      liveP3Jobs\n      liveP4Jobs\n      liveP5Jobs\n      offeredJobs\n      quotesToday\n      quotesNotSent\n      quotesOverdue\n      quotesDueThisWeek\n      inprogressJobs\n      numberOfOpenJobs\n      jobsInDispute\n      worksValueMTD\n      worksValueYTD\n      overdueComplianceJobs\n      onHold\n      upliftRequested\n      ppmOverdue\n      reactiveOverdue\n      failedJobs\n      jobsWithTimeNotConfirmed\n      jobsRequiringExpenseAmount\n      imminentJobSlaBreaches\n      jobsWithTimeNotConfirmedNext7days\n      jobsWithTimeNotConfirmedCurrentMonth\n      openRemedialQuotes\n      openQuotes\n      imminentQuoteSlaBreaches\n      quoteSlaBreached\n      jobSlaBreachedOnSite\n      jobSlaBreachedJobReport\n    }\n    chartJobsPerDay: getDashboard_HomeTiles_Jobs_perDay(\n      args: {\n        adminId: $adminId\n        timeZone: $timezone\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      jobsOnThisMonth\n    }\n    chartRevenuesPerDay: getDashboard_HomeTiles_Revenues_perDay(\n      args: {\n        adminId: $adminId\n        timeZone: $timezone\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      revenuesOnThisMonth\n    }\n    chartRevenuesPerYear: getDashboard_HomeTiles_Revenues_perYear(\n      args: {\n        adminId: $adminId\n        timeZone: $timezone\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      revenuesOnThisYear\n    }\n  }\n"]);return b=function(){return e},e}function g(){var e=(0,l.Z)(["\n  query GetDashboard(\n    $accountId: Int\n    $adminId: Int\n    $asAt: timestamptz\n    $monthStart: timestamptz\n    $dayStart: timestamptz\n    $userId: Int\n    $yearStart: timestamptz\n  ) {\n    ",": getDashboard_HomeTiles_","(\n      args: {\n        adminId: $adminId\n        asAt: $asAt\n        accountId: $accountId\n        monthStart: $monthStart\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n    ) {\n      sum\n    }\n  }\n"]);return g=function(){return e},e}function f(){var e=(0,l.Z)(["\n  query GetSuppliersLocation($where: UserLocation_bool_exp) {\n    suppliersLocation: UserLocation(distinct_on: userId, where: $where) {\n      id\n      geo\n      account: Account {\n        id\n        name\n      }\n      user: User {\n        id\n        fullName\n      }\n    }\n  }\n"]);return f=function(){return e},e}function w(){var e=(0,l.Z)(['\n  query GetJobsLocation($where: Job_bool_exp) {\n    jobsLocation: Job(where: $where, order_by: { createdAt: desc }) {\n      id\n      number\n      type\n      location: Location {\n        id\n        name\n        addresses: Addresses(\n          where: { registered: { _eq: true }, entity: { _eq: "Location" } }\n          order_by: { createdAt: desc }\n        ) {\n          address: Address {\n            addressLine1\n            addressLine2\n            addressLine3\n            postCode\n            name\n            geo\n          }\n        }\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n    }\n  }\n']);return w=function(){return e},e}var I=(0,y.Ps)(b()),k=(0,y.Ps)(f()),Z=(0,y.Ps)(w()),S=n(11163),j=n.n(S),J=n(83894),M=n(23855),T=n(43703),C=n(69119),N=n(38148),B=n(78200),x=n(10367),A=[{pinned:!0,colourConfig:{success:[0,15],danger:[16,30],warning:[30,null]},name:"reactiveJobsToday",greaterIsBetter:!0},{pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},name:"plannedJobsToday",greaterIsBetter:!0},{pinned:!0,colourConfig:{success:[0,5],danger:[6,10],warning:[11,null]},name:"quotesToday",greaterIsBetter:!0},{pinned:!0,colourConfig:{success:[0,5],danger:[6,10],warning:[11,null]},name:"liveP1Jobs",greaterIsBetter:!0},{name:"chartJobMetrics"},{name:"mapChart"},{name:"numberOfNotifications"}],D=n(29815),q=n(7069),_=n(77349),P=n(29383),L=n(96486),z="/dashboard",$=function(e){var t,n,o,a,i,l,c,d,u,h,m=e.asAt,p=e.userTiles,v=e.dashboardTilesData,y=e.userId,b=e.accountId,g=v||{},f=g.thresholdApprovals,w=g.quotesNotSubmitted,I=g.complianceJobToday,k=g.inprogressJobs,Z=g.liveP1Jobs,S=g.liveP2Jobs,j=g.liveP3Jobs,J=g.liveP4Jobs,M=g.liveP5Jobs,T=g.onHold,C=g.overdueComplianceJobs,N=g.plannedJobsToday,x=g.ppmOverdue,A=g.quotesDueThisWeek,$=g.quotesOverdue,R=g.quotesToday,O=g.reactiveJobsToday,E=g.reportUnsent,W=g.reactiveOverdue,Q=g.upliftRequested,U=g.worksValueMTD,V=g.worksValueYTD,Y=g.jobsOnThisMonth,H=g.revenuesOnThisMonth,G=g.revenuesOnThisYear,F=g.suppliersLocation,K=g.jobsLocation,X=g.failedJobs,ee=g.jobsWithTimeNotConfirmed,et=g.jobsRequiringExpenseAmount,en=g.imminentJobSlaBreaches,eo=g.jobsWithTimeNotConfirmedCurrentMonth,ea=g.jobsWithTimeNotConfirmedNext7days,er=g.openRemedialQuotes,es=g.openQuotes,ei=g.imminentQuoteSlaBreaches,el=g.quoteSlaBreached,ec=g.jobSlaBreachedOnSite,ed=g.jobSlaBreachedJobReport,eu=[],eh=[],em=[],ep=[],ev=[],ey=[],eb=[],eg=[],ef=[],ew=[];if(Y&&Y.length>0&&Y.forEach(function(e,t){var n=e.date,o=e.ppmJobsOnThisMonth,a=e.reactiveJobsOnThisMonth,r=new Date(m),s=new Date(n);if(s>=(0,q.Z)(r,8)&&s<=(0,_.Z)(r,7)){if(Y[t-1])for(var i=Y[t-1].date,l=(0,P.Z)(s,new Date(i)),c=1;c<l;c++)eu.push({date:(0,q.Z)(s,c),values:[]}),ep.push({date:(0,q.Z)(s,c),values:[]});eu.push({date:s,values:o}),ep.push({date:s,values:a})}if(s>=(0,q.Z)(r,15)&&s<=(0,_.Z)(r,14)){if(Y[t-1])for(var d=Y[t-1].date,u=(0,P.Z)(s,new Date(d)),h=1;h<u;h++)eh.push({date:(0,q.Z)(s,h),values:[]}),ev.push({date:(0,q.Z)(s,h),values:[]});eh.push({date:s,values:o}),ev.push({date:s,values:a})}if(s>=(0,q.Z)(r,31)&&s<=(0,_.Z)(r,30)){if(Y[t-1])for(var p=Y[t-1].date,v=(0,P.Z)(s,new Date(p)),y=1;y<v;y++)em.push({date:(0,q.Z)(s,y),values:[]}),ey.push({date:(0,q.Z)(s,y),values:[]});em.push({date:s,values:o}),ey.push({date:s,values:a})}}),H&&H.length>0){var eI="dd/MM";H.forEach(function(e,t){var n=e.date,o=e.revenuesOnThisDay,a=new Date(m),r=new Date(n);if(r>=(0,q.Z)(a,8)){if(H[t-1])for(var s=H[t-1].date,i=(0,P.Z)(new Date(s),r),l=1;l<i;l++)eb.push({date:(0,_.Z)(r,l),sum:[]});eb.push({date:r,sum:o,formatDate:eI})}if(r>=(0,q.Z)(a,15)){if(H[t-1])for(var c=H[t-1].date,d=(0,P.Z)(new Date(c),r),u=1;u<d;u++)eg.push({date:(0,_.Z)(r,u),sum:[]});eg.push({date:r,sum:o,formatDate:eI})}if(r>=(0,q.Z)(a,31)){if(H[t-1])for(var h=H[t-1].date,p=(0,P.Z)(new Date(h),r),v=1;v<p;v++)ef.push({date:(0,_.Z)(r,v),sum:[]});ef.push({date:r,sum:o,formatDate:eI})}})}G&&G.length>0&&G.forEach(function(e){var t=e.date,n=e.revenuesOnThisMonth;ew.push({date:t,sum:n,formatDate:"MM/yyyy"})});var ek=m?(0,B.Z)(m,"yyyy-MM-dd"):"",eZ=[{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,15],danger:[16,30],warning:[30,null]},title:"Reactive jobs today",description:"Reactive jobs scheduled to happen today",name:"reactiveJobsToday",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=reactiveJobsToday").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==O?void 0:O.today)||0,week:(null==O?void 0:O.week)||0,month:(null==O?void 0:O.month)||0,threeMonth:(null==O?void 0:O.threeMonth)||0,year:(null==O?void 0:O.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"PPM jobs today",description:"Planned maintenance jobs scheduled to happen today",name:"plannedJobsToday",to:"".concat(z,"/issues?type=ppm&asAt=").concat(ek,"&tileName=plannedJobsToday").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==N?void 0:N.today)||0,week:(null==N?void 0:N.week)||0,month:(null==N?void 0:N.month)||0,threeMonth:(null==N?void 0:N.threeMonth)||0,year:(null==N?void 0:N.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,5],danger:[6,10],warning:[11,null]},title:"Quotes today",description:"Quotes where due date is today",name:"quotesToday",to:"".concat(z,"/quotes?asAt=").concat(ek,"&tileName=quotesToday").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==R?void 0:R.today)||0,week:(null==R?void 0:R.week)||0,month:(null==R?void 0:R.month)||0,threeMonth:(null==R?void 0:R.threeMonth)||0,year:(null==R?void 0:R.year)||0},greaterIsBetter:!0},{type:"chart",size:[2,1],title:"Jobs metrics",name:"chartJobMetrics",values:{week:[{groupLabel:"Jobs per day",groupName:"jobsPerUnit",groupDescription:"Number of jobs currently in the system for selected time range",chartData:[{label:"Planned",color:"#1E88E5",data:null!==(t=(0,L.orderBy)(eu,"date","asc"))&&void 0!==t?t:[]},{label:"Reactive",color:"#cfd9e0",data:null!==(n=(0,L.orderBy)(ep,"date","asc"))&&void 0!==n?n:[]}]},{groupLabel:"Revenue per day",groupName:"revenuesPerUnit",groupDescription:"Sum of all job totals by day for selected time range",chartData:[{label:"Revenue",color:"#1E88E5",data:null!==(o=(0,L.orderBy)(eb,"date","asc"))&&void 0!==o?o:[]}]}],twoWeeks:[{groupLabel:"Jobs per day",groupName:"jobsPerUnit",groupDescription:"Number of jobs currently in the system for selected time range",chartData:[{label:"Planned",color:"#1E88E5",data:null!==(a=(0,L.orderBy)(eh,"date","asc"))&&void 0!==a?a:[]},{label:"Reactive",color:"#cfd9e0",data:null!==(i=(0,L.orderBy)(ev,"date","asc"))&&void 0!==i?i:[]}]},{groupLabel:"Revenue per day",groupName:"revenuesPerUnit",groupDescription:"Sum of all job totals by day for selected time range",chartData:[{label:"Revenue",color:"#1E88E5",data:null!==(l=(0,L.orderBy)(eg,"date","asc"))&&void 0!==l?l:[]}]}],month:[{groupLabel:"Jobs per day",groupName:"jobsPerUnit",groupDescription:"Number of jobs currently in the system for selected time range",chartData:[{label:"Planned",color:"#1E88E5",data:null!==(c=(0,L.orderBy)(em,"date","asc"))&&void 0!==c?c:[]},{label:"Reactive",color:"#cfd9e0",data:null!==(d=(0,L.orderBy)(ey,"date","asc"))&&void 0!==d?d:[]}]},{groupLabel:"Revenue per day",groupName:"revenuesPerUnit",groupDescription:"Sum of all job totals by day for selected time range",chartData:[{label:"Revenue",color:"#1E88E5",data:null!==(u=(0,L.orderBy)(ef,"date","asc"))&&void 0!==u?u:[]}]}],year:[{groupLabel:"Monthly job revenue",groupName:"revenuesPerYear",groupDescription:"Sum of all job totals by day for selected time range",chartData:[{label:"Revenue",color:"#1E88E5",data:null!==(h=(0,L.orderBy)(ew,"date","asc"))&&void 0!==h?h:[]}]}]}},{type:"mapChart",size:[2,1],title:"Geolocation info",name:"mapChart",values:{month:[{groupLabel:"Last supplier location",groupName:"suppliersLocation",groupDescription:"Last supplier location",chartData:[{label:"Last supplier location",markerIcon:"supplier",data:(null==F?void 0:F.month)||[]}]},{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==K?void 0:K.month)||[]}]}],threeMonth:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==K?void 0:K.threeMonth)||[]}]}],tomorrow:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==K?void 0:K.tomorrow)||[]}]}],today:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==K?void 0:K.today)||[]}]}],nextWeek:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==K?void 0:K.nextWeek)||[]}]}],nextTwoWeeks:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==K?void 0:K.nextTwoWeeks)||[]}]}],nextMonth:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==K?void 0:K.nextMonth)||[]}]}],week:[{groupLabel:"Job location by post-code",groupName:"jobsLocation",groupDescription:"Job location by post-code",chartData:[{label:"Job location by post-code",markerIcon:"job",data:(null==K?void 0:K.week)||[]}]}]}},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"Live P1 jobs",description:"Jobs with P1 status scheduled for today but not completed",name:"liveP1Jobs",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=liveP1Jobs").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==Z?void 0:Z.today)||0,week:(null==Z?void 0:Z.week)||0,month:(null==Z?void 0:Z.month)||0,threeMonth:(null==Z?void 0:Z.threeMonth)||0,year:(null==Z?void 0:Z.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"P2 jobs today",description:"Jobs with P2 status scheduled for today but not completed",name:"liveP2Jobs",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=liveP2Jobs").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==S?void 0:S.today)||0,week:(null==S?void 0:S.week)||0,month:(null==S?void 0:S.month)||0,threeMonth:(null==S?void 0:S.threeMonth)||0,year:(null==S?void 0:S.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"P3 jobs today",description:"Jobs with P3 status scheduled for today but not completed",name:"liveP3Jobs",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=liveP3Jobs").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==j?void 0:j.today)||0,week:(null==j?void 0:j.week)||0,month:(null==j?void 0:j.month)||0,threeMonth:(null==j?void 0:j.threeMonth)||0,year:(null==j?void 0:j.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"P4 jobs today",description:"Jobs with P4 status scheduled for today but not completed",name:"liveP4Jobs",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=liveP4Jobs").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==J?void 0:J.today)||0,week:(null==J?void 0:J.week)||0,month:(null==J?void 0:J.month)||0,threeMonth:(null==J?void 0:J.threeMonth)||0,year:(null==J?void 0:J.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"P5 jobs today",description:"Jobs with P5 status scheduled for today but not completed",name:"liveP5Jobs",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=liveP5Jobs").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==M?void 0:M.today)||0,week:(null==M?void 0:M.week)||0,month:(null==M?void 0:M.month)||0,threeMonth:(null==M?void 0:M.threeMonth)||0,year:(null==M?void 0:M.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"Overdue reactive jobs",description:"Reactive jobs that have not yet been started or completed 24 hours after scheduled time",name:"reactiveOverdue",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=reactiveOverdue").concat(y?"&userId=".concat(y):""),values:{today:(null==W?void 0:W.today)||0,week:(null==W?void 0:W.week)||0,month:(null==W?void 0:W.month)||0,threeMonth:(null==W?void 0:W.threeMonth)||0,year:(null==W?void 0:W.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"Overdue PPM",description:"Planned maintenance jobs that have not yet been started or completed 24 hours after scheduled time",name:"ppmOverdue",to:"".concat(z,"/issues?type=ppm&asAt=").concat(ek,"&tileName=ppmOverdue").concat(y?"&userId=".concat(y):""),values:{today:(null==x?void 0:x.today)||0,week:(null==x?void 0:x.week)||0,month:(null==x?void 0:x.month)||0,threeMonth:(null==x?void 0:x.threeMonth)||0,year:(null==x?void 0:x.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"Quotes overdue",description:"Quotes which are past due date but have not had resolution.",name:"quotesOverdue",to:"".concat(z,"/quotes?asAt=").concat(ek,"&tileName=quotesOverdue").concat(y?"&userId=".concat(y):""),values:{today:(null==$?void 0:$.today)||0,week:(null==$?void 0:$.week)||0,month:(null==$?void 0:$.month)||0,threeMonth:(null==$?void 0:$.threeMonth)||0,year:(null==$?void 0:$.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Compliance jobs today",description:"Compliance work orders that are scheduled to take place today",name:"complianceJobToday",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=complianceJobToday").concat(y?"&userId=".concat(y):""),values:{today:(null==I?void 0:I.today)||0,week:(null==I?void 0:I.week)||0,month:(null==I?void 0:I.month)||0,threeMonth:(null==I?void 0:I.threeMonth)||0,year:(null==I?void 0:I.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Overdue compliance jobs",description:"Compliance jobs that have not yet been started or completed 24 hours after scheduled time",name:"overdueComplianceJobs",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=overdueComplianceJobs").concat(y?"&userId=".concat(y):""),values:{today:(null==C?void 0:C.today)||0,week:(null==C?void 0:C.week)||0,month:(null==C?void 0:C.month)||0,threeMonth:(null==C?void 0:C.threeMonth)||0,year:(null==C?void 0:C.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,20],danger:[21,40],warning:[41,null]},title:"Jobs in progress",description:"Jobs currently in progress",name:"inprogressJobs",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=inprogressJobs").concat(y?"&userId=".concat(y):""),values:{today:(null==k?void 0:k.today)||0,week:(null==k?void 0:k.week)||0,month:(null==k?void 0:k.month)||0,threeMonth:(null==k?void 0:k.threeMonth)||0,year:(null==k?void 0:k.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,5],danger:[6,10],warning:[11,null]},title:"Reports unsent",description:"Jobs that have been completed but where a report has not been sent within 24 hours",name:"reportUnsent",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=reportUnsent").concat(y?"&userId=".concat(y):""),values:{today:(null==E?void 0:E.today)||0,week:(null==E?void 0:E.week)||0,month:(null==E?void 0:E.month)||0,threeMonth:(null==E?void 0:E.threeMonth)||0,year:(null==E?void 0:E.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"Jobs on hold",description:"Jobs currently marked as on hold",name:"onHold",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=onHold").concat(y?"&userId=".concat(y):""),values:{today:(null==T?void 0:T.today)||0,week:(null==T?void 0:T.week)||0,month:(null==T?void 0:T.month)||0,threeMonth:(null==T?void 0:T.threeMonth)||0,year:(null==T?void 0:T.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,4],danger:[5,5],warning:[6,null]},title:"Uplift requests",description:"Jobs where an uplift has been requested but not yet approved or rejected",name:"upliftRequested",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=upliftRequested").concat(y?"&userId=".concat(y):""),values:{today:(null==Q?void 0:Q.today)||0,week:(null==Q?void 0:Q.week)||0,month:(null==Q?void 0:Q.month)||0,threeMonth:(null==Q?void 0:Q.threeMonth)||0,year:(null==Q?void 0:Q.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Quotes due this week",description:"Quotes where due date is within next 7 days",name:"quotesDueThisWeek",to:"".concat(z,"/quotes?asAt=").concat(ek,"&tileName=quotesDueThisWeek").concat(y?"&userId=".concat(y):""),values:{today:(null==A?void 0:A.today)||0,week:(null==A?void 0:A.week)||0,month:(null==A?void 0:A.month)||0,threeMonth:(null==A?void 0:A.threeMonth)||0,year:(null==A?void 0:A.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Quotes not submitted",description:"Quotes that have not yet been submitted",name:"quotesNotSubmitted",to:"".concat(z,"/quotes?asAt=").concat(ek,"&tileName=quotesNotSubmitted").concat(y?"&userId=".concat(y):""),values:{today:(null==w?void 0:w.today)||0,week:(null==w?void 0:w.week)||0,month:(null==w?void 0:w.month)||0,threeMonth:(null==w?void 0:w.threeMonth)||0,year:(null==w?void 0:w.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],colourConfig:{success:[0,9],danger:[10,10],warning:[11,null]},title:"Work order value (MTD)",description:"Value of jobs completed in the month to date",name:"worksValueMTD",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=worksValueMTD").concat(y?"&userId=".concat(y):""),values:{today:(null==U?void 0:U.today)||0,week:(null==U?void 0:U.week)||0,month:(null==U?void 0:U.month)||0,threeMonth:(null==U?void 0:U.threeMonth)||0,year:(null==U?void 0:U.year)||0},greaterIsBetter:!0,valueType:"price"},{type:"tile",size:[1,1],colourConfig:{success:[0,9],danger:[10,10],warning:[11,null]},title:"Work order value (YTD)",description:"Value of jobs completed in the year to date",name:"worksValueYTD",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=worksValueYTD").concat(y?"&userId=".concat(y):""),values:{today:(null==V?void 0:V.today)||0,week:(null==V?void 0:V.week)||0,month:(null==V?void 0:V.month)||0,threeMonth:(null==V?void 0:V.threeMonth)||0,year:(null==V?void 0:V.year)||0},greaterIsBetter:!0,valueType:"price"},{type:"tile",size:[1,1],colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Threshold approvals outstanding",description:"Work orders and quotes where approval is required based on threshold levels",name:"thresholdApprovals",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=thresholdApprovals").concat(y?"&userId=".concat(y):""),values:{today:(null==f?void 0:f.today)||0,week:(null==f?void 0:f.week)||0,month:(null==f?void 0:f.month)||0,threeMonth:(null==f?void 0:f.threeMonth)||0,year:(null==f?void 0:f.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Failed jobs",description:"Jobs where supplier has reported failures and these have not been resolved.",name:"failedJobs",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=failedJobs").concat(y?"&userId=".concat(y):""),values:{today:(null==X?void 0:X.today)||0,week:(null==X?void 0:X.week)||0,month:(null==X?void 0:X.month)||0,threeMonth:(null==X?void 0:X.threeMonth)||0,year:(null==X?void 0:X.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Jobs with time not confirmed",description:"Scheduled jobs where an attendance time has not been specified by supplier.",name:"jobsWithTimeNotConfirmed",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=jobsWithTimeNotConfirmed").concat(y?"&userId=".concat(y):""),values:{today:(null==ee?void 0:ee.today)||0,week:(null==ee?void 0:ee.week)||0,month:(null==ee?void 0:ee.month)||0,threeMonth:(null==ee?void 0:ee.threeMonth)||0,year:(null==ee?void 0:ee.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Jobs requiring expense amounts",description:"Jobs where expenses have amount expense pending.",name:"jobsRequiringExpenseAmount",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=jobsRequiringExpenseAmount").concat(y?"&userId=".concat(y):""),values:{today:(null==et?void 0:et.today)||0,week:(null==et?void 0:et.week)||0,month:(null==et?void 0:et.month)||0,threeMonth:(null==et?void 0:et.threeMonth)||0,year:(null==et?void 0:et.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Imminent job SLA breaches",description:"These are jobs where there is a potential SLA breach in 1 hour or less.",name:"imminentJobSlaBreaches",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=imminentJobSlaBreaches").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==en?void 0:en.today)||0,week:(null==en?void 0:en.week)||0,month:(null==en?void 0:en.month)||0,threeMonth:(null==en?void 0:en.threeMonth)||0,year:(null==en?void 0:en.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Jobs with time not confirmed.",subtitle:"Current month",description:"Scheduled jobs that are due to be completed in the current calendar month but where no attendance time has been specified by the supplier.",name:"jobsWithTimeNotConfirmedCurrentMonth",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=jobsWithTimeNotConfirmedCurrentMonth").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==eo?void 0:eo.today)||0,week:(null==eo?void 0:eo.week)||0,month:(null==eo?void 0:eo.month)||0,threeMonth:(null==eo?void 0:eo.threeMonth)||0,year:(null==eo?void 0:eo.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Jobs with time not confirmed",subtitle:"Next 7 days",description:"Scheduled jobs that are due to be completed within the next 7 days but where no attendance time has been specified by the supplier.",name:"jobsWithTimeNotConfirmedNext7days",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=jobsWithTimeNotConfirmedNext7days").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==ea?void 0:ea.today)||0,week:(null==ea?void 0:ea.week)||0,month:(null==ea?void 0:ea.month)||0,threeMonth:(null==ea?void 0:ea.threeMonth)||0,year:(null==ea?void 0:ea.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,5],danger:[6,10],warning:[11,null]},title:"Open remedial quotes",description:"These are remedial quotes that have not yet been resolved -\n        for example, accepted or rejected by the customer or closed.",name:"openRemedialQuotes",to:"".concat(z,"/quotes?asAt=").concat(ek,"&tileName=openRemedialQuotes").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==er?void 0:er.today)||0,week:(null==er?void 0:er.week)||0,month:(null==er?void 0:er.month)||0,threeMonth:(null==er?void 0:er.threeMonth)||0,year:(null==er?void 0:er.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,5],danger:[6,10],warning:[11,null]},title:"Open quotes",description:"These are quotes that have not yet been resolved -\n      for example, accepted or rejected by the customer or closed.",name:"openQuotes",to:"".concat(z,"/quotes?asAt=").concat(ek,"&tileName=openQuotes").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==es?void 0:es.today)||0,week:(null==es?void 0:es.week)||0,month:(null==es?void 0:es.month)||0,threeMonth:(null==es?void 0:es.threeMonth)||0,year:(null==es?void 0:es.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"Imminent quote SLA breaches",description:"These are quotes where there is a potential SLA breach in 1 day or less.",name:"imminentQuoteSlaBreaches",to:"".concat(z,"/quotes?asAt=").concat(ek,"&tileName=imminentQuoteSlaBreaches").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==ei?void 0:ei.today)||0,week:(null==ei?void 0:ei.week)||0,month:(null==ei?void 0:ei.month)||0,threeMonth:(null==ei?void 0:ei.threeMonth)||0,year:(null==ei?void 0:ei.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"SLA breaches",subtitle:"Quotes - Quote return time",description:"These are quotes where the SLA was not returned within the relevant timeframe.",name:"quoteSlaBreached",to:"".concat(z,"/quotes?asAt=").concat(ek,"&tileName=quoteSlaBreached").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==el?void 0:el.today)||0,week:(null==el?void 0:el.week)||0,month:(null==el?void 0:el.month)||0,threeMonth:(null==el?void 0:el.threeMonth)||0,year:(null==el?void 0:el.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"SLA breaches",subtitle:"Work orders - On site time",description:"These are jobs where the time taken for the engineer /\n       operative to arrive on site was beyond the relevant SLA. ",name:"jobSlaBreachedOnSite",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=jobSlaBreachedOnSite").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==ec?void 0:ec.today)||0,week:(null==ec?void 0:ec.week)||0,month:(null==ec?void 0:ec.month)||0,threeMonth:(null==ec?void 0:ec.threeMonth)||0,year:(null==ec?void 0:ec.year)||0},greaterIsBetter:!0},{type:"tile",size:[1,1],pinned:!0,colourConfig:{success:[0,10],danger:[11,20],warning:[21,null]},title:"SLA breaches",subtitle:"Work orders - Report submission time",description:"These are jobs where the time taken to submit the report\n        to the customer was more than the relevant SL.A.",name:"jobSlaBreachedJobReport",to:"".concat(z,"/issues?asAt=").concat(ek,"&tileName=jobSlaBreachedJobReport").concat(y?"&userId=".concat(y):"").concat(b?"&accountId=".concat(b):""),values:{today:(null==ed?void 0:ed.today)||0,week:(null==ed?void 0:ed.week)||0,month:(null==ed?void 0:ed.month)||0,threeMonth:(null==ed?void 0:ed.threeMonth)||0,year:(null==ed?void 0:ed.year)||0},greaterIsBetter:!0}],eS=eZ.map(function(e){return e.name}),ej={success:[0,10],danger:[11,20],warning:[21,null]},eJ=p.reduce(function(e,t){var n,o=t.colourConfig,a=t.pinned,i=t.greaterIsBetter,l=t.name,c=eZ.find(function(e){return e.name===l});return c?(0,D.Z)(e).concat([(0,s.Z)((0,r.Z)({},c),{pinned:null!==(n=null!=a?a:c.pinned)&&void 0!==n&&n,colourConfig:void 0===o?ej:o,greaterIsBetter:void 0===i||i})]):e},[]).sort(function(e,t){return eS.indexOf(e)-eS.indexOf(t)});return{fullTilesList:eZ,userTilesList:eJ}},R=n(5616),O=n(98456),E=n(86886),W=n(62192),Q=n(76665),U=n(44460),V=n(86550),Y=n(12340),H=n(94885),G=n(29422),F=n(30734),K=function(e){var t=e.groupName,n=e.time,o=e.asAt,a=null,r={};switch(t){case"jobsLocation":a=Z;break;case"suppliersLocation":a=k}if("jobsLocation"===t)switch(r.Location={Addresses:{registered:{_eq:!0},entity:{_eq:"Location"},Address:{geo:{_is_null:!1}}}},n){case"today":r._and=[{timingStart:{_lte:o}},{timingStart:{_gte:(0,C.Z)(o)}}];break;case"tomorrow":r._and=[{timingStart:{_lte:(0,G.Z)(o,{days:1})}},{timingStart:{_gte:(0,G.Z)((0,C.Z)(o),{days:1})}}];break;case"nextWeek":r._and=[{timingStart:{_lte:(0,G.Z)(o,{weeks:1})}},{timingStart:{_gte:(0,G.Z)((0,C.Z)(o),{days:1})}}];break;case"nextTwoWeeks":r._and=[{timingStart:{_lte:(0,G.Z)(o,{weeks:2})}},{timingStart:{_gte:(0,G.Z)((0,C.Z)(o),{days:1})}}];break;case"nextMonth":r._and=[{timingStart:{_lte:(0,G.Z)(o,{months:1})}},{timingStart:{_gte:(0,G.Z)((0,C.Z)(o),{days:1})}}];break;case"week":r._and=[{timingStart:{_lte:o}},{timingStart:{_gte:(0,F.Z)(o,{weeks:1})}}];break;case"month":r._and=[{timingStart:{_lte:o}},{timingStart:{_gte:(0,F.Z)(o,{months:1})}}];break;case"threeMonth":r._and=[{timingStart:{_lte:o}},{timingStart:{_gte:(0,F.Z)(o,{months:3})}}]}else r.geo={_is_null:!1},"month"===n&&(r._and=[{createdAt:{_lte:o}},{createdAt:{_gte:(0,F.Z)(o,{months:1})}}]);return{query:a,variables:{where:r}}},X=function(e){var t=e.state,n=e.data,o=e.groupName,i=e.time,l={};if("suppliersLocation"===o)l=(0,s.Z)((0,r.Z)({},t[o]||{}),(0,a.Z)({},i,n[o].map(function(e){var t,n,o,a=e.id,r=e.geo;return{id:a,account:e.account,user:e.user,position:{lat:null===(t=r.coordinates)||void 0===t?void 0:t[1],lng:null===(n=r.coordinates)||void 0===n?void 0:n[0]}}})));else{var c=n[o].map(function(e){var t,n,o,a,r,s=e.id,i=e.number,l=e.type,c=e.location;return{id:s,number:i,type:l,location:c,supplier:e.supplier,service:e.service,position:{lat:null===(t=c.addresses[0].address.geo)||void 0===t?void 0:null===(n=t.coordinates)||void 0===n?void 0:n[1],lng:null===(o=c.addresses[0].address.geo)||void 0===o?void 0:null===(a=o.coordinates)||void 0===a?void 0:a[0]}}});l=(0,s.Z)((0,r.Z)({},t[o]||{}),(0,a.Z)({},i,c))}return l},ee=function(e){var t=e.prevData,n=e.data,o=e.type;return Object.keys(n).reduce(function(e,i){return(0,s.Z)((0,r.Z)({},e),(0,a.Z)({},i,(0,s.Z)((0,r.Z)({},(null==t?void 0:t[i])||{}),(0,a.Z)({},o,n[i]))))},{})},et=function(e){var t,n=e.name,o=e.asAt,a=e.userId,r=e.adminId,s=e.accountId,i=e.time,l=(0,y.Ps)(g(),n,n),c=null;switch(i){case"week":c=(0,F.Z)(o,{weeks:1});break;case"month":c=(0,F.Z)(o,{months:1});break;case"threeMonth":c=(0,F.Z)(o,{months:3});break;case"year":c=(0,F.Z)(o,{years:1})}return{query:l,variables:{adminId:r,accountId:s,asAt:c,dayStart:(0,C.Z)(c),monthStart:(0,T.Z)(c),userId:a,yearStart:(0,N.Z)(c)}}};function en(){var e=(0,l.Z)(["\n  width: 100%;\n  height: 100%;\n\n  .firstBlock {\n    margin: 0;\n    flex-basis: 50% !important;\n    max-width: 50% !important;\n    min-width: auto;\n  }\n\n  .firstBlockItem {\n    padding-left: 24px;\n    padding-top: 24px;\n  }\n\n  .bigTile {\n    flex-basis: 50% !important;\n    max-width: 50%;\n  }\n\n  .secondBlock {\n    margin: 0;\n    flex-basis: 50% !important;\n    min-width: auto;\n  }\n\n  .secondBlockItem {\n    flex-basis: 50% !important;\n    max-width: 50% !important;\n    padding-left: 24px;\n    padding-top: 24px;\n  }\n\n  @media (max-width: 1550px) {\n    .firstBlock {\n      margin: 0;\n      flex-basis: 100% !important;\n      max-width: 100% !important;\n    }\n\n    .bigTile {\n      flex-basis: 100% !important;\n      max-width: 100%;\n    }\n\n    .secondBlock {\n      flex-basis: 100% !important;\n    }\n    .restTilesBoxItem {\n      flex-basis: 100% !important;\n    }\n  }\n\n  @media (max-width: 800px) {\n    .secondBlock {\n      flex-basis: 100% !important;\n    }\n    .secondBlockItem {\n      flex-basis: 100% !important;\n      max-width: 100% !important;\n  }\n"]);return en=function(){return e},e}function eo(){var e=(0,l.Z)(["\n  align-content: flex-start;\n  height: auto;\n  min-height: 400px;\n  justify-content: space-between;\n"]);return eo=function(){return e},e}function ea(){var e=(0,l.Z)(["\n  display: flex;\n  flex-wrap: wrap;\n\n  min-width: 824px;\n\n  justify-content: space-between;\n  align-content: space-between;\n"]);return ea=function(){return e},e}function er(){var e=(0,l.Z)(["\n  justify-content: space-between;\n"]);return er=function(){return e},e}var es=(0,J.Z)(new Date),ei=function(e){var t,n,l=e.user;e.theme;var h=(0,S.useRouter)(),y=(0,m.x)(),b=(0,u.useState)(!1),g=b[0],f=b[1],w=(0,u.useState)({}),k=w[0],Z=w[1],x=(0,u.useState)(A),D=x[0],q=x[1],_=(0,u.useState)([]),P=_[0],L=_[1],z=(0,u.useState)([]),G=z[0],F=z[1],en=(0,u.useState)(h.query.asAt?(0,J.Z)((0,M.Z)(h.query.asAt)):es)[0],eo=(0,u.useState)({monthStart:(0,T.Z)(en),todayEnd:(0,J.Z)(en),todayStart:(0,C.Z)(en),yearStart:(0,N.Z)(en)})[0],ea=(0,u.useState)(h.query.userId?h.query.userId:l.id)[0];(0,u.useEffect)(function(){"/dashboard"===j().pathname&&j().push({pathname:"/dashboard",query:(0,s.Z)((0,r.Z)({},h.query),{asAt:(0,B.Z)(en,"yyyy-MM-dd"),userId:ea})})},[en,ea]);var er=(0,p.a)(H.iM,{variables:{userId:l.id,accountId:l.accountId}}),ei=er.data,eh=er.refetch,em=(null==ei?void 0:null===(t=ei.accountUser)||void 0===t?void 0:null===(n=t[0])||void 0===n?void 0:n.meta)||{},ep=(0,i.Z)((0,v.D)(H.fA),1)[0];(0,u.useEffect)(function(){(null==em?void 0:em.dashboard)&&q(em.dashboard)},[em]),(0,u.useEffect)(function(){var e=$({asAt:en,dashboardTilesData:(0,r.Z)({},k),userTiles:D,accountId:l.accountId,userId:ea}),t=e.userTilesList,n=e.fullTilesList;F(t),L(n)},[k]);var ev,ey,eb,eg=(0,p.a)(I,{variables:{accountId:l.accountId,timezone:Intl.DateTimeFormat().resolvedOptions().timeZone,adminId:l.adminId,asAt:en,currentUserId:l.id,dayStart:eo.todayStart,monthStart:eo.monthStart,userId:ea,yearStart:eo.yearStart},onCompleted:function(e){Z(function(t){return(0,r.Z)((0,s.Z)((0,r.Z)({},t,ee({prevData:t,data:e.dashboardTilesData[0],type:"today"})),{jobsOnThisMonth:e.chartJobsPerDay.jobsOnThisMonth}),e.chartRevenuesPerDay[0],e.chartRevenuesPerYear[0])}),eI()}}),ef=eg.loading,ew=eg.refetch,eI=(ev=(0,o.Z)(function(){var e,t;return(0,c.__generator)(this,function(e){switch(e.label){case 0:var n;return[4,Promise.all(D.map((n=(0,o.Z)(function(e){var t,n,o,r,s,d,u,h,m,p;return(0,c.__generator)(this,function(n){switch(n.label){case 0:if(t=e.name,"tile"!==e.type)return[2,{}];return r=(o=et({name:t,asAt:en,adminId:l.adminId,accountId:l.accountId,userId:ea,time:"week"})).query,s=o.variables,[4,y.query({query:r,variables:s})];case 1:return h=void 0===(u=n.sent().data)?(0,a.Z)({},t,[{sum:0}]):u,p=(0,i.Z)(h[t],1)[0].sum,[2,(0,a.Z)({},t,p||0)]}})}),function(e){return n.apply(this,arguments)})))];case 1:return t=e.sent().reduce(function(e,t){return(0,r.Z)({},e,t)},{}),Z(function(e){return(0,r.Z)({},e,ee({prevData:e,data:t,type:"week"}))}),[2]}})}),function(){return ev.apply(this,arguments)}),ek=function(e){var t=e.tiles,n=e.skipRefetch,o=e.skipRefetchMeta;ep({variables:{userId:l.id,accountId:l.accountId,changes:{meta:(0,s.Z)((0,r.Z)({},em),{dashboard:t})}}}).then(function(){n||ew(),o||eh()})},eZ=function(e){ek({tiles:D.filter(function(t){return t.name!==e})})},eS=function(e,t){ek({tiles:D.map(function(n){return n.name===e?(0,s.Z)((0,r.Z)({},n),{colourConfig:t}):n}),skipRefetch:!0})},ej=(ey=(0,o.Z)(function(e,t){var n,o,d,u,h,m,p,v;return(0,c.__generator)(this,function(c){switch(c.label){case 0:return o=(n=et({name:e,asAt:en,adminId:l.adminId,accountId:l.accountId,userId:ea,time:t})).query,d=n.variables,[4,y.query({query:o,variables:d})];case 1:return m=void 0===(h=c.sent().data)?(0,a.Z)({},e,[{sum:0}]):h,v=(0,i.Z)(m[e],1)[0].sum,Z(function(n){return(0,s.Z)((0,r.Z)({},n),(0,a.Z)({},e,(0,s.Z)((0,r.Z)({},n[e]||{}),(0,a.Z)({},t,v||0))))}),[2]}})}),function(e,t){return ey.apply(this,arguments)}),eJ=(eb=(0,o.Z)(function(e,t){var n,o,i,l;return(0,c.__generator)(this,function(c){switch(c.label){case 0:return o=(n=K({groupName:e,time:t,asAt:en})).query,i=n.variables,[4,y.query({query:o,variables:i})];case 1:return l=c.sent().data,Z(function(n){return(0,s.Z)((0,r.Z)({},n),(0,a.Z)({},e,X({state:n,data:l,groupName:e,time:t})))}),[2]}})}),function(e,t){return eb.apply(this,arguments)}),eM=(0,u.useCallback)(function(){var e=[],t=[],n=[],o=[];if(G.forEach(function(e){"tile"===e.type&&e.pinned?t.push(e):"mapChart"===e.type||"chart"===e.type?n.push(e):o.push(e)}),t.length){var a=(0,d.jsx)(ed,{container:!0,spacing:3,className:"firstBlock",children:t.map(function(e){var t=e.title,n=e.subtitle,o=e.name,a=e.description,r=e.colourConfig,s=e.values,i=e.valueType,l=e.size,c=e.to,u=e.greaterIsBetter;return(0,d.jsx)(Q.Z,{name:o,asAt:en,className:"firstBlockItem",xs:12,sm3:6,colourConfig:r,title:t,subtitle:n,description:a,to:c,values:s,valueType:i,size:l,greaterIsBetter:u,editable:!0,onEdit:function(){return f(!0)},onVersusChange:ej,onConfigChange:eS})})});e.push(a)}if(n.length){var r=n.map(function(e){var t=e.type,n=e.title,o=e.description,a=e.name,r=e.values,s=e.size;return"chart"===t?(0,d.jsx)(E.ZP,{item:!0,className:"bigTile",children:(0,d.jsx)(U.Z,{asAt:en,title:n,description:o,showLegend:!0,name:a,data:r,size:s})}):"mapChart"===t?(0,d.jsx)(E.ZP,{item:!0,className:"bigTile",children:(0,d.jsx)(V.Z,{asAt:en,title:n,description:o,showLegend:!0,name:a,data:r,size:s,onChangeChartGroup:eJ})}):null});e.push(r)}if(n.length%2==0){var s=o.splice(0,4),i=(0,d.jsx)(ed,{container:!0,spacing:3,className:"secondBlock",children:s.slice(0,4).map(function(e,t){var n=e.title,o=e.subtitle,a=e.name,r=e.description,i=e.colourConfig,l=e.values,c=e.valueType,u=e.size,h=e.to,m=e.greaterIsBetter;return(0,d.jsx)(Q.Z,{name:a,asAt:en,className:"secondBlockItem",sm:12,lg:6,xl:t===s.length-4?12:4,colourConfig:i,title:n,subtitle:o,description:r,to:h,values:l,valueType:c,size:u,greaterIsBetter:m,onVersusChange:ej,onConfigChange:eS})})});e.push(i)}var l=o.map(function(e){var t=e.name,n=e.title,o=e.subtitle,a=e.description,r=e.colourConfig,s=e.values,i=e.valueType,l=e.size,c=e.to,u=e.greaterIsBetter;return(0,d.jsx)(Q.Z,{asAt:en,xs:12,sm3:6,xl:3,className:"restTilesBoxItem",colourConfig:r,name:t,title:n,subtitle:o,description:a,to:c,values:s,valueType:i,size:l,greaterIsBetter:u,editable:!0,onEdit:function(){return f(!0)},deletable:!0,onDelete:eZ,onVersusChange:ej,onConfigChange:eS})});P.length>G.length&&l.push((0,d.jsx)(W.Z,{width:"100%",xs:12,sm3:6,xl:3,onAddCard:function(){return f(!0)}}));var c=(0,d.jsx)(eu,{container:!0,spacing:3,m:0,sx:{justifyContent:"flex-start"},children:l});return e.push(c),(0,d.jsx)(ec,{container:!0,spacing:3,children:e})},[G]);return(0,d.jsxs)(R.Z,{sx:{width:"100%",height:"100%"},children:[(0,d.jsx)(el,{children:ef?(0,d.jsx)(R.Z,{sx:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,d.jsx)(O.Z,{})}):eM()}),(0,d.jsx)(Y.Z,{open:g,fullTilesList:P,selectedTiles:D,onSaveTilesList:function(e){return ek({tiles:e})},onClose:function(){return f(!1)}})]})},el=(0,x.ZP)(R.Z).withConfig({displayName:"dashboard__DashboardBox",componentId:"sc-4fd968d3-0"})(en()),ec=(0,x.ZP)(E.ZP).withConfig({displayName:"dashboard__SecondRowBox",componentId:"sc-4fd968d3-1"})(eo()),ed=(0,x.ZP)(E.ZP).withConfig({displayName:"dashboard__FirstBox",componentId:"sc-4fd968d3-2"})(ea()),eu=(0,x.ZP)(E.ZP).withConfig({displayName:"dashboard__RestTilesBox",componentId:"sc-4fd968d3-3"})(er());ei.propTypes={user:h.object.isRequired};var eh=(0,x.Zz)(ei)}}]);