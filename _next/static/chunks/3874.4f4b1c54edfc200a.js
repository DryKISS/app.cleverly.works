"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3874],{23874:function(e,t,n){n.r(t),n.d(t,{RIGHT_CLICK_IMAGE_COMMAND:function(){return M},default:function(){return N}});var r=n(828),a=n(85893),i=n(46895),l=n(89357),o=n(63786),s=n(67294);let u=[["Cat","rgb(125, 50, 0)"],["Dog","rgb(100, 0, 0)"],["Rabbit","rgb(150, 0, 0)"],["Frog","rgb(200, 0, 0)"],["Fox","rgb(200, 75, 0)"],["Hedgehog","rgb(0, 75, 0)"],["Pigeon","rgb(0, 125, 0)"],["Squirrel","rgb(75, 100, 0)"],["Bear","rgb(125, 100, 0)"],["Tiger","rgb(0, 0, 150)"],["Leopard","rgb(0, 0, 200)"],["Zebra","rgb(0, 0, 250)"],["Wolf","rgb(0, 100, 150)"],["Owl","rgb(0, 100, 100)"],["Gull","rgb(100, 0, 100)"],["Squid","rgb(150, 0, 150)"]],c=u[Math.floor(Math.random()*u.length)],d=(0,s.createContext)({clientID:0,color:c[1],isCollabActive:!1,name:c[0],yjsDocMap:new Map});var f=function(e){let t=new URLSearchParams;t.append("code",e);for(let n=1;n<arguments.length;n++)t.append("v",arguments[n]);throw Error(`Minified Lexical error #${e}; visit https://lexical.dev/docs/error?${t} for the full message or use the non-minified dev environment for full errors and additional helpful warnings.`)};function g(e){let t=e.transform();return null!==t?new Set([t]):new Set}function m({initialEditor:e,children:t,initialNodes:n,initialTheme:r,skipCollabChecks:a}){let l=(0,s.useRef)(!1),o=(0,s.useContext)(i.YK);null==o&&f(9);let[u,{getTheme:c}]=o,m=(0,s.useMemo)(()=>{let t=r||c()||void 0,a=(0,i.LI)(o,t);if(void 0!==t&&(e._config.theme=t),e._parentEditor=u,n)for(let l of n){let s=null,d=null;if("function"!=typeof l){let f=l;l=f.replace,s=f.with,d=f.withKlass||null}let m=e._nodes.get(l.getType());e._nodes.set(l.getType(),{exportDOM:m?m.exportDOM:void 0,klass:l,replace:s,replaceWithKlass:d,transforms:g(l)})}else{let h=e._nodes=new Map(u._nodes);for(let[p,b]of h)e._nodes.set(p,{exportDOM:b.exportDOM,klass:b.klass,replace:b.replace,replaceWithKlass:b.replaceWithKlass,transforms:g(b.klass)})}return e._config.namespace=u._config.namespace,e._editable=u._editable,[e,a]},[]),{isCollabActive:h,yjsDocMap:p}=function(e,t){let n=(0,s.useContext)(d);return null!=e&&(n.name=e),null!=t&&(n.color=t),n}(),b=a||l.current||p.has(e.getKey());return(0,s.useEffect)(()=>{b&&(l.current=!0)},[b]),(0,s.useEffect)(()=>u.registerEditableListener(t=>{e.setEditable(t)}),[e,u]),s.createElement(i.YK.Provider,{value:m},!h||b?t:null)}var h=n(68218),p=n(61084);function b(e,t){return e.getEditorState().read(()=>{let e=(0,p.gI)(t);return null!==e&&e.isSelected()})}var v=n(18824),C=n(72981),x=n(67798),E=n(37563),_=n(96261),w=n(21598),K=new Set,M=(0,p.fA)("RIGHT_CLICK_IMAGE_COMMAND");function S(e){var t=e.altText,n=e.className,r=e.imageRef,i=e.src,l=e.width,o=e.height,s=e.maxWidth;return!function(e){if(!K.has(e))throw new Promise(function(t){var n=new Image;n.src=e,n.onload=function(){K.add(e),t(null)}})}(i),(0,a.jsx)("img",{className:n||void 0,src:i,alt:t,ref:r,style:{height:o,maxWidth:s,width:l},draggable:"false"})}function N(e){var t=e.className,n=e.src,u=e.altText,c=e.nodeKey,d=e.width,f=e.height,g=e.maxWidth,K=e.resizable,N=e.showCaption,k=e.caption,L=e.captionsEnabled,j=(0,s.useRef)(null),I=(0,s.useRef)(null),R=(0,r.Z)(function(e){let[t]=(0,i.g)(),[n,r]=(0,s.useState)(()=>b(t,e));return(0,s.useEffect)(()=>{let n=!0,a=t.registerUpdateListener(()=>{n&&r(b(t,e))});return()=>{n=!1,a()}},[t,e]),[n,(0,s.useCallback)(n=>{t.update(()=>{let t=(0,p.dL)();(0,p.iO)(t)||(t=(0,p.h5)(),(0,p.oq)(t)),(0,p.iO)(t)&&(n?t.add(e):t.delete(e))})},[t,e]),(0,s.useCallback)(()=>{t.update(()=>{let e=(0,p.dL)();(0,p.iO)(e)&&e.clear()})},[t])]}(c),3),O=R[0],D=R[1],y=R[2],B=(0,s.useState)(!1),T=B[0],W=B[1],A=(0,r.Z)((0,i.g)(),1)[0],P=(0,s.useState)(null),q=P[0],G=P[1],H=(0,s.useRef)(null),Z=(0,s.useState)(function(){return A.isEditable()}),z=Z[0],F=Z[1];(0,s.useEffect)(function(){return A.registerEditableListener(function(e){F(e)})},[A]);var U=(0,s.useCallback)(function(e){if(O&&(0,p.iO)((0,p.dL)())){e.preventDefault();var t=(0,p.gI)(c);if((0,_.dP)(t))return t.remove(),!0}return!1},[O,c]),$=(0,s.useCallback)(function(e){var t=(0,p.dL)(),n=I.current;if(O&&(0,p.iO)(t)&&1===t.getNodes().length){if(N)return(0,p.oq)(null),e.preventDefault(),k.focus(),!0;if(null!==n&&n!==document.activeElement)return e.preventDefault(),n.focus(),!0}return!1},[k,O,N]),V=(0,s.useCallback)(function(e){return(H.current===k||I.current===e.target)&&((0,p.oq)(null),A.update(function(){D(!0);var e=A.getRootElement();null!==e&&e.focus()}),!0)},[k,A,D]),X=(0,s.useCallback)(function(e){return!!T||e.target===j.current&&(e.shiftKey?D(!O):(y(),D(!0)),!0)},[T,O,D,y]),Y=(0,s.useCallback)(function(e){A.getEditorState().read(function(){var t=(0,p.dL)();"IMG"===e.target.tagName&&(0,p.OP)(t)&&1===t.getNodes().length&&A.dispatchCommand(M,e)})},[A]);(0,s.useEffect)(function(){var e=!0,t=A.getRootElement(),n=(0,v.qV)(A.registerUpdateListener(function(t){var n=t.editorState;e&&G(n.read(function(){return(0,p.dL)()}))}),A.registerCommand(p.oj,function(e,t){return H.current=t,!1},p.KB),A.registerCommand(p.Kr,X,p.KB),A.registerCommand(M,X,p.KB),A.registerCommand(p.XI,function(e){return e.target===j.current&&(e.preventDefault(),!0)},p.KB),A.registerCommand(p.MK,U,p.KB),A.registerCommand(p.aR,U,p.KB),A.registerCommand(p.XN,$,p.KB),A.registerCommand(p.Zq,V,p.KB));return null==t||t.addEventListener("contextmenu",Y),function(){e=!1,n(),null==t||t.removeEventListener("contextmenu",Y)}},[y,A,T,O,c,U,$,V,X,Y,D]);var J=function(){A.update(function(){var e=(0,p.gI)(c);(0,_.dP)(e)&&e.setShowCaption(!0)})},Q=function(e,t){setTimeout(function(){W(!1)},200),A.update(function(){var n=(0,p.gI)(c);(0,_.dP)(n)&&n.setWidthAndHeight(e,t)})},ee=function(){W(!0)},et=(0,C.V)().historyState,en=O&&(0,p.iO)(q)&&!T,er=O||T;return(0,a.jsx)(s.Suspense,{fallback:null,children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{draggable:en,children:(0,a.jsx)(S,{className:z&&er?"focused ".concat((0,p.iO)(q)?"draggable":""," ").concat(t):"".concat(t||""),src:n,altText:u,imageRef:j,width:d,height:f,maxWidth:g})}),N&&(0,a.jsx)("div",{className:"image-caption-container",children:(0,a.jsxs)(m,{initialEditor:k,children:[(0,a.jsx)(x.Nz,{}),(0,a.jsx)(x.Hi,{}),(0,a.jsx)(o.e,{externalHistoryState:et}),(0,a.jsx)(h.B,{contentEditable:(0,a.jsx)(w.f$,{className:"ImageNode__contentEditable"}),placeholder:(0,a.jsx)("div",{className:"ImageNode__placeholder",children:"Enter a caption..."}),ErrorBoundary:l.Z})]})}),z&&K&&(0,p.iO)(q)&&er&&(0,a.jsx)(E.Z,{showCaption:N,setShowCaption:J,editor:A,buttonRef:I,imageRef:j,maxWidth:g,onResizeStart:ee,onResizeEnd:Q,captionsEnabled:L})]})})}}}]);