"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1650],{95839:function(n,e,t){t.d(e,{W:function(){return d}});var i=t(47568),o=t(7297),r=t(97582),a=t(75063),u=t(35374);function s(){var n=(0,o.Z)(["\n  mutation CreateSupplierPpmInvoicePdf($accountEntryId: Int!) {\n    invoice: createSupplierPpmInvoicePdf(accountEntryId: $accountEntryId) {\n      success\n      key\n    }\n  }\n"]);return s=function(){return n},n}var c,d=(c=(0,i.Z)(function(n){var e,t,i,o,a,s,c,d,m,p,f;return(0,r.__generator)(this,function(r){switch(r.label){case 0:e=n.client,t=n.accountEntryId,i=n.getUrl,r.label=1;case 1:return r.trys.push([1,3,,4]),a="",(0,u.a)()||i||(o=window.open("/download","_blank")),[4,e.mutate({mutation:l,variables:{accountEntryId:t}})];case 2:return d=r.sent().data.invoice.key,i?a="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(d):(null==o||null===(m=o.location)||void 0===m||m.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(d)),(null==window?void 0:null===(p=window.Capacitor)||void 0===p?void 0:null===(f=p.Plugins)||void 0===f?void 0:f.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(d)})),[2,a];case 3:return r.sent(),[3,4];case 4:return[2]}})}),function(n){return c.apply(this,arguments)}),l=(0,a.Ps)(s())},70768:function(n,e,t){t.d(e,{I:function(){return m}});var i=t(26042),o=t(69396),r=t(99534),a=t(85893),u=t(5616),s=t(51233),c=t(50135),d=t(90948),l=t(15861),m=function(n){var e=n.leftLabel,t=n.rightLabel,u=n.error,c=(0,r.Z)(n,["leftLabel","rightLabel","error"]);return(0,a.jsxs)(s.Z,{direction:"row",alignItems:"center",children:[(0,a.jsx)(p,{sx:{borderTopLeftRadius:"5px",borderBottomLeftRadius:"5px"},error:u,children:(0,a.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",whiteSpace:"nowrap"},children:e})}),(0,a.jsx)(f,(0,o.Z)((0,i.Z)({},c),{variant:"outlined",size:"small",error:u})),(0,a.jsx)(p,{sx:{borderTopRightRadius:"5px",borderBottomRightRadius:"5px"},error:u,children:(0,a.jsx)(l.Z,{sx:{display:"flex",justifyContent:"center",alignItems:"center",whiteSpace:"nowrap"},variant:"body2",fontWeight:700,children:t})})]})},p=(0,d.ZP)(u.Z)(function(n){var e=n.theme;return{display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:n.error?e.palette.danger.main:"#D9D9D9",minwidth:"28px",height:"28px",padding:"0 5px"}}),f=(0,d.ZP)(c.Z)(function(n){var e=n.theme,t=n.error;return{height:"28px","& .MuiInputBase-root ":{borderRadius:"0px","&.Mui-focused":{"& .MuiOutlinedInput-notchedOutline":{borderColor:t?e.palette.danger.main:"#D9D9D9"}},"& .MuiInputBase-input":{padding:"2px 14px",borderColor:t?e.palette.danger.main:"#D9D9D9",borderStyle:"solid",borderBottomWidth:"2.5px",borderTopWidth:"2px"},"& .MuiOutlinedInput-notchedOutline":{border:"none"}}}})},49432:function(n,e,t){t.d(e,{N:function(){return i}});var i=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return[{context:"secondary",icon:["fas","edit"],onClick:e.onEditClick,to:"".concat(n,"manage"),tooltip:"Edit"},{context:"danger",icon:["fas","trash"],onClick:e.onDeleteClick,tooltip:"Delete"}]}},76140:function(n,e,t){t.d(e,{e:function(){return r}});var i=t(29815),o=t(31312),r=function(n,e){var t=(0,i.Z)(null==n?void 0:n.timings).sort(function(n,e){return e.id-n.id});return Array.isArray(e)?t.find(function(n){var t=n.status;return o.yW.find(function(n){return n.value===t&&!e.includes(t)})}):t.find(function(n){var t=n.status;return o.yW.find(function(n){return n.value===t&&t!==e})})}},96715:function(n,e,t){t.d(e,{il:function(){return r},j$:function(){return i},wo:function(){return o}});var i=function(n,e){if(Array.isArray(e)){var t,i,o=null;return e.forEach(function(e){var t,i,r=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});o=(null==r?void 0:null===(i=r.user)||void 0===i?void 0:i.fullName)||o}),o}var r=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});return(null==r?void 0:null===(i=r.user)||void 0===i?void 0:i.fullName)||null},o=function(n,e){if(Array.isArray(e)){var t,i=null;return e.forEach(function(e){var t,o=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});i=(null==o?void 0:o.id)||i}),i}var o=null===(t=n.timings)||void 0===t?void 0:t.find(function(n){return n.status===e});return(null==o?void 0:o.id)||null},r=function(n,e){return!n||n>e}},57779:function(n,e,t){t.d(e,{G:function(){return M}});var i=t(26042),o=t(69396),r=t(85893),a=t(45697),u=t.n(a),s=t(6812),c=t(92711),d=t(45451),l=t(11013),m=t(3770),p=t(452),f=t(40826),v=function(n,e){var t=function(){return(0,r.jsx)(f.Z,{context:"success",icon:"check",size:"sm",title:"Yes"})},i=function(){return(0,r.jsx)(f.Z,{context:"warning",icon:"times",size:"sm",title:"No"})},o=function(){return(0,r.jsx)(f.Z,{context:"dark",icon:"minus",size:"sm",title:"Unavailable"})};return"image"===n?(null==e?void 0:e.thumbnails)&&(null==e?void 0:e.thumbnails.length)?t:i:o},h=t(12632),y=t(74944),g=t(86532),b=t(22797),I=t(38895),x=t(5616),Z=t(11057),j=t(51233),w=t(21023),_=t(15861),q=t(14924),A=t(70872),S=t(58886),$=t(90948),P=t(67294),C=t(77314),T=(0,t(42850).bH)(C.ZP),R=function(n){var e=n.images,t=n.showPagination,o=n.height,a=(0,P.useState)(0),u=a[0],s=a[1],c=function(n){s(n)};return(0,r.jsxs)(j.Z,{width:"100%",alignItems:"center",children:[(0,r.jsx)(T,{index:u,onChangeIndex:c,enableMouseEvents:!0,interval:1e4,children:e.map(function(n){return(0,r.jsx)(x.Z,{component:"img",sx:{height:o,display:"block",overflow:"hidden",width:"100%",objectFit:"cover"},src:n.filename,alt:n.caption},n.caption)})}),t&&e.length>1&&(0,r.jsx)(D,{page:u+1,count:e.length,onChange:function(n,e){return c(e-1)},variant:"outlined",shape:"rounded",renderItem:function(n){return(0,r.jsx)(S.Z,(0,i.Z)({slots:{previous:function(){return"Previous"},next:function(){return"Next"}}},n))}})]})};R.defaultProps={images:[],showPagination:!0},R.propTypes={height:u().oneOfType([u().string,u().number]),images:u().arrayOf(u().shape({caption:u().string,filename:u().string.isRequired}).isRequired).isRequired,showPagination:u().bool};var D=(0,$.ZP)(A.Z)(function(n){n.hidePrevButton,n.hideNextButton;var e,t=n.theme;return e={},(0,q.Z)(e,"&.MuiPagination-root",{alignSelf:"center",marginTop:"16px"}),(0,q.Z)(e,"& .MuiPaginationItem-root",{fontWeight:600,margin:0,borderRadius:0}),(0,q.Z)(e,"& .MuiPagination-ul > li:last-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"0 5px 5px 0"}),(0,q.Z)(e,"& .MuiPagination-ul > li:first-child .MuiPaginationItem-previousNext:last-child",{margin:0,borderRadius:"5px 0 0 5px"}),(0,q.Z)(e,"& button.Mui-selected",{color:t.palette.white.main,backgroundColor:t.palette.secondary.main}),e}),E=t(27434),k=t(21830),N=t(83162),Q=t(74492),M=function(n){var e=n.carousel,t=n.category,a=n.data,u=n.entity,f=n.entityId,q=n.filters,A=n.listView,S=n.mediaMeta,$=n.onMediaAdd,P=n.onMediaRemove,C=n.showActionButtons,T=n.showEntityColumn,D=n.showItemActions,M=n.title,U=n.type,L=n.expanded,J=n.onChangeExpanded,B=n.hideExpandIcon,z=n.mediaFormProps,O=n.offCanvasProps,F=n.onlySingleMedia,W=n.elevation,V=n.accordionSx,G=n.refetch,Y=(0,h.x)({filters:q}),H=Y.initialData,K=Y.ref,X=(0,y.x)(),nn=X.hasRole,ne=X.user,nt=(0,Q.a)(),ni=(0,s.a)(c.t,{variables:(0,o.Z)((0,i.Z)({},H),{entity:u,entityId:f,category:t,adminId:ne.adminId,meta:S})}),no=ni.data,nr=void 0===no?{items:[],meta:{aggregate:{totalCount:0}}}:no,na=nr.items,nu=nr.meta,ns=ni.loading,nc=ni.refetch,nd=function(n){nt.close(),a.length||nc();var e=n.map(function(n){return(0,o.Z)((0,i.Z)({},n),{link:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n.filename)})});$&&$(e),G&&G()},nl=function(n){nt.close(),a.length||nc(),P&&P(n),G&&G()},nm=function(n){n.stopPropagation(),nt.show((0,i.Z)({content:(0,r.jsx)(p.z,(0,i.Z)({accept:"image/*",adminId:ne.adminId,category:t,entity:u,entityId:f,expiryShow:!1,mediaMeta:S,multiple:!0,onSuccess:nd,type:"image"},z)),title:"Upload Photos"},O))},np=function(n){n.stopPropagation(),nt.show((0,i.Z)({content:(0,r.jsx)(p.z,(0,i.Z)({accept:".pdf, .doc, .docx, .xlsx",adminId:ne.adminId,category:t,entity:u,entityId:f,expiryShow:!1,mediaMeta:S,onSuccess:nd,type:"document"},z)),title:"Upload Documents"},O))},nf=function(n){nt.show({content:(0,r.jsx)(l.d,{mediaId:n.data.id,onSuccess:nl}),submit:!1,title:"Delete Media"})},nv=function(n){nt.show({content:(0,r.jsx)(m.z,{media:n.data,toggleShow:nt.close}),title:"Media Details"})},nh=function(n){return[{context:"primary",icon:"info",onClick:function(e){return nv(n)},tooltip:"Details"},{context:"danger",icon:"delete",onClick:function(e){return nf(n)},tooltip:"Delete"}]},ny=[],ng=na.filter(function(n){var e=n.item;return(null==e?void 0:e.visibility)&&nn(null==e?void 0:e.visibility)}).map(function(n){var e=n.entity,t=n.entityId,i=n.id,o=n.item,r=o.caption,a=o.filename,u=o.meta,s=o.name,c=o.type,d=o.user,l=o.visibility;return{data:o,id:i,userId:null==d?void 0:d.id,filename:a,visibility:l.join(", "),file:r||s||a,entity:e&&"".concat(e,"#").concat(t),authority:u,uploaded:"".concat(null==d?void 0:d.nameFirst," ").concat(null==d?void 0:d.nameLast),thumbnails:v(c,u),actions:""}}),nb=(na.filter(function(n){var e=n.item;return(null==e?void 0:e.visibility)&&nn(null==e?void 0:e.visibility)}).forEach(function(n){var e=n.item,t=e.caption,i=e.filename;"image"===e.type&&ny.push({caption:t,filename:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(i)})}),ny),nI=nb.length;return(0,r.jsxs)(g.Z,{elevation:W,expanded:L,onChange:J,sx:V,children:[(0,r.jsx)(I.Z,(0,o.Z)((0,i.Z)({},B?{}:{expandIcon:(0,r.jsx)(E.Z,{})}),{children:(0,r.jsx)(_.Z,{variant:"h6",children:M})})),(0,r.jsxs)(b.Z,{children:[e&&nI>0&&(0,r.jsx)(R,{height:"200px",images:nb}),(0,r.jsx)(d.i,{columns:[{field:"file",headerName:"File",flex:1,sortable:!1,renderCell:function(n){var e=n.row,t=n.value;return(0,r.jsx)(N.r,{color:"secondary",onClick:function(n){n.preventDefault(),window.open("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.filename))},children:t})}},{field:"visibility",headerName:"Visible to",flex:1,sortable:!1},{hide:!T,field:"entity",headerName:"Entity",flex:1,sortable:!1},{field:"authority",headerName:"",width:50,sortable:!1,renderCell:function(n){var e=n.value;return(0,r.jsx)(r.Fragment,{children:(null==e?void 0:e.adminOnly)&&(0,r.jsx)(w.Z,{title:"Admin user only",children:(0,r.jsx)(x.Z,{component:"img",alt:"Admin Only",src:"/messaging/admin-only.svg",sx:{height:"24px"}})})})}},{field:"uploaded",headerName:"Uploaded by",flex:1,sortable:!1},{hide:!A,field:"thumbnails",headerName:"Thumbnails",flex:1,sortable:!1,renderCell:function(n){var e=n.value;return"function"==typeof e?e():e}},{hide:!D,field:"actions",headerName:"",width:50,sortable:!1,renderCell:function(n){var e=n.row;return nn("admin")?(0,r.jsx)(k.C,{actionsData:nh,row:e}):ne.id===e.userId?(0,r.jsx)(k.C,{actionsData:nh,row:e}):null}}],rows:ng,loading:ns,meta:nu,ref:K,refetch:nc,columnVisibilityModel:{entity:T,thumbnails:A,actions:D}}),C&&!(F&&ng.length>0)&&(0,r.jsxs)(j.Z,{direction:"row",justifyContent:"center",spacing:2,mt:2,children:[(!U||"document"===U)&&(0,r.jsx)(Z.Z,{variant:"contained",color:"secondary",onClick:np,children:"Add Document"}),(!U||"image"===U||"avatar"===U)&&(0,r.jsxs)(Z.Z,{variant:"contained",color:"secondary",onClick:nm,children:["Add ",U?"".concat(U.charAt(0).toUpperCase()).concat(U.slice(1)):"Image"]})]})]})]})};M.propTypes={carousel:u().bool,category:u().string,data:u().array,entity:u().string,entityId:u().number,filters:u().object,listView:u().bool,mediaMeta:u().object,onMediaAdd:u().func,onMediaRemove:u().func,showActionButtons:u().bool,showEntityColumn:u().bool,showItemActions:u().bool,title:u().string,type:u().string,expanded:u().bool,onChangeExpanded:u().func,hideExpandIcon:u().bool,mediaFormProps:u().object,offCanvasProps:u().object,onlySingleMedia:u().bool,elevation:u().number,accordionSx:u().object,refetch:u().func},M.defaultProps={carousel:!0,data:[],filters:{},listView:!1,mediaMeta:null,showActionButtons:!0,showEntityColumn:!1,showItemActions:!0,title:"Media",type:null,onChangeExpanded:function(){},mediaFormProps:{},offCanvasProps:{},category:"media",onlySingleMedia:!1,elevation:1,accordionSx:{},refetch:function(){}}},31249:function(n,e,t){t.d(e,{q:function(){return Q}});var i=t(14924),o=t(26042),r=t(69396),a=t(828),u=t(85893),s=t(67294),c=t(45697),d=t(6812),l=t(50319),m=t(16825),p=t(98456),f=t(48795),v=t(96486),h=function(n){var e,t,i,r=n.accountId,a=n.locationId,u=n.jobId,s=[];s.push(a?{locationId:{_eq:a}}:{}),s.push(r?{accountId:{_eq:r}}:{}),s.push(u?{Invoices:{entityId:{_eq:u}}}:{}),s.push({type:{_in:["proformaInvoice","customerPpmInvoice","supplierPpmInvoice","invoice"]},paymentStatus:{_in:["unpaid","partial"]}});var c=s.filter(function(n){return!v.isEmpty(n)});return(0,o.Z)({},c.length>0&&{_and:c})},y=t(12632),g=t(45451),b=t(53767),I=t(30381),x=t.n(I),Z=t(19512),j=t(50108),w=t(87918),_=t(51233),q=t(86886),A=t(50135),S=t(33754),$=t(87109),P=t(72852),C=t(50480),T=t(70452),R=t(93946),D=t(84808),E=t(16310),k=(0,E.Ry)().shape({dateReceived:(0,E.hT)().required("Date Received is required").typeError("Date Received is required"),paymentReference:(0,E.Z_)().required("Payment Reference is required"),amountReceived:(0,E.Rx)().min(0).required("Amount Received is required"),comment:(0,E.Z_)().nullable()}),N=t(19504),Q=function(n){var e,t,c,v,I=n.accountId,E=n.locationId,Q=n.jobId,M=n.refetch,U=n.close,L=(0,Z.D)(),J=(0,b.q)(),B=null===(e=J.admin)||void 0===e?void 0:null===(t=e.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,z=null===(c=J.admin)||void 0===c?void 0:null===(v=c.jobSetting)||void 0===v?void 0:v.jobNumberSuffix,O=(0,y.x)({filters:null}),F=O.initialData,W=O.ref,V=(0,s.useState)(null),G=V[0],Y=V[1],H=(0,s.useState)(new Date),K=H[0],X=H[1],nn=(0,s.useState)(""),ne=nn[0],nt=nn[1],ni=(0,s.useState)(0),no=ni[0],nr=ni[1],na=(0,s.useState)(""),nu=na[0],ns=na[1],nc=(0,s.useState)(!1),nd=nc[0],nl=nc[1],nm=(0,s.useState)([]),np=nm[0],nf=nm[1],nv=(0,s.useState)(0),nh=nv[0],ny=nv[1],ng=(0,s.useMemo)(function(){return h({accountId:I,locationId:E,jobId:Q})},[I,Q,E]),nb=(0,d.a)(m.v8,{variables:{limit:F.limit,offset:F.offset,accountId:I,locationId:E,orderBy:F.orderBy,where:ng},onCompleted:function(n){var e,t=null==n?void 0:null===(e=n.accountEntries)||void 0===e?void 0:e.map(function(n,e){var t,i,o,r,a=null===(t=n.invoices)||void 0===t?void 0:t[0];return{index:e,id:n.id,type:n.type,jobId:null==a?void 0:null===(i=a.Job)||void 0===i?void 0:i.id,locationId:n.locationId,jobNumber:null==a?void 0:null===(o=a.Job)||void 0===o?void 0:o.number,jobType:null==a?void 0:null===(r=a.Job)||void 0===r?void 0:r.type,invoiceNumber:n.invoiceNumber,date:x()(n.createdAt).format("YYYY-MM-DD"),daysOutstanding:n.outstandingdays,outstandingAmount:n.outstandingAmount,amount:0,invoiceId:null==a?void 0:a.id,meta:n.meta}});nf(t||[])}}),nI=nb.data,nx=(void 0===nI?{meta:{aggregate:{totalCount:0,debitTotal:{debit:0},creditTotal:{credit:0}}}}:nI).meta,nZ=nb.loading,nj=nb.refetch,nw=(0,a.Z)((0,l.D)(m.Bz,{refetchQueries:["GetAccountEntries","GetJob"],onCompleted:function(){L.show({severity:"success",content:"Payment receipt was added successfully."}),M&&M(),U&&U()},onError:function(n){L.show({severity:"error",content:"Error: ".concat(n.message)})}}),2),n_=nw[0],nq=nw[1].loading,nA=function(n){n.preventDefault();try{k.validateSync({dateReceived:K,paymentReference:ne,amountReceived:no,comment:nu},{abortEarly:!1})}catch(e){return Y(e.inner.reduce(function(n,e){var t=e.path,a=e.message;return(0,r.Z)((0,o.Z)({},n),(0,i.Z)({},t,a))},{}))}if(Number(nh).toFixed(2)!==Number(no).toFixed(2))return L.show({severity:"error",content:"Error: The sum of the reconciled amounts does not match the amount received."});n_({variables:{data:{dateReceived:K,paymentReference:ne,amountReceived:no,comment:nu,accountId:I,payments:np.filter(function(n){return n.amount>0}).map(function(n){var e;return{id:n.id,amount:n.amount}})}}})},nS=(0,s.useCallback)(function(n){var e=Number(n.target.value);nr(function(){if(!nd)return n.target.value;var t=e,i=0,a=np.map(function(n){var e=Math.min(n.outstandingAmount,t);return i+=(0,N.l)(e,2),t-=(0,N.l)(e,2),(0,r.Z)((0,o.Z)({},n),{amount:(0,N.l)(e,2)})});return ny((0,N.l)(i,2)),nf(a),e})},[nd,np]),n$=(0,s.useCallback)(function(n,e){nl(function(){if(!e)return e;var n=no,t=0,i=np.map(function(e){var i=Math.min(e.outstandingAmount,n);return t+=(0,N.l)(i,2),n-=(0,N.l)(i,2),(0,r.Z)((0,o.Z)({},e),{amount:(0,N.l)(i,2)})});return ny((0,N.l)(t,2)),nf(i),e})},[no,np]),nP=(0,s.useCallback)(function(n,e){nf(function(t){var i=0,a=t.map(function(t){return t.id===n?(i+=(0,N.l)(Number(e),2),(0,r.Z)((0,o.Z)({},t),{amount:e})):(i+=(0,N.l)(Number(t.amount),2),(0,o.Z)({},t))});return ny(i),a})},[nf]),nC=(0,s.useMemo)(function(){return[{flex:1,minWidth:120,sortable:!1,headerName:"Number",field:"number",renderCell:function(n){var e=n.row;return["customerPpmInvoice","supplierPpmInvoice"].includes(e.type)?"PM ".concat(e.invoiceNumber):(0,u.jsx)(f.D,{id:e.jobId,number:e.jobNumber,invoiceNumber:e.invoiceNumber,numberPrefix:B,numberSuffix:z,openCanvas:!0,type:e.jobType})}},{flex:1,minWidth:120,sortable:!0,sortName:"createdAt",headerName:"Date",field:"date"},{flex:1,minWidth:120,sortable:!0,sortName:"outstandingdays",headerName:"Days Outstanding",field:"daysOutstanding"},{flex:1,minWidth:120,sortable:!0,sortName:"outstandingAmount",headerName:"Amount Outstanding",field:"outstandingAmount",renderCell:function(n){var e=n.row;return(0,j.T)(e.outstandingAmount)}},{flex:1,minWidth:250,sortable:!1,headerName:"Reconciled Amount",field:"amount",renderCell:function(n){var e=n.row;return(0,u.jsxs)(_.Z,{direction:"row",children:[(0,u.jsx)(A.Z,{fullWidth:!0,variant:"outlined",color:"secondary",size:"small",type:"number",value:e.amount,onChange:function(n){return nP(e.id,n.target.value)},inputProps:{min:0,step:.01},InputProps:{startAdornment:(0,u.jsx)($.Z,{position:"start",children:"\xa3"})}}),(0,u.jsx)(R.Z,{onClick:function(){return nP(e.id,e.outstandingAmount)},children:(0,u.jsx)(T.Z,{})})]})}}]},[nP,B,z]);return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(D.Z,{sx:{zIndex:1e5},open:nq,children:(0,u.jsx)(p.Z,{color:"secondary"})}),(0,u.jsx)("form",{id:"offCanvasForm",onSubmit:nA,children:(0,u.jsxs)(_.Z,{width:"100%",children:[(0,u.jsxs)(q.ZP,{container:!0,columnSpacing:2,rowSpacing:2,children:[(0,u.jsx)(q.ZP,{item:!0,xs:6,children:(0,u.jsx)(S.M,{inputFormat:"DD/MM/YYYY",value:K,onChange:function(n){return X(n)},label:"Date Received",renderInput:function(n){return(0,u.jsx)(A.Z,(0,r.Z)((0,o.Z)({},n),{fullWidth:!0,variant:"outlined",color:"secondary",error:!!(null==G?void 0:G.dateReceived),helperText:null==G?void 0:G.dateReceived}))}})}),(0,u.jsx)(q.ZP,{item:!0,xs:6,children:(0,u.jsx)(A.Z,{label:"Payment Reference",fullWidth:!0,variant:"outlined",color:"secondary",value:ne,onChange:function(n){return nt(n.target.value)},error:!!(null==G?void 0:G.paymentReference),helperText:null==G?void 0:G.paymentReference})}),(0,u.jsx)(q.ZP,{item:!0,xs:6,children:(0,u.jsx)(A.Z,{fullWidth:!0,color:"secondary",type:"number",label:"Amount Received",value:no,onChange:nS,inputProps:{min:0,step:.01},InputProps:{startAdornment:(0,u.jsx)($.Z,{position:"start",children:"\xa3"})},error:!!(null==G?void 0:G.amountReceived),helperText:null==G?void 0:G.amountReceived})}),(0,u.jsx)(q.ZP,{item:!0,xs:6,children:(0,u.jsx)(A.Z,{multiline:!0,rows:4,label:"Comment",fullWidth:!0,variant:"filled",color:"secondary",value:nu,onChange:function(n){return ns(n.target.value)},error:!!(null==G?void 0:G.comment),helperText:null==G?void 0:G.comment})}),(0,u.jsx)(q.ZP,{item:!0,xs:6,children:(0,u.jsx)(C.Z,{control:(0,u.jsx)(P.Z,{checked:nd,onChange:n$,color:"success"}),label:"Auto Reconcile"})})]}),(0,u.jsx)(g.i,{columns:nC,loading:nZ,history:!1,meta:nx,ref:W,refetch:nj,rows:np}),(0,u.jsx)(_.Z,{width:"100%",direction:"row",justifyContent:"flex-end",children:(0,u.jsx)(w.Z,{label:"Sum: ".concat((0,j.T)(nh)),color:Number(nh).toFixed(2)===Number(no).toFixed(2)?"success":"danger"})})]})})]})};Q.propTypes={type:(0,c.oneOf)(["customer","supplier"]).isRequired,accountId:c.number.isRequired,locationId:c.number,jobId:c.number,refetch:c.func.isRequired,close:c.func.isRequired}},16825:function(n,e,t){t.d(e,{BH:function(){return _},Bz:function(){return Z},DI:function(){return $},Dn:function(){return x},L2:function(){return P},UA:function(){return w},Y8:function(){return q},to:function(){return A},v8:function(){return j},yz:function(){return S}});var i=t(7297),o=t(75063);function r(){var n=(0,i.Z)(["\n  query GetFinance($accountId: Int!) {\n    financial: Account_by_pk(id: $accountId) {\n      name\n      website\n      contactUsers: Account_Users(where: { isContact: { _eq: true } }) {\n        role\n        position\n        isContact\n        lastSignInAt\n        userId\n        user: User {\n          id\n          name: nameFirst\n          nameFirst\n          nameLast\n          phone\n          status\n          email\n          createdAt\n          fullName\n          accounts: Account_Users {\n            id\n            role\n            position\n            isContact\n            status\n            account: Account {\n              id\n              name\n              type\n            }\n          }\n        }\n      }\n      bankAccounts: BankAccounts {\n        id\n        stripeId\n        bank\n        accountNumber\n        routingNumber\n        bic\n        iban\n        status\n        default\n        createdAt\n        meta\n      }\n      cards: Cards {\n        id\n        stripeId\n        type\n        last4\n        expYear\n        expMonth\n        status\n        default\n        createdAt\n      }\n    }\n  }\n"]);return r=function(){return n},n}function a(){var n=(0,i.Z)(["\n  mutation AddPaymentReceipt($data: jsonb!) {\n    addPaymentReceived(data: $data) {\n      success\n      data\n    }\n  }\n"]);return a=function(){return n},n}function u(){var n=(0,i.Z)(["\n  mutation UpdateAccountEntry($id: Int!, $changes: AccountEntry_set_input!) {\n    update_AccountEntry_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      meta\n      outstandingAmount\n      balance\n    }\n  }\n"]);return u=function(){return n},n}function s(){var n=(0,i.Z)(["\n  query GetAccountEntries(\n    $where: AccountEntry_bool_exp\n    $limit: Int\n    $offset: Int\n    $accountId: Int\n    $locationId: Int\n    $orderBy: [AccountEntry_order_by!]\n  ) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      entryId\n      jobId\n      locationId\n      currencyId\n      createdAt\n      balance\n      debit\n      credit\n      accountId\n      updatedAt\n      status\n      paymentStatus\n      meta\n      invoiceNumber\n      invoices: Invoices {\n        Job {\n          id\n          paid\n          reference\n          type\n          meta\n          number\n          status\n          location: Location {\n            id\n            name\n          }\n          service: Service {\n            name\n            id\n          }\n        }\n        id\n        items\n        status\n        createdAt\n        rebate\n        meta\n        totals\n        invoiceType\n        invoiceNumber\n        invoiceDate\n        expenses\n        entityId\n        entity\n        configs\n        amounts\n        addendum\n        addresses\n        adminId\n      }\n    }\n    meta: getDashboard_AccountEntry_calculatebalance_aggregate(\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      aggregate {\n        debitTotal: sum {\n          debit\n        }\n        creditTotal: sum {\n          credit\n        }\n        totalCount: count\n      }\n    }\n  }\n"]);return s=function(){return n},n}function c(){var n=(0,i.Z)(["\n  query GetAccountEntries($where: AccountEntry_bool_exp, $accountId: Int, $locationId: Int) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      where: $where\n      args: { location_id: $locationId }\n      order_by: { createdAt: desc }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      entryId\n      jobId\n      locationId\n      currencyId\n      createdAt\n      balance\n      debit\n      credit\n      accountId\n      updatedAt\n      status\n      paymentStatus\n      meta\n      invoices: Invoices {\n        Job {\n          id\n          paid\n          reference\n          type\n          meta\n          number\n          status\n          location: Location {\n            id\n            name\n          }\n          sublocation: Sublocation {\n            id\n            name\n          }\n          service: Service {\n            name\n            id\n          }\n        }\n        id\n        items\n        status\n        createdAt\n        rebate\n        meta\n        totals\n        invoiceType\n        invoiceNumber\n        invoiceDate\n        expenses\n        entityId\n        entity\n        configs\n        amounts\n        addendum\n        addresses\n        adminId\n      }\n      reconciliations: InvoiceReconciliations_aggregate {\n        aggregate {\n          sum {\n            amount\n          }\n        }\n      }\n    }\n  }\n"]);return c=function(){return n},n}function d(){var n=(0,i.Z)(["\n  query GetAccountEntries(\n    $where: AccountEntry_bool_exp\n    $limit: Int\n    $offset: Int\n    $accountId: Int\n    $locationId: Int\n    $orderBy: [AccountEntry_order_by!]\n  ) {\n    accountEntries: getDashboard_AccountEntry_calculatebalance(\n      limit: $limit\n      offset: $offset\n      order_by: $orderBy\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      id\n      outstandingAmount\n      outstandingdays\n      type\n      createdAt\n      status\n      paymentStatus\n      meta\n      invoices: Invoices {\n        id\n        meta\n        invoiceType\n        invoiceNumber\n        amounts\n        Job {\n          id\n          number\n          type\n          status\n        }\n      }\n    }\n    meta: getDashboard_AccountEntry_calculatebalance_aggregate(\n      where: $where\n      args: { location_id: $locationId }\n    ) {\n      aggregate {\n        debitTotal: sum {\n          debit\n        }\n        creditTotal: sum {\n          credit\n        }\n        totalCount: count\n      }\n    }\n  }\n"]);return d=function(){return n},n}function l(){var n=(0,i.Z)(["\n  query GetAccoutEntrySumByAccounntInJob($jobId: Int!, $accountId: Int!) {\n    accountEntryAggregate: AccountEntry_aggregate(\n      where: { Invoices: { Job: { id: { _eq: $jobId } } }, accountId: { _eq: $accountId } }\n    ) {\n      aggregate {\n        sum {\n          outstandingAmount\n        }\n      }\n    }\n  }\n"]);return l=function(){return n},n}function m(){var n=(0,i.Z)(["\n  query GetJobMeta($id: Int!) {\n    job: Job(where: { id: { _eq: $id } }) {\n      id\n      meta\n    }\n  }\n"]);return m=function(){return n},n}function p(){var n=(0,i.Z)(["\n  mutation UpdateJob($changes: Job_set_input, $ids: [Int]) {\n    update_Job(where: { id: { _in: $ids } }, _set: $changes) {\n      affected_rows\n    }\n  }\n"]);return p=function(){return n},n}function f(){var n=(0,i.Z)(["\n  mutation UpdateJob(\n    $id: Int!\n    $changes: Job_set_input\n    $timing: [JobTiming_insert_input!]!\n    $insertTiming: Boolean!\n  ) {\n    update_Job_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_JobTiming(objects: $timing) @include(if: $insertTiming) {\n      returning {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return f=function(){return n},n}function v(){var n=(0,i.Z)(["\n  mutation DeleteAccountEntry($id: Int!) {\n    deleteAccountEntry(id: $id) {\n      success\n      data\n    }\n  }\n"]);return v=function(){return n},n}function h(){var n=(0,i.Z)(['\n  query GetRelatedAccountEntries($accountEntryId: Int!) {\n    reconciliations: Reconciliation(\n      where: {\n        creditEntityId: { _eq: $accountEntryId }\n        creditEntity: { _in: ["PaymentReceipt", "CreditNote"] }\n      }\n    ) {\n      id\n      amount\n      createdAt\n      accountEntryInvoice: InvoiceEntry {\n        id\n        type\n        invoiceNumber\n        invoices: Invoices {\n          id\n          invoiceType\n          invoiceNumber\n          job: Job {\n            id\n            number\n            type\n            status\n            timings: JobTimings(order_by: { createdAt: desc }) {\n              id\n              status\n              createdAt\n            }\n          }\n        }\n      }\n    }\n  }\n']);return h=function(){return n},n}function y(){var n=(0,i.Z)(["\n  query GetRelatedInvoces($accountEntryId: Int!) {\n    invoices: Invoice(where: { accountEntryId: { _eq: $accountEntryId } }) {\n      id\n      invoiceNumber\n      Job {\n        id\n        number\n        type\n        status\n      }\n    }\n  }\n"]);return y=function(){return n},n}function g(){var n=(0,i.Z)(['\n  query GetCalendarJobs($customerId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        customerId: { _eq: $customerId }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n']);return g=function(){return n},n}function b(){var n=(0,i.Z)(["\n  mutation AddCreditNote($data: jsonb!) {\n    addCreditNote(data: $data) {\n      success\n      data\n    }\n  }\n"]);return b=function(){return n},n}function I(){var n=(0,i.Z)(['\n  query GetAccountEntryDetails($accountEntryId: Int!) {\n    accountEntry: AccountEntry_by_pk(id: $accountEntryId) {\n      id\n      type\n      debit\n      credit\n      reference: meta(path: "reference")\n      comment: meta(path: "comment")\n      createdAt\n    }\n  }\n']);return I=function(){return n},n}var x=(0,o.Ps)(r()),Z=(0,o.Ps)(a());(0,o.Ps)(u());var j=(0,o.Ps)(s()),w=(0,o.Ps)(c()),_=(0,o.Ps)(d());(0,o.Ps)(l()),(0,o.Ps)(m()),(0,o.Ps)(p()),(0,o.Ps)(f());var q=(0,o.Ps)(v()),A=(0,o.Ps)(h()),S=(0,o.Ps)(y());(0,o.Ps)(g());var $=(0,o.Ps)(b()),P=(0,o.Ps)(I())},82725:function(n,e,t){t.d(e,{By:function(){return p},Rm:function(){return l},WG:function(){return m},Wj:function(){return f},bK:function(){return v}});var i=t(7297),o=t(75063);function r(){var n=(0,i.Z)(['\n  query getInvoices($jobId: Int!) {\n    invoices: Invoice(where: { entityId: { _eq: $jobId }, entity: { _eq: "Job" } }) {\n      id\n      accountEntry: AccountEntry {\n        id\n        type\n        paymentStatus\n        meta\n        dueDate\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      entity\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n    meta: Invoice_aggregate(where: { entityId: { _eq: $jobId }, entity: { _eq: "Job" } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return r=function(){return n},n}function a(){var n=(0,i.Z)(['\n  query getInvoices($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      accountEntry: AccountEntry {\n        id\n        paymentStatus\n      }\n      items\n      status\n      createdAt\n      rebate\n      meta\n      totals\n      invoiceType\n      invoiceNumber\n      invoiceDate\n      expenses\n      entityId\n      configs\n      amounts\n      addendum\n      addresses\n      adminId\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']);return a=function(){return n},n}function u(){var n=(0,i.Z)(['\n  query getInvoiceForPdf($id: Int!) {\n    invoice: Invoice_by_pk(id: $id) {\n      id\n      entityId\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']);return u=function(){return n},n}function s(){var n=(0,i.Z)(['\n  query getInvoiceForPdfByType($jobId: Int!, $invoiceType: String!) {\n    invoices: Invoice(\n      where: {\n        entityId: { _eq: $jobId }\n        entity: { _eq: "Job" }\n        invoiceType: { _eq: $invoiceType }\n      }\n      order_by: { createdAt: desc }\n    ) {\n      id\n      invoiceType\n      accountEntry: AccountEntry {\n        id\n        type\n        meta\n      }\n      amountPaid: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "PaymentReceipt" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      amountDeducted: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate(\n          where: { creditEntity: { _eq: "CreditNote" } }\n        ) {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n      reconciledAmount: AccountEntry {\n        reconciliations: InvoiceReconciliations_aggregate {\n          aggregate {\n            sum {\n              amount\n            }\n          }\n        }\n      }\n    }\n  }\n']);return s=function(){return n},n}function c(){var n=(0,i.Z)(["\n  query getAccountEntryForPdfById($accountEntryId: Int!) {\n    accountEntry: AccountEntry_by_pk(id: $accountEntryId) {\n      id\n      meta\n    }\n  }\n"]);return c=function(){return n},n}function d(){var n=(0,i.Z)(["\n  mutation CreateProformaInvoice(\n    $jobId: Int!\n    $invoiceType: String!\n    $dueDate: timestamptz!\n    $description: String\n    $items: [jsonb]\n  ) {\n    createProformaInvoice(\n      jobId: $jobId\n      invoiceType: $invoiceType\n      description: $description\n      dueDate: $dueDate\n      items: $items\n    ) {\n      message\n      success\n    }\n  }\n"]);return d=function(){return n},n}var l=(0,o.Ps)(r());(0,o.Ps)(a());var m=(0,o.Ps)(u()),p=(0,o.Ps)(s()),f=(0,o.Ps)(c()),v=(0,o.Ps)(d())},48996:function(n,e,t){t.d(e,{m:function(){return nh}});var i=t(26042),o=t(85893),r=t(6812),a=t(65650),u=t(47568),s=t(69396),c=t(828),d=t(97582),l=t(67294),m=t(30381),p=t.n(m),f=t(50319),v=t(61582),h=t(42283),y=t(79665),g=t(78289),b=t(77439),I=t(76600),x=t(9270),Z=t(62140),j=t(11587),w=t(55377),_=t(49501),q=t(55563),A=t(95103),S=t(6710),$=t(16551),P=t(40552),C=t(97637),T=t(14924),R=t(52019),D=t(11082),E=t(7297),k=t(45697),N=t(10367),Q=t(68956),M=t(33006),U=t(16540),L=t(49432),J=t(16310),B=t(28497),z=t(51466),O=t(94054),F=t(56815),W=t(15861),V=function(n){var e,t,r=n.editMode,m=n.onSuccess,p=n.rawData,v=n.quotationId,g=(n.setQuote,n.supplierId),j=n.type,$=n.toggleShow,P=(0,l.useContext)(R.Z).hasRole,C=(0,h.cI)({defaultValues:{description:r?p.description:"",qty:r?p.qty:"",qtyUnit:r?p.qtyUnit:"hours",unitRate:r?p.unitRate:"",item:r?p.item:"",total:r?p.total:""},resolver:(0,y.S)(G),context:{isAdmin:P("admin")}}),T=C.control,E=C.errors,k=C.handleSubmit,N=C.register,Q=C.watch,M={control:T,errors:E,register:N},U=Q("qty"),L=Q("unitRate"),J=Q("total"),V=Q("description"),Y=(0,c.Z)((0,f.D)(a.Ih,{onCompleted:function(n){var e=n.insert_SupplierQuoteLineItem.returning[0].id;m&&m(e)}}),2),H=Y[0],K=Y[1].loading,X=(0,c.Z)((0,f.D)(a.EA,{onCompleted:function(n){var e=n.update_SupplierQuoteLineItem_by_pk.id;m&&m(e)}}),2),nn=X[0],ne=X[1].loadingUpdate,nt=(t=(0,u.Z)(function(n){return(0,d.__generator)(this,function(e){switch(e.label){case 0:if(!r)return[3,2];return n.supplierTotal=n.qty*n.unitRate,[4,nn({variables:{id:null==p?void 0:p.id,changes:n}})];case 1:return e.sent(),[3,4];case 2:return n.accountId=Number(g),n.type=j,n.quoteId=Number(v),n.supplierTotal=n.qty*n.unitRate,[4,H({variables:{objects:[n]}})];case 3:e.sent(),e.label=4;case 4:return[2]}})}),function(n){return t.apply(this,arguments)});return(0,o.jsxs)(I.Z,{handleSubmit:k(nt),children:[(0,o.jsx)(x.Z,{children:(0,o.jsx)(Z.Z,{md:12,children:(0,o.jsx)(O.Z,{fullWidth:!0,error:!!(null==E?void 0:E.description),children:(0,o.jsxs)(_.Z,{label:"Description",children:[(0,o.jsx)(S.Z,(0,s.Z)((0,i.Z)({},M),{name:"description",rows:2})),(null==E?void 0:E.description)&&(0,o.jsx)(F.Z,{sx:{m:0},children:null==E?void 0:null===(e=E.description)||void 0===e?void 0:e.message}),(0,o.jsxs)(W.Z,{children:[null==V?void 0:V.length,"/500"]})]})})})}),(0,o.jsxs)(x.Z,{children:[(0,o.jsx)(Z.Z,{md:4,children:(0,o.jsx)(_.Z,{label:"Quantity",children:(0,o.jsx)(q.Z,(0,s.Z)((0,i.Z)({},M),{name:"qty",type:"number",step:"0.01"}))})}),"Labour"===j&&(0,o.jsx)(Z.Z,{md:4,children:(0,o.jsx)(_.Z,{label:"Quantity Unit",children:(0,o.jsx)(A.Z,(0,s.Z)((0,i.Z)({},M),{name:"qtyUnit",options:[{text:"Hours",value:"hours",disabled:!1},{text:"Days",value:"days",disabled:!1},{text:"Weeks",value:"weeks",disabled:!1}]}))})}),(0,o.jsx)(Z.Z,{md:4,children:(0,o.jsx)(B.Z,(0,s.Z)((0,i.Z)({},M),{label:P("supplier")?"Unit Rate":"Supplier Unit Rate",name:"unitRate",vat:"Ex VAT"}))})]}),(0,o.jsxs)(z.Z,{children:["Supplier Total: ",(0,D.Z)(U*L)]}),(0,o.jsx)(w.Z,{}),P("admin")&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.Z,{children:(0,o.jsx)(Z.Z,{md:12,children:(0,o.jsx)(B.Z,(0,s.Z)((0,i.Z)({},M),{label:"Customer Unit Rate",name:"total",vat:"Ex VAT"}))})}),(0,o.jsxs)(z.Z,{children:["Customer Total (Labour Item): ",(0,D.Z)(U*(null!=J?J:0))]}),(0,o.jsx)(w.Z,{})]}),(0,o.jsxs)(x.Z,{justify:"end",style:{margin:"0 5px"},children:[(0,o.jsx)(b.Z,{content:"Cancel",onClick:$,style:{margin:"0 5px"}}),(0,o.jsx)(b.Z,{content:r?"Save":"Add",disabled:K||ne,type:"submit"})]}),(0,o.jsx)("div",{style:{clear:"both"}})]})};V.propTypes={editMode:k.bool,onSuccess:k.func,rawData:k.object,quotationId:k.number,supplierId:k.number,type:k.string,toggleShow:k.func},V.defaultProps={rawData:{}};var G=J.Ry({qty:J.Rx().required("Quantity is a required field"),unitRate:J.Rx().required("Unit rate is a required field"),total:J.Rx().when("isAdmin",{is:function(n){return!0===n},then:function(n){return n.required("Customer Unit Rate is a required field")}}),description:J.Z_().max(500,"Description must have a maximum of 500 characters.").test("maxLines","Textarea should not exceed 10 lines",function(n){return!n||n.split("\n").length<=10})}),Y=t(84808),H=t(98456);function K(){var n=(0,E.Z)(["\n  margin: 0 5px;\n"]);return K=function(){return n},n}function X(){var n=(0,E.Z)(["\n  margin: 0;\n"]);return X=function(){return n},n}var nn=function(n){var e=n.quotation,t=n.quotationId,i=n.type,u=n.updateTotal,s=n.readOnly,d=(0,l.useContext)(R.Z).hasRole,m=(0,l.useContext)(g.Z),p=(0,r.a)(a.cu,{variables:{quotationId:t,type:i}}),v=p.data,h=(void 0===v?{lineItems:[]}:v).lineItems,y=p.loading,I=p.refetch,x=(0,c.Z)((0,f.D)(a.nc,{onCompleted:function(n){I()}}),1)[0];(0,l.useEffect)(function(){u(h)},[h]);var Z=function(){I(),m.close()},j=function(n,r){var a;m.show({content:(0,o.jsx)(V,{editMode:!!(null==r?void 0:r.rawData),onSuccess:Z,rawData:null==r?void 0:r.rawData,toggleShow:m.close,quotationId:t,supplierId:null===(a=e.supplier)||void 0===a?void 0:a.id,type:i}),submit:!1,title:"".concat(r?"Edit":"Insert"," ").concat(i," Item")})},w=function(n,e){x({variables:{id:e.id}})},_=[{text:"ID",hidden:!0},{text:"Description"},{hidden:!d(["admin","supplier"]),text:"Qty"},{hidden:!d(["admin","supplier"]),text:"Rate"},{hidden:!d(["admin","supplier"]),text:"Supplier Total"},{hidden:!d(["admin","customer"]),text:"Customer Total"},{hidden:!d(["admin","supplier"])||s,formatter:Q.Z,formatterData:(0,L.N)("/dashboard/quotes/",{onEditClick:j,onDeleteClick:w}),text:"Actions"},{text:"Raw Data",hidden:!0}],q=h.reduce(function(n,e){return n+e.total*e.qty},0),A=h.reduce(function(n,e){return n+e.supplierTotal},0);return y?(0,o.jsx)(Y.Z,{sx:{zIndex:1e5},open:!0,children:(0,o.jsx)(H.Z,{color:"secondary"})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(M.Z,{content:(0,o.jsxs)(ne,{align:"center",justify:"between",children:[(0,o.jsx)("span",{children:i}),d(["admin","supplier"])&&!s&&(0,o.jsx)(b.Z,{content:"Insert ".concat(i," Item"),context:"secondary",onClick:j,size:"sm"})]}),tag:"h4"}),(0,o.jsx)(U.Z,{columns:_,rows:h.map(function(n){return{id:n.id,description:n.description,qty:"Labour"===n.type?"".concat(n.qty," ").concat(n.qtyUnit):n.qty,rate:(0,D.Z)(n.unitRate),supplierTotal:(0,D.Z)(n.supplierTotal),total:(0,D.Z)(n.total*n.qty),action:"",rawData:n}})}),(0,o.jsxs)("div",{style:{textAlign:"right"},children:[d(["admin","supplier"])&&(0,o.jsxs)(nt,{children:["Subtotal - ",i," ",d(["admin"])&&"- Supplier",": ",(0,D.Z)(A)]}),d(["admin","customer"])&&(0,o.jsxs)(nt,{children:["Subtotal - ",i,": ",(0,D.Z)(q)]})]})]})},ne=(0,N.ZP)(x.Z).attrs(function(){return{align:"center",justify:"between"}}).withConfig({displayName:"lineItemTable__StyledRow",componentId:"sc-de239c5d-0"})(K()),nt=N.ZP.p.withConfig({displayName:"lineItemTable__StyledP",componentId:"sc-de239c5d-1"})(X());nn.propTypes={quotationId:k.number.isRequired,quotation:k.object.isRequired,type:k.string,updateTotal:k.func.isRequired};var ni=function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=arguments.length>1?arguments[1]:void 0;return n.reduce(function(n,t){return"total"===e?n+=t[e]*t.qty:n+=t[e]},0)},no=function(n){var e=n.quotation,t=n.total,r=n.setTotal,a=(n.supplierTotal,n.setSupplierTotal),u=(n.customerTotal,n.setCustomerTotal),c=n.readOnly,d=(0,l.useContext)(R.Z).hasRole,m=function(n,e){return r(function(t){return(0,s.Z)((0,i.Z)({},t),(0,T.Z)({},n,ni(e,"total")))})},p=function(n,e){return a(function(t){return(0,s.Z)((0,i.Z)({},t),(0,T.Z)({},n,ni(e,"supplierTotal")))})},f=function(n,e){return u(function(t){return(0,s.Z)((0,i.Z)({},t),(0,T.Z)({},n,ni(e,"total")))})},v=t.labour+t.materials,h=.2*v;return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(x.Z,{children:(0,o.jsx)(Z.Z,{md:12,children:(0,o.jsx)(nn,{quotationId:e.id,quotation:e,type:"Labour",updateTotal:function(n){m("labour",n),p("labour",n),f("labour",n)},readOnly:c})})}),(0,o.jsx)(w.Z,{}),(0,o.jsx)(x.Z,{children:(0,o.jsx)(Z.Z,{md:12,children:(0,o.jsx)(nn,{quotationId:e.id,quotation:e,type:"Materials",updateTotal:function(n){m("materials",n),p("materials",n),f("materials",n)},readOnly:c})})}),(0,o.jsx)(w.Z,{}),d(["admin","customer"])&&(0,o.jsx)(x.Z,{children:(0,o.jsxs)(Z.Z,{md:12,style:{textAlign:"right"},children:[(0,o.jsxs)("div",{children:["Sub Total: ",(0,D.Z)(v)]}),(0,o.jsxs)("div",{children:["VAT (20%): ",(0,D.Z)(h)]}),(0,o.jsxs)("div",{children:["Total: ",(0,D.Z)(v+h)]})]})})]})},nr=(0,J.Ry)().shape({totalDuration:(0,J.Z_)().required(),totalDurationUnit:(0,J.Z_)().required(),methodStatement:(0,J.Z_)().required(),startDate:(0,J.hT)().required(),rebate:(0,J.Z_)(),notes:(0,J.Z_)()}),na=t(18409),nu=t(35374),ns=t(14564),nc=t(51233),nd=t(79369),nl=t(96715),nm=function(n){var e,t,r,a,m,T,R,D,E,k=n.quotation,N=n.status,Q=n.user,M=n.hasRole,U=n.onSuccess,L=(0,l.useContext)(g.Z),J=null==Q?void 0:Q.quoteThreshold,B=(0,l.useState)({labour:0,materials:0}),z=B[0],O=B[1],F=(0,l.useState)({labour:0,materials:0}),W=F[0],V=F[1],G=(0,l.useState)({labour:0,materials:0}),Y=G[0],H=G[1],K=(0,l.useState)(null),X=K[0],nn=K[1],ne=(0,nu.s)(),nt=function(n){nn(n.currentTarget)},ni=function(){nn(null)},nm=W.labour+W.materials,np=null==k?void 0:null===(e=k.job)||void 0===e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(n){return n.quoteId===k.id&&n.status==="".concat("admin"===Q.accountType?"adminSupplier":Q.accountType,"QuoteThresholdApproval")}),nf=null==k?void 0:null===(r=k.job)||void 0===r?void 0:null===(a=r.timings)||void 0===a?void 0:a.find(function(n){return n.quoteId===k.id&&n.status==="".concat("admin"===Q.accountType?"adminSupplier":Q.accountType,"QuoteThresholdApproved")}),nv=np&&nf&&(null==np?void 0:null===(m=np.meta)||void 0===m?void 0:m.to)===(null==nf?void 0:nf.userId),nh=(0,c.Z)((0,f.D)(v.HI),1)[0],ny=(0,h.cI)({defaultValues:{totalDuration:(null==k?void 0:k.totalDuration)||"",totalDurationUnit:(null==k?void 0:k.totalDurationUnit)||"hour",startDate:(null==k?void 0:k.startDate)?new Date(k.startDate):"",methodStatement:(null==k?void 0:k.methodStatement)||"",rebate:(null==k?void 0:k.rebate)||"",notes:(null==k?void 0:k.notes)||"",siteVisitAt:(null==k?void 0:k.siteVisitAt)?new Date(k.siteVisitAt):""},resolver:(0,y.S)(nr)}),ng=ny.control,nb=ny.errors,nI=ny.handleSubmit,nx=ny.register,nZ=M("customer")||M("supplier")&&("quotationAccepted"===k.status||"quotationRejected"===k.status||"supplierQuoteSent"===k.status),nj=(T=(0,u.Z)(function(n){var e,t,i,o;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return n.status=(null==k?void 0:k.job.status)==="quoteSent"?"supplierQuoteUpdated":"supplierQuoteComplete",n.startDate&&(n.startDate=p()(n.startDate).format()),[4,nh({variables:{id:k.id,changes:n,recommend:!1}})];case 1:return i=(t=e.sent().data.update_SupplierQuote_by_pk).id,o=t.status,U&&U({id:i,status:o}),[2]}})}),function(n){return T.apply(this,arguments)}),nw=(R=(0,u.Z)(function(n){return(0,d.__generator)(this,function(e){switch(e.label){case 0:return n.status="supplierQuoteDraft",n.startDate&&(n.startDate=p()(n.startDate).format()),[4,nh({variables:{id:k.id,changes:n,recommend:!1}})];case 1:return e.sent(),[2]}})}),function(n){return R.apply(this,arguments)}),n_=(D=(0,u.Z)(function(){var n;return(0,d.__generator)(this,function(e){switch(e.label){case 0:return(n={}).status="supplierQuoteRefused",[4,nh({variables:{id:k.id,changes:n,recommend:!1}})];case 1:return e.sent(),[2]}})}),function(){return D.apply(this,arguments)}),nq=function(){L.close()},nA=function(){L.show({title:"Upload Risk Assessments",content:(0,o.jsx)(C.G,{entity:"Quotation",entityId:k.id})})},nS=(E=(0,u.Z)(function(){return(0,d.__generator)(this,function(n){switch(n.label){case 0:return[4,nh({variables:{changes:{recommended:!0},id:k.id,jobId:k.jobId,recommend:!0}})];case 1:return n.sent(),[2]}})}),function(){return E.apply(this,arguments)}),n$={control:ng,errors:nb,register:nx},nP=M(["admin","supplier"])&&!nZ&&(0,o.jsx)(b.Z,{content:"Cancel",onClick:nq,type:"button",style:ne?{padding:"0 8px",marginRight:8,width:"auto"}:null}),nC=M(["admin","supplier"])&&!nZ&&(0,o.jsx)(b.Z,{content:"Save",context:"secondary",onClick:nI(nw),style:ne?{padding:"0 8px",marginRight:8,marginBottom:8,width:"auto"}:null}),nT=M(["admin"])&&(0,o.jsx)(b.Z,{content:"Reject quote",context:"danger",onClick:n_,style:ne?{padding:"0 8px",marginRight:8}:null}),nR=function(){if(!nZ){if(M(["admin"])||M(["supplier"])&&(0,nl.il)(J,nm)||M(["supplier"])&&nv)return(0,o.jsx)(b.Z,{content:"Submit quote",type:"submit",style:ne?{padding:"0 8px",marginRight:8}:null});if(M(["supplier"])&&!(0,nl.il)(J,nm))return(0,o.jsx)(b.Z,{content:"Request approval",onClick:function(){var n;return(0,na.I_)({type:"quote",role:"admin"===Q.accountType?"adminSupplier":Q.accountType,jobId:null==k?void 0:null===(n=k.job)||void 0===n?void 0:n.id,quotationId:k.id,accountId:Q.accountId,amount:nm,offCanvas:L})},style:ne?{padding:"0 8px",marginRight:8}:null})}};return(0,o.jsxs)(I.Z,{handleSubmit:nI(nj),children:[(0,o.jsx)(x.Z,{children:(0,o.jsxs)(Z.Z,{md:12,children:["Status: ",(0,o.jsx)(j.Z,{content:N.text,size:"md",context:N.context}),M("admin")&&(0,o.jsx)(b.Z,{content:"Recommend This Quotation",context:"secondary",onClick:nS,size:"sm"})]})}),(0,o.jsx)(w.Z,{}),(0,o.jsx)(no,{quotation:k,total:z,setTotal:O,supplierTotal:W,setSupplierTotal:V,customerTotal:Y,setCustomerTotal:H,readOnly:nZ}),(0,o.jsx)(w.Z,{}),(0,o.jsxs)(x.Z,{children:[(0,o.jsx)(Z.Z,{md:3,children:(0,o.jsx)(_.Z,{label:"Total Duration",children:(0,o.jsx)(q.Z,(0,s.Z)((0,i.Z)({},n$),{name:"totalDuration",type:"number",readOnly:nZ}))})}),(0,o.jsx)(Z.Z,{md:3,children:(0,o.jsx)(_.Z,{label:"Total Duration Unit",children:(0,o.jsx)(A.Z,(0,s.Z)((0,i.Z)({},n$),{name:"totalDurationUnit",options:[{text:"Hour",value:"hour",disabled:!1},{text:"Day",value:"day",disabled:!1},{text:"Week",value:"week",disabled:!1}],readOnly:nZ}))})}),(0,o.jsxs)(Z.Z,{md:3,children:[(0,o.jsx)(_.Z,{label:"Available Start date"}),(0,o.jsx)(P.M,(0,s.Z)((0,i.Z)({},n$),{name:"startDate",readOnly:nZ}))]})]}),(0,o.jsx)(x.Z,{children:(0,o.jsx)(Z.Z,{md:12,children:(0,o.jsx)(_.Z,{label:"Method Statement",children:(0,o.jsx)(S.Z,(0,s.Z)((0,i.Z)({},n$),{name:"methodStatement",readOnly:nZ,rows:2}))})})}),M(["admin","supplier"])&&!nZ&&(0,o.jsx)(x.Z,{children:(0,o.jsxs)(Z.Z,{md:12,children:[(0,o.jsx)(_.Z,{label:"Risk Assessments & Method Statements"}),(0,o.jsx)(_.Z,{label:"Where RAMS are required, please upload them here.",children:(0,o.jsx)(b.Z,{content:"Upload",context:"secondary",onClick:nA,size:"sm"})})]})}),(0,o.jsx)(x.Z,{justify:ne?"center":"end",style:{margin:"5px 0 30px 0"},children:ne?(0,o.jsxs)(x.Z,{justify:"center",children:[nR(),nT,(0,o.jsx)(b.Z,{onClick:nt,context:"secondary",children:(0,o.jsx)(nd.Z,{})}),(0,o.jsx)(ns.ZP,{open:!!X,anchorEl:X,onClose:ni,sx:{zIndex:9999},anchorOrigin:{vertical:"bottom",horizontal:"left"},children:(0,o.jsxs)(nc.Z,{flexDirection:"columnn",alignItems:"center",justifyContent:"space-evenly",p:2,children:[nC,nP]})})]}):(0,o.jsxs)($.Z,{children:[nP,nC,nT,nR()]})}),(0,o.jsx)("div",{style:{clear:"both"}})]})},np=t(31312),nf=t(74944),nv=t(94885),nh=function(n){var e=n.quotationId,t=n.onSuccess,u=(0,nf.x)(),s=u.hasRole,c=u.user,d=(0,r.a)(a.Ib,{variables:{id:e}}),l=d.data,m=(void 0===l?{quotation:{}}:l).quotation,p=d.loading,f=(0,r.a)(nv.nh,{variables:{id:c.id}}).data,v=(void 0===f?{user:{}}:f).user,h=np.E6.find(function(n){return n.value===m.status})||{text:"-",context:"info"};return p?(0,o.jsx)(Y.Z,{sx:{zIndex:1e5},open:!0,children:(0,o.jsx)(H.Z,{color:"secondary"})}):(0,o.jsx)(nm,{quotation:m,quotationId:e,user:(0,i.Z)({},c,v),hasRole:s,onSuccess:t,status:h})}},65650:function(n,e,t){t.d(e,{EA:function(){return h},Ib:function(){return m},Ih:function(){return v},JE:function(){return p},cu:function(){return f},nc:function(){return y}});var i=t(7297),o=t(75063),r=t(94885);function a(){var n=(0,i.Z)(["\n  query GetQuotation($id: Int!) {\n    quotation: SupplierQuote_by_pk(id: $id) {\n      id\n      createdAt\n      jobId\n      methodStatement\n      notes\n      quoteNumber\n      startDate\n      rebate\n      status\n      totalDuration\n      totalDurationUnit\n      meta\n      updatedAt\n      siteVisitAt\n      job: Job {\n        id\n        status\n        timings: JobTimings(order_by: { id: desc }) {\n          id\n          status\n          notes\n          meta\n          userId\n          quoteId\n          createdAt\n        }\n      }\n      lineItems: SupplierQuoteLineItems {\n        id\n        description\n        item\n        qty\n        qtyUnit\n        quoteId\n        supplierTotal\n        total\n        type\n        unitRate\n      }\n      supplier: Supplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n    }\n  }\n"]);return a=function(){return n},n}function u(){var n=(0,i.Z)(['\n  query GetQuotations($accountId: Int, $status: [String!], $q: String, $limit: Int, $offset: Int) {\n    quotations: SupplierQuote(\n      limit: $limit\n      offset: $offset\n      where: {\n        _or: [\n          { quoteNumber: { _ilike: $q } }\n          { totalDurationUnit: { _ilike: $q } }\n          { notes: { _ilike: $q } }\n        ]\n        accountId: { _eq: $accountId }\n        type: { _eq: "quote" }\n        status: { _in: $status }\n      }\n      order_by: { quoteNumber: desc }\n    ) {\n      id\n      createdAt\n      jobId\n      methodStatement\n      notes\n      quoteNumber\n      startDate\n      rebate\n      status\n      totalDuration\n      totalDurationUnit\n      meta\n      updatedAt\n      type\n      lineItems: SupplierQuoteLineItems {\n        id\n        description\n        item\n        qty\n        qtyUnit\n        quoteId\n        supplierTotal\n        total\n        type\n        unitRate\n      }\n      labourTotal: SupplierQuoteLineItems_aggregate(where: { type: { _eq: "Labour" } }) {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      materialsTotal: SupplierQuoteLineItems_aggregate(where: { type: { _eq: "Materials" } }) {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      total: SupplierQuoteLineItems_aggregate {\n        aggregate {\n          sum {\n            supplierTotal\n          }\n        }\n      }\n      job: Job {\n        description\n        title\n        type\n        number\n        status\n        customer: Customer {\n          id\n          name\n        }\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n        location: Location {\n          addresses: Addresses(where: { entity: { _eq: "Location" }, registered: { _eq: true } }) {\n            id\n            status\n            address: Address {\n              id\n              name\n              addressLine1\n              postCode\n            }\n          }\n        }\n        timings: JobTimings(order_by: { createdAt: asc }) {\n          id\n          status\n          notes\n          createdAt\n          user: User {\n            ...UserFields\n          }\n        }\n      }\n    }\n    meta: SupplierQuote_aggregate(\n      where: {\n        _or: [\n          { quoteNumber: { _ilike: $q } }\n          { totalDurationUnit: { _ilike: $q } }\n          { notes: { _ilike: $q } }\n        ]\n        accountId: { _eq: $accountId }\n        type: { _eq: "quote" }\n        status: { _in: $status }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"]);return u=function(){return n},n}function s(){var n=(0,i.Z)(["\n  query GetQuotationLineItems($quotationId: Int!, $type: String!) {\n    lineItems: SupplierQuoteLineItem(\n      where: { quoteId: { _eq: $quotationId }, type: { _eq: $type } }\n    ) {\n      id\n      description\n      item\n      qty\n      qtyUnit\n      quoteId\n      supplierTotal\n      total\n      type\n      unitRate\n    }\n  }\n"]);return s=function(){return n},n}function c(){var n=(0,i.Z)(["\n  mutation InsertSupplierQuoteLineItem($objects: [SupplierQuoteLineItem_insert_input!]!) {\n    insert_SupplierQuoteLineItem(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return c=function(){return n},n}function d(){var n=(0,i.Z)(["\n  mutation UpdateSupplierQuoteLineItem($id: Int!, $changes: SupplierQuoteLineItem_set_input) {\n    update_SupplierQuoteLineItem_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return d=function(){return n},n}function l(){var n=(0,i.Z)(["\n  mutation DeleteSupplierQuoteLineItem($id: Int!) {\n    delete_SupplierQuoteLineItem_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return l=function(){return n},n}var m=(0,o.Ps)(a()),p=(0,o.Ps)(u(),r.Px),f=(0,o.Ps)(s()),v=(0,o.Ps)(c()),h=(0,o.Ps)(d()),y=(0,o.Ps)(l())},61582:function(n,e,t){t.d(e,{Dg:function(){return l},HI:function(){return d},j6:function(){return c}});var i=t(7297),o=t(75063);function r(){var n=(0,i.Z)(["\n  mutation AddQuotation($objects: [SupplierQuote_insert_input!]!) {\n    insert_SupplierQuote(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return r=function(){return n},n}function a(){var n=(0,i.Z)(["\n  mutation UpdateQuotation(\n    $id: Int!\n    $changes: SupplierQuote_set_input\n    $recommend: Boolean!\n    $jobId: Int\n  ) {\n    update_SupplierQuote(where: { jobId: { _eq: $jobId } }, _set: { recommended: false })\n      @include(if: $recommend) {\n      returning {\n        id\n      }\n    }\n    update_SupplierQuote_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n      status\n    }\n  }\n"]);return a=function(){return n},n}function u(){var n=(0,i.Z)(["\n  mutation UpdateQuotation(\n    $id: Int!\n    $changes: SupplierQuote_set_input\n    $supplierOffer: [SupplierOffer_insert_input!]!\n  ) {\n    update_SupplierQuote_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n    insert_SupplierOffer(objects: $supplierOffer) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return u=function(){return n},n}function s(){var n=(0,i.Z)(['\n  mutation UpdateQuotation($jobId: Int, $changes: SupplierQuote_set_input) {\n    update_SupplierQuote(\n      where: {\n        jobId: { _eq: $jobId }\n        status: { _neq: "quotationAccepted" }\n        type: { _eq: "quote" }\n      }\n      _set: $changes\n    ) {\n      returning {\n        id\n        jobId\n        status\n      }\n    }\n  }\n']);return s=function(){return n},n}var c=(0,o.Ps)(r()),d=(0,o.Ps)(a()),l=(0,o.Ps)(u());(0,o.Ps)(s())},69297:function(n,e,t){t.d(e,{E:function(){return h}});var i=t(26042),o=t(69396),r=t(85893),a=t(45697),u=t.n(a),s=t(94054),c=t(50480),d=t(56815),l=t(40476),m=t(79717),p=t(36872),f=t(51233),v=t(15861),h=function(n){var e=n.label,t=n.options,a=n.error,u=n.helperText,h=n.stackProps,g=n.formControlProps,b=n.labelLeft,I=function(n){var e=n.children;return(0,r.jsx)(r.Fragment,{children:e})};return(0,r.jsxs)(s.Z,(0,o.Z)((0,i.Z)({sx:{m:3},error:a,variant:"standard"},void 0===g?{}:g),{children:[(0,r.jsxs)(f.Z,(0,o.Z)((0,i.Z)({},b&&y),{children:[e&&(0,r.jsx)(l.Z,{id:"radio-group",color:"secondary",children:e}),(0,r.jsx)(m.Z,(0,o.Z)((0,i.Z)({},n),{"aria-labelledby":"radio-group",children:(0,r.jsx)(f.Z,(0,o.Z)((0,i.Z)({},void 0===h?{}:h),{children:t.map(function(n){var e=n.value,t=n.label,i=n.icon,o=n.ParentComponent;return(0,r.jsx)(void 0===o?I:o,{children:(0,r.jsx)(c.Z,{value:e,control:(0,r.jsx)(p.Z,{color:"secondary"}),label:(0,r.jsxs)(f.Z,{direction:"row",alignItems:"center",spacing:1,children:[i,(0,r.jsx)(v.Z,{children:t})]})})})})}))}))]})),(0,r.jsx)(d.Z,{children:u})]}))};h.defaultProps={options:[],error:!1,helperText:"",stackProps:{},formControlProps:{},labelLeft:!1},h.propTypes={label:u().string,options:u().arrayOf(u().shape({label:u().string.isRequired,value:u().any.isRequired,ParentComponent:u().elementType})).isRequired,error:u().bool,helperText:u().string,stackProps:u().object,formControlProps:u().object,labelLeft:u().bool};var y={direction:"row",alignItems:"center",flexWrap:"wrap",spacing:1}},93753:function(n,e,t){t.d(e,{_Z:function(){return l}});var i=t(47568),o=t(7297),r=t(97582),a=t(75063),u=t(35374);function s(){var n=(0,o.Z)(["\n  mutation CreateCustomerInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createCustomerInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"]);return s=function(){return n},n}function c(){var n=(0,o.Z)(["\n  mutation CreateSupplierInvoicePdf($jobId: Int!, $preview: Boolean) {\n    invoice: createSupplierInvoicePdf(jobId: $jobId, preview: $preview) {\n      success\n      key\n    }\n  }\n"]);return c=function(){return n},n}var d,l=(d=(0,i.Z)(function(n){var e,t,i,o,a,s,c,d;return(0,r.__generator)(this,function(r){switch(r.label){case 0:switch(e=n.client,t=n.jobId,i=n.type,o=n.getUrl,a=n.preview,s="",i){case"supplier":s=p;break;case"customerVat":s=m;break;default:return[2]}return(0,u.a)()||o||(c=window.open("/download","_blank")),d="",[4,e.mutate({mutation:s,variables:{jobId:t,preview:a}}).then(function(n){var e,t,i,r=n.data.invoice.key;o?d="".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(r):(null==c||null===(e=c.location)||void 0===e||e.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(r)),(null==window?void 0:null===(t=window.Capacitor)||void 0===t?void 0:null===(i=t.Plugins)||void 0===i?void 0:i.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(r)}))})];case 1:return r.sent(),[2,d]}})}),function(n){return d.apply(this,arguments)}),m=(0,a.Ps)(s()),p=(0,a.Ps)(c())},1341:function(n,e,t){t.d(e,{$:function(){return u}});var i,o=t(47568),r=t(97582),a=t(35374),u=(i=(0,o.Z)(function(n){var e;return(0,r.__generator)(this,function(t){switch(t.label){case 0:return(0,a.a)()||(e=window.open("/download","_blank")),[4,window.fetch("".concat("https://aws.cleverly.works","/pdf/invoice/ppmNew/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(n)}).then(function(n){return n.json()}).then(function(n){var t,i,o;null==e||null===(t=e.location)||void 0===t||t.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)),(null==window?void 0:null===(i=window.Capacitor)||void 0===i?void 0:null===(o=i.Plugins)||void 0===o?void 0:o.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)})})];case 1:return t.sent(),[2]}})}),function(n){return i.apply(this,arguments)})},9367:function(n,e,t){t.d(e,{u:function(){return c}});var i,o=t(47568),r=t(26042),a=t(69396),u=t(97582),s=t(35374),c=(i=(0,o.Z)(function(n){var e,t,i,o,c,d,l,m,p,f,v,h,y,g,b,I;return(0,u.__generator)(this,function(u){switch(u.label){case 0:return e=n.meta,t=n.invoice,b=(0,a.Z)((0,r.Z)({},e),{title:"Proforma Invoice",amountPaid:null==t?void 0:null===(i=t.amountPaid)||void 0===i?void 0:null===(o=i.reconciliations)||void 0===o?void 0:null===(c=o.aggregate)||void 0===c?void 0:null===(d=c.sum)||void 0===d?void 0:d.amount,amountDeducted:null==t?void 0:null===(l=t.amountDeducted)||void 0===l?void 0:null===(m=l.reconciliations)||void 0===m?void 0:null===(p=m.aggregate)||void 0===p?void 0:null===(f=p.sum)||void 0===f?void 0:f.amount,reconciledAmount:null==t?void 0:null===(v=t.reconciledAmount)||void 0===v?void 0:null===(h=v.reconciliations)||void 0===h?void 0:null===(y=h.aggregate)||void 0===y?void 0:null===(g=y.sum)||void 0===g?void 0:g.amount}),(0,s.a)()||(I=window.open("/download","_blank")),[4,window.fetch("".concat("https://aws.cleverly.works","/pdf/invoice/proforma/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(b)}).then(function(n){return n.json()}).then(function(n){var e,t,i;null==I||null===(e=I.location)||void 0===e||e.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)),(null==window?void 0:null===(t=window.Capacitor)||void 0===t?void 0:null===(i=t.Plugins)||void 0===i?void 0:i.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(n.key)})})];case 1:return u.sent(),[2]}})}),function(n){return i.apply(this,arguments)})},18409:function(n,e,t){t.d(e,{i$:function(){return T},Ii:function(){return R},I_:function(){return D}});var i=t(47568),o=t(97582),r=t(85893),a=t(828),u=t(67294),s=t(45697),c=t(42283),d=t(79665),l=t(50319),m=t(73987),p=t(76600),f=t(49501),v=t(6710),h=t(64573),y=t(16310),g=t(76140),b=t(29815),I=t(31312),x=function(n,e){var t=(0,b.Z)(null==n?void 0:n.timings).sort(function(n,e){return e.id-n.id});return Array.isArray(e)?t.find(function(n){var t=n.status;return I.iz.find(function(n){return n.value===t&&!e.includes(t)})}):t.find(function(n){var t=n.status;return I.iz.find(function(n){return n.value===t&&t!==e})})},Z=function(n){var e,t,s=n.type,b=n.status,I=n.role,Z=n.job,j=n.quoteId,w=n.toggleShow,_=n.refetch,q=(0,u.useContext)(m.Z).user,A=(0,a.Z)((0,l.D)(h.qD,{onCompleted:function(n){}}),1)[0],S=(0,a.Z)((0,l.D)(h.r2,{onCompleted:function(n){}}),1)[0],$=(0,a.Z)((0,l.D)(h.k7,{onCompleted:function(n){}}),1)[0],P=(0,c.cI)({defaultValues:{comments:""},resolver:(0,d.S)((e="QuoteThresholdRejected"===b||"ThresholdRejected"===b,(0,y.Ry)().shape({comments:e&&(0,y.Z_)().required()})))}),C=P.errors,T=P.handleSubmit,R=P.register,D=(t=(0,i.Z)(function(n){var e,t,i,r;return(0,o.__generator)(this,function(o){return i={id:Z.id,status:"quote"===s?"QuoteThresholdApproved"===b?"".concat(I,"QuoteThresholdRejected"):"".concat(I,"QuoteThresholdApproved"):"ThresholdApproved"===b?"".concat(I,"ThresholdRejected"):"".concat(I,"ThresholdApproved"),userId:q.id,quoteId:"quote"===s?j:void 0},$({variables:i}),r={notes:n.comments,status:"".concat(I).concat(b),jobId:Z.id,userId:q.id,quoteId:j},S({variables:{objects:[r]}}),A({variables:{id:Z.id,changes:{status:"quote"===s?null===(e=x(Z))||void 0===e?void 0:e.status:null===(t=(0,g.e)(Z))||void 0===t?void 0:t.status}}}),w&&w(),_&&_(),[2]})}),function(n){return t.apply(this,arguments)});return(0,r.jsx)(p.Z,{id:"offCanvasForm",handleSubmit:T(D),children:(0,r.jsx)(f.Z,{label:"Comments",children:(0,r.jsx)(v.Z,{errors:C,name:"comments",register:R,rows:3})})})};Z.propTypes={job:s.object.isRequired,status:s.string.isRequired,toggleShow:s.func.isRequired};var j,w,_=t(26042),q=t(69396),A=t(536),S=t(74944),$=t(61582),P=(0,y.Ry)().shape({manager:(0,y.Ry)().shape({value:(0,y.Rx)().integer().required(),label:(0,y.Z_)()}).required()}),C=function(n){var e,t=n.role,u=n.type,s=n.quotations,m=n.jobId,f=n.quotationId,v=n.accountId,y=n.amount,g=n.toggleShow,b=(0,S.x)().user,I=(0,a.Z)((0,l.D)(h.r2,{onCompleted:function(n){}}),1)[0],x=(0,a.Z)((0,l.D)(h.qD,{onCompleted:function(n){}}),1)[0],Z=(0,a.Z)((0,l.D)($.HI),1)[0],j=(0,c.cI)({resolver:(0,d.S)(P),defaultValues:{manager:[]}}),w=j.errors,C=j.handleSubmit,T=j.register,R=j.control,D=(e=(0,i.Z)(function(n){return(0,o.__generator)(this,function(e){switch(e.label){case 0:if("issue"!==u)return[3,2];return[4,I({variables:{objects:[{status:"".concat(t,"ThresholdApproval"),jobId:m,userId:b.id,quoteId:f,meta:{to:n.manager.value}}]}})];case 1:case 3:return e.sent(),[3,7];case 2:var r;if(!("quote"===u&&"adminCustomer"===t))return[3,4];return[4,Promise.all(s.map((r=(0,i.Z)(function(e){return(0,o.__generator)(this,function(i){switch(i.label){case 0:return[4,I({variables:{objects:[{status:"".concat(t,"QuoteThresholdApproval"),jobId:m,userId:b.id,quoteId:e.id,meta:{to:n.manager.value}}]}})];case 1:return i.sent(),[4,Z({variables:{id:e.id,changes:{status:"waitingThresholdApproval"},recommend:!1}})];case 2:return i.sent(),[2]}})}),function(n){return r.apply(this,arguments)})))];case 4:return[4,I({variables:{objects:[{status:"".concat(t,"QuoteThresholdApproval"),jobId:m,userId:b.id,quoteId:f,meta:{to:n.manager.value}}]}})];case 5:return e.sent(),[4,Z({variables:{id:f,changes:{status:"waitingThresholdApproval"},recommend:!1}})];case 6:e.sent(),e.label=7;case 7:return[4,x({variables:{id:m,changes:{status:"waitingThresholdApproval"}}})];case 8:return e.sent(),g(),[2]}})}),function(n){return e.apply(this,arguments)});return(0,r.jsx)(p.Z,{id:"offCanvasForm",handleSubmit:C(D),children:(0,r.jsx)(A.P,(0,q.Z)((0,_.Z)({},{control:R,register:T,errors:w}),{label:"Please choose an approver from the list below.",accountId:v,userId:b.id,invoiceThreshold:"issue"===u?y:null,quoteThreshold:"quote"===u?y:null,name:"manager",type:"thresholdManagers"}))})},T=(j=(0,i.Z)(function(n){var e,t,i,a,u,s;return(0,o.__generator)(this,function(o){return e=n.type,t=n.role,i=n.job,a=n.quoteId,u=n.offCanvas,s=n.refetch,u.show({content:(0,r.jsx)(Z,{type:e,role:t,job:i,quoteId:a,status:"quote"===e?"QuoteThresholdApproved":"ThresholdApproved",toggleShow:u.show,refetch:s}),title:"Approve threshold"}),[2]})}),function(n){return j.apply(this,arguments)}),R=(w=(0,i.Z)(function(n){var e,t,i,a,u,s;return(0,o.__generator)(this,function(o){return e=n.type,t=n.role,i=n.job,a=n.quoteId,u=n.offCanvas,s=n.refetch,u.show({content:(0,r.jsx)(Z,{type:e,role:t,job:i,quoteId:a,status:"quote"===e?"QuoteThresholdRejected":"ThresholdRejected",toggleShow:u.show,refetch:s}),title:"Reject threshold"}),[2]})}),function(n){return w.apply(this,arguments)}),D=function(n){var e=n.type,t=n.role,i=n.quotations,o=n.jobId,a=n.quotationId,u=n.accountId,s=n.amount,c=n.offCanvas;c.show({content:(0,r.jsx)(C,{role:t,type:e,jobId:o,quotations:i,quotationId:a,accountId:u,amount:s,toggleShow:c.show}),title:"Threshold approval"})}},19504:function(n,e,t){t.d(e,{l:function(){return i}});var i=function(n,e){var t=Math.pow(10,e);return Math.round(n*t)/t}},4438:function(n,e,t){t.d(e,{SR:function(){return a},Tq:function(){return u},YK:function(){return r},cJ:function(){return o},pX:function(){return i}});var i=["customerVat","supplier"],o=["ProformaInvoiceCustomer","ProformaInvoiceSupplier"],r=["customerPpmInvoice","supplierPpmInvoice"],a={customer:["customerVat","ProformaInvoiceCustomer","customerPpmInvoice"],supplier:["supplier","ProformaInvoiceSupplier","supplierPpmInvoice"]},u={customerVat:"Customer VAT Invoice",supplier:"Supplier Invoice",ProformaInvoiceCustomer:"Customer ad-hoc Invoice",ProformaInvoiceSupplier:"Supplier ad-hoc Invoice",customerPpmInvoice:"PPM Customer Invoice",supplierPpmInvoice:"PPM Supplier Invoice"}}}]);