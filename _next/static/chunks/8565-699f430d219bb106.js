"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8565],{13304:function(n,e,t){var r=t(64836);e.Z=void 0;var a=r(t(64938)),i=t(85893);e.Z=(0,a.default)((0,i.jsx)("path",{d:"M18 16v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1zm-5 0h-2v-2h2zm0-4h-2V8h2zm-1 10c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2"}),"NotificationImportant")},6054:function(n,e,t){var r=t(67294),a=function(n){var e=(0,r.useRef)();return(0,r.useEffect)(function(){e.current=n}),e.current};e.Z=a},11082:function(n,e){var t=function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GBP";return new Intl.NumberFormat(["en-GB"],{currency:e,currencyDisplay:"symbol",style:"currency"}).format(n)};e.Z=t},83946:function(n,e,t){t.d(e,{Z:function(){return r}});function r(n){if(null===n||!0===n||!1===n)return NaN;var e=Number(n);return isNaN(e)?e:e<0?Math.ceil(e):Math.floor(e)}},83894:function(n,e,t){t.d(e,{Z:function(){return i}});var r=t(19013),a=t(13882);function i(n){(0,a.Z)(1,arguments);var e=(0,r.Z)(n);return e.setHours(23,59,59,999),e}},23855:function(n,e,t){t.d(e,{Z:function(){return d}});var r=t(83946),a=t(13882),i={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},o=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,u=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,s=/^([+-])(\d{2})(?::?(\d{2}))?$/;function d(n,e){(0,a.Z)(1,arguments);var t,d,f=e||{},v=null==f.additionalDigits?2:(0,r.Z)(f.additionalDigits);if(2!==v&&1!==v&&0!==v)throw RangeError("additionalDigits must be 0, 1 or 2");if(!("string"==typeof n||"[object String]"===Object.prototype.toString.call(n)))return new Date(NaN);var g=function(n){var e,t={},r=n.split(i.dateTimeDelimiter);if(r.length>2)return t;if(/:/.test(r[0])?(t.date=null,e=r[0]):(t.date=r[0],e=r[1],i.timeZoneDelimiter.test(t.date)&&(t.date=n.split(i.timeZoneDelimiter)[0],e=n.substr(t.date.length,n.length))),e){var a=i.timezone.exec(e);a?(t.time=e.replace(a[1],""),t.timezone=a[1]):t.time=e}return t}(n);if(g.date){var h=function(n,e){var t=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+e)+"})|(\\d{2}|[+-]\\d{"+(2+e)+"})$)"),r=n.match(t);if(!r)return{year:null};var a=r[1]&&parseInt(r[1]),i=r[2]&&parseInt(r[2]);return{year:null==i?a:100*i,restDateString:n.slice((r[1]||r[2]).length)}}(g.date,v);t=function(n,e){if(null===e)return null;var t=n.match(o);if(!t)return null;var r=!!t[4],a=l(t[1]),i=l(t[2])-1,u=l(t[3]),s=l(t[4]),d=l(t[5])-1;if(r){return(c=e,f=s,v=d,f>=1&&f<=53&&v>=0&&v<=6)?(g=e,h=s,_=d,y=new Date(0),y.setUTCFullYear(g,0,4),I=y.getUTCDay()||7,y.setUTCDate(y.getUTCDate()+((h-1)*7+_+1-I)),y):new Date(NaN)}var c,f,v,g,h,_,y,I,b,$,q,Z,x,S=new Date(0);return(b=e,$=i,q=u,$>=0&&$<=11&&q>=1&&q<=(m[$]||(p(b)?29:28))&&(Z=e,x=a,x>=1&&x<=(p(Z)?366:365)))?(S.setUTCFullYear(e,i,Math.max(a,u)),S):new Date(NaN)}(h.restDateString,h.year)}if(isNaN(t)||!t)return new Date(NaN);var _=t.getTime(),y=0;if(g.time&&(isNaN(y=function(n){var e=n.match(u);if(!e)return null;var t,r,a,i=c(e[1]),o=c(e[2]),s=c(e[3]);return(t=i,r=o,a=s,24===t?0===r&&0===a:a>=0&&a<60&&r>=0&&r<60&&t>=0&&t<25)?36e5*i+6e4*o+1e3*s:NaN}(g.time))||null===y))return new Date(NaN);if(g.timezone){if(isNaN(d=function(n){if("Z"===n)return 0;var e=n.match(s);if(!e)return 0;var t,r,a="+"===e[1]?-1:1,i=parseInt(e[2]),o=e[3]&&parseInt(e[3])||0;return(t=i,r=o,r>=0&&r<=59)?a*(36e5*i+6e4*o):NaN}(g.timezone)))return new Date(NaN)}else{var I=new Date(_+y),b=new Date(0);return b.setFullYear(I.getUTCFullYear(),I.getUTCMonth(),I.getUTCDate()),b.setHours(I.getUTCHours(),I.getUTCMinutes(),I.getUTCSeconds(),I.getUTCMilliseconds()),b}return new Date(_+y+d)}function l(n){return n?parseInt(n):1}function c(n){return n&&parseFloat(n.replace(",","."))||0}var m=[31,null,31,30,31,30,31,31,30,31,30,31];function p(n){return n%400==0||n%4==0&&n%100}},69119:function(n,e,t){t.d(e,{Z:function(){return i}});var r=t(19013),a=t(13882);function i(n){(0,a.Z)(1,arguments);var e=(0,r.Z)(n);return e.setHours(0,0,0,0),e}},43703:function(n,e,t){t.d(e,{Z:function(){return i}});var r=t(19013),a=t(13882);function i(n){(0,a.Z)(1,arguments);var e=(0,r.Z)(n);return e.setDate(1),e.setHours(0,0,0,0),e}},38148:function(n,e,t){t.d(e,{Z:function(){return i}});var r=t(19013),a=t(13882);function i(n){(0,a.Z)(1,arguments);var e=(0,r.Z)(n),t=new Date(0);return t.setFullYear(e.getFullYear(),0,1),t.setHours(0,0,0,0),t}},43427:function(n,e,t){t.d(e,{r:function(){return $}});var r=t(26042),a=t(69396),i=t(828),o=t(7297),u=t(85893),s=t(67294),d=t(45697),l=t(52019),c=t(9270),m=t(62140),p=t(49501),f=t(84043),v=t(31312),g=t(536),h=t(40552),_=t(83894),y=t(10367),I=t(53625);function b(){var n=(0,o.Z)(["\n  div > div > div {\n    background: ",";\n  }\n  div > div {\n    background: ",";\n  }\n"]);return b=function(){return n},n}var $=function(n){var e=n.control,t=n.errors,o=n.initialValues,d=n.register,f=n.setFilters,y=n.setValue,b=n.watch,$=(0,s.useContext)(l.Z).hasRole,Z={control:e,errors:t,register:d},x=b("customerId"),S=b("supplierId"),A=b("startDate"),j=b("userId"),D=!o.customerId;(0,s.useEffect)(function(){var n=(0,i.Z)(w.filter(function(n){return"quoteOffered"===n.value}),1)[0];f(function(e){return(0,a.Z)((0,r.Z)({},e),{status:A?[n.value]:null})}),y("status",A?[n]:null)},[A]);var w=v.iz.map(function(n){return $("supplier")?{label:n.supplierText,value:n.value}:$("customer")?{label:n.customerText,value:n.value}:{label:n.text,value:n.value}}).filter(function(n){return null!==n.label});(0,s.useEffect)(function(){D&&f(function(n){return(0,a.Z)((0,r.Z)({},n),{customerId:(null==x?void 0:x.value)||null})})},[x]),(0,s.useEffect)(function(){D&&f(function(n){return(0,a.Z)((0,r.Z)({},n),{supplierId:(null==S?void 0:S.value)||null})})},[S]),(0,s.useEffect)(function(){f(function(n){return(0,a.Z)((0,r.Z)({},n),{userId:"number"==typeof j?j:(null==j?void 0:j.value)||null})})},[j]);var C=function(n){var e=n.map(function(n){return n.value});f(function(n){return(0,a.Z)((0,r.Z)({},n),{status:e.length>0?e:null})}),y("status",n)};return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsxs)(c.Z,{children:[(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(h.M,(0,a.Z)((0,r.Z)({},Z),{name:"startDate",onChange:function(n){f(function(e){return(0,a.Z)((0,r.Z)({},e),{startDate:n||null})}),y("startDate",n)},placeholder:"Quote offered date"}))}),(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(h.M,(0,a.Z)((0,r.Z)({},Z),{name:"endDate",onChange:function(n){var e=n?(0,_.Z)(n):n;f(function(n){return(0,a.Z)((0,r.Z)({},n),{endDate:e})}),y("endDate",e)},placeholder:"Quote due date"}))})]}),(0,u.jsxs)(c.Z,{align:"baseline",children:[(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(p.Z,{label:null,children:(0,u.jsx)(q,(0,a.Z)((0,r.Z)({},Z),{isDisabled:Boolean(A),placeholder:"Select status",name:"status",isMulti:Boolean(!A),onChange:C,options:w}))})}),!$(["customer","supplier"])&&(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(g.P,(0,a.Z)((0,r.Z)({},Z),{label:"",name:"customerId",placeholder:"Select customer",isClearable:!0,type:"customer"}))}),$(I.n)&&(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(g.P,(0,a.Z)((0,r.Z)({},Z),{errors:(0,r.Z)({},t),label:"",userId:o.userId,name:"userId",placeholder:"Select user",type:"user"}))})]}),!$(["supplier","customer"])&&!A&&(0,u.jsx)(c.Z,{children:(0,u.jsx)(m.Z,{md:6,children:(0,u.jsx)(g.P,(0,a.Z)((0,r.Z)({},Z),{label:"",name:"supplierId",isClearable:!0,placeholder:"Select supplier",type:"supplier"}))})})]})},q=(0,y.ZP)(f.Z).withConfig({displayName:"filter__StyledSelect",componentId:"sc-83cb9202-0"})(b(),function(n){return n.isDisabled&&"#dddddd"},function(n){return n.isDisabled&&"#dddddd"});$.propTypes={errors:d.object.isRequired,register:d.func.isRequired,setFilters:d.func.isRequired}},40577:function(n,e,t){t.d(e,{w:function(){return v},L:function(){return f}});var r=t(7297),a=t(75063),i=t(17868),o=t(20725),u=t(22666);function s(){var n=(0,r.Z)(["\n  fragment QuoteFields on Job {\n    quoteNumber\n    quoteDue\n    quoteCharge\n  }\n"]);return s=function(){return n},n}function d(){var n=(0,r.Z)(["\n  query Quote($id: Int!) {\n    job: Job_by_pk(id: $id) {\n      id\n      title\n      description\n      costCategory\n      status\n      workStatus\n      scheduledAt\n      createdAt\n      customerId\n      customerUserId\n      locationId\n      managerId\n      parentId\n      serviceId\n      slaId\n      tenantId\n      reference\n      amount\n      accountByTenantid {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      customer: Account {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      customerUser: CustomerUser {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        vat\n      }\n      location: Location {\n        id\n        access\n        createdAt\n        name\n        contactUserId\n      }\n      messages: Messages {\n        id\n        message\n        priority\n        taskId\n        jobId\n        locationId\n        description\n      }\n      service: Service {\n        id\n        name\n        countryId\n        currencyId\n      }\n      supplier: Suplier {\n        id\n        companyNumber\n        createdAt\n        name\n        status\n        type\n        updatedAt\n        website\n        clientType\n        managerId\n        vatId\n        meta\n        media: Media {\n          id\n          medium: Medium {\n            id\n            category\n            filename\n            meta\n            type\n          }\n        }\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      manager: Manager {\n        id\n        name: nameFirst\n        nameFirst\n        nameLast\n        phone\n        status\n        email\n        createdAt\n        fullName\n        accounts: Account_Users {\n          id\n          role\n          position\n          isContact\n          status\n          account: Account {\n            id\n            name\n            type\n          }\n        }\n      }\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n    }\n  }\n"]);return d=function(){return n},n}var l=(0,a.Ps)(s());(0,a.Ps)(d());var c=t(94885);function m(){var n=(0,r.Z)(["\n  query GetQuotes(\n    $endDate: timestamptz\n    $limit: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $type: String\n  ) {\n    quotes: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n      }\n      order_by: [$orderBy]\n    ) {\n      ...JobFields\n      ...JobSupplierFields\n      ...QuoteFields\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      service: Service {\n        id\n        name\n      }\n      timings: JobTimings {\n        id\n        status\n        notes\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return m=function(){return n},n}function p(){var n=(0,r.Z)(["\n  query GetQuotes(\n    $customerId: Int\n    $date: timestamptz\n    $endDate: timestamptz\n    $limit: Int\n    $locationId: Int\n    $managerId: Int\n    $customerManagerId: Int\n    $offset: Int\n    $orderBy: Job_order_by!\n    $q: String\n    $startDate: timestamptz\n    $status: [String!]\n    $supplierId: Int\n    $type: String\n    $userId: Int\n    $slaId: [Int!]\n  ) {\n    quotes: Job(\n      limit: $limit\n      offset: $offset\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        ",'\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        type: { _eq: $type }\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        slaId: {_in: $slaId}\n        managerId: { _eq: $managerId }\n        Customer: { managerId: { _eq: $customerManagerId } }\n        supplierId: { _eq: $supplierId }\n        quoted: { _eq: true }\n        customerUserId: { _eq: $userId }\n      }\n      order_by: [$orderBy]\n    ) {\n      ...JobFields\n      ...JobAdminFields\n      ...QuoteFields\n      statusLog\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n        lineItems: SupplierQuoteLineItems {\n          id\n          qty\n          total\n        }\n      }\n      supplier: Supplier {\n        ...AccountFields\n      }\n      admin: Admin {\n        id\n        name\n      }\n      customer: Customer {\n        ...AccountFields\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      manager: Manager {\n        ...UserFields\n      }\n      service: Service {\n        id\n        name\n      }\n      timings: JobTimings {\n        id\n        status\n        notes\n        createdAt\n        user: User {\n          ...UserFields\n        }\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: {\n            _and: [\n              {status: { _eq: "active" }}\n              {type: { _eq: "tags" }}\n            ]\n          }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n    }\n    meta: Job_aggregate(\n      where: {\n        _and: [\n          {\n            _or: [\n              { description: { _ilike: $q } }\n              { number: { _ilike: $q } }\n              { reference: { _ilike: $q } }\n              { title: { _ilike: $q } }\n              { Customer: { name: { _ilike: $q } } }\n              { CustomerUser: { email: { _ilike: $q } } }\n              { Supplier: { name: { _ilike: $q } } }\n              { SupplierUser: { email: { _ilike: $q } } }\n              { Location: { name: { _ilike: $q } } }\n              { Taxonomy: { Taxonomy: { name: { _ilike: $q } } } }\n            ]\n          }\n        ]\n        ',"\n        createdAt: { _gte: $startDate }\n        quoteDue: { _lte: $endDate }\n        status: { _in: $status }\n        slaId: {_in: $slaId}\n        customerId: { _eq: $customerId }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n        Customer: { managerId: { _eq: $customerManagerId } }\n        supplierId: { _eq: $supplierId }\n        quoted: { _eq: true }\n        type: { _eq: $type }\n        customerUserId: { _eq: $userId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return p=function(){return n},n}var f=(0,a.Ps)(m(),i.z,o.aL,l,o.H_,c.Px),v=function(n){var e=n.tagsWhere;return(0,a.Ps)(p(),e,e,i.z,u.WW,o.aL,o.wd,l,c.Px)}},15487:function(n,e,t){t.d(e,{v:function(){return X}});var r=t(26042),a=t(69396),i=t(828),o=t(7297),u=t(29815),s=t(85893),d=t(67294),l=t(45697),c=t(11163),m=t.n(c),p=t(6812),f=t(73359),v=t(57460),g=t.n(v),h=t(78289),_=t(62466),y=t(11082),I=t(26186),b=t(68956),$=t(16551),q=t(55843),Z=t(77439),x=t(40826),S=t(11585),A=t(40577),j=t(72530),D=t(83894),w=t(23855),C=function(n,e,t,a){var i=n.limit,o=n.offset,u=n.orderBy,s=n.q,d=n.status,l=n.tagsWhere;return t.hasOwnProperty("tileName")?{query:j.Z,variables:(0,r.Z)({q:null,accountId:null,userId:null,currentUserId:null==e?void 0:e.id,asAt:(0,D.Z)((0,w.Z)(a.asAt)),tileName:null==t?void 0:t.tileName,limit:50,offset:0,orderBy:{jobId:"desc"},monthStart:a.monthStart,dayStart:a.todayStart,yearStart:a.yearStart,adminId:null==e?void 0:e.adminId},n)}:"supplier"===e.accountType?{query:A.L,variables:(0,r.Z)({limit:i,offset:o,orderBy:u,q:s,status:d},n)}:{query:(0,A.w)({tagsWhere:l}),variables:(0,r.Z)({},n)}},k=t(87336),N=t(31312),T=t(58632),F=t(48795),U=t(74944),R=t(53767),L=t(16605),P=t(12632),M=t(35374),E=t(48996),J=t(43703),z=t(69119),Q=t(38148),O=function(n){var e=(0,J.Z)(n),t=(0,z.Z)(n),r=(0,D.Z)(n),a=(0,Q.Z)(n);return{monthStart:e,todayEnd:r,todayStart:t,yearStart:a}},V=t(13304),B=t(71559),H=t(10367);function W(){var n=(0,o.Z)(["\n  cursor: pointer;\n  margin: 2px 0px;\n  padding: 8px 5px;\n  color: rgb(41, 41, 204);\n  background-color: transparent;\n  border: none;\n  &:hover {\n    background-color: #dddddd;\n    border-radius: 5px;\n  }\n"]);return W=function(){return n},n}function Y(){var n=(0,o.Z)(["\n  line-height: 1.5em;\n  height: 3em;\n  overflow: hidden;\n"]);return Y=function(){return n},n}function G(){var n=(0,o.Z)(["\n  white-space: nowrap;\n"]);return G=function(){return n},n}var X=function(n){var e,t,o,l,v,A=n.filters,j=(0,d.useContext)(h.Z),D=(0,R.q)(),w=(0,c.useRouter)().query,J=(0,d.useState)(!1),z=J[0],Q=J[1],H=null===(e=D.admin)||void 0===e?void 0:null===(t=e.jobSetting)||void 0===t?void 0:t.jobNumberPrefix,W=null===(o=D.admin)||void 0===o?void 0:null===(l=o.jobSetting)||void 0===l?void 0:l.jobNumberSuffix,Y=(0,U.x)(),G=Y.hasRole,X=Y.user,nt=(0,P.x)({filters:A}),nr=nt.initialData,na=nt.ref,ni=G("tenant"),no=(0,a.Z)((0,r.Z)({},nr),{managerId:A.managerId?X.id:null,tagsWhere:(0,B.Y)(nr.tags)}),nu=(0,d.useMemo)(function(){return new Date(w.asAt)},[w.asAt]),ns=(0,d.useState)({monthStart:O(nu).monthStart,todayEnd:O(nu).todayEnd,todayStart:O(nu).todayStart,yearStart:O(nu).yearStart,asAt:w.asAt}),nd=ns[0],nl=ns[1];(0,d.useEffect)(function(){var n,e=O(nu),t=e.monthStart,r=e.todayEnd;nl({monthStart:t,todayEnd:r,todayStart:e.todayStart,yearStart:e.yearStart,asAt:w.asAt})},[nu,A.asAt,w.asAt]);var nc=C(no,X,w,nd),nm=nc.query,np=nc.variables;"Accepted"===np.status?(np.type="reactive",delete np.status):delete np.type;var nf=(0,p.a)(nm,{variables:np}),nv=nf.data,ng=void 0===nv?{quotes:[],meta:{aggregate:{totalCount:0}}}:nv,nh=ng.quotes,n_=ng.meta,ny=nf.loading,nI=nf.refetch,nb=(0,i.Z)((0,f.t)(nm,{variables:(0,a.Z)((0,r.Z)({},np),{limit:(null==n_?void 0:null===(v=n_.aggregate)||void 0===v?void 0:v.totalCount)||150}),onCompleted:function(n){var e=n.quotes;if(z){var t=g().unparse(nU(e,!0)),r="data:application/octet-stream,"+encodeURIComponent(t);(0,L.S)(r,"quotes.csv"),Q(!1)}},skip:!0}),2),n$=nb[0],nq=nb[1].loading,nZ=void 0===nq||nq,nx=function(){nI(),j.close()},nS=function(n){n.stopPropagation(),n$(),Q(!0)},nA=function(n){var e=n.e,t=n.row;e.stopPropagation(),j.show({content:(0,s.jsx)(E.m,{onSuccess:nx,quotationId:t.quotationsId}),title:"Quotation",width:"50%"})},nj={content:"Edit",context:"secondary",icon:["fas","edit"],onClick:function(n,e){n.stopPropagation(),m().push("/dashboard/issues/manage?id=".concat(e.number,"&quoted=1"))},tooltip:"Edit"},nD={context:"info",icon:["fas","receipt"],onClick:function(n,e){return nA({e:n,row:e})},tooltip:"Fill quotation"},nw={context:"secondary",icon:["fas","receipt"],onClick:function(n,e){return m().push("/dashboard/issues/view?id=".concat(e.number))},tooltip:"info"},nC=[{sortable:!0,text:"ID",sortName:"id",formatter:function(n){var e=n.row;return(0,s.jsx)(F.D,{id:e.id,number:e.number,numberPrefix:H,numberSuffix:W,status:e.status,openCanvas:!0,type:e.type,isQuote:e.quoted})}},{text:"Creator"},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{hidden:!0},{formatter:function(n){var e=n.row;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(nn,{children:e.type})})},text:"Type",sortName:"type"},{formatter:function(n){var e=n.row;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(nn,{children:e.description})})},text:"Description"},{sortable:!0,hidden:!G("admin"),formatter:(0,_.Z)("/dashboard/users/view","managerId","manager"),sortName:'{"Manager": {"nameFirst": "ORDER"}}',text:"Assigned to"},{sortable:!0,hidden:!G(["admin","customer"]),formatter:(0,_.Z)("/dashboard/properties/view","propertyId","location"),text:"Location",sortName:'{"Location": {"name": "ORDER"}}'},{sortable:!0,hidden:G(["admin","customer"]),text:"Location",sortName:'{"Location": {"name": "ORDER"}}'},{sortable:!0,hidden:!G("admin"),formatter:(0,_.Z)("/dashboard/customers/view","customerId","customer"),text:"Customer",sortName:'{"Customer": {"name": "ORDER"}}'},{sortable:!0,hidden:!G("admin")&&!G("supplier"),formatter:(0,_.Z)("/dashboard/suppliers/view","supplierId","acceptSupplier"),text:"Accepted Supplier",sortName:'{"Supplier": {"name": "ORDER"}}'},{sortable:!0,hidden:!G("admin")&&!G("supplier"),formatter:function(n){var e,t=n.row;return n.data,(0,s.jsx)(s.Fragment,{children:(null==t?void 0:null===(e=t.offeredSupplier)||void 0===e?void 0:e.length)>0?(0,s.jsx)(s.Fragment,{children:((null==t?void 0:t.offeredSupplier)||[]).map(function(n){var e;return(0,s.jsx)(K,{onClick:function(e){var t;return nk(e,null==n?void 0:null===(t=n.supplier)||void 0===t?void 0:t.id)},children:null==n?void 0:null===(e=n.supplier)||void 0===e?void 0:e.name})})}):"-"})},text:"Offered Supplier",sortName:'{"Supplier": {"name": "ORDER"}}'},{hidden:!G("admin"),text:"Quotations"},{hidden:!G("admin")&&!G("supplier"),text:"Received"},{hidden:!G("admin"),text:"Quotations Range (if multiple)",formatter:function(n){var e=n.row.range;return e?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(ne,{children:["high: ",(0,y.Z)(e.high)]}),(0,s.jsxs)(ne,{children:["low:\xa0 ",(0,y.Z)(e.low)]})]}):"N/A"}},{sortable:!0,text:"Quote Due",sortName:"quoteDue",formatter:function(n){var e=n.row,t=(0,I.Z)(new Date),r="Quote"===e.type,a=e.status.includes("quoteSent");return r&&e.due<t&&!a?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(V.Z,{color:"error"})," ",e.due]}):e.due}},{text:"Scheduled",sortable:!0,sortName:"scheduledAt"},{text:"Created",sortable:!0,sortName:"createdAt"},{formatter:function(n){var e=n.row;return(null==e?void 0:e.offeredSupplier.length)>0&&(null==e?void 0:e.offeredSupplier.every(function(n){return"quotationRejected"===n.status}))?"Rejected":e.statusText},text:"Status",sortable:!0,sortName:"status"},{hidden:!0},{hidden:!0},{formatter:b.Z,formatterData:function(n){var e=[];return G("admin")&&e.push(nj),G("admin")&&e.push(nw),(G("admin")||G("supplier"))&&"quoteOffered"===n.status&&e.push(nD),e},text:"Actions"}],nk=function(n,e){n.stopPropagation(),m().push("/dashboard/suppliers/view?id=".concat(e))},nN=function(n){ni||m().push("/dashboard/issues/view?id=".concat(n.number))},nT=function(n){n.stopPropagation(),m().push("/dashboard/issues/manage?quoted=1")},nF=function(n){var e=null;if(n.length>1){var t,r,a=n.map(function(n){var e;return null===(e=n.lineItems)||void 0===e?void 0:e.reduce(function(n,e){return n+(e.total||0)*e.qty},0)});e={high:(t=Math).max.apply(t,(0,u.Z)(a||[])),low:(r=Math).min.apply(r,(0,u.Z)(a||[]))}}return e},nU=function(n,e){return n.map(function(n){var t,r,a,i,o,s,d,l,c,m,p,f,v,g,h,_=(0,u.Z)(N.iz).find(function(e){return e.value===n.status})||{text:"Accepted"},y=_.text,b=_.supplierText,$=_.customerText,q=((0,u.Z)(T.x).find(function(e){return e.value===n.type})||{text:"Quote"}).text,Z=n.manager?"".concat(n.manager.nameFirst," ").concat(n.manager.nameLast):"Unassigned",x=n.scheduledAt?(0,I.Z)(n.scheduledAt,!0):"-",S=(null==n?void 0:null===(t=n.quotations)||void 0===t?void 0:t.length)>0?n.quotations:[];return{id:n.id,creator:(null===(r=null==n?void 0:n.timings[0])||void 0===r?void 0:null===(a=r.user)||void 0===a?void 0:a.fullName)||"-",description:(null==n?void 0:n.description)?null==n?void 0:n.description:"-",number:n.number,type:q,status:n.status,propertyId:null===(i=n.location)||void 0===i?void 0:i.id,managerId:null===(o=n.manager)||void 0===o?void 0:o.id,customerId:null===(s=n.customer)||void 0===s?void 0:s.id,supplierId:n.supplier?n.supplier.id:"",siteVisitStart:n.siteVisitStart,siteVisitEnd:n.siteVisitEnd,siteVisitWeekends:n.siteVisitWeekends,service:(null===(d=n.service)||void 0===d?void 0:d.name)||"-",manager:Z,location:(null===(l=n.location)||void 0===l?void 0:l.name)||"-",property:(null===(c=n.location)||void 0===c?void 0:c.name)||"-",customer:(null===(m=n.customer)||void 0===m?void 0:m.name)||"-",acceptSupplier:n.supplier?n.supplier.name:"-",offeredSupplier:(null==n?void 0:null===(p=n.quotations)||void 0===p?void 0:p.length)>0?(h=n.quotations,e?h.map(function(n){var e;return null==n?void 0:null===(e=n.supplier)||void 0===e?void 0:e.name}).join(" / "):h):[],quotations:"".concat((null===(f=n.quotations)||void 0===f?void 0:f.length)||0,"/").concat(n.quoteNumber),received:"".concat(null===(v=n.quotations||[])||void 0===v?void 0:v.reduce(function(n,e){return"supplierQuoteComplete"===e.status?n+1:n},0),"/").concat((null===(g=n.quotations)||void 0===g?void 0:g.length)||0),range:nF(n.quotations),due:(0,I.Z)(n.quoteDue),scheduleDate:x,date:(0,I.Z)(n.createdAt),statusText:function(){if(S.every(function(n){return"quotationRejected"===n.status}))return"Quotation Rejected";if(G("admin"));else if(G("supplier"))return b||"Accepted";else if(G("customer"))return $||"Accepted";return y}(),quoted:n.quoted||!1,quotationsId:n.quotations[0]&&n.quotations[0].id,actions:""}})},nR=function(){return(0,s.jsxs)($.Z,{children:[(0,s.jsx)(q.Z,{marginRight:"xs",children:!(0,M.s)()&&!ni&&(0,s.jsx)(Z.Z,{content:"Export to excel",context:"secondary",size:"sm",disabled:nZ,onClick:nS,children:(0,s.jsx)(x.Z,{context:"white",icon:"file-csv",size:"lg"})})}),G("admin")&&(0,s.jsx)(Z.Z,{context:"secondary",content:"Add Quote",onClick:nT,size:"sm"})]})};return(0,s.jsx)(S.Z,{toolbar:(0,s.jsx)(nR,{}),open:!0,title:"Quotes",children:(0,s.jsx)(k.t,{columns:nC,loading:ny,meta:n_,ref:na,refetch:nI,rowClick:nN,rows:nU(nh)})})},K=H.ZP.button.withConfig({displayName:"table__LinkWrapper",componentId:"sc-bc8e2c6-0"})(W()),nn=H.ZP.div.withConfig({displayName:"table__StyledLink",componentId:"sc-bc8e2c6-1"})(Y()),ne=H.ZP.div.withConfig({displayName:"table__DivWrapper",componentId:"sc-bc8e2c6-2"})(G());X.propTypes={filters:l.object},X.defaultProps={filters:{customerId:null,date:null,managerId:!1,q:null,status:null,supplierId:null,filterType:"quotes_table"}}},72530:function(n,e,t){var r=t(7297),a=t(75063),i=t(17868),o=t(20725),u=t(22666),s=t(94885);function d(){var n=(0,r.Z)(["\n  query GetDashboardList(\n    $accountId: Int\n    $adminId: Int\n    $customerId: Int\n    $supplierId: Int\n    $locationId: Int\n    $managerId: Int\n    $number: String\n    $asAt: timestamptz\n    $jobHoldReasonId: Int\n    $limit: Int\n    $monthStart: timestamptz\n    $offset: Int\n    $orderBy: dashboard_home_details_order_by!\n    $q: String\n    $tileName: String\n    $dayStart: timestamptz\n    $userId: Int\n    $status: [String!]\n    $yearStart: timestamptz\n    $type: String\n  ) {\n    quotes: getDashboard_HomeTile_Details(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n        locationId: $locationId\n        managerId: $managerId\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { number: { _eq: $number } }\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        ",'\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        status: { _in: $status }\n        Job: { type: { _eq: $type } }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n      }\n      order_by: [$orderBy]\n      limit: $limit\n      offset: $offset\n    ) {\n      Assets(where: { entity: { _eq: "Job" } }) {\n        id\n        assetId\n        __typename\n      }\n      ...JobFields\n      ...JobAdminFields\n      admin: Admin {\n        id\n        name\n        __typename\n      }\n      customer: Customer {\n        ...AccountFields\n        __typename\n      }\n      location: Location {\n        id\n        name\n        __typename\n      }\n      manager: Manager {\n        ...UserFields\n        __typename\n      }\n      service: Service {\n        id\n        name\n        __typename\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n          __typename\n        }\n        __typename\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: {\n            _and: [\n              {status: { _eq: "active" }}\n              {type: { _eq: "tags" }}\n            ]\n          }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n      sla: SLA {\n        id\n        name\n        __typename\n      }\n      supplier: Supplier {\n        ...AccountFields\n        __typename\n      }\n      supplierOffers: SupplierOffers {\n        status\n        rate\n        supplier: Supplier {\n          ...AccountFields\n          __typename\n        }\n        __typename\n      }\n      job: Job {\n        type\n      }\n      timings: JobTimings(order_by: { createdAt: asc }) {\n        id\n        status\n        createdAt\n        user: User {\n          ...UserFields\n          __typename\n        }\n        __typename\n      }\n      quotations: SupplierQuotes {\n        id\n        createdAt\n        jobId\n        methodStatement\n        notes\n        quoteNumber\n        startDate\n        status\n        totalDuration\n        totalDurationUnit\n        updatedAt\n        siteVisitAt\n        supplier: Supplier {\n          ...AccountFields\n        }\n      }\n      id: jobId\n      number\n      # location\n      priority\n      scheduledAt\n      assignedTo\n      jobHoldReason\n      locationId\n      meta\n      managerId\n      description\n      customerName\n      customerId\n      reference\n      serviceName\n      status\n      supplierId\n      supplierName\n      timingStart\n      type\n      quoteNumber\n      quoteDue\n      createdAt\n    }\n    meta: getDashboard_HomeTile_Details_aggregate(\n      args: {\n        accountId: $accountId\n        adminId: $adminId\n        asAt: $asAt\n        jobHoldReasonId: $jobHoldReasonId\n        monthStart: $monthStart\n        tileName: $tileName\n        dayStart: $dayStart\n        userId: $userId\n        yearStart: $yearStart\n      }\n      where: {\n        _and: [\n          {\n            _or: [\n              { reference: { _ilike: $q } }\n              { description: { _ilike: $q } }\n              { customerName: { _ilike: $q } }\n              { serviceName: { _ilike: $q } }\n              { assignedTo: { _ilike: $q } }\n              { supplierName: { _ilike: $q } }\n              { location: { _ilike: $q } }\n              { number: { _ilike: $q } }\n            ]\n          }\n        ]\n        ',"\n        customerId: { _eq: $customerId }\n        supplierId: { _eq: $supplierId }\n        number: { _eq: $number }\n        status: { _in: $status }\n        Job: { type: { _eq: $type } }\n        locationId: { _eq: $locationId }\n        managerId: { _eq: $managerId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n        __typename\n      }\n      __typename\n    }\n  }\n  ","\n  ","\n  ","\n  ","\n  ","\n"]);return d=function(){return n},n}var l=function(n){var e=n.tagsWhere;return(0,a.Ps)(d(),e,e,i.z,u.WW,o.aL,o.wd,s.Px)};e.Z=l},78067:function(n,e,t){t.d(e,{m:function(){return G}});var r=t(47568),a=t(26042),i=t(69396),o=t(828),u=t(97582),s=t(85893),d=t(67294),l=t(45697),c=t(6812),m=t(50319),p=t(11163),f=t.n(p),v=t(42283),g=t(79665),h=t(76600),_=t(15214),y=t(9270),I=t(62140),b=t(49501),$=t(55563),q=t(6710),Z=t(95103),x=t(84043),S=t(11057),A=t(69368),j=t(50480),D=t(6054),w=t(536),C=function(n){var e=n.accountId,t=n.accountName,r=n.canSelectAccount,o=n.control,u=n.errors,l=n.setValue,c=n.watch,m=e?{value:e,label:t}:c("propertyOwner"),p=(0,D.Z)(m),f=function(n){l("contactUser",null)};(0,d.useEffect)(function(){m!==p&&p&&f(m)},[m]);var v={control:o,errors:u};return(0,s.jsxs)(y.Z,{children:[(0,s.jsx)(I.Z,{md:6,children:(0,s.jsx)(w.P,(0,i.Z)((0,a.Z)({},v),{defaultValue:e&&{value:e,label:t},errors:(0,a.Z)({},u),isDisabled:!r,label:"Client",name:"propertyOwner",placeholder:"Select",type:"customer"}))}),(0,s.jsx)(I.Z,{md:6,children:(0,s.jsx)(w.P,(0,i.Z)((0,a.Z)({},v),{accountId:(null==m?void 0:m.value)||null,errors:(0,a.Z)({},u),isDisabled:!m,label:"Contact Name",name:"contactUser",placeholder:m?"Select":"Select the location owner",type:"user"}))})]})};C.propTypes={accountId:l.number,accountName:l.string,canSelectAccount:l.bool.isRequired,control:l.func.isRequired,errors:l.object.isRequired,setValue:l.func.isRequired,watch:l.func.isRequired};var k=t(53600),N=function(n,e){var t=n.propertyOwner,r=n.contactUser;return n.Account_Locations={data:{accountId:t.value}},delete n.propertyOwner,n.contactUserId=(null==r?void 0:r.value)||null,delete n.contactUser,e&&delete n.Account_Locations,n},T=function(n,e,t,r){var a={location:N(n,!0),locationId:e.locationId,accountId:e.accountId,newAccountId:e.newAccountId,hasChanged:e.hasChanged};r({variables:a})},F=t(16310),U=t(74492),R=t(74944),L=t(7297),P=t(75063);function M(){var n=(0,L.Z)(["\n  query GetPropertiesJob($id: Int!) {\n    property: Location_by_pk(id: $id) {\n      id\n      jobs: Jobs {\n        id\n        timings: JobTimings {\n          id\n          status\n          createdAt\n        }\n      }\n    }\n  }\n"]);return M=function(){return n},n}function E(){var n=(0,L.Z)(["\n  mutation AddLocation($objects: [Location_insert_input!]!) {\n    insert_Location(objects: $objects) {\n      returning {\n        id\n        name\n      }\n    }\n  }\n"]);return E=function(){return n},n}function J(){var n=(0,L.Z)(["\n  mutation UpdateAccountLocation(\n    $location: Location_set_input\n    $locationId: Int!\n    $accountId: Int!\n    $newAccountId: Int!\n    $hasChanged: Boolean!\n  ) {\n    update_Account_Location(\n      where: { Account: { id: { _eq: $accountId } }, id: { _eq: $locationId } }\n      _set: { accountId: $newAccountId }\n    ) @include(if: $hasChanged) {\n      returning {\n        id\n      }\n    }\n    update_Location_by_pk(pk_columns: { id: $locationId }, _set: $location) {\n      id\n    }\n  }\n"]);return J=function(){return n},n}function z(){var n=(0,L.Z)(["\n  mutation UpdateAccount($id: Int!, $changes: Account_set_input) {\n    update_Account_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return z=function(){return n},n}var Q=(0,P.Ps)(M()),O=(0,P.Ps)(E()),V=(0,P.Ps)(J()),B=(0,P.Ps)(z()),H=t(16951),W=t(15897),Y="/dashboard/properties/",G=function(n){var e,t,l,p,D=n.accountId,w=n.accountName,L=n.entity,P=n.data,M=n.refetch,E=n.onAddressCreated,J=n.isPropsComponent,z=n.initialValues,G=n.xeroContactId,X=n.displayXeroContacts,K=n.xeroContacts,nn=n.displaySignin,ne=n.handleXeroAuthorize,nt=n.onClose,nr=(0,U.a)(),na=(0,R.x)().hasRole,ni=(0,d.useState)(!1),no=ni[0],nu=ni[1],ns=null==K?void 0:K.find(function(n){return n.value===G}),nd=(0,i.Z)((0,a.Z)({},P?(location.propertyOwner={label:P.customer[0].account.name,value:P.customer[0].account.id},location.contactUser=(null==P?void 0:P.user)&&P.customer[0].account.id&&{label:P.user.fullName,value:P.user.id},location.access=P.access,location.name=P.name,location.status=P.status,location.permitsRequired=P.permitsRequired,location):{},z),{xeroContact:ns}),nl=(0,v.cI)({defaultValues:nd,resolver:(0,g.S)((0,F.Ry)().shape({access:(0,F.Z_)().required(),contactUser:(0,F.Ry)().required(),name:(0,F.Z_)().required(),propertyOwner:(0,F.Ry)().required(),status:na("admin")&&(0,F.Z_)().required(),permitsRequired:(0,F.O7)()}))}),nc=nl.control,nm=nl.errors,np=nl.handleSubmit,nf=nl.register,nv=nl.setValue,ng=nl.getValues,nh=nl.watch,n_=(0,c.a)(Q,{variables:{id:null==P?void 0:P.id},skip:!(null==P?void 0:P.id)}).data,ny=(void 0===n_?{property:{}}:n_).property,nI=(l=(0,r.Z)(function(n){var e,t,r,i,o,s,d,l,c,m,p;return(0,u.__generator)(this,function(o){switch(o.label){case 0:var u,d;return e=n.addressFormData,t=n.outerFormData,r={Addresses:{data:{Address:{data:(0,a.Z)({},e)},entity:L}}},i=(0,a.Z)({},ng(),r,t),na("customer")&&(i.status="active"),[4,nq({variables:{objects:[N(u=i)]}})];case 1:return p=void 0===(m=(void 0===(l=(void 0===(s=o.sent().data)?{}:s).insert_Location)?{}:l).returning)?{}:m,E&&E(p),nr.close(),[2]}})}),function(n){return l.apply(this,arguments)}),nb=(p=(0,r.Z)(function(n){return(0,u.__generator)(this,function(e){return nr.show({title:"Add new address",content:(0,s.jsx)(H.k,{onCancel:function(){},onSubmit:function(e){nI({addressFormData:e,outerFormData:n})},type:"text"}),submit:!1}),[2]})}),function(n){return p.apply(this,arguments)}),n$=(0,o.Z)((0,m.D)(O,{onCompleted:function(n){if(!J){var e=n.insert_Location.returning[0].id;nr.close(),M?M():f().push("".concat(Y,"view?id=").concat(e))}}}),2),nq=n$[0],nZ=n$[1].loading,nx=(0,o.Z)((0,m.D)(V,{onCompleted:function(n){var e=n.update_Location_by_pk.id;nr.close(),M?M():f().push("".concat(Y,"view?id=").concat(e))}}),2),nS=nx[0],nA=nx[1].loading,nj=(0,o.Z)((0,m.D)(B),1)[0],nD=function(n){if(nu(!1),P){if("inactive"===n.status&&!(e=ny.jobs).every(function(n){return!!(0,k.E)(n,["completed","closed"])})){nu(!0);return}n.xeroContact&&nj({variables:{id:null===(u=null==P?void 0:P.customer[0])||void 0===u?void 0:u.account.id,changes:{meta:(0,i.Z)((0,a.Z)({},null===(s=null==P?void 0:P.customer[0])||void 0===s?void 0:s.account.meta),{xeroContactId:n.xeroContact.value})}}});var e,t,r,o,u,s,d={locationId:null==P?void 0:P.id,accountId:null===(t=null==P?void 0:P.customer[0])||void 0===t?void 0:t.account.id,newAccountId:null==n?void 0:null===(r=n.propertyOwner)||void 0===r?void 0:r.value,hasChanged:(null===(o=null==P?void 0:P.customer[0])||void 0===o?void 0:o.account.id)!==(null==n?void 0:n.propertyOwner.value)};T((0,i.Z)((0,a.Z)({},n),{xeroContact:void 0}),d,P.id,nS),nt&&nt()}else nb(n),nt&&nt()},nw={control:nc,errors:nm,register:nf};return(0,s.jsxs)(h.Z,{disabled:nZ||nA,id:"offCanvasForm",handleSubmit:np(nD),children:[no&&(0,s.jsx)(_.Z,{context:"info",content:" This location cannot be made inactive, it has active jobs."}),(0,s.jsx)(y.Z,{children:(0,s.jsx)(I.Z,{md:12,children:(0,s.jsx)(C,(0,i.Z)((0,a.Z)({},nw),{accountId:D,accountName:w,canSelectAccount:!D,setValue:nv,watch:nh}))})}),(0,s.jsx)(b.Z,{label:"Name",children:(0,s.jsx)($.Z,(0,i.Z)((0,a.Z)({},nw),{name:"name"}))}),(0,s.jsx)(b.Z,{label:"Access information",children:(0,s.jsx)(q.Z,(0,i.Z)((0,a.Z)({},nw),{name:"access",rows:4}))}),na("admin")&&(0,s.jsx)(b.Z,{label:"Status",children:(0,s.jsx)(Z.Z,(0,i.Z)((0,a.Z)({},nw),{name:"status",options:W.bg}))}),(0,s.jsx)(v.Qr,{name:"permitsRequired",control:nc,render:function(n){var e=n.value,t=n.onChange;return(0,s.jsx)(j.Z,{control:(0,s.jsx)(A.Z,{color:"secondary",checked:e||!1,onChange:function(n){return t(n.target.checked)}}),label:"Permits required"})}}),na("admin")&&void 0!==X&&X&&(0,s.jsx)(b.Z,{label:"Xero Contact",children:nn?(0,s.jsx)(S.Z,{variant:"contained",onClick:function(){ne()},children:"Connect to Xero to select Contact"}):(0,s.jsx)(x.Z,(0,i.Z)((0,a.Z)({options:K},nw),{name:"xeroContact"}))})]})};C.propTypes={accountId:l.number,accountName:l.string,data:l.object,refetch:l.func,offCanvas:l.func}}}]);