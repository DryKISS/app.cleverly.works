"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6257],{53371:function(e,n,r){r.d(n,{J:function(){return ey}});var i=r(26042),t=r(69396),s=r(828),o=r(85893),a=r(45697),l=r.n(a),u=r(6812),c=r(12632),d=r(11057),h=r(39474),m=r(87918),x=r(90629),v=r(51233),p=r(15861),f=r(45451),g=r(25040),j=r(84808),Z=r(98456),b=r(67720),y=r(86886),S=r(50135),C=r(21023),w=r(90948),I=r(61730),T=r(70768),H=r(26936),W=r(42283),q=r(18531),P=r(50319),O=r(57493),k=r(67294),A=r(89268),R=r(91830),L=r(55651),_=r(38948),F=r(85531),M=r(79665),N=r(23602),E=r(33754),D=r(30381),Q=r.n(D),$=r(6103),V=r(19512),Y=[{label:"GBP",value:1},{label:"AUD",value:2},{label:"EUR",value:3}],z=r(98521),B=r(7297),G=r(75063);function U(){var e=(0,B.Z)(["\n  query GetService($id: Int!) {\n    service: Service_by_pk(id: $id) {\n      id\n      name\n      status\n      countryId\n      currencyId\n    }\n  }\n"]);return U=function(){return e},e}function J(){var e=(0,B.Z)(["\n  mutation AddService($services: [Service_insert_input!]!) {\n    insert_Service(objects: $services) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return J=function(){return e},e}function X(){var e=(0,B.Z)(["\n  mutation UpdateService($id: Int!, $changes: Service_set_input) {\n    update_Service_by_pk(pk_columns: { id: $id }, _set: $changes) {\n      id\n    }\n  }\n"]);return X=function(){return e},e}function K(){var e=(0,B.Z)(['\n  query GetServiceScheduleForAccounts($serviceId: Int!, $offset: Int = 0, $limit: Int = 50) {\n    serviceSchedules: ServiceSchedule(\n      where: { serviceId: { _eq: $serviceId }, entity: { _in: ["Customer", "Supplier"] } }\n      offset: $offset\n      limit: $limit\n    ) {\n      id\n      normal\n      ooh\n      premium\n      account: Account {\n        id\n        type\n        name\n      }\n    }\n    serviceSchedules: ServiceSchedule_aggregate(\n      where: { serviceId: { _eq: $serviceId }, entity: { _in: ["Customer", "Supplier"] } }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return K=function(){return e},e}var ee=(0,G.Ps)(U()),en=(0,G.Ps)(J()),er=(0,G.Ps)(X()),ei=(0,G.Ps)(K()),et=r(16310),es=et.Ry().shape({name:et.Z_().required("Required"),country:et.Rx().oneOf(z.v.map(function(e){return e.value}),"Required"),currency:et.Rx().oneOf(Y.map(function(e){return e.value}),"Required"),status:et.Z_().oneOf(["active","inactive"]).required("Required")}),eo=r(74944),ea=r(50108),el=y.ZP,eu=function(e){var n=e.serviceId,r=e.close,a=(0,I.Z)("(max-width: 600px)"),l=(0,V.D)(),h=(0,eo.x)().user,m=(0,c.x)({filters:{}}),x=m.ref,g=m.initialData,b=(0,W.cI)({defaultValues:{status:"active"},resolver:(0,M.S)(es)}),y=b.control,C=b.errors,w=b.handleSubmit,T=b.reset,H=(0,u.a)(ee,{skip:!n,variables:{id:n},onCompleted:function(e){var n=e.service;T({name:n.name,country:n.countryId,currency:n.currencyId,status:n.status})}}).loading,q=(0,u.a)(ei,{skip:!n,variables:(0,t.Z)((0,i.Z)({},g),{serviceId:n})}),O=q.data,A=void 0===O?{serviceSchedules:[],meta:{aggregate:{totalCount:0}}}:O,L=A.serviceSchedules,_=A.meta,F=q.loading,N=q.refetch,E=(0,s.Z)((0,P.D)(en,{onCompleted:function(){l.show({content:"Service was added successfully",severity:"success"}),r()},onError:function(e){l.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),D=E[0],Q=E[1].loading,$=(0,s.Z)((0,P.D)(er,{onCompleted:function(){l.show({content:"Service was updated successfully",severity:"success"}),r()},onError:function(e){l.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),B=$[0],G=$[1].loading,U=function(e){n?B({variables:{id:n,changes:{name:e.name,countryId:e.country,currencyId:e.currency,status:e.status}}}):D({variables:{services:[{name:e.name,countryId:e.country,currencyId:e.currency,status:e.status,adminId:h.adminId}]}})},J=(0,k.useMemo)(function(){return[{flex:1,field:"accountName",headerName:"Account",sortable:!1},{flex:1,field:"accountType",headerName:"Type",sortable:!1},{flex:1,field:"normal",headerName:"Normal",sortable:!1,renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: ",(0,ea.T)(n.normal.firstHour)]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: ",(0,ea.T)(n.normal.subsequentHours)]})]})}},{flex:1,field:"ooh",headerName:"OOH",sortable:!1,renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: ",(0,ea.T)(n.ooh.firstHour)]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: ",(0,ea.T)(n.ooh.subsequentHours)]})]})}},{flex:1,field:"premium",headerName:"Premium",sortable:!1,renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: ",(0,ea.T)(n.premium.firstHour)]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: ",(0,ea.T)(n.premium.subsequentHours)]})]})}}]},[]),X=(0,k.useMemo)(function(){return L.map(function(e){return{id:e.id,accountName:e.account.name,accountType:e.account.type,normal:e.normal,ooh:e.ooh,premium:e.premium}})},[L]);return(0,o.jsxs)(o.Fragment,{children:[(H||Q||G)&&(0,o.jsx)(j.Z,{sx:{zIndex:1e5},open:!0,children:(0,o.jsx)(Z.Z,{color:"secondary"})}),(0,o.jsx)("form",{id:"addServiceForm",onSubmit:function(e){e.stopPropagation(),w(U)(e)},children:(0,o.jsxs)(ed,{is600pxOrLess:a,children:[(0,o.jsxs)(v.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,o.jsx)(p.Z,{variant:"h5",fontWeight:700,children:n?"Edit Service":"Add Service"}),(0,o.jsx)(d.Z,{variant:"contained",color:"secondary",size:"small",form:"addServiceForm",type:"submit",children:n?"Submit":"Add"})]}),(0,o.jsxs)(el,{container:!0,rowSpacing:1,columnSpacing:4,children:[(0,o.jsxs)(el,{container:!0,item:!0,xs:12,sm2:6,children:[(0,o.jsx)(el,{item:!0,xs:2,sm2:3,md2:2,alignSelf:"flex-end",mb:"5px",children:(0,o.jsx)(p.Z,{children:"Name"})}),(0,o.jsx)(el,{item:!0,xs:10,sm2:9,md2:10,children:(0,o.jsx)(W.Qr,{name:"name",control:y,render:function(e){var n,r=e.value,i=e.onChange;return(0,o.jsx)(S.Z,{fullWidth:!0,label:"Name",color:"secondary",variant:"standard",value:r,onChange:i,error:C.name,helperText:null===(n=C.name)||void 0===n?void 0:n.message})}})})]}),(0,o.jsxs)(el,{container:!0,item:!0,xs:12,sm2:6,children:[(0,o.jsx)(el,{item:!0,xs:2,sm2:3,md2:2,alignSelf:"flex-end",mb:"5px",children:(0,o.jsx)(p.Z,{children:"Country"})}),(0,o.jsxs)(el,{item:!0,xs:10,sm2:9,md2:10,children:[" ",(0,o.jsx)(W.Qr,{name:"country",control:y,render:function(e){var n=e.value,r=e.onChange;return(0,o.jsx)(R.P,{value:n,onChange:r,options:z.v,label:"Country",selectProps:{fullWidth:!0},formControl:{fullWidth:!0,variant:"standard",color:"secondary"}})}})]})]}),(0,o.jsxs)(el,{container:!0,item:!0,xs:12,sm2:6,children:[(0,o.jsx)(el,{item:!0,xs:2,sm2:3,md2:2,alignSelf:"flex-end",mb:"5px",children:(0,o.jsx)(p.Z,{children:"Currency"})}),(0,o.jsx)(el,{item:!0,xs:10,sm2:9,md2:10,children:(0,o.jsx)(W.Qr,{name:"currency",control:y,render:function(e){var n=e.value,r=e.onChange;return(0,o.jsx)(R.P,{value:n,onChange:r,options:Y,label:"Currency",selectProps:{fullWidth:!0},formControl:{fullWidth:!0,variant:"standard",color:"secondary"}})}})})]}),(0,o.jsxs)(el,{container:!0,item:!0,xs:12,sm2:6,children:[(0,o.jsx)(el,{item:!0,xs:2,sm2:3,md2:2,alignSelf:"flex-end",mb:"5px",children:(0,o.jsx)(p.Z,{children:"Status"})}),(0,o.jsx)(el,{item:!0,xs:10,sm2:9,md2:10,children:(0,o.jsx)(W.Qr,{name:"status",control:y,render:function(e){var n=e.value,r=e.onChange;return(0,o.jsx)(R.P,{value:n,onChange:r,options:ec,label:"Status",selectProps:{fullWidth:!0},formControl:{fullWidth:!0,variant:"standard",color:"secondary"}})}})})]})]}),n&&(0,o.jsxs)(v.Z,{mt:3,children:[(0,o.jsx)(v.Z,{direction:"row",children:(0,o.jsx)(p.Z,{variant:"h5",fontWeight:700,children:"Accounts"})}),(0,o.jsx)(f.i,{autoHeight:!1,loading:F,ref:x,columns:J,rows:X,meta:_,refetch:N,containerHeight:"calc(100vh - 400px)"})," "]})]})})]})};eu.defaultProps={close:function(){}},eu.propTypes={serviceId:l().number,close:l().func};var ec=[{value:"active",label:"Active"},{value:"inactive",label:"Inactive"}],ed=(0,w.ZP)(x.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"80vw",height:"auto",maxHeight:n?"100vh":"70vh",padding:"16px 27px 36px 27px",borderRadius:"8px"}}),eh=r(67797),em=r(21269),ex=y.ZP,ev=d.Z,ep=function(e){var n=e.scheduleId,r=e.entity,a=e.entityId,l=e.close,c=(0,I.Z)("(max-width: 600px)"),d=(0,V.D)(),h=(0,s.Z)((0,eh.d)(),2),x=h[0],f=h[1],y=(0,k.useState)(n),w=y[0],D=y[1],Y=(0,k.useState)(""),z=Y[0],B=Y[1],G=(0,k.useState)(""),U=G[0],J=G[1],X=(0,k.useState)(""),K=X[0],ee=X[1],en=(0,k.useState)(null),er=en[0],ei=en[1],et=(0,W.cI)({defaultValues:{status:"active",coverageAreas:[]},resolver:(0,M.S)(N.r)}),es=et.handleSubmit,eo=et.control,ea=et.errors,el=et.register,ec=et.watch,ed=et.setValue,ep=et.reset,ej=(0,W.Dq)({control:eo,name:"days"}),eZ=ec("service"),eb=ec("coverageAreas"),ey=(0,u.a)(g.Ey,{skip:!w,variables:{serviceScheduleId:w},onCompleted:function(e){var n=e.serviceSchedule,r=(0,F.Ty)(n);ep((0,i.Z)({},r))}}).loading,eS=(0,u.a)(O.kx,{variables:{q:""!==z?"%".concat(z,"%"):null,limit:50,offset:0}}),eC=eS.loading,ew=eS.data,eI=(void 0===ew?{items:[]}:ew).items,eT=(0,u.a)(O.pY,{skip:!(null==eZ?void 0:eZ.value),variables:{entity:r,serviceId:null==eZ?void 0:eZ.value,q:""!==U?"%".concat(U,"%"):null,limit:50,offset:0}}),eH=eT.loading,eW=eT.data,eq=(void 0===eW?{items:[]}:eW).items,eP=(0,u.a)(O.T_,{variables:{where:{name:{_eq:""!==K?"%".concat(K,"%"):null},subtype:{_eq:"reactive"}},limit:50,offset:0}}),eO=eP.loading,ek=eP.data,eA=(void 0===ek?{items:[]}:ek).items,eR=(0,s.Z)((0,P.D)(g.Sx,{refetchQueries:["GetServiceSchedules"],onError:function(e){d.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){d.show({content:"Service schedule was created",severity:"success"}),l()}}),1)[0],eL=(0,s.Z)((0,P.D)(g.kt,{refetchQueries:["GetServiceSchedules"],onError:function(e){d.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){d.show({content:"Service schedule was updated",severity:"success"}),l()}}),1)[0],e_=function(e){if(w||n){var s=(0,F.ee)({form:e,entity:r,entityId:a});eL({variables:{data:(0,t.Z)((0,i.Z)({},s),{id:w})}})}else{var o=(0,F.ee)({form:e,entity:r,entityId:a});eR({variables:{data:o}})}},eF=function(e){e.stopPropagation(),f({content:function(e){var n=e.onClose;return(0,o.jsx)(eu,{close:n})}})},eM=(0,k.useMemo)(function(){return w||n?"Edit ".concat(eg[r]," schedule"):"Create ".concat(eg[r]," schedule")},[n,r,w]);return(0,o.jsxs)("form",{onSubmit:es(e_),children:[x,ey&&(0,o.jsx)(j.Z,{sx:{zIndex:1e5},open:!0,children:(0,o.jsx)(Z.Z,{color:"secondary"})}),(0,o.jsx)(ef,{is600pxOrLess:c,children:(0,o.jsxs)(v.Z,{height:"100%",width:"100%",children:[(0,o.jsx)(v.Z,{children:(0,o.jsx)(p.Z,{variant:"h5",fontWeight:700,children:eM})}),(0,o.jsx)(v.Z,{height:"100%",pt:2,pr:2,sx:{overflowY:"scroll"},children:(0,o.jsxs)(ex,{container:!0,columnSpacing:2,children:[(0,o.jsxs)(ex,{container:!0,item:!0,xs:12,md2:7,columnSpacing:2,rowSpacing:2,children:[(0,o.jsxs)(ex,{item:!0,xs:12,sm2:6,children:[(0,o.jsxs)(v.Z,{spacing:2,mb:2,children:[(0,o.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",children:[(0,o.jsx)(p.Z,{mr:"29px",children:"Service"}),(0,o.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",spacing:1,children:[(0,o.jsx)(W.Qr,{name:"service",control:eo,render:function(e){var n,r=e.value,t=e.onChange;return(0,o.jsx)(q.q,{fullWidth:!0,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:r||null,onChange:function(e,n){(null==n?void 0:n.value)?t(n):(D(null),ep((0,i.Z)({},A.FY)))},loading:eC,options:eI,setSearch:B,textFieldProps:{color:"secondary",variant:"standard",placeholder:"Service",error:ea.service,helperText:null===(n=ea.service)||void 0===n?void 0:n.message}})}}),(0,o.jsx)(C.Z,{title:"Add service",children:(0,o.jsx)(ev,{disableMinWidth:!0,color:"secondary",variant:"contained",size:"small",onClick:eF,children:"+"})})]})]}),(0,o.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",spacing:2,children:[(0,o.jsx)(p.Z,{children:"Schedule"}),w||n?(0,o.jsx)(W.Qr,{name:"schedule",control:eo,render:function(e){var n,r=e.value,s=e.onChange;return(0,o.jsx)(q.q,{fullWidth:!0,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:r||null,onChange:function(e,n){(null==n?void 0:n.value)?(D(null==n?void 0:n.value),s(n)):(D(null),ep((0,t.Z)((0,i.Z)({},A.FY),{service:eZ})))},loading:eH,options:eq,setSearch:J,textFieldProps:{color:"secondary",variant:"standard",placeholder:"Schedule",error:ea.schedule,helperText:null===(n=ea.schedule)||void 0===n?void 0:n.message}})}}):(0,o.jsx)(W.Qr,{name:"scheduleName",control:eo,render:function(e){var n=e.value,r=e.onChange;return(0,o.jsx)(S.Z,{fullWidth:!0,color:"secondary",variant:"standard",placeholder:"Schedule name",value:n,onChange:r})}})]}),(0,o.jsxs)(v.Z,{direction:"row",alignItems:"center",width:"100%",children:[(0,o.jsx)(p.Z,{mr:"34px",children:"Status"}),(0,o.jsx)(W.Qr,{name:"status",control:eo,render:function(e){var n,r=e.value,i=e.onChange;return(0,o.jsx)(R.P,{formControl:{fullWidth:!0,variant:"standard",color:"secondary",error:ea.status,helperText:null===(n=ea.status)||void 0===n?void 0:n.message},selectProps:{fullWidth:!0},value:r,onChange:i,options:A.hm})}})]})]}),(0,o.jsxs)(v.Z,{width:"100%",mb:2,children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Priority"}),(0,o.jsx)(W.Qr,{name:"priority",control:eo,render:function(e){var n,r=e.value,i=e.onChange;return(0,o.jsx)(q.q,{multiple:!0,fullWidth:!0,color:"secondary",filterSelectedOptions:!0,loading:eO,value:r||[],onChange:function(e,n){i(n)},options:eA,setSearch:ee,textFieldProps:{placeholder:"Select priority",variant:"standard",color:"secondary",error:ea.priority,helperText:null===(n=ea.priority)||void 0===n?void 0:n.message}})}})]}),(0,o.jsxs)(ex,{container:!0,item:!0,columnSpacing:2,rowSpacing:2,children:[(0,o.jsxs)(ex,{item:!0,xs:12,md:6,md2:12,lg2:6,children:[(0,o.jsx)(p.Z,{children:"Minimum duration"}),(0,o.jsx)(W.Qr,{name:"minimumDuration",control:eo,render:function(e){var n,r=e.value,i=e.onChange;return(0,o.jsx)(T.I,{fullWidth:!0,leftLabel:(0,o.jsx)(em.Z,{sx:{height:"18px"}}),rightLabel:"Mins",sx:{minWidth:"60px"},type:"number",value:r,onChange:i,error:ea.minimumDuration,helperText:null===(n=ea.minimumDuration)||void 0===n?void 0:n.message})}})]}),(0,o.jsxs)(ex,{item:!0,xs:12,md:6,md2:12,lg2:6,children:[(0,o.jsx)(p.Z,{children:"Minimum increment"}),(0,o.jsx)(W.Qr,{name:"minimumIncrement",control:eo,render:function(e){var n,r=e.value,i=e.onChange;return(0,o.jsx)(T.I,{fullWidth:!0,leftLabel:(0,o.jsx)(em.Z,{sx:{height:"18px"}}),rightLabel:"Mins",sx:{minWidth:"60px"},type:"number",value:r,onChange:i,error:ea.minimumIncrement,helperText:null===(n=ea.minimumIncrement)||void 0===n?void 0:n.message})}})]})]})]}),(0,o.jsxs)(ex,{item:!0,xs:12,sm2:6,children:[(0,o.jsx)(_.B,{editable:!0,paginationSize:4,entity:"ServiceSchedule",entityId:w,name:"coverageAreas",values:eb||[],setValue:ed}),(0,o.jsx)("input",(0,t.Z)((0,i.Z)({},el("coverageAreas")),{type:"hidden"}))]}),(0,o.jsxs)(ex,{width:"100%",container:!0,item:!0,xs:12,columnSpacing:2,children:[(0,o.jsxs)(ex,{item:!0,xs:12,width:"100%",pr:2,mb:1,children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Rates"}),(0,o.jsx)(b.Z,{})]}),(0,o.jsx)(ex,{item:!0,xs:12,sm3:4,children:(0,o.jsxs)(v.Z,{spacing:1,width:"100%",children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Normal"}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"First hour"}),(0,o.jsx)(W.Qr,{name:"normal.firstHour",control:eo,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(T.I,{fullWidth:!0,leftLabel:(0,o.jsx)(H.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ea.normal)||void 0===n?void 0:n.firstHour,helperText:null===(r=ea.normal)||void 0===r?void 0:null===(i=r.firstHour)||void 0===i?void 0:i.message})}})]}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"Subsequent hours"}),(0,o.jsx)(W.Qr,{name:"normal.subsequentHours",control:eo,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(T.I,{fullWidth:!0,leftLabel:(0,o.jsx)(H.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ea.normal)||void 0===n?void 0:n.subsequentHours,helperText:null===(r=ea.normal)||void 0===r?void 0:null===(i=r.subsequentHours)||void 0===i?void 0:i.message})}})]})]})}),(0,o.jsx)(ex,{item:!0,xs:12,sm3:4,children:(0,o.jsxs)(v.Z,{spacing:1,width:"100%",children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"OOH"}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"First hour"}),(0,o.jsx)(W.Qr,{name:"ooh.firstHour",control:eo,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(T.I,{fullWidth:!0,leftLabel:(0,o.jsx)(H.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ea.ooh)||void 0===n?void 0:n.firstHour,helperText:null===(r=ea.ooh)||void 0===r?void 0:null===(i=r.firstHour)||void 0===i?void 0:i.message})}})]}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"Subsequent hours"}),(0,o.jsx)(W.Qr,{name:"ooh.subsequentHours",control:eo,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(T.I,{fullWidth:!0,leftLabel:(0,o.jsx)(H.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ea.ooh)||void 0===n?void 0:n.subsequentHours,helperText:null===(r=ea.ooh)||void 0===r?void 0:null===(i=r.subsequentHours)||void 0===i?void 0:i.message})}})]})]})}),(0,o.jsx)(ex,{item:!0,xs:12,sm3:4,children:(0,o.jsxs)(v.Z,{spacing:1,width:"100%",children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Premium"}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"First hour"}),(0,o.jsx)(W.Qr,{name:"premium.firstHour",control:eo,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(T.I,{fullWidth:!0,leftLabel:(0,o.jsx)(H.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ea.premium)||void 0===n?void 0:n.firstHour,helperText:null===(r=ea.premium)||void 0===r?void 0:null===(i=r.firstHour)||void 0===i?void 0:i.message})}})]}),(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{children:"Subsequent hours"}),(0,o.jsx)(W.Qr,{name:"premium.subsequentHours",control:eo,render:function(e){var n,r,i,t=e.value,s=e.onChange;return(0,o.jsx)(T.I,{fullWidth:!0,leftLabel:(0,o.jsx)(H.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{minWidth:"80px"},type:"number",value:t,onChange:s,error:null===(n=ea.premium)||void 0===n?void 0:n.subsequentHours,helperText:null===(r=ea.premium)||void 0===r?void 0:null===(i=r.subsequentHours)||void 0===i?void 0:i.message})}})]})]})})]})]}),(0,o.jsx)(ex,{item:!0,xs:12,md2:5,children:(0,o.jsxs)(v.Z,{spacing:1,children:[(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,mb:1,children:"Times"}),(0,o.jsx)(b.Z,{})]}),(0,o.jsxs)(v.Z,{spacing:.5,children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"OOH"}),(0,o.jsx)(v.Z,{spacing:1,children:A.jT.map(function(e){var n,r,i;return(0,o.jsx)(L.k,{control:eo,name:"oohTimes.".concat(e.value),day:e.label,error:null===(n=ea.oohTimes)||void 0===n?void 0:n[e.value],helperText:null===(r=ea.oohTimes)||void 0===r?void 0:null===(i=r[e.value])||void 0===i?void 0:i.message})})})]}),(0,o.jsxs)(v.Z,{spacing:.5,children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Premium"}),(0,o.jsx)(v.Z,{spacing:1,children:A.jT.map(function(e){var n,r,i;return(0,o.jsx)(L.k,{control:eo,name:"premiumTimes.".concat(e.value),day:e.label,error:null===(n=ea.premiumTimes)||void 0===n?void 0:n[e.value],helperText:null===(r=ea.premiumTimes)||void 0===r?void 0:null===(i=r[e.value])||void 0===i?void 0:i.message})})})]})]})}),(0,o.jsxs)(ex,{container:!0,item:!0,xs:12,mt:2,columnSpacing:2,children:[(0,o.jsx)(ex,{item:!0,xs:0,md2:7}),(0,o.jsx)(ex,{item:!0,xs:12,md2:5,children:(0,o.jsxs)(v.Z,{children:[(0,o.jsx)(p.Z,{variant:"h6",fontWeight:700,children:"Days"}),(0,o.jsx)(v.Z,{direction:"row",spacing:1,flexWrap:"wrap",children:ej.fields.map(function(e,n){return(0,o.jsx)(m.Z,{label:Q()(e).format("YYYY-MM-DD"),size:"small",onDelete:function(){return ej.remove(n)}})})}),(0,o.jsxs)(v.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,o.jsx)(E.M,{inputFormat:"YYYY-MM-DD",placeholder:"Select days",value:er,onChange:function(e){ei(e)},renderInput:function(e){return(0,o.jsx)(S.Z,(0,t.Z)((0,i.Z)({},e),{fullWidth:!0,color:"secondary",variant:"standard"}))}}),(0,o.jsx)(ev,{disableMinWidth:!0,color:"secondary",variant:"contained",size:"small",onClick:function(){return ej.append(er)},children:(0,o.jsx)($.Z,{})})]})]})})]}),(0,o.jsx)(ex,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},mt:2,children:(0,o.jsx)(p.Z,{color:"muiGray.main",children:"All job start times occurring outside times specified above will be charged based on Normal rates."})})]})}),(0,o.jsxs)(v.Z,{width:"100%",direction:"row",justifyContent:"center",spacing:2,children:[(0,o.jsx)(ev,{color:"danger",variant:"contained",onClick:l,children:"Cancel"}),(0,o.jsx)(ev,{color:"secondary",variant:"contained",type:"submit",children:w||n?"Save":"Add schedule"})]})]})})]})};ep.propTypes={entity:l().oneOf(["System-Customer","System-Supplier"]).isRequired},ep.defaultProps={};var ef=(0,w.ZP)(x.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"90vw",height:n?"100vh":"90vh",padding:"16px 27px 16px 27px",borderRadius:"8px"}}),eg={"System-Customer":"customer","System-Supplier":"supplier"},ej=r(21830),eZ=r(79217),eb=r(15843),ey=function(e){var n=e.initialFilters,r=e.entity,a=e.entityId,l=e.tableHeight,j=e.paperHeight,Z=(0,s.Z)((0,eh.d)(),2),b=Z[0],y=Z[1],S=(0,k.useState)({}),C=S[0],w=S[1],I=(0,k.useState)(!1),T=I[0],H=I[1],W=(0,c.x)({filters:C}),q=W.ref,P=W.initialData,O=(0,u.a)(g.pB,{variables:(0,t.Z)((0,i.Z)({},P),{entity:r})}),A=O.data,R=void 0===A?{schedules:[],meta:{aggregate:{totalCount:0}}}:A,L=R.schedules,_=R.meta,F=O.loading,M=O.refetch,N=function(e){e.stopPropagation(),y({content:function(e){var n=e.onClose;return(0,o.jsx)(ep,{entity:r,entityId:a,close:n})}})},E=(0,k.useCallback)(function(e){y({content:function(n){var i=n.onClose;return(0,o.jsx)(ep,{scheduleId:e,entity:r,entityId:a,close:i})}})},[r,a,y]),D=(0,k.useCallback)(function(e){y({content:function(n){var r=n.onClose;return(0,o.jsx)(eu,{serviceId:e,close:r})}})},[y]),Q=(0,k.useCallback)(function(e){return[{icon:"edit",onClick:function(n){n.stopPropagation(),E(e.id)},tooltip:"Edit Schedule"},{icon:"edit",onClick:function(n){n.stopPropagation(),D(e.serviceId)},tooltip:"Edit Service"}]},[D,E]),$=(0,k.useMemo)(function(){return[{sortable:!1,flex:1,minWidth:180,field:"serviceLine",headerName:"Service line"},{sortable:!1,flex:1,minWidth:180,field:"schedule",headerName:"Schedule"},{sortable:!1,flex:1,minWidth:180,field:"rate",headerName:"\xa3/H",renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: \xa3 ",n.rate.firstHour]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: \xa3 ",n.rate.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:180,field:"rateOOH",headerName:"\xa3/H OOH",renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: \xa3 ",n.rateOOH.firstHour]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: \xa3 ",n.rateOOH.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:180,field:"ratePremium",headerName:"\xa3/H Premium",renderCell:function(e){var n=e.row;return(0,o.jsxs)(v.Z,{children:[(0,o.jsxs)(p.Z,{children:["First hour: \xa3 ",n.ratePremium.firstHour]}),(0,o.jsxs)(p.Z,{children:["Subsequent hours: \xa3 ",n.ratePremium.subsequentHours]})]})}},{sortable:!1,flex:1,minWidth:150,field:"coverageArea",headerName:"Coverage area"},{sortable:!1,flex:1,field:"minimumDuration",headerName:"Min duration"},{sortable:!1,flex:1,field:"minimumIncrement",headerName:"Min increment"},{sortable:!1,flex:1,minWidth:100,field:"status",headerName:"Status",renderCell:function(e){var n=e.row;return(0,o.jsx)(m.Z,{label:"active"===n.status?"Active":"Inactive",color:"active"===n.status?"success":"danger",size:"small"})}},{sortable:!1,width:100,field:"actions",headerName:"Actions",renderCell:function(e){var n=e.row;return(0,o.jsx)(ej.C,{row:n,actionsData:Q})}}]},[Q]),V=(0,k.useMemo)(function(){return L.map(function(e){return{id:e.id,serviceLine:e.service.name,schedule:e.name,rate:e.normal,rateOOH:e.ooh,ratePremium:e.premium,coverageArea:e.postcodeAreas.map(function(e){return e.postcode.area}).join(", "),minimumDuration:e.minimumDuration,minimumIncrement:e.minimumIncrement,status:e.status,serviceId:e.serviceId}})},[L]);return(0,o.jsxs)(o.Fragment,{children:[b,(0,o.jsx)(eZ.X,{open:T,close:function(){return H(!1)},initialFilters:n,setFilters:w}),(0,o.jsx)(v.Z,{width:"100%",spacing:2,children:(0,o.jsxs)(x.Z,{sx:{paddingTop:"16px",paddingBottom:"16px",height:j},children:[(0,o.jsxs)(v.Z,{direction:"row",justifyContent:"space-between",pl:2,pr:2,children:[(0,o.jsx)(p.Z,{variant:"h5",sx:{fontWeight:600},children:"Services"}),(0,o.jsxs)(h.Z,{children:[(0,o.jsx)(d.Z,{color:"secondary",variant:"contained",onClick:N,children:"Add schedule"}),(0,o.jsx)(d.Z,{startIcon:(0,o.jsx)(eb.Z,{}),variant:"contained",onClick:function(){return H(!0)},children:"Filters"})]})]}),(0,o.jsx)(f.i,{autoHeight:!1,loading:F,ref:q,columns:$,rows:V,meta:_,refetch:M,containerHeight:l,columnVisibilityModel:{},onRowClick:function(e){return E(e.row.id)}})]})})]})};ey.propTypes={initialFilters:l().object,entity:l().oneOf(["System-Customer","System-Supplier"]).isRequired,entityId:l().string,tableHeight:l().string,paperHeight:l().string},ey.defaultProps={tableHeight:"calc(100% - 42px)",paperHeight:"calc(100vh - 90px)"}},86574:function(e,n,r){r.d(n,{O:function(){return l}});var i=r(26042),t=r(85893),s=r(90948),o=r(40044),a=(0,s.ZP)(function(e){return(0,t.jsx)(o.Z,(0,i.Z)({disableRipple:!0},e))})(function(e){var n=e.theme;return{textTransform:"none",color:n.palette.text.primary,"&.Mui-selected":{fontWeight:600,color:n.palette.secondary.contrastText,backgroundColor:n.palette.secondary.main},"&.Mui-focusVisible":{backgroundColor:"rgba(100, 95, 228, 0.32)"}}}),l=function(e){return(0,t.jsx)(a,(0,i.Z)({},e))};l.defaultProps={},l.propTypes={}},83336:function(e,n,r){r.d(n,{m:function(){return x}});var i=r(26042),t=r(69396),s=r(99534),o=r(85893),a=r(45697),l=r.n(a),u=r(90948),c=r(3892),d=r(11163),h=r.n(d),m=(0,u.ZP)(function(e){return(0,o.jsx)(c.Z,(0,i.Z)({},e))})(function(e){var n=e.theme,r=e.size;return(0,t.Z)((0,i.Z)({},"small"===r&&{height:"32px",minHeight:"32px"}),{"& .MuiTabs-scroller":(0,i.Z)({overflow:"scroll !important"},"small"===r&&{height:"60px",minHeight:"60px"}),"& .MuiTabs-indicator":{display:"none"},"& .MuiTabs-flexContainer > .MuiTab-root":(0,t.Z)((0,i.Z)({},"small"===r&&{height:"32px",minHeight:"32px"}),{border:1,borderStyle:"solid",borderColor:n.palette.divider,"&:first-child":(0,i.Z)({borderTopLeftRadius:"10px",borderBottomLeftRadius:"10px"},"small"===r&&{borderTopLeftRadius:"5px",borderBottomLeftRadius:"5px"}),"&:last-child":(0,i.Z)({borderTopRightRadius:"10px",borderBottomRightRadius:"10px"},"small"===r&&{borderTopRightRadius:"5px",borderBottomRightRadius:"5px"})})})}),x=function(e){var n=e.onChange,r=e.changeQuery,t=(0,s.Z)(e,["onChange","changeQuery"]),a=(0,d.useRouter)(),l=function(e,i){n(e,i),r&&u(i)},u=function(e){var n=a.query;delete n.tab,n.tab=e,h().push({pathname:a.pathname,query:n,shallow:!0})};return(0,o.jsx)(m,(0,i.Z)({onChange:l},t))};x.defaultProps={size:"small"},x.propTypes={size:l().oneOf(["small",void 0])}}}]);