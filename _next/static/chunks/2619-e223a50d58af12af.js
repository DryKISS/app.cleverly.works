"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2619],{64293:function(e,n,t){var o=t(67294);function r(){return(r=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let a=e=>o.createElement("svg",r({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 20 20"},e),o.createElement("path",{fill:"#FFF",d:"M7.54 8.964c.05 0 .1-.014.141-.04a.25.25 0 0 0 .094-.107c.105-.437.35-.832.703-1.13.057-.035.08-.111.08-.183a.2.2 0 0 0-.03-.085.2.2 0 0 0-.068-.062l-5.511-3.05 3.52-1.941a.46.46 0 0 0 .169-.156.39.39 0 0 0 .005-.432.4.4 0 0 0-.174-.153l-1.057-.571a.48.48 0 0 0-.449 0L.236 3.643a.46.46 0 0 0-.17.156.4.4 0 0 0-.066.214v5.139a.4.4 0 0 0 .062.217.4.4 0 0 0 .174.153l1.052.572c.071.04.153.058.236.053a.46.46 0 0 0 .311-.111.47.47 0 0 0 .137-.313V5.915l5.473 3.031q.045.02.095.018m7.152 6.469a.6.6 0 0 0-.236.053l-3.515 1.924v-5.986c0-.13-.136-.26-.292-.205-.446.126-.92.132-1.368.017a.24.24 0 0 0-.2.035.2.2 0 0 0-.067.075.2.2 0 0 0-.026.096v5.95l-3.515-1.924a.43.43 0 0 0-.236-.053.47.47 0 0 0-.315.125.42.42 0 0 0-.133.299v1.165a.4.4 0 0 0 .061.217.4.4 0 0 0 .175.154l4.727 2.57q.107.06.232.055a.54.54 0 0 0 .235-.054l4.728-2.571a.46.46 0 0 0 .17-.157.4.4 0 0 0 .066-.214v-1.165c-.043-.201-.26-.406-.49-.406m-1.76-13.38c.215 0 .425-.06.603-.173.179-.112.318-.273.4-.46a.98.98 0 0 0 .062-.594A1 1 0 0 0 13.7.301a1.1 1.1 0 0 0-.556-.281c-.21-.04-.429-.02-.627.058s-.368.21-.487.378a1 1 0 0 0-.183.57 1 1 0 0 0 .318.727c.204.192.48.3.767.3m3.001-.45c-.215 0-.424.06-.603.173a1.04 1.04 0 0 0-.4.46.98.98 0 0 0-.061.594c.042.199.145.382.297.525s.345.242.555.281.429.02.627-.058c.199-.078.368-.21.487-.378a1 1 0 0 0 .183-.57 1 1 0 0 0-.318-.727c-.203-.192-.48-.3-.767-.3m2.982 3.736c.215 0 .424-.06.603-.173a1.04 1.04 0 0 0 .4-.46.98.98 0 0 0 .061-.594 1 1 0 0 0-.297-.526 1.1 1.1 0 0 0-.555-.28c-.211-.04-.43-.02-.627.058-.199.078-.368.21-.487.378a.99.99 0 0 0 .134 1.296c.204.193.48.301.768.301m-2.982-.41c-.215 0-.424.06-.603.172a1.04 1.04 0 0 0-.4.461.98.98 0 0 0-.061.594c.042.199.145.382.297.525s.345.242.555.281.429.02.627-.058c.199-.078.368-.21.487-.378a1 1 0 0 0 .183-.57 1 1 0 0 0-.318-.727c-.203-.192-.48-.3-.767-.3m-3 3.714c.214 0 .424-.06.602-.173.179-.113.318-.274.4-.461a.98.98 0 0 0 .062-.593 1 1 0 0 0-.297-.526 1.1 1.1 0 0 0-.556-.281c-.21-.04-.429-.02-.627.058s-.368.21-.487.378a1 1 0 0 0-.183.57 1 1 0 0 0 .318.727c.204.192.48.3.767.3m-2.93 1.625c.214 0 .424-.06.602-.173.179-.113.318-.274.4-.461a.98.98 0 0 0 .062-.593 1 1 0 0 0-.297-.526 1.1 1.1 0 0 0-.556-.281c-.21-.04-.429-.02-.627.058s-.368.21-.487.378a1 1 0 0 0-.183.57 1 1 0 0 0 .318.727c.204.192.48.3.767.3m8.912-3.679c-.215 0-.425.06-.603.173a1.04 1.04 0 0 0-.4.461.98.98 0 0 0-.061.593c.041.2.145.382.297.526.151.143.345.241.555.28s.429.02.627-.058c.198-.077.368-.209.487-.378a.99.99 0 0 0-.135-1.296c-.203-.193-.48-.3-.767-.3m0 3.228c-.215 0-.425.06-.603.173a1.04 1.04 0 0 0-.4.46.98.98 0 0 0-.061.594c.041.199.145.382.297.525.151.144.345.242.555.281s.429.02.627-.058.368-.21.487-.378a.99.99 0 0 0-.135-1.297c-.203-.192-.48-.3-.767-.3"}));n.Z=a},52553:function(e,n,t){t.d(n,{F:function(){return p}});var o=t(26042),r=t(69396),a=t(99534),i=t(85893),l=t(87918),s=t(98456),u=t(23776),c=t(50135),d=t(67294),p=function(e){var n=e.color,t=e.variant,p=e.label,m=e.placeholder,h=e.error,v=e.helperText,f=(e.size,e.loading),x=e.onSearchChange,g=e.textFieldProps,b=void 0===g?{}:g,y=(e.disableClearable,(0,a.Z)(e,["color","variant","label","placeholder","error","helperText","size","loading","onSearchChange","textFieldProps","disableClearable"])),j=(0,d.useState)(""),Z=j[0],w=j[1];return(0,d.useEffect)(function(){if(x){var e=setTimeout(function(){x(Z)},500);return function(){return clearTimeout(e)}}},[Z,x]),(0,i.jsx)(u.Z,(0,o.Z)({getOptionLabel:function(e){return"string"==typeof e?e:(null==e?void 0:e.label)||""},isOptionEqualToValue:function(e,n){return e.value===n.value},loading:f,onInputChange:function(e,n){w(n)},renderTags:function(e,n){return e.map(function(e,t){return(0,i.jsx)(l.Z,(0,o.Z)({size:"small",label:e.label},n({index:t})))})},renderInput:function(e){return(0,i.jsx)(c.Z,(0,r.Z)((0,o.Z)({label:p,placeholder:m,color:n,variant:t,error:h,helperText:v},e,b),{InputProps:(0,r.Z)((0,o.Z)({},e.InputProps,b.InputProps||{}),{endAdornment:(0,i.jsxs)(i.Fragment,{children:[f?(0,i.jsx)(s.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))}},y))}},4791:function(e,n,t){t.d(n,{w:function(){return ev}});var o=t(85893),r=t(67294),a=t(6812),i=t(86886),l=t(51233),s=t(15861),u=t(86532),c=t(38895),d=t(22797),p=t(5616),m=t(61730),h=t(98456),v=t(11057),f=t(38736),x=t(30381),g=t.n(x),b=t(83162),y=t(12978),j=t(26042),Z=t(69396),w=t(90948),C=(0,w.ZP)("img")({width:"300px",height:"250px"}),I=function(e){var n=e.imageSrc,t=e.sx,r=e.imageSx,a=e.title,i=e.titleSx,u=e.subtitleFirstLine,c=e.subtitleFirstLineSx,d=e.subtitleSecondLine,p=e.subtitleSecondLineSx,h=e.buttonText,f=e.onAction,x=(0,m.Z)("(max-width: 400px)");return(0,o.jsxs)(l.Z,{sx:(0,Z.Z)((0,j.Z)({},void 0===t?{}:t),{width:"100%",height:"100%"}),justifyContent:"center",alignItems:"center",spacing:2,color:"#757575",children:[(0,o.jsx)(C,{src:n,sx:(0,Z.Z)((0,j.Z)({},void 0===r?{}:r),{width:x?"250px":"300px"})}),(0,o.jsx)(s.Z,{typography:"h5",sx:(0,j.Z)({},void 0===i?{}:i),children:a}),(0,o.jsxs)(l.Z,{alignItems:"center",sx:{padding:"0px 10px",textAlign:"center"},children:[(0,o.jsx)(s.Z,{sx:(0,j.Z)({},void 0===c?{}:c),children:u}),(0,o.jsx)(s.Z,{sx:(0,j.Z)({},void 0===p?{}:p),children:d})]}),h&&f&&(0,o.jsx)(v.Z,{variant:"contained",color:"secondary",onClick:f,children:h})]})},S=t(29815),_=t(11163),P=t.n(_),q=t(66242),k=t(44267);function D(){return(D=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let T=e=>r.createElement("svg",D({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 23 22",width:"1em",height:"1em"},e),r.createElement("path",{fill:"#C1C1C1",d:"M10.504.223a2.35 2.35 0 0 1 1.994 0l9.277 4.34c.36.168.59.533.59.937s-.23.769-.59.937l-9.277 4.34a2.35 2.35 0 0 1-1.994 0l-9.277-4.34a1.04 1.04 0 0 1-.59-.937c0-.4.229-.77.59-.937zm9.013 8.783 2.258 1.057c.36.168.59.533.59.937s-.23.769-.59.937l-9.277 4.34a2.35 2.35 0 0 1-1.994 0l-9.277-4.34A1.04 1.04 0 0 1 .637 11c0-.4.229-.77.59-.937l2.257-1.057 6.45 3.017a3.7 3.7 0 0 0 3.133 0zm-6.45 8.517 6.45-3.017 2.258 1.057c.36.168.59.533.59.937s-.23.769-.59.937l-9.277 4.34a2.35 2.35 0 0 1-1.994 0l-9.277-4.34a1.04 1.04 0 0 1-.59-.937c0-.4.229-.77.59-.937l2.257-1.057 6.45 3.017a3.7 3.7 0 0 0 3.133 0"}));var O=t(8842),M=t(74944),F=t(52150),A=t(31312),E=function(e){var n=e.id,t=e.number,r=e.status,a=e.description,i=e.supplierId,u=e.supplierName,c=e.onSelectJob,d=e.selected,p=e.onClose,m=(0,M.x)().hasRole,h=m("supplier"),f=m("customer"),x=m("tenant"),g=(0,F.b)(r),b=((0,S.Z)(A.iz).concat((0,S.Z)(A.yW),(0,S.Z)(A.l8)).find(function(e){return e.value===r})||{statusText:""}).text,w=function(e){e.stopPropagation(),P().push("/dashboard/issues/view?id=".concat(t)).then(function(){return p()})};return(0,o.jsxs)(l.Z,{direction:"row",width:"100%",spacing:1,onClick:function(){return c({id:n,number:t})},children:[(0,o.jsx)($,{selected:d,children:(0,o.jsxs)(k.Z,{children:[(0,o.jsxs)(l.Z,{direction:"row",alignItems:"center",columnGap:2,mb:1.5,children:[(0,o.jsx)(v.Z,{onClick:w,color:g,variant:"contained",size:"small",endIcon:(0,o.jsx)(O.Z,{}),children:t}),(0,o.jsx)(s.Z,{sx:R.status,variant:"subtitle1",children:b})]}),(0,o.jsx)(y.O,{maxLength:10,sx:R.jobTitle,children:a}),!f&&!x&&(0,o.jsxs)(l.Z,{children:[(0,o.jsx)(s.Z,{variant:"subtitle2",sx:R.assignedToLabel,children:"Assigned to:\xa0"}),(0,o.jsx)(y.O,(0,Z.Z)((0,j.Z)({maxLength:24,variant:"subtitle2"},i&&!h&&{href:"/dashboard/suppliers/view?id=".concat(i),color:"secondary",sx:{"& .MuiTypography-root":{fontSize:"12px"},"&:hover":{cursor:"pointer"}}}),{children:u||"-"}))]})]})}),d&&(0,o.jsx)(N,{}),!d&&(0,o.jsx)(W,{children:(0,o.jsx)(k.Z,{children:(0,o.jsx)(T,{className:"stacked-layers"})})})]})},R={jobTitle:{color:"#5C5C5C",fontSize:"14px",marginBottom:"12px"},status:{fontWeight:"600",textTransform:"capitalize"},link:{textDecoration:"none"},assignedToLabel:{fontWeight:"300",whiteSpace:"nowrap"}},$=(0,w.ZP)(q.Z)(function(e){var n=e.selected;return(0,j.Z)({position:"relative",width:"calc(100% - 60px)",display:"flex",flexDirection:"column",justifyContent:"center",height:"140px",backgroundColor:"#F9F9F9"},!n&&{boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-10px)",boxShadow:"0 8px 16px rgba(0, 0, 0, 0.2)"}},n&&{width:"100%",border:"1px solid #50AEFC"})}),N=(0,w.ZP)("div")({position:"relative",width:"12px",marginLeft:"0px !important","&:after":{content:'""',position:"absolute",bottom:"50%",left:"-6px",width:0,height:0,borderLeft:"12px solid transparent",borderRight:"0px solid transparent",borderBottom:"12px solid #50AEFC",transform:"rotate(-45deg)"}}),W=(0,w.ZP)(q.Z)(function(){return{width:"60px",display:"flex",justifyContent:"center",alignItems:"center",height:"140px",backgroundColor:"#F9F9F9",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",transition:"transform 0.3s ease, box-shadow 0.3s ease","&:hover":{transform:"translateY(-10px)",boxShadow:"0 8px 16px rgba(0, 0, 0, 0.2)"},"& .MuiCardContent-root":{padding:"0px",display:"flex",justifyContent:"center",alignItems:"center"},"& .stacked-layers":{fontSize:"24px"}}}),L=t(59505),J=t(70519),Y=t(38944),B=t(53600),H=t(52324),V=t(96715),G=t(50108),Q=t(4438),z=function(e){var n,t=e.timings,o=(void 0===t?[]:t).find(function(e){return"reportSentSupplier"===e.status});return o&&"Report Sent by ".concat((null==o?void 0:null===(n=o.user)||void 0===n?void 0:n.fullName)||"")},U=function(e){var n,t=e.timings,o=void 0===t?[]:t,r=null==o?void 0:o.find(function(e){return"invoiceSent"===e.status});return r&&"Invoice sent by ".concat((null==r?void 0:null===(n=r.user)||void 0===n?void 0:n.fullName)||"")},K=function(e){var n,t,o,r,a=e.supplier,i=e.supplierUser,l=e.customerVatTotal,s=e.timings,u=void 0===s?[]:s,c=e.timingStatus,d=e.correctStart,p=e.correctEnd,m=e.scheduledAt,h=e.arrivalAnytime,v=e.compliance,f=e.supplierOffers,x=void 0===f?[]:f,b=e.invoices,y=e.user,j=(0,M.x)().hasRole,Z=j("customer"),w=j("tenant"),C=j("supplier"),I=null==y?void 0:y.invoiceThreshold,S="onHold"===(0,Y.L)(u),_=(0,B.E)({timings:u},"accepted"),P=(0,B.E)({timings:u},"closed"),q="incorrect"===c?p:(0,B.E)({timings:u},"completed"),k=(0,B.E)({timings:u},"complianceRejected"),D=(0,B.E)({timings:u},"complianceApproved"),T=(0,B.E)({timings:u},"complianceRequestedDocumentation"),O=(0,B.E)({timings:u},"customerPaid"),F=!!v,A="incorrect"===c?d:(0,B.E)({timings:u},"inProgress"),E=(0,B.E)({timings:u},"invoiceSent"),R=(0,B.E)({timings:u},"offered"),$=(0,B.E)({timings:u},"pricingChanged"),N=(0,B.E)({timings:u},"quoteAccepted"),W=(0,B.E)({timings:u},"rejected"),L=(0,B.E)({timings:u},"reportSent"),J=(0,B.E)({timings:u},"reportSentSupplier"),K=(0,B.E)({timings:u},"supplierPaid"),X=(0,B.E)({timings:u},"timingChanged"),ee=(0,B.E)({timings:u},"validated"),en=(0,B.E)({timings:u},"updateAcceptOfferInput"),et=(0,B.E)({timings:u},"supplierCancel"),eo=(0,B.E)({timings:u},"expensesPendingAmount"),er=(0,B.E)({timings:u},"expensesPendingAmountResolved"),ea=m?h?"".concat(g()(m).format("D MMM YYYY")," (anytime)"):g()(m).format("D MMM YYYY HH:mm"):g()(N||_).format("D MMM YYYY HH:mm"),ei=x.filter(function(e){return"cancelled"!==e.status}).length,el=(0,H.Xd)("adminInvoice",u),es=(0,H.nN)(["adminUplift","adminInvoice"],u),eu=(0,H.OQ)("adminInvoice",u),ec=null==b?void 0:b.filter(function(e){return Q.SR.customer.includes(e.invoiceType)}),ed=null==b?void 0:b.filter(function(e){return Q.SR.supplier.includes(e.invoiceType)}),ep=(null==ec?void 0:ec.reduce(function(e,n){var t,o,r,a;return e+((null==n?void 0:null===(t=n.reconciledAmount)||void 0===t?void 0:null===(o=t.reconciliations)||void 0===o?void 0:null===(r=o.aggregate)||void 0===r?void 0:null===(a=r.sum)||void 0===a?void 0:a.amount)||0)},0))||null,em=(null==ed?void 0:ed.reduce(function(e,n){var t,o,r,a;return e+((null==n?void 0:null===(t=n.reconciledAmount)||void 0===t?void 0:null===(o=t.reconciliations)||void 0===o?void 0:null===(r=o.aggregate)||void 0===r?void 0:null===(a=r.sum)||void 0===a?void 0:a.amount)||0)},0))||null,eh=(null==ec?void 0:ec.reduce(function(e,n){var t;return e+((null==n?void 0:null===(t=n.amounts)||void 0===t?void 0:t.vatTotal)||0)},0))||null,ev=(null==ed?void 0:ed.reduce(function(e,n){var t;return e+((null==n?void 0:null===(t=n.amounts)||void 0===t?void 0:t.vatTotal)||0)},0))||null;return[{id:1,label:"Job raised",date:(0,B.E)({timings:u},["raised","quoteNew"]),content:[{id:1,active:!0,data:"Created By ".concat((null===(n=u[0])||void 0===n?void 0:null===(t=n.user)||void 0===t?void 0:t.fullName)||"")}]},{id:2,label:"Job offered",info:"no assigned suppliers",date:R,content:[{id:1,active:!S&&R&&!A&&!_&&!X&&!$&&x&&x.length>0,data:"Offered to ".concat(ei," suppliers")},{id:2,active:!S&&W,data:"Job rejected by supplier"}]},{id:3,label:"Accepted",info:"waiting for supplier to accept",date:(0,B.E)({timings:u},"accepted"),content:[{id:1,active:(_||N||X||$)&&a&&!Z&&!w,data:"Assigned to ".concat(null==a?void 0:a.name)},{id:2,active:(_||N)&&i&&!Z&&!w,data:"Operative: ".concat(null==i?void 0:i.fullName)},{id:3,active:_||N,data:"Arrival time: ".concat(ea)},{id:4,active:X&&!_&&a,data:"Job timing has changed, supplier needs to Accept the job again and set new\n          attendance time"},{id:5,active:$&&!_&&a,data:"Job service or pricing has changed, supplier needs to Accept the job again and\n          confirm attendance and operative"},{id:6,active:en,data:"Attendance and operative has changed by ".concat((0,V.j$)({timings:u},"updateAcceptOfferInput"))},{id:7,active:et,data:"Job canceled by ".concat((0,V.j$)({timings:u},"supplierCancel"))},{id:8,active:!0}]},{id:4,label:"In progress",info:"waiting for supplier to start",date:A},{id:7,label:"Complete",info:"waiting for supplier to complete",date:q},{id:8,label:"Report sent",info:"after job complete",date:L,content:[{id:1,active:J,data:"Report submitted by supplier"},{id:2,active:!0,data:z({timings:u})}]},{id:9,label:"Customer Sign Off",info:"",date:F&&(D||k),active:F,content:[{id:1,active:D,data:"Compliance sing off by ".concat((0,V.j$)({timings:u},"complianceApproved"))},{id:2,active:k,data:"Compliance rejected by ".concat((0,V.j$)({timings:u},"complianceRejected"))},{id:3,active:!S&&F&&T&&!(D||k)}]},{id:10,label:"Threshold approval",info:"",date:(null==es?void 0:es.createdAt)||(null==eu?void 0:eu.createdAt),active:!!(el||es||eu),content:[{id:1,active:el&&!es&&!eu,data:"Awaiting threshold approval"},{id:2,active:es,data:"Threshold approved by ".concat(null==es?void 0:null===(o=es.user)||void 0===o?void 0:o.fullName)},{id:3,active:eu,data:"Threshold rejected by ".concat(null==eu?void 0:null===(r=eu.user)||void 0===r?void 0:r.fullName)},{id:4,active:!S&&el&&(0,V.il)(I,l||0)}]},{id:11,label:"Awaiting expenses pricing",info:"",date:er,active:!!(eo||er)},{id:12,label:"Invoices sent",info:"after validation",date:E,content:[{id:1,active:ee,data:"Job validated"},{id:2,active:!0,data:U({timings:u})}]},{id:13,label:"Customer ".concat(O?"paid":ep>0?"partially paid":"not paid"),date:O,active:!C,content:[{id:1,active:!O&&ep,data:"Reconciled amount ".concat((0,G.T)(ep))},{id:2,active:!O&&ep,data:"Amount outstanding ".concat((0,G.T)(eh))}]},{id:14,label:"Supplier ".concat(K?"paid":em>0?"partially paid":"not paid"),date:K,active:!Z&&!w,content:[{id:1,active:!K&&em,data:"Reconciled amount ".concat((0,G.T)(em))},{id:2,active:!K&&em,data:"Amount outstanding ".concat((0,G.T)(ev))}]},{id:15,label:"Closed",info:"automatically after steps complete",date:P}]},X=t(7297),ee=t(75063);function en(){var e=(0,X.Z)(['\n  query WorkOrdersListWithCompliance($complianceId: Int!, $supplierId: Int, $status: [String]) {\n    jobs: Job(\n      where: {\n        Compliance: {}\n        status: { _in: $status, _neq: "canceled" }\n        _or: [\n          { supplierId: { _eq: $supplierId } }\n          { SupplierOffers: { accountId: { _eq: $supplierId } }, status: { _eq: "offered" } }\n        ]\n      }\n      order_by: { id: asc }\n    ) {\n      id\n      number\n      status\n      description\n      supplier: Supplier {\n        id\n        name\n      }\n    }\n  }\n']);return en=function(){return e},e}function et(){var e=(0,X.Z)(['\n  query WorkOrdersListWithSchedule(\n    $jobScheduleId: Int!\n    $supplierId: Int\n    $status: [String]\n    $startDate: timestamptz\n    $endDate: timestamptz\n  ) {\n    jobs: Job(\n      where: {\n        jobScheduleId: { _eq: $jobScheduleId }\n        status: { _in: $status, _neq: "canceled" }\n        timingStart: { _gte: $startDate, _lte: $endDate }\n        _or: [\n          { supplierId: { _eq: $supplierId } }\n          { SupplierOffers: { accountId: { _eq: $supplierId } }, status: { _eq: "offered" } }\n        ]\n      }\n      order_by: { id: asc }\n    ) {\n      id\n      number\n      status\n      description\n      supplier: Supplier {\n        id\n        name\n      }\n    }\n  }\n']);return et=function(){return e},e}function eo(){var e=(0,X.Z)(['\n  query GetJobFromWorkOrdersListWithStepper($jobId: Int!) {\n    job: Job_by_pk(id: $jobId) {\n      id\n      status\n      type\n      description\n      timingStatus\n      correctStart\n      correctEnd\n      timingStart\n      timingEnd\n      scheduledAt\n      number\n      customerVatTotal: customerFinances(path: "amountInfo.vatTotal")\n      arrivalAnytime: meta(path: "arrivalAnytime")\n      supplier: Supplier {\n        id\n        name\n      }\n      supplierUser: SupplierUser {\n        id\n        fullName\n      }\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n        invoiceType\n        createdAt\n        amounts\n        accountEntry: AccountEntry {\n          id\n          meta\n        }\n        reconciledAmount: AccountEntry {\n          reconciliations: InvoiceReconciliations_aggregate {\n            aggregate {\n              sum {\n                amount\n              }\n            }\n          }\n        }\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n      }\n      compliance: Compliance {\n        id\n      }\n      timings: JobTimings(order_by: { id: desc }) {\n        id\n        status\n        notes\n        meta\n        quoteId\n        createdAt\n        user: User {\n          id\n          fullName\n        }\n      }\n    }\n  }\n']);return eo=function(){return e},e}var er=(0,ee.Ps)(en()),ea=(0,ee.Ps)(et()),ei=(0,ee.Ps)(eo()),el=t(828),es=t(52553),eu=t(56154),ec=t(73359),ed=t(57493),ep=function(e){var n=e.hideFilters,t=void 0===n?{}:n,a=e.defaultFilters,i=void 0===a?{}:a,s=e.filters,u=e.setFilters,c=(0,m.Z)("(max-width: 600px)"),d=(0,r.useState)(""),p=d[0],h=d[1],v=(0,el.Z)((0,ec.t)(ed.by,{variables:{where:{name:{_ilike:""!==p?"%".concat(p,"%"):null},type:{_eq:"supplier"}}}}),2),f=v[0],x=v[1],g=x.loading,b=x.data,y=(void 0===b?{items:[]}:b).items,w=(0,r.useCallback)(function(e){return null==e?void 0:e.reduce(function(e,n){var t=eu.j.find(function(e){return e.value===n});return t?(0,S.Z)(e).concat([{value:t.value,label:t.label}]):e},[])},[]);return(0,o.jsxs)(l.Z,{direction:"row",spacing:1,children:[!t.status&&(0,o.jsx)(es.F,{multiple:!0,limitTags:1,variant:"standard",color:"secondary",label:"Select status",value:w(s.status)||[],sx:em.selector(c),onChange:function(e,n){n.length?u(function(e){return(0,Z.Z)((0,j.Z)({},e),{status:(0,S.Z)(n.map(function(e){return e.value}))})}):u(function(e){return(0,Z.Z)((0,j.Z)({},e),{status:i.status})})},options:eu.j}),!t.supplier&&(0,o.jsx)(es.F,{variant:"standard",color:"secondary",label:"Select supplier",value:s.supplier,sx:em.selector(c),onSearchChange:h,onChange:function(e,n){(null==n?void 0:n.value)&&(null==n?void 0:n.label)?u(function(e){return(0,Z.Z)((0,j.Z)({},e),{supplier:n})}):u(function(e){return(0,Z.Z)((0,j.Z)({},e),{supplier:i.supplier})})},loading:g,onOpen:function(){return f()},options:y})]})},em={selector:function(e){return{width:e?"100%":"300px"}}},eh=function(e){var n,t,o,r,a=e.type,i=e.jobScheduleId,l=e.complianceId,s=e.startDate,u=e.endDate,c=e.filters;switch(a){case"Compliance":return{query:er,variables:{complianceId:l,supplierId:null===(n=c.supplier)||void 0===n?void 0:n.value,status:(null===(t=c.status)||void 0===t?void 0:t.includes("all"))?null:c.status}};case"JobSchedule":return{query:ea,variables:{jobScheduleId:i,supplierId:null===(o=c.supplier)||void 0===o?void 0:o.value,status:(null===(r=c.status)||void 0===r?void 0:r.includes("all"))?null:c.status,startDate:s,endDate:u}}}},ev=function(e){var n,t,x,j=e.type,Z=e.jobScheduleId,w=e.complianceId,C=e.defaultFilters,S=void 0===C?{}:C,_=e.startDate,P=e.endDate,q=e.onClose,k=e.hideFilters,D=(0,M.x)().hasRole,T=D("supplier"),O=D("customer"),A=D("tenant"),R=(0,r.useState)(null),$=R[0],N=R[1],W=(0,r.useState)(S),Y=W[0],B=W[1],H=(0,m.Z)("(max-width: 600px)"),V=(0,M.x)().user,G=eh({type:j,jobScheduleId:Z,complianceId:w,startDate:_,endDate:P,filters:Y}),Q=G.query,z=G.variables,U=(0,a.a)(Q,{variables:z}),X=U.data,ee=(void 0===X?{jobs:[]}:X).jobs,en=U.loading,et=(0,a.a)(ei,{skip:!$,variables:{jobId:null==$?void 0:$.id}}),eo=et.data,er=(void 0===eo?{job:{}}:eo).job,ea=et.loading,el=ee.length;return en?(0,o.jsx)(l.Z,{height:"100%",justifyContent:"center",alignItems:"center",children:(0,o.jsx)(h.Z,{color:"secondary"})}):(0,o.jsxs)(l.Z,{children:[(0,o.jsxs)(l.Z,{direction:H?"column":"row",alignItems:H?"space-between":"flex-end",spacing:1,children:[(0,o.jsx)(ep,{hideFilters:k,defaultFilters:S,filters:Y,setFilters:B}),(0,o.jsxs)(s.Z,{typography:"subtitle2",sx:ef.jobCountLabel,mt:H?2:0,children:["Item has ",el," scheduled jobs"]})]}),(null==ee?void 0:ee.length)?(0,o.jsxs)(i.ZP,{container:!0,mt:3,children:[(0,o.jsx)(i.ZP,{item:!0,xs:12,md:5,lg:5,sx:{height:H?"auto":"750px",padding:"15px 10px",overflow:"scroll"},children:(0,o.jsx)(l.Z,{rowGap:2,children:null==ee?void 0:ee.map(function(e){var n,t;return(0,o.jsx)(E,{id:e.id,number:e.number,status:e.status,description:e.description,supplierId:null===(n=e.supplier)||void 0===n?void 0:n.id,supplierName:null===(t=e.supplier)||void 0===t?void 0:t.name,onSelectJob:N,selected:(null==$?void 0:$.id)===e.id,onClose:q})})})}),(0,o.jsx)(i.ZP,{item:!0,xs:12,md:6,lg:6,ml:3,children:$&&!ea&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(l.Z,{sx:ef.wrapper,spacing:1,children:[(0,o.jsx)(b.r,{href:"/dashboard/issues/view?id=".concat(null==$?void 0:$.number),children:(0,o.jsx)(v.Z,{color:(0,F.b)(er.status),variant:"contained",size:"small",endIcon:(0,o.jsx)(f.Z,{}),children:er.number})}),(0,o.jsxs)(l.Z,{children:[(0,o.jsx)(s.Z,{typography:"subtitle2",sx:ef.subtitle,children:"Description"}),(0,o.jsx)(y.O,{maxLength:40,sx:{wordBreak:"break-all"},children:er.description})]}),!O&&!A&&(0,o.jsxs)(l.Z,{children:[(0,o.jsx)(s.Z,{typography:"subtitle2",sx:ef.subtitle,children:"Supplier"}),(0,o.jsx)(s.Z,{typography:"subtitle2",children:(0,o.jsx)(b.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(null===(n=er.supplier)||void 0===n?void 0:n.id),noWrap:!(null===(t=er.supplier)||void 0===t?void 0:t.id)||T,sx:{fontSize:"12px"},children:(null===(x=er.supplier)||void 0===x?void 0:x.name)||"-"})})]}),(0,o.jsxs)(l.Z,{children:[(0,o.jsx)(s.Z,{typography:"subtitle2",sx:ef.subtitle,children:"Scheduled start"}),(0,o.jsx)(s.Z,{typography:"subtitle2",children:er.timingStart?g()(er.timingStart).format("D MMM YYYY HH:mm"):"-"})]}),(0,o.jsxs)(l.Z,{children:[(0,o.jsx)(s.Z,{typography:"subtitle2",sx:ef.subtitle,children:"Scheduled End"}),(0,o.jsx)(s.Z,{typography:"subtitle2",children:er.timingEnd?g()(er.timingEnd).format("D MMM YYYY HH:mm"):"-"})]}),(0,o.jsxs)(l.Z,{children:[(0,o.jsx)(s.Z,{typography:"subtitle2",sx:ef.subtitle,children:"Supplier arrival"}),(0,o.jsx)(s.Z,{typography:"subtitle2",children:er.scheduledAt?"".concat(g()(er.scheduledAt).format("D MMM YYYY")," ").concat(er.arrivalAnytime?"(anytime)":""):"-"})]})]}),(0,o.jsxs)(u.Z,{sx:ef.accordion,expanded:!0,children:[(0,o.jsx)(c.Z,{children:(0,o.jsxs)(l.Z,{direction:"row",spacing:3,children:[(0,o.jsx)(s.Z,{variant:"h6",children:"Workflow"}),(0,o.jsx)(L.B,{value:er.status})]})}),(0,o.jsx)(d.Z,{children:(0,o.jsx)(J.v,{steps:K({supplier:er.supplier,supplierUser:er.supplierUser,customerVatTotal:er.customerVatTotal,timings:er.timings,timingStatus:er.timingStatus,correctStart:er.correctStart,correctEnd:er.correctEnd,scheduledAt:er.scheduledAt,arrivalAnytime:er.arrivalAnytime,compliance:er.compliance,supplierOffers:er.supplierOffers,invoices:er.invoices,user:V})})})]})]})})]}):(0,o.jsx)(p.Z,{sx:{height:"calc(100vh - 180px)",display:"flex",alignItems:"center",justifyContent:"center"},children:(0,o.jsx)(I,{imageSrc:"/static/icons/no_locations_found.svg",title:"No ppm jobs found",subtitleFirstLine:"Jobs for applied filters was not found or wasn`t created",subtitleSecondLine:"Please click Create jobs on PPM item or amend filters"})})]})},ef={wrapper:{marginBottom:"10px"},subtitle:{fontWeight:"300"},title:{fontWeight:"500"},jobCountLabel:{fontWeight:"300"},accordion:{borderTop:"0px",boxShadow:"none"}}},182:function(e,n,t){t.d(n,{OZ:function(){return c},UH:function(){return m},UM:function(){return p},r6:function(){return h},zR:function(){return d}});var o=t(7297),r=t(75063);function a(){var e=(0,o.Z)(['\n  query GetComplianceCategoriesForSelect($q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: {\n        type: { _eq: "complianceCategory" }\n        status: { _eq: "active" }\n        name: { _ilike: $q }\n      }\n      order_by: { name: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      label: name\n      value: id\n    }\n  }\n']);return a=function(){return e},e}function i(){var e=(0,o.Z)(["\n  query GetSublocationsForSelect($locationId: Int, $q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Sublocation(\n      where: { name: { _ilike: $q }, locationId: { _eq: $locationId }, active: { _eq: true } }\n      limit: $limit\n      offset: $offset\n      order_by: { createdAt: desc }\n    ) {\n      value: id\n      label: name\n    }\n  }\n"]);return i=function(){return e},e}function l(){var e=(0,o.Z)(['\n  query GetAssetsCategoryForSelect($q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Taxonomy(\n      where: {\n        type: { _eq: "assetCategory" }\n        isGroup: { _eq: false }\n        status: { _eq: "active" }\n        name: { _ilike: $q }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n']);return l=function(){return e},e}function s(){var e=(0,o.Z)(["\n  query GetAssetsForSelect(\n    $locationId: Int\n    $sublocationId: Int\n    $categoryId: Int\n    $q: String\n    $limit: Int = 50\n    $offset: Int = 0\n  ) {\n    items: Asset(\n      where: {\n        categoryId: { _eq: $categoryId }\n        locationId: { _eq: $locationId }\n        sublocationId: { _eq: $sublocationId }\n        name: { _ilike: $q }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: { name: asc }\n    ) {\n      label: name\n      value: id\n    }\n  }\n"]);return s=function(){return e},e}function u(){var e=(0,o.Z)(["\n  query GetAdminCompliancesForSelect($q: String, $limit: Int = 50, $offset: Int = 0) {\n    items: Compliance(\n      where: { name: { _ilike: $q }, locationId: { _is_null: true } }\n      order_by: { name: asc }\n      limit: $limit\n      offset: $offset\n    ) {\n      value: id\n      label: name\n      category: ComplianceCategory {\n        value: id\n        label: name\n      }\n    }\n  }\n"]);return u=function(){return e},e}var c=(0,r.Ps)(a()),d=(0,r.Ps)(i()),p=(0,r.Ps)(l()),m=(0,r.Ps)(s()),h=(0,r.Ps)(u())},38944:function(e,n,t){t.d(n,{L:function(){return o}});var o=function(e){for(var n="",t=e.slice().sort(function(e,n){return Number(e.id)-Number(n.id)}),o=t.length-1;o>=0;o--){var r=t[o].status;if("onHold"===r||"resumed"===r||"paused"===r||"continued"===r){n=t[o].status;break}}return n}},53600:function(e,n,t){t.d(n,{E:function(){return o}});var o=function(e,n){if(Array.isArray(n)){var t,o=null;return n.forEach(function(n){var t,r=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});o=(null==r?void 0:r.createdAt)||o}),o}var r=null==e?void 0:null===(t=e.timings)||void 0===t?void 0:t.find(function(e){return e.status===n});return(null==r?void 0:r.createdAt)||null}},52324:function(e,n,t){t.d(n,{OQ:function(){return s},Pn:function(){return r},TT:function(){return a},Xd:function(){return i},aH:function(){return o},nN:function(){return l}});var o=function(e,n,t){var o,r=null===(o=null==n?void 0:n.slice())||void 0===o?void 0:o.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdApproval")&&t===n.quoteId})},r=function(e,n,t){var o,r=null===(o=null==n?void 0:n.slice())||void 0===o?void 0:o.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdApproved")&&t===n.quoteId})},a=function(e,n,t){var o,r=null===(o=null==n?void 0:n.slice())||void 0===o?void 0:o.sort(function(e,n){return n.id-e.id});return null==r?void 0:r.find(function(n){return n.status==="".concat(e,"QuoteThresholdRejected")&&t===n.quoteId})},i=function(e,n){var t,o=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});return null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdApproval")})},l=function(e,n){var t,o=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});if(Array.isArray(e)){var r=null;return e.forEach(function(e){r=(null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdApproved")}))||r}),r}return null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdApproved")})},s=function(e,n){var t,o=null===(t=null==n?void 0:n.slice())||void 0===t?void 0:t.sort(function(e,n){return n.id-e.id});return null==o?void 0:o.find(function(n){return n.status==="".concat(e,"ThresholdRejected")})}},76011:function(e,n,t){t.d(n,{f:function(){return P}});var o=t(26042),r=t(69396),a=t(29815),i=t(85893),l=t(67294),s=t(15861),u=t(93946),c=t(51233),d=t(21023),p=t(96540),m=t(45697),h=t.n(m),v=t(79665),f=t(50135),x=t(11057),g=t(90948),b=t(42283),y=t(41733),j=t(83372),Z=t(16310),w=Z.Ry().shape({caption:Z.Z_()}),C=x.Z,I=(0,g.ZP)(s.Z)({backgroundColor:j.Q.COLOUR.secondary,color:j.Q.COLOUR.white,textAlign:"center",minWidth:"64px",borderRadius:"4px",margin:"10px 0",padding:"4px 10px",boxShadow:"0px 3px 1px -2px rgba(0,0,0,0.2),\n    0px 2px 2px 0px rgba(0,0,0,0.14),\n    0px 1px 5px 0px rgba(0,0,0,0.12)"}),S=(0,g.ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),_=function(e){var n,t=e.noDelete,a=e.onDelete,p=e.isAdded,m=e.media,h=e.caption,x=e.onSave,g=(0,l.useState)(null),Z=g[0],_=g[1],P=(0,l.useState)(""),q=P[0],k=P[1],D=(0,l.useState)(p),T=D[0],O=D[1],M=(0,b.cI)({resolver:(0,v.S)(w)}),F=M.register,A=M.errors,E=M.handleSubmit,R=M.reset,$=function(e){e.stopPropagation(),_(null),R()},N=function(e){e.stopPropagation(),O(!1),a()},W=function(e){Z&&(x((0,r.Z)((0,o.Z)({},e),{media:Z,type:q})),O(!1))},L=(0,l.useCallback)(function(e){return function(n){n.stopPropagation();var t=n.target.files[0];k(e),_(t)}},[_]);return(0,i.jsx)("form",{children:T?(0,i.jsx)(c.Z,{children:(0,i.jsxs)(c.Z,{rowGap:2,children:[(0,i.jsx)(f.Z,{fullWidth:!0,label:"Caption",variant:"standard",color:"secondary",name:"caption",inputRef:F,error:A.name,helperText:null===(n=A.name)||void 0===n?void 0:n.message}),Z?(0,i.jsxs)(c.Z,{rowGap:3,children:[(0,i.jsxs)(c.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,i.jsx)(s.Z,{sx:{color:j.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:Z.name}),(0,i.jsx)(d.Z,{title:"Delete",placement:"top-start",children:(0,i.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:$,children:(0,i.jsx)(y.Z,{})})})]}),(0,i.jsxs)(c.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,i.jsx)(C,{variant:"contained",color:"danger",size:"small",onClick:N,children:"Cancel"}),(0,i.jsx)(C,{variant:"contained",size:"small",onClick:E(W),children:"Save"})]})]}):(0,i.jsxs)(c.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,i.jsxs)(I,{component:"label",children:["Add image\xa0",(0,i.jsx)(S,{onChange:L("image"),type:"file",accept:"image/*, .heic"})]}),(0,i.jsxs)(I,{component:"label",children:["Add document\xa0",(0,i.jsx)(S,{onChange:L("document"),type:"file",accept:".pdf, .doc, .docx, .xlsx",multiple:!0})]})]})]})}):(0,i.jsxs)(c.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:1,children:[(0,i.jsx)(s.Z,{sx:{color:j.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:h||(null==m?void 0:m.name)||"No caption"}),!t&&(0,i.jsx)(d.Z,{title:"Delete",placement:"top-start",children:(0,i.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:a,children:(0,i.jsx)(y.Z,{sx:{fontSize:"16px"}})})})]})})};_.propTypes={noDelete:h().func,onDelete:h().func,isAdded:h().bool,media:h().object,onSave:h().func};var P=function(e){var n=e.values,t=e.setValue,m=e.name,h=void 0===m?"attachments":m,v=e.title,f=void 0===v?"Attachments":v,x=e.titleSx,g=e.onDeleteExistingMedia,b=(0,l.useState)([]),y=b[0],j=b[1];(0,l.useEffect)(function(){Array.isArray(n)&&j(n)},[n]);var Z=function(e){e.stopPropagation(),j(function(e){return(0,a.Z)(e).concat([{mediaId:null,caption:"",media:null,type:"",isAdded:!0}])})},w=function(e,n){var o=(0,a.Z)(y);o.splice(e,1,n),t(h,o)};return(0,i.jsxs)(c.Z,{children:[(0,i.jsxs)(c.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,i.jsx)(s.Z,{sx:void 0===x?{}:x,children:f?f+":":""}),(0,i.jsx)(d.Z,{title:"Add new attachment",placement:"top-start",children:(0,i.jsx)(u.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:Z,children:(0,i.jsx)(p.Z,{})})})]}),(0,i.jsx)(c.Z,{pl:2,spacing:.8,children:(null==y?void 0:y.length)?y.map(function(e,n){var a;return(0,i.jsx)(_,(0,r.Z)((0,o.Z)({},e),{onDelete:function(){g&&(null===(e=y[n])||void 0===e?void 0:e.mediaId)&&g(y[n].mediaId);var e,o=y.filter(function(e,t){return t!==n});t(h,o),j(o)},onSave:function(e){return w(n,e)}}),e.caption+n)}):(0,i.jsx)(s.Z,{typography:"subtitle2",children:"No data"})})]})}},34187:function(e,n,t){t.d(n,{C:function(){return m}});var o=t(26042),r=t(69396),a=t(85893);t(67294);var i=t(45697),l=t(90948),s=t(15861),u=t(51233),c=t(11057),d=t(61730),p=(0,l.ZP)("img")({width:"300px",height:"250px"}),m=function(e){var n=e.imageSrc,t=e.sx,i=e.imageSx,l=e.title,m=e.titleSx,h=e.subtitleFirstLine,v=e.subtitleFirstLineSx,f=e.subtitleSecondLine,x=e.subtitleSecondLineSx,g=e.buttonText,b=e.onAction,y=(0,d.Z)("(max-width: 400px)");return(0,a.jsxs)(u.Z,{sx:(0,r.Z)((0,o.Z)({},t),{width:"100%",height:"100%"}),justifyContent:"center",alignItems:"center",spacing:2,color:"#757575",children:[(0,a.jsx)(p,{src:n,sx:(0,r.Z)((0,o.Z)({},i),{width:y?"250px":"300px"})}),(0,a.jsx)(s.Z,{typography:"h5",sx:(0,o.Z)({},m),children:l}),(0,a.jsxs)(u.Z,{alignItems:"center",sx:{padding:"0px 10px",textAlign:"center"},children:[(0,a.jsx)(s.Z,{sx:(0,o.Z)({},v),children:h}),(0,a.jsx)(s.Z,{sx:(0,o.Z)({},x),children:f})]}),g&&b&&(0,a.jsx)(c.Z,{variant:"contained",color:"secondary",onClick:b,children:g})]})};m.propTypes={imageSrc:i.string,title:i.string,subtitleFirstLine:i.string,subtitleSecondLine:i.string,onAction:i.func,sx:i.object,imageSx:i.object,titleSx:i.object,subtitleFirstLineSx:i.object,subtitleSecondLineSx:i.object},m.defaultProps={title:"",subtitleFirstLine:"",subtitleSecondLine:"",sx:{},imageSx:{},titleSx:{},subtitleFirstLineSx:{},subtitleSecondLineSx:{},onAction:null}},37673:function(e,n,t){t.d(n,{g:function(){return w}});var o=t(26042),r=t(828),a=t(29815),i=t(85893),l=t(67294),s=t(11057),u=t(67720),c=t(11994),d=t(90629),p=t(51233),m=t(15861),h=t(61730),v=t(1691),f=t(45697),x=t.n(f),g=t(45307),b=t(42283),y=t(10166),j=t(18531),Z=s.Z,w=function(e){var n=e.mainKey,t=e.open,s=e.close,d=e.columns,f=e.setColumns,x=e.submitBtnText,y=e.subtitle,w=e.onCompleted,I=(0,h.Z)("(max-width: 600px)"),S=(0,l.useState)(null),_=S[0],P=S[1],q=(0,l.useMemo)(function(){return d.filter(function(e){return e.defaultSelected})},[d]),k=(0,r.Z)((0,g.X)("".concat(void 0===n?"scheduled_job_table_jobs_column_selector":n),{columns:q},"sessionStorage"),2),D=k[0],T=k[1],O=(0,b.cI)({defaultValues:{columns:q}}),M=O.control,F=O.handleSubmit,A=O.reset;(0,l.useEffect)(function(){var e=(null==D?void 0:D.columns)||q||[];A({columns:e}),f((0,a.Z)(e))},[D,A,f,q]);var E=function(e){if(!e.columns.length){P("Please select at least one column");return}try{w(e),T(function(n){return(0,o.Z)({},n,e)})}finally{s(),P(null)}},R=function(){T({columns:q}),P(null),s()};return t&&(0,i.jsx)(c.Z,{open:t,onClose:s,children:(0,i.jsx)("form",{onSubmit:F(E),children:(0,i.jsxs)(C,{is600pxOrLess:I,children:[(0,i.jsxs)(p.Z,{spacing:2,children:[(0,i.jsx)(m.Z,{variant:"h6",children:"Column Selection"}),(0,i.jsx)(m.Z,{variant:"body2",color:"muiGray.main",children:y}),(0,i.jsx)(u.Z,{}),(0,i.jsx)(b.Qr,{control:M,name:"columns",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(j.q,{multiple:!0,value:n,onChange:function(e,n){return t(n)},options:d,textFieldProps:{fullWidth:!0,label:"Columns",color:"secondary"}})}})]}),_&&(0,i.jsx)(v.Z,{sx:{margin:"10px 0"},severity:"error",children:_}),(0,i.jsxs)(p.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,i.jsx)(Z,{variant:"contained",color:"danger",onClick:function(){return R()},children:"Cancel"}),(0,i.jsx)(Z,{variant:"contained",color:"secondary",type:"submit",children:x})]})]})})})};w.defaultProps={open:!1,close:function(){},columns:[],setColumns:function(){},onCompleted:function(){},submitBtnText:"Apply",subtitle:"Select the columns you would like to see in the table."},w.propTypes={open:x().bool,close:x().func,columns:x().array,setColumns:x().func,submitBtnText:x().string,subtitle:x().string,onCompleted:x().func};var C=(0,y.Z)(d.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:"8px",overflowY:"auto"}})},71799:function(e,n,t){t.d(n,{V:function(){return s}});var o=t(85893),r=t(45697),a=t.n(r),i=t(87918),l=t(51233),s=function(e){var n=e.filtersChips,t=e.onRemove;return(0,o.jsx)(l.Z,{direction:"row",sx:{overflowX:"auto"},alignItems:"center",spacing:1,children:n.map(function(e){return(0,o.jsx)(i.Z,{label:e.label,onDelete:function(){return t(e.key)}},e.key)})})};s.propTypes={filtersChips:a().array,onRemove:a().func},s.defaultProps={filters:[],onRemove:function(){}}},57682:function(e,n,t){t.d(n,{H:function(){return i}});var o=t(26042),r=t(69396),a=t(5616),i=(0,t(90948).ZP)(a.Z)(function(e){var n=e.theme,t=e.backgroundColor,a=e.height;return(0,r.Z)((0,o.Z)({position:"absolute",left:-10,top:"calc(50% - ".concat(a/2,"px)"),backgroundColor:n.palette[t].main,width:"5px",height:"".concat(a,"px")},"white"===t&&{border:"1px solid black"}),{borderTopRightRadius:"".concat(a,"px"),borderBottomRightRadius:"".concat(a,"px")})})},31220:function(e,n,t){t.d(n,{c:function(){return y}});var o=t(14924),r=t(26042),a=t(69396),i=t(828),l=t(29815),s=t(85893),u=t(87109),c=t(21023),d=t(39522),p=t(40876),m=t(67294),h=t(18531),v=t(73359),f=t(57493),x=t(11163),g=t.n(x),b=d.Z,y=function(e){var n=e.withoutRightBorderRadius,t=e.fullWidth,o=e.locationId,r=e.locationName,a=e.disabled,d=(0,m.useState)(""),x=d[0],y=d[1],Z=(0,m.useState)(o?{label:r,value:o}:{label:"All locations",value:"all"})[0],w=(0,i.Z)((0,v.t)(f._d,{variables:{where:{name:{_ilike:""!==x?"%".concat(x,"%"):null}},offset:0,limit:50}}),2),C=w[0],I=w[1],S=I.data,_=(void 0===S?{items:[]}:S).items,P=I.loading,q=function(e,n){if(!(null==n?void 0:n.value))return null;if("/dashboard/scheduledjob"===g().pathname){if("all"===n.value)return null;g().push("/dashboard/properties/view?id=".concat(n.value,"&tab=planned-maintenance"))}else"all"===n.value?g().push("/dashboard/scheduledjob"):g().push("/dashboard/properties/view?id=".concat(n.value,"&tab=planned-maintenance"))};return(0,s.jsx)(c.Z,{followCursor:!0,title:Z.label,children:(0,s.jsx)(h.q,{freeSolo:!0,loading:P,options:[{label:"All locations",value:"all"}].concat((0,l.Z)(_)),value:Z,disabled:a,onChange:q,setSearch:y,onOpen:C,isOptionEqualToValue:function(e,n){return e.value===n.value},popupIcon:(0,s.jsx)(p.Z,{}),clearIcon:null,textFieldProps:{placeholder:"Location name",InputProps:{startAdornment:(0,s.jsx)(u.Z,{position:"start",children:(0,s.jsx)(b,{color:"white.main"})})}},size:"small",sx:j({withoutRightBorderRadius:n,fullWidth:t})})})},j=function(e){var n,t=e.withoutRightBorderRadius,i=e.fullWidth;return(0,a.Z)((0,r.Z)({height:"32px",width:i?"100%":"220px",backgroundColor:"secondary.main",borderRadius:1},t&&{borderTopRightRadius:0,borderBottomRightRadius:0}),(n={"& .MuiInputBase-root":{color:"white.main"},"& .MuiOutlinedInput-root.MuiInputBase-sizeSmall":{paddingTop:"4px"},"& .MuiOutlinedInput-notchedOutline":{border:"none"}},(0,o.Z)(n,"& .MuiAutocomplete-endAdornment .MuiSvgIcon-root,\n  .MuiInputAdornment-root.MuiInputAdornment-positionStart",{color:"white.main"}),(0,o.Z)(n,"& .MuiInputBase-root .MuiInputBase-input.Mui-disabled",{color:"white.main","-webkit-text-fill-color":"white",cursor:"not-allowed"}),n))}},91599:function(e,n,t){t.d(n,{$g:function(){return a},a3:function(){return l},aA:function(){return i},s4:function(){return r}});var o=t(16310),r=o.Ry({locations:o.IX().of(o.Ry({value:o.Rx().integer().required(),label:o.Z_().required()}).required()).min(1).required()}),a=o.Ry().shape({location:o.Ry().required(),sublocation:o.Ry().nullable(),assetCategory:o.Ry().nullable(),assets:o.IX().nullable(),shortDescription:o.Ry().required(),reference:o.Z_().nullable(),description:o.Z_().required(),estimatedDuration:o.Rx().min(0).required(),estimatedDurationUnit:o.Z_().oneOf(["hours","minutes","days"]).required(),compliance:o.O7().nullable(),complianceSelect:o.Ry().nullable(),costCategory:o.Ry().required(),service:o.Ry().required(),supplier:o.Ry().required(),frequencyDescription:o.Z_().nullable(),frequency:o.Z_().required(),costCustomer:o.Rx().transform(function(e){return isNaN(e)?null:e}).nullable(),costSupplier:o.Rx().transform(function(e){return isNaN(e)?null:e}).nullable(),firstInvoiceDate:o.hT().nullable(),finalInvoiceDate:o.hT().nullable(),customerMonthlyCharge:o.Rx().transform(function(e){return isNaN(e)?null:e}).nullable(),supplierMonthlyCharge:o.Rx().transform(function(e){return isNaN(e)?null:e}).nullable()}),i=o.Ry().shape({reference:o.Z_(),description:o.Z_().required(),dueDate:o.hT().when("$isSupplier",{is:!0,then:function(e){return e.nullable()}}),supplier:o.Ry().when("$isSupplier",{is:!0,then:function(e){return e.nullable()},otherwise:function(e){return e.required()}})}),l=o.Ry().shape({description:o.Z_().required(),rate:o.Rx().min(0).required(),quantity:o.Rx().integer().min(0).required(),vatType:o.Z_().oneOf(["default","custom"]).required(),vatPercentage:o.Rx().min(0).required()})},53363:function(e,n,t){t.d(n,{P:function(){return s}});var o=t(828),r=t(73359),a=t(57493),i=t(67294),l=t(182),s=function(e){var n=e.locationIdWatch,t=e.assetCategoryIdWatch,s=e.locationId,u=e.accountId,c=(0,i.useState)(""),d=c[0],p=c[1],m=(0,i.useState)(""),h=m[0],v=m[1],f=(0,i.useState)(""),x=f[0],g=f[1],b=(0,i.useState)(""),y=b[0],j=b[1],Z=(0,i.useState)(""),w=Z[0],C=Z[1],I=(0,i.useState)(""),S=I[0],_=I[1],P=(0,i.useState)(""),q=P[0],k=P[1],D=(0,i.useState)(""),T=D[0],O=D[1],M=(0,i.useState)(""),F=M[0],A=M[1],E=(0,o.Z)((0,r.t)(a.SW,{variables:{q:""!==d?"%".concat(d,"%"):null,limit:50,offset:0}}),2),R=E[0],$=E[1],N=$.loading,W=$.data,L=(void 0===W?{items:[]}:W).items,J=(0,o.Z)((0,r.t)(a._d,{variables:{where:{name:{_ilike:""!==h?"%".concat(h,"%"):null},status:{_eq:"active"}},limit:50,offset:0}}),2),Y=J[0],B=J[1],H=B.loading,V=B.data,G=(void 0===V?{items:[]}:V).items,Q=(0,o.Z)((0,r.t)(a.zR,{variables:{locationId:(null==n?void 0:n.value)||s,q:""!==x?"%".concat(x,"%"):null,limit:50,offset:0}}),2),z=Q[0],U=Q[1],K=U.loading,X=U.data,ee=(void 0===X?{items:[]}:X).items,en=(0,o.Z)((0,r.t)(l.OZ,{variables:{q:""!==y?"%".concat(y,"%"):null,limit:50,offset:0}}),2),et=en[0],eo=en[1],er=eo.loading,ea=eo.data,ei=(void 0===ea?{items:[]}:ea).items,el=(0,o.Z)((0,r.t)(a._f,{variables:{where:{type:{_eq:"assetCategory"},isGroup:{_eq:!1},status:{_eq:"active"},name:{_ilike:""!==w?"%".concat(w,"%"):null}},limit:50,offset:0,orderBy:{name:"asc"}}}),2),es=el[0],eu=el[1],ec=eu.loading,ed=eu.data,ep=(void 0===ed?{items:[]}:ed).items,em=(0,o.Z)((0,r.t)(a.UH,{variables:{locationId:(null==n?void 0:n.value)||s,categoryId:null==t?void 0:t.value,q:""!==S?"%".concat(S,"%"):null,limit:50,offset:0}}),2),eh=em[0],ev=em[1],ef=ev.loading,ex=ev.data,eg=(void 0===ex?{items:[]}:ex).items,eb=(0,o.Z)((0,r.t)(a.by,{variables:{where:{type:{_eq:"supplier"},name:{_ilike:""!==q?"%".concat(q,"%"):null}},limit:50,offset:0}}),2),ey=eb[0],ej=eb[1],eZ=ej.loading,ew=ej.data,eC=(void 0===ew?{items:[]}:ew).items,eI=(0,o.Z)((0,r.t)(a.K4,{variables:{accountId:u,limit:50,offset:0,q:""!==T?"%".concat(T,"%"):null}}),2),eS=eI[0],e_=eI[1],eP=e_.data,eq=(void 0===eP?{items:[]}:eP).items,ek=e_.loading,eD=(0,o.Z)((0,r.t)(a.yR,{variables:{accountId:u,q:""!==F?"%".concat(F,"%"):null,limit:50,offset:0}}),2),eT=eD[0],eO=eD[1],eM=eO.data,eF=(void 0===eM?{items:[]}:eM).items;return{customerProps:{onOpen:R,loading:N,options:L,setSearch:p},propertyProps:{onOpen:Y,loading:H,options:G,setSearch:v},sublocationProps:{onOpen:z,loading:K,options:ee,setSearch:g},complianceCategoryProps:{onOpen:et,loading:er,options:ei,setSearch:j},assetCategoryProps:{onOpen:es,loading:ec,options:ep,setSearch:C},assetProps:{onOpen:eh,loading:ef,options:eg,setSearch:_},supplierProps:{onOpen:ey,loading:eZ,options:eC,setSearch:k},customerManagerProps:{onOpen:eS,loading:ek,options:eq,setSearch:O},userProps:{onOpen:eT,loading:eO.loading,options:eF,setSearch:A}}}},96830:function(e,n,t){t.d(n,{x:function(){return tC}});var o=t(26042),r=t(69396),a=t(828),i=t(85893),l=t(67294),s=t(30381),u=t.n(s),c=t(6812),d=t(73359),p=t(50319),m=t(90263),h=t(5616),v=t(51233),f=t(15861),x=t(93946),g=t(11057),b=t(84808),y=t(98456),j=t(41899),Z=t(41733),w=t(91379),C=t(77957),I=t(81261),S=t(24519),_=t(6775),P=t(57460),q=t.n(P),k=t(83162),D=t(34187),T=t(23776),O=t(50135),M=t(22961),F=t(56154),A=[{name:"setLocation",hasRequiredFields:!0,requiredFields:function(){return["location"]},value:1},{name:"workDescription",hasRequiredFields:!0,requiredFields:function(){return["shortDescription","description","estimatedDuration","estimatedDurationUnit"]},value:2},{name:"selectService",hasRequiredFields:!0,requiredFields:function(){return["costCategory","service","supplier"]},value:3},{name:"setSchedule",hasRequiredFields:!0,requiredFields:function(){return["frequency","frequencyDescription"]},value:4},{name:"invoicing",hasRequiredFields:!0,requiredFields:function(e){return"onCompletion"===e.invoicingBasis?["costCustomer","costSupplier"]:["customerMonthlyCharge","supplierMonthlyCharge","firstInvoiceDate","finalInvoiceDate"]},value:5}],E=function(e){switch(e){case"raised":return{backgroundColor:"rgb(249, 156, 35)",color:"#ffffff"};case"offered":return{backgroundColor:"rgb(230, 8, 17)",color:"#ffffff"};case"accepted":return{backgroundColor:"rgb(0, 180, 60)",color:"#ffffff"};case"inProgress":return{backgroundColor:"rgb(0, 204, 188)",color:"#ffffff"};case"completed":return{backgroundColor:"rgb(217, 217, 217)",color:"#000000"};case"reportSent":return{backgroundColor:"rgb(153, 153, 153)",color:"#000000"};default:return{backgroundColor:"#C1C1C1",color:"#000000"}}},R={subtitle:{color:"#323E4E",fontWeight:"300"},statusSquaredIcon:function(e,n,t){return{backgroundColor:n,color:e,borderRadius:"5px",height:"30px","& .Mui-disabled":{backgroundColor:"".concat(n,"!important"),opacity:.5},"&:hover":{opacity:.8,backgroundColor:n}}},selectStatusAutocomplete:function(e,n){return{width:"170px","& .MuiInputBase-root":{border:"0px!important solid transparent",backgroundColor:"".concat(n,"!important"),padding:"3px!important",color:"".concat(e,"!important"),"-webkit-text-fill-color":"".concat(e,"!important"),input:{padding:"3px!important"},svg:{color:"".concat(e,"!important")}},"& .Mui-disabled":{opacity:.5}}}},$=function(e){var n,t,r,a,s,u=e.row,c=e.handleOpenJobsFromSchedule,d=e.sessionData,p=e.saveSessionData,m=(0,l.useState)(null!=d?d:F.j[0]),h=m[0],g=m[1],b=E(null==h?void 0:h.value),y=b.color,j=b.backgroundColor;return(0,i.jsxs)(v.Z,{columnGap:1,children:[!!(null===(n=u.jobs)||void 0===n?void 0:n.length)&&(0,i.jsx)(f.Z,{typography:"subtitle1",children:"".concat(null===(t=u.jobs)||void 0===t?void 0:t.length," Jobs ").concat(u.completeCount," completed")}),(0,i.jsx)(f.Z,{typography:"subtitle2",sx:R.subtitle,children:"Check a status of selected job"}),(0,i.jsxs)(v.Z,{direction:"row",alignItems:"center",columnGap:1,children:[(0,i.jsx)(T.Z,{disableClearable:!0,disabled:!(null==u?void 0:null===(r=u.jobs)||void 0===r?void 0:r.length),sx:R.selectStatusAutocomplete(y,j),value:h,onChange:function(e,n){e.stopPropagation(),p(u.id,n),g(n)},options:F.j,renderInput:function(e){return(0,i.jsx)(O.Z,(0,o.Z)({},e))}}),(0,i.jsx)(x.Z,{disabled:!(null==u?void 0:null===(a=u.jobs)||void 0===a?void 0:a.length),sx:R.statusSquaredIcon(y,j),onClick:function(e){var n,t;e.stopPropagation(),c({jobScheduleId:u.id,jobStatus:h.value,description:u.shortDescription.label,totalJobCount:null!==(t=null===(n=u.jobs)||void 0===n?void 0:n.length)&&void 0!==t?t:0})},children:(0,i.jsx)(M.Z,{sx:{color:y,opacity:(null==u?void 0:null===(s=u.jobs)||void 0===s?void 0:s.length)?1:.5}})})]})]})},N=t(47568),W=t(29815),L=t(97582),J=t(45697),Y=t.n(J),B=t(42283),H=t(79665),V=t(69368),G=t(86886),Q=t(90629),z=t(62711),U=t(57493),K=t(45451),X=t(12632),ee=t(74944),en=t(18531),et=t(91599),eo=t(19512),er={item:"createdAt",order:"asc"},ea=function(e){var n,t=e.locationId,s=(0,eo.D)(),u=(0,(0,ee.x)().hasRole)("admin"),d=(0,l.useState)("selectAll"),m=d[0],h=d[1],x=(0,l.useState)([]),g=x[0],j=x[1],Z=(0,l.useState)(""),w=Z[0],C=Z[1],I=(0,X.x)({initialSort:er}),S=I.initialData,_=I.ref,P=(0,B.cI)({defaultValues:{locations:[]},resolver:(0,H.S)(et.s4)}),q=P.handleSubmit,k=P.control,D=P.errors,T=(0,a.Z)((0,p.D)(z.yt,{onCompleted:function(){s.show({content:"Success. This planned maintenance schedule\n        has been copied to the selected locations.\n        Please note that you will still need to click on the relevant\n        item in the location to create the individual jobs."})},onError:function(e){s.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),O=T[0],M=T[1].loading,F=(0,c.a)(z.ix,{variables:(0,r.Z)((0,o.Z)({},S),{locationId:t})}),A=F.data,E=void 0===A?{jobSchedule:[],meta:{aggregate:{totalCount:0}}}:A,R=E.jobSchedule,$=E.meta,J=F.loading,Y=F.refetch,ea=(0,c.a)(U._d,{variables:{where:{status:{_eq:"active"},name:{_ilike:""!==w?"%".concat(w,"%"):null}},limit:50,offset:0}}),ei=ea.loading,el=ea.data,es=(void 0===el?{items:[]}:el).items,eu=function(e){var n=e.row;return"selectAll"===m||"excludeAll"!==m&&("selectSome"===m?g.includes(n.id):"excludeSome"===m&&!g.includes(n.id))},ec=function(e){var n=e.row;return function(e,t){var o=g.includes(n.id)&&1===g.length;return"selectAll"!==m&&"excludeSome"!==m||t?"excludeSome"===m&&t?(o&&h("selectAll"),j(function(e){return e.filter(function(e){return e!==n.id})})):("excludeAll"===m||"selectSome"===m)&&t?(h("selectSome"),j(function(e){return(0,W.Z)(e).concat([n.id])})):"selectSome"!==m||t?void 0:(o&&h("excludeAll"),j(function(e){return e.filter(function(e){return e!==n.id})})):(h("excludeSome"),j(function(e){return(0,W.Z)(e).concat([n.id])}))}},ed=R.map(function(e,n){return{index:n,id:e.id,title:e.meta.shortDescriptionName,description:e.meta.description,sublocation:e.sublocation,service:e.meta.serviceName,supplier:e.meta.supplierName,frequencyDescription:e.frequencyDescription}}),ep=(n=(0,N.Z)(function(e){return(0,L.__generator)(this,function(n){switch(n.label){case 0:if("excludeAll"===m)return[2];return[4,O({variables:{originLocationId:t,copyLocationIds:e.locations.map(function(e){return e.value}),selectType:m,scheduleIds:g}})];case 1:return n.sent(),[2]}})}),function(e){return n.apply(this,arguments)}),em=(0,l.useMemo)(function(){return es.map(function(e){var n,t,o=null===(n=e.registeredAddress)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.address;return{label:"".concat(e.label,", ").concat((null==o?void 0:o.addressLine1)||""),value:e.value}})},[es]);return(0,i.jsxs)("form",{id:"offCanvasForm",onSubmit:q(ep),children:[M&&(0,i.jsx)(b.Z,{sx:{zIndex:1e5},open:!0,children:(0,i.jsx)(y.Z,{color:"secondary"})}),(0,i.jsxs)(G.ZP,{container:!0,rowSpacing:4,children:[(0,i.jsx)(G.ZP,{item:!0,xs:12,children:(0,i.jsx)(B.Qr,{name:"locations",control:k,render:function(e){var n,t=e.value,o=e.onChange;return(0,i.jsx)(en.q,{multiple:!0,limitTags:6,color:"secondary",filterSelectedOptions:!0,loading:ei,value:t||[],onChange:function(e,n){o(n)},options:em,setSearch:C,textFieldProps:{label:"Select locations",variant:"standard",color:"secondary",error:D.locations,helperText:null===(n=D.locations)||void 0===n?void 0:n.message}})}})}),(0,i.jsx)(G.ZP,{item:!0,xs:12,children:(0,i.jsx)(Q.Z,{elevation:5,sx:{pb:1},children:(0,i.jsx)(K.i,{paginationSize:10,ref:_,getRowHeight:function(e){return e.model.sublocation?72:52},getRowClassName:function(e){return e.row.index%2==0?"even":"odd"},loading:J,columns:[{width:50,field:"select",sortable:!1,renderHeader:function(){return(0,i.jsx)(V.Z,{color:"secondary",checked:"selectAll"===m,onChange:function(e,n){n?(h("selectAll"),j([])):(h("excludeAll"),j([]))}})},renderCell:function(e){var n=e.row;return(0,i.jsx)(V.Z,{color:"secondary",checked:eu({row:n}),onChange:ec({row:n})})}},{minWidth:40,width:40,field:"index",headerName:"Id",sortable:!1,renderCell:function(e){return e.row.index+1+S.offset}},{flex:1,field:"job",headerName:"Job",sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsxs)(v.Z,{children:[(0,i.jsx)(f.Z,{fontWeight:700,children:n.title}),(0,i.jsx)(f.Z,{children:n.description}),n.sublocation&&(0,i.jsxs)(v.Z,{direction:"row",spacing:1,children:[(0,i.jsx)(f.Z,{fontWeight:700,children:"Sublocation:"}),(0,i.jsxs)(f.Z,{children:[" ",n.sublocation.name]})]})]})}},{flex:1,field:"service",headerName:"Service",sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsxs)(v.Z,{children:[(0,i.jsx)(f.Z,{children:n.service}),u&&(0,i.jsxs)(f.Z,{children:["Assigned to: ",n.supplier]})]})}},{flex:1,field:"frequencyDescription",headerName:"Frequency",sortable:!1}],rows:ed,meta:$,refetch:Y})})})]})]})};ea.defaultProps={},ea.propTypes={locationId:Y().number.isRequired};var ei=t(60888),el=t(50480),es=t(61730),eu=t(87109),ec=t(36872),ed=t(33754),ep=t(36740),em=t(36968),eh=t.n(em),ev=t(81836),ef=function(e){var n=e.onDate.date;return u().isMoment(u()(n))||(n=new Date().setMilliseconds(0)),{dtstart:u()(n).toDate()}},ex=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],eg=function(e){var n={};switch(e.which){case"First":n.bysetpos=1;break;case"Second":n.bysetpos=2;break;case"Third":n.bysetpos=3;break;case"Fourth":n.bysetpos=4;break;case"Last":n.bysetpos=-1}switch(e.day){case"Monday":n.byweekday=[0];break;case"Tuesday":n.byweekday=[1];break;case"Wednesday":n.byweekday=[2];break;case"Thursday":n.byweekday=[3];break;case"Friday":n.byweekday=[4];break;case"Saturday":n.byweekday=[5];break;case"Sunday":n.byweekday=[6];break;case"Day":n.byweekday=[0,1,2,3,4,5,6];break;case"Weekday":n.byweekday=[0,1,2,3,4];break;case"Weekend day":n.byweekday=[5,6]}return n.bymonth=ex.indexOf(e.month)+1,n},eb=function(e){var n,t=e.mode,r=e.on,a=e.onThe;switch(e.excludingWeekends,t){case"on":return(0,o.Z)({freq:ev.Ci.YEARLY},(n=r,{bymonth:ex.indexOf(n.month)+1,bymonthday:n.day}));case"anyTimeOption":return{freq:ev.Ci.YEARLY};default:return(0,o.Z)({freq:ev.Ci.YEARLY},eg(a))}},ey=function(e){var n={};switch(e.which){case"First":n.bysetpos=1;break;case"Second":n.bysetpos=2;break;case"Third":n.bysetpos=3;break;case"Fourth":n.bysetpos=4;break;case"Last":n.bysetpos=-1}switch(e.day){case"Monday":n.byweekday=[0];break;case"Tuesday":n.byweekday=[1];break;case"Wednesday":n.byweekday=[2];break;case"Thursday":n.byweekday=[3];break;case"Friday":n.byweekday=[4];break;case"Saturday":n.byweekday=[5];break;case"Sunday":n.byweekday=[6];break;case"Day":n.byweekday=[0,1,2,3,4,5,6];break;case"Weekday":n.byweekday=[0,1,2,3,4];break;case"Weekend day":n.byweekday=[5,6]}return n},ej=function(e){var n,t=e.mode,r=e.interval,a=e.on,i=e.onThe,l=e.excludingWeekends;switch(t){case"on":return(0,o.Z)({freq:ev.Ci.MONTHLY,interval:r},(n=a,{bymonthday:n.day}));case"anyTimeOption":return(0,o.Z)({freq:ev.Ci.MONTHLY,interval:r},l&&{byweekday:[ev.Ci.MO,ev.Ci.TU,ev.Ci.WE,ev.Ci.TH,ev.Ci.FR],bysetpos:[1]},!l&&{bymonthday:[1]});default:return(0,o.Z)({freq:ev.Ci.MONTHLY,interval:r},ey(i))}},eZ=t(52628),ew=t.n(eZ),eC=function(e){var n=e.mode,t=e.interval,r=e.days,a=e.excludingWeekends;return"anyTimeOption"===n?(0,o.Z)({freq:ev.Ci.WEEKLY,interval:t,bysetpos:[1]},a&&{byweekday:[ev.Ci.MO,ev.Ci.TU,ev.Ci.WE,ev.Ci.TH,ev.Ci.FR]},!a&&{byweekday:[ev.Ci.MO,ev.Ci.TU,ev.Ci.WE,ev.Ci.TH,ev.Ci.FR,ev.Ci.SA,ev.Ci.SU]}):(0,o.Z)({freq:ev.Ci.WEEKLY,interval:t,byweekday:ew()(r).reduce(function(e,n,t){return n?(0,W.Z)(e).concat([t]):e},[])},a&&{byweekday:[ev.Ci.MO,ev.Ci.TU,ev.Ci.WE,ev.Ci.TH,ev.Ci.FR],bysetpos:[1]})},eI=function(e){var n=e.interval;return e.excludingWeekends,{freq:ev.Ci.DAILY,interval:n}},eS=function(e){var n=e.interval,t=e.excludingWeekends;return(0,o.Z)({freq:ev.Ci.HOURLY,interval:n},t&&{byweekday:[ev.Ci.MO,ev.Ci.TU,ev.Ci.WE,ev.Ci.TH,ev.Ci.FR],bysetpos:[1]})},e_=function(e){var n=e.frequency,t=e.yearly,o=e.monthly,r=e.weekly,a=e.daily,i=e.hourly;switch(n){case"Yearly":return eb(t);case"Monthly":return ej(o);case"Weekly":return eC(r);case"Daily":return eI(a);case"Hourly":return eS(i);default:return{}}},eP=function(e){var n=e.mode,t=e.after,o=e.onDate.date,r={};return"After"===n&&(r.count=t),"On date"===n&&(r.until=u()(o).toDate()),r},eq=function(e){var n=e.hideStart,t=e.weekStartsOnSunday,o={};return n&&(o.dtstart=null),t&&(o.wkst=ev.Ci.SU),o},ek=function(e){var n=e.start,t=e.repeat,r=e.end,a=e.options,i=(0,o.Z)({},ef(n),e_(t),eP(r),eq(a)),l=new ev.Ci(i);return{rruleString:l.toString(),rruleText:l.toText()}},eD=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.start)||void 0===o?void 0:null===(r=o.onDate)||void 0===r?void 0:r.date)?t.start.onDate.date:n.dtstart?n.dtstart:e.start.onDate.date},eT=function(e,n,t){var o;if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:o.frequency)return t.repeat.frequency;switch(n.freq){case 0:return"Yearly";case 1:return"Monthly";case 2:return"Weekly";case 3:return"Daily";case 4:return"Hourly";default:return e.repeat.frequency}},eO=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:r.mode)?t.repeat.yearly.mode:0===n.freq&&n.bymonth?n.bymonthday?"on":"on the":e.repeat.yearly.mode},eM=function(e,n,t){var o,r,a;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.on)||void 0===a?void 0:a.month)?t.repeat.yearly.on.month:0===n.freq&&n.bymonthday&&"number"==typeof n.bymonth?ex[n.bymonth-1]:e.repeat.yearly.on.month},eF=function(e,n,t){var o,r,a;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.on)||void 0===a?void 0:a.day)?t.repeat.yearly.on.day:0===n.freq&&n.bymonthday&&"number"==typeof n.bymonthday?n.bymonthday:e.repeat.yearly.on.day},eA=function(e,n,t){var o,r,a,i;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.month)?t.repeat.yearly.onThe.month:0===n.freq&&n.byweekday?"number"==typeof n.bymonth?ex[n.bymonth-1]:(null===(i=n.bymonth)||void 0===i?void 0:i[0])?ex[n.bymonth[0]-1]:e.repeat.yearly.onThe.month:e.repeat.yearly.onThe.month},eE=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.day)return t.repeat.yearly.onThe.day;if(0!==n.freq||!n.byweekday)return e.repeat.yearly.onThe.day;var o,r,a,i=n.byweekday.map(function(e){return e.weekday}).join(",");switch(i){case"0":return"Monday";case"1":return"Tuesday";case"2":return"Wednesday";case"3":return"Thursday";case"4":return"Friday";case"5":return"Saturday";case"6":return"Sunday";case"0,1,2,3,4,5,6":return"Day";case"0,1,2,3,4":return"Weekday";case"5,6":return"Weekend day";default:return e.repeat.yearly.onThe.day}},eR=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.yearly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.which)return t.repeat.yearly.onThe.which;if(0!==n.freq||!n.byweekday)return e.repeat.yearly.onThe.which;var o,r,a,i="number"==typeof n.bysetpos?n.bysetpos:n.bysetpos[0];switch(i){case 1:return"First";case 2:return"Second";case 3:return"Third";case 4:return"Fourth";case -1:return"Last";default:return e.repeat.yearly.onThe.which}},e$=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:r.mode)?t.repeat.monthly.mode:1!==n.freq?e.repeat.monthly.mode:n.bymonthday?"on":"on the"},eN=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:r.interval)?t.repeat.monthly.interval:1!==n.freq?e.repeat.monthly.interval:n.interval},eW=function(e,n,t){var o,r,a;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:null===(a=r.on)||void 0===a?void 0:a.day)?t.repeat.monthly.on.day:1===n.freq&&n.bymonthday?"number"==typeof n.bymonthday?n.bymonthday:n.bymonthday[0]:e.repeat.monthly.on.day},eL=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.day)return t.repeat.monthly.onThe.day;if(1!==n.freq||!n.byweekday)return e.repeat.monthly.onThe.day;var o,r,a,i=n.byweekday.map(function(e){return e.weekday}).join(",");switch(i){case"0":return"Monday";case"1":return"Tuesday";case"2":return"Wednesday";case"3":return"Thursday";case"4":return"Friday";case"5":return"Saturday";case"6":return"Sunday";case"0,1,2,3,4,5,6":return"Day";case"0,1,2,3,4":return"Weekday";case"5,6":return"Weekend day";default:return e.repeat.monthly.onThe.day}},eJ=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.monthly)||void 0===r?void 0:null===(a=r.onThe)||void 0===a?void 0:a.which)return t.repeat.monthly.onThe.which;if(1!==n.freq||!n.bysetpos)return e.repeat.monthly.onThe.which;var o,r,a,i="number"==typeof n.bysetpos?n.bysetpos:n.bysetpos[0];switch(i){case 1:return"First";case 2:return"Second";case 3:return"Third";case 4:return"Fourth";case -1:return"Last";default:return e.repeat.monthly.onThe.which}},eY=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.weekly)||void 0===r?void 0:r.interval)?t.repeat.weekly.interval:2!==n.freq?e.repeat.weekly.interval:n.interval},eB=function(e,n,t){if(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.weekly)||void 0===r?void 0:r.days)return t.repeat.weekly.days;var o,r,a=[];return 2!==n.freq?e.repeat.weekly.days:(n.byweekday&&(a=n.byweekday.map(function(e){return e.weekday})),{mon:a.includes(0),tue:a.includes(1),wed:a.includes(2),thu:a.includes(3),fri:a.includes(4),sat:a.includes(5),sun:a.includes(6)})},eH=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.weekly)||void 0===r?void 0:r.weekStartsOnSunday)?t.repeat.weekly.weekStartsOnSunday:n.wkst?6===n.wkst:e.repeat.weekly.options.weekStartsOnSunday},eV=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.daily)||void 0===r?void 0:r.interval)?t.repeat.daily.interval:3!==n.freq?e.repeat.daily.interval:n.interval},eG=function(e,n,t){var o,r;return(null==t?void 0:null===(o=t.repeat)||void 0===o?void 0:null===(r=o.hourly)||void 0===r?void 0:r.interval)?t.repeat.hourly.interval:4!==n.freq?e.repeat.daily.interval:n.interval},eQ=function(e,n,t){var o;return(null==t?void 0:null===(o=t.end)||void 0===o?void 0:o.after)?t.end.after:n.count||0===n.count?n.count:e.end.after},ez=function(e,n,t){var o,r,a,i;return(null==t?void 0:null===(o=t.end)||void 0===o?void 0:null===(r=o.onDate)||void 0===r?void 0:r.date)?t.end.onDate.date:(null==n?void 0:null===(a=n.end)||void 0===a?void 0:null===(i=a.onDate)||void 0===i?void 0:i.date)?n.end.onDate.date:e.end.onDate.date},eU=function(e,n,t){if(!n&&!t)return e;var a,i,l,s,c,d,p,m,h,v,f,x,g,b,y,j,Z,w,C,I,S,_,P,q,k,D,T,O,M,F,A,E,R,$,N,W,L,J,Y,B,H,V,G,Q,z=(0,ev.SA)(n).origOptions;return(0,r.Z)((0,o.Z)({},e),{start:(0,r.Z)((0,o.Z)({},e.start),{onDate:{date:u()(eD(e,z,t)),options:(0,r.Z)((0,o.Z)({},e.start.onDate.options),{weekStartsOnSunday:eH(e,z,t)})}}),repeat:(0,r.Z)((0,o.Z)({},e.repeat),{frequency:eT(e,z,t),yearly:(0,r.Z)((0,o.Z)({},e.repeat.yearly),{mode:eO(e,z,t),excludingWeekends:null==t?void 0:null===(a=t.repeat)||void 0===a?void 0:null===(i=a.yearly)||void 0===i?void 0:i.excludingWeekends,hourStart:(null==t?void 0:null===(l=t.repeat)||void 0===l?void 0:null===(s=l.yearly)||void 0===s?void 0:s.hourStart)?new Date(null==t?void 0:null===(c=t.repeat)||void 0===c?void 0:null===(d=c.yearly)||void 0===d?void 0:d.hourStart):null,hourEnd:(null==t?void 0:null===(p=t.repeat)||void 0===p?void 0:null===(m=p.yearly)||void 0===m?void 0:m.hourEnd)?new Date(null==t?void 0:null===(h=t.repeat)||void 0===h?void 0:null===(v=h.yearly)||void 0===v?void 0:v.hourEnd):null,on:{month:eM(e,z,t),day:eF(e,z,t)},onThe:{month:eA(e,z,t),day:eE(e,z,t),which:eR(e,z,t)}}),monthly:(0,r.Z)((0,o.Z)({},e.repeat.monthly),{mode:e$(e,z,t),excludingWeekends:null==t?void 0:null===(f=t.repeat)||void 0===f?void 0:null===(x=f.monthly)||void 0===x?void 0:x.excludingWeekends,hourStart:(null==t?void 0:null===(g=t.repeat)||void 0===g?void 0:null===(b=g.monthly)||void 0===b?void 0:b.hourStart)?new Date(null==t?void 0:null===(y=t.repeat)||void 0===y?void 0:null===(j=y.monthly)||void 0===j?void 0:j.hourStart):null,hourEnd:(null==t?void 0:null===(Z=t.repeat)||void 0===Z?void 0:null===(w=Z.monthly)||void 0===w?void 0:w.hourEnd)?new Date(null==t?void 0:null===(C=t.repeat)||void 0===C?void 0:null===(I=C.monthly)||void 0===I?void 0:I.hourEnd):null,interval:eN(e,z,t),on:{day:eW(e,z,t)},onThe:{day:eL(e,z,t),which:eJ(e,z,t)}}),weekly:{mode:null==t?void 0:null===(S=t.repeat)||void 0===S?void 0:null===(_=S.weekly)||void 0===_?void 0:_.mode,excludingWeekends:null==t?void 0:null===(P=t.repeat)||void 0===P?void 0:null===(q=P.weekly)||void 0===q?void 0:q.excludingWeekends,hourStart:(null==t?void 0:null===(k=t.repeat)||void 0===k?void 0:null===(D=k.weekly)||void 0===D?void 0:D.hourStart)?new Date(null==t?void 0:null===(T=t.repeat)||void 0===T?void 0:null===(O=T.weekly)||void 0===O?void 0:O.hourStart):null,hourEnd:(null==t?void 0:null===(M=t.repeat)||void 0===M?void 0:null===(F=M.weekly)||void 0===F?void 0:F.hourEnd)?new Date(null==t?void 0:null===(A=t.repeat)||void 0===A?void 0:null===(E=A.weekly)||void 0===E?void 0:E.hourEnd):null,interval:eY(e,z,t),days:eB(e,z,t),options:{weekStartsOnSunday:eH(e,z,t)}},daily:{mode:null==t?void 0:null===(R=t.repeat)||void 0===R?void 0:null===($=R.daily)||void 0===$?void 0:$.mode,interval:eV(e,z,t),excludingWeekends:null==t?void 0:null===(N=t.repeat)||void 0===N?void 0:null===(W=N.daily)||void 0===W?void 0:W.excludingWeekends,hourStart:(null==t?void 0:null===(L=t.repeat)||void 0===L?void 0:null===(J=L.daily)||void 0===J?void 0:J.hourStart)?new Date(null==t?void 0:null===(Y=t.repeat)||void 0===Y?void 0:null===(B=Y.daily)||void 0===B?void 0:B.hourStart):null,hourEnd:(null==t?void 0:null===(H=t.repeat)||void 0===H?void 0:null===(V=H.daily)||void 0===V?void 0:V.hourEnd)?new Date(null==t?void 0:null===(G=t.repeat)||void 0===G?void 0:null===(Q=G.daily)||void 0===Q?void 0:Q.hourEnd):null},hourly:{interval:eG(e,z,t)}}),end:(0,r.Z)((0,o.Z)({},e.end),{mode:"On date",after:eQ(e,z,t),onDate:{date:u()(ez(e,z,t)),options:(0,r.Z)((0,o.Z)({},e.end.onDate.options),{weekStartsOnSunday:eH(e,z,t)})}}),options:(0,r.Z)((0,o.Z)({},e.options),{weekStartsOnSunday:eH(e,z,t)})})},eK=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{start:{onDate:{date:u()(),options:{weekStartsOnSunday:e.weekStartsOnSunday}}},repeat:{frequency:e.repeat?e.repeat[0]:"Yearly",yearly:{mode:e.yearly||"on",on:{month:"Jan",day:1},onThe:{month:"Jan",day:"Monday",which:"First"},options:{modes:e.yearly}},monthly:{mode:e.monthly||"on",interval:1,on:{day:1},onThe:{day:"Monday",which:"First"},options:{modes:e.monthly}},weekly:{interval:1,days:{mon:!1,tue:!1,wed:!1,thu:!1,fri:!1,sat:!1,sun:!1},options:{weekStartsOnSunday:e.weekStartsOnSunday}},daily:{interval:1},hourly:{interval:1},options:{frequency:e.repeat}},end:{mode:"On date",onDate:{date:u()(),options:{weekStartsOnSunday:e.weekStartsOnSunday}},options:{modes:e.end}},options:{hideStart:void 0===e.hideStart||e.hideStart,hideEnd:e.hideEnd,hideError:e.hideError,weekStartsOnSunday:e.weekStartsOnSunday}}},eX=t(7654),e0=t.n(eX),e1=function(e){return function(n){var t=+n.target.value;!e0()(t)&&!(t>=1e3)&&e({target:{value:t,name:n.target.name}})}},e2=t(15772),e5=function(e){var n=e.defaultOptions,t=e.handleChange,a=(0,e.watch)("repeat.daily.mode"),l=function(e){var n,o=e.name;t({target:{name:o,value:e.value?"anyTimeOption":null}})},s=n.control,u=n.register;return(0,i.jsxs)(v.Z,{children:[(0,i.jsxs)(v.Z,{width:"100%",direction:"row",alignItems:"center",columnGap:2,mt:2,children:[(0,i.jsx)(f.Z,{children:"every"}),(0,i.jsx)(O.Z,{fullWidth:!0,name:"repeat.daily.interval",inputRef:u,onChange:function(e){return e1(t(e))},color:"secondary",size:"small"}),(0,i.jsx)(f.Z,{children:"day(s)"})]}),(0,i.jsx)(B.Qr,{control:s,name:"repeat.daily.mode",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(el.Z,{label:"any time",control:(0,i.jsx)(V.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;l({name:"repeat.daily.mode",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),a&&(0,i.jsxs)(v.Z,{spacing:1,children:[(0,i.jsx)(f.Z,{children:"Between hours of"}),(0,i.jsxs)(v.Z,{direction:"row",columnGap:2,children:[(0,i.jsx)(B.Qr,{control:s,name:"repeat.daily.hourStart",render:function(e){var n=e.value,a=e.onChange;return(0,i.jsx)(e2.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){a(e),t({target:{name:"repeat.daily.hourStart",value:e}})},renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{label:"Start",color:"secondary",size:"small",sx:{width:"100px"}}))}})}}),(0,i.jsx)(B.Qr,{control:s,name:"repeat.daily.hourEnd",render:function(e){var n=e.value,a=e.onChange;return(0,i.jsx)(e2.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){a(e),t({target:{name:"repeat.daily.hourEnd",value:e}})},renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{label:"End",color:"secondary",size:"small",sx:{width:"100px"}}))}})}})]})]})]})};e5.propTypes={defaultOptions:J.object.isRequired,handleChange:J.func.isRequired};var e3=function(e){var n=e.defaultOptions,t=e.handleChange,o=n.register;return(0,i.jsxs)(v.Z,{width:"100%",direction:"row",alignItems:"center",columnGap:2,mt:2,children:[(0,i.jsx)(f.Z,{children:"every"}),(0,i.jsx)(O.Z,{fullWidth:!0,name:"repeat.hourly.interval",inputRef:o,onChange:function(e){return e1(t(e))},color:"secondary",size:"small"}),(0,i.jsx)(f.Z,{children:"hours(s)"})]})};e3.propTypes={defaultOptions:J.object.isRequired,handleChange:J.func.isRequired};var e6=[{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"4",value:"4"},{label:"5",value:"5"},{label:"6",value:"6"},{label:"7",value:"7"},{label:"8",value:"8"},{label:"9",value:"9"},{label:"10",value:"10"},{label:"11",value:"11"},{label:"12",value:"12"},{label:"13",value:"13"},{label:"14",value:"14"},{label:"15",value:"15"},{label:"16",value:"16"},{label:"17",value:"17"},{label:"18",value:"18"},{label:"19",value:"19"},{label:"20",value:"20"},{label:"21",value:"21"},{label:"22",value:"22"},{label:"23",value:"23"},{label:"24",value:"24"},{label:"25",value:"25"},{label:"26",value:"26"},{label:"27",value:"27"},{label:"28",value:"28"},{label:"29",value:"29"},{label:"30",value:"30"},{label:"31",value:"31"}],e4=[{label:"Yearly",value:"Yearly"},{label:"Monthly",value:"Monthly"},{label:"Weekly",value:"Weekly"},{label:"Daily",value:"Daily"},{label:"Hourly",value:"Hourly"}],e9=[{label:"First",value:"First"},{label:"Second",value:"Second"},{label:"Third",value:"Third"},{label:"Fourth",value:"Fourth"},{label:"Last",value:"Last"}],e7=[{label:"Monday",value:"Monday"},{label:"Tuesday",value:"Tuesday"},{label:"Wednesday",value:"Wednesday"},{label:"Thursday",value:"Thursday"},{label:"Friday",value:"Friday"},{label:"Saturday",value:"Saturday"},{label:"Day",value:"Day"},{label:"Weekday",value:"Weekday"},{label:"Weekend day",value:"Weekend day"}],e8=[{label:"Mon",value:"mon"},{label:"Tue",value:"tue"},{label:"Wed",value:"wed"},{label:"Thu",value:"thu"},{label:"Fri",value:"fri"},{label:"Sat",value:"sat"},{label:"Sun",value:"sun"}],ne={Sunday:0,Monday:1,Tuesday:2,Wednesday:3,Thursday:4,Firday:5,Saturday:6},nn=t(79717),nt=nn.Z,no=ec.Z,nr={radio:{"&.MuiRadioGroup-root":{"label:first-child":{marginTop:"0px"},"label:not(:first-child)":{marginTop:"10px"},"label:last-child":{"& .MuiTypography-body1":{width:"200px"}}}}},na=function(e){var n=e.defaultOptions,t=e.handleChange,a=(0,e.watch)("repeat.monthly.mode"),l=function(e){var n,o=e.name;t({target:{name:o,value:e.value}})},s=n.control,u=n.register;return(0,i.jsxs)(v.Z,{children:[(0,i.jsxs)(v.Z,{width:"100%",direction:"row",alignItems:"center",justifyContent:"flex-start",columnGap:2,mt:2,children:[(0,i.jsx)(f.Z,{children:"every"}),(0,i.jsx)(O.Z,{fullWidth:!0,name:"repeat.monthly.interval",inputRef:u,onChange:function(e){return e1(t(e))},color:"secondary",size:"small"}),(0,i.jsx)(f.Z,{children:"month(s)"})]}),(0,i.jsxs)(G.ZP,{container:!0,mt:2,children:[(0,i.jsx)(G.ZP,{item:!0,md:3,children:(0,i.jsx)(B.Qr,{name:"repeat.monthly.mode",control:s,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsxs)(nt,{sx:nr.radio,stackProps:{width:"100%",height:"100%"},value:n,onChange:function(e,n){o(n),t({target:{name:"repeat.monthly.mode",value:n}})},children:[(0,i.jsx)(el.Z,{label:"on day",control:(0,i.jsx)(no,{value:"on",color:"secondary",sx:{width:"40px"}})}),(0,i.jsx)(el.Z,{label:"on the",control:(0,i.jsx)(no,{value:"on the",label:"on the",color:"secondary",sx:{width:"40px"}})}),(0,i.jsx)(el.Z,{label:"any time (during month)",control:(0,i.jsx)(no,{value:"anyTimeOption",color:"secondary",sx:{width:"40px"}})})]})}})}),(0,i.jsxs)(G.ZP,{item:!0,md:9,children:[(0,i.jsx)(B.Qr,{name:"repeat.monthly.on.day",control:s,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(en.q,{fullWidth:!0,value:n,disableClearable:!0,options:e6,onChange:function(e,n){t({target:{name:"repeat.monthly.on.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,i.jsxs)(v.Z,{direction:"row",columnGap:2,mt:2,children:[(0,i.jsx)(B.Qr,{name:"repeat.monthly.onThe.which",control:s,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(en.q,{fullWidth:!0,value:n,options:e9,disableClearable:!0,onChange:function(e,n){t({target:{name:"repeat.monthly.onThe.which",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,i.jsx)(B.Qr,{name:"repeat.monthly.onThe.day",control:s,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(en.q,{fullWidth:!0,value:n,disableClearable:!0,options:e7,onChange:function(e,n){t({target:{name:"repeat.monthly.onThe.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}})]})]})]}),"anyTimeOption"===a&&(0,i.jsxs)(v.Z,{children:[(0,i.jsx)(B.Qr,{control:s,name:"repeat.monthly.excludingWeekends",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(el.Z,{label:"excluding weekends",control:(0,i.jsx)(V.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;l({name:"repeat.monthly.excludingWeekends",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),(0,i.jsxs)(v.Z,{spacing:1,children:[(0,i.jsx)(f.Z,{children:"Between hours of"}),(0,i.jsxs)(v.Z,{direction:"row",spacing:2,children:[(0,i.jsx)(B.Qr,{control:s,name:"repeat.monthly.hourStart",render:function(e){var n=e.value,a=e.onChange;return(0,i.jsx)(e2.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){a(e),t({target:{name:"repeat.monthly.hourStart",value:e}})},renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{color:"secondary",size:"small",label:"Start",sx:{width:"100px"}}))}})}}),(0,i.jsx)(B.Qr,{control:s,name:"repeat.monthly.hourEnd",render:function(e){var n=e.value,a=e.onChange;return(0,i.jsx)(e2.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){a(e),t({target:{name:"repeat.monthly.hourEnd",value:e}})},renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{color:"secondary",size:"small",label:"End",sx:{width:"100px"}}))}})}})]})]})]})]})};na.propTypes={defaultOptions:J.object.isRequired,handleChange:J.func.isRequired};var ni=function(e){var n=e.currentWeeklyDays,t=e.defaultOptions,a=e.handleChange,l=(0,e.watch)("repeat.weekly.mode"),s=function(e){Object.keys(n).forEach(function(e){return n[e]=!1}),e.forEach(function(e){n[e.value]=!0}),a({target:{value:n,name:"repeat.weekly.days"}})},u=function(e){var n,t=e.name;a({target:{name:t,value:e.value?"anyTimeOption":null}})},c=function(e){var n,t=e.name;a({target:{name:t,value:e.value}})},d=t.register,p=t.control;return(0,i.jsxs)(v.Z,{children:[(0,i.jsxs)(v.Z,{width:"100%",direction:"row",alignItems:"center",spacing:2,mt:2,children:[(0,i.jsx)(f.Z,{children:"every"}),(0,i.jsx)(O.Z,{name:"repeat.weekly.interval",inputRef:d,onChange:function(e){return e1(a(e))},color:"secondary",size:"small"}),(0,i.jsx)(f.Z,{children:"week(s)"})]}),(0,i.jsx)(B.Qr,{fullWidth:!0,name:"repeat.weekly.days",control:p,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,{multiple:!0,limitTags:2,value:n,sx:{width:"100%",marginTop:"10px"},disabled:l,options:e8,onChange:function(e,n){s(n),t(n)},size:"small",textFieldProps:{color:"secondary",label:"Day of the week"}})}}),(0,i.jsx)(B.Qr,{control:p,name:"repeat.weekly.mode",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(el.Z,{label:"any time",control:(0,i.jsx)(V.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;u({name:"repeat.weekly.mode",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),l&&(0,i.jsxs)(v.Z,{children:[(0,i.jsx)(B.Qr,{control:p,name:"repeat.weekly.excludingWeekends",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(el.Z,{label:"excluding weekends",control:(0,i.jsx)(V.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;c({name:"repeat.weekly.excludingWeekends",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),(0,i.jsxs)(v.Z,{spacing:1,children:[(0,i.jsx)(f.Z,{children:"Between hours of"}),(0,i.jsxs)(v.Z,{direction:"row",spacing:2,children:[(0,i.jsx)(B.Qr,{control:p,name:"repeat.weekly.hourStart",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(e2.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){t(e),a({target:{name:"repeat.weekly.hourStart",value:e}})},renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{color:"secondary",size:"small",label:"Start",sx:{width:"100px"}}))}})}}),(0,i.jsx)(B.Qr,{control:p,name:"repeat.weekly.hourEnd",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(e2.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){t(e),a({target:{name:"repeat.weekly.hourEnd",value:e}})},renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{color:"secondary",size:"small",label:"End",sx:{width:"100px"}}))}})}})]})]})]})]})};ni.propTypes={currentWeeklyDays:J.object.isRequired,defaultOptions:J.object.isRequired,handleChange:J.func.isRequired,setValue:J.func.isRequired};var nl=t(14647),ns=nn.Z,nu=ec.Z,nc={radio:{"&.MuiRadioGroup-root":{"label:first-child":{marginTop:"0px"},"label:not(:first-child)":{marginTop:"10px"},"label:last-child":{"& .MuiTypography-body1":{width:"200px"}}}}},nd=function(e){var n=e.defaultOptions,t=e.handleChange,a=(0,e.watch)("repeat.yearly.mode"),l=function(e){var n,o=e.name;t({target:{name:o,value:e.value}})},s=n.control;return(0,i.jsxs)(v.Z,{direction:"column",children:[(0,i.jsxs)(G.ZP,{container:!0,children:[(0,i.jsx)(G.ZP,{item:!0,md:4,mt:2,children:(0,i.jsx)(B.Qr,{name:"repeat.yearly.mode",control:s,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsxs)(ns,{sx:nc.radio,value:n,onChange:function(e,n){o(n),t({target:{name:"repeat.yearly.mode",value:n}})},children:[(0,i.jsx)(el.Z,{label:"on",control:(0,i.jsx)(nu,{value:"on",color:"secondary",sx:{width:"40px"}})}),(0,i.jsx)(el.Z,{label:"on the",control:(0,i.jsx)(nu,{value:"on the",label:"on the",color:"secondary",sx:{width:"40px"}})}),(0,i.jsx)(el.Z,{label:"any time (during month)",control:(0,i.jsx)(nu,{value:"anyTimeOption",color:"secondary",sx:{width:"40px"}})})]})}})}),(0,i.jsxs)(G.ZP,{item:!0,md:8,children:[(0,i.jsxs)(v.Z,{direction:"row",columnGap:2,mt:2,children:[(0,i.jsx)(B.Qr,{fullWidth:!0,name:"repeat.yearly.on.month",control:s,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(en.q,{value:n,disableClearable:!0,options:nl.lb,onChange:function(e,n){e1(t({target:{name:"repeat.yearly.on.month",value:n.value}})),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,i.jsx)(B.Qr,{fullWidth:!0,name:"repeat.yearly.on.day",control:s,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(en.q,{value:n,disableClearable:!0,options:e6,onChange:function(e,n){t({target:{name:"repeat.yearly.on.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}})]}),(0,i.jsxs)(v.Z,{direction:"row",columnGap:2,mt:2,children:[(0,i.jsx)(B.Qr,{fullWidth:!0,name:"repeat.yearly.onThe.which",control:s,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(en.q,{value:n,disableClearable:!0,options:e9,onChange:function(e,n){t({target:{name:"repeat.yearly.onThe.which",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,i.jsx)(B.Qr,{fullWidth:!0,name:"repeat.yearly.onThe.day",control:s,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(en.q,{value:n,options:e7,disableClearable:!0,onChange:function(e,n){t({target:{name:"repeat.yearly.onThe.day",value:n.value}}),o(n)},size:"small",textFieldProps:{color:"secondary"}})}}),(0,i.jsx)(B.Qr,{fullWidth:!0,name:"repeat.yearly.onThe.month",control:s,render:function(e){var n=e.value,o=e.onChange;return(0,i.jsx)(en.q,{value:n,disableClearable:!0,options:nl.lb,onChange:function(e,n){e1(t({target:{name:"repeat.yearly.onThe.month",value:n.value}})),o(n)},size:"small",textFieldProps:{color:"secondary"}})}})]})]})]}),"anyTimeOption"===a&&(0,i.jsxs)(v.Z,{mt:2,rowGap:1,children:[(0,i.jsx)(B.Qr,{control:s,name:"repeat.yearly.excludingWeekends",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(el.Z,{label:"excluding weekends",control:(0,i.jsx)(V.Z,{checked:n,color:"secondary",onChange:function(e){var n,o;l({name:"repeat.yearly.excludingWeekends",value:null===(n=e.target)||void 0===n?void 0:n.checked}),t(null===(o=e.target)||void 0===o?void 0:o.checked)}})})}}),(0,i.jsxs)(v.Z,{spacing:1,children:[(0,i.jsx)(f.Z,{children:"Between hours of"}),(0,i.jsxs)(v.Z,{direction:"row",spacing:2,children:[(0,i.jsx)(B.Qr,{control:s,name:"repeat.yearly.hourStart",render:function(e){var n=e.value,a=e.onChange;return(0,i.jsx)(e2.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){a(e),t({target:{name:"repeat.yearly.hourStart",value:e}})},renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{label:"Start",color:"secondary",size:"small",sx:{width:"100px"}}))}})}}),(0,i.jsx)(B.Qr,{control:s,name:"repeat.yearly.hourEnd",render:function(e){var n=e.value,a=e.onChange;return(0,i.jsx)(e2.j,{ampm:!1,inputFormat:"HH:mm",disableOpenPicker:!0,value:n||null,onChange:function(e){a(e),t({target:{name:"repeat.yearly.hourEnd",value:e}})},renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{label:"End",color:"secondary",size:"small",sx:{width:"100px"}}))}})}})]})]})]})]})};nd.propTypes={defaultOptions:J.object,handleChange:J.func};var np=function(e){var n=e.data,t=e.defaultOptions,o=e.handleChange,r=e.watch,a=t.control;return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.Z,{mt:2,children:(0,i.jsx)(B.Qr,{fullWidth:!0,name:"repeat.frequency",control:a,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,{value:n,disableClearable:!0,options:e4,onChange:function(e,n){o({target:{name:"repeat.frequency",value:n.value}}),t(n)},textFieldProps:{color:"secondary",label:"Repeat"}})}})}),function(){switch(n.repeat.frequency){case"Yearly":return(0,i.jsx)(nd,{defaultOptions:t,handleChange:o,watch:r});case"Monthly":return(0,i.jsx)(na,{defaultOptions:t,handleChange:o,watch:r});case"Weekly":return(0,i.jsx)(ni,{currentWeeklyDays:n.repeat.weekly.days,defaultOptions:t,handleChange:o,watch:r});case"Daily":return(0,i.jsx)(e5,{defaultOptions:t,handleChange:o,watch:r});case"Hourly":return(0,i.jsx)(e3,{defaultOptions:t,handleChange:o})}}()]})};np.propTypes={data:J.object.isRequired,defaultOptions:J.object.isRequired,handleChange:J.func.isRequired};var nm=function(e,n){var t=[];for(var o in e)!0===e[o]&&t.push(o);return n.filter(function(e){return t.includes(e.value)})},nh={hideStart:!1},nv=function(e){var n=e.disableStartEndValidation,t=e.setValueParent,a=e.setOuterStartEndDates,s=e.setRRuleMeta,c=e.setFrequencyError,d=e.rruleMeta,p=e.frequency,m=(0,l.useState)(null),h=m[0],f=m[1],x=(0,B.cI)(),g=x.control,b=x.errors,y=x.register,j=x.watch,Z=x.reset,w=j("end.onDate.date"),C=j("start.onDate.date"),I=n||u()(C).isAfter(u()().subtract(1,"day").startOf("day")),S=n||u()(w).isAfter(u()(C));(0,l.useEffect)(function(){var e,n=eK(nh),r=eU(n,p,d),a=ek(r),i=a.rruleString,l=a.rruleText;f((0,o.Z)({},r)),s((0,o.Z)({},r)),t("frequency",i),t("frequencyDescription",l),Z((0,o.Z)({},{"start.onDate.date":new Date(r.start.onDate.date),"repeat.frequency":{label:r.repeat.frequency,value:r.repeat.frequency},"repeat.yearly.mode":r.repeat.yearly.mode,"repeat.yearly.excludingWeekends":r.repeat.yearly.excludingWeekends,"repeat.yearly.hourStart":r.repeat.yearly.hourStart,"repeat.yearly.hourEnd":r.repeat.yearly.hourEnd,"repeat.yearly.on.month":{label:r.repeat.yearly.on.month,value:r.repeat.yearly.on.month},"repeat.yearly.on.day":{label:r.repeat.yearly.on.day,value:r.repeat.yearly.on.day},"repeat.yearly.onThe.which":{label:r.repeat.yearly.onThe.which,value:r.repeat.yearly.onThe.which},"repeat.yearly.onThe.day":{label:r.repeat.yearly.onThe.day,value:r.repeat.yearly.onThe.day},"repeat.yearly.onThe.month":{label:r.repeat.yearly.onThe.month,value:r.repeat.yearly.onThe.month},"repeat.monthly.interval":r.repeat.monthly.interval,"repeat.monthly.mode":r.repeat.monthly.mode,"repeat.monthly.excludingWeekends":r.repeat.monthly.excludingWeekends,"repeat.monthly.hourStart":r.repeat.monthly.hourStart,"repeat.monthly.hourEnd":r.repeat.monthly.hourEnd,"repeat.monthly.on.day":{label:r.repeat.monthly.on.day,value:r.repeat.monthly.on.day},"repeat.monthly.onThe.which":{label:r.repeat.monthly.onThe.which,value:r.repeat.monthly.onThe.which},"repeat.monthly.onThe.day":{label:r.repeat.monthly.onThe.day,value:r.repeat.monthly.onThe.day},"repeat.weekly.interval":r.repeat.weekly.interval,"repeat.weekly.mode":r.repeat.weekly.mode,"repeat.weekly.excludingWeekends":r.repeat.weekly.excludingWeekends,"repeat.weekly.hourStart":r.repeat.weekly.hourStart,"repeat.weekly.hourEnd":r.repeat.weekly.hourEnd,"repeat.weekly.days":nm(r.repeat.weekly.days,e8),"repeat.daily.interval":r.repeat.daily.interval,"repeat.daily.mode":r.repeat.daily.mode,"repeat.daily.excludingWeekends":r.repeat.daily.excludingWeekends,"repeat.daily.hourStart":r.repeat.daily.hourStart,"repeat.daily.hourEnd":r.repeat.daily.hourEnd,"repeat.hourly.interval":r.repeat.hourly.interval,"end.mode":"On date","end.onDate.date":new Date(r.end.onDate.date)}))},[p,Z,d,s,t]),(0,l.useEffect)(function(){a({scheduleStart:C,scheduleEnd:w})},[C,w,a]),(0,l.useEffect)(function(){c(!I||!S)},[I,S,c]);var _=(0,l.useCallback)(function(e){var n=e.target,r=(0,o.Z)({},h);eh()(r,n.name,n.value);var a=ek(r),i=a.rruleString,l=a.rruleText;f((0,o.Z)({},r)),s((0,o.Z)({},r)),t("frequency",i),t("frequencyDescription",l)},[h,s,t]);return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)("form",{id:"Form",style:{marginTop:"10px"},children:[(0,i.jsxs)(v.Z,{direction:"row",columnGap:2,children:[(0,i.jsx)(B.Qr,{name:"start.onDate.date",control:g,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.M,{minDate:u()().subtract(1,"day").startOf("day").toDate(),value:n,inputFormat:"DD/MM/YYYY",onChange:function(e){var n=u()(e).utc(!0).startOf("day");n.isValid()&&(_({target:{name:"start.onDate.date",value:n.toDate()}}),t(n.toDate()),a(function(e){return(0,r.Z)((0,o.Z)({},e),{scheduleStart:n.toDate()})}))},label:"Start date",renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{sx:{width:"100%"},color:"secondary",error:!I,helperText:!I&&"Start date should be later than today"}))}})}}),(0,i.jsx)(B.Qr,{name:"end.onDate.date",control:g,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.M,{minDate:C,value:n,inputFormat:"DD/MM/YYYY",onChange:function(e){var n=u()(e).utc(!0).startOf("day");n.isValid()&&(_({target:{name:"end.onDate.date",value:n.toDate()}}),t(n.toDate()),a(function(e){return(0,r.Z)((0,o.Z)({},e),{scheduleEnd:n.toDate()})}))},label:"End date",renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{sx:{width:"100%"},color:"secondary",error:!S,helperText:!S&&"End date should be later than Start date"}))}})}})]}),h&&(0,i.jsx)(np,{data:h,defaultOptions:{control:g,errors:b,register:y,watch:j},handleChange:_,watch:j})]})})};nv.propTypes={defaultOptions:J.object.isRequired,setValueParent:J.func.isRequired,watchParent:J.func.isRequired};var nf=t(69474),nx=function(e){var n=e.postCode,t=e.country,o=nf.O.get(t),r=(null==n?void 0:n.match(o))||"";return{area:r[1],district:r&&r.length>2?r[2]:""}},ng=function(e){var n,t,i,s,u=e.watchLocation,p=e.watchAssetsCategory,m=e.watchService,h=(0,l.useState)(""),v=h[0],f=h[1],x=(0,l.useState)(""),g=x[0],b=x[1],y=(0,l.useState)(""),j=y[0],Z=y[1],w=(0,l.useState)(""),C=w[0],I=w[1],S=(0,l.useState)(""),_=S[0],P=S[1],q=(0,l.useState)(""),k=q[0],D=q[1],T=(0,l.useState)(""),O=T[0],M=T[1],F=(0,l.useState)(""),A=F[0],E=F[1],R=(0,l.useState)(""),$=R[0],N=R[1],W=(0,a.Z)((0,d.t)(U._d,{variables:{where:{status:{_eq:"active"},name:{_ilike:""!==v?"%".concat(v,"%"):null}},limit:50,offset:0}}),2),L=W[0],J=W[1],Y=J.loading,B=J.data,H=(void 0===B?{items:[]}:B).items,V=(0,c.a)(z.Oh,{skip:!(null==u?void 0:u.value),variables:{locationId:null==u?void 0:u.value}}).data,G=(void 0===V?{account:[]}:V).account,Q=(0,a.Z)((0,d.t)(U.zR,{variables:{locationId:null==u?void 0:u.value,q:""!==g?"%".concat(g,"%"):null,limit:50,offset:0}}),2),K=Q[0],X=Q[1],ee=X.loading,en=X.data,et=(void 0===en?{items:[]}:en).items,eo=(0,a.Z)((0,d.t)(U.UM,{variables:{q:""!==j?"%".concat(j,"%"):null,limit:50,offset:0}}),2),er=eo[0],ea=eo[1],ei=ea.loading,el=ea.data,es=(void 0===el?{items:[]}:el).items,eu=(0,a.Z)((0,d.t)(U.UH,{variables:{locationId:null==u?void 0:u.value,categoryId:null==p?void 0:p.value,q:""!==C?"%".concat(C,"%"):null,limit:50,offset:0}}),2),ec=eu[0],ed=eu[1],ep=ed.loading,em=ed.data,eh=(void 0===em?{items:[]}:em).items,ev=(0,a.Z)((0,d.t)(U._f,{variables:{where:{type:{_eq:"jobTags"},status:{_eq:"active"},name:{_ilike:""!==_?"%".concat(_,"%"):null}},limit:50,offset:0,orderBy:{name:"asc"},includeMeta:!0}}),2),ef=ev[0],ex=ev[1],eg=ex.loading,eb=ex.data,ey=(void 0===eb?{items:[]}:eb).items,ej=(0,a.Z)((0,d.t)(U._f,{variables:{where:{type:{_eq:"costCategory"},status:{_eq:"active"},name:{_ilike:""!==k?"%".concat(k,"%"):null}},limit:50,offset:0,orderBy:{name:"asc"}}}),2),eZ=ej[0],ew=ej[1],eC=ew.loading,eI=ew.data,eS=(void 0===eI?{items:[]}:eI).items,e_=(0,a.Z)((0,d.t)(U.kx,{variables:{q:""!==O?"%".concat(O,"%"):null,limit:50,offset:0}}),2),eP=e_[0],eq=e_[1],ek=eq.loading,eD=eq.data,eT=(void 0===eD?{items:[]}:eD).items,eO=(0,a.Z)((0,d.t)(U.Oq,{variables:{locationId:null==u?void 0:u.value,q:""!==$?"%".concat($,"%"):null,limit:50,offset:0}}),2),eM=eO[0],eF=eO[1],eA=eF.loading,eE=eF.data,eR=(void 0===eE?{items:[]}:eE).items,e$=(0,c.a)(U.nP,{skip:!(null==u?void 0:u.value),variables:{id:null==u?void 0:u.value}}).data,eN=(void 0===e$?{item:{}}:e$).item,eW=null==eN?void 0:null===(n=eN.registeredAddress)||void 0===n?void 0:n[0],eL=nx({postCode:null==eW?void 0:null===(t=eW.address)||void 0===t?void 0:t.postCode,country:null==eW?void 0:null===(i=eW.address)||void 0===i?void 0:null===(s=i.country)||void 0===s?void 0:s.code}),eJ=(0,a.Z)((0,d.t)(U.by,{variables:{where:{type:{_eq:"supplier"},status:{_eq:"active"},PostcodeAreas:{PostcodeArea:{area:{_eq:null==eL?void 0:eL.area}},entity:{_eq:"Account"},status:{_eq:"active"}},ServiceSchedule:{status:{_eq:"active"},serviceId:{_eq:null==m?void 0:m.value},entity:{_eq:"Supplier"},PostcodeAreas:{PostcodeArea:{area:{_eq:null==eL?void 0:eL.area}}}},name:{_ilike:""!==A?"%".concat(A,"%"):null}},limit:50,offset:0}}),2),eY=eJ[0],eB=eJ[1],eH=eB.loading,eV=eB.data,eG=(void 0===eV?{items:[]}:eV).items;return{locationsProps:{onOpen:L,loading:Y,options:H,setSearch:f},sublocationsProps:{onOpen:K,loading:ee,options:et,setSearch:b},assetsCategoryProps:{onOpen:er,loading:ei,options:es,setSearch:Z},assetsProps:{onOpen:ec,loading:ep,options:eh.map(function(e){return(0,r.Z)((0,o.Z)({},e),{label:"".concat(e.label," ").concat(e.sublocation?"- ".concat(e.sublocation.name):"")})}),setSearch:I},shortDescriptionProps:{onOpen:ef,loading:eg,options:ey,setSearch:P},costCategoryProps:{onOpen:eZ,loading:eC,options:eS,setSearch:D},servicesProps:{onOpen:eP,loading:ek,options:eT,setSearch:M},supplierProps:{onOpen:eY,loading:eH,options:eG,setSearch:E},compliancesProps:{onOpen:eM,loading:eA,options:eR,setSearch:N},customer:null==G?void 0:G[0]}},nb=function(e,n,t){var o=ev.ZP.fromString(e.replace(/[\s\n]/gm,"\n")),r=o.origOptions,a=r.freq,i=r.until,l=r.dtstart,s=u()(l),c=o.all();t&&(s.day()===ne.Saturday||s.day()===ne.Sunday)&&s.add(s.day()===ne.Saturday?2:1,"day");var d=1===u()(l).date(),p=s.isSame(l,"month");if(a===ev.Di.MONTHLY&&n&&!d&&p){var m=i?(0,W.Z)(c):c.slice(0,-1);return m.unshift(s),m}return a===ev.Di.YEARLY&&n?c.map(function(e,n){var o=u()(e);return n>0&&o.startOf("month"),t&&(o.day()===ne.Saturday||o.day()===ne.Sunday)&&o.add(o.day()===ne.Saturday?2:1,"day"),o}):c},ny=function(e){var n,t,o,r,a,i,l,s,u=null==e?void 0:null===(n=e.repeat)||void 0===n?void 0:null===(t=n.frequency)||void 0===t?void 0:null===(o=t.toLocaleLowerCase)||void 0===o?void 0:o.call(t);return{isAnyTime:(null==e?void 0:null===(r=e.repeat)||void 0===r?void 0:null===(a=r[u])||void 0===a?void 0:a.mode)==="anyTimeOption",excludingWeekends:null==e?void 0:null===(i=e.repeat)||void 0===i?void 0:null===(l=i[u])||void 0===l?void 0:l.excludingWeekends}},nj=t(54610),nZ=function(e){var n,t=e.oldData,o=e.data;if(!t.jobs.length)return{isConfirm:!1,isSupplierChanged:!1,isDatesChanged:!1};var r=nw(t.dates,o.dates)||t.frequency!==o.frequency,a=o.meta.supplierId!==(null===(n=t.meta)||void 0===n?void 0:n.supplierId);return a||r?{isConfirm:!0,isSupplierChanged:a,isDatesChanged:r}:{isConfirm:!1,isSupplierChanged:!1,isDatesChanged:!1}},nw=function(e,n){return Array.isArray(e)?!(e.length===n.length&&n.every(function(n,t){var o=n.date,r=n.selected;return e[t].selected===r&&u()(e[t].date).isSame(o)})):!n.every(function(e){return e.selected})},nC=t(67797),nI=t(90948),nS=t(22927),n_=g.Z,nP=function(e){var n=e.onClose,t=e.onConfirm,o=(0,es.Z)("(max-width:600px)");return(0,i.jsx)(nq,{is600pxOrLess:o,children:(0,i.jsxs)(v.Z,{spacing:2,alignItems:"center",width:"100%",children:[(0,i.jsx)(nS.Z,{color:"error",sx:{fontSize:32}}),(0,i.jsx)(f.Z,{variant:"h6",textAlign:"center",fontWeight:700,children:"Do you confirm to change frequency?"}),(0,i.jsx)(f.Z,{textAlign:"center",children:"Please note that all work orders with a check mark from the top table titled ‘Select jobs for cancellation’ will be cancelled and new jobs created as per the schedule in the bottom table."}),(0,i.jsxs)(v.Z,{direction:"row",justifyContent:"center",width:"100%",spacing:2,children:[(0,i.jsx)(n_,{variant:"outlined",color:"black",onClick:n,children:"Cancel"}),(0,i.jsx)(n_,{variant:"contained",color:"secondary",onClick:function(){n(),t()},children:"Confirm"})]})]})})};nP.propTypes={onClose:Y().func.isRequired,onConfirm:Y().func.isRequired},nP.defaultProps={onClose:function(){},onConfirm:function(){}};var nq=(0,nI.ZP)(Q.Z)(function(e){return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"500px",height:e.is600pxOrLess?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:"8px",overflowY:"auto"}}),nk=t(83704),nD=t.n(nk),nT=t(91830),nO=t(96486),nM=t(11961),nF=t(93362),nA=t(78462),nE=t(18972),nR=t(14564),n$=t(10166),nN=t(22428),nW=t(16380),nL=t(71403),nJ=x.Z,nY=(0,nF.D)(),nB=function(e){var n=e.entityId,t=e.entity,s=e.values,u=void 0===s?[]:s,d=e.name,m=void 0===d?"tags":d,f=e.setValue,x=e.followingEntity,g=e.followingEntityIds,b=void 0===g?[]:g,j=(0,ee.x)().user,Z=(0,l.useState)(null),w=Z[0],C=Z[1],I=(0,l.useState)(""),S=I[0],_=I[1],P=(0,l.useState)(""),q=P[0],k=P[1],D=(0,l.useState)(""),M=D[0],F=D[1],A=(0,c.a)(nW.BU,{skip:!n,variables:{entityId:n,entity:t},onCompleted:function(e){f(m,e.tags)}}),E=A.data,R=(void 0===E?{tags:[]}:E).tags,$=A.loading,J=(0,c.a)(nW.gI,{skip:!w,variables:{entityId:n,entity:t,q:""!==M?"%".concat(M,"%"):null}}),Y=J.data,B=(void 0===Y?{tags:[]}:Y).tags,H=J.loading,V=(0,a.Z)((0,p.D)(nW.Zm,{refetchQueries:["GetAllTags"]}),2),G=V[0],Q=V[1].loading,z=(0,a.Z)((0,p.D)(nW.C3,{refetchQueries:["GetEntityTags"]}),2),U=z[0],K=z[1].loading,X=(0,a.Z)((0,p.D)(nW.cS,{refetchQueries:["GetEntityTags"]}),2),en=X[0],et=X[1].loading,eo=(0,a.Z)((0,p.D)(nW.Aw),1)[0],er=(0,a.Z)((0,p.D)(nW.g$,{refetchQueries:["GetAllTags"]}),2),ea=er[0],ei=er[1].loading;(0,l.useEffect)(function(){var e=setTimeout(function(){F(q)},500);return function(){return clearTimeout(e)}},[q]);var el,es,eu,ec,ed=function(e){e.stopPropagation(),C(e.currentTarget)},ep=function(){C(null)},em=(el=(0,N.Z)(function(e,o){var r,i,l,s,c,d,p,h;return(0,L.__generator)(this,function(e){switch(e.label){case 0:if("string"!=typeof o)return[3,1];return _({label:o}),[3,7];case 1:if(!(o&&o.inputValue&&n))return[3,3];return[4,U({variables:{objects:[{entity:t,entityId:n,Taxonomy:{data:{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:j.adminId}}}]}})];case 2:return l=e.sent().data.insert_Taxonomy_Entity,c=(0,a.Z)(l.returning,1)[0].taxonomyId,b.length>0&&U({variables:{objects:b.map(function(e){return{entity:x,entityId:e,taxonomyId:c}})}}),_(null),[3,7];case 3:if(!(o&&o.value&&n))return[3,4];return U({variables:{objects:[{entity:t,entityId:n,taxonomyId:o.value}].concat((0,W.Z)(b.map(function(e){return{entity:x,entityId:e,taxonomyId:o.value}})))}}),_(null),[3,7];case 4:if(!(o&&o.inputValue))return[3,6];return[4,G({variables:{objects:[{type:"tags",status:"active",name:o.inputValue,meta:{color:"#0679d8"},isGroup:!1,adminId:j.adminId}]}})];case 5:return h=e.sent().data.insert_Taxonomy,f(m,(0,W.Z)(u).concat([{id:null,tag:{id:h.returning[0].id,name:h.returning[0].name,meta:h.returning[0].meta}}])),_(null),[3,7];case 6:o&&o.value&&(f(m,(0,W.Z)(u).concat([{id:null,tag:{id:o.value,name:o.label,meta:o.meta}}])),_(null)),e.label=7;case 7:return[2]}})}),function(e,n){return el.apply(this,arguments)}),eh=(0,l.useCallback)(function(e,n){var t=nY(e,n),o=n.inputValue,r=e.some(function(e){return o===e.label});return""===o||r||t.push({inputValue:o,label:'Add "'.concat(o,'"')}),t},[]),ev=(0,l.useCallback)(function(e){return"string"==typeof e?e:e.inputValue?e.inputValue:e.label},[]),ef=(es=(0,N.Z)(function(e){var t,o,r,a;return(0,L.__generator)(this,function(t){switch(t.label){case 0:if(!n)return[3,2];return[4,en({variables:{tagEntityId:e}})];case 1:return r=t.sent().data.delete_Taxonomy_Entity_by_pk.taxonomyId,b.length>0&&eo({variables:{where:{taxonomyId:{_eq:r},entity:{_eq:x},entityId:{_in:b}}}}),[3,3];case 2:f(m,u.filter(function(n,t){return t!==e})),t.label=3;case 3:return[2]}})}),function(e){return es.apply(this,arguments)}),ex=(eu=(0,N.Z)(function(e){var n,t,a,i,l,s;return(0,L.__generator)(this,function(t){switch(t.label){case 0:return[4,ea({variables:{tagId:n=e.tagId,object:{meta:{color:e.color}}}})];case 1:return l=t.sent().data.update_Taxonomy_by_pk,f(m,u.map(function(e){return e.tag.id===n?(0,r.Z)((0,o.Z)({},e),{tag:(0,o.Z)({},l)}):e})),[2]}})}),function(e){return eu.apply(this,arguments)}),eg=(ec=(0,N.Z)(function(e){var n,t,a,i,l,s;return(0,L.__generator)(this,function(a){switch(a.label){case 0:return[4,ea({variables:{tagId:n=e.tagId,object:{name:t=e.name}}})];case 1:return l=a.sent().data.update_Taxonomy_by_pk,f(t,u.map(function(e){return e.tag.id===n?(0,r.Z)((0,o.Z)({},e),{tag:(0,o.Z)({},l)}):e})),[2]}})}),function(e){return ec.apply(this,arguments)}),eb=Boolean(w),ey=(0,l.useMemo)(function(){return B.map(function(e){return{label:e.name,value:e.id,meta:e.meta}})},[B]),ej=(0,l.useMemo)(function(){return nO.uniqBy((0,W.Z)(R).concat((0,W.Z)(u)),function(e){var n;return null===(n=e.tag)||void 0===n?void 0:n.id})},[R,u]);return(0,i.jsxs)(v.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(nL.P,{tags:ej,handleDeleteTagEntity:ef}),(0,i.jsx)(nH,{id:eb?"tags-popover":void 0,open:eb,anchorEl:w,onClose:ep,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,i.jsxs)(h.Z,{sx:{maxHeight:"80vh",width:"280px",p:"10px",pt:"5px"},children:[(0,i.jsx)(T.Z,{freeSolo:!0,selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:(0,W.Z)(ey),value:S,onChange:em,onInputChange:function(e,n){k(n)},filterOptions:eh,getOptionLabel:ev,renderOption:function(e,n){return(0,i.jsx)(nE.Z,(0,r.Z)((0,o.Z)({},e),{children:n.label}))},renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{variant:"standard",color:"secondary",label:"Search tag",InputProps:(0,r.Z)((0,o.Z)({},e.InputProps),{endAdornment:(0,i.jsxs)(i.Fragment,{children:[H||Q||K?(0,i.jsx)(y.Z,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})})}))},sx:{pl:"16px",pr:"16px"}}),$||et||ei?(0,i.jsx)(v.Z,{width:"100%",alignItems:"center",p:4,children:(0,i.jsx)(y.Z,{color:"secondary"})}):(0,i.jsx)(nA.Z,{children:null==ej?void 0:ej.map(function(e,n){var t;return(0,i.jsx)(nN.T,{tagEntityId:e.id||n,tagId:e.tag.id,name:e.tag.name,color:null===(t=e.tag.meta)||void 0===t?void 0:t.color,onDelete:ef,onColorChange:ex,onNameChange:eg})})})]})}),(0,i.jsx)(nJ,{color:"black",onClick:ed,children:(0,i.jsx)(nM.Z,{sx:{height:"16px",width:"16px"}})})]})};nB.defaultProps={entityId:null},nB.propTypes={entityId:Y().number,entity:Y().string.isRequired,values:Y().array,name:Y().string,setValue:Y().func.isRequired,followingEntity:Y().string,followingEntityIds:Y().array};var nH=(0,n$.Z)(nR.ZP)({"& .MuiPaper-root":{borderRadius:"12px"}}),nV=t(1691),nG=t(48795),nQ=t(53767),nz=t(59505),nU=t(26730),nK=t(44510),nX=function(e){return Array.isArray(e)?e.map(function(e,n){return{id:n,date:u()(e.date).utc(),selected:e.selected}}):[]},n0=t(21023);nD()(u());var n1={accordion:function(e){return{backgroundColor:"transparent",border:"1px solid ".concat(e?"#36CF57":"#9E9E9E")}},multilineTextField:{width:"100%",minHeight:"150px",textarea:{minHeight:"150px"}},adornment:{borderRadius:"50%",backgroundColor:"#9E9E9E",color:"#fff",padding:"0 7px",marginRight:"20px"},groupedSelector:{slotProps:{popper:{sx:{"& .MuiAutocomplete-groupLabel":{height:"30px",lineHeight:"30px",backgroundColor:"#f5f5f5",fontWeight:700}}}}},accordionTables:{backgroundColor:"transparent",borderWidth:"1px",borderStyle:"solid",borderColor:"secondary.main"}},n2=function(e){var n,t,s,d,m,x=e.jobScheduleId,j=e.locationId,Z=e.locationName,w=e.edit,C=e.onClose,I=(0,nQ.q)(),S=null===(n=I.admin.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,_=null===(t=I.admin.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,P=(0,l.useRef)(!0),q=(0,eo.D)(),D=(0,a.Z)((0,nC.d)(),2),T=D[0],M=D[1],F=(0,ee.x)(),E=F.hasRole,R=F.user,$=(0,l.useState)("onCompletion"),N=$[0],L=$[1],J=(0,l.useState)(!1),Y=J[0],Q=J[1],U=(0,es.Z)("(max-width: 600px)"),X=(0,B.cI)({resolver:(0,H.S)(et.$g),defaultValues:(0,r.Z)((0,o.Z)({},n5,j&&{location:{value:j,label:Z}}),{estimatedDuration:u().duration(54e5,"milliseconds").as("minutes"),estimatedDurationUnit:"minutes",firstInvoiceDate:"fixedMonthlyAmount"===N?new Date:null})}),er=X.control,ea=X.watch,em=X.register,eh=X.setValue,ev=X.handleSubmit,ef=X.errors,ex=X.reset,eg=ea("location"),eb=ea("compliance"),ey=ea("assetCategory"),ej=ea("tags"),eZ=ea("frequency"),ew=ea("service"),eC=ea("firstInvoiceDate"),eI=ea("finalInvoiceDate"),eS=ea(),e_=ng({watchLocation:eg,watchAssetsCategory:ey,watchService:ew}),eP=e_.locationsProps,eq=e_.assetsCategoryProps,ek=e_.assetsProps,eD=e_.shortDescriptionProps,eT=e_.servicesProps,eO=e_.sublocationsProps,eM=e_.costCategoryProps,eF=e_.supplierProps,eA=e_.compliancesProps,eE=e_.customer,eR=(0,l.useState)([]),e$=eR[0],eN=eR[1],eW=(0,l.useState)({scheduleStart:null,scheduleEnd:null}),eL=eW[0],eJ=eW[1],eY=(0,l.useState)(null),eB=eY[0],eH=eY[1],eV=(0,l.useState)([]),eG=eV[0],eQ=eV[1],ez=(0,l.useState)({reportPassFail:!1,reportPassFailTitle:null,requireReportRecommendations:!1}),eU=ez[0],eK=ez[1],eX=(0,l.useState)(!1),e0=eX[0],e1=eX[1],e2=(0,l.useState)(!1),e5=e2[0],e3=e2[1],e6=(0,l.useState)([]),e4=e6[0],e9=e6[1],e7=ny(eB),e8=e7.isAnyTime,ne=e7.excludingWeekends,nn=(0,c.a)(z.EW,{skip:!x,variables:{jobScheduleId:x},onCompleted:function(e){var n,t=e.jobSchedule,r=(0,nj.Z7)({jobSchedule:t});ex((0,o.Z)({},r)),eH(null===(n=t.meta)||void 0===n?void 0:n.rruleMeta),L(t.invoiceBasis),eQ(nX(t.dates))}}),nt=nn.data,no=(void 0===nt?{jobSchedule:{}}:nt).jobSchedule,nr=nn.loading;(0,c.a)(z.JV,{variables:{jobScheduleId:x},onCompleted:function(e){var n;e9(Array.isArray(n=e.jobs)?n.map(function(e){return(0,r.Z)((0,o.Z)({},e),{selected:!1})}):[])}});var na=(0,a.Z)((0,p.D)(z.a7,{refetchQueries:["GetJobSchedules"],onCompleted:function(){q.show({content:"Job schedule was added.",severity:"success"}),C()},onError:function(e){q.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),ni=na[0],nl=na[1].loading,ns=(0,a.Z)((0,p.D)(z.Us,{refetchQueries:["GetJobSchedules"],onCompleted:function(){q.show({content:"Job schedule was updated.",severity:"success"}),C()},onError:function(e){q.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),nu=ns[0],nc=ns[1].loading;(0,l.useEffect)(function(){var e,n=(e={location:null==eS?void 0:eS.location,shortDescription:null==eS?void 0:eS.shortDescription,description:null==eS?void 0:eS.description,estimatedDuration:null==eS?void 0:eS.estimatedDuration,estimatedDurationUnit:null==eS?void 0:eS.estimatedDurationUnit,costCategory:null==eS?void 0:eS.costCategory,service:null==eS?void 0:eS.service,supplier:null==eS?void 0:eS.supplier,frequency:null==eS?void 0:eS.frequency,frequencyDescription:null==eS?void 0:eS.frequencyDescription,costCustomer:null==eS?void 0:eS.costCustomer,costSupplier:null==eS?void 0:eS.costSupplier,customerMonthlyCharge:null==eS?void 0:eS.customerMonthlyCharge,supplierMonthlyCharge:null==eS?void 0:eS.supplierMonthlyCharge,firstInvoiceDate:null==eS?void 0:eS.firstInvoiceDate,finalInvoiceDate:null==eS?void 0:eS.finalInvoiceDate,invoicingBasis:N},A.map(function(n){return Object.entries(e).filter(function(t){var o=(0,a.Z)(t,2),r=o[0],i=o[1];return n.requiredFields(e).includes(r)&&!!i}).length===n.requiredFields(e).length?n.value:null}).filter(Boolean));eN(n)},[N,null==eS?void 0:eS.costCategory,null==eS?void 0:eS.costCustomer,null==eS?void 0:eS.costSupplier,null==eS?void 0:eS.customerMonthlyCharge,null==eS?void 0:eS.description,null==eS?void 0:eS.estimatedDuration,null==eS?void 0:eS.estimatedDurationUnit,null==eS?void 0:eS.finalInvoiceDate,null==eS?void 0:eS.firstInvoiceDate,null==eS?void 0:eS.frequency,null==eS?void 0:eS.frequencyDescription,null==eS?void 0:eS.location,null==eS?void 0:eS.service,null==eS?void 0:eS.shortDescription,null==eS?void 0:eS.supplier,null==eS?void 0:eS.supplierMonthlyCharge]),(0,l.useEffect)(function(){if(eZ){if(Array.isArray(null==no?void 0:no.dates)&&P.current){P.current=!1;return}var e=nb(eZ,e8,ne),n=nX(e.slice(0,355).map(function(e){return{date:e,selected:!0}}));eQ(n)}},[eZ,ne,e8,no.frequency,null==no?void 0:no.dates]);var nd=function(e){if(!Y){var n=(0,nj.NS)({form:(0,r.Z)((0,o.Z)({},e),{invoicingType:N}),rruleMeta:eB,dates:eG,jobScheduleId:null,reportPassFailFeature:eU,customerSignature:e0,supplierSignature:e5,startEndDates:eL,adminId:R.adminId,customerId:eE.id});ni({variables:{objects:[n]}})}},np=function(e){var n=(0,nj.y4)({form:(0,r.Z)((0,o.Z)({},e),{invoicingType:N}),rruleMeta:eB,dates:eG,reportPassFailFeature:eU,customerSignature:e0,supplierSignature:e5,startEndDates:eL,canceledJobs:e4.reduce(function(e,n){return n.selected?(0,W.Z)(e).concat([n.id]):e},[])});nZ({oldData:no,data:n}).isConfirm?M({content:function(e){var t=e.onClose;return(0,i.jsx)(nP,{onClose:t,onConfirm:function(){nu({variables:{data:(0,r.Z)((0,o.Z)({},n),{id:x})}})}})}}):nu({variables:{data:(0,r.Z)((0,o.Z)({},n),{id:x})}})},nm=function(e){eQ(function(n){return n.map(function(n,t){return e.includes(t)?(0,r.Z)((0,o.Z)({},n),{selected:!0}):(0,r.Z)((0,o.Z)({},n),{selected:!1})})})},nh=function(e,n){eQ(function(t){return t.map(function(t){return t.id===e?(0,r.Z)((0,o.Z)({},t),{date:u()(n).startOf("month")}):t})})},nf=function(e){return function(){L(e)}},nx=function(e){var n;if("object"==typeof(null==e?void 0:null===(n=e.meta)||void 0===n?void 0:n.template)){var t=e.meta.template,o=t.description,r=t.costCategorySelected,a=t.serviceSelected,i=t.amount,l=t.supplierLabourAmount,s=t.tags,u=t.reportPassFail,c=t.reportPassFailTitle,d=t.requireReportRecommendations,p=t.customerSignature,m=t.supplierSignature;eh("description",o),r&&eh("costCategory",{value:r.value,label:r.label}),a&&eh("service",{value:a.value,label:a.label}),"onCompletion"===N&&(i&&eh("costCustomer",i),l&&eh("costSupplier",l)),(null==s?void 0:s.length)>0&&!w&&eh("tags",s),eK({reportPassFail:Boolean(u),reportPassFailTitle:c||null,requireReportRecommendations:Boolean(d)}),e1(Boolean(p)),e3(Boolean(m))}},nw=(0,l.useMemo)(function(){return[{minWidth:80,field:"id",headerName:"Job id",sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsx)(nG.D,{id:n.id,number:n.number,openCanvas:!0,type:n.type,numberPrefix:S,numberSuffix:_})}},{minWidth:120,flex:1,field:"status",headerName:"Job status",sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsx)(nz.B,{value:n.status})}},{minWidth:140,flex:1,field:"timingStart",headerName:"Scheduled start",sortable:!1,renderCell:function(e){var n=e.row;return u()(n.timingStart).format("DD-MM-YYYY HH:mm")}},{minWidth:140,flex:1,field:"timingEnd",headerName:"Scheduled end",sortable:!1,renderCell:function(e){var n=e.row;return u()(n.timingEnd).format("DD-MM-YYYY HH:mm")}},{minWidth:110,flex:1,field:"supplier",headerName:"Supplier",sortable:!1,renderCell:function(e){var n=e.row;return n.supplier?(0,i.jsx)(k.r,{href:"/dashboard/suppliers/view?id=".concat(n.supplier.id),color:"secondary",children:n.supplier.name}):(0,i.jsx)(v.Z,{children:n.supplierOffers.map(function(e){return(0,i.jsx)(k.r,{href:"/dashboard/suppliers/view?id=".concat(e.supplier.id),color:"secondary",children:e.supplier.name})})})}}]},[S,_]),nI=(0,l.useMemo)(function(){return eG.reduce(function(e,n){return n.selected?(0,W.Z)(e).concat([n.id]):e},[])},[eG]),n_=function(e){e9(function(n){return n.map(function(n){return e.includes(n.id)?(0,r.Z)((0,o.Z)({},n),{selected:!0}):(0,r.Z)((0,o.Z)({},n),{selected:!1})})})},nq=(0,l.useMemo)(function(){return e4.reduce(function(e,n){return n.selected?(0,W.Z)(e).concat([n.id]):e},[])},[e4]),nk=(0,l.useMemo)(function(){return[{minWidth:80,flex:1,field:"id",headerName:"Id",sortable:!1,renderCell:function(e){return e.row.id+1}},{minWidth:80,flex:1,field:"weekDay",headerName:"Day of week",sortable:!1,renderCell:function(e){var n=e.row;return u()(n.date).format("ddd")}},{minWidth:80,flex:1,field:"day",headerName:"Day of month",sortable:!1,renderCell:function(e){var n=e.row;return u()(n.date).format("DD")}},{minWidth:110,flex:1,field:"month",headerName:"Month",sortable:!1,renderCell:function(e){var n,t=e.row;return e8&&(null==eB?void 0:null===(n=eB.repeat)||void 0===n?void 0:n.frequency)==="Yearly"?(0,i.jsx)(ed.M,{minDate:eL.scheduleStart,maxDate:eL.scheduleEnd,views:["month"],label:"Month",inputFormat:"MMM",value:t.date,onChange:function(e){return nh(t.id,e)},renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{color:"secondary",variant:"outlined"}))}}):u()(t.date).format("MMM")}},{minWidth:80,flex:1,field:"year",headerName:"Year",sortable:!1,renderCell:function(e){var n=e.row;return u()(n.date).format("YYYY")}}]},[e8,null==eB?void 0:null===(s=eB.repeat)||void 0===s?void 0:s.frequency,eL.scheduleEnd,eL.scheduleStart]),nD=function(e){var n=e.step;return e$.includes(n)||w?(0,i.jsx)(ei.Z,{sx:{color:"#36CF57",marginRight:"20px"}}):(0,i.jsx)(h.Z,{sx:n1.adornment,children:n})};return(0,i.jsxs)(i.Fragment,{children:[T,(0,i.jsx)(b.Z,{open:nr||nl||nc,sx:{zIndex:1e4},children:(0,i.jsx)(y.Z,{color:"secondary"})}),(0,i.jsxs)("form",{id:"addJobScheduleForm",onSubmit:ev(w?np:nd),children:[(0,i.jsxs)(G.ZP,{container:!0,columnSpacing:2,children:[(0,i.jsxs)(G.ZP,{item:!0,xs:12,md:6,children:[(0,i.jsx)(ep.s,{headerAdornment:function(){return(0,i.jsx)(nD,{step:1})},title:"Set location",accordionSummarySx:n1.accordion(e$.includes(1)||w),children:(0,i.jsxs)(v.Z,{direction:"row",width:"100%",flexWrap:"wrap",rowGap:2,columnGap:2,mt:2,children:[(0,i.jsx)(B.Qr,{name:"location",control:er,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({fullWidth:!0,disabled:w||j,sx:n1.selector,value:n},eP),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Location",error:null==ef?void 0:ef.location}}))}}),(0,i.jsx)(B.Qr,{name:"sublocation",control:er,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({fullWidth:!0,value:n,sx:n1.selector,disabled:!(null==eg?void 0:eg.value)},eO),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Sublocation"}}))}}),(0,i.jsx)(B.Qr,{name:"assetCategory",control:er,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({fullWidth:!0,value:n,sx:n1.selector},eq),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Asset category"}}))}}),(0,i.jsx)(B.Qr,{name:"assets",control:er,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({fullWidth:!0,multiple:!0,value:n,sx:n1.selector,disabled:!(null==ey?void 0:ey.value)},ek),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Asset information"}}))}})]})}),(0,i.jsx)(ep.s,{headerAdornment:function(){return(0,i.jsx)(nD,{step:2})},title:"Work description",accordionSummarySx:n1.accordion(e$.includes(2)||w),children:(0,i.jsxs)(v.Z,{direction:"row",alignItems:"center",flexWrap:"wrap",columnGap:2,rowGap:2,mt:2,children:[(0,i.jsx)(B.Qr,{name:"shortDescription",control:er,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({fullWidth:!0,value:n,sx:n1.selector,onChange:function(e,n){t(n),nx(n)}},eD),{textFieldProps:{color:"secondary",label:"Short job description",error:null==ef?void 0:ef.shortDescription}}))}}),(0,i.jsx)(O.Z,{fullWidth:!0,color:"secondary",inputRef:em,name:"reference",sx:n1.textField,placeholder:"Customer reference"}),(0,i.jsx)(O.Z,{fullWidth:!0,multiline:!0,color:"secondary",inputRef:em,name:"description",sx:n1.multilineTextField,error:null==ef?void 0:ef.description,placeholder:"Work description"}),(0,i.jsx)(O.Z,{type:"number",color:"secondary",inputRef:em,name:"estimatedDuration",placeholder:"Estimated duration",error:null==ef?void 0:ef.estimatedDuration,sx:{width:"40%"}}),(0,i.jsx)(B.Qr,{name:"estimatedDurationUnit",control:er,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(nT.P,{formControl:{fullWidth:!0,variant:"outlined",color:"secondary",error:ef.estimatedDurationUnit,sx:{width:"calc(60% - 16px)"}},selectProps:{fullWidth:!0},label:"Duration unit",value:n,onChange:t,options:[{label:"Hours",value:"hours"},{label:"Minutes",value:"minutes"},{label:"Days",value:"days"}]})}}),(0,i.jsx)(B.Qr,{control:er,name:"compliance",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(el.Z,{label:"Compliance",sx:{width:"100%"},control:(0,i.jsx)(V.Z,{checked:n,color:"secondary",onChange:function(e){var n;return t(null===(n=e.target)||void 0===n?void 0:n.checked)}})})}}),eb&&(null==eg?void 0:eg.value)&&(0,i.jsx)(B.Qr,{control:er,name:"complianceSelect",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({fullWidth:!0,value:n},eA,n1.groupedSelector),{groupBy:function(e){return e.category.label},onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Compliance",error:null==ef?void 0:ef.complianceSelect}}))}}),E("admin")&&(0,i.jsxs)(v.Z,{direction:"row",alignItems:"center",children:[(0,i.jsx)(f.Z,{mr:1,children:"Tags: "}),(0,i.jsx)(nB,{values:ej,setValue:eh,name:"tags",entity:"JobSchedule",entityId:x,followingEntity:"Job",followingEntityIds:null===(d=no.jobs)||void 0===d?void 0:d.map(function(e){return e.id})})]})]})}),(0,i.jsx)(ep.s,{headerAdornment:function(){return(0,i.jsx)(nD,{step:3})},title:"Select service",accordionSummarySx:n1.accordion(e$.includes(3)||w),children:(0,i.jsxs)(v.Z,{direction:"row",width:"100%",flexWrap:"wrap",rowGap:2,columnGap:2,mt:2,children:[(0,i.jsx)(B.Qr,{name:"costCategory",control:er,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({fullWidth:!0,value:n,sx:n1.selector},eM),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Cost category",error:null==ef?void 0:ef.costCategory}}))}}),(0,i.jsx)(B.Qr,{fullWidth:!0,name:"service",control:er,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({fullWidth:!0,value:n,sx:n1.selector},eT),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Service",error:null==ef?void 0:ef.service}}))}}),(0,i.jsx)(B.Qr,{name:"supplier",control:er,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({fullWidth:!0,disabled:!(null==ew?void 0:ew.value)||!(null==eg?void 0:eg.value),value:n},eF),{onChange:function(e,n){return t(n)},textFieldProps:{color:"secondary",label:"Supplier",error:null==ef?void 0:ef.supplier}}))}})]})}),(0,i.jsx)(ep.s,{headerAdornment:function(){return(0,i.jsx)(nD,{step:4})},title:"Set schedule",accordionSummarySx:n1.accordion(e$.includes(4)||w),children:(0,i.jsxs)(v.Z,{rowGap:2,children:[(0,i.jsx)(nv,{disableStartEndValidation:w,setValueParent:eh,setRRuleMeta:eH,setOuterStartEndDates:eJ,setFrequencyError:Q,rruleMeta:null===(m=no.meta)||void 0===m?void 0:m.rruleMeta,frequency:null==no?void 0:no.frequency}),(0,i.jsx)(O.Z,{multiline:!0,color:"secondary",variant:"filled",inputRef:em,name:"frequencyDescription",label:"Frequency description",sx:n1.multilineTextField,InputProps:{readOnly:!0},InputLabelProps:{shrink:!0}})]})}),(0,i.jsxs)(ep.s,{headerAdornment:function(){return(0,i.jsx)(nD,{step:5})},title:"Invoicing",accordionSummarySx:n1.accordion(e$.includes(5)||w),children:[(0,i.jsxs)(v.Z,{direction:"row",children:[(0,i.jsx)(el.Z,{label:"On completion",control:(0,i.jsx)(ec.Z,{color:"secondary",checked:"onCompletion"===N,onChange:nf("onCompletion")})}),(0,i.jsx)(el.Z,{label:"Fixed monthly amount",control:(0,i.jsx)(ec.Z,{color:"secondary",checked:"fixedMonthlyAmount"===N,onChange:nf("fixedMonthlyAmount")})})]}),"onCompletion"===N&&(0,i.jsxs)(v.Z,{rowGap:2,mt:2,children:[(0,i.jsx)(O.Z,{inputRef:em,name:"costCustomer",color:"secondary",type:"number",label:"Customer cost per visit",inputProps:{min:0,step:.01},InputProps:{startAdornment:(0,i.jsx)(eu.Z,{position:"start",children:"\xa3"}),endAdornment:(0,i.jsx)(eu.Z,{position:"end",children:"Ex VAT"})}}),(0,i.jsx)(O.Z,{inputRef:em,name:"costSupplier",color:"secondary",type:"number",label:"Supplier cost per visit",inputProps:{min:0,step:.01},InputProps:{startAdornment:(0,i.jsx)(eu.Z,{position:"start",children:"\xa3"}),endAdornment:(0,i.jsx)(eu.Z,{position:"end",children:"Ex VAT"})}})]}),"fixedMonthlyAmount"===N&&(0,i.jsxs)(v.Z,{spacing:2,mt:2,width:"100%",children:[w&&((null==no?void 0:no.firstInvoiceDate)!==eC||(null==no?void 0:no.finalInvoiceDate)!==eI)&&(0,i.jsx)(nV.Z,{variant:"standard",severity:"info",color:"info",children:"Any changes to the monthly amount will be reflected only in future invoices."}),(0,i.jsxs)(v.Z,{direction:"row",width:"100%",spacing:1,children:[(0,i.jsx)(B.Qr,{name:"firstInvoiceDate",control:er,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.M,{views:["year","month"],value:n,onChange:t,minDate:new Date,label:"Month of first invoice",renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{sx:{width:"100%"},color:"secondary"}))}})}}),(0,i.jsx)(B.Qr,{name:"finalInvoiceDate",control:er,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.M,{views:["year","month"],value:n,onChange:t,minDate:new Date,label:"Month of final invoice",renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{sx:{width:"100%"},color:"secondary"}))}})}})]}),(0,i.jsx)(O.Z,{inputRef:em,name:"customerMonthlyCharge",color:"secondary",type:"number",label:"Monthly customer charge",inputProps:{min:0,step:.01},InputProps:{startAdornment:(0,i.jsx)(eu.Z,{position:"start",children:"\xa3"}),endAdornment:(0,i.jsx)(eu.Z,{position:"end",children:"Ex VAT"})}}),(0,i.jsx)(O.Z,{inputRef:em,name:"supplierMonthlyCharge",color:"secondary",type:"number",label:"Monthly supplier charge",inputProps:{min:0,step:.01},InputProps:{startAdornment:(0,i.jsx)(eu.Z,{position:"start",children:"\xa3"}),endAdornment:(0,i.jsx)(eu.Z,{position:"end",children:"Ex VAT"})}})]})]})]}),(0,i.jsxs)(G.ZP,{item:!0,xs:12,md:6,mt:U?3:0,children:[w&&(0,i.jsx)(ep.s,{headerAdornment:function(){return(0,i.jsx)(nK.Z,{sx:{color:"secondary.main",marginRight:"20px"}})},title:(0,i.jsxs)(v.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,i.jsx)(f.Z,{children:"Select jobs for cancellation"}),(0,i.jsx)(n0.Z,{title:"Work orders indicated below with a check mark\n                        will be cancelled upon creation of the new schedule.\n                        To keep any individual work orders please ensure\n                        the relevant check box is unticked.\n                        Please note that jobs that are already completed or closed\n                        cannot be cancelled.",children:(0,i.jsx)(nS.Z,{color:"secondary"})})]}),accordionSummarySx:n1.accordionTables,children:(0,i.jsx)(K.i,{autoHeight:!1,checkboxSelection:!0,disableRowSelectionOnClick:!0,columnHeaderHeight:35,rowHeight:55,columns:nw,rows:e4,onRowSelectionModelChange:n_,rowSelectionModel:nq,isRowSelectable:function(e){return!e.row.statusData.completed&&!e.row.statusData.closed},containerMaxHeight:"1000px"})}),(0,i.jsx)(ep.s,{headerAdornment:function(){return(0,i.jsx)(nU.Z,{sx:{color:"secondary.main",marginRight:"20px"}})},title:"Schedule jobs preview",accordionSummarySx:n1.accordionTables,children:(0,i.jsx)(K.i,{autoHeight:!1,checkboxSelection:!0,disableRowSelectionOnClick:!0,getRowClassName:function(e){return e.row.id%2==0?"even":"odd"},columnHeaderHeight:35,rowHeight:45,columns:nk,rows:eG,onRowSelectionModelChange:nm,rowSelectionModel:nI,containerMaxHeight:"1000px"})})]}),(0,i.jsx)(G.ZP,{item:!0,xs:12,children:(0,i.jsx)(g.Z,{sx:{width:"100px",marginTop:"20px"},color:"secondary",type:"submit",variant:"contained",children:w?"Save":"Add item"})})]}),(0,i.jsx)("input",(0,r.Z)((0,o.Z)({},em("tags")),{type:"hidden"})),(0,i.jsx)("input",(0,r.Z)((0,o.Z)({},em("frequency")),{type:"hidden"}))]})]})},n5={location:null,sublocation:null,frequency:null,frequencyDescription:"",reference:"",customerMonthlyCharge:null,supplierMonthlyCharge:null,firstInvoiceDate:null,finalInvoiceDate:null,estimatedDuration:null,estimatedDurationUnit:null,assetCategory:null,assets:[],costCategory:null,complianceSelect:null,compliance:!1,costCustomer:null,costSupplier:null,description:"",service:null,shortDescription:null,supplier:null,customerSignature:!1,supplierSignature:!1,reportPassFail:!1,reportPassFailTitle:null,requireReportRecommendations:null,tags:[]},n3=t(11994),n6=t(91027),n4=t(4585),n9=t(53363),n7={search:"",year:u()(),status:null,tags:null,customerId:null,locationId:null,sublocationId:null,userId:null,assetCategoryId:null,assetId:null,supplierId:null,customerManagerId:null,allJobs:null,allItems:null,hideExpiredItems:!1,complianceCategoryId:null},n8=function(e){var n={search:function(e){return!!e&&"Search is ".concat(e)},year:function(e){return!!e&&"".concat(u()(e).format("YYYY"))},status:function(e){return(null==e?void 0:e.length)>0&&"Status is ".concat(null==e?void 0:e.map(function(e){return e.label}).join(", "))},tags:function(e){return(null==e?void 0:e.length)>0&&"Tags is ".concat(null==e?void 0:e.map(function(e){return e.label}).join(", "))},customerId:function(e){return null!=e&&!!e.label&&"Customer is ".concat(null==e?void 0:e.label)},locationId:function(e){return null!=e&&!!e.label&&"Location is ".concat(null==e?void 0:e.label)},sublocationId:function(e){return null!=e&&!!e.label&&"Sublocation is ".concat(null==e?void 0:e.label)},userId:function(e){return null!=e&&!!e.label&&"User is ".concat(null==e?void 0:e.label)},assetCategoryId:function(e){return null!=e&&!!e.label&&"Asset Category is ".concat(null==e?void 0:e.label)},assetId:function(e){return null!=e&&!!e.label&&"Asset is ".concat(null==e?void 0:e.label)},supplierId:function(e){return null!=e&&!!e.label&&"Supplier is ".concat(null==e?void 0:e.label)},customerManagerId:function(e){return null!=e&&!!e.label&&"Customer Manager is ".concat(null==e?void 0:e.label)},allJobs:function(e){return null!=e&&!!e.label&&"All Jobs is ".concat(null==e?void 0:e.label)},allItems:function(e){return null!=e&&!!e.label&&"All Items is ".concat(null==e?void 0:e.label)},hideExpiredItems:function(e){return!!e&&"Exclude expired items"},complianceCategoryId:function(e){return null!=e&&!!e.label&&"Compliance Category is ".concat(null==e?void 0:e.label)}};return Object.entries(e).reduce(function(e,t){var o=(0,a.Z)(t,2),r=o[0],i=o[1];if(!i||!n[r])return e;var l=(0,n[r])(i);return l&&e.push({key:r,label:l}),e},[])},te=function(e){var n=e.locationId,t=e.open,a=e.close,s=e.hideFilters,u=e.filtersFormData,c=e.setFiltersFormData,d=e.setFilters,p=e.setFiltersChips,m=(0,ee.x)(),h=m.user,f=m.hasRole,x=f("admin"),b=f(["customer","supplier"]),y=(0,es.Z)("(max-width: 600px)"),j=(0,B.cI)({defaultValues:(0,o.Z)({},n7)}),Z=j.control,w=j.handleSubmit,C=j.reset,I=j.getValues,S=j.watch,_=S("locationId"),P=S("assetCategoryId"),q=(0,n9.P)({locationIdWatch:_,assetCategoryIdWatch:P,locationId:n,accountId:h.accountId}),k=q.customerProps,D=q.propertyProps,T=q.sublocationProps,M=q.complianceCategoryProps,F=q.assetCategoryProps,A=q.assetProps,E=q.supplierProps,R=q.customerManagerProps,$=q.userProps;(0,l.useEffect)(function(){var e,t,r,a,i,l,s,c,m,h,v,f,x,g,b,y={search:u.search?"%".concat(u.search,"%"):null,status:(null===(e=u.status)||void 0===e?void 0:e.length)>0?null===(t=u.status)||void 0===t?void 0:t.map(function(e){return e.value}):null,tags:(null===(r=u.tags)||void 0===r?void 0:r.length)>0?null===(a=u.tags)||void 0===a?void 0:a.map(function(e){return e.value}):null,customerId:null===(i=u.customerId)||void 0===i?void 0:i.value,locationId:n||(null===(l=u.locationId)||void 0===l?void 0:l.value),sublocationId:null===(s=u.sublocationId)||void 0===s?void 0:s.value,userId:null===(c=u.userId)||void 0===c?void 0:c.value,assetCategoryId:null===(m=u.assetCategoryId)||void 0===m?void 0:m.value,assetId:null===(h=u.assetId)||void 0===h?void 0:h.value,supplierId:null===(v=u.supplierId)||void 0===v?void 0:v.value,customerManagerId:null===(f=u.customerManagerId)||void 0===f?void 0:f.value,allJobs:null===(x=u.allJobs)||void 0===x?void 0:x.value,allItems:null===(g=u.allItems)||void 0===g?void 0:g.value,year:u.year||n7.year,hideExpiredItems:u.hideExpiredItems,complianceCategoryId:null===(b=u.complianceCategoryId)||void 0===b?void 0:b.value};C((0,o.Z)({},n7,u)),d(function(e){return(0,o.Z)({},e,y)}),p(n8((0,o.Z)({},n7,u)))},[u,n,C,d,p]);var N=function(e){try{var n=I();c(function(e){return(0,o.Z)({},e,n)})}finally{a()}},W=function(){var e=(0,o.Z)({},n7);c(e),a()};return(0,i.jsx)(n3.Z,{keepMounted:!0,open:t,onClose:a,children:(0,i.jsx)("form",{onSubmit:w(N),children:(0,i.jsxs)(tn,{is600pxOrLess:y,children:[(0,i.jsxs)(G.ZP,{container:!0,columnSpacing:2,rowSpacing:2,children:[(0,i.jsx)(G.ZP,{item:!0,xs:12,children:(0,i.jsx)(B.Qr,{control:Z,name:"search",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(O.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search schedule or work order",value:n,onChange:t})}})}),(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"status",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,{multiple:!0,limitTags:1,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n||[],onChange:function(e,n){t(n)},options:(0,n6.lR)(),textFieldProps:{color:"secondary",variant:"standard",label:"Select status"}})}})}),!s.includes("tags")&&x&&(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(n4.r,{control:Z})}),!s.includes("customerId")&&x&&(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"customerId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},k),{textFieldProps:{color:"secondary",variant:"standard",label:"Select customer"}}))}})}),!s.includes("location")&&(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"locationId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},D),{textFieldProps:{color:"secondary",variant:"standard",label:"Select location"}}))}})}),(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"sublocationId",control:Z,render:function(e){var t=e.value,a=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({disabled:!(null==_?void 0:_.value)&&!n,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t,onChange:function(e,n){a(n)}},T),{textFieldProps:{color:"secondary",variant:"standard",label:"Select sublocation"}}))}})}),b&&(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"userId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},$),{textFieldProps:{color:"secondary",variant:"standard",label:"Select user"}}))}})}),!s.includes("complianceCategory")&&(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"complianceCategoryId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},M),{textFieldProps:{color:"secondary",variant:"standard",label:"Select compliance category"}}))}})}),(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"assetCategoryId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},F),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset category"}}))}})}),(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"assetId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},A),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset"}}))}})}),x&&(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"supplierId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},E),{textFieldProps:{color:"secondary",variant:"standard",label:"Select supplier"}}))}})}),!s.includes("customerManagerId")&&x&&(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"customerManagerId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},R),{textFieldProps:{color:"secondary",variant:"standard",label:"Select account manager"}}))}})}),!s.includes("allJobs")&&(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"allJobs",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"compliance",label:"Compliance jobs only"},{value:"overduePPM",label:"Overdue jobs"},{value:"incompleteFollowOn",label:"Incomplete follow on works"},{value:"followOn",label:"Jobs with follow on works"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Jobs"}})}})}),!s.includes("allItems")&&(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"allItems",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(en.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"complete",label:"with completed jobs"},{value:"incomplete",label:"with incomplete jobs"},{value:"all",label:"with jobs during period"}],textFieldProps:{color:"secondary",variant:"standard",label:"Show all items"}})}})}),(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{control:Z,name:"year",render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(ed.M,{views:["year"],inputFormat:"YYYY",value:n,onChange:function(e){e?t(e.toISOString()):t(e)},renderInput:function(e){return(0,i.jsx)(O.Z,(0,r.Z)((0,o.Z)({},e),{fullWidth:!0,label:"Select year",color:"secondary",variant:"standard"}))}})}})}),(0,i.jsx)(G.ZP,{item:!0,xs:12,sm:6,children:(0,i.jsx)(B.Qr,{name:"hideExpiredItems",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,i.jsx)(el.Z,{control:(0,i.jsx)(V.Z,{color:"secondary",checked:n,onChange:function(e,n){return t(n)}}),label:"Hide expired items"})}})})]}),(0,i.jsxs)(v.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,i.jsx)(g.Z,{variant:"contained",color:"danger",onClick:function(){return W()},children:"Cancel"}),(0,i.jsx)(g.Z,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})},tn=(0,n$.Z)(Q.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:n?"0px":"8px",overflowY:"auto"}}),tt=t(16605),to=t(45456),tr=t(12978),ta=t(14924),ti=t(45307),tl=function(){var e=(0,a.Z)((0,ti.X)("ppm_item_view",{}),2),n=e[0],t=e[1];return{saveSessionData:function(e,a){t((0,r.Z)((0,o.Z)({},n),(0,ta.Z)({},e,a)))},getSessionDataByKey:function(e){var t=Object.entries(n).find(function(n){return(0,a.Z)(n,1)[0]===e.toString()});return t?t[1]:null}}},ts=t(23188),tu=t(47821),tc=t(57682),td=function(e,n){switch(e){case"compliance":return[{status:{_neq:"canceled"},Compliance:{}}];case"overduePPM":return[{_and:[{status:{_neq:"canceled"}},{timingStart:{_lte:n}},{_not:{statusData:{_has_key:"inProgress"}}},{_not:{statusData:{_has_key:"closed"}}}]}];case"incompleteFollowOn":return[{status:{_neq:"canceled"},Jobs:{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}}];case"followOn":return[{status:{_neq:"canceled"},Jobs:{}}];default:return[]}},tp=function(e){switch(e){case"complete":return[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]}];case"incomplete":return[{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}];default:return[]}},tm=function(e,n){switch(n){case"supplier":return{supplierUserId:{_eq:e}};case"customer":return{customerUserId:{_eq:e}};default:return{}}},th=function(e,n){var t,r,a,i,l,s,c,d=e.search,p=e.status,m=e.tags,h=e.customerId,v=e.locationId,f=e.sublocationId,x=e.userId,g=e.assetCategoryId,b=e.assetId,y=e.supplierId,j=e.customerManagerId,Z=e.allJobs,w=e.allItems,C=(e.year,e.hideExpiredItems),I=e.complianceCategoryId,S=e.complianceOnly,_=u()().subtract(24,"hours").toISOString(),P=[];P.push(y?{_or:[{supplierId:{_eq:y}},{status:{_eq:"offered"},SupplierOffers:{accountId:{_eq:y},status:{_in:["offered","accepted"]}}}]}:{}),P.push(d?{_or:[{reference:{_ilike:d}},{description:{_ilike:d}},{_or:[{JobSchedule:{reference:{_ilike:d}}},{JobSchedule:{description:{_ilike:d}}}]}]}:{}),P.push((null==p?void 0:p.length)>0?{status:{_in:p}}:{}),P.push((null==m?void 0:m.length)>0?{Taxonomy:{entity:{_eq:"Job"},Taxonomy:{status:{_eq:"active"},type:{_eq:"tags"},id:{_in:m}}}}:{}),P.push(tm(x,n)),P.push(b?{Assets:{entity:{_eq:"JobSchedule"},assetId:{_eq:b}}}:{}),P.push(j?{Customer:{Manager:{id:{_eq:j}}}}:{}),P.push.apply(P,(0,W.Z)(td(Z,_))),P.push.apply(P,(0,W.Z)(tp(w))),P.push(C?{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}:{});var q=P.filter(function(e){return!nO.isEmpty(e)});return{where:(0,o.Z)({locationId:{_eq:v},sublocationId:{_eq:f},customerId:{_eq:h}},g?{assetCategoryId:{_eq:g}}:{},I?{Compliance:{complianceCategoryId:{_eq:I}}}:{},S?{Compliance:{}}:{},(null==q?void 0:q.length)||"all"===w?{Jobs:{status:{_neq:"canceled"},_and:q}}:{})}},tv=t(71799),tf=t(50108),tx=t(15741),tg=t(37673),tb=function(e){var n=e.isCustomer,t=e.isTenant;return[{label:"Item name",value:"shortDescriptionName",defaultSelected:!0},{label:"Job Description",value:"description",defaultSelected:!0},{label:"Service name",value:"serviceName",defaultSelected:!0},{hide:n||t,label:"Assigned to",value:"supplierName",defaultSelected:!0},{label:"Sublocation Name",value:"sublocation",defaultSelected:!0},{label:"Asset Category",value:"assetCategoryName",defaultSelected:!0},{label:"Assets name",value:"assetName",defaultSelected:!0},{label:"Start Date",value:"scheduleStart",defaultSelected:!0},{label:"End Date",value:"scheduleEnd",defaultSelected:!0},{label:"Frequency",value:"frequencyDescription",defaultSelected:!0},{label:"Job ID",value:"jobIds",defaultSelected:!0},{label:"Job name",value:"jobName",defaultSelected:!0},{label:"Job status",value:"jobStatus",defaultSelected:!0}].filter(function(e){return!e.hide})},ty=t(35374),tj=t(74492),tZ=t(4791),tw={title:{color:"#323E4E"},subtitle:{color:"#323E4E",fontWeight:"300"},indicatorWrapper:{position:"relative"},indicator:{position:"absolute",left:-10,top:"calc(50% - 55px)",backgroundColor:"#000",width:"5px",height:"110px",borderTopRightRadius:"110px",borderBottomRightRadius:"110px"},zeroFrequencyJobScheduled:{backgroundColor:"#C1C1C1",color:"#000000",padding:"5px",borderRadius:"5px"},squaredIconButton:{backgroundColor:"#1E88E5",color:"#ffffff",borderRadius:"5px",height:"30px","&:hover":{opacity:.8,backgroundColor:"#1E88E5"}},actionsIcon:{color:"#000000"},smallButton:{height:"30px"}},tC=function(e){var n,t,s,P,T,O=e.locationId,M=e.locationName,F=e.initialFilters,A=e.columnVisibilityModel,E=e.tableHeight,R=e.containerHeight,N=e.hasHeader,W=void 0===N||N,L=e.hideFilters,J=e.hideAddAction,Y=e.hideCopyItems,B=(0,ty.s)(),H=(0,es.Z)("(max-width:1000px)"),V=(0,es.Z)("(max-width:600px)"),G=(0,ee.x)(),Q=G.user,U=G.hasRole,K=U("admin"),en=U("supplier"),et=U("customer"),er=U("tenant"),ei=U(["customer","supplier"]),el=(0,eo.D)(),eu=(0,l.useState)(F),ec=eu[0],ed=eu[1],ep=(0,X.x)({filters:ec}),em=ep.initialData,eh=ep.ref,ev=(0,l.useState)(!1),ef=ev[0],ex=ev[1],eg=(0,l.useState)(!1),eb=eg[0],ey=eg[1],ej=(0,l.useState)([]),eZ=ej[0],ew=ej[1],eC=tl(),eI=eC.getSessionDataByKey,eS=eC.saveSessionData,e_=(0,tj.a)(),eP=(0,a.Z)((0,ti.X)("scheduledjob_table_items_".concat(F.filterType),F,W?"network":"state"),2),eq=eP[0],ek=eP[1],eD=(0,l.useMemo)(function(){return th((0,o.Z)({},ec),Q.accountType)},[ec,Q.accountType]),eT=(0,c.a)(z.RV,{variables:(0,o.Z)({},em,eD)}),eO=eT.data,eM=void 0===eO?{jobSchedule:[],meta:{aggregate:{totalCount:0}}}:eO,eF=eM.jobSchedule,eA=eM.meta,eE=eT.loading,eR=eT.refetch,e$=(0,a.Z)((0,d.t)(z.RV,{variables:(0,o.Z)((0,r.Z)((0,o.Z)({},em),{limit:null,offset:0}),eD)}),2),eN=e$[0],eW=e$[1].loading,eL=(0,a.Z)((0,p.D)(z.Ds,{refetchQueries:["GetJobSchedules","GetCalendarJobs"],onCompleted:function(){el.show({content:"Job(s) were successfully deleted.",severity:"success"})},onError:function(e){el.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),eJ=eL[0],eY=eL[1].loading,eB=(0,a.Z)((0,p.D)(z.Ch,{refetchQueries:["GetJobSchedules","GetCalendarJobs"],onCompleted:function(){el.show({content:"Job(s) were successfully created.",severity:"success"})},onError:function(e){el.show({content:"Error: ".concat(e.message),severity:"error"})}}),2),eH=eB[0],eV=eB[1].loading,eG=function(e){var n=e.columns;eN().then(function(e){var t=e.data,o=q().unparse((0,nj.i3)(null==t?void 0:t.jobSchedule,n,nj.Rm)),r="data:application/octet-stream,"+encodeURIComponent(o);(0,tt.S)(r,"Planned_Maintenance_".concat(u()().format("YYYY/MM/DD"),".csv"))})},eQ=(0,l.useCallback)(function(e){ek(function(n){var t=(0,o.Z)({},n);return delete t[e],t})},[ek]),ez=(0,l.useCallback)(function(){e_.show({title:"Add item by passing through stages below",content:(0,i.jsx)(n2,{locationId:O,locationName:M,onClose:e_.close}),submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"95vw",lg:"85vw",lg2:"85vw"})},[O,M,e_]),eU=(0,l.useCallback)(function(e){var n=e.jobScheduleId;e_.show({title:"Edit item",content:(0,i.jsx)(n2,{edit:!0,jobScheduleId:n,onClose:e_.close}),submit:!1,xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"100vw",md2:"95vw",lg:"85vw",lg2:"85vw"})},[e_]),eK=(0,l.useCallback)(function(e){var n=e.jobScheduleId,t=e.jobStatus;e_.show({content:(0,i.jsx)(tZ.w,{type:"JobSchedule",jobScheduleId:n,defaultFilters:{status:t?[t]:void 0},startDate:null,endDate:null,onClose:e_.close,hideFilters:{supplier:!K}}),title:"Works orders",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"90vw",md2:"85vw",lg:"75vw",lg2:"75vw",submit:!1})},[K,e_]),eX=(0,l.useCallback)(function(e){eJ({variables:{id:e}})},[eJ]),e0=(0,l.useCallback)(function(e){return function(){e_.show({title:"Media",content:(0,i.jsx)(to.w,{entityId:e,refetch:eR})})}},[e_,eR]),e1=(0,l.useCallback)(function(e){eH({variables:{jobScheduleId:e.id}})},[eH]),e2=function(e){var t;return(0,i.jsxs)(h.Z,{sx:tw.indicatorWrapper,children:[(0,i.jsx)(tc.H,{height:110,backgroundColor:(0,ts.W)(e.scheduleEnd,!(0,tu.F)(null!==(n=e.jobs)&&void 0!==n?n:[]),!!(null===(t=e.jobs)||void 0===t?void 0:t.length))}),(0,i.jsx)(v.Z,{direction:"row",alignItems:"center",columnGap:2,sx:{fontWeight:"600",fontSize:"16px",marginLeft:"10px"},children:e.identifier})]})},e5=function(e){var n;return(0,i.jsx)(h.Z,{sx:tw.indicatorWrapper,children:(0,i.jsxs)(v.Z,{direction:"row",alignItems:"center",columnGap:2,sx:{overflow:"auto",height:"100%",width:"220px"},children:[e.compliance&&(0,i.jsx)(_.Z,{sx:{color:"info.main",marginLeft:"10px"}}),(0,i.jsxs)(v.Z,{ml:2,children:[(0,i.jsx)(f.Z,{typography:"subtitle1",sx:(0,r.Z)((0,o.Z)({},tw.title),{whiteSpace:"normal"}),children:(null===(n=e.shortDescription)||void 0===n?void 0:n.label)||e.shortDescription}),(0,i.jsx)(tr.O,{sx:(0,r.Z)((0,o.Z)({},tw.subtitle),{whiteSpace:"normal"}),fontSize:"12px",maxLength:20,children:e.description})]})]})})},e3=(0,l.useMemo)(function(){return[{flex:1,headerName:"Job",field:"job",sortable:!1,minWidth:250,renderCell:function(e){var n,t,a=e.row,l=(0,ts.W)(a.scheduleEnd,!(0,tu.F)(null!==(t=a.jobs)&&void 0!==t?t:[]),!!(null===(n=a.jobs)||void 0===n?void 0:n.length));return(0,i.jsxs)(h.Z,{sx:tw.indicatorWrapper,children:[(0,i.jsx)(tc.H,{height:110,backgroundColor:l}),(0,i.jsxs)(v.Z,{direction:"row",alignItems:"center",children:[a.compliance&&(0,i.jsx)(h.Z,{ml:1,children:(0,i.jsx)(_.Z,{sx:{color:"info.main"}})}),(0,i.jsxs)(v.Z,{ml:2,children:[(0,i.jsx)(f.Z,{typography:"subtitle1",sx:(0,o.Z)({},tw.title),children:a.shortDescription}),(0,i.jsx)(tr.O,{sx:(0,r.Z)((0,o.Z)({},tw.subtitle),{whiteSpace:"normal"}),fontSize:"12px",maxLength:20,children:a.description})]})]})]})}},{flex:1,headerName:"Service",field:"service",sortable:!1,minWidth:250,renderCell:function(e){var n,t,o,r=e.row;return(0,i.jsxs)(v.Z,{children:[(0,i.jsx)(f.Z,{typography:"subtitle1",children:r.serviceName}),!et&&!er&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:"Assigned to:"}),(0,i.jsx)(k.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(null===(n=r.supplier)||void 0===n?void 0:n.value),noWrap:!(null===(t=r.supplier)||void 0===t?void 0:t.value)||en,children:null===(o=r.supplier)||void 0===o?void 0:o.label})]})]})}},{flex:1,headerName:"Compliance",field:"compliance",sortable:!1,minWidth:250,renderCell:function(e){var n,t,o,r,a,l=e.row;return(0,i.jsxs)(v.Z,{children:[(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Item name: ",(null===(n=l.compliance)||void 0===n?void 0:n.name)||"-"]}),(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Primary Category: ",(null===(t=l.compliance)||void 0===t?void 0:null===(o=t.complianceCategory)||void 0===o?void 0:o.name)||"-"]}),(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Secondary Category: ",(null===(r=l.compliance)||void 0===r?void 0:null===(a=r.parentCompliance)||void 0===a?void 0:a.name)||"-"]})]})}},{flex:1,headerName:"Details",field:"details",sortable:!1,minWidth:250,renderCell:function(e){var n,o,r=e.row;return(0,i.jsxs)(v.Z,{children:[(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Sublocation: ",null!==(t=null===(n=r.sublocation)||void 0===n?void 0:n.label)&&void 0!==t?t:"-"]}),(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Asset category: ",null!==(s=r.assetCategory)&&void 0!==s?s:"-"]}),(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Assets:"," ",(null===(o=r.assets)||void 0===o?void 0:o.length)?r.assets.map(function(e){return e.asset.name}).join(", "):"-"]})]})}},{flex:1,headerName:"Frequency",field:"frequency",sortable:!1,minWidth:400,renderCell:function(e){var n,t,o=e.row;return(0,i.jsxs)(v.Z,{children:[(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Start date: ",u()(o.scheduleStart).format("DD-MM-YYYY")]}),(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["End date: ",u()(o.scheduleEnd).format("DD-MM-YYYY")]}),(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Frequency:\xa0",o.frequencyDescription.charAt(0).toUpperCase()+o.frequencyDescription.slice(1)]}),(0,i.jsxs)(v.Z,{direction:"row",alignItems:"center",columnGap:2,mt:1,children:[!(null===(n=o.jobs)||void 0===n?void 0:n.length)&&!ei&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(h.Z,{sx:tw.zeroFrequencyJobScheduled,children:"0 jobs"}),!er&&(0,i.jsx)(g.Z,{variant:"contained",color:"success",sx:tw.smallButton,onClick:function(e){e.stopPropagation(),e1(o)},children:"Create job(s)"})]}),!!(null===(t=o.jobs)||void 0===t?void 0:t.length)&&(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(g.Z,{variant:"contained",color:"secondary",size:"small",sx:{height:"30px"},onClick:function(e){var n,t;e.stopPropagation(),eK({jobScheduleId:o.id,jobStatus:null,description:o.title,totalJobCount:null!==(t=null===(n=o.jobs)||void 0===n?void 0:n.length)&&void 0!==t?t:0})},children:[o.jobs.length," jobs scheduled"]})})]})]})}},{field:"invoicePeriod",flex:1,headerName:"Invoice period",minWidth:350,sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsxs)(v.Z,{columnGap:2,children:[(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Month of first invoice: ",null!==(P=n.firstInvoiceDate)&&void 0!==P?P:"-"]}),(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Month of final invoice: ",null!==(T=n.finalInvoiceDate)&&void 0!==T?T:"-"]})]})}},{field:"invoiceBasis",flex:1,headerName:"Invoice basis",minWidth:350,sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsx)(f.Z,{typography:"h6",children:n.invoiceBasis?n.invoiceBasis.match(/[A-Z][a-z]+/g).join(" "):"N/A"})}},{field:"invoiceAmount",flex:1,headerName:"Invoice amount",minWidth:350,sortable:!1,renderCell:function(e){var n=e.row;return(0,i.jsxs)(v.Z,{columnGap:2,children:[(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Customer amount:\xa0","onCompletion"===n.invoiceBasis?(0,tf.T)(n.costCustomer):(0,tf.T)(n.customerMonthlyCharge)]}),!et&&!er&&(0,i.jsxs)(f.Z,{typography:"subtitle2",sx:tw.subtitle,children:["Supplier amount:\xa0","onCompletion"===n.invoiceBasis?(0,tf.T)(n.costSupplier):(0,tf.T)(n.supplierMonthlyCharge)]})]})}},{flex:1,headerName:"Work orders",field:"workOrders",sortable:!1,minWidth:350,renderCell:function(e){var n=e.row;return(0,i.jsx)($,{row:n,handleOpenJobsFromSchedule:eK,sessionData:eI(n.id),saveSessionData:eS})}},{flex:1,headerName:"Actions",field:"actions",sortable:!1,minWidth:150,renderCell:function(e){var n,t,o=e.row;return(0,i.jsxs)(v.Z,{direction:"row",justifyContent:"space-around",alignItems:"center",children:[(0,i.jsx)(x.Z,{onClick:e0(o.id),children:(0,i.jsx)(m.Z,{color:"success",variant:"dot",invisible:!(null===(n=o.media)||void 0===n?void 0:n.length),children:(0,i.jsx)(S.Z,{sx:tw.actionsIcon})})}),!ei&&(0,i.jsxs)(i.Fragment,{children:[!er&&(0,i.jsx)(x.Z,{children:(0,i.jsx)(C.Z,{sx:tw.actionsIcon,onClick:function(){return eU({jobScheduleId:o.id})}})}),!(null==o?void 0:null===(t=o.jobs)||void 0===t?void 0:t.length)&&!er&&(0,i.jsx)(x.Z,{onClick:function(){return eX(o.id)},children:(0,i.jsx)(Z.Z,{sx:tw.actionsIcon})})]})]})}}]},[eI,e1,eX,eU,eK,e0,ei,en,et,er,eS]),e6=(0,l.useMemo)(function(){return eF.map(function(e){var n,t,o,r,a,i,l,s=e.jobs.filter(function(e){var n=e.statusData;return(null==n?void 0:n.completed)||(null==n?void 0:n.closed)}).length;return{id:e.id,serviceName:e.meta.serviceName,title:e.meta.shortDescriptionName,frequency:e.frequency,frequencyDescription:e.frequencyDescription,jobs:e.jobs,assets:(null===(n=e.assets)||void 0===n?void 0:n.length)?e.assets:[],completeCount:s,description:null!==(l=e.description)&&void 0!==l?l:e.meta.description,location:e.location,scheduleStart:e.scheduleStart,scheduleEnd:e.scheduleEnd,media:e.media,firstInvoiceDate:e.firstInvoiceDate?u()(e.firstInvoiceDate).format("YYYY-MM-DD"):null,finalInvoiceDate:e.finalInvoiceDate?u()(e.finalInvoiceDate).format("YYYY-MM-DD"):null,invoiceBasis:e.invoiceBasis,customerMonthlyCharge:e.customerMonthlyCharge,supplierMonthlyCharge:e.supplierMonthlyCharge,costCustomer:null===(t=e.meta)||void 0===t?void 0:t.costCustomer,costSupplier:null===(o=e.meta)||void 0===o?void 0:o.costSupplier,assetCategory:null===(r=e.assetCategory)||void 0===r?void 0:r.name,sublocation:e.sublocation?{label:null===(a=e.sublocation)||void 0===a?void 0:a.name,value:null===(i=e.sublocation)||void 0===i?void 0:i.id}:null,costCategory:{value:e.meta.costCategoryId,label:e.meta.costCategoryName},shortDescription:e.meta.shortDescriptionName,supplier:e.meta.supplierId?{value:e.meta.supplierId,label:e.meta.supplierName}:null,compliance:e.compliance}})},[eF]),e4=function(){O&&e_.show({content:(0,i.jsx)(ea,{locationId:O}),xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"80vw",md2:"80vw",lg:"80vw",lg2:"80vw"})},e9=(0,l.useMemo)(function(){var e={};return!e6.length&&(null==em?void 0:em.q)?{title:"No results",subtitleFirstLine:"The filters you have applied have returned no results",subtitleSecondLine:"Please amend and try again if necessary."}:{title:"No ppm jobs found",subtitleFirstLine:"You currently have no ppm jobs set up",subtitleSecondLine:"Click add item to get started building.",buttonText:J?void 0:"Add item",onAction:J?void 0:ez}},[ez,J,null==em?void 0:em.q,e6.length]),e7=(0,o.Z)({},void 0===A?{}:A);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(te,{locationId:O,open:ef,close:function(){return ex(!1)},hideFilters:void 0===L?[]:L,filtersFormData:eq,setFiltersFormData:ek,setFilters:ed,setFiltersChips:ew}),(0,i.jsx)(tg.g,{mainKey:"scheduled_job_table_items_column_selector",open:eb,close:function(){return ey(!1)},columns:tb({isCustomer:et,isTenant:er}),onCompleted:function(e){return eG(e)},submitBtnText:"Export",subtitle:"Select the columns you would like to export in the csv file."}),(0,i.jsx)(b.Z,{sx:{zIndex:1e5},open:eV||eY||eW,children:(0,i.jsx)(y.Z,{color:"secondary"})}),(0,i.jsxs)(v.Z,{sx:{height:void 0===R?"calc(100vh - 100px)":R},children:[W&&(0,i.jsxs)(h.Z,{pl:2,pr:2,mb:1,mt:1,sx:{display:"grid",alignItems:"flex-start",height:"auto",gridTemplateAreas:H?'"filter-btn calendar-btn"\n                "filter-chip filter-chip"':'"filter-btn filter-chip calendar-btn"',gridTemplateColumns:H?"auto auto":"96px auto 250px",columnGap:H?0:2,rowGap:H?2:0},children:[(0,i.jsx)(h.Z,{sx:{gridArea:"filter-btn"},children:(0,i.jsx)(g.Z,{sx:{height:"35px"},variant:"contained",startIcon:(0,i.jsx)(I.Z,{}),onClick:function(){return ex(!0)},children:"Filters"})}),(0,i.jsx)(h.Z,{sx:{gridArea:"filter-chip",overflow:"hidden"},children:(0,i.jsx)(tv.V,{filtersChips:eZ,onRemove:eQ})}),(0,i.jsxs)(h.Z,{sx:{gridArea:"calendar-btn",justifySelf:"flex-end"},children:[O&&!Y&&!ei&&!B&&!V&&!er&&(0,i.jsx)(g.Z,{disableMinWidth:!0,color:"info",variant:"contained",sx:{height:"35px",marginRight:"10px!important"},onClick:e4,children:(0,i.jsx)(j.Z,{})}),!B&&!V&&(0,i.jsx)(g.Z,{disableMinWidth:!0,color:"info",variant:"contained",sx:{height:"35px",marginRight:"10px!important"},onClick:function(){return ey(!0)},children:(0,i.jsx)(w.Z,{})}),!ei&&!J&&(0,i.jsx)(g.Z,{sx:{width:"100px"},variant:"contained",color:"success",onClick:ez,children:"Add Item"})]})]}),(null==e6?void 0:e6.length)?(0,i.jsx)(tx.n,{rowHeight:120,ref:eh,loading:eE,columns:e3,rows:e6,columnVisibilityModel:e7,renderIdentifierCell:e2,renderValueCell:e5,meta:eA,refetch:eR,autoHeight:!1,containerHeight:void 0===E?"calc(100% - 32px)":E}):!eE&&(0,i.jsx)(D.C,(0,o.Z)({imageSrc:"/static/icons/no_locations_found.svg"},e9))]})]})}},54610:function(e,n,t){t.d(n,{NS:function(){return m},Rm:function(){return c},Z7:function(){return v},ge:function(){return d},i3:function(){return p},y4:function(){return h}});var o,r,a=t(26042),i=t(29815),l=t(30381),s=t.n(l),u=t(83704);t.n(u)()(s());var c={jobIds:function(e){var n,t;return null===(t=null===(n=e.jobs)||void 0===n?void 0:n.map(function(e){return e.number}))||void 0===t?void 0:t.join(", ")},jobName:function(e){var n,t;return null===(t=null===(n=e.jobs)||void 0===n?void 0:n.map(function(e){return e.title}))||void 0===t?void 0:t.join(", ")},jobStatus:function(e){var n,t;return null===(t=null===(n=e.jobs)||void 0===n?void 0:n.map(function(e){return e.status}))||void 0===t?void 0:t.join(", ")},sublocation:function(e){var n;return null!==(o=null===(n=e.sublocation)||void 0===n?void 0:n.name)&&void 0!==o?o:"-"},assetCategoryName:function(e){var n;return null!==(r=null===(n=e.assetCategory)||void 0===n?void 0:n.name)&&void 0!==r?r:"-"},assetName:function(e){var n,t;return null===(t=null===(n=e.assets)||void 0===n?void 0:n.map(function(e){return e.asset.name}))||void 0===t?void 0:t.join(", ")},scheduleStart:function(e){return s()(e.scheduleStart).format("YYYY-MM-DD")},scheduleEnd:function(e){return s()(e.scheduleEnd).format("YYYY-MM-DD")}},d={id:function(e){return"PM ".concat(e.number)},invoiceNumber:function(e){return(0,i.Z)(new Set(e.invoices.map(function(e){return e.invoiceNumber}))).join(", ")||"-"},service:function(e){var n;return null===(n=e.service)||void 0===n?void 0:n.name},type:function(e){return e.type},tags:function(e){var n,t;return null===(t=null===(n=e.tags)||void 0===n?void 0:n.map(function(e){return e.tag.name}))||void 0===t?void 0:t.join(", ")},supplier:function(e){var n;return null===(n=e.supplier)||void 0===n?void 0:n.name},manager:function(e){var n;return null===(n=e.manager)||void 0===n?void 0:n.fullName},sublocation:function(e){var n;return null===(n=e.sublocation)||void 0===n?void 0:n.name},customerManager:function(e){var n,t;return null===(n=e.customer)||void 0===n?void 0:null===(t=n.manager)||void 0===t?void 0:t.fullName},customer:function(e){var n;return null===(n=e.customer)||void 0===n?void 0:n.name},assetCategory:function(e){var n;return null===(n=e.assetCategory)||void 0===n?void 0:n.name},assets:function(e){var n,t;return null===(t=null===(n=e.assets)||void 0===n?void 0:n.map(function(e){return e.asset.name}))||void 0===t?void 0:t.join(", ")},description:function(e){var n,t,o;return null===(n=e.shortJobDesc)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:null===(o=t.taxonomy)||void 0===o?void 0:o.name},createdAt:function(e){return s()(e.timingStart).format("YYYY-MM-DD")},scheduled:function(e){return s()(e.createdAt).format("YYYY-MM-DD")},status:function(e){return e.status}},p=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=[],r=e.map(function(e){return(0,a.Z)({},e,null!==(u=e.meta)&&void 0!==u?u:{})}),i=!0,l=!1,s=void 0;try{for(var u,c,d=r[Symbol.iterator]();!(i=(c=d.next()).done);i=!0){var p=c.value,m={},h=!0,v=!1,f=void 0;try{for(var x,g=n[Symbol.iterator]();!(h=(x=g.next()).done);h=!0){var b,y,j=x.value,Z=null;Z=t&&j.value in t?null!==(b=t[j.value](p))&&void 0!==b?b:"-":null!==(y=p[j.value])&&void 0!==y?y:"-",m[j.label]=Z}}catch(w){v=!0,f=w}finally{try{h||null==g.return||g.return()}finally{if(v)throw f}}o.push(m)}}catch(C){l=!0,s=C}finally{try{i||null==d.return||d.return()}finally{if(l)throw s}}return o},m=function(e){var n,t,o,r,a,i,l,u,c,d,p,m=e.form,h=e.rruleMeta,v=e.dates,f=e.reportPassFailFeature,x=e.customerSignature,g=e.supplierSignature,b=e.startEndDates,y=e.adminId,j=e.customerId,Z={};return Z.meta={costCategoryId:null===(n=m.costCategory)||void 0===n?void 0:n.value,costCategoryName:null===(t=m.costCategory)||void 0===t?void 0:t.label,costCustomer:m.costCustomer,costSupplier:m.costSupplier,serviceId:m.service.value,serviceName:m.service.label,shortDescriptionId:m.shortDescription.value,shortDescriptionName:m.shortDescription.label,supplierId:null===(o=m.supplier)||void 0===o?void 0:o.value,supplierName:null===(r=m.supplier)||void 0===r?void 0:r.label,customerSignature:x,supplierSignature:g,reportPassFail:f.reportPassFail,reportPassFailTitle:f.reportPassFailTitle,requireReportRecommendations:f.requireReportRecommendations,rruleMeta:h},Z.assetCategoryId=null===(a=m.assetCategory)||void 0===a?void 0:a.value,Z.dates=v.map(function(e){var n=e.date,t=e.selected;return{date:s()(n).toISOString(),selected:t}}),Z.locationId=null===(i=m.location)||void 0===i?void 0:i.value,Z.sublocationId=null===(l=m.sublocation)||void 0===l?void 0:l.value,Z.frequency=m.frequency,Z.frequencyDescription=m.frequencyDescription,Z.reference=m.reference,Z.customerMonthlyCharge=m.customerMonthlyCharge,Z.supplierMonthlyCharge=m.supplierMonthlyCharge,Z.firstInvoiceDate=m.firstInvoiceDate,Z.finalInvoiceDate=m.finalInvoiceDate,Z.invoiceBasis=m.invoicingType,Z.scheduleStart=b.scheduleStart,Z.scheduleEnd=b.scheduleEnd,Z.description=m.description,Z.adminId=y,Z.customerId=j,Z.complianceId=null===(u=m.complianceSelect)||void 0===u?void 0:u.value,(null===(c=m.assets)||void 0===c?void 0:c.length)>0&&(Z.Assets={data:m.assets.map(function(e){return{status:"active",entity:"JobSchedule",assetId:e.value}})}),(null===(d=m.tags)||void 0===d?void 0:d.length)>0&&(Z.Taxonomy={data:null===(p=m.tags)||void 0===p?void 0:p.map(function(e){return{entity:"JobSchedule",taxonomyId:e.tag.id}})}),m.estimatedDuration&&m.estimatedDurationUnit&&(Z.estimatedDuration=s().duration(m.estimatedDuration,m.estimatedDurationUnit).as("milliseconds"),Z.estimatedDurationUnit=m.estimatedDurationUnit),Z},h=function(e){var n,t,o,r,a,i,l,u,c=e.form,d=e.rruleMeta,p=e.dates,m=e.reportPassFailFeature,h=e.customerSignature,v=e.supplierSignature,f=e.startEndDates,x=e.canceledJobs,g={};return g.meta={costCategoryId:null===(n=c.costCategory)||void 0===n?void 0:n.value,costCategoryName:null===(t=c.costCategory)||void 0===t?void 0:t.label,costCustomer:c.costCustomer,costSupplier:c.costSupplier,serviceId:c.service.value,serviceName:c.service.label,shortDescriptionId:c.shortDescription.value,shortDescriptionName:c.shortDescription.label,supplierId:null===(o=c.supplier)||void 0===o?void 0:o.value,supplierName:null===(r=c.supplier)||void 0===r?void 0:r.label,customerSignature:h,supplierSignature:v,reportPassFail:m.reportPassFail,reportPassFailTitle:m.reportPassFailTitle,requireReportRecommendations:m.requireReportRecommendations,rruleMeta:d},g.assetCategoryId=null===(a=c.assetCategory)||void 0===a?void 0:a.value,g.dates=p.map(function(e){var n=e.date,t=e.selected;return{date:s()(n).toISOString(),selected:t}}),g.locationId=null===(i=c.location)||void 0===i?void 0:i.value,g.sublocationId=null===(l=c.sublocation)||void 0===l?void 0:l.value,g.frequency=c.frequency,g.frequencyDescription=c.frequencyDescription,g.reference=c.reference,g.customerMonthlyCharge=c.customerMonthlyCharge,g.supplierMonthlyCharge=c.supplierMonthlyCharge,g.firstInvoiceDate=c.firstInvoiceDate,g.finalInvoiceDate=c.finalInvoiceDate,g.invoiceBasis=c.invoicingType,g.assets=c.assets,g.scheduleStart=f.scheduleStart,g.scheduleEnd=f.scheduleEnd,g.description=c.description,g.canceledJobs=x,g.complianceId=null===(u=c.complianceSelect)||void 0===u?void 0:u.value,c.estimatedDuration&&c.estimatedDurationUnit&&(g.estimatedDuration=s().duration(c.estimatedDuration,c.estimatedDurationUnit).as("milliseconds"),g.estimatedDurationUnit=c.estimatedDurationUnit),g},v=function(e){var n,t,o,r,a,i,l,u,c,d,p,m,h,v,f,x,g,b,y,j,Z=e.jobSchedule;return{location:{value:Z.location.id,label:Z.location.name},sublocation:Z.sublocation?{value:Z.sublocation.id,label:Z.sublocation.name}:null,frequency:Z.frequency,frequencyDescription:Z.frequencyDescription,reference:Z.reference,customerMonthlyCharge:Z.customerMonthlyCharge,supplierMonthlyCharge:Z.supplierMonthlyCharge,firstInvoiceDate:Z.firstInvoiceDate,finalInvoiceDate:Z.finalInvoiceDate,invoicingType:Z.invoiceBasis,estimatedDuration:Z.estimatedDuration?s().duration(Z.estimatedDuration,"milliseconds").as(Z.estimatedDurationUnit):null,estimatedDurationUnit:Z.estimatedDurationUnit,assetCategory:Z.assetCategory?{value:null===(n=Z.assetCategory)||void 0===n?void 0:n.id,label:null===(t=Z.assetCategory)||void 0===t?void 0:t.name}:null,assets:(null===(o=Z.assets)||void 0===o?void 0:o.map(function(e){var n=e.asset;return{value:n.id,label:n.name}}))||[],costCategory:(null===(r=Z.meta)||void 0===r?void 0:r.costCategoryId)?{value:null===(a=Z.meta)||void 0===a?void 0:a.costCategoryId,label:null===(i=Z.meta)||void 0===i?void 0:i.costCategoryName}:null,complianceSelect:Z.compliance?{value:Z.compliance.id,label:Z.compliance.name}:null,compliance:!!Z.compliance,costCustomer:null===(l=Z.meta)||void 0===l?void 0:l.costCustomer,costSupplier:null===(u=Z.meta)||void 0===u?void 0:u.costSupplier,description:Z.description,service:{value:null===(c=Z.meta)||void 0===c?void 0:c.serviceId,label:null===(d=Z.meta)||void 0===d?void 0:d.serviceName},shortDescription:{value:null===(p=Z.meta)||void 0===p?void 0:p.shortDescriptionId,label:null===(m=Z.meta)||void 0===m?void 0:m.shortDescriptionName},supplier:(null===(h=Z.meta)||void 0===h?void 0:h.supplierId)?{value:null===(v=Z.meta)||void 0===v?void 0:v.supplierId,label:null===(f=Z.meta)||void 0===f?void 0:f.supplierName}:null,customerSignature:null===(x=Z.meta)||void 0===x?void 0:x.customerSignature,supplierSignature:null===(g=Z.meta)||void 0===g?void 0:g.supplierSignature,reportPassFail:null===(b=Z.meta)||void 0===b?void 0:b.reportPassFail,reportPassFailTitle:null===(y=Z.meta)||void 0===y?void 0:y.reportPassFailTitle,requireReportRecommendations:null===(j=Z.meta)||void 0===j?void 0:j.requireReportRecommendations}}},45456:function(e,n,t){t.d(n,{j:function(){return l},w:function(){return i}});var o=t(85893),r=t(57779),a=t(74944),i=function(e){var n=e.entityId,t=e.refetch;return(0,o.jsx)(r.G,{entity:"JobSchedule",entityId:n,refetch:t})},l=function(e){var n=e.locaitonId,t=(0,(0,a.x)().hasRole)("tenant");return(0,o.jsx)(r.G,{showItemActions:!t,showActionButtons:!t,category:"PPM",entity:"Location",entityId:n,expanded:!0,hideExpandIcon:!0})}},62711:function(e,n,t){t.d(n,{a7:function(){return B},yt:function(){return N},ne:function(){return W},xg:function(){return L},MI:function(){return ea},Ds:function(){return V},Ch:function(){return G},Oh:function(){return ei},du:function(){return U},JV:function(){return es},EW:function(){return E},RV:function(){return R},ix:function(){return $},z4:function(){return eo},qQ:function(){return Y},Hj:function(){return J},As:function(){return Q},JH:function(){return z},P0:function(){return K},b_:function(){return X},OK:function(){return ee},h:function(){return en},FL:function(){return er},Us:function(){return H},_4:function(){return el},zs:function(){return et}});var o=t(7297),r=t(75063);function a(){var e=(0,o.Z)(["\n  fragment JobScheduleFields on JobSchedule {\n    contractId\n    createdAt\n    customerMonthlyCharge\n    dates\n    estimatedDuration\n    estimatedDurationUnit\n    finalInvoiceDate\n    firstInvoiceDate\n    frequency\n    frequencyDescription\n    id\n    invoiceBasis\n    locationId\n    meta\n    paymentMethod\n    reference\n    status\n    sublocationId\n    supplierMonthlyCharge\n    updatedAt\n    scheduleStart\n    scheduleEnd\n    assetCategoryId\n    description\n    customerId\n  }\n"]);return a=function(){return e},e}var i=(0,r.Ps)(a());function l(){var e=(0,o.Z)(['\n  query GetCalendarJobs($locationId: Int!) {\n    jobs: Job(\n      order_by: { timingStart: asc }\n      where: {\n        Location: { id: { _eq: $locationId } }\n        jobScheduleId: { _is_null: false }\n        status: { _neq: "canceled" }\n      }\n    ) {\n      id\n      number\n      title\n      description\n      quoted\n      reference\n      timingStart\n      timingEnd\n      createdAt\n      status\n      jobScheduleId\n      supplierNotes\n      amount\n      supplierLabourAmount\n      rag\n      type\n      timings: JobTimings {\n        id\n        status\n        createdAt\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        id\n        taxonomyId\n        comments\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n    }\n  }\n']);return l=function(){return e},e}function s(){var e=(0,o.Z)(['\n  query GetJobSchedule($jobScheduleId: Int!) {\n    jobSchedule: JobSchedule_by_pk(id: $jobScheduleId) {\n      ...JobScheduleFields\n      assetCategory: AssetCategory {\n        id\n        name\n      }\n      assets: Assets(where: { entity: { _eq: "JobSchedule" } }) {\n        asset: Asset {\n          id\n          name\n        }\n      }\n      location: Location {\n        id\n        name\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      media: Media(where: { entity: { _eq: "JobSchedule" } }) {\n        id\n      }\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        number\n        status\n      }\n      compliance: Compliance {\n        id\n        name\n      }\n    }\n  }\n  ',"\n"]);return s=function(){return e},e}function u(){var e=(0,o.Z)(['\n  query GetJobSchedules(\n    $orderBy: JobSchedule_order_by!\n    $where: JobSchedule_bool_exp!\n    $limit: Int\n    $offset: Int\n  ) {\n    jobSchedule: JobSchedule(limit: $limit, offset: $offset, where: $where, order_by: [$orderBy]) {\n      ...JobScheduleFields\n      location: Location {\n        id\n        access\n        customer: Account_Locations {\n          account: Account {\n            id\n            managerId\n          }\n        }\n        user: User {\n          id\n          nameLast\n          nameFirst\n        }\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      assetCategory: AssetCategory {\n        id\n        name\n      }\n      assets: Assets(where: { entity: { _eq: "JobSchedule" } }) {\n        asset: Asset {\n          id\n          name\n        }\n      }\n\n      media: Media(where: { entity: { _eq: "JobSchedule" } }) {\n        id\n      }\n      expenses: Expenses {\n        id\n        paid\n        description\n        amount\n        markup\n        unit\n        vat\n      }\n      jobs: Jobs(where: { status: { _neq: "canceled" } }) {\n        id\n        number\n        rag\n        title\n        timingStart\n        status\n        statusData\n        shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n          id\n          taxonomyId\n          comments\n          taxonomy: Taxonomy {\n            name\n          }\n        }\n      }\n      compliance: Compliance {\n        id\n        name\n        complianceCategory: ComplianceCategory {\n          id\n          name\n        }\n        parentCompliance: ParentCompliance {\n          id\n          name\n        }\n      }\n    }\n    meta: JobSchedule_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"]);return u=function(){return e},e}function c(){var e=(0,o.Z)(["\n  query GetJobSchedule(\n    $locationId: Int\n    $orderBy: JobSchedule_order_by!\n    $limit: Int\n    $offset: Int\n  ) {\n    jobSchedule: JobSchedule(\n      where: { locationId: { _eq: $locationId } }\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n    ) {\n      contractId\n      frequency\n      frequencyDescription\n      id\n      meta\n      paymentMethod\n      reference\n      estimatedDuration\n      estimatedDurationUnit\n      dates\n      sublocation: Sublocation {\n        id\n        name\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n"]);return c=function(){return e},e}function d(){var e=(0,o.Z)(["\n  mutation CopyScheduleItems(\n    $originLocationId: Int!\n    $copyLocationIds: [Int!]!\n    $selectType: String!\n    $scheduleIds: [Int]\n  ) {\n    copyScheduleItems(\n      originLocationId: $originLocationId\n      copyLocationIds: $copyLocationIds\n      selectType: $selectType\n      scheduleIds: $scheduleIds\n    ) {\n      message\n      success\n    }\n  }\n"]);return d=function(){return e},e}function p(){var e=(0,o.Z)(['\n  query GetJobsListFromSchedule(\n    $jobScheduleId: Int!\n    $supplierId: Int\n    $status: [String]\n    $startDate: timestamptz\n    $endDate: timestamptz\n  ) {\n    jobs: Job(\n      where: {\n        jobScheduleId: { _eq: $jobScheduleId }\n        status: { _in: $status, _neq: "canceled" }\n        timingStart: { _gte: $startDate, _lte: $endDate }\n        _or: [\n          { supplierId: { _eq: $supplierId } }\n          { SupplierOffers: { accountId: { _eq: $supplierId } }, status: { _eq: "offered" } }\n        ]\n      }\n      order_by: { id: asc }\n    ) {\n      id\n      number\n      status\n      description\n      supplier: Supplier {\n        id\n        name\n      }\n    }\n  }\n']);return p=function(){return e},e}function m(){var e=(0,o.Z)(['\n  query GetJobFromSchedule($jobId: Int!) {\n    job: Job_by_pk(id: $jobId) {\n      id\n      status\n      type\n      description\n      timingStatus\n      correctStart\n      correctEnd\n      timingStart\n      timingEnd\n      scheduledAt\n      number\n      customerVatTotal: customerFinances(path: "amountInfo.vatTotal")\n      arrivalAnytime: meta(path: "arrivalAnytime")\n      supplier: Supplier {\n        id\n        name\n      }\n      supplierUser: SupplierUser {\n        id\n        fullName\n      }\n      invoices: Invoices(order_by: { createdAt: desc }) {\n        id\n        invoiceNumber\n        invoiceType\n        createdAt\n        amounts\n        accountEntry: AccountEntry {\n          id\n          meta\n        }\n        reconciledAmount: AccountEntry {\n          reconciliations: InvoiceReconciliations_aggregate {\n            aggregate {\n              sum {\n                amount\n              }\n            }\n          }\n        }\n      }\n      supplierOffers: SupplierOffers {\n        id\n        status\n      }\n      compliance: Compliance {\n        id\n      }\n      timings: JobTimings(order_by: { id: desc }) {\n        id\n        status\n        notes\n        meta\n        quoteId\n        createdAt\n        user: User {\n          id\n          fullName\n        }\n      }\n    }\n  }\n']);return m=function(){return e},e}function h(){var e=(0,o.Z)(["\n  query CountTotalJobs($where: Job_bool_exp) {\n    jobs: Job_aggregate(where: $where) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return h=function(){return e},e}function v(){var e=(0,o.Z)(["\n  query CountTotalJobsList($where: Job_bool_exp, $limit: Int = 50, $offset: Int = 0) {\n    jobs: Job(where: $where, limit: $limit, offset: $offset) {\n      id\n      number\n      title\n      status\n    }\n  }\n"]);return v=function(){return e},e}function f(){var e=(0,o.Z)(['\n  query GetNextJob($locationId: Int, $now: timestamptz!) {\n    nextJob: Job(\n      where: {\n        type: { _eq: "ppm" }\n        status: { _nin: ["closed", "canceled"] }\n        locationId: { _eq: $locationId }\n        timingStart: { _gt: $now }\n      }\n      order_by: { timingStart: asc }\n      limit: 1\n    ) {\n      id\n      number\n      title\n      status\n      scheduledAt\n    }\n  }\n']);return f=function(){return e},e}function x(){var e=(0,o.Z)(['\n  query GetLocationInfo($id: Int!) {\n    location: Location_by_pk(id: $id) {\n      id\n      monthlyAmount: meta(path: "monthlyAmount")\n      meta\n      customer: Account_Locations(where: { Account: { type: { _eq: "customer" } } }) {\n        account: Account {\n          id\n          name\n          meta\n          manager: Manager {\n            id\n            fullName\n          }\n        }\n      }\n      addresses: Addresses(where: { entity: { _eq: "Location" }, invoice: { _eq: true } }) {\n        id\n        address: Address {\n          id\n          name\n          postCode\n          addressLine1\n          addressLine2\n          addressLine3\n          city\n          county\n        }\n      }\n    }\n  }\n']);return x=function(){return e},e}function g(){var e=(0,o.Z)(["\n  mutation AddJobSchedule($objects: [JobSchedule_insert_input!]!) {\n    insert_JobSchedule(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return g=function(){return e},e}function b(){var e=(0,o.Z)(["\n  mutation UpdateJobSchedule($data: jsonb!) {\n    updateJobSchedule(data: $data) {\n      success\n      message\n    }\n  }\n"]);return b=function(){return e},e}function y(){var e=(0,o.Z)(["\n  mutation DeleteJobSchedule($id: Int!) {\n    delete_JobSchedule_by_pk(id: $id) {\n      id\n    }\n  }\n"]);return y=function(){return e},e}function j(){var e=(0,o.Z)(["\n  mutation GeneratePpmJobs($jobScheduleId: Int!) {\n    createPpmJobs(jobScheduleId: $jobScheduleId) {\n      success\n      message\n    }\n  }\n"]);return j=function(){return e},e}function Z(){var e=(0,o.Z)(['\n  query GetScheduledJobs($where: Job_bool_exp, $limit: Int, $offset: Int, $orderBy: Job_order_by!) {\n    jobs: Job(where: $where, limit: $limit, offset: $offset, order_by: [$orderBy]) {\n      id\n      number\n      type\n      timingStart\n      createdAt\n      status\n      invoices: Invoices {\n        invoiceNumber\n      }\n      service: Service {\n        name\n      }\n      assetCategory: AssetCategory {\n        id\n        name\n      }\n      assets: Assets(where: { entity: { _eq: "JobSchedule" } }) {\n        asset: Asset {\n          id\n          name\n        }\n      }\n      shortJobDesc: Taxonomy(where: { Taxonomy: { type: { _eq: "jobTags" } } }) {\n        taxonomy: Taxonomy {\n          name\n        }\n      }\n      manager: Manager {\n        id\n        fullName\n      }\n      sublocation: Sublocation {\n        id\n        name\n      }\n      customer: Customer {\n        id\n        name\n        manager: Manager {\n          id\n          fullName\n        }\n      }\n      supplier: Supplier {\n        id\n        name\n      }\n      tags: Taxonomy(\n        where: {\n          entity: { _eq: "Job" }\n          Taxonomy: { _and: [{ status: { _eq: "active" } }, { type: { _eq: "tags" } }] }\n        }\n      ) {\n        id\n        tag: Taxonomy {\n          id\n          name\n          meta\n          type\n        }\n      }\n    }\n    meta: Job_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return Z=function(){return e},e}function w(){var e=(0,o.Z)(['\n  query GetScheduleItemsForCalendar(\n    $locationId: Int\n    $where: JobSchedule_bool_exp!\n    $jobWhere: Job_bool_exp!\n    $offset: Int = 0\n    $limit: Int = 50\n  ) {\n    jobSchedules: JobSchedule(\n      where: $where\n      offset: $offset\n      limit: $limit\n      order_by: { id: desc }\n    ) {\n      id\n      title: meta(path: "$.shortDescriptionName")\n      description: meta(path: "$.description")\n      serviceName: meta(path: "$.serviceName")\n      jobs: Jobs(where: $jobWhere) {\n        id\n        timingStart\n        statusData\n      }\n    }\n    meta: JobSchedule_aggregate(where: $where) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return w=function(){return e},e}function C(){var e=(0,o.Z)(['\n  query GetCustomerFinances($locationId: Int!, $limit: Int, $offset: Int) {\n    invoices: AccountEntry(\n      where: { type: { _eq: "customerPpmInvoice" }, locationId: { _eq: $locationId } }\n      offset: $offset\n      limit: $limit\n      order_by: { id: desc }\n    ) {\n      id\n      invoiceNumber\n      debit\n      paymentStatus\n      outstandingAmount\n      outstandingdays\n      meta\n      createdAt\n    }\n    meta: AccountEntry_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return C=function(){return e},e}function I(){var e=(0,o.Z)(["\n  query GetScheduleItemsTotalByJobsForCalendar(\n    $whereComplete: Job_bool_exp!\n    $whereIncomplete: Job_bool_exp!\n    $whereFollowOn: Job_bool_exp!\n    $whereIncompleteCompliance: Job_bool_exp!\n  ) {\n    jobsCompleteCount: Job_aggregate(where: $whereComplete) {\n      aggregate {\n        count\n      }\n    }\n    jobsIncompleteCount: Job_aggregate(where: $whereIncomplete) {\n      aggregate {\n        count\n      }\n    }\n    jobsFollowOnCount: Job_aggregate(where: $whereFollowOn) {\n      aggregate {\n        count\n      }\n    }\n    jobsIncompleteComplianceCount: Job_aggregate(where: $whereIncompleteCompliance) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return I=function(){return e},e}function S(){var e=(0,o.Z)(["\n  query GetScheduleItemsCountTotalForCalendar($where: Job_bool_exp!) {\n    jobs: Job_aggregate(where: $where) {\n      aggregate {\n        count\n      }\n    }\n  }\n"]);return S=function(){return e},e}function _(){var e=(0,o.Z)(["\n  query GetSupplierForInvoice($supplierId: Int!) {\n    supplier: Account_by_pk(id: $supplierId) {\n      id\n      name\n      vatId\n    }\n  }\n"]);return _=function(){return e},e}function P(){var e=(0,o.Z)(['\n  query GetSupplierPpmInvoices(\n    $jobScheduleId: Int!\n    $locationId: Int!\n    $limit: Int\n    $offset: Int\n    $orderBy: AccountEntry_order_by!\n  ) {\n    invoices: AccountEntry(\n      where: {\n        type: { _eq: "supplierPpmInvoice" }\n        jobScheduleId: { _eq: $jobScheduleId }\n        locationId: { _eq: $locationId }\n      }\n      limit: $limit\n      offset: $offset\n      order_by: [$orderBy]\n    ) {\n      id\n      invoiceNumber\n      invoicedDate\n      debit\n      paymentStatus\n      outstandingAmount\n      outstandingdays\n    }\n    meta: AccountEntry_aggregate(\n      where: {\n        type: { _eq: "supplierPpmInvoice" }\n        jobScheduleId: { _eq: $jobScheduleId }\n        locationId: { _eq: $locationId }\n      }\n    ) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n']);return P=function(){return e},e}function q(){var e=(0,o.Z)(["\n  query GetSupplierPpmInvoiceById($id: Int!) {\n    invoice: AccountEntry_by_pk(id: $id) {\n      id\n      invoiceNumber\n      invoicedDate\n      debit\n      paymentStatus\n      outstandingAmount\n      outstandingdays\n      items\n      meta\n      location: Location {\n        id\n        name\n      }\n      account: Account {\n        id\n        name\n        vatId\n      }\n    }\n  }\n"]);return q=function(){return e},e}function k(){var e=(0,o.Z)(["\n  mutation UpsertSupplierPPMInvoice($data: jsonb!) {\n    upsertSupplierPpmInvoice(data: $data) {\n      success\n      data\n    }\n  }\n"]);return k=function(){return e},e}function D(){var e=(0,o.Z)(['\n  query GetJobSchedules(\n    $orderBy: JobSchedule_order_by!\n    $locationId: Int\n    $limit: Int\n    $offset: Int\n  ) {\n    jobSchedule: JobSchedule(\n      limit: $limit\n      offset: $offset\n      where: { locationId: { _eq: $locationId } }\n      order_by: [$orderBy]\n    ) {\n      ...JobScheduleFields\n      invoicesReceived\n      invoicesPaid\n      jobs: Jobs(where: { status: { _neq: "canceled" } }, order_by: { timingStart: desc }) {\n        id\n        status\n        timingStart\n        statusData\n        supplierNet: supplierFinances(path: "amountInfo.total")\n      }\n    }\n    meta: JobSchedule_aggregate(where: { locationId: { _eq: $locationId } }) {\n      aggregate {\n        totalCount: count\n      }\n    }\n  }\n  ',"\n"]);return D=function(){return e},e}function T(){var e=(0,o.Z)(["\n  query SupplierInvoiceTotalByMonth(\n    $locationId: Int!\n    $supplierId: Int\n    $startDate: timestamptz!\n    $endDate: timestamptz!\n  ) {\n    items: select_supplier_ppm_invoice_totals_by_month(\n      args: {\n        supplierid: $supplierId\n        locationid: $locationId\n        startdate: $startDate\n        enddate: $endDate\n      }\n      order_by: { month: asc }\n    ) {\n      locationId\n      month\n      totalPaid\n      totalUnpaid\n      totalPartial\n    }\n  }\n"]);return T=function(){return e},e}function O(){var e=(0,o.Z)(["\n  query CustomerInvoiceTotalByMonth(\n    $locationId: Int!\n    $customerId: Int\n    $startDate: timestamptz!\n    $endDate: timestamptz!\n  ) {\n    items: select_customer_ppm_invoice_totals_by_month(\n      args: {\n        customerid: $customerId\n        locationid: $locationId\n        startdate: $startDate\n        enddate: $endDate\n      }\n      order_by: { month: asc }\n    ) {\n      locationId\n      month\n      totalPaid\n      totalUnpaid\n      totalPartial\n    }\n  }\n"]);return O=function(){return e},e}function M(){var e=(0,o.Z)(["\n  query GetAccountByLocation($locationId: Int!) {\n    account: Account(where: { Account_Locations: { Location: { id: { _eq: $locationId } } } }) {\n      id\n      name\n    }\n  }\n"]);return M=function(){return e},e}function F(){var e=(0,o.Z)(["\n  mutation UpdateMonthlyAmount($locationId: Int!, $monthlyAmount: numeric!) {\n    ifNull: update_Location(\n      where: { id: { _eq: $locationId }, meta: { _is_null: true } }\n      _set: { meta: {} }\n    ) {\n      affected_rows\n    }\n    update_Location_by_pk(\n      pk_columns: { id: $locationId }\n      _append: { meta: { monthlyAmount: $monthlyAmount } }\n    ) {\n      id\n    }\n  }\n"]);return F=function(){return e},e}function A(){var e=(0,o.Z)(['\n  query GetJobsListForScheduleEdit($jobScheduleId: Int!) {\n    jobs: Job(\n      where: { jobScheduleId: { _eq: $jobScheduleId }, status: { _neq: "canceled" } }\n      order_by: { id: asc }\n    ) {\n      id\n      type\n      number\n      status\n      timingStart\n      timingEnd\n      statusData\n      supplier: Supplier {\n        id\n        name\n      }\n      supplierOffers: SupplierOffers(where: { status: { _eq: "offered" } }) {\n        supplier: Supplier {\n          id\n          name\n        }\n      }\n    }\n  }\n']);return A=function(){return e},e}(0,r.Ps)(l());var E=(0,r.Ps)(s(),i),R=(0,r.Ps)(u(),i),$=(0,r.Ps)(c()),N=(0,r.Ps)(d());(0,r.Ps)(p()),(0,r.Ps)(m());var W=(0,r.Ps)(h()),L=(0,r.Ps)(v()),J=(0,r.Ps)(f()),Y=(0,r.Ps)(x()),B=(0,r.Ps)(g()),H=(0,r.Ps)(b()),V=(0,r.Ps)(y()),G=(0,r.Ps)(j()),Q=(0,r.Ps)(Z()),z=(0,r.Ps)(w()),U=(0,r.Ps)(C()),K=(0,r.Ps)(I());(0,r.Ps)(S());var X=(0,r.Ps)(_()),ee=(0,r.Ps)(P()),en=(0,r.Ps)(q()),et=(0,r.Ps)(k()),eo=(0,r.Ps)(D(),i),er=(0,r.Ps)(T()),ea=(0,r.Ps)(O()),ei=(0,r.Ps)(M()),el=(0,r.Ps)(F()),es=(0,r.Ps)(A())},47821:function(e,n,t){t.d(n,{F:function(){return r}});var o,r=function(e){return null!==(o=e.some(function(e){var n=e.statusData;return!(null==n?void 0:n.completed)&&!(null==n?void 0:n.closed)}))&&void 0!==o?o:null}},23188:function(e,n,t){t.d(n,{W:function(){return o}});var o=function(e,n,t){var o=new Date(e).getTime();return t?!e||n?"black":Date.now()+7889238e3<o?"success":Date.now()+7889238e3>o&&Date.now()<o?"info":Date.now()>o?"warning":void 0:"white"}},52619:function(e,n,t){t.d(n,{A:function(){return of}});var o=t(26042),r=t(69396),a=t(85893),i=t(67294),l=t(51233),s=t(90629),u=t(90948),c=t(3892),d=t(40044),p=t(31220),m=t(96830),h=t(45697),v=t.n(h),f=t(61730),x=t(87918),g=t(93946),b=t(53219),y=t(15861),j=t(41796),Z=t(14564),w=function(e){var n=e.children,t=e.popover,o=e.onOpen,r=e.clickOnly,l=(0,i.useState)(null),s=l[0],u=l[1],c=function(e){r||u(e.currentTarget),o&&o(e)},d=function(){u(null)},p=Boolean(s),m=p?"ribbon-select-button-popover":void 0;return(0,a.jsxs)("div",{children:[(0,a.jsx)(C,{"aria-describedby":m,onClick:c,children:n}),(0,a.jsx)(Z.ZP,{id:m,open:p,anchorEl:s,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"left"},sx:{zIndex:1200},children:t})]})};w.defaultProps={popover:null,onOpen:null,clickOnly:!1},w.propTypes={children:v().node.isRequired,popover:v().node,onOpen:v().func};var C=(0,u.ZP)("button")(function(e){return{display:"flex",alignItems:"center",border:"none",borderRadius:"4px",color:e.theme.palette.white.main,backgroundColor:"#1394FF",fontSize:"0.875rem",lineHeight:1.25,padding:"2px 4px 2px 4px",cursor:"pointer","&:hover":{backgroundColor:(0,j._j)("#1394FF",.1)}}}),I=t(22154),S=t(12282),_=t(62711),P=t(6812),q=t(50108),k=t(74492),D=t(828),T=t(50319),O=t(42283),M=t(19512),F=t(70768),A=t(26936),E=function(e){var n=e.locationId,t=e.monthlyAmount,o=e.close,r=(0,M.D)(),i=(0,O.cI)({defaultValues:{monthlyAmount:t}}),l=i.errors,s=i.handleSubmit,u=i.control,c=(0,D.Z)((0,T.D)(_._4,{refetchQueries:["GetLocationInfo"],onCompleted:function(){r.show({content:"Monthly billing figure updated",severity:"success"}),o&&o()},onError:function(e){r.show({content:"Error: ".concat(e.message),severity:"error"})}}),1)[0],d=function(e){c({variables:{locationId:n,monthlyAmount:e.monthlyAmount}})};return(0,a.jsxs)("form",{id:"offCanvasForm",onSubmit:s(d),children:[(0,a.jsx)(O.Qr,{name:"monthlyAmount",control:u,render:function(e){var n,t=e.value,o=e.onChange;return(0,a.jsx)(F.I,{fullWidth:!0,leftLabel:(0,a.jsx)(A.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",type:"number",InputProps:{inputProps:{min:0,step:".01"}},value:t,onChange:o,error:l.monthlyAmount,helperText:null===(n=l.monthlyAmount)||void 0===n?void 0:n.message})}}),(0,a.jsx)(y.Z,{mt:1,children:"Updating the monthly billing figure will overide any per item customer billing"})]})},R=t(32791);function $(){return($=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let N=e=>i.createElement("svg",$({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 20"},e),i.createElement("path",{fill:"#FFF",d:"M2.667.07C1.196.07 0 1.341 0 2.906v14.187c0 1.565 1.196 2.837 2.667 2.837h18.666c1.471 0 2.667-1.272 2.667-2.837V2.907C24 1.342 22.804.069 21.333.069zM6 11.42h2.667c1.841 0 3.333 1.586 3.333 3.546 0 .39-.3.71-.667.71h-8c-.366 0-.666-.32-.666-.71 0-1.96 1.491-3.547 3.333-3.547M4.667 7.162c0-.753.28-1.474.78-2.006a2.59 2.59 0 0 1 1.886-.832c.708 0 1.386.3 1.886.832S10 6.41 10 7.163s-.281 1.474-.781 2.006S8.04 10 7.333 10a2.59 2.59 0 0 1-1.885-.83 2.93 2.93 0 0 1-.781-2.007m10.666-1.419h5.334c.366 0 .666.32.666.71s-.3.709-.666.709h-5.334c-.366 0-.666-.32-.666-.71s.3-.709.666-.709m0 2.838h5.334c.366 0 .666.319.666.709s-.3.71-.666.71h-5.334c-.366 0-.666-.32-.666-.71s.3-.71.666-.71m0 2.837h5.334c.366 0 .666.32.666.71s-.3.709-.666.709h-5.334c-.366 0-.666-.32-.666-.71s.3-.709.666-.709"}));var W=t(45456),L=t(74944),J=t(5616),Y=t(71496),B=function(e){var n=e.icon,t=e.children,o=e.expanded,r=e.onOpen;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(H,{open:o,children:[(0,a.jsx)(V,{onClick:r,children:n}),o&&(0,a.jsx)(Q,{children:(0,a.jsx)(Y.Z,{sx:{height:"32px",width:"32px",color:"#FFFFFF"}})})]}),(0,a.jsx)(J.Z,{sx:{height:"300px"},children:o&&(0,a.jsx)(G,{open:o,children:t})})]})},H=(0,u.ZP)(J.Z)(function(e){var n;return{display:"flex",alignItems:"center",borderRadius:"10px",flexDirection:"row",height:"fit-content",width:e.open?"80px":"42px",backgroundColor:e.theme.palette.secondary.main,transition:"width 400ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),V=(0,u.ZP)(J.Z)(function(e){return{display:"flex",width:"42px",height:"42px",borderRadius:"8px",backgroundColor:e.theme.palette.secondary.main,justifyContent:"center",alignItems:"center"}}),G=(0,u.ZP)(J.Z)(function(e){var n;return{position:"absolute",top:50,left:-2,borderRadius:"10px",display:e.open?"block":"none",marginTop:"15px",backgroundColor:e.theme.palette.secondary.main}}),Q=(0,u.ZP)(g.Z)(function(e){return{height:"36px",width:"36px",transform:e.open?"rotate(180deg)":"rotate(0deg)",transition:"transform 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),z=function(e){var n=(0,i.useRef)();return(0,i.useEffect)(function(){n.current=e}),n.current},U=function(e){var n=e.icon,t=e.children,o=e.expanded,r=e.onOpen,l=e.spacing,s=(0,i.useState)(o),u=s[0],c=s[1],d=(0,i.useState)(!1),p=d[0],m=d[1],h=(0,i.useState)(!1),v=h[0],f=h[1],x=(0,i.useRef)(null),g=z(u);(0,i.useEffect)(function(){c(o),m(!1)},[o]);var b=function(){x.current&&f(x.current.scrollHeight>=69)};(0,i.useEffect)(function(){return b(),window.addEventListener("resize",b),function(){return window.removeEventListener("resize",b)}},[]);var y=function(){c(!0),r&&r()},j=function(){m(!p)},Z=function(){b()};return(0,a.jsxs)(K,{open:u,children:[(0,a.jsx)(X,{open:u,onClick:y,children:n}),(0,a.jsxs)(ee,{open:u,wasOpen:g,more:p,direction:"row",alignItems:"center",justifyContent:"space-between",onTransitionEnd:Z,children:[(0,a.jsx)(en,{ref:x,open:u,more:p,direction:"row",spacebetween:l,children:t}),v&&(0,a.jsx)(et,{open:p,color:"white",onClick:j,children:(0,a.jsx)(Y.Z,{sx:{height:"32px",width:"32px"}})})]})]})};U.defaultProps={expanded:!1,spacing:2,onOpen:null},U.propTypes={icon:v().node.isRequired,children:v().node.isRequired,expanded:v().bool,onOpen:v().func,spacing:v().number};var K=(0,u.ZP)(J.Z)(function(e){return{display:"flex",flexDirection:"row",width:e.open?"100%":"42px",transition:"width 400ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),X=(0,u.ZP)(J.Z)(function(e){var n;return{display:e.open?"none":"flex",width:"42px",height:"42px",borderRadius:"8px",backgroundColor:e.theme.palette.secondary.main,justifyContent:"center",alignItems:"center"}}),ee=(0,u.ZP)(l.Z)(function(e){var n=e.open,t=e.wasOpen,r=e.more,a=e.theme;return(0,o.Z)({width:n?"100%":"0px",overflow:"hidden",display:!n&&t?"none":"flex",height:r?"100%":"42px",borderRadius:"8px",backgroundColor:a.palette.secondary.main,transition:"width 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms,\n  height 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"},n&&{paddingLeft:"8px",paddingRight:"8px"})}),en=(0,u.ZP)(l.Z)(function(e){var n=e.open,t=e.more,r=e.spacebetween;return(0,o.Z)({alignItems:"center",flexWrap:"wrap",height:t?"auto":"42px",overflow:"hidden"},n&&{paddingTop:"10px",paddingBottom:"10px",rowGap:"10px","&>:not(style):not(style)":{marginRight:8*r+"px"}})}),et=(0,u.ZP)(g.Z)(function(e){return{height:"36px",width:"36px",transform:e.open?"rotate(180deg)":"rotate(0deg)",transition:"transform 300ms cubic-bezier(0.4, 0, 0.2, 1) 100ms"}}),eo=function(e){return(0,f.Z)("(max-width: 600px)")?(0,a.jsx)(B,(0,o.Z)({},e)):(0,a.jsx)(U,(0,o.Z)({},e))},er=g.Z,ea=x.Z,ei=I.Z,el={mobileItem:function(e){return e?{width:"calc(100vw - 40px)",padding:"6px",borderBottom:"1px solid #FFFFFF"}:{}}},es=function(e){var n,t,o,r,i,s,u,c,d,p=e.expanded,m=e.handleOpen,h=e.locationId,v=(0,L.x)().hasRole,x=v("admin"),g=v("customer"),j=v("tenant"),Z=(0,f.Z)("(max-width: 600px)"),C=(0,k.a)(),I=(0,P.a)(_.qQ,{skip:!h||!p,variables:{id:h}}),D=I.data,T=(void 0===D?{location:{}}:D).location,O=I.refetch,M=null==T?void 0:null===(n=T.addresses)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.address,F=function(e){e.stopPropagation(),C.show({content:(0,a.jsx)(E,{locationId:h,monthlyAmount:T.monthlyAmount||0,close:C.close}),submit:!0,title:"Billing"})},A=function(e){var n,t;e.stopPropagation(),C.show({content:(0,a.jsx)(R.H,{addressId:(null==M?void 0:M.id)||null,entity:"Location",entityId:h,id:(null==T?void 0:null===(n=T.addresses)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.id)||null,onSubmit:O,type:"invoice"}),submit:!1,title:"Manage addresses"})},$=function(e){e.stopPropagation(),C.show({content:(0,a.jsx)(W.j,{locaitonId:h}),submit:!1,title:"Upload Documents"})};return(0,a.jsx)(eo,{icon:(0,a.jsx)(b.Z,{component:N,inheritViewBox:!0,sx:{"& path":{fill:"#82E1FF"}}}),expanded:p,onOpen:m,spacing:1,children:h?(0,a.jsxs)(a.Fragment,{children:[(x||g||j)&&(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:el.mobileItem(Z),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Customer:"}),(0,a.jsx)(y.Z,{color:"white.main",children:null===(o=T.customer)||void 0===o?void 0:null===(r=o[0])||void 0===r?void 0:null===(i=r.account)||void 0===i?void 0:i.name})]}),(x||g||j)&&(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:el.mobileItem(Z),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Asigned to:"}),(0,a.jsx)(y.Z,{color:"white.main",children:(null===(s=T.customer)||void 0===s?void 0:null===(u=s[0])||void 0===u?void 0:null===(c=u.account)||void 0===c?void 0:null===(d=c.manager)||void 0===d?void 0:d.fullName)||"Not assigned"})]}),(x||g)&&(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:el.mobileItem(Z),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Monthly Amount:"}),(0,a.jsx)(y.Z,{color:"white.main",children:T.monthlyAmount?(0,q.T)(T.monthlyAmount):(0,q.T)(0)}),(0,a.jsx)(er,{color:"white",sx:{ml:1,height:"16px",width:"16px"},onClick:F,children:(0,a.jsx)(S.Z,{sx:{height:"16px"}})})]}),(x||g||j)&&(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",spacing:1,sx:el.mobileItem(Z),children:[(0,a.jsx)(y.Z,{fontWeight:700,children:"Invoice Address:"}),(0,a.jsx)(ea,{color:"white",size:"small",label:null==M?void 0:M.postCode,sx:{height:"18px",borderRadius:1}}),(0,a.jsxs)(y.Z,{color:"white.main",children:[(null==M?void 0:M.addressLine1)?M.addressLine1+", ":"",(null==M?void 0:M.addressLine2)?M.addressLine2+", ":"",(null==M?void 0:M.addressLine3)?M.addressLine3+", ":"",(null==M?void 0:M.city)?M.city+", ":"",(null==M?void 0:M.county)?M.county+", ":""]}),(x||g)&&(0,a.jsx)(er,{color:"white",sx:{ml:1,height:"16px",width:"16px"},onClick:A,children:(0,a.jsx)(S.Z,{sx:{height:"16px"}})})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:el.mobileItem(Z),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Documentation:"}),(0,a.jsx)(ei,{color:"white",sx:{height:"16px"}}),(0,a.jsx)(w,{clickOnly:!0,onOpen:$,children:"Add media"})]})]}):(0,a.jsx)(y.Z,{fontWeight:700,fontSize:16,sx:Z?{height:"100px",padding:"10px",width:"calc(100vw - 40px)"}:{},children:"Please select a location to get details"})})},eu=t(73359),ec=t(30381),ed=t.n(ec),ep=t(98456),em=t(97212),eh=t(98619),ev=t(58533),ef=t(59505),ex=function(e){var n=e.jobs,t=e.hasMore,o=e.handleFetchMore,r=e.onItemClick,i=(0,f.Z)("(max-width:600px)");return(0,a.jsx)(J.Z,{id:"scrollableDiv",sx:{display:"flex",flexDirection:"column",pt:1,overflowY:"scroll",maxHeight:i?"80vh":"50vh",width:"200px"},children:(0,a.jsx)(ev.Z,{dataLength:n.length,next:o,hasMore:t,loader:(0,a.jsx)(ep.Z,{color:"secondary"}),scrollableTarget:"scrollableDiv",children:n.map(function(e){return(0,a.jsx)(em.ZP,{component:"div",disablePadding:!0,onClick:function(n){return r(n,e)},children:(0,a.jsxs)(eh.Z,{sx:{flexDirection:"column",alignItems:"flex-start"},children:[(0,a.jsxs)(l.Z,{direction:"row",width:"100%",spacing:2,children:[(0,a.jsx)(x.Z,{label:e.number,color:"primary",size:"small",sx:{borderRadius:1}}),(0,a.jsx)(ef.B,{value:e.status,sx:{borderRadius:1}})]}),e.title&&(0,a.jsx)(y.Z,{mt:1,children:e.title})," "]})},e.number)})})})};ex.defaultProps={jobs:[],hasMore:!1,handleFetchMore:function(){},onItemClick:function(){}},ex.propTypes={jobs:v().array,hasMore:v().bool,handleFetchMore:v().func,onItemClick:v().func};var eg=t(29815),eb=function(e){var n=e.fetchMore,t=e.offset,o=e.limit,r=e.setOffset;n({variables:{offset:t,limit:o},updateQuery:function(e,n){var t=n.fetchMoreResult;return t?{jobs:(0,eg.Z)(e.jobs).concat((0,eg.Z)(t.jobs))}:e}}),r(t+o)},ey=t(21813);function ej(){return(ej=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let eZ=e=>i.createElement("svg",ej({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 18 20"},e),i.createElement("path",{fill:"#FFF",d:"M5.143 0c.711 0 1.286.559 1.286 1.25V2.5h5.142V1.25c0-.691.575-1.25 1.286-1.25s1.286.559 1.286 1.25V2.5h1.928C17.136 2.5 18 3.34 18 4.375V6.25H0V4.375C0 3.34.864 2.5 1.929 2.5h1.928V1.25C3.857.559 4.432 0 5.143 0M0 7.5h18v10.625C18 19.16 17.136 20 16.071 20H1.93C.864 20 0 19.16 0 18.125zm2.571 3.125v1.25c0 .344.29.625.643.625H4.5a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 4.5 10H3.214a.636.636 0 0 0-.643.625m5.143 0v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 9.643 10H8.357a.636.636 0 0 0-.643.625M13.5 10a.636.636 0 0 0-.643.625v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25a.636.636 0 0 0-.643-.625zM2.571 15.625v1.25c0 .344.29.625.643.625H4.5a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 4.5 15H3.214a.636.636 0 0 0-.643.625M8.357 15a.636.636 0 0 0-.643.625v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25A.636.636 0 0 0 9.643 15zm4.5.625v1.25c0 .344.29.625.643.625h1.286a.636.636 0 0 0 .643-.625v-1.25a.636.636 0 0 0-.643-.625H13.5a.636.636 0 0 0-.643.625"}));var ew={jobs:{aggregate:{count:0}}},eC={mobileItem:function(e){return e?{width:"calc(100vw - 40px)",padding:"6px",borderBottom:"1px solid #FFFFFF"}:{}}},eI=function(e){var n,t=e.expanded,o=e.handleOpen,r=e.locationId,s=(0,k.a)(),u=(0,i.useMemo)(function(){return ed()().toISOString()},[]),c=(0,i.useMemo)(function(){return ed()().add(7,"days").toISOString()},[]),d=(0,i.useMemo)(function(){return ed()().subtract(24,"hours").toISOString()},[]),p=(0,i.useState)(0),m=p[0],h=p[1],v=(0,i.useState)(0),x=v[0],g=v[1],j=(0,i.useState)(0),Z=j[0],C=j[1],I=(0,i.useState)(0),S=I[0],q=I[1],T=(0,f.Z)("(max-width: 600px)"),O=(0,P.a)(_.ne,{skip:!t,variables:{where:{type:{_eq:"ppm"},locationId:{_eq:r}}}}).data,M=(void 0===O?ew:O).jobs.aggregate.count,F=(0,D.Z)((0,eu.t)(_.xg,{variables:{where:{type:{_eq:"ppm"},locationId:{_eq:r}}}}),2),A=F[0],E=F[1],R=E.data,$=(void 0===R?{jobs:[]}:R).jobs,N=E.fetchMore,W=(0,P.a)(_.Hj,{skip:!t,variables:{locationId:r,now:u}}).data,L=(void 0===W?{nextJob:[]}:W).nextJob,J=(0,P.a)(_.ne,{skip:!t,variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},timingStart:{_gte:u,_lte:c}}}}).data,B=(void 0===J?ew:J).jobs.aggregate.count,H=(0,D.Z)((0,eu.t)(_.xg,{variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},timingStart:{_gte:u,_lte:c}}}}),2),V=H[0],G=H[1],Q=G.data,z=(void 0===Q?{jobs:[]}:Q).jobs,U=G.fetchMore,K=(0,P.a)(_.ne,{skip:!t,variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},Compliance:{},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:d}}}}).data,X=(void 0===K?ew:K).jobs.aggregate.count,ee=(0,D.Z)((0,eu.t)(_.xg,{variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},Compliance:{},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:d}}}}),2),en=ee[0],et=ee[1],er=et.data,ea=(void 0===er?{jobs:[]}:er).jobs,ei=et.fetchMore,el=(0,P.a)(_.ne,{skip:!t,variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:d}}}}).data,es=(void 0===el?ew:el).jobs.aggregate.count,ec=(0,D.Z)((0,eu.t)(_.xg,{variables:{where:{type:{_eq:"ppm"},status:{_nin:["closed","canceled"]},locationId:{_eq:r},_not:{statusData:{_has_key:"inProgress"}},timingStart:{_lt:d}}}}),2),ep=ec[0],em=ec[1],eh=em.data,ev=(void 0===eh?{jobs:[]}:eh).jobs,ef=em.fetchMore,eg=function(e,n){var t=n.id;e.stopPropagation(),s.show({content:(0,a.jsx)(ey.g,{jobId:t,toggleShow:s.close}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})},ej=function(e){e({variables:{offset:0,limit:50}})};return(0,a.jsxs)(eo,{icon:(0,a.jsx)(b.Z,{component:eZ,inheritViewBox:!0,sx:{"& path":{fill:"#82E1FF"}}}),expanded:t,onOpen:o,children:[(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:eC.mobileItem(T),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Total jobs:"}),(0,a.jsx)(y.Z,{color:"white.main",mr:1,children:M}),(0,a.jsx)(w,{onOpen:function(){return ej(A)},popover:(0,a.jsx)(ex,{onItemClick:eg,jobs:$,hasMore:$.length<M,handleFetchMore:function(){return eb({fetchMore:N,offset:m,limit:50,setOffset:h})}}),children:(0,a.jsx)(Y.Z,{sx:{height:"14px"}})})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:eC.mobileItem(T),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Next Job:"}),(0,a.jsx)(y.Z,{color:"white.main",mr:1,children:(null===(n=L[0])||void 0===n?void 0:n.title)||"N/A"}),(0,a.jsx)(w,{popover:(0,a.jsx)(ex,{onItemClick:eg,jobs:L}),children:(0,a.jsx)(Y.Z,{sx:{height:"14px"}})})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:eC.mobileItem(T),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Next 7 Days Jobs:"}),(0,a.jsx)(y.Z,{color:"white.main",mr:1,children:B}),(0,a.jsx)(w,{onOpen:function(){return ej(V)},popover:(0,a.jsx)(ex,{onItemClick:eg,jobs:z,hasMore:z.length<B,handleFetchMore:function(){return eb({fetchMore:U,offset:x,limit:50,setOffset:g})}}),children:(0,a.jsx)(Y.Z,{sx:{height:"14px"}})})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:eC.mobileItem(T),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Overdue Compliance Jobs:"}),(0,a.jsx)(y.Z,{color:"white.main",mr:1,children:X}),(0,a.jsx)(w,{onOpen:function(){return ej(en)},popover:(0,a.jsx)(ex,{onItemClick:eg,jobs:ea,hasMore:ea.length<X,handleFetchMore:function(){return eb({fetchMore:ei,offset:Z,limit:50,setOffset:C})}}),children:(0,a.jsx)(Y.Z,{sx:{height:"14px"}})})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:eC.mobileItem(T),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Overdue PPM Jobs:"}),(0,a.jsx)(y.Z,{color:"white.main",mr:1,children:es}),(0,a.jsx)(w,{onOpen:function(){return ej(ep)},popover:(0,a.jsx)(ex,{onItemClick:eg,jobs:ev,hasMore:ev.length<es,handleFetchMore:function(){return eb({fetchMore:ef,offset:S,limit:50,setOffset:q})}}),children:(0,a.jsx)(Y.Z,{sx:{height:"14px"}})})]})]})};eI.defaultProps={expanded:!1,handleOpen:function(){}},eI.propTypes={expanded:v().bool,handleOpen:v().func};var eS=t(64293),e_={jobs:{aggregate:{count:0}}},eP={mobileItem:function(e){return e?{width:"calc(100vw - 40px)",padding:"6px",borderBottom:"1px solid #FFFFFF"}:{}}},eq=function(e){var n=e.expanded,t=e.handleOpen,s=e.locationId,u=(0,k.a)(),c=(0,i.useState)(0),d=c[0],p=c[1],m=(0,i.useState)(0),h=m[0],v=m[1],x=(0,i.useState)(0),g=x[0],j=x[1],Z=(0,i.useState)(0),C=Z[0],I=Z[1],S=(0,i.useState)(0),q=S[0],T=S[1],O=(0,i.useState)(0),M=O[0],F=O[1],A=(0,i.useState)(0),E=A[0],R=A[1],$=(0,f.Z)("(max-width: 600px)"),N=(0,P.a)(_.ne,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"raised"},locationId:{_eq:s}}}}).data,W=(void 0===N?e_:N).jobs.aggregate.count,L=(0,D.Z)((0,eu.t)(_.xg,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"raised"},locationId:{_eq:s}}}}),2),J=L[0],B=L[1],H=B.data,V=(void 0===H?{jobs:[]}:H).jobs,G=B.fetchMore,Q=(0,P.a)(_.ne,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"offered"},locationId:{_eq:s}}}}).data,z=(void 0===Q?e_:Q).jobs.aggregate.count,U=(0,D.Z)((0,eu.t)(_.xg,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"offered"},locationId:{_eq:s}}}}),2),K=U[0],X=U[1],ee=X.data,en=(void 0===ee?{jobs:[]}:ee).jobs,et=X.fetchMore,er=(0,P.a)(_.ne,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"accepted"},locationId:{_eq:s}}}}).data,ea=(void 0===er?e_:er).jobs.aggregate.count,ei=(0,D.Z)((0,eu.t)(_.xg,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"accepted"},locationId:{_eq:s}}}}),2),el=ei[0],es=ei[1],ec=es.data,ed=(void 0===ec?{jobs:[]}:ec).jobs,ep=es.fetchMore,em=(0,P.a)(_.ne,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"inProgress"},locationId:{_eq:s}}}}).data,eh=(void 0===em?e_:em).jobs.aggregate.count,ev=(0,D.Z)((0,eu.t)(_.xg,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"inProgress"},locationId:{_eq:s}}}}),2),ef=ev[0],eg=ev[1],ej=eg.data,eZ=(void 0===ej?{jobs:[]}:ej).jobs,ew=eg.fetchMore,eC=(0,P.a)(_.ne,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"completed"},locationId:{_eq:s}}}}).data,eI=(void 0===eC?e_:eC).jobs.aggregate.count,eq=(0,D.Z)((0,eu.t)(_.xg,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"completed"},locationId:{_eq:s}}}}),2),ek=eq[0],eD=eq[1],eT=eD.data,eO=(void 0===eT?{jobs:[]}:eT).jobs,eM=eD.fetchMore,eF=(0,P.a)(_.ne,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"reportSent"},locationId:{_eq:s}}}}).data,eA=(void 0===eF?e_:eF).jobs.aggregate.count,eE=(0,D.Z)((0,eu.t)(_.xg,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"reportSent"},locationId:{_eq:s}}}}),2),eR=eE[0],e$=eE[1],eN=e$.data,eW=(void 0===eN?{jobs:[]}:eN).jobs,eL=e$.fetchMore,eJ=(0,P.a)(_.ne,{skip:!n,variables:{where:{type:{_eq:"ppm"},status:{_eq:"closed"},locationId:{_eq:s}}}}).data,eY=(void 0===eJ?e_:eJ).jobs.aggregate.count,eB=(0,D.Z)((0,eu.t)(_.xg,{variables:{where:{type:{_eq:"ppm"},status:{_eq:"closed"},locationId:{_eq:s}}}}),2),eH=eB[0],eV=eB[1],eG=eV.data,eQ=(void 0===eG?{jobs:[]}:eG).jobs,ez=eV.fetchMore,eU=function(e,n){var t=n.id;e.stopPropagation(),u.show({content:(0,a.jsx)(ey.g,{jobId:t,toggleShow:u.close}),submit:!1,title:"Job details",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"40vw",md2:"40vw",lg:"40vw",lg2:"40vw"})},eK=function(e){e({variables:{offset:0,limit:50}})};return(0,a.jsxs)(eo,{icon:(0,a.jsx)(b.Z,{component:eS.Z,inheritViewBox:!0,sx:{"& path":{fill:"#82E1FF"}}}),expanded:n,onOpen:t,spacing:3,children:[(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:eP.mobileItem($),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Job raised"}),(0,a.jsxs)(w,{onOpen:function(){return eK(J)},popover:(0,a.jsx)(ex,{onItemClick:eU,jobs:V,hasMore:V.length<W,handleFetchMore:function(){return eb({fetchMore:G,offset:d,limit:50,setOffset:p})}}),children:[W,(0,a.jsx)(Y.Z,{sx:{height:"14px"}})]})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:eP.mobileItem($),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Job offered"}),(0,a.jsxs)(w,{onOpen:function(){return eK(K)},popover:(0,a.jsx)(ex,{onItemClick:eU,jobs:en,hasMore:en.length<z,handleFetchMore:function(){return eb({fetchMore:et,offset:h,limit:50,setOffset:v})}}),children:[z,(0,a.jsx)(Y.Z,{sx:{height:"14px"}})]})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:eP.mobileItem($),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Job accepted"}),(0,a.jsxs)(w,{onOpen:function(){return eK(el)},popover:(0,a.jsx)(ex,{onItemClick:eU,jobs:ed,hasMore:ed.length<ea,handleFetchMore:function(){return eb({fetchMore:ep,offset:g,limit:50,setOffset:j})}}),children:[ea,(0,a.jsx)(Y.Z,{sx:{height:"14px"}})]})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:eP.mobileItem($),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"In progress"}),(0,a.jsxs)(w,{onOpen:function(){return eK(ef)},popover:(0,a.jsx)(ex,{onItemClick:eU,jobs:eZ,hasMore:eZ.length<eh,handleFetchMore:function(){return eb({fetchMore:ew,offset:C,limit:50,setOffset:I})}}),children:[eh,(0,a.jsx)(Y.Z,{sx:{height:"14px"}})]})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:eP.mobileItem($),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Complete"}),(0,a.jsxs)(w,{onOpen:function(){return eK(ek)},popover:(0,a.jsx)(ex,{onItemClick:eU,jobs:eO,hasMore:eO.length<eI,handleFetchMore:function(){return eb({fetchMore:eM,offset:q,limit:50,setOffset:T})}}),children:[eI,(0,a.jsx)(Y.Z,{sx:{height:"14px"}})]})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:eP.mobileItem($),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Report sent"}),(0,a.jsxs)(w,{onOpen:function(){return eK(eR)},popover:(0,a.jsx)(ex,{onItemClick:eU,jobs:eW,hasMore:eW.length<eA,handleFetchMore:function(){return eb({fetchMore:eL,offset:M,limit:50,setOffset:F})}}),children:[eA,(0,a.jsx)(Y.Z,{sx:{height:"14px"}})]})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",sx:(0,r.Z)((0,o.Z)({},eP.mobileItem($)),{width:$?"100%":"auto"}),children:[(0,a.jsx)(y.Z,{fontWeight:700,mr:1,children:"Closed"}),(0,a.jsxs)(w,{onOpen:function(){return eK(eH)},popover:(0,a.jsx)(ex,{onItemClick:eU,jobs:eQ,hasMore:eQ.length<eY,handleFetchMore:function(){return eb({fetchMore:ez,offset:E,limit:50,setOffset:R})}}),children:[eY,(0,a.jsx)(Y.Z,{sx:{height:"14px"}})]})]})]})},ek=function(e){var n=e.defaultExpanded,t=e.locationId,o=(0,i.useState)(n),r=o[0],l=o[1],s=(0,f.Z)("(max-width: 600px)"),u=function(e){l(e)};return(0,a.jsxs)(eD,{direction:"row",justifyContent:s?"flex-start":"flex-end",width:"100%",spacing:1,children:[(0,a.jsx)(es,{expanded:"info"===r,handleOpen:function(){return u("info")},locationId:t}),(0,a.jsx)(eI,{expanded:"jobs"===r,handleOpen:function(){return u("jobs")},locationId:t}),(0,a.jsx)(eq,{expanded:"event"===r,handleOpen:function(){return u("event")},locationId:t})]})};ek.defaultProps={defaultExpanded:null},ek.propTypes={defaultExpanded:v().string,locationId:v().string};var eD=(0,u.ZP)(l.Z)(function(){return{position:"relative",color:"#BEEFFF"}}),eT=t(86858),eO=t(12632),eM=t(11057),eF=t(39474),eA=t(48795),eE=t(53767),eR=t(83162),e$=t(15843),eN=t(79928),eW=t(11163),eL=t.n(eW),eJ=t(21830),eY=t(69368),eB=t(50480),eH=t(86886),eV=t(11994),eG=t(50135),eQ=t(10166),ez=t(33754),eU=t(91027),eK=t(18531),eX=t(4585),e0=t(53363),e1={search:"",year:ed()(),status:null,tags:null,customerId:null,locationId:null,sublocationId:null,userId:null,assetCategoryId:null,assetId:null,supplierId:null,customerManagerId:null,allJobs:null,allItems:null,hideExpiredItems:!1},e2=t(14924),e5=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return(0,o.Z)({},e.reduce(function(e,a){var i=n.find(function(e){return e.value===a.field&&!t.includes(a.field)});return(0,r.Z)((0,o.Z)({},e),(0,e2.Z)({},a.field,Boolean(i)))},{}))},e3=function(e){var n={search:function(e){return!!e&&"Search is ".concat(e)},year:function(e){return!!e&&"".concat(ed()(e).format("YYYY"))},status:function(e){return(null==e?void 0:e.length)>0&&"Status is ".concat(null==e?void 0:e.map(function(e){return e.label}).join(", "))},tags:function(e){return(null==e?void 0:e.length)>0&&"Tags is ".concat(null==e?void 0:e.map(function(e){return e.label}).join(", "))},customerId:function(e){return null!=e&&!!e.label&&"Customer is ".concat(null==e?void 0:e.label)},locationId:function(e){return null!=e&&!!e.label&&"Location is ".concat(null==e?void 0:e.label)},sublocationId:function(e){return null!=e&&!!e.label&&"Sublocation is ".concat(null==e?void 0:e.label)},userId:function(e){return null!=e&&!!e.label&&"User is ".concat(null==e?void 0:e.label)},assetCategoryId:function(e){return null!=e&&!!e.label&&"Asset Category is ".concat(null==e?void 0:e.label)},assetId:function(e){return null!=e&&!!e.label&&"Asset is ".concat(null==e?void 0:e.label)},supplierId:function(e){return null!=e&&!!e.label&&"Supplier is ".concat(null==e?void 0:e.label)},customerManagerId:function(e){return null!=e&&!!e.label&&"Customer Manager is ".concat(null==e?void 0:e.label)},allJobs:function(e){return null!=e&&!!e.label&&"All Jobs is ".concat(null==e?void 0:e.label)},allItems:function(e){return null!=e&&!!e.label&&"All Items is ".concat(null==e?void 0:e.label)},hideExpiredItems:function(e){return!!e&&"Exclude expired items"}};return Object.entries(e).reduce(function(e,t){var o=(0,D.Z)(t,2),r=o[0],a=o[1];if(!a||!n[r])return e;var i=(0,n[r])(a);return i&&e.push({key:r,label:i}),e},[])},e6=eM.Z,e4=function(e){var n=e.locationId,t=e.open,s=e.close,u=e.hideFilters,c=e.filtersFormData,d=e.setFiltersFormData,p=e.setFilters,m=e.setFiltersChips,h=(0,L.x)(),v=h.user,x=h.hasRole,g=x("admin"),b=x(["customer","supplier"]),y=(0,f.Z)("(max-width: 600px)"),j=(0,O.cI)({defaultValues:(0,o.Z)({},e1)}),Z=j.control,w=j.handleSubmit,C=j.reset,I=j.getValues,S=j.watch,_=S("locationId"),P=S("assetCategoryId"),q=(0,e0.P)({locationIdWatch:_,assetCategoryIdWatch:P,locationId:n,accountId:v.accountId}),k=q.customerProps,D=q.propertyProps,T=q.sublocationProps,M=q.assetCategoryProps,F=q.assetProps,A=q.supplierProps,E=q.customerManagerProps,R=q.userProps;(0,i.useEffect)(function(){var e,t,r,a,i,l,s,u,d,h,v,f,x,g,b={search:c.search?"%".concat(c.search,"%"):null,status:(null===(e=c.status)||void 0===e?void 0:e.length)>0?null===(t=c.status)||void 0===t?void 0:t.map(function(e){return e.value}):null,tags:(null===(r=c.tags)||void 0===r?void 0:r.length)>0?null===(a=c.tags)||void 0===a?void 0:a.map(function(e){return e.value}):null,customerId:null===(i=c.customerId)||void 0===i?void 0:i.value,locationId:n||(null===(l=c.locationId)||void 0===l?void 0:l.value),sublocationId:null===(s=c.sublocationId)||void 0===s?void 0:s.value,userId:null===(u=c.userId)||void 0===u?void 0:u.value,assetCategoryId:null===(d=c.assetCategoryId)||void 0===d?void 0:d.value,assetId:null===(h=c.assetId)||void 0===h?void 0:h.value,supplierId:null===(v=c.supplierId)||void 0===v?void 0:v.value,customerManagerId:null===(f=c.customerManagerId)||void 0===f?void 0:f.value,allJobs:null===(x=c.allJobs)||void 0===x?void 0:x.value,allItems:null===(g=c.allItems)||void 0===g?void 0:g.value,year:c.year||e1.year,hideExpiredItems:c.hideExpiredItems};C((0,o.Z)({},e1,c)),p(function(e){return(0,o.Z)({},e,b)}),m(e3((0,o.Z)({},e1,c)))},[c,n,C,p,m]);var $=function(e){try{var n=I();d(function(e){return(0,o.Z)({},e,n)})}finally{s()}},N=function(){var e=(0,o.Z)({},e1);d(e),s()};return(0,a.jsx)(eV.Z,{keepMounted:!0,open:t,onClose:s,children:(0,a.jsx)("form",{onSubmit:w($),children:(0,a.jsxs)(e9,{is600pxOrLess:y,children:[(0,a.jsxs)(eH.ZP,{container:!0,columnSpacing:2,rowSpacing:2,children:[(0,a.jsx)(eH.ZP,{item:!0,xs:12,children:(0,a.jsx)(O.Qr,{control:Z,name:"search",render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eG.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search schedule or work order",value:n,onChange:t})}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"status",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,{multiple:!0,limitTags:1,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n||[],onChange:function(e,n){t(n)},options:(0,eU.lR)(),textFieldProps:{color:"secondary",variant:"standard",label:"Select status"}})}})}),g&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(eX.r,{control:Z})}),g&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"customerId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},k),{textFieldProps:{color:"secondary",variant:"standard",label:"Select customer"}}))}})}),!u.includes("location")&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"locationId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},D),{textFieldProps:{color:"secondary",variant:"standard",label:"Select location"}}))}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"sublocationId",control:Z,render:function(e){var t=e.value,i=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({disabled:!_&&!n,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t,onChange:function(e,n){i(n)}},T),{textFieldProps:{color:"secondary",variant:"standard",label:"Select sublocation"}}))}})}),b&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"userId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},R),{textFieldProps:{color:"secondary",variant:"standard",label:"Select user"}}))}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"assetCategoryId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},M),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset category"}}))}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"assetId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},F),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset"}}))}})}),g&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"supplierId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},A),{textFieldProps:{color:"secondary",variant:"standard",label:"Select supplier"}}))}})}),g&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"customerManagerId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},E),{textFieldProps:{color:"secondary",variant:"standard",label:"Select account manager"}}))}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"allJobs",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"compliance",label:"Compliance jobs only"},{value:"overduePPM",label:"Overdue jobs"},{value:"incompleteFollowOn",label:"Incomplete follow on works"},{value:"followOn",label:"Jobs with follow on works"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Jobs"}})}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"allItems",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"complete",label:"with completed jobs"},{value:"incomplete",label:"with incomplete jobs"},{value:"all",label:"with jobs during period"}],textFieldProps:{color:"secondary",variant:"standard",label:"Show all items"}})}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{control:Z,name:"year",render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(ez.M,{views:["year"],inputFormat:"YYYY",value:n,onChange:function(e){e?t(e.toISOString()):t(e)},renderInput:function(e){return(0,a.jsx)(eG.Z,(0,r.Z)((0,o.Z)({},e),{fullWidth:!0,label:"Select year",color:"secondary",variant:"standard"}))}})}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"hideExpiredItems",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eB.Z,{control:(0,a.jsx)(eY.Z,{color:"secondary",checked:n,onChange:function(e,n){return t(n)}}),label:"Hide expired items"})}})})]}),(0,a.jsxs)(l.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,a.jsx)(e6,{variant:"contained",color:"danger",onClick:function(){return N()},children:"Cancel"}),(0,a.jsx)(e6,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})};e4.defaultProps={open:!1,close:function(){},hideFilters:[],filtersFormData:{},setFiltersFormData:function(){},setFilters:function(){},setFiltersChips:function(){}},e4.propTypes={locationId:v().string,open:v().bool,close:v().func,hideFilters:v().array,filtersFormData:v().object,setFiltersFormData:v().func,setFilters:v().func,setFiltersChips:v().func};var e9=(0,eQ.Z)(s.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:n?"0px":"8px",overflowY:"auto"}}),e7=t(37673),e8=t(83178),ne=t(91379),nn=t(45307),nt=t(71799),no=t(96486),nr=function(e){var n=ed()(e).startOf("year").toISOString(),t=ed()(e).endOf("year").toISOString();return{timingStart:{_gte:n,_lte:t}}},na=function(e,n){switch(e){case"compliance":return[{status:{_neq:"canceled"},Compliance:{}}];case"overduePPM":return[{_and:[{status:{_neq:"canceled"}},{timingStart:{_lte:n}},{_not:{statusData:{_has_key:"inProgress"}}},{_not:{statusData:{_has_key:"closed"}}}]}];case"incompleteFollowOn":return[{status:{_neq:"canceled"},Jobs:{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}}];case"followOn":return[{status:{_neq:"canceled"},Jobs:{}}];default:return[]}},ni=function(e){switch(e){case"complete":return[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]}];case"incomplete":return[{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}];default:return[]}},nl=function(e,n){switch(n){case"supplier":return{supplierUserId:{_eq:e}};case"customer":return{customerUserId:{_eq:e}};default:return{}}},ns=function(e,n){var t,o,r,a,i,l,s,u=e.search,c=e.status,d=e.tags,p=e.customerId,m=e.locationId,h=e.sublocationId,v=e.userId,f=e.assetCategoryId,x=e.assetId,g=e.supplierId,b=e.customerManagerId,y=e.allJobs,j=e.allItems,Z=e.year,w=e.hideExpiredItems,C=ed()().subtract(24,"hours").toISOString(),I=[];return I.push(nr(Z)),I.push(g?{_or:[{supplierId:{_eq:g}},{status:{_eq:"offered"},SupplierOffers:{accountId:{_eq:g},status:{_in:["offered","accepted"]}}}]}:{}),I.push(u?{_or:[{reference:{_ilike:u}},{description:{_ilike:u}},{_or:[{JobSchedule:{reference:{_ilike:u}}},{JobSchedule:{description:{_ilike:u}}}]}]}:{}),I.push((null==c?void 0:c.length)>0?{status:{_in:c}}:{}),I.push((null==d?void 0:d.length)>0?{Taxonomy:{entity:{_eq:"Job"},Taxonomy:{status:{_eq:"active"},type:{_eq:"tags"},id:{_in:d}}}}:{}),I.push(nl(v,n)),I.push(x?{Assets:{entity:{_eq:"JobSchedule"},assetId:{_eq:x}}}:{}),I.push(b?{Customer:{Manager:{id:{_eq:b}}}}:{}),I.push.apply(I,(0,eg.Z)(na(y,C))),I.push.apply(I,(0,eg.Z)(ni(j))),I.push(w?{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}:{}),{where:{type:{_eq:"ppm"},locationId:{_eq:m},sublocationId:{_eq:h},assetCategoryId:{_eq:f},customerId:{_eq:p},_and:I.filter(function(e){return!no.isEmpty(e)})}}},nu=t(15741),nc=t(57460),nd=t.n(nc),np=t(16605),nm=t(54610),nh=t(22927),nv=t(35374),nf=function(e){var n,t,s=e.locationId,u=e.initialFilters,c=e.hideFilters,d=e.containerHeight,p=e.tableHeight,m=e.onViewChange,h=(0,L.x)(),v=h.user,x=h.hasRole,y=x("supplier"),j=x("customer"),Z=x("tenant"),w=(0,nv.s)(),C=(0,f.Z)("(max-width: 600px)"),I=(0,f.Z)("(max-width: 1000px)"),q=(0,eE.q)().admin,k=null==q?void 0:null===(n=q.jobSetting)||void 0===n?void 0:n.jobNumberPrefix,T=null==q?void 0:null===(t=q.jobSetting)||void 0===t?void 0:t.jobNumberSuffix,O=(0,D.Z)((0,nn.X)("scheduledjob_table_jobs".concat(u.filterType),u,"network"),2),M=O[0],F=O[1],A=(0,i.useState)(u),E=A[0],R=A[1],$=(0,i.useState)([]),N=$[0],W=$[1],Y=(0,i.useState)(!1),B=Y[0],H=Y[1],V=(0,i.useState)([]),G=V[0],Q=V[1],z=(0,i.useState)(!1),U=z[0],K=z[1],X=(0,i.useState)(!1),ee=X[0],en=X[1],et=(0,eO.x)({filters:E}),eo=et.ref,er=et.initialData,ea=(0,i.useMemo)(function(){return ns((0,o.Z)({},E),v.accountType)},[E,v.accountType]),ei=(0,P.a)(_.As,{variables:(0,o.Z)({},er,ea)}),el=ei.data,es=void 0===el?{jobs:[],meta:{aggregate:{totalCount:0}}}:el,ec=es.jobs,ep=es.meta,em=ei.loading,eh=ei.refetch,ev=(0,D.Z)((0,eu.t)(_.As,{variables:(0,o.Z)((0,r.Z)((0,o.Z)({},er),{limit:null,offset:0}),ea)}),1)[0],ex=(0,i.useCallback)(function(e){var n=[];return j||y||Z||n.push({context:"secondary",icon:"edit",onClick:function(n){return eL().push("/dashboard/issues/manage?id=".concat(e.number))},tooltip:"Edit"}),n.push({context:"secondary",icon:"info",onClick:function(n){return eL().push("/dashboard/issues/view?id=".concat(e.number))},tooltip:"Info"}),n},[j,y,Z]),eb=(0,i.useMemo)(function(){return[{defaultSelected:!0,minWidth:60,field:"id",headerName:"Job ID",renderCell:function(e){var n=e.row;return(0,a.jsx)(eA.D,{id:n.id,number:n.number,openCanvas:!0,type:n.type,numberPrefix:k,numberSuffix:T})}},{defaultSelected:!0,minWidth:60,field:"invoiceNumber",headerName:"Invoice ID",renderCell:function(e){return e.row.invoiceNumber},sortable:!1},{defaultSelected:!0,minWidth:200,field:"service",headerName:"Service",sortName:'{"Service": {"name": "ORDER"}}'},{width:60,field:"type",headerName:"Type",sortable:!1},{minWidth:300,field:"tags",headerName:"Tags",sortable:!1,renderCell:function(e){var n=e.row;return(0,a.jsx)(eN.K,{row:n,refetchQueries:["GetScheduledJobs"],entity:"Job"})}},{defaultSelected:!0,minWidth:200,flex:1,field:"description",headerName:"Description",sortable:!1},{defaultSelected:!0,minWidth:130,flex:1,field:"manager",headerName:"Assigned to",sortName:'{"Manager": {"nameFirst": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,a.jsx)(eR.r,{noWrap:!n.managerId||y,color:"secondary",href:"/dashboard/users/view?id=".concat(n.managerId),children:n.manager})}},{minWidth:130,flex:1,field:"sublocation",headerName:"Sub Location",sortName:'{"Sublocation": {"name": "ORDER"}}',renderCell:function(e){return e.row.sublocation}},{minWidth:130,flex:1,field:"customer",headerName:"Customer",sortName:'{"Customer": {"name": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,a.jsx)(eR.r,{color:"secondary",href:"/dashboard/customers/view?id=".concat(n.customerId),noWrap:j||Z,children:n.customer})}},{defaultSelected:!0,minWidth:180,flex:1,field:"customerManager",headerName:"Account Manager",sortName:'{"Customer": {"Manager": {"fullName": "ORDER"}}}',renderCell:function(e){var n=e.row;return(0,a.jsx)(eR.r,{noWrap:!n.customerManagerId,color:"secondary",href:"/dashboard/users/view?id=".concat(n.customerManagerId),children:n.customerManager})}},{defaultSelected:!0,minWidth:140,flex:1,field:"supplier",headerName:"Supplier",sortName:'{"Supplier": {"name": "ORDER"}}',renderCell:function(e){var n=e.row;return(0,a.jsx)(eR.r,{noWrap:!n.supplierId||y,color:"secondary",href:"/dashboard/suppliers/view?id=".concat(n.supplierId),children:n.supplier})}},{minWidth:140,flex:1,field:"assetCategory",headerName:"Asset Category",sortName:'{"AssetCategory": {"name": "ORDER"}}',renderCell:function(e){return e.row.assetCategory}},{minWidth:140,flex:1,field:"assets",headerName:"Assets Name",sortable:!1,renderCell:function(e){return e.row.assets}},{defaultSelected:!0,minWidth:100,flex:1,field:"scheduled",headerName:"Scheduled",sortName:"timingStart",renderCell:function(e){var n=e.row;return ed()(n.timingStart).format("YYYY-MM-DD")}},{minWidth:100,flex:1,field:"createdAt",headerName:"Created",sortName:"createdAt",renderCell:function(e){var n=e.row;return ed()(n.createdAt).format("YYYY-MM-DD")}},{defaultSelected:!0,minWidth:140,flex:1,field:"status",headerName:"Status",sortName:"status",renderCell:function(e){var n=e.row;return(0,a.jsx)(ef.B,{value:n.status})}},{defaultSelected:!0,width:50,field:"actions",headerName:"Actions",sortable:!1,renderCell:function(e){var n=e.row;return C?(0,a.jsxs)(l.Z,{direction:"row",rowGap:2,children:[(0,a.jsx)(g.Z,{onClick:function(e){return eL().push("/dashboard/issues/manage?id=".concat(n.number))},children:(0,a.jsx)(S.Z,{sx:{color:"#000000"}})}),(0,a.jsx)(g.Z,{onClick:function(e){return eL().push("/dashboard/issues/view?id=".concat(n.number))},children:(0,a.jsx)(nh.Z,{sx:{color:"#000000"}})})]}):(0,a.jsx)(eJ.C,{actionsData:ex,row:n})}}]},[k,T,y,j,Z,C,ex]),ey=(0,i.useMemo)(function(){return ec.map(function(e){var n,t,o,r,a,i,l,s,u,c,d,p,m,h,v,f,x;return{id:e.id,type:e.type,number:e.number,invoiceNumber:(0,eg.Z)(new Set(e.invoices.map(function(e){return e.invoiceNumber}))).join(", ")||"-",service:(null===(n=e.service)||void 0===n?void 0:n.name)||"-",description:(null===(t=e.shortJobDesc)||void 0===t?void 0:null===(o=t[0])||void 0===o?void 0:null===(r=o.taxonomy)||void 0===r?void 0:r.name)||"-",manager:(null===(a=e.manager)||void 0===a?void 0:a.fullName)||"-",managerId:null===(i=e.manager)||void 0===i?void 0:i.id,sublocation:(null===(l=e.sublocation)||void 0===l?void 0:l.name)||"-",customer:null===(s=e.customer)||void 0===s?void 0:s.name,customerId:null===(u=e.customer)||void 0===u?void 0:u.id,customerManager:(null===(c=e.customer)||void 0===c?void 0:null===(d=c.manager)||void 0===d?void 0:d.fullName)||"-",customerManagerId:null===(p=e.customer)||void 0===p?void 0:null===(m=p.manager)||void 0===m?void 0:m.id,supplier:(null===(h=e.supplier)||void 0===h?void 0:h.name)||"-",supplierId:null===(v=e.supplier)||void 0===v?void 0:v.id,assetCategory:(null===(f=e.assetCategory)||void 0===f?void 0:f.name)||"-",assets:(null===(x=e.assets)||void 0===x?void 0:x.map(function(e){return e.asset.name}).join(", "))||"-",timingStart:e.timingStart,createdAt:e.createdAt,status:e.status,tags:e.tags}})},[ec]),ej=(0,i.useMemo)(function(){return j?["manager","supplier","tags"]:y?["customer","customerManager","tags"]:Z?["manager","supplier","tags"]:[]},[j,y,Z]),ew=(0,i.useMemo)(function(){return j?["manager","supplier","tags","actions"]:y?["customer","customerManager","tags","actions"]:Z?["manager","supplier","actions"]:["actions"]},[j,y,Z]),eC=function(e){var n=e.columns;ev().then(function(e){var t=e.data,o=nd().unparse((0,nm.i3)(null==t?void 0:t.jobs,n,nm.ge)),r="data:application/octet-stream,"+encodeURIComponent(o);(0,np.S)(r,"Planned_Maintenance_".concat(ed()().format("YYYY/MM/DD"),".csv"))})},eI=(0,i.useMemo)(function(){return e5(eb,G,ej)},[eb,G,ej]),eS=(0,i.useCallback)(function(e){F(function(n){var t=(0,o.Z)({},n);return delete t[e],t})},[F]),e_=(0,i.useMemo)(function(){return eb.map(function(e){var n,t=e.headerName;return{label:t,value:e.field,defaultSelected:e.defaultSelected}}).filter(function(e){return!ej.includes(e.value)})},[eb,ej]),eP=(0,i.useMemo)(function(){return eb.map(function(e){var n,t=e.headerName;return{label:t,value:e.field,defaultSelected:e.defaultSelected}}).filter(function(e){return!ew.includes(e.value)})},[eb,ew]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(e4,{locationId:s,open:B,close:function(){return H(!1)},hideFilters:c,filtersFormData:M,setFiltersFormData:F,setFilters:R,setFiltersChips:W}),(0,a.jsx)(e7.g,{mainKey:"scheduled_job_table_jobs_column_selector",open:U,close:function(){return K(!1)},columns:e_,setColumns:Q,submitBtnText:"Apply",subtitle:"Select the columns you would like to see in the table."}),(0,a.jsx)(e7.g,{mainKey:"scheduled_job_table_jobs_column_export",open:ee,close:function(){return en(!1)},onCompleted:function(e){return eC(e)},columns:eP,submitBtnText:"Export",subtitle:"Select the columns you would like to export in the csv file."}),(0,a.jsxs)(l.Z,{sx:{height:d},children:[(0,a.jsxs)(J.Z,{pl:2,pr:2,mb:1,mt:1,sx:{display:"grid",alignItems:"flex-start",minHeight:"auto",gridTemplateAreas:I?'"filter-btn calendar-btn"\n                  "filter-chip filter-chip"':'"filter-btn filter-chip calendar-btn"',gridTemplateColumns:I?"auto auto":"206px auto 180px",columnGap:I?0:2,rowGap:I?2:0},children:[(0,a.jsx)(J.Z,{sx:{gridArea:"filter-btn"},children:(0,a.jsxs)(eF.Z,{variant:"contained",children:[(0,a.jsx)(eM.Z,{startIcon:(0,a.jsx)(e8.Z,{}),onClick:function(){return K(!0)},children:"Columns"}),(0,a.jsx)(eM.Z,{startIcon:(0,a.jsx)(e$.Z,{}),onClick:function(){return H(!0)},children:"Filters"})]})}),(0,a.jsx)(J.Z,{sx:{gridArea:"filter-chip",overflow:"hidden"},children:(0,a.jsx)(nt.V,{filtersChips:N,onRemove:eS})}),(0,a.jsxs)(J.Z,{sx:{gridArea:"calendar-btn",justifySelf:"flex-end"},children:[!w&&!C&&(0,a.jsx)(eM.Z,{onClick:function(){return en(!0)},disableMinWidth:!0,color:"info",variant:"contained",sx:{height:"36.5px"},children:(0,a.jsx)(ne.Z,{})}),(0,a.jsx)(eM.Z,{variant:"contained",color:"info",startIcon:(0,a.jsx)(b.Z,{component:eZ,inheritViewBox:!0}),onClick:function(e){return m("calendar")},sx:{minWidth:"110px",marginLeft:"10px!important"},children:"Calendar"})]})]}),(0,a.jsx)(nu.n,{autoHeight:!1,ref:eo,loading:em,columns:eb,rows:ey,meta:ep,refetch:eh,containerHeight:p,columnVisibilityModel:eI})]})]})};nf.defaultProps={initialFilters:{},containerHeight:"calc(100vh)",tableHeight:"calc(100% - 32px)"};var nx=t(14647),ng=t(12978),nb=t(99534),ny=t(90263),nj=t(21023),nZ=t(48999);function nw(){return(nw=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let nC=e=>i.createElement("svg",nw({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),i.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957A11.5 11.5 0 1 0 21.007 5.03c-.31-.457-.944-.518-1.372-.169l-6.503 5.307a1 1 0 0 1-1.632-.775z"}),i.createElement("path",{fill:"#E9175E",d:"M18.472 4.944c.318-.267.446-.708.258-1.079-.49-.97-1.293-1.791-2.43-2.365a9 9 0 0 0-3.314-.963C12.44.489 12 .94 12 1.487V8.24a1 1 0 0 0 1.644.765z"}));function nI(){return(nI=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let nS=e=>i.createElement("svg",nI({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),i.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957A11.5 11.5 0 1 0 22.957 12.5c.047-.55-.405-.999-.957-.999h-9.5a1 1 0 0 1-1-1z"}),i.createElement("path",{fill:"#E9175E",d:"M21.399 10.31a1 1 0 0 0 1-1v-.332a9.56 9.56 0 0 0-5.159-7.202 9.7 9.7 0 0 0-3.506-.988c-.55-.048-.993.41-.985.963l.108 7.574a1 1 0 0 0 1 .985h7.542"}));function n_(){return(n_=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let nP=e=>i.createElement("svg",n_({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),i.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957a11.5 11.5 0 1 0 9.804 18.854c.355-.423.243-1.05-.21-1.367l-8.17-5.731a1 1 0 0 1-.425-.819z"}),i.createElement("path",{fill:"#E9175E",d:"M20.395 16.094c.461.319 1.107.189 1.37-.316a10.8 10.8 0 0 0 1.207-4.395 10.55 10.55 0 0 0-1.14-5.41A9.9 9.9 0 0 0 18.15 2.01a9.6 9.6 0 0 0-4.17-1.348c-.55-.045-.996.417-.995.968l.018 8.842c0 .323.157.623.421.805z"}));function nq(){return(nq=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let nk=e=>i.createElement("svg",nq({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 24 23"},e),i.createElement("path",{fill:"#1AB43B",d:"M11.5 1c0-.552-.449-1.005-.999-.957a11.5 11.5 0 0 0 0 22.914c.55.047.999-.405.999-.957V1"}),i.createElement("path",{fill:"#E9175E",d:"M12 1c0-.552.448-1.004.999-.96 2.817.225 5.472 1.398 7.486 3.328C22.735 5.525 24 8.45 24 11.5s-1.264 5.975-3.515 8.132c-2.014 1.93-4.67 3.103-7.486 3.328-.55.044-.999-.408-.999-.96V1"}));function nD(){return(nD=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let nT=e=>i.createElement("svg",nD({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),i.createElement("path",{fill:"#E9175E",d:"M11.5 1c0-.552.449-1.005.999-.957a11.5 11.5 0 1 1-9.804 18.854c-.356-.423-.243-1.05.21-1.367l8.17-5.731a1 1 0 0 0 .425-.819z"}),i.createElement("path",{fill:"#1AB43B",d:"M2.963 16.078c-.463.326-1.117.194-1.379-.318a10.95 10.95 0 0 1-1.178-4.377 10.7 10.7 0 0 1 1.121-5.41A9.85 9.85 0 0 1 5.151 2.01 9.3 9.3 0 0 1 9.237.663c.548-.046.995.416.994.967l-.018 8.846a.98.98 0 0 1-.415.801z"}));function nO(){return(nO=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let nM=e=>i.createElement("svg",nO({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),i.createElement("path",{fill:"#E9175E",d:"M11.5 1c0-.552.449-1.005.999-.957A11.5 11.5 0 1 1 .043 12.5c-.048-.55.405-.999.957-.999h9.5a1 1 0 0 0 1-1z"}),i.createElement("path",{fill:"#1AB43B",d:"M1.601 10.31a1 1 0 0 1-1-1v-.332A9.56 9.56 0 0 1 5.76 1.776 9.7 9.7 0 0 1 9.266.788c.55-.048.993.41.985.963l-.108 7.574a1 1 0 0 1-1 .985H1.601"}));function nF(){return(nF=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let nA=e=>i.createElement("svg",nF({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),i.createElement("path",{fill:"#E9175E",d:"M11.5 1c0-.552.449-1.005.999-.957A11.5 11.5 0 1 1 1.993 5.03c.31-.457.944-.518 1.372-.169l6.503 5.307a1 1 0 0 0 1.632-.775z"}),i.createElement("path",{fill:"#1AB43B",d:"M4.528 4.944c-.318-.267-.446-.708-.258-1.079.49-.97 1.293-1.791 2.43-2.365a9 9 0 0 1 3.314-.963c.545-.048.985.404.985.95V8.24a1 1 0 0 1-1.644.765z"}));function nE(){return(nE=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var o in t)({}).hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e}).apply(null,arguments)}let nR=e=>i.createElement("svg",nE({xmlns:"http://www.w3.org/2000/svg",width:"1em",height:"1em",fill:"none",viewBox:"0 0 23 23"},e),i.createElement("circle",{cx:11.5,cy:11.5,r:11.5,fill:"#1AB43B",transform:"rotate(-90 11.5 11.5)"}));var n$=function(e){var n,t,o=e.data,r=o[0]||0,i=r+(o[1]||0),l=r/i*100;return 0===i?(0,a.jsx)(nN,{component:nR,inheritViewBox:!0,color:"gray"}):(0,a.jsx)("div",{children:(0===l?(n=nR,t="danger"):l>0&&l<=12.5?n=nA:l>12.5&&l<=25?n=nM:l>25&&l<50?n=nT:50===l?n=nk:l>50&&l<=62.5?n=nP:l>62.5&&l<=75?n=nS:l>75&&l<100?n=nC:100===l&&(n=nR,t="success"),(0,a.jsx)(nN,{component:n,inheritViewBox:!0,color:t}))})};n$.defaultProps={data:[]},n$.propTypes={data:v().array};var nN=(0,u.ZP)(b.Z)(function(e){var n=e.theme,t=e.color;return{"& path, circle":(0,o.Z)({},"success"===t&&{fill:n.palette.success.main},"danger"===t&&{fill:n.palette.danger.main},"gray"===t&&{fill:"#BFBFBF"})}}),nW=t(6775);function nL(e){var n=e.title,t=e.month,o=e.year,r=e.complete,i=e.inComplete,s=e.followOn,u=e.inCompleteCompliance;return(0,a.jsx)(J.Z,{sx:{padding:"8px 16px"},children:(0,a.jsxs)(l.Z,{spacing:1,children:[(t||o)&&(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",spacing:.5,children:[t&&(0,a.jsxs)(y.Z,{variant:"h6",children:[t," "]}),o&&(0,a.jsx)(y.Z,{variant:"h6",sx:{opacity:"0.54"},children:o})]}),n&&(0,a.jsx)(y.Z,{variant:"h6",children:n}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",children:[(0,a.jsx)(nJ,{mr:1,bgcolor:"success.main"})," ",(0,a.jsxs)(y.Z,{children:["Complete: ",r]})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",children:[(0,a.jsx)(nJ,{mr:1,bgcolor:"danger.main"})," ",(0,a.jsxs)(y.Z,{children:["Incomplete: ",i]})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",children:[(0,a.jsx)(nJ,{mr:1,bgcolor:"info.main"})," ",(0,a.jsxs)(y.Z,{children:["Follow on jobs: ",s]})]}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",children:[(0,a.jsx)(nW.Z,{sx:{height:"14px",width:"14px",marginRight:"8px",color:"danger.main"}}),(0,a.jsxs)(y.Z,{children:["Incomplete compliance jobs: ",u]})]})]})})}nL.defaultProps={month:"",year:"",complete:0,inComplete:0,followOn:0,inCompleteCompliance:0},nL.propTypes={month:v().string,year:v().string,complete:v().number,inComplete:v().number,followOn:v().number,inCompleteCompliance:v().number};var nJ=(0,u.ZP)(J.Z)(function(e){return e.theme,{width:14,height:14,borderRadius:"50%"}}),nY=function(e){var n=e.year,t=e.month,o=e.total,r=e.complete,i=e.inComplete,s=e.followOn,u=e.inCompleteCompliance,c=e.onClick,d=[0,0];return ed()().isSameOrAfter(ed()().month(t).year(n))&&(d[0]=r,d[1]=i),(0,a.jsx)(nB,{followCursor:!0,title:(0,a.jsx)(nL,{year:n,month:t,complete:r,inComplete:i,followOn:s,inCompleteCompliance:u}),children:(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",justifyContent:"center",spacing:2,sx:{height:"92px",padding:"0px 12px",borderRadius:1,backgroundColor:"#F2F2F2"},onClick:c,children:[(0,a.jsx)(ny.Z,{color:"info",variant:"dot",invisible:0===s,children:(0,a.jsx)(J.Z,{sx:{padding:"2px 6px",borderRadius:1,backgroundColor:"#FFFFFF"},children:(0,a.jsx)(y.Z,{fontWeight:600,children:o})})}),(0,a.jsx)("div",{children:(0,a.jsx)(n$,{data:d})})]})})};nY.defaultProps={year:"",month:"",total:0,complete:0,inComplete:0,followOn:0,inCompleteCompliance:0,onClick:function(){}},nY.propTypes={year:v().string,month:v().string,total:v().number,complete:v().number,inComplete:v().number,followOn:v().number,inCompleteCompliance:v().number,onClick:v().func};var nB=(0,u.ZP)(function(e){var n=e.className,t=(0,nb.Z)(e,["className"]);return(0,a.jsx)(nj.Z,(0,r.Z)((0,o.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,e2.Z)({},"& .".concat(nZ.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),nH=function(e){var n=e.children,t=e.selected,o=(0,f.Z)("(max-width: 600px)");return(0,a.jsx)(nV,{selected:t,isWidth600PxOrLess:o,children:(0,a.jsx)(y.Z,{children:n})})};nH.defaultProps={selected:!1},nH.propTypes={children:v().node,selected:v().bool};var nV=(0,u.ZP)(J.Z)(function(e){var n=e.theme,t=e.selected,o=e.isWidth600PxOrLess;return{display:"flex",justifyContent:"center",alignItems:"center",padding:"4px 20px",borderRadius:"8px",backgroundColor:t&&!o?n.palette.secondary.main:"none","& .MuiTypography-root":{fontWeight:t?400:700,color:t?n.palette.secondary.contrastText:n.palette.black.main}}}),nG=function(e){var n=e.jobs,t=e.timePeriods,o=e.year,r={},a={count:0,completeCount:0,inCompleteCount:0,followOnCount:0,inCompleteComplianceCount:0};return t.forEach(function(e){var t=e.value,i={count:0,completeCount:0,inCompleteCount:0,followOnCount:0,inCompleteComplianceCount:0},l=ed()().month(t).year(o).startOf("month"),s=ed()().month(t).year(o).endOf("month"),u=nQ(n,l,s);i.count=u.count,i.completeCount=u.completeCount,i.inCompleteCount=u.inCompleteCount,i.followOnCount=u.followOnCount,i.inCompleteComplianceCount=u.inCompleteComplianceCount,a.count+=i.count,a.completeCount+=i.completeCount,a.inCompleteCount+=i.inCompleteCount,a.followOnCount+=i.followOnCount,a.inCompleteComplianceCount+=i.inCompleteComplianceCount,r[t]=i}),{countByPeriod:r,totalCount:a}},nQ=function(e,n,t){var o={count:0,completeCount:0,inCompleteCount:0,followOnCount:0,inCompleteComplianceCount:0};return e.forEach(function(e){var r,a;ed()(e.timingStart).isBetween(n,t,null,"[]")&&((null===(r=e.statusData)||void 0===r?void 0:r.completed)||(null===(a=e.statusData)||void 0===a?void 0:a.closed)?o.completeCount++:(o.inCompleteCount++,e.hasCompliance&&o.inCompleteComplianceCount++),o.count++)}),o},nz=t(45451),nU=function(e){var n=e.year,t=e.total,o=e.complete,r=e.inComplete,i=e.followOn,s=e.inCompleteCompliance;return(0,a.jsx)(nK,{followCursor:!0,title:(0,a.jsx)(nL,{year:n,complete:o,inComplete:r,followOn:i,inCompleteCompliance:s}),children:(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",justifyContent:"center",spacing:2,sx:{height:"92px",padding:"0px 12px",borderRadius:1,border:"1px solid #BFBFBF"},children:[(0,a.jsx)(ny.Z,{color:"info",variant:"dot",invisible:0===i,children:(0,a.jsx)(J.Z,{sx:{padding:"2px 6px",borderRadius:1,backgroundColor:"#F2F2F2"},children:(0,a.jsx)(y.Z,{fontWeight:600,children:t})})}),(0,a.jsx)("div",{children:(0,a.jsx)(n$,{data:[o,r]})})]})})};nU.defaultProps={year:"",month:"",total:0,complete:0,inComplete:0,followOn:0,inCompleteCompliance:0,chartColors:[],chartRotation:0},nU.propTypes={year:v().string,total:v().number,complete:v().number,inComplete:v().number,followOn:v().number,inCompleteCompliance:v().number};var nK=(0,u.ZP)(function(e){var n=e.className,t=(0,nb.Z)(e,["className"]);return(0,a.jsx)(nj.Z,(0,r.Z)((0,o.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,e2.Z)({},"& .".concat(nZ.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),nX=function(e,n){switch(e){case"compliance":return[{status:{_neq:"canceled"},Compliance:{}}];case"overduePPM":return[{_and:[{status:{_neq:"canceled"}},{timingStart:{_lte:n}},{_not:{statusData:{_has_key:"inProgress"}}},{_not:{statusData:{_has_key:"closed"}}}]}];case"incompleteFollowOn":return[{status:{_neq:"canceled"},Jobs:{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}}];case"followOn":return[{status:{_neq:"canceled"},Jobs:{}}];default:return[]}},n0=function(e){switch(e){case"complete":return[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]}];case"incomplete":return[{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}];default:return[]}},n1=function(e,n){switch(n){case"supplier":return{supplierUserId:{_eq:e}};case"customer":return{customerUserId:{_eq:e}};default:return{}}},n2=function(e,n){var t,r,a,i,l,s,u,c=e.search,d=e.status,p=e.tags,m=e.customerId,h=e.locationId,v=e.sublocationId,f=e.userId,x=e.assetCategoryId,g=e.assetId,b=e.supplierId,y=e.customerManagerId,j=e.allJobs,Z=e.allItems,w=(e.year,e.hideExpiredItems),C=ed()().subtract(24,"hours").toISOString(),I=[];I.push(b?{_or:[{supplierId:{_eq:b}},{status:{_eq:"offered"},SupplierOffers:{accountId:{_eq:b},status:{_in:["offered","accepted"]}}}]}:{}),I.push((null==d?void 0:d.length)>0?{status:{_in:d}}:{}),I.push((null==p?void 0:p.length)>0?{Taxonomy:{entity:{_eq:"Job"},Taxonomy:{status:{_eq:"active"},type:{_eq:"tags"},id:{_in:p}}}}:{}),I.push(n1(f,n)),I.push(g?{Assets:{entity:{_eq:"JobSchedule"},assetId:{_eq:g}}}:{}),I.push(y?{Customer:{Manager:{id:{_eq:y}}}}:{}),I.push.apply(I,(0,eg.Z)(nX(j,C))),I.push.apply(I,(0,eg.Z)(n0(Z))),I.push(w?{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}:{}),I.push(c?{_or:[{reference:{_ilike:c}},{description:{_ilike:c}},{_or:[{JobSchedule:{reference:{_ilike:c}}},{JobSchedule:{description:{_ilike:c}}}]}]}:{});var S=I.filter(function(e){return!no.isEmpty(e)});return{where:(0,o.Z)({locationId:{_eq:h},sublocationId:{_eq:v},customerId:{_eq:m},assetCategoryId:{_eq:x}},S.length>0||"all"===Z?(0,o.Z)({},S.length>0&&{_and:S}):{})}},n5=function(e){var n,t,l,s=e.filters,u=e.accountType,c=e.year,d=e.month,p=(0,i.useMemo)(function(){return ed()().month(d).year(c).startOf("month").toISOString()},[d,c]),m=(0,i.useMemo)(function(){return ed()().month(d).year(c).endOf("month").toISOString()},[d,c]),h=(0,i.useMemo)(function(){return n2((0,o.Z)({},s),u)},[s,u]),v=(0,P.a)(_.P0,{variables:{whereComplete:(0,r.Z)((0,o.Z)({},h.where),{type:{_eq:"ppm"},status:{_neq:"canceled"},_and:[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]},(0,o.Z)({},Array.isArray(null===(n=h.where)||void 0===n?void 0:n._and)&&h.where._and.length>0?{_and:h.where._and}:{})],timingStart:{_gte:p,_lte:m}}),whereIncomplete:(0,r.Z)((0,o.Z)({},h.where),{type:{_eq:"ppm"},status:{_neq:"canceled"},_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}},(0,o.Z)({},Array.isArray(null===(t=h.where)||void 0===t?void 0:t._and)&&h.where._and.length>0?{_and:h.where._and}:{})],timingStart:{_gte:p,_lte:m}}),whereFollowOn:(0,r.Z)((0,o.Z)({},h.where),{type:{_eq:"ppm"},status:{_neq:"canceled"},Jobs:{},timingStart:{_gte:p,_lte:m}}),whereIncompleteCompliance:(0,r.Z)((0,o.Z)({},h.where),{type:{_eq:"ppm"},status:{_neq:"canceled"},_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}},(0,o.Z)({},Array.isArray(null===(l=h.where)||void 0===l?void 0:l._and)&&h.where._and.length>0?{_and:h.where._and}:{})],Jobs:{},timingStart:{_gte:p,_lte:m}})}}),f=v.data,x=void 0===f?{jobsCompleteCount:{aggregate:{count:0}},jobsIncompleteCount:{aggregate:{count:0}},jobsFollowOnCount:{aggregate:{count:0}},jobsIncompleteComplianceCount:{aggregate:{count:0}}}:f,g=x.jobsCompleteCount.aggregate.count,b=x.jobsIncompleteCount.aggregate.count,j=x.jobsFollowOnCount.aggregate.count,Z=x.jobsIncompleteComplianceCount.aggregate.count,w=v.loading,C=g+b;return w?null:(0,a.jsx)(n6,{followCursor:!0,title:(0,a.jsx)(nL,{year:c,month:d,complete:g,inComplete:b,followOn:j,inCompleteCompliance:Z}),children:(0,a.jsxs)(eH.ZP,{container:!0,width:"100%",justifyContent:"center",alignItems:"center",children:[(0,a.jsx)(eH.ZP,{item:!0,xs:12,order:{xs:2,md:1,lg:1},sx:{textAlign:"center"},children:(0,a.jsxs)(y.Z,{color:"#323E4E",children:[C," ",C>1?"jobs":"job"]})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,order:{xs:1,md:2,lg:2},sx:{display:"flex",width:"100%",alignItems:"center",height:"4px"},children:0!==C&&ed()().isAfter(p)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n3,{percentage:g/C*100,color:"success"}),(0,a.jsx)(n3,{percentage:b/C*100,color:"danger"})]}):(0,a.jsx)(n3,{percentage:100,color:"gray"})})]})})};n5.defaultProps={month:""},n5.propTypes={filters:v().object.isRequired,accountType:v().string.isRequired,year:v().number,month:v().string};var n3=(0,u.ZP)(J.Z)(function(e){var n=e.theme,t=e.percentage,a=e.color;return(0,o.Z)({width:"".concat(t,"%"),height:"100%"},"success"===a&&(0,r.Z)((0,o.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"4px 0 0 4px"}),{backgroundColor:n.palette.success.main}),"danger"===a&&(0,r.Z)((0,o.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"0px 4px 4px 0px"}),{backgroundColor:n.palette.danger.main}),"gray"===a&&{borderRadius:"4px",backgroundColor:"#BFBFBF"})}),n6=(0,u.ZP)(function(e){var n=e.className,t=(0,nb.Z)(e,["className"]);return(0,a.jsx)(nj.Z,(0,r.Z)((0,o.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,e2.Z)({},"& .".concat(nZ.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),n4=t(44844),n9=t(57493),n7=function(e){var n=e.locationIdWatch,t=e.assetCategoryIdWatch,o=e.locationId,r=e.accountId,a=(0,i.useState)(""),l=a[0],s=a[1],u=(0,i.useState)(""),c=u[0],d=u[1],p=(0,i.useState)(""),m=p[0],h=p[1],v=(0,i.useState)(""),f=v[0],x=v[1],g=(0,i.useState)(""),b=g[0],y=g[1],j=(0,i.useState)(""),Z=j[0],w=j[1],C=(0,i.useState)(""),I=C[0],S=C[1],_=(0,i.useState)(""),P=_[0],q=_[1],k=(0,D.Z)((0,eu.t)(n9.SW,{variables:{q:""!==l?"%".concat(l,"%"):null,limit:50,offset:0}}),2),T=k[0],O=k[1],M=O.loading,F=O.data,A=(void 0===F?{items:[]}:F).items,E=(0,D.Z)((0,eu.t)(n9._d,{variables:{where:{name:{_ilike:""!==c?"%".concat(c,"%"):null},status:{_eq:"active"}},limit:50,offset:0}}),2),R=E[0],$=E[1],N=$.loading,W=$.data,L=(void 0===W?{items:[]}:W).items,J=(0,D.Z)((0,eu.t)(n9.zR,{variables:{locationId:n||o,q:""!==m?"%".concat(m,"%"):null,limit:50,offset:0}}),2),Y=J[0],B=J[1],H=B.loading,V=B.data,G=(void 0===V?{items:[]}:V).items,Q=(0,D.Z)((0,eu.t)(n9._f,{variables:{where:{type:{_eq:"assetCategory"},isGroup:{_eq:!1},status:{_eq:"active"},name:{_ilike:""!==f?"%".concat(f,"%"):null}},limit:50,offset:0,orderBy:{name:"asc"}}}),2),z=Q[0],U=Q[1],K=U.loading,X=U.data,ee=(void 0===X?{items:[]}:X).items,en=(0,D.Z)((0,eu.t)(n9.UH,{variables:{locationId:(null==n?void 0:n.value)||o,categoryId:null==t?void 0:t.value,q:""!==b?"%".concat(b,"%"):null,limit:50,offset:0}}),2),et=en[0],eo=en[1],er=eo.loading,ea=eo.data,ei=(void 0===ea?{items:[]}:ea).items,el=(0,D.Z)((0,eu.t)(n9.by,{variables:{where:{type:{_eq:"supplier"},name:{_ilike:""!==Z?"%".concat(Z,"%"):null}},limit:50,offset:0}}),2),es=el[0],ec=el[1],ed=ec.loading,ep=ec.data,em=(void 0===ep?{items:[]}:ep).items,eh=(0,D.Z)((0,eu.t)(n9.K4,{variables:{accountId:r,limit:50,offset:0,q:""!==I?"%".concat(I,"%"):null}}),2),ev=eh[0],ef=eh[1],ex=ef.data,eg=(void 0===ex?{items:[]}:ex).items,eb=ef.loading,ey=(0,D.Z)((0,eu.t)(n9.yR,{variables:{accountId:r,q:""!==P?"%".concat(P,"%"):null,limit:50,offset:0}}),2),ej=ey[0],eZ=ey[1],ew=eZ.data,eC=(void 0===ew?{items:[]}:ew).items;return{customerProps:{onOpen:T,loading:M,options:A,setSearch:s},propertyProps:{onOpen:R,loading:N,options:L,setSearch:d},sublocationProps:{onOpen:Y,loading:H,options:G,setSearch:h},assetCategoryProps:{onOpen:z,loading:K,options:ee,setSearch:x},assetProps:{onOpen:et,loading:er,options:ei,setSearch:y},supplierProps:{onOpen:es,loading:ed,options:em,setSearch:w},customerManagerProps:{onOpen:ev,loading:eb,options:eg,setSearch:S},userProps:{onOpen:ej,loading:eZ.loading,options:eC,setSearch:q}}},n8={search:"",year:ed()(),status:null,tags:null,customerId:null,locationId:null,sublocationId:null,userId:null,assetCategoryId:null,assetId:null,supplierId:null,customerManagerId:null,allJobs:null,allItems:null,hideExpiredItems:!1},te=function(e){var n={search:function(e){return!!e&&"Search is ".concat(e)},year:function(e){return!!e&&"".concat(ed()(e).format("YYYY"))},status:function(e){return(null==e?void 0:e.length)>0&&"Status is ".concat(null==e?void 0:e.map(function(e){return e.label}).join(", "))},tags:function(e){return(null==e?void 0:e.length)>0&&"Tags is ".concat(null==e?void 0:e.map(function(e){return e.label}).join(", "))},customerId:function(e){return null!=e&&!!e.label&&"Customer is ".concat(null==e?void 0:e.label)},locationId:function(e){return null!=e&&!!e.label&&"Location is ".concat(null==e?void 0:e.label)},sublocationId:function(e){return null!=e&&!!e.label&&"Sublocation is ".concat(null==e?void 0:e.label)},userId:function(e){return null!=e&&!!e.label&&"User is ".concat(null==e?void 0:e.label)},assetCategoryId:function(e){return null!=e&&!!e.label&&"Asset Category is ".concat(null==e?void 0:e.label)},assetId:function(e){return null!=e&&!!e.label&&"Asset is ".concat(null==e?void 0:e.label)},supplierId:function(e){return null!=e&&!!e.label&&"Supplier is ".concat(null==e?void 0:e.label)},customerManagerId:function(e){return null!=e&&!!e.label&&"Customer Manager is ".concat(null==e?void 0:e.label)},allJobs:function(e){return null!=e&&!!e.label&&"All Jobs is ".concat(null==e?void 0:e.label)},allItems:function(e){return null!=e&&!!e.label&&"All Items is ".concat(null==e?void 0:e.label)},hideExpiredItems:function(e){return!!e&&"Exclude expired items"}};return Object.entries(e).reduce(function(e,t){var o=(0,D.Z)(t,2),r=o[0],a=o[1];if(!a||!n[r])return e;var i=(0,n[r])(a);return i&&e.push({key:r,label:i}),e},[])},tn=eM.Z,tt=function(e){var n=e.locationId,t=e.open,s=e.close,u=e.hideFilters,c=e.filtersFormData,d=e.setFiltersFormData,p=e.setFilters,m=e.setFiltersChips,h=(0,L.x)(),v=h.user,x=h.hasRole,g=x("admin"),b=x(["customer","supplier"]),y=(0,f.Z)("(max-width: 600px)"),j=(0,O.cI)({defaultValues:(0,o.Z)({},n8)}),Z=j.control,w=j.handleSubmit,C=j.reset,I=j.getValues,S=j.watch,_=S("locationId"),P=S("assetCategoryId"),q=n7({locationIdWatch:_,assetCategoryIdWatch:P,locationId:n,accountId:v.accountId}),k=q.customerProps,D=q.propertyProps,T=q.sublocationProps,M=q.assetCategoryProps,F=q.assetProps,A=q.supplierProps,E=q.customerManagerProps,R=q.userProps;(0,i.useEffect)(function(){var e,t,r,a,i,l,s,u,d,h,v,f,x,g,b={search:c.search?"%".concat(c.search,"%"):null,status:(null===(e=c.status)||void 0===e?void 0:e.length)>0?null===(t=c.status)||void 0===t?void 0:t.map(function(e){return e.value}):null,tags:(null===(r=c.tags)||void 0===r?void 0:r.length)>0?null===(a=c.tags)||void 0===a?void 0:a.map(function(e){return e.value}):null,customerId:null===(i=c.customerId)||void 0===i?void 0:i.value,locationId:n||(null===(l=c.locationId)||void 0===l?void 0:l.value),sublocationId:null===(s=c.sublocationId)||void 0===s?void 0:s.value,userId:null===(u=c.userId)||void 0===u?void 0:u.value,assetCategoryId:null===(d=c.assetCategoryId)||void 0===d?void 0:d.value,assetId:null===(h=c.assetId)||void 0===h?void 0:h.value,supplierId:null===(v=c.supplierId)||void 0===v?void 0:v.value,customerManagerId:null===(f=c.customerManagerId)||void 0===f?void 0:f.value,allJobs:null===(x=c.allJobs)||void 0===x?void 0:x.value,allItems:null===(g=c.allItems)||void 0===g?void 0:g.value,year:c.year||n8.year,hideExpiredItems:c.hideExpiredItems};C((0,o.Z)({},n8,c)),p(function(e){return(0,o.Z)({},e,b)}),m(te((0,o.Z)({},n8,c)))},[c,n,C,p,m]);var $=function(e){try{var n=I();d(function(e){return(0,o.Z)({},e,n)})}finally{s()}},N=function(){var e=(0,o.Z)({},n8);d(e),s()};return(0,a.jsx)(eV.Z,{keepMounted:!0,open:t,onClose:s,children:(0,a.jsx)("form",{onSubmit:w($),children:(0,a.jsxs)(to,{is600pxOrLess:y,children:[(0,a.jsxs)(eH.ZP,{container:!0,columnSpacing:2,rowSpacing:2,children:[(0,a.jsx)(eH.ZP,{item:!0,xs:12,children:(0,a.jsx)(O.Qr,{control:Z,name:"search",render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eG.Z,{fullWidth:!0,variant:"standard",color:"secondary",label:"Search schedule or work order",value:n,onChange:t})}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"status",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,{multiple:!0,limitTags:1,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n||[],onChange:function(e,n){t(n)},options:(0,eU.lR)(),textFieldProps:{color:"secondary",variant:"standard",label:"Select status"}})}})}),g&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(eX.r,{control:Z})}),g&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"customerId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},k),{textFieldProps:{color:"secondary",variant:"standard",label:"Select customer"}}))}})}),!u.includes("location")&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"locationId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},D),{textFieldProps:{color:"secondary",variant:"standard",label:"Select location"}}))}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"sublocationId",control:Z,render:function(e){var t=e.value,i=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({disabled:!_&&!n,filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t,onChange:function(e,n){i(n)}},T),{textFieldProps:{color:"secondary",variant:"standard",label:"Select sublocation"}}))}})}),b&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"userId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},R),{textFieldProps:{color:"secondary",variant:"standard",label:"Select user"}}))}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"assetCategoryId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},M),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset category"}}))}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"assetId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},F),{textFieldProps:{color:"secondary",variant:"standard",label:"Select asset"}}))}})}),g&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"supplierId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},A),{textFieldProps:{color:"secondary",variant:"standard",label:"Select supplier"}}))}})}),g&&(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"customerManagerId",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)}},E),{textFieldProps:{color:"secondary",variant:"standard",label:"Select account manager"}}))}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"allJobs",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"compliance",label:"Compliance jobs only"},{value:"overduePPM",label:"Overdue jobs"},{value:"incompleteFollowOn",label:"Incomplete follow on works"},{value:"followOn",label:"Jobs with follow on works"}],textFieldProps:{color:"secondary",variant:"standard",label:"All Jobs"}})}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"allItems",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eK.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:n,onChange:function(e,n){t(n)},options:[{value:"complete",label:"with completed jobs"},{value:"incomplete",label:"with incomplete jobs"},{value:"all",label:"with jobs during period"}],textFieldProps:{color:"secondary",variant:"standard",label:"Show all items"}})}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{control:Z,name:"year",render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(ez.M,{views:["year"],inputFormat:"YYYY",value:n,onChange:function(e){e?t(e.toISOString()):t(e)},renderInput:function(e){return(0,a.jsx)(eG.Z,(0,r.Z)((0,o.Z)({},e),{fullWidth:!0,label:"Select year",color:"secondary",variant:"standard"}))}})}})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,sm:6,children:(0,a.jsx)(O.Qr,{name:"hideExpiredItems",control:Z,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(eB.Z,{control:(0,a.jsx)(eY.Z,{color:"secondary",checked:n,onChange:function(e,n){return t(n)}}),label:"Hide expired items"})}})})]}),(0,a.jsxs)(l.Z,{width:"100%",direction:"row",justifyContent:"flex-end",alignItems:"center",spacing:2,mt:3,children:[(0,a.jsx)(tn,{variant:"contained",color:"danger",onClick:function(){return N()},children:"Cancel"}),(0,a.jsx)(tn,{variant:"contained",color:"secondary",type:"submit",children:"Search"})]})]})})})};tt.defaultProps={open:!1,close:function(){},hideFilters:[],filtersFormData:{},setFiltersFormData:function(){},setFilters:function(){},setFiltersChips:function(){}},tt.propTypes={locationId:v().number,open:v().bool,close:v().func,hideFilters:v().array,filtersFormData:v().object,setFiltersFormData:v().func,setFilters:v().func,setFiltersChips:v().func};var to=(0,eQ.Z)(s.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"500px",height:n?"100vh":"auto",padding:"16px 27px 16px 27px",borderRadius:n?"0px":"8px",overflowY:"auto"}}),tr=function(e){var n,t,s,u=e.filters,c=e.accountType,d=e.year,p=(0,i.useMemo)(function(){return ed()().year(d).startOf("year").toISOString()},[d]),m=(0,i.useMemo)(function(){return ed()().year(d).endOf("year").toISOString()},[d]),h=(0,i.useMemo)(function(){return n2((0,o.Z)({},u),c)},[u,c]),v=(0,P.a)(_.P0,{variables:{whereComplete:(0,r.Z)((0,o.Z)({},h.where),{type:{_eq:"ppm"},status:{_neq:"canceled"},_and:[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]},(0,o.Z)({},Array.isArray(null===(n=h.where)||void 0===n?void 0:n._and)&&h.where._and.length>0?{_and:h.where._and}:{})],timingStart:{_gte:p,_lte:m}}),whereIncomplete:(0,r.Z)((0,o.Z)({},h.where),{type:{_eq:"ppm"},status:{_neq:"canceled"},_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}},(0,o.Z)({},Array.isArray(null===(t=h.where)||void 0===t?void 0:t._and)&&h.where._and.length>0?{_and:h.where._and}:{})],timingStart:{_gte:p,_lte:m}}),whereFollowOn:(0,r.Z)((0,o.Z)({},h.where),{type:{_eq:"ppm"},status:{_neq:"canceled"},Jobs:{},timingStart:{_gte:p,_lte:m}}),whereIncompleteCompliance:(0,r.Z)((0,o.Z)({},h.where),{type:{_eq:"ppm"},status:{_neq:"canceled"},_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}},(0,o.Z)({},Array.isArray(null===(s=h.where)||void 0===s?void 0:s._and)&&h.where._and.length>0?{_and:h.where._and}:{})],Jobs:{},timingStart:{_gte:p,_lte:m}})}}),f=v.data,x=void 0===f?{jobsCompleteCount:{aggregate:{count:0}},jobsIncompleteCount:{aggregate:{count:0}},jobsFollowOnCount:{aggregate:{count:0}},jobsIncompleteComplianceCount:{aggregate:{count:0}}}:f,g=x.jobsCompleteCount.aggregate.count,b=x.jobsIncompleteCount.aggregate.count,j=x.jobsFollowOnCount.aggregate.count,Z=x.jobsIncompleteComplianceCount.aggregate.count,w=v.loading,C=g+b;return w?null:(0,a.jsx)(ti,{followCursor:!0,title:(0,a.jsx)(nL,{year:d,complete:g,inComplete:b,followOn:j,inCompleteCompliance:Z}),children:(0,a.jsxs)(l.Z,{width:"100%",alignItems:"center",children:[(0,a.jsxs)(y.Z,{color:"#323E4E",children:[C," ",C>1?"jobs":"job"]}),(0,a.jsx)(J.Z,{sx:{display:"flex",width:"100%",height:"4px"},children:0!==C&&ed()().isAfter(p)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(ta,{percentage:g/C*100,color:"success"}),(0,a.jsx)(ta,{percentage:b/C*100,color:"danger"})]}):(0,a.jsx)(ta,{percentage:100,color:"gray"})})]})})};tr.defaultProps={},tr.propTypes={filters:v().object.isRequired,accountType:v().string,year:v().number};var ta=(0,u.ZP)(J.Z)(function(e){var n=e.theme,t=e.percentage,a=e.color;return(0,o.Z)({width:"".concat(t,"%"),height:"100%"},"success"===a&&(0,r.Z)((0,o.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"4px 0 0 4px"}),{backgroundColor:n.palette.success.main}),"danger"===a&&(0,r.Z)((0,o.Z)({},100===t&&{borderRadius:"4px"},t<100&&{borderRadius:"0px 4px 4px 0px"}),{backgroundColor:n.palette.danger.main}),"gray"===a&&{borderRadius:"4px",backgroundColor:"#BFBFBF"})}),ti=(0,u.ZP)(function(e){var n=e.className,t=(0,nb.Z)(e,["className"]);return(0,a.jsx)(nj.Z,(0,r.Z)((0,o.Z)({},t),{classes:{popper:n}}))})(function(e){var n=e.theme;return(0,e2.Z)({},"& .".concat(nZ.Z.tooltip),{backgroundColor:n.palette.white.main,boxShadow:n.shadows[4],color:n.palette.text.primary,borderRadius:"10px"})}),tl=function(e){var n=ed()(e).startOf("year").toISOString(),t=ed()(e).endOf("year").toISOString();return{status:{_neq:"canceled"},timingStart:{_gte:n,_lte:t}}},ts=function(e,n){switch(e){case"compliance":return[{status:{_neq:"canceled"},Compliance:{}}];case"overduePPM":return[{_and:[{status:{_neq:"canceled"}},{timingStart:{_lte:n}},{_not:{statusData:{_has_key:"inProgress"}}},{_not:{statusData:{_has_key:"closed"}}}]}];case"incompleteFollowOn":return[{status:{_neq:"canceled"},Jobs:{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}}];case"followOn":return[{status:{_neq:"canceled"},Jobs:{}}];default:return[]}},tu=function(e){switch(e){case"complete":return[{_or:[{statusData:{_has_key:"completed"}},{statusData:{_has_key:"closed"}}]}];case"incomplete":return[{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}];default:return[]}},tc=function(e,n){switch(n){case"supplier":return{supplierUserId:{_eq:e}};case"customer":return{customerUserId:{_eq:e}};default:return{}}},td=function(e,n){var t,r,a,i,l,s,u,c=e.search,d=e.status,p=e.tags,m=e.customerId,h=e.locationId,v=e.sublocationId,f=e.userId,x=e.assetCategoryId,g=e.assetId,b=e.supplierId,y=e.customerManagerId,j=e.allJobs,Z=e.allItems,w=e.year,C=e.hideExpiredItems,I=ed()().subtract(24,"hours").toISOString(),S=[],_=[],P=[];(c||(null==d?void 0:d.length)>0||(null==p?void 0:p.length)>0||f||g||b||y||j||Z)&&_.push(tl(w)),P.push.apply(P,(0,eg.Z)(b?[{supplierId:{_eq:b}},{status:{_eq:"offered"},SupplierOffers:{accountId:{_eq:b},status:{_in:["offered","accepted"]}}}]:[])),_.push((null==d?void 0:d.length)>0?{status:{_in:d}}:{}),_.push((null==p?void 0:p.length)>0?{Taxonomy:{entity:{_eq:"Job"},Taxonomy:{status:{_eq:"active"},type:{_eq:"tags"},id:{_in:p}}}}:{}),_.push(tc(f,n)),_.push(g?{Assets:{entity:{_eq:"JobSchedule"},assetId:{_eq:g}}}:{}),_.push(y?{Customer:{Manager:{id:{_eq:y}}}}:{}),_.push.apply(_,(0,eg.Z)(ts(j,I))),_.push.apply(_,(0,eg.Z)(tu(Z))),_.push(C?{_and:[{_not:{statusData:{_has_key:"completed"}}},{_not:{statusData:{_has_key:"closed"}}}]}:{}),S.push.apply(S,(0,eg.Z)(c?[{reference:{_ilike:c}},{description:{_ilike:c}},{_or:[{Jobs:{reference:{_ilike:c}}},{Jobs:{description:{_ilike:c}}}]}]:[]));var q=S.filter(function(e){return!no.isEmpty(e)}),k=_.filter(function(e){return!no.isEmpty(e)}),D=P.filter(function(e){return!no.isEmpty(e)});return{jobWhere:{status:{_neq:"canceled"},timingStart:{_gte:ed()(w).startOf("year").toISOString(),_lte:ed()(w).endOf("year").toISOString()}},where:(0,o.Z)({locationId:{_eq:h},sublocationId:{_eq:v},customerId:{_eq:m},assetCategoryId:{_eq:x}},q.length>0?{_or:q}:{},k.length>0||D.length>0||"all"===Z?{Jobs:(0,o.Z)({},D.length>0&&{_or:D},k.length>0&&{_and:k})}:{})}},tp=t(34187),tm=t(4791),th={monthHeaderWrapper:function(e){return{padding:"5px",borderRadius:"10px",border:"2px solid #F2F2F2",backgroundColor:e?"#F2F2F2":"inherit"}}},tv=(0,i.forwardRef)(function(e,n){var t=e.rows,o=e.meta,r=e.refetch,s=e.loading,u=e.filters,c=e.yearDate,d=(0,k.a)(),p=(0,L.x)(),m=p.hasRole,h=p.user,v=m("admin"),f=(0,i.useState)(nx.uJ[0]),x=f[0],g=f[1],b=(0,i.useCallback)(function(e){var n=e.id,t=(e.total,e.year),o=e.month,r=ed()().year(t).month(o).startOf("month").toISOString(),i=ed()().year(t).month(o).endOf("month").toISOString();d.show({content:(0,a.jsx)(tm.w,{type:"JobSchedule",jobScheduleId:n,startDate:r,endDate:i,onClose:d.close,hideFilters:{supplier:!v}}),title:"Works orders",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"90vw",md2:"85vw",lg:"75vw",lg2:"75vw",submit:!1})},[v,d]),j=(0,i.useMemo)(function(){return[{flex:1,minWidth:220,field:"id",headerName:"",sortable:!1,renderCell:function(e){var n=e.row;return(0,a.jsxs)(l.Z,{justifyContent:"center",sx:{height:"100%"},children:[(0,a.jsx)(y.Z,{color:"secondary",fontWeight:600,children:n.serviceName}),(0,a.jsx)(y.Z,{fontWeight:600,mt:2,children:n.title}),(0,a.jsx)(ng.O,{fontSize:"12px",maxLength:20,children:n.description})]})}},{flex:1,minWidth:120,field:"count",headerName:"Count",headerAlign:"center",sortable:!1,renderCell:function(e){var n=e.row;return(0,a.jsx)(nY,{year:c.year(),month:x.label,total:n[x.value].count,complete:n[x.value].completeCount,inComplete:n[x.value].inCompleteCount,followOn:n[x.value].followOnCount,inCompleteCompliance:n[x.value].inCompleteComplianceCount,onClick:function(){return b({id:n.id,total:n[x.value].count,year:c.year(),month:x.label})}})}}]},[b,x.label,x.value,c]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.Z,{direction:"row",flexWrap:"wrap",justifyContent:"space-between",rowGap:2,p:3,children:nx.uJ.map(function(e){var n=e.label,t=e.value;return(0,a.jsxs)(l.Z,{width:"90px",sx:th.monthHeaderWrapper(x.value===t),onClick:function(){return g({label:n,value:t})},children:[(0,a.jsx)(nH,{children:n}),(0,a.jsx)(n5,{filters:u,accountType:h.accountType,year:c.year(),month:n})]})})}),(null==t?void 0:t.length)||s?(0,a.jsx)(nz.i,{autoHeight:!1,ref:n,slots:{columnHeaders:function(){return null}},rowHeight:120,columns:j,rows:t,meta:o,refetch:r,loading:s,containerHeight:"calc(100% - 120px)"}):(0,a.jsx)(tp.C,{imageSrc:"/static/icons/no_ppm_schedules_found.svg",title:"No results",subtitleFirstLine:"This search has no results.",subtitleSecondLine:"Please amend the filters as needed to generate the required results."})]})}),tf=function(e){var n=e.initialFilters,t=e.hideFilters,r=e.hideTableButton,s=e.locationId,u=e.onViewChange,c=(0,f.Z)("(max-width: 600px)"),d=(0,L.x)(),p=d.user,m=d.hasRole,h=(0,k.a)(),v=m("admin"),x=(0,D.Z)((0,nn.X)("scheduledjob_calendar_".concat(n.filterType),n,"network"),2),g=x[0],b=x[1],j=(0,i.useState)({}),Z=j[0],w=j[1],C=(0,i.useState)([]),I=C[0],S=C[1],q=(0,i.useState)(!1),T=q[0],O=q[1],M=(0,eO.x)({filters:Z}),F=M.initialData,A=M.ref,E=ed()(Z.year),R=(0,i.useMemo)(function(){return td((0,o.Z)({},Z),p.accountType)},[Z,p.accountType]),$=(0,P.a)(_.JH,{variables:(0,o.Z)({},F,R)}),N=$.data,W=void 0===N?{jobSchedules:[],meta:{aggregate:{totalCount:0}}}:N,Y=W.jobSchedules,B=W.meta,H=$.loading,V=$.refetch,G=(0,i.useCallback)(function(e){var n=e.id,t=(e.total,e.year),o=e.month,r=ed()().year(t).month(o).startOf("month").toISOString(),i=ed()().year(t).month(o).endOf("month").toISOString();h.show({content:(0,a.jsx)(tm.w,{type:"JobSchedule",jobScheduleId:n,startDate:r,endDate:i,onClose:h.close,hideFilters:{supplier:!v}}),title:"Works orders",xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"90vw",md2:"85vw",lg:"75vw",lg2:"75vw",submit:!1})},[v,h]),Q=(0,i.useMemo)(function(){return[{flex:1,minWidth:220,field:"id",headerName:"",sortable:!1,renderHeader:function(){return""},renderCell:function(e){var n=e.row;return(0,a.jsxs)(l.Z,{justifyContent:"center",sx:{height:"100%"},children:[(0,a.jsx)(y.Z,{color:"secondary",fontWeight:600,children:n.serviceName}),(0,a.jsx)(y.Z,{fontWeight:600,mt:2,children:n.title}),(0,a.jsx)(ng.O,{fontSize:"12px",maxLength:20,children:n.description})]})}}].concat((0,eg.Z)(nx.uJ.map(function(e,n){var t=e.label,o=e.value;return{flex:1,minWidth:120,field:o,headerName:t,headerAlign:"center",sortable:!1,renderHeader:function(){return(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(nH,{selected:ed()().month()===n,children:t}),(0,a.jsx)(n5,{filters:Z,accountType:p.accountType,year:E.year(),month:t})]})},renderCell:function(e){var n=e.row;return(0,a.jsx)(nY,{year:E.year(),month:t,total:n[o].count,complete:n[o].completeCount,inComplete:n[o].inCompleteCount,followOn:n[o].followOnCount,inCompleteCompliance:n[o].inCompleteComplianceCount,onClick:function(){return G({id:n.id,total:n[o].count,year:E.year(),month:t})}})}}})),[{minWidth:120,field:"count",headerName:"Count",sortable:!1,renderHeader:function(){return(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(nH,{children:"Count"}),(0,a.jsx)(tr,{filters:Z,accountType:p.accountType,year:E.year()})]})},renderCell:function(e){var n=e.row;return(0,a.jsx)(nU,{year:E.year(),total:n.totalCount.count,complete:n.totalCount.completeCount,inComplete:n.totalCount.inCompleteCount,followOn:n.totalCount.followOnCount,inCompleteCompliance:n.totalCount.inCompleteComplianceCount})}}])},[Z,G,p.accountType,E]),z=(0,i.useMemo)(function(){return Y.map(function(e){var n=nG({jobs:e.jobs,timePeriods:nx.uJ,year:E.year()}),t=n.countByPeriod,r=n.totalCount;return(0,o.Z)({id:e.id,serviceName:e.serviceName,title:e.title,description:e.description,totalCount:r},t)})},[Y,E]),U=(0,i.useCallback)(function(e){b(function(n){var t=(0,o.Z)({},n);return delete t[e],t})},[b]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tt,{locationId:s,open:T,close:function(){return O(!1)},filtersFormData:g,setFiltersFormData:b,hideFilters:t,setFilters:w,setFiltersChips:S}),(0,a.jsxs)(J.Z,{sx:{height:"calc(100vh + 100px)",width:"100%"},children:[(0,a.jsxs)(J.Z,{pl:2,pr:2,mb:1,mt:1,sx:{display:"grid",alignItems:"flex-start",height:"auto",gridTemplateAreas:c?'"filter-btn table-btn"\n                  "filter-chip filter-chip"':'"filter-btn filter-chip table-btn"',gridTemplateColumns:c?"auto auto":"96px auto 96px",columnGap:c?0:2,rowGap:c?2:0},children:[(0,a.jsx)(J.Z,{sx:{gridArea:"filter-btn"},children:(0,a.jsx)(eM.Z,{variant:"contained",startIcon:(0,a.jsx)(e$.Z,{}),onClick:function(){return O(!0)},children:"Filters"})}),(0,a.jsx)(J.Z,{sx:{gridArea:"filter-chip",overflow:"hidden"},children:(0,a.jsx)(nt.V,{filtersChips:I,onRemove:U})}),!r&&(0,a.jsx)(J.Z,{sx:{gridArea:"table-btn",justifySelf:"flex-end"},children:(0,a.jsx)(eM.Z,{variant:"contained",color:"info",startIcon:(0,a.jsx)(n4.Z,{}),onClick:function(e){return u("table")},children:"Table"})})]}),c&&(0,a.jsx)(tv,{ref:A,filters:Z,meta:B,loading:H,refetch:V,locationId:s,yearDate:E,rows:z}),!c&&(0,a.jsx)(tx,{disableSelectionOnClick:!0,autoHeight:!1,ref:A,rows:z,columns:Q,loading:H,meta:B,refetch:V,rowHeight:140,containerHeight:"calc(100% - 140px)"}),!c&&!(null==z?void 0:z.length)&&!H&&(0,a.jsx)(tp.C,{imageSrc:"/static/icons/no_ppm_schedules_found.svg",title:"No results",subtitleFirstLine:"This search has no results.",subtitleSecondLine:"Please amend the filters as needed to generate the required results."})]})]})};tf.defaultProps={initialFilters:{},onViewChange:function(){}};var tx=(0,u.ZP)(nz.i)(function(e){var n;return e.theme,n={},(0,e2.Z)(n,"& .MuiDataGrid-columnHeaders",{border:"none"}),(0,e2.Z)(n,"& .MuiDataGrid-columnHeader",{padding:"0px"}),(0,e2.Z)(n,"& .MuiDataGrid-cell--withRenderer",{justifyContent:"center"}),(0,e2.Z)(n,'& .MuiDataGrid-cell--withRenderer[aria-colindex="1"]',{justifyContent:"flex-start"}),(0,e2.Z)(n,"& .MuiDataGrid-columnHeaderTitleContainer",{width:"100%",justifyContent:"center"}),(0,e2.Z)(n,"& .MuiDataGrid-row:hover, .MuiDataGrid-row.Mui-hovered",{backgroundColor:"unset"}),n}),tg=function(e){var n=e.calendarInitialFilters,t=e.hideCalendarFilters,o=e.tableInitialFilters,r=e.hideTableFilters,s=e.locationId,u=(0,eW.useRouter)(),c=(0,f.Z)("(max-width: 600px)"),d=(0,i.useState)(u.query.scheduledTab||"calendar"),p=d[0],m=d[1];(0,i.useEffect)(function(){var e=u.query;delete e.scheduledTab,e.scheduledTab=p,eL().push({pathname:u.pathname,query:e,shallow:!0})},[p]);var h=function(e){m(e)};return(0,a.jsxs)(l.Z,{children:["table"===p&&(0,a.jsx)(nf,{initialFilters:o,hideFilters:r,locationId:s,onViewChange:h,containerHeight:c?"calc(100vh + 500px)":void 0,tableHeight:c?"calc(100% - 160px)":void 0}),"calendar"===p&&(0,a.jsx)(tf,{initialFilters:n,hideFilters:t,locationId:s,onViewChange:h})]})};tg.propTypes={calendarInitialFilters:v().object,hideCalendarFilters:v().array,locationId:v().string};var tb,ty=t(72852),tj=t(63441),tZ=t(78840),tw=t.n(tZ),tC=t(75708),tI=t.n(tC),tS=t(83372),t_=function(e){var n=e.items,t=e.dates,o=e.type,r=e.color;return t.map(function(e){var t=n.filter(function(n){return ed()(n.month).format("MM.YYYY")===e}).reduce(function(e,n){return e+n[o]},0),a=ed()(e,"MM.YYYY").isAfter(ed()());return{name:e,y:t,color:a?tS.Q.COLOUR.muiGray:r}})},tP=function(e){var n=e.locationId;t(18393)(tw());var o=(0,L.x)(),r=o.user,l=(0,o.hasRole)("customer")?r.accountId:null,s=(0,i.useMemo)(function(){return ed()().startOf("year")},[]),u=(0,i.useMemo)(function(){return ed()().endOf("year")},[]),c=(0,P.a)(_.MI,{variables:{locationId:n,customerId:l,startDate:s,endDate:u}}).data,d=(void 0===c?{items:[]}:c).items,p=(0,i.useMemo)(function(){return Array(12).fill("").map(function(e,n){return ed()().startOf("year").add(n,"month").format("MM.YYYY")})},[]),m=(0,i.useMemo)(function(){return t_({dates:p,items:d,type:"totalPaid",color:tS.Q.COLOUR.success})},[p,d]),h=(0,i.useMemo)(function(){return t_({dates:p,items:d,type:"totalUnpaid",color:tS.Q.COLOUR.danger})},[p,d]),v=(0,i.useMemo)(function(){return t_({dates:p,items:d,type:"totalPartial",color:tS.Q.COLOUR.pink})},[p,d]);return(0,a.jsx)(tI(),{callback:function(e){e.reflow()},constructorType:"chart",Highcharts:tw(),options:{chart:{type:"column"},title:{text:null},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1}}},series:[{name:"Paid",color:tS.Q.COLOUR.success,data:m},{name:"Partially paid",color:tS.Q.COLOUR.pink,data:v},{name:"Unpaid",color:tS.Q.COLOUR.danger,data:h}],xAxis:{title:null,categories:p},yAxis:{title:null,formatter:function(){return"\xa3".concat(this.value)}}}})},tq=t(47568),tk=t(97582),tD=(tb=(0,tq.Z)(function(e){var n;return(0,tk.__generator)(this,function(t){switch(t.label){case 0:return(0,nv.a)()||(n=window.open("/download","_blank")),[4,window.fetch("".concat("https://aws.cleverly.works","/pdf/invoice/ppmNew/create"),{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(e)}).then(function(e){return e.json()}).then(function(e){var t,o,r;null==n||null===(t=n.location)||void 0===t||t.assign("".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)),(null==window?void 0:null===(o=window.Capacitor)||void 0===o?void 0:null===(r=o.Plugins)||void 0===r?void 0:r.Browser)&&window.Capacitor.Plugins.Browser.open({url:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.key)})})];case 1:return t.sent(),[2]}})}),function(e){return tb.apply(this,arguments)}),tT=function(e){var n=e.status;return(0,a.jsx)(x.Z,{color:{paid:"success",unpaid:"danger",partial:"pink"}[n],label:{paid:"Paid",unpaid:"Unpaid",partial:"Partially paid"}[n],sx:{borderRadius:2,height:"26px",width:"fit-content"}})};tT.propTypes={status:v().oneOf(["paid","unpaid","partial"])};var tO={squaredIconButton:{backgroundColor:"#1E88E5",color:"#ffffff",borderRadius:"5px",height:"30px","&:hover":{opacity:.8,backgroundColor:"#1E88E5"}},statusBox:{width:"fit-content",padding:"2px 10px",borderRadius:"5px",color:"#fff"}},tM=function(e){var n=e.locationId,t=e.locationName,r=(0,f.Z)("(max-width:600px)"),s=(0,eO.x)({filters:{locationId:n}}),u=s.initialData,c=s.ref,d=(0,P.a)(_.du,{variables:(0,o.Z)({},u)}),p=d.data,h=void 0===p?{invoices:[]}:p,v=h.invoices,x=h.meta,b=d.loading,y=d.refetch,j=(0,i.useMemo)(function(){return[{minWidth:130,field:"invoiceNumber",headerName:"Invoice number",valueFormatter:function(e){var n=e.value;return"PM ".concat(n)},flex:1,sortable:!1},{minWidth:130,flex:1,field:"createdAt",headerName:"Date invoiced",valueFormatter:function(e){var n=e.value;return ed()(n).format("YYYY-MM-DD")},sortable:!1},{minWidth:130,flex:1,field:"debit",headerName:"Invoice total",valueFormatter:function(e){var n=e.value;return n>=0?(0,q.T)(n):"N/A"},sortable:!1},{minWidth:100,flex:1,field:"status",headerName:"Status",renderCell:function(e){var n=e.row;return(0,a.jsx)(tT,{status:n.status})},sortable:!1},{minWidth:100,flex:1,field:"outstandingAmount",headerName:"Amount outstanding",valueFormatter:function(e){var n=e.value;return n>=0?(0,q.T)(n):"N/A"},sortable:!1},{minWidth:100,flex:1,field:"outstandingdays",headerName:"Days outstanding",valueFormatter:function(e){var n=e.value;return null!=n?n:"N/A"},sortable:!1},{minWidth:100,flex:1,field:"actions",headerName:"Actions",renderCell:function(e){var n,t=e.row;return(0,a.jsx)(l.Z,{direction:"row",children:(0,a.jsx)(g.Z,{sx:tO.squaredIconButton,onClick:function(){tD(t.meta)},children:(0,a.jsx)(tj.Z,{})})})},sortable:!1}]},[]),Z=(0,i.useMemo)(function(){return v.map(function(e){return{id:e.id,invoiceNumber:e.invoiceNumber,createdAt:e.createdAt,debit:e.debit,status:e.paymentStatus,outstandingAmount:e.outstandingAmount,outstandingdays:e.outstandingdays,meta:e.meta}})},[v]);return(0,a.jsxs)(l.Z,{children:[(0,a.jsxs)(eH.ZP,{container:!0,alignItems:"center",sx:{height:"50%"},children:[(0,a.jsx)(eH.ZP,{item:!0,xs:12,md:7,sx:{padding:"0px 16px"},children:(0,a.jsx)(nu.n,{columns:j,rows:Z,loading:b,ref:c,meta:x,refetch:y,autoHeight:!1,containerHeight:"450px"})}),(0,a.jsx)(eH.ZP,{item:!0,xs:12,md:5,sx:{padding:"0px 16px"},children:(0,a.jsx)(tP,{locationId:n})})]}),(0,a.jsx)(J.Z,{sx:{padding:"0px 16px",mt:2},children:(0,a.jsx)(m.x,{locationId:n,locationName:t,columnVisibilityModel:{workOrders:!1,actions:!1,compliance:!1},hasHeader:!1,initialFilters:{locationId:n,filterType:"customer_fin_".concat(location.id)},hideFilters:["location","complianceCategory"],containerHeight:r?"calc(100vh - 40px)":void 0,tableHeight:r?"calc(100% - 60px)":void 0})})]})};tM.propTypes={locationId:v().string,locationName:v().string};var tF=function(e){var n=e.items,t=e.dates,o=e.type,r=e.color;return t.map(function(e){var t=n.filter(function(n){return ed()(n.month).format("MM.YYYY")===e}).reduce(function(e,n){return e+n[o]},0),a=ed()(e,"MM.YYYY").isAfter(ed()());return{name:e,y:t,color:a?tS.Q.COLOUR.muiGray:r}})},tA=function(e){var n=e.locationId;t(18393)(tw());var o=(0,L.x)(),r=o.user,l=(0,o.hasRole)("supplier")?r.accountId:null,s=(0,i.useMemo)(function(){return ed()().startOf("year")},[]),u=(0,i.useMemo)(function(){return ed()().endOf("year")},[]),c=(0,P.a)(_.FL,{variables:{locationId:n,supplierId:l,startDate:s,endDate:u}}).data,d=(void 0===c?{items:[]}:c).items,p=(0,i.useMemo)(function(){return Array(12).fill("").map(function(e,n){return ed()().startOf("year").add(n,"month").format("MM.YYYY")})},[]),m=(0,i.useMemo)(function(){return tF({dates:p,items:d,type:"totalPaid",color:tS.Q.COLOUR.success})},[p,d]),h=(0,i.useMemo)(function(){return tF({dates:p,items:d,type:"totalUnpaid",color:tS.Q.COLOUR.danger})},[p,d]),v=(0,i.useMemo)(function(){return tF({dates:p,items:d,type:"totalPartial",color:tS.Q.COLOUR.pink})},[p,d]);return(0,a.jsx)(tI(),{callback:function(e){e.reflow()},constructorType:"chart",Highcharts:tw(),options:{chart:{type:"column"},title:{text:null},plotOptions:{column:{stacking:"normal",dataLabels:{enabled:!1}}},series:[{name:"Paid",color:tS.Q.COLOUR.success,data:m},{name:"Partially paid",color:tS.Q.COLOUR.pink,data:v},{name:"Unpaid",color:tS.Q.COLOUR.danger,data:h}],xAxis:{title:null,categories:p},yAxis:{title:null,formatter:function(){return"\xa3".concat(this.value)}}}})},tE=t(84808),tR=t(94054),t$=t(40476),tN=t(36872),tW=t(79717),tL=t(19504),tJ=t(91807),tY=t(79665),tB=t(91599),tH=eM.Z,tV=function(e){var n=e.id,t=e.description,o=e.quantity,r=e.rate,s=e.vatType,u=e.vatPercentage,c=e.onSubmit,d=(0,tJ.l)(),p=(0,O.cI)({defaultValues:{description:t,quantity:o,rate:r,vatType:void 0===s?"default":s,vatPercentage:u},resolver:(0,tY.S)(tB.a3)}),m=p.control,h=p.errors,v=p.watch,f=p.handleSubmit,x=v("vatType"),g=v("quantity"),b=v("rate"),j=v("vatPercentage"),Z=g*b||0,w=Z*(j/100)||0,C=Z+w||0,I=function(e){var t={id:n,description:e.description,quantity:e.quantity,rate:(0,tL.l)(e.rate,2),net:(0,tL.l)(Z,2),vatPercentage:e.vatPercentage,vatType:e.vatType,vat:(0,tL.l)(w,2),gross:(0,tL.l)(C,2)};c(t),d.current.toggleDetailPanel(n)},S=(0,i.useCallback)(function(e){e.stopPropagation(),d.current.toggleDetailPanel(n)},[d,n]);return(0,a.jsx)("form",{children:(0,a.jsxs)(l.Z,{width:"100%",spacing:2,p:1,sx:{backgroundColor:"muiLight.main"},children:[(0,a.jsx)(O.Qr,{name:"description",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,a.jsx)(eG.Z,{minRows:3,multiline:!0,fullWidth:!0,variant:"filled",color:"secondary",label:"Description",value:t,onChange:o,error:h.description,helperText:null===(n=h.description)||void 0===n?void 0:n.message})}}),(0,a.jsxs)(l.Z,{width:"100%",direction:"row",justifyContent:"space-between",spacing:2,children:[(0,a.jsxs)(l.Z,{width:"100%",children:[(0,a.jsx)(y.Z,{children:"Rate"}),(0,a.jsx)(O.Qr,{name:"rate",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,a.jsx)(F.I,{leftLabel:(0,a.jsx)(A.Z,{sx:{height:"18px"}}),rightLabel:"Ex Vat",sx:{width:"100%"},type:"number",InputProps:{inputProps:{min:0}},value:t,onChange:o,error:h.rate,helperText:null===(n=h.rate)||void 0===n?void 0:n.message})}})]}),(0,a.jsxs)(l.Z,{width:"100%",children:[(0,a.jsx)(y.Z,{children:"Quantity"}),(0,a.jsx)(O.Qr,{name:"quantity",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,a.jsx)(F.I,{sx:{width:"100%"},type:"number",InputProps:{inputProps:{min:0,step:"1"}},value:t,onChange:o,error:h.quantity,helperText:null===(n=h.quantity)||void 0===n?void 0:n.message})}})]})]}),(0,a.jsx)(l.Z,{width:"100%",children:(0,a.jsx)(O.Qr,{name:"vatType",control:m,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsxs)(tR.Z,{color:"secondary",children:[(0,a.jsx)(t$.Z,{children:"VAT %"}),(0,a.jsxs)(tW.Z,{row:!0,value:n,onChange:function(e,n){return t(n)},color:"secondary",children:[(0,a.jsx)(eB.Z,{value:"default",control:(0,a.jsx)(tN.Z,{color:"secondary"}),label:"Default (".concat(u,"%)")}),(0,a.jsx)(eB.Z,{value:"custom",control:(0,a.jsx)(tN.Z,{color:"secondary"}),label:"Custom"})]})]})}})}),(0,a.jsx)(l.Z,{width:"100%",children:(0,a.jsx)(O.Qr,{name:"vatPercentage",control:m,render:function(e){var n,t=e.value,o=e.onChange;return(0,a.jsx)(eG.Z,{fullWidth:!0,type:"number",variant:"standard",color:"secondary",label:"Custom VAT %",value:t,onChange:o,error:h.vatAmount,helperText:null===(n=h.vatAmount)||void 0===n?void 0:n.message,sx:{display:"custom"===x?"block":"none"}})}})}),(0,a.jsxs)(l.Z,{width:"100%",children:[(0,a.jsxs)(y.Z,{children:["Net: ",(0,q.T)(Z)]}),(0,a.jsxs)(y.Z,{children:["VAT: ",(0,q.T)(w)]}),(0,a.jsxs)(y.Z,{children:["Gross: ",(0,q.T)(C)]})]}),(0,a.jsxs)(l.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,a.jsx)(tH,{color:"danger",variant:"contained",size:"small",onClick:S,children:"Cancel"}),(0,a.jsx)(tH,{color:"secondary",variant:"contained",size:"small",type:"submit",onClick:f(I),children:"Save"})]})]})})};tV.propTypes={id:v().number,description:v().string,quantity:v().number,rate:v().number,vatType:v().oneOf(["default","custom"]),vatPercentage:v().number,onSubmit:v().func};var tG=t(98409),tQ=t(49010),tz=t(85412),tU=t(25934),tK=function(e){var n=e.values,t=e.setValues,r=e.name,s=e.vatId,u=(0,i.useState)([]),c=u[0],d=u[1],p=(0,i.useCallback)(function(){var e=(0,tQ.b)(s),n=(0,tU.Z)();t(function(t){return(0,eg.Z)(t).concat([{id:n,description:"",quantity:0,rate:0,net:0,vatPercentage:e?20:0,vatType:"default",vat:0,gross:0}])}),d(function(e){return(0,eg.Z)(e).concat([n])})},[t,s]),m=(0,i.useCallback)(function(e){t(function(n){return n.filter(function(n){return n.id!==e})})},[t]),h=(0,i.useCallback)(function(e){t(function(n){return n.map(function(n){return n.id===e.id?(0,o.Z)({},e):n})})},[t]),v=(0,i.useCallback)(function(e){d((0,eg.Z)(e))},[]),f=(0,i.useMemo)(function(){return[{field:"description",headerName:"Description",minWidth:120,sortable:!1,flex:1},{field:"quantity",headerName:"Qty",sortable:!1,flex:1},{field:"rate",headerName:"Rate",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,q.T)(n)}},{field:"net",headerName:"Net",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,q.T)(n)}},{field:"vatPercentage",headerName:"Vat %",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return"".concat(n,"%")}},{field:"vat",headerName:"Vat",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,q.T)(n)}},{field:"gross",headerName:"Gross",sortable:!1,flex:1,renderCell:function(e){var n=e.value;return(0,q.T)(n)}},{field:tG.u,headerName:"",sortable:!1,width:40,minWidth:40,renderCell:function(){return(0,a.jsx)(g.Z,{children:(0,a.jsx)(S.Z,{})})}},{field:"delete",headerName:"",sortable:!1,width:40,minWidth:40,renderCell:function(e){var n=e.id;return(0,a.jsx)(g.Z,{onClick:function(){return m(n)},children:(0,a.jsx)(tz.Z,{})})}}]},[m]),x=n.reduce(function(e,n){return e+n.gross},0);return(0,a.jsxs)(l.Z,{width:"100%",children:[(0,a.jsxs)(l.Z,{width:"100%",direction:"row",justifyContent:"space-between",children:[(0,a.jsx)(y.Z,{fontSize:22,sx:{opacity:.46},children:r}),(0,a.jsxs)(eM.Z,{color:"secondary",variant:"contained",onClick:p,children:["Insert ",r.toLowerCase()," item"]})]}),(0,a.jsx)(nz.i,{columns:f,rows:n,loading:!1,detailPanelExpandedRowIds:c,onDetailPanelExpandedRowIdsChange:v,getDetailPanelHeight:function(){return"auto"},getDetailPanelContent:function(e){var n=e.row;return(0,a.jsx)(tV,{id:n.id,description:n.description,quantity:n.quantity,rate:n.rate,vatType:n.vatType,vatPercentage:n.vatPercentage,onSubmit:h})}}),(0,a.jsx)(l.Z,{width:"100%",alignItems:"flex-end",children:(0,a.jsxs)(y.Z,{children:["Subtotal - ",r.toLowerCase(),": ",(0,q.T)(x)]})})]})};tK.defaultProps={values:[],setValues:function(){}},tK.propTypes={values:v().array,setValues:v().func,name:v().string,vatId:v().string};var tX=function(e){var n=e.jobScheduleId,t=(0,i.useState)(""),o=t[0],r=t[1],a=(0,D.Z)((0,eu.t)(n9.by,{variables:{where:{type:{_eq:"supplier"},status:{_eq:"active"},name:{_ilike:""!==o?"%".concat(o,"%"):null},_or:[{SupplierJobs:{status:{_neq:"canceled"},jobScheduleId:{_eq:n}}},{SupplierOffers:{status:{_eq:"offered"},Job:{status:{_neq:"canceled"},jobScheduleId:{_eq:n}}}}]},limit:50,offset:0}}),2),l=a[0],s=a[1],u=s.loading,c=s.data;return{supplierProps:{onOpen:l,loading:u,options:(void 0===c?{items:[]}:c).items,setSearch:r}}},t0=t(76011),t1=t(57779),t2=t(46242),t5=function(e){var n=parseInt(e.adminDueDate)||30,t=new Date().getTime()+864e5*n;return new Date(t)},t3=function(e){var n=e.percentage,t=e.reverse,o=null;return t?n<100&&n>0?o="info":n>=100?o="danger":0===n&&(o="success"):n<100&&n>0?o="info":0===n?o="danger":n>=100&&(o="success"),(0,a.jsx)(J.Z,{sx:{borderRadius:"5px",padding:"2px 4px",backgroundColor:"".concat(o,".main"),color:"".concat(o,".contrastText")},children:(0,a.jsxs)(y.Z,{children:[n,"%"]})})};t3.propTypes={percentage:v().number.isRequired,reverse:v().bool};var t6=function(e){var n,t=e.id,s=e.edit,u=e.supplierId,c=e.supplierName,d=e.locationId,p=e.jobScheduleId,m=e.vatId,h=e.totalInvoiceDue,v=e.totalInvoiceReceived,f=e.totalInvoiceReceivedPercentage,x=e.totalInvoicePaid,g=e.totalInvoicePaidPercentage,b=e.amountLeftToPay,j=e.amountLeftToPayPercentage,Z=e.close,w=(0,M.D)(),C=(0,eE.q)().admin,I=(0,L.x)(),S=I.user,k=I.hasRole,F=(0,t2.z)("AccountEntry",S.adminId,S.id),A=F.createMediaInput,E=F.loadingAddMedia,R=null==C?void 0:null===(n=C.finance)||void 0===n?void 0:n.invoiceDueDate,$=k("supplier"),N=(0,i.useState)([]),W=N[0],J=N[1],Y=(0,i.useState)([]),B=Y[0],H=Y[1],V=(0,O.cI)({defaultValues:(0,r.Z)((0,o.Z)({},t4),{dueDate:t5({adminDueDate:R}),supplier:{value:u,label:c}}),resolver:(0,tY.S)(tB.aA),context:{isSupplier:$}}),G=V.control,Q=V.errors,z=V.register,U=V.setValue,K=V.watch,X=V.reset,ee=V.handleSubmit,en=K("attachments"),et=(0,P.a)(_.h,{skip:!s,variables:{id:t},onCompleted:function(e){var n=e.invoice,t=n.items,o=n.dueDate,r=n.meta,a=n.account,i=t.filter(function(e){return"Labour"===e.type}),l=t.filter(function(e){return"Materials"===e.type});J(i),H(l),X({supplier:{value:a.id,label:a.name},dueDate:o,reference:null==r?void 0:r.reference,description:null==r?void 0:r.description})}}).loading,eo=(0,D.Z)((0,T.D)(_.zs,{refetchQueries:["GetJobSchedules","GetSupplierPpmInvoices","SupplierInvoiceTotalByMonth"],onCompleted:function(){w.show({content:"Supplier invoice saved",color:"success"}),Z()},onError:function(e){w.show({content:"Error: ".concat(e.message),color:"error"})}}),2),er=eo[0],ea=eo[1].loading,ei=tX({jobScheduleId:p}).supplierProps,el=(0,i.useCallback)(function(e){var n;return n=(0,tq.Z)(function(n){var t,o,r,a,i,l;return(0,tk.__generator)(this,function(a){switch(a.label){case 0:if(0===W.length&&0===B.length)return[2,w.show({content:"Please add at least one item",color:"error"})];if(!(W.reduce(function(e,n){return e+n.quantity*n.rate},0)+B.reduce(function(e,n){return e+n.quantity*n.rate},0)>0))return[2,w.show({content:"Gross should be greater than 0",color:"error"})];return[4,A(n.attachments)];case 1:return i=a.sent(),l={labours:W,materials:B,supplierId:null===(t=n.supplier)||void 0===t?void 0:t.value,locationId:d,jobScheduleId:p,dueDate:n.dueDate,reference:n.reference,description:n.description,submit:e,attachments:null==i?void 0:null===(o=i.Media_Entity)||void 0===o?void 0:null===(r=o.data)||void 0===r?void 0:r.map(function(e){return{caption:e.Medium.data.caption,extension:e.Medium.data.extension,filename:e.Medium.data.filename,type:e.Medium.data.type,meta:e.Medium.data.meta}})},er({variables:{data:l}}),[2]}})}),function(e){return n.apply(this,arguments)}},[A,p,W,d,B,w,er]),es=(0,i.useCallback)(function(e){return function(n){if(0===W.length&&0===B.length)return w.show({content:"Please add at least one item",color:"error"});if(!(W.reduce(function(e,n){return e+n.quantity*n.rate},0)+B.reduce(function(e,n){return e+n.quantity*n.rate},0)>0))return w.show({content:"Gross should be greater than 0",color:"error"});var o,r={id:t,labours:W,materials:B,supplierId:null===(o=n.supplier)||void 0===o?void 0:o.value,locationId:d,jobScheduleId:p,dueDate:n.dueDate,reference:n.reference,description:n.description,submit:e};er({variables:{data:r}})}},[t,p,W,d,B,w,er]),eu=(0,i.useMemo)(function(){return[{field:"totalInvoiceDue",headerName:"Total invoice due (Net)",minWidth:100,renderCell:function(e){var n=e.row;return(0,a.jsx)(l.Z,{direction:"row",alignItems:"center",spacing:1,children:(0,a.jsx)(y.Z,{children:(0,q.T)(n.totalInvoiceDue)})})},sortable:!1,flex:1},{field:"totalInvoiceReceived",headerName:"Total invoice received (Net)",minWidth:130,renderCell:function(e){var n=e.row;return(0,a.jsxs)(l.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(y.Z,{children:(0,q.T)(n.totalInvoiceReceived)}),(0,a.jsx)(t3,{reverse:!0,percentage:n.totalInvoiceReceivedPercentage})]})},sortable:!1,flex:1},{field:"totalInvoicePaid",headerName:"Total invoice paid (Net)",minWidth:130,renderCell:function(e){var n=e.row;return(0,a.jsxs)(l.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(y.Z,{children:(0,q.T)(n.totalInvoicePaid)}),(0,a.jsx)(t3,{reverse:!0,percentage:n.totalInvoicePaidPercentage})]})},sortable:!1,flex:1},{field:"amountLeftToPay",headerName:"Amount left to pay (Net)",minWidth:130,renderCell:function(e){var n=e.row;return(0,a.jsxs)(l.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(y.Z,{children:(0,q.T)(n.amountLeftToPay)}),(0,a.jsx)(t3,{percentage:n.amountLeftToPayPercentage})]})},sortable:!1,flex:1}]},[]),ec=W.reduce(function(e,n){return e+n.net},0)+B.reduce(function(e,n){return e+n.net},0),ed=W.reduce(function(e,n){return e+n.vat},0)+B.reduce(function(e,n){return e+n.vat},0),em=W.reduce(function(e,n){return e+n.gross},0)+B.reduce(function(e,n){return e+n.gross},0);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(tE.Z,{open:et||ea||E,sx:{zIndex:1e4},children:(0,a.jsx)(ep.Z,{color:"secondary"})}),(0,a.jsx)("form",{children:(0,a.jsxs)(l.Z,{width:"100%",spacing:4,children:[(0,a.jsx)(nz.i,{columns:eu,rows:[{id:1,totalInvoiceDue:h,totalInvoiceReceived:v,totalInvoiceReceivedPercentage:f,totalInvoicePaid:x,totalInvoicePaidPercentage:g,amountLeftToPay:b,amountLeftToPayPercentage:j}],sx:{backgroundColor:"muiLightGray.main"}}),(0,a.jsx)(tK,{values:W,setValues:J,name:"Labour",vatId:m}),(0,a.jsx)(tK,{values:B,setValues:H,name:"Materials",vatId:m}),(0,a.jsxs)(l.Z,{width:"100%",alignItems:"flex-end",children:[(0,a.jsxs)(y.Z,{children:["Net Total: ",(0,q.T)(ec)]}),(0,a.jsxs)(y.Z,{children:["VAT Total: ",(0,q.T)(ed)]}),(0,a.jsxs)(y.Z,{children:["Gross Total: ",(0,q.T)(em)]})]}),s?(0,a.jsx)(l.Z,{width:"100%",children:(0,a.jsx)(t1.G,{carousel:!1,elevation:0,accordionSx:{"& .MuiAccordionSummary-root":{paddingLeft:0,"& .MuiTypography-root":{fontSize:22,opacity:.46}}},expanded:!0,hideExpandIcon:!0,entityId:t,entity:"AccountEntry",columnVisibilityModel:{name:!1},mediaFormProps:{showSubmitButton:!0},offCanvasProps:{submit:!1}})}):(0,a.jsxs)(l.Z,{width:"100%",children:[(0,a.jsx)(t0.f,{title:"Media",name:"attachments",titleSx:{fontSize:22,opacity:.46},values:en,setValue:U}),(0,a.jsx)("input",(0,r.Z)((0,o.Z)({},z("attachments")),{type:"hidden"}))]}),(0,a.jsxs)(l.Z,{width:"100%",spacing:2,children:[!$&&(0,a.jsx)(O.Qr,{name:"supplier",control:G,render:function(e){var n,t=e.value,i=e.onChange;return(0,a.jsx)(eK.q,(0,r.Z)((0,o.Z)({},ei),{value:t,onChange:function(e,n){return i(n)},textFieldProps:{label:"Supplier",fullWidth:!0,color:"secondary",variant:"standard"},sx:{width:"300px"},error:Q.supplier,helperText:null===(n=Q.supplier)||void 0===n?void 0:n.message}))}}),!$&&(0,a.jsx)(O.Qr,{name:"dueDate",control:G,render:function(e){var n=e.value,t=e.onChange;return(0,a.jsx)(ez.M,{inputFormat:"Do MMM YYYY",value:n,onChange:t,label:"Due Date",renderInput:function(e){var n;return(0,a.jsx)(eG.Z,(0,r.Z)((0,o.Z)({},e),{sx:{width:"300px"},color:"secondary",variant:"standard",error:Q.dueDate,helperText:null===(n=Q.dueDate)||void 0===n?void 0:n.message}))}})}}),(0,a.jsx)(O.Qr,{name:"reference",control:G,render:function(e){var n,t=e.value,o=e.onChange;return(0,a.jsx)(eG.Z,{color:"secondary",variant:"standard",label:"Reference",value:t,onChange:o,error:Q.reference,helperText:null===(n=Q.reference)||void 0===n?void 0:n.message})}}),(0,a.jsx)(O.Qr,{name:"description",control:G,render:function(e){var n,t=e.value,o=e.onChange;return(0,a.jsx)(eG.Z,{multiline:!0,minRows:3,color:"secondary",variant:"filled",label:"Description",value:t,onChange:o,error:Q.description,helperText:null===(n=Q.description)||void 0===n?void 0:n.message})}})]}),(0,a.jsxs)(l.Z,{width:"100%",direction:"row",justifyContent:"flex-end",spacing:2,children:[(0,a.jsx)(eM.Z,{variant:"contained",color:"info",type:"submit",onClick:ee(s?es(!1):el(!1)),children:"Save"}),!$&&(0,a.jsx)(eM.Z,{variant:"contained",color:"success",type:"submit",onClick:ee(s?es(!0):el(!0)),children:"Generate Invoice"})]})]})})]})};t6.propTypes={id:v().string,edit:v().bool,supplierId:v().string,supplierName:v().string,locationId:v().string,vatId:v().string,amountLeftToPay:v().number,amountLeftToPayPercentage:v().number,totalInvoiceDue:v().number,totalInvoicePaid:v().number,totalInvoicePaidPercentage:v().number,totalInvoiceReceived:v().number,totalInvoiceReceivedPercentage:v().number,close:v().func},t6.defaultProps={};var t4={supplier:null,dueDate:new Date,description:"",reference:""},t9=t(66252),t7=t(84193),t8=t(95839),oe=function(e){var n=e.jobScheduleId,t=e.supplierId,o=e.locationId,r=e.row,s=(0,k.a)(),u=(0,t9.x)(),c=(0,(0,L.x)().hasRole)("tenant"),d=(0,eO.x)({filters:{jobScheduleId:n,locationId:o}}),p=d.initialData,m=d.ref,h=(0,P.a)(_.b_,{variables:{supplierId:t}}),v=h.data,f=(void 0===v?{supplier:{}}:v).supplier,x=h.loading,g=(0,P.a)(_.OK,{variables:p}),b=g.data,y=void 0===b?{invoices:[],meta:{aggregate:{totalCount:0}}}:b,j=y.invoices,Z=y.meta,w=g.loading,C=g.refetch,I=(0,i.useCallback)(function(e){e.stopPropagation(),s.show({content:(0,a.jsx)(t6,{supplierId:f.id,supplierName:f.name,locationId:o,jobScheduleId:n,vatId:f.vatId,totalInvoiceDue:r.totalInvoiceDue,totalInvoiceReceived:r.totalInvoiceReceived,totalInvoiceReceivedPercentage:r.totalInvoiceReceivedPercentage,totalInvoicePaid:r.totalInvoicePaid,totalInvoicePaidPercentage:r.totalInvoicePaidPercentage,amountLeftToPay:r.amountLeftToPay,amountLeftToPayPercentage:r.amountLeftToPayPercentage,close:s.close}),submit:!1,title:"Add supplier invoice",xs3:"100vw",sm:"100vw",sm2:"85vw",sm3:"70vw",md2:"70vw",lg:"65vw",lg2:"65vw"})},[n,o,s,r.amountLeftToPay,r.amountLeftToPayPercentage,r.totalInvoiceDue,r.totalInvoicePaid,r.totalInvoicePaidPercentage,r.totalInvoiceReceived,r.totalInvoiceReceivedPercentage,f.id,f.name,f.vatId]),D=(0,i.useCallback)(function(e){s.show({content:(0,a.jsx)(t6,{edit:!0,id:e,supplierId:f.id,supplierName:f.name,locationId:o,jobScheduleId:n,vatId:f.vatId,totalInvoiceDue:r.totalInvoiceDue,totalInvoiceReceived:r.totalInvoiceReceived,totalInvoiceReceivedPercentage:r.totalInvoiceReceivedPercentage,totalInvoicePaid:r.totalInvoicePaid,totalInvoicePaidPercentage:r.totalInvoicePaidPercentage,amountLeftToPay:r.amountLeftToPay,amountLeftToPayPercentage:r.amountLeftToPayPercentage,close:s.close}),submit:!1,title:"Edit supplier invoice",xs3:"100vw",sm:"100vw",sm2:"85vw",sm3:"70vw",md2:"70vw",lg:"65vw",lg2:"65vw"})},[n,o,s,r.amountLeftToPay,r.amountLeftToPayPercentage,r.totalInvoiceDue,r.totalInvoicePaid,r.totalInvoicePaidPercentage,r.totalInvoiceReceived,r.totalInvoiceReceivedPercentage,f.id,f.name,f.vatId]),T=(0,i.useCallback)(function(e){(0,t8.W)({client:u,accountEntryId:e})},[u]),O=(0,i.useMemo)(function(){return[{field:"invoiceNumber",headerName:"Invoice number",sortable:!1,flex:1,valueFormatter:function(e){return e.value||"Draft"}},{field:"dateInvoiced",headerName:"Date invoiced",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.dateInvoiced?ed()(n.dateInvoiced).format("YYYY-MM-DD"):"N/A"}},{field:"invoiceTotal",headerName:"Invoice Total",sortable:!1,flex:1},{field:"status",headerName:"Status",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?(0,a.jsx)(tT,{status:n.status}):"N/A"}},{field:"amountOutstanding",headerName:"Amount outstanding",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?n.amountOutstanding:"N/A"}},{field:"daysOutstanding",headerName:"Days outstanding",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?n.daysOutstanding:"N/A"}},{field:"actions",headerName:"Actions",sortable:!1,flex:1,renderCell:function(e){var n=e.row;return n.invoiceNumber?(0,a.jsx)(eM.Z,{disableMinWidth:!0,color:"secondary",variant:"contained",size:"small",sx:{width:"fit-content"},onClick:function(e){e.stopPropagation(),T(n.id)},children:(0,a.jsx)(t7.Z,{})}):(0,a.jsx)(eM.Z,{disableMinWidth:!0,color:"info",variant:"contained",size:"small",onClick:function(e){e.stopPropagation(),D(n.id)},children:(0,a.jsx)(S.Z,{})})}}]},[T,D]),M=(0,i.useMemo)(function(){return j.map(function(e){return{id:e.id,invoiceNumber:e.invoiceNumber,dateInvoiced:e.invoicedDate,invoiceTotal:(0,q.T)(e.debit),status:e.paymentStatus,amountOutstanding:(0,q.T)(e.outstandingAmount),daysOutstanding:e.outstandingdays}})},[j]);return(0,a.jsxs)(l.Z,{width:"100%",sx:{backgroundColor:"muiLight.main"},p:1,children:[(0,a.jsx)(nu.n,{ref:m,loading:w||x,columns:O,rows:M,meta:Z,refetch:C}),!c&&(0,a.jsx)(l.Z,{width:"100%",alignItems:"flex-end",mt:1,children:(0,a.jsx)(eM.Z,{disabled:x||!(null==f?void 0:f.id),color:"secondary",variant:"contained",onClick:I,children:"Add supplier invoice"})})]})};oe.propTypes={jobScheduleId:v().number.isRequired,supplierId:v().number.isRequired,locationId:v().number.isRequired,row:v().objectOf({amountLeftToPay:v().number,amountLeftToPayPercentage:v().number,totalInvoiceDue:v().number,totalInvoicePaid:v().number,totalInvoicePaidPercentage:v().number,totalInvoiceReceived:v().number,totalInvoiceReceivedPercentage:v().number})};var on=t(57682),ot=t(86076),oo=t(34270),or=t(23508),oa=t(23188),oi=t(52122),ol=t(47821),os=t(22564),ou=eM.Z,oc={title:{color:"#323E4E"},subtitle:{color:"#323E4E",fontWeight:"300"},indicatorWrapper:{position:"relative"},jobsBadge:{display:"flex",justifyContent:"center",alignItems:"center",borderRadius:"5px",minWidth:"50px"}},od=function(e){var n=e.locationId,t=(0,L.x)().hasRole,s=t("admin"),u=t("supplier"),c=(0,k.a)(),d=(0,eO.x)({filters:{locationId:n}}),p=d.initialData,m=d.ref,h=(0,P.a)(_.z4,{variables:p}),v=h.data,f=void 0===v?{jobSchedule:[],meta:{aggregate:{totalCount:0}}}:v,x=f.jobSchedule,g=f.meta,b=h.loading,j=h.refetch,Z=(0,i.useCallback)(function(e){var n=e.jobScheduleId,t=e.jobStatuses,o=e.description;c.show({content:(0,a.jsx)(tm.w,{type:"JobSchedule",jobScheduleId:n,defaultFilters:{status:t},onClose:c.close,hideFilters:{status:u,supplier:!s}}),title:"Works orders (".concat(o,")"),xs3:"100vw",sm:"100vw",sm2:"100vw",sm3:"90vw",md2:"85vw",lg:"75vw",lg2:"75vw",submit:!1})},[c,u,s]),w=(0,i.useMemo)(function(){return[{field:"title",headerName:"Job",minWidth:250,renderCell:function(e){var n,t=e.row,i=(0,oa.W)(t.scheduleEnd,!(0,ol.F)(t.jobs),!!(null===(n=t.jobs)||void 0===n?void 0:n.length));return(0,a.jsxs)(J.Z,{sx:oc.indicatorWrapper,children:[(0,a.jsx)(on.H,{height:110,backgroundColor:i}),(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",children:[t.compliance&&(0,a.jsx)(J.Z,{ml:1,children:(0,a.jsx)(nW.Z,{sx:{color:"info.main"}})}),(0,a.jsxs)(l.Z,{ml:2,children:[(0,a.jsx)(y.Z,{typography:"subtitle1",sx:(0,o.Z)({},oc.title),children:t.title}),(0,a.jsx)(ng.O,{sx:(0,r.Z)((0,o.Z)({},oc.subtitle),{whiteSpace:"normal"}),fontSize:"12px",maxLength:20,children:t.description})]})]})]})},sortable:!1,flex:1},{headerName:"Service",field:"service",sortable:!1,width:250,renderCell:function(e){var n=e.row;return(0,a.jsxs)(l.Z,{children:[(0,a.jsx)(y.Z,{typography:"subtitle1",children:n.serviceName}),(0,a.jsx)(y.Z,{typography:"subtitle2",sx:(0,o.Z)({},oc.subtitle),children:"Assigned to:"}),(0,a.jsx)(eR.r,{color:"secondary",href:"/dashboard/suppliers/view?id=".concat(n.supplierId),noWrap:!n.supplierId,children:n.supplierName||"No supplier assigned"})]})}},{field:"numberOfJobs",headerName:"Number of jobs",minWidth:130,sortable:!1,flex:1},{field:"lastJob",headerName:"Last job",minWidth:100,renderCell:function(e){var n=e.row;return n.lastJob?ed()(n.lastJob).format("YYYY-MM-DD"):"-"},sortable:!1,flex:1},{field:"totalInvoiceDue",headerName:"Total invoice (Net)",minWidth:100,renderCell:function(e){var n=e.row;return(0,a.jsx)(l.Z,{direction:"row",alignItems:"center",spacing:1,children:(0,a.jsx)(y.Z,{children:(0,q.T)(n.totalInvoiceDue)})})},sortable:!1,flex:1},{field:"totalInvoiceReceived",headerName:"Total invoice  (Net)",minWidth:130,renderCell:function(e){var n=e.row;return(0,a.jsxs)(l.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(y.Z,{children:(0,q.T)(n.totalInvoiceReceived)}),(0,a.jsx)(t3,{reverse:!0,percentage:n.totalInvoiceReceivedPercentage})]})},sortable:!1,flex:1},{field:"totalInvoicePaid",headerName:"Total invoice paid (Net)",minWidth:130,renderCell:function(e){var n=e.row;return(0,a.jsxs)(l.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(y.Z,{children:(0,q.T)(n.totalInvoicePaid)}),(0,a.jsx)(t3,{reverse:!0,percentage:n.totalInvoicePaidPercentage})]})},sortable:!1,flex:1},{field:"amountLeftToPay",headerName:"Amount left to pay (Net)",minWidth:130,renderCell:function(e){var n=e.row;return(0,a.jsxs)(l.Z,{direction:"row",spacing:1,children:[(0,a.jsx)(y.Z,{children:(0,q.T)(n.amountLeftToPay)}),(0,a.jsx)(t3,{percentage:n.amountLeftToPayPercentage})]})},sortable:!1,flex:1},{field:"numberOfIncompleteJobs",headerName:"Number of incomplete jobs",minWidth:160,renderCell:function(e){var n=e.row;return(0,a.jsxs)(l.Z,{direction:"row",spacing:1,children:[(0,a.jsxs)(J.Z,{sx:(0,r.Z)((0,o.Z)({},oc.jobsBadge),{color:"info.contrastText",backgroundColor:"info.main"}),children:[n.numberOfIncompleteJobs," jobs"]}),(0,a.jsx)(ou,{disableMinWidth:!0,color:"info",variant:"contained",size:"small",onClick:function(){return Z({jobScheduleId:n.id,jobStatuses:["raised","offered","accepted","inProgress","onHold","continued","paused"],description:n.title})},children:(0,a.jsx)(oi.Z,{})})]})},sortable:!1,flex:1},{field:"numberOfCompleteJobs",headerName:"Number of complete jobs",minWidth:160,renderCell:function(e){var n=e.row;return(0,a.jsxs)(l.Z,{direction:"row",spacing:1,children:[(0,a.jsxs)(J.Z,{sx:(0,r.Z)((0,o.Z)({},oc.jobsBadge),{color:"success.contrastText",backgroundColor:"success.main"}),children:[n.numberOfCompleteJobs," jobs"]}),(0,a.jsx)(ou,{disableMinWidth:!0,color:"success",variant:"contained",size:"small",onClick:function(){return Z({jobScheduleId:n.id,jobStatuses:["completed","reportSent","invoiceSent","customerPaid","supplierPaid","closed"],description:n.title})},children:(0,a.jsx)(oi.Z,{})})]})},sortable:!1,flex:1},(0,r.Z)((0,o.Z)({},tG.a),{isGridTogglePanel:!0,renderCell:function(e){return(0,a.jsx)(op,{id:e.id,value:e.value})}})]},[Z]),C=(0,i.useMemo)(function(){return null==x?void 0:x.map(function(e){var n,t,o=null===(n=e.jobs)||void 0===n?void 0:null===(t=n[0])||void 0===t?void 0:t.timingStart,r=0,a=e.jobs.length,i=e.jobs.filter(function(e){var n,t;return!(null===(n=e.statusData)||void 0===n?void 0:n.completed)&&!(null===(t=e.statusData)||void 0===t?void 0:t.closed)}).length;if("fixedMonthlyAmount"===e.invoiceBasis){var l=ed()(e.finalInvoiceDate).endOf("month").add(1,"millisecond"),s=ed()(e.firstInvoiceDate).startOf("month"),u=l.diff(s,"months");r=e.supplierMonthlyCharge*u}else"onCompletion"===e.invoiceBasis&&(r=e.jobs.reduce(function(e,n){return e+(n.supplierNet||0)},0));var c=(0,os.lt)(r>0?e.invoicesReceived/r*100:0,0),d=(0,os.lt)(r>0?e.invoicesPaid/r*100:0,0),p=(0,os.lt)(r-e.invoicesPaid>0?(r-e.invoicesPaid)/r*100:0,0);return{id:e.id,compliance:e.meta.compliance,title:e.meta.shortDescriptionName,description:e.description,serviceName:e.meta.serviceName,supplierName:e.meta.supplierName,supplierId:e.meta.supplierId,jobs:e.jobs,numberOfJobs:a,lastJob:ed()(o).format("YYYY-MM-DD"),totalInvoiceDue:r,totalInvoiceReceived:e.invoicesReceived,totalInvoiceReceivedPercentage:c,totalInvoicePaid:e.invoicesPaid,totalInvoicePaidPercentage:d,amountLeftToPay:r-e.invoicesPaid,amountLeftToPayPercentage:p,numberOfIncompleteJobs:i,numberOfCompleteJobs:a-i,scheduleStart:e.scheduleStart,scheduleEnd:e.scheduleEnd}})},[x]),I=function(e){var n;return(0,a.jsxs)(J.Z,{sx:oc.indicatorWrapper,children:[(0,a.jsx)(on.H,{height:90,backgroundColor:(0,oa.W)(e.scheduleEnd,!(0,ol.F)(e.jobs),!!(null===(n=e.jobs)||void 0===n?void 0:n.length))}),(0,a.jsx)(l.Z,{direction:"row",alignItems:"center",columnGap:2,sx:{fontWeight:"600",fontSize:"16px",marginLeft:"10px"},children:e.identifier})]})},S=function(e){return(0,a.jsx)(J.Z,{sx:oc.indicatorWrapper,children:(0,a.jsxs)(l.Z,{direction:"row",alignItems:"center",columnGap:2,children:[(0,a.jsx)(J.Z,{sx:{width:"24px",marginLeft:"8px"},children:e.compliance&&(0,a.jsx)(nW.Z,{sx:{color:"info.main"}})}),(0,a.jsxs)(l.Z,{ml:.5,children:[(0,a.jsx)(y.Z,{fontWeight:500,children:e.title}),(0,a.jsx)(y.Z,{typography:"subtitle2",fontWeight:300,children:e.description})]})]})})};return(0,a.jsxs)(eH.ZP,{container:!0,sx:{height:"100%"},children:[(0,a.jsx)(eH.ZP,{item:!0,xs:12,md:6,lg:6,children:(0,a.jsx)(tA,{locationId:n})}),(0,a.jsx)(eH.ZP,{xs:12,p:2,children:(0,a.jsx)(nu.n,{columns:w,renderIdentifierCell:I,renderValueCell:S,getDetailPanelHeight:function(){return"auto"},getDetailPanelContent:function(e){var t=e.row;return(0,a.jsx)(oe,{jobScheduleId:t.id,supplierId:t.supplierId,supplierName:t.supplierName,locationId:n,row:t})},rows:C,loading:b,ref:m,meta:g,refetch:j,autoHeight:!1,containerHeight:"calc(100vh - 120px)",rowHeight:120})})]})},op=function(e){var n=e.id,t=e.value,o=(0,tJ.l)(),r=(0,ot.P)(o,oo.Z3),l=i.isValidElement(r[n]);return(0,a.jsx)(g.Z,{size:"small",tabIndex:-1,disabled:!l,"aria-label":t?"Close":"Open",children:(0,a.jsx)(or.Z,{sx:function(e){return{transform:"rotateZ(".concat(t?180:0,"deg)"),transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})}},fontSize:"inherit"})})},om=function(e){var n=e.isSupplier,t=e.isCustomer,o=e.financeTab;return n?"supplier":t?"customer":o||"customer"},oh=function(e){var n=e.locationId,t=e.locationName,o=(0,L.x)().hasRole,r=o("supplier"),s=o("customer"),u=(0,eW.useRouter)(),c=om({isSupplier:r,isCustomer:s,financeTab:u.query.financeTab}),d=(0,i.useState)(c),p=d[0],m=d[1];(0,i.useEffect)(function(){var e=u.query;delete e.financeTab,e.financeTab=p,eL().push({pathname:u.pathname,query:e,shallow:!0})},[p]);var h=function(e){return function(){m(e)}},v=(0,i.useMemo)(function(){switch(p){case"customer":return(0,a.jsx)(tM,{locationId:n,locationName:t});case"supplier":return(0,a.jsx)(od,{locationId:n})}},[p,n,t]);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(l.Z,{direction:"row",columnGap:2,p:3,children:[!r&&(0,a.jsx)(eB.Z,{label:"Customer",control:(0,a.jsx)(ty.Z,{color:"secondary",checked:"customer"===p,onChange:h("customer")})}),!s&&(0,a.jsx)(eB.Z,{label:"Supplier",control:(0,a.jsx)(ty.Z,{color:"secondary",checked:"supplier"===p,onChange:h("supplier")})})]}),v]})};oh.propTypes={locationId:v().string.isRequired,locationName:v().string};var ov=["schedules","items","finances"],of=function(e){var n,t=e.showLocationSelector,s=e.locationId,u=e.locationName,c=e.calendarInitialFilters,h=e.hideCalendarFilters,v=e.tableInitialFilters,x=e.hideTableFilters,g=e.itemsInitialFilters,b=e.hideItemsFilters,y=e.hideFinances,j=e.hideItems,Z=(0,f.Z)("(max-width:600px)"),w=(0,eW.useRouter)(),C=(0,i.useState)(Array.isArray(n=w.query.viewTab)||!n?"schedules":ov.includes(n)?n:"schedules"),I=C[0],S=C[1],_=function(e,n){S(n),S(n),eL().push({query:(0,r.Z)((0,o.Z)({},w.query),{viewTab:n})})};return(0,a.jsxs)(l.Z,{children:[t&&(0,a.jsx)(p.c,{fullWidth:Z,locationId:s,locationName:u}),(0,a.jsxs)(l.Z,{sx:(0,o.Z)({},t&&{paddingTop:"25px"}),children:[(0,a.jsx)(ek,{defaultExpanded:"info",locationId:s}),(0,a.jsxs)(og,{value:I,is600pxOrLess:Z,children:[(0,a.jsxs)(ox,{value:I,onChange:_,"aria-label":"basic tabs example",textColor:"black.main",children:[(0,a.jsx)(d.Z,{label:"Schedules",value:"schedules"}),!j&&(0,a.jsx)(d.Z,{label:"Items",value:"items"})," ",s&&!y&&(0,a.jsx)(d.Z,{label:"Finances",value:"finances"})]}),(0,a.jsx)(eT.x,{value:I,index:"schedules",boxSx:{padding:"0px 0px 0px 0px"},children:(0,a.jsx)(tg,{locationId:s,calendarInitialFilters:c,hideCalendarFilters:h,tableInitialFilters:v,hideTableFilters:x})}),!j&&(0,a.jsx)(eT.x,{value:I,index:"items",boxSx:{padding:"0px 0px 0px 0px"},children:(0,a.jsx)(m.x,{locationId:s,locationName:u,initialFilters:g,hideFilters:b,columnVisibilityModel:{invoicePeriod:!1,invoiceBasis:!1,invoiceAmount:!1,compliance:!1},containerHeight:Z?"calc(100vh - 100px)":void 0,tableHeight:Z?"calc(100% - 120px)":void 0})}),s&&!y&&(0,a.jsx)(eT.x,{value:I,index:"finances",boxSx:{padding:"0px 0px 0px 0px"},children:(0,a.jsx)(oh,{locationId:s})})]})]})]})},ox=(0,u.ZP)(c.Z)(function(e){return{"&.MuiTabs-root":{paddingLeft:"16px",minHeight:"auto"},"& .MuiTabs-scroller":{minHeight:"auto"},"& .MuiTab-root":{fontSize:"18px",textTransform:"none",padding:"12px 0px",minWidth:"auto",minHeight:"auto",marginRight:"60px"},"& .MuiTabs-indicator":{bottom:"8px",backgroundColor:e.theme.palette.black.main}}}),og=(0,u.ZP)(s.Z)(function(e){var n=e.value,t=e.is600pxOrLess;return(0,o.Z)({marginTop:"25px"},"schedules"===n&&!t&&{height:"calc(100vh + 100px)"},"schedules"===n&&t&&{height:"calc(100vh + 500px)"},"items"===n&&{height:"calc(100vh - 22px)"},"overview"===n&&{height:"calc(100vh - 22px)"})})},70519:function(e,n,t){t.d(n,{v:function(){return Z}});var o=t(14924),r=t(85893),a=t(45697),i=t.n(a),l=t(60888),s=t(59462),u=t(5616),c=t(11057),d=t(19370),p=t(51233),m=t(44472),h=t(14621),v=t(57249),f=t(10556),x=t(70490),g=t(66647),b=t(1698),y=t(15861),j=t(90948),Z=function(e){var n=e.steps,t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(function(e){return!!e.active})},o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.filter(function(e){var n=e.active,t=e.data;return!!n&&!!t})};return(0,r.jsx)(u.Z,{children:(0,r.jsx)(d.Z,{orientation:"vertical",connector:(0,r.jsx)(w,{}),children:n.filter(function(e){var n=e.active;return void 0===n||n}).map(function(e,n){var a=e.id,i=e.label,d=e.info,h=e.date,v=e.content,f=e.actions,x=!!h,g=o(v),b=t(f),j=x?(0,r.jsx)(l.Z,{color:"primary"}):(0,r.jsx)(s.Z,{color:"primary"});return(0,r.jsxs)(m.Z,{completed:x,expanded:!0,children:[(0,r.jsxs)(I,{icon:j,children:[(0,r.jsx)(y.Z,{sx:{fontSize:"13px",fontWeight:600},children:i}),(0,r.jsx)(y.Z,{sx:{fontSize:"10px",fontWeight:400,ml:3,opacity:.6},children:h})]}),(0,r.jsxs)(C,{children:[(0,r.jsx)(u.Z,{children:x||(null==g?void 0:g.length)>0?g.map(function(e){return"function"==typeof e.data?e.data():(0,r.jsx)(y.Z,{sx:{fontSize:"10px"},children:e.data})}):(0,r.jsx)(y.Z,{sx:{fontSize:"10px",fontStyle:"italic"},children:d})}),(null==b?void 0:b.length)>0&&(0,r.jsx)(p.Z,{mt:.5,spacing:.5,children:b.map(function(e){return"button"!==e.type?null:(0,r.jsx)(u.Z,{children:(0,r.jsx)(c.Z,{color:e.context,variant:"contained",size:"small",onClick:e.handleClick,children:e.content})})})})]})]},"".concat(i,"-").concat(a))})})})};Z.propTypes={steps:i().arrayOf(i().shape({id:i().number,label:i().string,info:i().string,date:i().oneOfType([i().string,i().bool]),active:i().bool,content:i().arrayOf(i().shape({id:i().number,active:i().bool,data:i().oneOfType([i().string,i().element])})),actions:i().arrayOf(i().shape({id:i().number,active:i().bool,content:i().string,context:i().string,handleClick:i().func,type:"button"}))}))};var w=(0,j.ZP)(h.Z)(function(e){var n,t=e.theme;return n={},(0,o.Z)(n,"&.".concat(v.Z.active),(0,o.Z)({},"& .".concat(v.Z.line),{borderColor:t.palette.primary.main})),(0,o.Z)(n,"&.".concat(v.Z.completed),(0,o.Z)({},"& .".concat(v.Z.line),{borderColor:t.palette.primary.main})),(0,o.Z)(n,"& .".concat(v.Z.line),{borderColor:t.palette.primary.main,borderLeftWidth:4,borderRadius:1,marginLeft:"-2px"}),n}),C=(0,j.ZP)(f.Z)(function(e){var n=e.theme;return(0,o.Z)({},"&.".concat(x.Z.root),{borderColor:n.palette.primary.main,borderLeftWidth:4,marginLeft:"10px"})}),I=(0,j.ZP)(g.Z)(function(e){var n;return e.theme,n={},(0,o.Z)(n,"&.".concat(b.Z.root),{padding:0}),(0,o.Z)(n,"& .".concat(b.Z.labelContainer),{color:"inherit"}),(0,o.Z)(n,"& .".concat(b.Z.label),{display:"flex",alignItems:"center",color:"inherit"}),n})},86858:function(e,n,t){t.d(n,{x:function(){return u}});var o=t(26042),r=t(69396),a=t(99534),i=t(85893),l=t(90948),s=t(5616),u=function(e){var n=e.children,t=e.value,l=e.index,u=e.boxProps,d=e.boxSx,p=(0,a.Z)(e,["children","value","index","boxProps","boxSx"]);return(0,i.jsx)(c,(0,r.Z)((0,o.Z)({role:"tabpanel",hidden:t!==l,id:"simple-tabpanel-".concat(l),"aria-labelledby":"simple-tab-".concat(l)},p),{children:t===l&&(0,i.jsx)(s.Z,(0,r.Z)((0,o.Z)({},u),{sx:(0,o.Z)({padding:"25px 0"},d),children:n}))}))};u.defaultProps={boxProps:{},boxSx:{}};var c=(0,l.ZP)(s.Z)(function(){return{"& .MuiTabs-root":{}}})},15741:function(e,n,t){t.d(n,{n:function(){return b}});var o=t(26042),r=t(69396),a=t(85893),i=t(61730),l=t(67294),s=t(93946),u=t(51233),c=t(23508),d=t(98409),p=t(91807),m=t(86076),h=t(34270),v=t(45451),f=(0,l.forwardRef)(function(e,n){var t=e.columns,i=e.rows,s=e.columnVisibilityModel,c=void 0===s?{}:s,p=e.renderIdentifierCell,m=void 0===p?null:p,h=e.renderValueCell,f=void 0===h?null:h,b=e.getDetailPanelContent,y=void 0===b?null:b,j=(0,l.useState)(null),Z=j[0],w=j[1],C=(0,l.useMemo)(function(){return[{headerName:"",flex:1,field:"identifier",sortable:!1,renderCell:m?function(e){return m(e.row)}:function(e){var n=e.row;return(0,a.jsx)(u.Z,{sx:{fontWeight:"600",fontSize:"16px"},children:n.identifier})}},{headerName:"",flex:1,field:"valueCell",sortable:!1,renderCell:f?function(e){return f(e.row)}:"function"==typeof t[0].renderCell?t[0].renderCell:function(e){var n=e.row;return(0,a.jsx)(u.Z,{ml:2,children:"function"==typeof t[0].valueFormatter?t[0].valueFormatter({value:n[t[0].field]}):n[t[0].field]})}},(0,r.Z)((0,o.Z)({},d.a),{renderCell:function(e){return(0,a.jsx)(x,{setId:w,id:e.id,value:e.value})}})]},[t,m,f]),I=(0,l.useMemo)(function(){return null==i?void 0:i.map(function(e){return(0,r.Z)((0,o.Z)({},e),{identifier:t[0].headerName})})},[t,i]),S=(0,l.useMemo)(function(){return t.slice(1,t.length).filter(function(e){var n=e.field,t=e.isGridTogglePanel;return null!==c[n]&&!1!==c[n]&&!t}).map(function(e){return{identifier:{label:e.headerName},valueCell:{label:e.field,renderCell:"function"==typeof e.renderCell?e.renderCell:null,valueFormatter:"function"==typeof e.valueFormatter?e.valueFormatter:null}}})},[c,t]);return(0,a.jsx)(v.i,(0,r.Z)((0,o.Z)({},e),{ref:n,rows:I,columns:C,getRowClassName:function(e){return e.id===Z?"odd":""},slots:{columnHeaders:function(){return null}},getDetailPanelHeight:function(){return"auto"},getDetailPanelContent:function(e){var n=e.row;return(0,a.jsx)(g,{row:n,columns:S,getDetailPanelContent:y})}}))}),x=function(e){var n=e.id,t=e.value,o=e.setId,r=(0,p.l)();(0,l.useEffect)(function(){t&&o(n)},[o,t,n]);var i=(0,m.P)(r,h.Z3),u=l.isValidElement(i[n]);return(0,a.jsx)(s.Z,{size:"small",tabIndex:-1,disabled:!u,"aria-label":t?"Close":"Open",children:(0,a.jsx)(c.Z,{sx:function(e){return{transform:"rotateZ(".concat(t?180:0,"deg)"),transition:e.transitions.create("transform",{duration:e.transitions.duration.shortest})}},fontSize:"inherit"})})},g=function(e){var n=e.columns,t=e.row,o=e.getDetailPanelContent;return(0,a.jsxs)(a.Fragment,{children:[o?o({row:t}):null,n.map(function(e){var n=e.identifier,o=e.valueCell;return(0,a.jsxs)(u.Z,{direction:"row",alignItems:"center",justifyContent:"space-between",sx:{padding:"10px",marginTop:"10px",borderBottom:"1px solid #E0E0E0"},children:[(0,a.jsx)(u.Z,{width:"40%",sx:{fontWeight:"600",fontSize:"16px"},children:n.label}),(0,a.jsx)(u.Z,{width:"60%",ml:2,children:o.renderCell?o.renderCell({row:t}):o.valueFormatter?o.valueFormatter({value:t[o.label]}):t[o.label]})]})})]})},b=(0,l.forwardRef)(function(e,n){return(0,i.Z)("(max-width: 600px)")?(0,a.jsx)(f,(0,r.Z)((0,o.Z)({},e),{ref:n})):(0,a.jsx)(v.i,(0,r.Z)((0,o.Z)({},e),{ref:n}))})},22564:function(e,n,t){t.d(n,{lt:function(){return o},pv:function(){return r}});var o=function(e,n){var t=Math.pow(10,n);return Math.round(e*t)/t},r=function(e){return parseInt(e).toLocaleString("en-GB",{minimumIntegerDigits:2,useGrouping:!1})}},46242:function(e,n,t){t.d(n,{z:function(){return p}});var o=t(47568),r=t(828),a=t(29815),i=t(97582),l=t(6812),s=t(50319),u=t(92711),c=t(67999),d=t(67294),p=function(e,n,t,p){var m,h,v,f=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"media",x=(0,d.useState)(!1),g=x[0],b=x[1],y=(0,l.a)(u.O,{variables:{entity:e,entityId:p,category:f,adminId:n},skip:!p}),j=y.data,Z=(void 0===j?{items:[]}:j).items,w=y.loading,C=(0,r.Z)((0,s.D)(c.CI),2),I=C[0],S=C[1].loading,_=(0,r.Z)((0,s.D)(c.xM,{refetchQueries:["MEDIAS"]}),1)[0],P=function(e){I({variables:{mediaId:e}})},q=function(){var e="cleverly-media";return JSON.stringify([{width:32,height:32,bucket:e,sizeName:"vSmall",fit:"inside"},{width:200,height:200,bucket:e,sizeName:"small",fit:"inside"},{width:600,height:600,bucket:e,sizeName:"medium",fit:"inside"},{width:1200,height:1200,bucket:e,sizeName:"large",fit:"inside"}])},k=(m=(0,o.Z)(function(o,r){var a,l;return(0,i.__generator)(this,function(i){switch(i.label){case 0:if(i.trys.push([0,,4,5]),b(!0),!r)return[3,3];return[4,T(r)];case 1:return a=i.sent(),l={adminId:n,caption:r.caption,expiryAt:null,extension:r.media.name.split(".").pop(),userId:t,filename:a.key,type:r.type,Media_Entities:{data:[{entity:e,entityId:o}]}},[4,_({variables:{objects:l}})];case 2:i.sent(),i.label=3;case 3:return[3,5];case 4:return b(!1),[7];case 5:return[2]}})}),function(e,n){return m.apply(this,arguments)}),D=(h=(0,o.Z)(function(){var o,r,l,s,u,c,d,p,m,h,v,f,x,g,y,j,Z,w,C=arguments;return(0,i.__generator)(this,function(i){switch(i.label){case 0:o=C.length>0&&void 0!==C[0]?C[0]:[],r=C.length>1&&void 0!==C[1]?C[1]:"media",i.label=1;case 1:i.trys.push([1,,10,11]),b(!0),l=null,s=!0,u=!1,c=void 0,i.label=2;case 2:i.trys.push([2,7,8,9]),d=o[Symbol.iterator](),i.label=3;case 3:if(s=(p=d.next()).done)return[3,6];if((m=p.value).mediaId)return[3,5];return[4,T(m)];case 4:v=i.sent(),f=null,x=null,"image"===m.type?(g=v.key,f=(y=v.data.find(function(e){return"large"===e.name}))?y.relativePath:g,x={original:{relativePath:g},thumbnails:v.data||null}):f=v.key,l={Media_Entity:{data:(0,a.Z)(null!==(j=null==l?void 0:null===(h=l.Media_Entity)||void 0===h?void 0:h.data)&&void 0!==j?j:[]).concat([{entity:e,Medium:{data:{adminId:n,caption:null!==(Z=null==m?void 0:m.caption)&&void 0!==Z?Z:null,expiryAt:null,extension:m.media.name.split(".").pop(),userId:t,category:r,filename:f,type:m.type,meta:x}}}])}},i.label=5;case 5:return s=!0,[3,3];case 6:return[3,9];case 7:return w=i.sent(),u=!0,c=w,[3,9];case 8:try{s||null==d.return||d.return()}finally{if(u)throw c}return[7];case 9:return[2,l];case 10:return b(!1),[7];case 11:return[2]}})}),function(){return h.apply(this,arguments)}),T=(v=(0,o.Z)(function(e){var n,t,o,r,a;return(0,i.__generator)(this,function(a){switch(a.label){case 0:switch(n="cleverly-media",t="https://aws.cleverly.works/aws/s3/upload",(o=new window.FormData).append("file",e.media,e.media.name),e.type){case"image":r="https://aws.cleverly.works/image/process",o.append("sizes",q());break;case"document":case"audio":o.append("bucket",n),o.append("folder","".concat(e.type,"s")),r=t}return[4,window.fetch(r,{method:"POST",body:o})];case 1:return[2,a.sent().json()]}})}),function(e){return v.apply(this,arguments)});return{uploadMedia:k,uploadMediaToS3:T,createMediaInput:D,deleteMediaByEntity:P,loadingAddMedia:g,loadingDeleteMedia:S,preloadedMediaLoading:w,preloadedMedia:(null==Z?void 0:Z.length)?Z:[]}}},49010:function(e,n,t){t.d(n,{b:function(){return o}});var o=function(e){return String(e).toLowerCase().replace("gb","").length>=9}},14647:function(e,n,t){t.d(n,{lb:function(){return o},uJ:function(){return r}});var o=[{label:"Jan",value:"Jan"},{label:"Feb",value:"Feb"},{label:"Mar",value:"Mar"},{label:"Apr",value:"Apr"},{label:"May",value:"May"},{label:"Jun",value:"Jun"},{label:"Jul",value:"Jul"},{label:"Aug",value:"Aug"},{label:"Sep",value:"Sep"},{label:"Oct",value:"Oct"},{label:"Nov",value:"Nov"},{label:"Dec",value:"Dec"}],r=[{label:"January",value:"january"},{label:"February",value:"february"},{label:"March",value:"march"},{label:"April",value:"april"},{label:"May",value:"may"},{label:"June",value:"june"},{label:"July",value:"july"},{label:"August",value:"august"},{label:"September",value:"september"},{label:"October",value:"october"},{label:"November",value:"november"},{label:"December",value:"december"}]},69474:function(e,n,t){t.d(n,{O:function(){return r},y:function(){return o}});var o=[{area:"AB",name:"Aberdeen"},{area:"AL",name:"St. Albans"},{area:"B",name:"Birmingham"},{area:"BA",name:"Bath"},{area:"BB",name:"Blackburn"},{area:"BD",name:"Bradford"},{area:"BH",name:"Bournemouth"},{area:"BL",name:"Bolton"},{area:"BN",name:"Brighton"},{area:"BR",name:"Bromley"},{area:"BS",name:"Bristol"},{area:"BT",name:"Belfast"},{area:"CA",name:"Carlisle"},{area:"CB",name:"Cambridge"},{area:"CF",name:"Cardiff"},{area:"CH",name:"Chester"},{area:"CM",name:"Chelmsford"},{area:"CO",name:"Colchester"},{area:"CR",name:"Croydon"},{area:"CT",name:"Canterbury"},{area:"CV",name:"Coventry"},{area:"CW",name:"Crewe"},{area:"DA",name:"Dartford"},{area:"DD",name:"Dundee"},{area:"DE",name:"Derby"},{area:"DG",name:"Dumfries"},{area:"DH",name:"Durham"},{area:"DL",name:"Darlington"},{area:"DN",name:"Doncaster"},{area:"DT",name:"Dorchester"},{area:"DY",name:"Dudley"},{area:"E",name:"London E"},{area:"EC",name:"London EC"},{area:"EH",name:"Edinburgh"},{area:"EN",name:"Enfield"},{area:"EX",name:"Exeter"},{area:"FK",name:"Falkirk"},{area:"FY",name:"Blackpool"},{area:"G",name:"Glasgow"},{area:"GL",name:"Gloucester"},{area:"GU",name:"Guildford"},{area:"GY",name:"Guernsey"},{area:"HA",name:"Harrow"},{area:"HD",name:"Huddersfield"},{area:"HG",name:"Harrogate"},{area:"HP",name:"Hemel Hempstead"},{area:"HR",name:"Hereford"},{area:"HS",name:"Western Isles"},{area:"HU",name:"Hull"},{area:"HX",name:"Halifax"},{area:"IG",name:"Ilford"},{area:"IM",name:"Isle Of Man"},{area:"IP",name:"Ipswich"},{area:"IV",name:"Inverness"},{area:"JE",name:"Jersey"},{area:"KA",name:"Kilmarnock"},{area:"KT",name:"Kingston Upon Thames"},{area:"KW",name:"Kirkwall"},{area:"KY",name:"Kirkcaldy"},{area:"L",name:"Liverpool"},{area:"LA",name:"Lancaster"},{area:"LD",name:"Llandrindod Wells"},{area:"LE",name:"Leicester"},{area:"LL",name:"Llandudno"},{area:"LN",name:"Lincoln"},{area:"LS",name:"Leeds"},{area:"LU",name:"Luton"},{area:"M",name:"Manchester"},{area:"ME",name:"Medway"},{area:"MK",name:"Milton Keynes"},{area:"ML",name:"Motherwell"},{area:"N",name:"London N"},{area:"NE",name:"Newcastle Upon Tyne"},{area:"NG",name:"Nottingham"},{area:"NN",name:"Northampton"},{area:"NP",name:"Newport"},{area:"NR",name:"Norwich"},{area:"NW",name:"London NW"},{area:"OL",name:"Oldham"},{area:"OX",name:"Oxford"},{area:"PA",name:"Paisley"},{area:"PE",name:"Peterborough"},{area:"PH",name:"Perth"},{area:"PL",name:"Plymouth"},{area:"PO",name:"Portsmouth"},{area:"PR",name:"Preston"},{area:"RG",name:"Reading"},{area:"RH",name:"Redhill"},{area:"RM",name:"Romford"},{area:"S",name:"Sheffield"},{area:"SA",name:"Swansea"},{area:"SE",name:"London SE"},{area:"SG",name:"Stevenage"},{area:"SK",name:"Stockport"},{area:"SL",name:"Slough"},{area:"SM",name:"Sutton"},{area:"SN",name:"Swindon"},{area:"SO",name:"Southampton"},{area:"SP",name:"Salisbury"},{area:"SR",name:"Sunderland"},{area:"SS",name:"Southend-On-Sea"},{area:"ST",name:"Stoke-On-Trent"},{area:"SW",name:"London SW"},{area:"SY",name:"Shrewsbury"},{area:"TA",name:"Taunton"},{area:"TD",name:"Galashiels"},{area:"TF",name:"Telford"},{area:"TN",name:"Tonbridge"},{area:"TQ",name:"Torquay"},{area:"TR",name:"Truro"},{area:"TS",name:"Cleveland"},{area:"TW",name:"Twickenham"},{area:"UB",name:"Southall"},{area:"W",name:"London W"},{area:"WA",name:"Warrington"},{area:"WC",name:"London WC"},{area:"WD",name:"Watford"},{area:"WF",name:"Wakefield"},{area:"WN",name:"Wigan"},{area:"WR",name:"Worcester"},{area:"WS",name:"Walsall"},{area:"WV",name:"Wolverhampton"},{area:"YO",name:"York"},{area:"ZE",name:"Lerwick"}],r=new Map([["UK",/([A-Z]+)([0-9]+).*?[A-Z0-9]{3}/i],["GB",/([A-Z]+)([0-9]+).*?[A-Z0-9]{3}/i],["JE",/^JE\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}$/],["GG",/^GY\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}$/],["IM",/^IM\d[\dA-Z]?[ ]?\d[ABD-HJLN-UW-Z]{2}$/],["US",/^([0-9]{5})(?:-([0-9]{4}))?$/],["CA",/^([ABCEGHJKLMNPRSTVXY][0-9][ABCEGHJKLMNPRSTVWXYZ])\s*([0-9][ABCEGHJKLMNPRSTVWXYZ][0-9])$/i],["IE",/^([AC-FHKNPRTV-Y]\d{2}|D6W)\s[0-9AC-FHKNPRTV-Y]{4}$/],["DE",/^\d{5}$/],["JP",/^\d{3}-\d{4}$/],["FR",/^\d{2}[ ]?\d{3}$/],["AU",/^\d{4}$/],["IT",/^\d{5}$/],["CH",/^\d{4}$/],["AT",/^(?!0)\d{4}$/],["ES",/^(?:0[1-9]|[1-4]\d|5[0-2])\d{3}$/],["NL",/^\d{4}[ ]?[A-Z]{2}$/],["BE",/^\d{4}$/],["DK",/^\d{4}$/],["SE",/^(SE-)?\d{3}[ ]?\d{2}$/],["NO",/^\d{4}$/],["FI",/^(FI-|AX-)?\d{5}$/],["AX",/^22\d{3}$/],["KR",/^\d{5}$/],["CN",/^\d{6}$/],["TW",/^\d{3}(\d{2})?$/],["SG",/^\d{6}$/],["DZ",/^\d{5}$/],["AD",/^AD\d{3}$/],["AR",/^([A-HJ-NP-Z])?\d{4}([A-Z]{3})?$/],["AM",/^(37)?\d{4}$/],["AZ",/^\d{4}$/],["BH",/^((1[0-2]|[2-9])\d{2})?$/],["BD",/^\d{4}$/],["BB",/^(BB\d{5})?$/],["BY",/^\d{6}$/],["BM",/^[A-Z]{2}[ ]?[A-Z0-9]{2}$/],["BA",/^\d{5}$/],["IO",/^BBND 1ZZ$/],["BN",/^[A-Z]{2}[ ]?\d{4}$/],["BG",/^\d{4}$/],["KH",/^\d{5}$/],["CV",/^\d{4}$/],["CL",/^\d{7}$/],["CR",/^(\d{4,5}|\d{3}-\d{4})$/],["HR",/^(HR-)?\d{5}$/],["CY",/^\d{4}$/],["CZ",/^\d{3}[ ]?\d{2}$/],["DO",/^\d{5}$/],["EC",/^([A-Z]\d{4}[A-Z]|(?:[A-Z]{2})?\d{6})?$/],["EG",/^\d{5}$/],["EE",/^\d{5}$/],["FO",/^\d{3}$/],["GE",/^\d{4}$/],["GR",/^\d{3}[ ]?\d{2}$/],["GL",/^39\d{2}$/],["GT",/^\d{5}$/],["HT",/^\d{4}$/],["HN",/^(?:\d{5})?$/],["HU",/^\d{4}$/],["IS",/^\d{3}$/],["IN",/^\d{6}$/],["ID",/^\d{5}$/],["IL",/^\d{5,7}$/],["JO",/^\d{5}$/],["KZ",/^\d{6}$/],["KE",/^\d{5}$/],["KW",/^\d{5}$/],["LA",/^\d{5}$/],["LV",/^(LV-)?\d{4}$/],["LB",/^(\d{4}([ ]?\d{4})?)?$/],["LI",/^(948[5-9])|(949[0-7])$/],["LT",/^(LT-)?\d{5}$/],["LU",/^(L-)?\d{4}$/],["MK",/^\d{4}$/],["MY",/^\d{5}$/],["MV",/^\d{5}$/],["MT",/^[A-Z]{3}[ ]?\d{2,4}$/],["MU",/^((\d|[A-Z])\d{4})?$/],["MX",/^\d{5}$/],["MD",/^\d{4}$/],["MC",/^980\d{2}$/],["MA",/^\d{5}$/],["NP",/^\d{5}$/],["NZ",/^\d{4}$/],["NI",/^((\d{4}-)?\d{3}-\d{3}(-\d{1})?)?$/],["NG",/^(\d{6})?$/],["OM",/^(PC )?\d{3}$/],["PK",/^\d{5}$/],["PY",/^\d{4}$/],["PH",/^\d{4}$/],["PL",/^\d{2}-\d{3}$/],["RO",/^\d{6}$/],["RU",/^\d{6}$/],["SM",/^4789\d$/],["SA",/^\d{5}$/],["SN",/^\d{5}$/],["SK",/^\d{3}[ ]?\d{2}$/],["SI",/^(SI-)?\d{4}$/],["ZA",/^\d{4}$/],["LK",/^\d{5}$/],["TJ",/^\d{6}$/],["TH",/^\d{5}$/],["TN",/^\d{4}$/],["TR",/^\d{5}$/],["TM",/^\d{6}$/],["UA",/^\d{5}$/],["UY",/^\d{5}$/],["UZ",/^\d{6}$/],["VA",/^00120$/],["VE",/^\d{4}$/],["ZM",/^\d{5}$/],["AS",/^96799$/],["CC",/^6799$/],["CK",/^\d{4}$/],["RS",/^\d{5,6}$/],["ME",/^8\d{4}$/],["CS",/^\d{5}$/],["YU",/^\d{5}$/],["CX",/^6798$/],["ET",/^\d{4}$/],["FK",/^FIQQ 1ZZ$/],["NF",/^2899$/],["PN",/^PCRN 1ZZ$/],["PW",/^96940$/],["RE",/^9[78]4\d{2}$/],["SH",/^(ASCN|STHL) 1ZZ$/],["SJ",/^\d{4}$/],["SO",/^\d{5}$/],["SZ",/^[HLMS]\d{3}$/],["TC",/^TKCA 1ZZ$/],["WF",/^986\d{2}$/],["XK",/^\d{5}$/],["YT",/^976\d{2}$/],["INTL",/^(?:[A-Z0-9]+([- ]?[A-Z0-9]+)*)?$/i]])},56154:function(e,n,t){t.d(n,{j:function(){return o}});var o=[{label:"All jobs",value:"all"},{label:"Raised jobs",value:"raised"},{label:"Offered jobs",value:"offered"},{label:"Accepted jobs",value:"accepted"},{label:"In progress jobs",value:"inProgress"},{label:"Completed jobs",value:"completed"},{label:"Report sent jobs",value:"reportSent"},{label:"Follow on jobs",value:"followOn"}]}}]);