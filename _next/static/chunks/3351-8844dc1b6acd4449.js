"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3351],{34187:function(e,n,t){t.d(n,{C:function(){return m}});var r=t(26042),i=t(69396),o=t(85893);t(67294);var s=t(45697),a=t(90948),l=t(15861),c=t(51233),u=t(11057),d=t(61730),h=(0,a.ZP)("img")({width:"300px",height:"250px"}),m=function(e){var n=e.imageSrc,t=e.sx,s=e.imageSx,a=e.title,m=e.titleSx,x=e.subtitleFirstLine,p=e.subtitleFirstLineSx,v=e.subtitleSecondLine,f=e.subtitleSecondLineSx,g=e.buttonText,Z=e.onAction,j=(0,d.Z)("(max-width: 400px)");return(0,o.jsxs)(c.Z,{sx:(0,i.Z)((0,r.Z)({},t),{width:"100%",height:"100%"}),justifyContent:"center",alignItems:"center",spacing:2,color:"#757575",children:[(0,o.jsx)(h,{src:n,sx:(0,i.Z)((0,r.Z)({},s),{width:j?"250px":"300px"})}),(0,o.jsx)(l.Z,{typography:"h5",sx:(0,r.Z)({},m),children:a}),(0,o.jsxs)(c.Z,{alignItems:"center",sx:{padding:"0px 10px",textAlign:"center"},children:[(0,o.jsx)(l.Z,{sx:(0,r.Z)({},p),children:x}),(0,o.jsx)(l.Z,{sx:(0,r.Z)({},f),children:v})]}),g&&Z&&(0,o.jsx)(u.Z,{variant:"contained",color:"secondary",onClick:Z,children:g})]})};m.propTypes={imageSrc:s.string,title:s.string,subtitleFirstLine:s.string,subtitleSecondLine:s.string,onAction:s.func,sx:s.object,imageSx:s.object,titleSx:s.object,subtitleFirstLineSx:s.object,subtitleSecondLineSx:s.object},m.defaultProps={title:"",subtitleFirstLine:"",subtitleSecondLine:"",sx:{},imageSx:{},titleSx:{},subtitleFirstLineSx:{},subtitleSecondLineSx:{},onAction:null}},74301:function(e,n,t){t.d(n,{t:function(){return V}});var r=t(26042),i=t(69396),o=t(828),s=t(29815),a=t(85893),l=t(84808),c=t(11057),u=t(87918),d=t(98456),h=t(67720),m=t(86886),x=t(90629),p=t(51233),v=t(50135),f=t(15861),g=t(90948),Z=t(61730),j=t(45697),b=t.n(j),y=t(70768),w=t(26936),I=t(42283),C=t(18531),S=t(6812),T=t(50319),_=t(57493),L=t(67294),q=t(89268),A=t(91830),F=t(55651),E=t(38948),k=t(25040),U=t(85531),P=t(79665),W=t(23602),R=t(33754),O=t(30381),N=t.n(O),D=t(6103),H=t(19512),Q=t(21269),M=c.Z,Y=m.ZP,V=function(e){var n=e.isEdit,t=e.scheduleId,c=e.entity,m=e.entityId,x=e.close,g=(0,Z.Z)("(max-width: 600px)"),j=(0,H.D)(),b=(0,L.useState)(void 0!==n&&n)[0],O=(0,L.useState)(t),V=O[0],z=O[1],B=(0,L.useState)([]),J=B[0],X=B[1],K=(0,L.useState)(""),ee=K[0],en=K[1],et=(0,L.useState)(""),er=et[0],ei=et[1],eo=(0,L.useState)(""),es=eo[0],ea=eo[1],el=(0,L.useState)(""),ec=el[0],eu=el[1],ed=(0,L.useState)(null),eh=ed[0],em=ed[1],ex=(0,I.cI)({defaultValues:{status:"active",coverageAreas:[]},resolver:(0,P.S)(W.r)}),ep=ex.handleSubmit,ev=ex.control,ef=ex.errors,eg=ex.register,eZ=ex.watch,ej=ex.setValue,eb=ex.reset,ey=(0,I.Dq)({control:ev,name:"days"}),ew=eZ("service"),eI=eZ("coverageAreas"),eC=(0,S.a)(k.WC,{skip:!V,variables:{serviceScheduleId:V,includeParent:!!b},onCompleted:function(e){var n=e.serviceSchedule,t=(0,U.Ty)(n);eb((0,r.Z)({},t)),b||"Customer"!==c?b&&"Customer"===c&&X(n.parent.postcodeAreas.map(function(e){return e.postcode.area})):X(n.postcodeAreas.map(function(e){return e.postcode.area}))}}).loading,eS=(0,S.a)(_.kx,{variables:{q:""!==ee?"%".concat(ee,"%"):null,limit:50,offset:0}}),eT=eS.loading,e_=eS.data,eL=(void 0===e_?{items:[]}:e_).items,eq=(0,S.a)(_.pY,{skip:!(null==ew?void 0:ew.value),variables:(0,i.Z)((0,r.Z)({},(0,U.AL)({defaultScheduleId:t,scheduleId:V,entity:c,entityId:m,editMode:b})),{serviceId:null==ew?void 0:ew.value,q:""!==er?"%".concat(er,"%"):null,limit:50,offset:0})}),eA=eq.loading,eF=eq.data,eE=(void 0===eF?{items:[]}:eF).items,ek=(0,S.a)(_.T_,{variables:{where:{name:{_eq:""!==es?"%".concat(es,"%"):null},subtype:{_eq:"reactive"}},limit:50,offset:0}}),eU=ek.loading,eP=ek.data,eW=(void 0===eP?{items:[]}:eP).items,eR=(0,S.a)(_._d,{variables:{where:(0,i.Z)((0,r.Z)({},(0,U.dB)({areas:J})),{name:{_ilike:""!==ec?"%".concat(ec,"%"):null},status:{_eq:"active"},Account_Locations:{accountId:{_eq:m}}}),limit:50,offset:0},onCompleted:function(e){var n=e.items;!b&&"Customer"===c&&(null==n?void 0:n.length)&&ej("location",(0,s.Z)(n))}}),eO=eR.loading,eN=eR.data,eD=(void 0===eN?{items:[]}:eN).items,eH=(0,o.Z)((0,T.D)(k.Sx,{refetchQueries:["GetServiceSchedules","GetServiceSchedulesForEntity"],onError:function(e){j.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){j.show({content:"Service schedule was created",severity:"success"}),x()}}),1)[0],eQ=(0,o.Z)((0,T.D)(k.kt,{refetchQueries:["GetServiceSchedules","GetServiceSchedulesForEntity"],onError:function(e){j.show({content:"Error: ".concat(e.message),severity:"error"})},onCompleted:function(){j.show({content:"Service schedule was updated",severity:"success"}),x()}}),1)[0],eM=function(e){if(b){var n=(0,U._L)({form:e,entity:c,entityId:m});eQ({variables:{data:(0,i.Z)((0,r.Z)({},n),{id:V})}})}else{var t=(0,U._L)({form:e,entity:c,entityId:m});eH({variables:{data:t}})}},eY=(0,L.useMemo)(function(){return b?"Edit ".concat(G[c]," schedule"):"Add ".concat(G[c]," schedule")},[b,c]);return(0,a.jsxs)("form",{onSubmit:ep(eM),children:[eC&&(0,a.jsx)(l.Z,{sx:{zIndex:1e5},open:!0,children:(0,a.jsx)(d.Z,{color:"secondary"})}),(0,a.jsx)($,{is600pxOrLess:g,children:(0,a.jsxs)(p.Z,{height:"100%",width:"100%",children:[(0,a.jsx)(p.Z,{children:(0,a.jsx)(f.Z,{variant:"h5",fontWeight:700,children:eY})}),(0,a.jsx)(p.Z,{height:"100%",pt:2,pr:2,sx:{overflowY:"scroll"},children:(0,a.jsxs)(Y,{container:!0,columnSpacing:2,children:[(0,a.jsxs)(Y,{container:!0,item:!0,xs:12,md2:7,columnSpacing:2,rowSpacing:2,children:[(0,a.jsxs)(Y,{item:!0,xs:12,sm2:6,children:[(0,a.jsxs)(p.Z,{spacing:2,mb:2,children:[(0,a.jsxs)(p.Z,{direction:"row",alignItems:"center",width:"100%",children:[(0,a.jsx)(f.Z,{mr:"29px",children:"Service"}),(0,a.jsx)(p.Z,{direction:"row",alignItems:"center",width:"100%",spacing:1,children:(0,a.jsx)(I.Qr,{name:"service",control:ev,render:function(e){var n,t=e.value,i=e.onChange;return(0,a.jsx)(C.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t||null,onChange:function(e,n){(null==n?void 0:n.value)?i(n):(z(null),eb((0,r.Z)({},q.FY)))},loading:eT,options:eL,setSearch:en,textFieldProps:{color:"secondary",variant:"standard",placeholder:"Service",error:ef.service,helperText:null===(n=ef.service)||void 0===n?void 0:n.message},sx:{width:"170px"}})}})})]}),(0,a.jsxs)(p.Z,{direction:"row",alignItems:"center",width:"100%",spacing:2,children:[(0,a.jsx)(f.Z,{children:"Schedule"}),(0,a.jsx)(I.Qr,{name:"schedule",control:ev,render:function(e){var n,t=e.value,o=e.onChange;return(0,a.jsx)(C.q,{filterSelectedOptions:!0,isOptionEqualToValue:function(e,n){return e.value===n.value},value:t||null,onChange:function(e,n){(null==n?void 0:n.value)?(z(null==n?void 0:n.value),o(n)):(z(null),eb((0,i.Z)((0,r.Z)({},q.FY),{service:ew})))},loading:eA,options:eE,setSearch:ei,textFieldProps:{color:"secondary",variant:"standard",placeholder:"Schedule",error:ef.schedule,helperText:null===(n=ef.schedule)||void 0===n?void 0:n.message},sx:{width:"200px"}})}})]}),(0,a.jsxs)(p.Z,{direction:"row",alignItems:"center",width:"100%",children:[(0,a.jsx)(f.Z,{mr:"34px",children:"Status"}),(0,a.jsx)(I.Qr,{name:"status",control:ev,render:function(e){var n,t=e.value,r=e.onChange;return(0,a.jsx)(A.P,{formControl:{fullWidth:!0,variant:"standard",color:"secondary",error:ef.status,helperText:null===(n=ef.status)||void 0===n?void 0:n.message},selectProps:{fullWidth:!0,sx:{width:"200px"}},value:t,onChange:r,options:q.hm})}})]})]}),(0,a.jsxs)(p.Z,{width:"100%",mb:2,children:[(0,a.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Priority"}),(0,a.jsx)(I.Qr,{name:"priority",control:ev,render:function(e){var n,t=e.value,r=e.onChange;return(0,a.jsx)(C.q,{multiple:!0,fullWidth:!0,disabled:"Supplier"===c||"Customer"===c||"Location"===c,color:"secondary",filterSelectedOptions:!0,loading:eU,value:t||[],onChange:function(e,n){r(n)},options:eW,setSearch:ea,textFieldProps:{placeholder:"Select priority",variant:"standard",color:"secondary",error:ef.priority,helperText:null===(n=ef.priority)||void 0===n?void 0:n.message},sx:{width:"200px"}})}})]}),(0,a.jsxs)(Y,{container:!0,item:!0,columnSpacing:2,rowSpacing:2,children:[(0,a.jsxs)(Y,{item:!0,children:[(0,a.jsx)(f.Z,{children:"Minimum duration"}),(0,a.jsx)(I.Qr,{name:"minimumDuration",control:ev,render:function(e){var n,t=e.value,r=e.onChange;return(0,a.jsx)(y.I,{leftLabel:(0,a.jsx)(Q.Z,{sx:{height:"18px"}}),rightLabel:"Mins",sx:{width:"60px"},type:"number",value:t,onChange:r,error:ef.minimumDuration,helperText:null===(n=ef.minimumDuration)||void 0===n?void 0:n.message})}})]}),(0,a.jsxs)(Y,{item:!0,children:[(0,a.jsx)(f.Z,{children:"Minimum increment"}),(0,a.jsx)(I.Qr,{name:"minimumIncrement",control:ev,render:function(e){var n,t=e.value,r=e.onChange;return(0,a.jsx)(y.I,{leftLabel:(0,a.jsx)(Q.Z,{sx:{height:"18px"}}),rightLabel:"Mins",sx:{width:"60px"},type:"number",value:t,onChange:r,error:ef.minimumIncrement,helperText:null===(n=ef.minimumIncrement)||void 0===n?void 0:n.message})}})]})]})]}),(0,a.jsxs)(Y,{item:!0,xs:12,sm2:6,children:["Supplier"===c&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(E.B,{paginationSize:4,entity:"ServiceSchedule",entityId:V,name:"coverageAreas",values:eI||[],setValue:ej}),(0,a.jsx)("input",(0,i.Z)((0,r.Z)({},eg("coverageAreas")),{type:"hidden"}))]}),"Customer"===c&&(0,a.jsx)(I.Qr,{name:"location",control:ev,render:function(e){var n,t=e.value,r=e.onChange;return(0,a.jsx)(C.q,{multiple:!0,fullWidth:!0,color:"secondary",filterSelectedOptions:!0,loading:eO,value:t||[],onChange:function(e,n){r(n)},options:eD,setSearch:eu,textFieldProps:{label:"Select location",variant:"standard",color:"secondary",error:ef.location,helperText:null===(n=ef.location)||void 0===n?void 0:n.message}})}})]}),(0,a.jsxs)(Y,{container:!0,item:!0,xs:12,children:[(0,a.jsxs)(Y,{item:!0,sx:12,height:"27px",width:"100%",pr:2,mb:1,children:[(0,a.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Rates"}),(0,a.jsx)(h.Z,{})]}),(0,a.jsxs)(Y,{width:"100%",container:!0,item:!0,xs:12,columnSpacing:2,rowSpacing:2,children:[(0,a.jsx)(Y,{item:!0,children:(0,a.jsxs)(p.Z,{spacing:1,children:[(0,a.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Normal"}),(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(f.Z,{children:"First hour"}),(0,a.jsx)(I.Qr,{name:"normal.firstHour",control:ev,render:function(e){var n,t,r,i=e.value,o=e.onChange;return(0,a.jsx)(y.I,{leftLabel:(0,a.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:i,onChange:o,error:null===(n=ef.normal)||void 0===n?void 0:n.firstHour,helperText:null===(t=ef.normal)||void 0===t?void 0:null===(r=t.firstHour)||void 0===r?void 0:r.message})}})]}),(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(f.Z,{children:"Subsequent hours"}),(0,a.jsx)(I.Qr,{name:"normal.subsequentHours",control:ev,render:function(e){var n,t,r,i=e.value,o=e.onChange;return(0,a.jsx)(y.I,{leftLabel:(0,a.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:i,onChange:o,error:null===(n=ef.normal)||void 0===n?void 0:n.subsequentHours,helperText:null===(t=ef.normal)||void 0===t?void 0:null===(r=t.subsequentHours)||void 0===r?void 0:r.message})}})]})]})}),(0,a.jsx)(Y,{item:!0,children:(0,a.jsxs)(p.Z,{spacing:1,children:[(0,a.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"OOH"}),(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(f.Z,{children:"First hour"}),(0,a.jsx)(I.Qr,{name:"ooh.firstHour",control:ev,render:function(e){var n,t,r,i=e.value,o=e.onChange;return(0,a.jsx)(y.I,{leftLabel:(0,a.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:i,onChange:o,error:null===(n=ef.ooh)||void 0===n?void 0:n.firstHour,helperText:null===(t=ef.ooh)||void 0===t?void 0:null===(r=t.firstHour)||void 0===r?void 0:r.message})}})]}),(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(f.Z,{children:"Subsequent hours"}),(0,a.jsx)(I.Qr,{name:"ooh.subsequentHours",control:ev,render:function(e){var n,t,r,i=e.value,o=e.onChange;return(0,a.jsx)(y.I,{leftLabel:(0,a.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:i,onChange:o,error:null===(n=ef.ooh)||void 0===n?void 0:n.subsequentHours,helperText:null===(t=ef.ooh)||void 0===t?void 0:null===(r=t.subsequentHours)||void 0===r?void 0:r.message})}})]})]})}),(0,a.jsx)(Y,{item:!0,children:(0,a.jsxs)(p.Z,{spacing:1,children:[(0,a.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Premium"}),(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(f.Z,{children:"First hour"}),(0,a.jsx)(I.Qr,{name:"premium.firstHour",control:ev,render:function(e){var n,t,r,i=e.value,o=e.onChange;return(0,a.jsx)(y.I,{leftLabel:(0,a.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:i,onChange:o,error:null===(n=ef.premium)||void 0===n?void 0:n.firstHour,helperText:null===(t=ef.premium)||void 0===t?void 0:null===(r=t.firstHour)||void 0===r?void 0:r.message})}})]}),(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(f.Z,{children:"Subsequent hours"}),(0,a.jsx)(I.Qr,{name:"premium.subsequentHours",control:ev,render:function(e){var n,t,r,i=e.value,o=e.onChange;return(0,a.jsx)(y.I,{leftLabel:(0,a.jsx)(w.Z,{sx:{height:"18px"}}),rightLabel:"Ex VAT",sx:{width:"80px"},type:"number",value:i,onChange:o,error:null===(n=ef.premium)||void 0===n?void 0:n.subsequentHours,helperText:null===(t=ef.premium)||void 0===t?void 0:null===(r=t.subsequentHours)||void 0===r?void 0:r.message})}})]})]})})]})]})]}),(0,a.jsx)(Y,{item:!0,xs:12,md2:5,children:(0,a.jsxs)(p.Z,{spacing:1,children:[(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(f.Z,{variant:"h6",fontWeight:700,mb:1,children:"Times"}),(0,a.jsx)(h.Z,{})]}),(0,a.jsxs)(p.Z,{spacing:.5,children:[(0,a.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"OOH"}),(0,a.jsx)(p.Z,{spacing:.5,children:q.jT.map(function(e){var n,t,r;return(0,a.jsx)(F.k,{control:ev,name:"oohTimes.".concat(e.value),day:e.label,error:null===(n=ef.oohTimes)||void 0===n?void 0:n[e.value],helperText:null===(t=ef.oohTimes)||void 0===t?void 0:null===(r=t[e.value])||void 0===r?void 0:r.message})})})]}),(0,a.jsxs)(p.Z,{spacing:.5,children:[(0,a.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Premium"}),(0,a.jsx)(p.Z,{spacing:.5,children:q.jT.map(function(e){var n,t,r;return(0,a.jsx)(F.k,{control:ev,name:"premiumTimes.".concat(e.value),day:e.label,error:null===(n=ef.premiumTimes)||void 0===n?void 0:n[e.value],helperText:null===(t=ef.premiumTimes)||void 0===t?void 0:null===(r=t[e.value])||void 0===r?void 0:r.message})})})]})]})}),(0,a.jsxs)(Y,{container:!0,item:!0,xs:12,mt:2,columnSpacing:2,children:[(0,a.jsx)(Y,{item:!0,xs:0,md2:7}),(0,a.jsx)(Y,{item:!0,xs:12,md2:5,children:(0,a.jsxs)(p.Z,{children:[(0,a.jsx)(f.Z,{variant:"h6",fontWeight:700,children:"Days"}),(0,a.jsx)(p.Z,{direction:"row",spacing:1,flexWrap:"wrap",children:ey.fields.map(function(e,n){return(0,a.jsx)(u.Z,{label:N()(e).format("YYYY-MM-DD"),size:"small",onDelete:function(){return ey.remove(n)}})})}),(0,a.jsxs)(p.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,a.jsx)(R.M,{inputFormat:"YYYY-MM-DD",placeholder:"Select days",value:eh,onChange:function(e){em(e)},renderInput:function(e){return(0,a.jsx)(v.Z,(0,i.Z)((0,r.Z)({},e),{fullWidth:!0,color:"secondary",variant:"standard"}))}}),(0,a.jsx)(M,{disableMinWidth:!0,color:"secondary",variant:"contained",size:"small",onClick:function(){return ey.append(eh)},children:(0,a.jsx)(D.Z,{})})]})]})})]}),(0,a.jsx)(Y,{item:!0,xs:12,sx:{display:"flex",justifyContent:"center"},mt:2,children:(0,a.jsx)(f.Z,{color:"muiGray.main",children:"All job start times occurring outside times specified above will be charged based on Normal rates."})})]})}),(0,a.jsxs)(p.Z,{width:"100%",direction:"row",justifyContent:"center",spacing:2,children:[(0,a.jsx)(M,{color:"danger",variant:"contained",onClick:x,children:"Cancel"}),(0,a.jsx)(M,{color:"secondary",variant:"contained",type:"submit",children:b?"Save":"Add schedule"})]})]})})]})};V.propTypes={entity:b().oneOf(["Supplier","Customer","Location"]).isRequired},V.defaultProps={};var $=(0,g.ZP)(x.Z)(function(e){var n=e.is600pxOrLess;return{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:n?"100vw":"90vw",height:n?"100vh":"90vh",padding:"16px 27px 16px 27px",borderRadius:"8px"}}),G={Supplier:"supplier",Customer:"customer",Location:"location"}},63047:function(e,n,t){t.d(n,{E:function(){return a}});var r,i=t(47568),o=t(97582),s=t(94885),a=(r=(0,i.Z)(function(e,n){var t,r,i,a=arguments;return(0,o.__generator)(this,function(r){switch(r.label){case 0:t=a.length>2&&void 0!==a[2]&&a[2],r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.query({query:s.WF,variables:{email:n}})];case 2:if((i=r.sent().data.users)&&i.length>0)return[2,!!t&&i[0]];return[2,!t||null];case 3:return r.sent(),[2,!0];case 4:return[2]}})}),function(e,n){return r.apply(this,arguments)})},87407:function(e,n,t){t.d(n,{H:function(){return $}});var r=t(26042),i=t(69396),o=t(29815),s=t(85893),a=t(67294),l=t(45697),c=t(6812),u=t(42283),d=t(79665),h=t(5616),m=t(69368),x=t(98456),p=t(94054),v=t(56815),f=t(51233),g=t(50135),Z=t(15861),j=t(76600),b=t(49501),y=t(95103),w=t(55563),I=t(90951),C=t(43724),S=t(31765),T=t(828),_=t(16310),L=(0,_.Ry)().shape({nameFirst:(0,_.Z_)().required(),nameLast:(0,_.Z_)().required(),email:(0,_.Z_)().required().email(),phone:(0,_.Z_)().required(),status:(0,_.Z_)().when("$hasRole",function(e,n){return(0,T.Z)(e,1)[0]?n.oneOf(["active","inactive"]).required():n}),invoiceThreshold:(0,_.Rx)().nullable().transform(function(e){return isNaN(e)?null:e}),quoteThreshold:(0,_.Rx)().nullable().transform(function(e){return isNaN(e)?null:e}),role:(0,_.Z_)().when(["$hasRole","$hasOneOwner","accountId"],function(e,n){var t=(0,T.Z)(e,3),r=t[0],i=t[1],o=t[2];return r?i?n.oneOf(["owner"],"Each account must have a designated owner.\n          If you would like to change the account type on this user,\n          please create another user account and designate this new account as an owner."):o&&o.length>0&&n.required():n}),position:(0,_.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:function(){return(0,_.Z_)()}}),isContact:(0,_.Z_)().when("accountId",{is:function(e){return e&&e.length>0},then:function(){return(0,_.Z_)().oneOf(["yes","no"]).required()}}),location:(0,_.IX)().when("$hasLocation",function(e,n){return(0,T.Z)(e,1)[0]?n.of((0,_.Rx)().integer().required()).required():n})}),q=t(74944),A=t(94885),F=t(12632),E=t(83372),k=t(90878),U=t(50480),P=function(e){var n=e.name,t=e.control,r=e.permissions,i=e.styles;return(0,s.jsxs)(h.Z,{sx:i,children:[(0,s.jsx)(Z.Z,{variant:"h6",color:"dark.main",sx:{fontFamily:"Arial, sans-serif, sans-serif",fontWeight:"normal"},children:"Permissions"}),(0,s.jsx)(f.Z,{spacing:1,direction:"row",children:r.map(function(e){return(0,s.jsx)(u.Qr,{name:"".concat(n?n+".":"").concat(e.name),control:t,render:function(n){var t=n.value,r=n.onChange;return(0,s.jsx)(U.Z,{color:"dark.main",control:(0,s.jsx)(m.Z,{color:"secondary",checked:t,onChange:function(e){return r(e.target.checked)}}),label:e.label})}})})})]})};P.defaultProps={permissions:[]},P.propTypes={name:l.string,control:l.object.isRequired,permissions:l.object,styles:l.object};var W={customer_user:[{label:"Job reports",name:"jobReports"},{label:"PPM Schedules",name:"ppmSchedules"},{label:"Quotes",name:"quotes"},{label:"Finances",name:"finances"}]},R=t(7297),O=t(75063);function N(){var e=(0,R.Z)(["\n  query GetUserEditOffCanvas($userId: Int!, $accountId: Int, $includeAccount: Boolean!) {\n    user: User_by_pk(id: $userId) {\n      id\n      name: nameFirst\n      nameFirst\n      nameLast\n      phone\n      status\n      email\n      createdAt\n      meta\n      invoiceThreshold\n      quoteThreshold\n      accounts: Account_Users(where: { accountId: { _eq: $accountId } })\n        @include(if: $includeAccount) {\n        id\n        role\n        position\n        isContact\n        status\n        modules\n        account: Account {\n          id\n          name\n          type\n        }\n        userLocations: User_Account_Locations {\n          accountLocationId\n        }\n      }\n    }\n  }\n"]);return N=function(){return e},e}function D(){var e=(0,R.Z)(['\n  query FindOwnersByAccount($accountId: Int, $userId: Int) {\n    accountUsers: Account_User(\n      where: { role: { _eq: "owner" }, accountId: { _eq: $accountId }, userId: { _neq: $userId } }\n    ) {\n      id\n      role\n    }\n  }\n']);return D=function(){return e},e}var H=(0,O.Ps)(N()),Q=(0,O.Ps)(D()),M=t(45451),Y=["customer_user"],V=["customer_user","tenant_user"],$=function(e){var n,t=e.userId,l=e.accountId,T=e.accountType,_=e.submit,U=(0,q.x)(),R=U.hasRole,O=U.user,N=(0,F.x)({filters:{}}),D=N.initialData,$=N.ref,G=(0,a.useState)(!0),z=G[0],B=G[1],J=(0,a.useState)(""),X=J[0],K=J[1],ee=(0,a.useState)(null),en=ee[0],et=ee[1],er=(0,u.cI)({defaultValues:{id:t,accountId:l},resolver:(0,d.S)(L),context:{hasRole:(0,k.t4)(T,R),hasLocation:!Y.includes(O.role)&&Y.includes(X),hasOneOwner:z}}),ei=er.control,eo=er.errors,es=er.handleSubmit,ea=er.register,el=er.watch,ec=er.reset,eu=er.setValue,ed=el("role"),eh=el("location");(0,a.useEffect)(function(){K("".concat(T,"_").concat(ed))},[T,ed]);var em=(0,c.a)(H,{skip:!t,variables:{userId:t,accountId:l,includeAccount:!!l},onCompleted:function(e){var n,t=e.user,r={id:t.id,accountId:t.accountId,nameFirst:t.nameFirst||"",nameLast:t.nameLast||"",email:t.email||"",phone:t.phone||"",invoiceThreshold:t.invoiceThreshold,quoteThreshold:t.quoteThreshold,role:"",position:"",isContact:"",status:"active",meta:t.meta},i=null===(n=t.accounts)||void 0===n?void 0:n.find(function(e){return e.account.id===l});i&&(r.accountUserId=i.id,r.accountId=i.account.id,r.role=i.role,r.position=i.position,r.isContact=!0===i.isContact?"yes":"no",r.status=i.status,r.location=i.userLocations.map(function(e){return e.accountLocationId}),r.modules=i.modules),ec(r),K("".concat(T,"_").concat(r.role)),et(r.accountUserId)}}),ex=em.data,ep=(void 0===ex?{}:ex).user,ev=em.loading;(0,c.a)(Q,{skip:!l,variables:{accountId:l,userId:t},onCompleted:function(e){B(!(e.accountUsers.length>0))}});var ef=(0,c.a)(A.ZA,{variables:(0,i.Z)((0,r.Z)({},D),{accountId:l})}),eg=ef.data,eZ=void 0===eg?{location:[],meta:{aggregate:{totalCount:0}}}:eg,ej=eZ.location,eb=eZ.meta,ey=ef.loading,ew=ef.refetch,eI=(0,o.Z)(S.I);switch(T){case"supplier":eI.push({text:"Operative",value:"contractor"});break;case"admin":eI.push({text:"Helpdesk",value:"helpdesk"})}var eC={control:ei,errors:eo,register:ea},eS=function(e){_(e,null==ep?void 0:ep.meta)},eT=(0,a.useCallback)(function(e){return function(n){n.target.checked?eu("location",(0,o.Z)(null!=eh?eh:[]).concat([e])):eu("location",eh.filter(function(n){return n!==e}))}},[eh,eu]),e_=(0,a.useMemo)(function(){return[{sortable:!1,minWidth:10,field:"id",headerName:"",renderCell:function(e){var n=e.row;return(0,s.jsx)(m.Z,{color:"secondary",checked:null==eh?void 0:eh.includes(n.id),onChange:eT(n.id)})}},{sortable:!1,flex:1,field:"name",headerName:"Name"},{sortable:!1,flex:1,field:"address",headerName:"Address",renderCell:function(e){var n=e.row;return n.address?(0,s.jsxs)(f.Z,{children:[(0,s.jsx)(Z.Z,{children:n.address.addressLine1}),(0,s.jsx)(Z.Z,{children:n.address.postCode})]}):(0,s.jsx)(Z.Z,{children:"Please add"})}}]},[eh,eT]);if(ev)return(0,s.jsx)(f.Z,{widht:"100%",alignItems:"center",children:(0,s.jsx)(x.Z,{color:"secondary"})});var eL={id:(0,k.t4)(T,R)};return(0,s.jsxs)(j.Z,{id:"offCanvasForm",handleSubmit:es(eS),children:[(0,s.jsx)(C.q,(0,r.Z)({},eC)),l&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(h.Z,{children:[(0,k.t4)(T,R)&&(0,s.jsx)(p.Z,{fullWidth:!0,error:eo.role,children:(0,s.jsxs)(b.Z,{label:"Role",children:[(0,s.jsx)(y.Z,(0,i.Z)((0,r.Z)({},eC),{name:"role",options:eI})),(0,s.jsx)(v.Z,{sx:{margin:0},children:null===(n=eo.role)||void 0===n?void 0:n.message})]})}),(0,s.jsx)(b.Z,{label:"Position / Job title",children:(0,s.jsx)(w.Z,(0,i.Z)((0,r.Z)({},eC),{name:"position"}))}),(0,k.pP)({accountType:T,role:ed,hasRole:R})&&(null==ep?void 0:ep.id)!==O.id&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.Z,{label:"Threshold limit / Invoice",children:(0,s.jsx)(g.Z,{inputRef:ea,inputProps:{min:0},size:"small",name:"invoiceThreshold",type:"number",sx:{width:"100%",fieldset:{border:"1px solid ".concat(E.Q.COLOUR.dark)}},InputProps:{sx:{input:{padding:"0 0.725rem",height:"2.25rem"}}}})}),(0,s.jsx)(b.Z,{label:"Threshold limit / Quote",children:(0,s.jsx)(g.Z,{inputRef:ea,inputProps:{min:0},size:"small",name:"quoteThreshold",type:"number",sx:{width:"100%",fieldset:{border:"1px solid ".concat(E.Q.COLOUR.dark)}},InputProps:{sx:{input:{padding:"0 0.725rem",height:"2.25rem"}}}})})]}),(0,s.jsx)(I.Z,(0,i.Z)((0,r.Z)({},eC),{data:[{id:"yes",label:"Yes",value:"yes"},{id:"no",label:"No",value:"no"}],legend:"Contact User",name:"isContact",stacked:!0})),V.includes(X)&&t!==O.id&&(0,s.jsx)(P,{name:"modules",control:ei,permissions:W[X],styles:{mb:2}})]}),(0,s.jsx)(h.Z,{children:Y.includes(X)&&t!==O.id&&(0,s.jsxs)(b.Z,{label:"Locations",children:[(0,s.jsx)(M.i,{columnVisibilityModel:eL,columns:e_,loading:ey,meta:eb,ref:$,refetch:ew,rows:ej.map(function(e){var n;return{id:e.accountLocations[0].id,name:e.name,address:null===(n=e.addresses[0])||void 0===n?void 0:n.address}})}),(0,s.jsx)("input",(0,i.Z)((0,r.Z)({},ea("location")),{type:"hidden"}))]})})]}),t&&(0,s.jsx)(w.Z,(0,i.Z)((0,r.Z)({},eC),{name:"id",type:"hidden"})),l&&(0,s.jsx)(w.Z,(0,i.Z)((0,r.Z)({},eC),{name:"accountId",type:"hidden"})),en&&(0,s.jsx)(w.Z,(0,i.Z)((0,r.Z)({},eC),{name:"accountUserId",type:"hidden"}))]})};$.propTypes={accountType:l.string,defaultValues:l.object,submit:l.func.isRequired}},90878:function(e,n,t){t.d(n,{pP:function(){return c},qF:function(){return a},t4:function(){return l},te:function(){return s}});var r=t(26042),i=t(29815),o=t(53625),s=function(e,n,t){var i={};return e.id?(i.id=parseInt(e.id),i.changes={nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,meta:(0,r.Z)({},n),invoiceThreshold:e.invoiceThreshold||null,quoteThreshold:e.quoteThreshold||null},e.accountUserId?(i.updateAccountUser=!0,i.accountUserId=parseInt(e.accountUserId),i.accountUserChanges={role:e.role,position:e.position,isContact:"yes"===e.isContact,status:e.status,modules:e.modules}):(i.accountUserId=0,i.updateAccountUser=!1)):(i.role=e.role||"user",i.position=e.position,i.isContact="yes"===e.isContact,i.status=e.status,i.accountId=e.accountId,i.modules=e.modules,t?i.userId=t.id:i.User={data:{nameFirst:e.nameFirst,nameLast:e.nameLast,email:e.email,phone:e.phone,status:e.status,meta:{sendDefaultWelcomeEmail:!0},invoiceThreshold:e.invoiceThreshold||null,quoteThreshold:e.quoteThreshold||null}}),i},a=function(e){return{accountUserId:e.accountUserId,objects:e.location.map(function(n){return{accountUserId:e.accountUserId,accountLocationId:n}})}},l=function(e,n){return"customer"!==e&&"supplier"!==e||n((0,i.Z)(o.td).concat((0,i.Z)(o.Sf),(0,i.Z)(o.n),(0,i.Z)(o.nx)))},c=function(e){var n=e.accountType,t=e.role,r=e.hasRole;return r(["admin_owner","customer_owner","supplier_owner"])?!["admin_owner","customer_owner","supplier_owner"].includes("".concat(n,"_").concat(t)):r(["customer_manager","supplier_manager"])?["admin_user","customer_user","supplier_user"].includes("".concat(n,"_").concat(t)):!!r(["admin_manager"])&&["admin_user","customer_user","supplier_user","customer_manager","supplier_manager"].includes("".concat(n,"_").concat(t))}},70323:function(e,n,t){t.d(n,{q:function(){return P}});var r=t(47568),i=t(26042),o=t(828),s=t(29815),a=t(97582),l=t(85893),c=t(67294),u=t(45697),d=t(11163),h=t.n(d),m=t(30381),x=t.n(m),p=t(51233),v=t(90629),f=t(11057),g=t(15861),Z=t(69661),j=t(66252),b=t(6812),y=t(50319),w=t(14651),I=t(21830),C=t(45451),S=t(34187),T=t(87407),_=t(57779),L=t(94885),q=t(12632),A=t(90878),F=t(63047),E=t(74944),k=t(74492),U=t(74280),P=function(e){var n=e.accountType,t=e.filters,u=(0,j.x)(),d=(0,q.x)({filters:t}),m=d.initialData,P=d.ref,R=(0,k.a)(),O=(0,c.useState)(null),N=O[0],D=O[1],H=(0,E.x)(),Q=H.user,M=H.hasRole,Y=(0,b.a)(L.fo,{variables:m}),V=Y.data,$=void 0===V?{users:[],meta:{aggregate:{totalCount:0}}}:V,G=$.users,z=$.meta,B=Y.loading,J=Y.refetch,X=(0,o.Z)((0,y.D)(L.I4,{onCompleted:function(){R.close(),J()}}),2),K=X[0],ee=X[1].error,en=(0,o.Z)((0,y.D)(L.AX,{onCompleted:function(){R.close(),J()}}),2),et=en[0],er=en[1].error,ei=(0,o.Z)((0,y.D)(L.tW,{onCompleted:function(){J()}}),2),eo=ei[0],es=ei[1].error;ee&&ee.graphQLErrors.forEach(function(e){var n;(null===(n=e.extensions)||void 0===n?void 0:n.code)==="constraint-violation"?D("Error: a user with this e-mail address already exists"):D("Error creating user")}),er&&er.graphQLErrors.forEach(function(e){var n;(null===(n=e.extensions)||void 0===n?void 0:n.code)==="constraint-violation"?D("Error, a user with this e-mail address already exists"):D("Error updating user")}),es&&D("Error getting user`s locations");var ea,el=function(e){return[{context:"secondary",icon:"edit",onClick:em(e),tooltip:"Edit"},{context:"secondary",icon:"avatar",onClick:eh(e),tooltip:"Avatar"}]},ec=[{headerName:"",field:"avatar",maxWidth:60,sortable:!1,renderCell:function(e){var n=e.row;return(0,l.jsx)(Z.Z,{src:(0,U.Q)(n.media),sx:{marginLeft:"15px",width:"24px",height:"24px"}})}},{flex:1,headerName:"Name",field:"name",minWidth:150,sortName:'{"nameFirst": "ORDER"}'},{flex:1,headerName:"Email Address",field:"email",minWidth:250},{flex:1,headerName:"Contact User",field:"contactUser",sortable:!1,renderCell:function(e){if(e.row.accountUser.isContact)return(0,l.jsx)(p.Z,{direction:"row",width:"100%",alignItems:"center",justifyContent:"flex-start",children:(0,l.jsx)(w.Z,{color:"error"})})}},{flex:1,headerName:"Phone",field:"phone",minWidth:100,sortable:!1},{flex:1,headerName:"Position",field:"position",minWidth:100,sortable:!1},{flex:1,headerName:"Role",field:"role",minWidth:110,sortable:!1},{flex:1,headerName:"Status",field:"status",minWidth:110,sortable:!1},{flex:1,headerName:"Date Added",field:"createdAt",minWidth:130}].concat((0,s.Z)(M(["admin","customer","supplier"])?[{headerName:"Actions",field:"actions",minWidth:100,sortable:!1,renderCell:function(e){var n=e.row;return M(["customer_user","supplier_user"])?n.id===Q.id&&(0,l.jsx)(I.C,{actionsData:el,row:n}):(0,l.jsx)(I.C,{actionsData:el,row:n})}}]:[])),eu=(0,c.useMemo)(function(){var e=[];return G.forEach(function(n){var r=null;r=t.accountId?n.accounts.find(function(e){var n;return(null===(n=e.account)||void 0===n?void 0:n.id)===parseInt(t.accountId)}):n.accounts.find(function(e){return null!==e.account});var i={id:n.id,name:"".concat(n.nameFirst," ").concat(n.nameLast),nameFirst:n.nameFirst,nameLast:n.nameLast,accountId:r&&r.account.id,type:r&&r.account.type,email:n.email,account:r?"".concat(r.account.name," (").concat(r.account.type,")"):"-",phone:n.phone,position:(null==r?void 0:r.position)?r.position:"N/A",accountUser:r,role:null==r?void 0:r.role,status:r?r.status:n.status,createdAt:x()(n.createdAt).format("YYYY-MM-DD"),media:n.media};e.push(i)}),e},[t.accountId,G]),ed=(0,c.useCallback)((ea=(0,r.Z)(function(e,n){var t,r,o,s,l;return(0,a.__generator)(this,function(o){switch(o.label){case 0:return[4,(0,F.E)(u,e.email,!0)];case 1:if(t=o.sent(),r=(0,A.te)((0,i.Z)({},e),n,t),!e.id)return[3,2];return et({variables:(0,i.Z)({},r)}),e.location&&eo({variables:(0,i.Z)({},(0,A.qF)(e))}),[3,4];case 2:return[4,K({variables:{objects:r}})];case 3:l=o.sent().data.insert_Account_User.returning,e.location&&eo({variables:(0,i.Z)({},(0,A.qF)({location:e.location,accountUserId:l[0].id}))}),o.label=4;case 4:return[2]}})}),function(e,n){return ea.apply(this,arguments)}),[eo,u,K,et]),eh=function(e){return function(n){n.stopPropagation(),R.show({content:(0,l.jsx)(_.G,{category:"avatar",entity:"User",entityId:e.id,limit:1,type:"image"}),submit:!1,title:"Upload avatar"})}},em=(0,c.useCallback)(function(e){return function(r){var i;r.stopPropagation(),R.show({content:(0,l.jsx)(T.H,{accountType:n,userId:null!==(i=null==e?void 0:e.id)&&void 0!==i?i:null,submit:ed,submitError:N,accountId:t.accountId}),title:e?"Edit user":"Add user",xs3:"100vw",sm:"100vw",sm2:"80vw",sm3:"70vw",md2:"60vw",lg:"60vw",lg2:"50vw"})}},[n,R,ed,N,t.accountId]),ex=function(e){h().push("/dashboard/users/view?id=".concat(e.id))},ep=(0,c.useMemo)(function(){var e={};return eu.length||(e={title:"No users",subtitleFirstLine:"You currently have users set up in the system",subtitleSecondLine:"Click\xa0create user to get started building.",buttonText:"Create user",onAction:em(null)}),e},[em,eu]);return(0,l.jsxs)(p.Z,{spacing:2,sx:W.container,children:[(0,l.jsx)(p.Z,{width:"100%",direction:"row",sx:W.header,justifyContent:"flex-end",children:(0,l.jsx)(f.Z,{variant:"contained",color:"secondary",onClick:em(null),children:"Create User"})}),(0,l.jsxs)(v.Z,{sx:W.tableContainer,children:[(0,l.jsx)(g.Z,{ml:2,variant:"h5",sx:W.title,children:"Users"}),(null==eu?void 0:eu.length)?(0,l.jsx)(C.i,{ref:P,loading:B,columns:ec,rows:eu,meta:z,refetch:J,autoHeight:!1,onRowClick:ex,containerHeight:"calc(100% - 52px)"}):!B&&(0,l.jsx)(S.C,(0,i.Z)({imageSrc:"/static/icons/no_locations_found.svg"},ep))]})]})},W={container:{width:"100%",height:"100%"},header:{margin:"1em 0",paddingRight:"1em"},tableContainer:{padding:"16px 0px",height:"calc(80vh - 22px)"},title:{fontWeight:600,marginBottom:"15px"}};P.propTypes={accountType:u.string,filters:u.object}},43724:function(e,n,t){t.d(n,{q:function(){return f}});var r=t(26042),i=t(69396),o=t(29815),s=t(85893),a=t(45697),l=t(9270),c=t(62140),u=t(49501),d=t(55563),h=t(70982),m=t(95103),x=t(15897),p=t(74944),v=t(53625),f=function(e){var n=e.errors,t=e.prefix,a=e.register,f=(0,p.x)().hasRole,g={errors:n,register:a};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(l.Z,{children:[(0,s.jsx)(c.Z,{md:6,children:(0,s.jsx)(u.Z,{label:"First name",children:(0,s.jsx)(d.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"nameFirst")}))})}),(0,s.jsx)(c.Z,{md:6,children:(0,s.jsx)(u.Z,{label:"Last name",children:(0,s.jsx)(d.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"nameLast")}))})}),(0,s.jsx)(c.Z,{md:6,children:(0,s.jsxs)(u.Z,{label:"Email",children:[(0,s.jsx)(d.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"email"),type:"email"})),n["".concat(t,"email")]&&"duplicate"===n["".concat(t,"email")].type&&(0,s.jsx)(h.Z,{message:n["".concat(t,"email")].message})]})}),(0,s.jsx)(c.Z,{md:6,children:(0,s.jsx)(u.Z,{label:"Mobile",children:(0,s.jsx)(d.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"phone")}))})})]}),f((0,o.Z)(v.td).concat((0,o.Z)(v.Sf),(0,o.Z)(v.n),(0,o.Z)(v.nx)))&&(0,s.jsx)(u.Z,{label:"Status",children:(0,s.jsx)(m.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"status"),options:x.bg}))}),(0,s.jsx)(d.Z,(0,i.Z)((0,r.Z)({},g),{name:"".concat(t,"userId"),type:"hidden"}))]})};f.propTypes={errors:a.object.isRequired,prefix:a.string,register:a.func.isRequired},f.defaultProps={prefix:""}},22378:function(e,n,t){t.d(n,{Y:function(){return i},l:function(){return r}});var r=[{text:"Account Type",value:""},{text:"Admin",value:"admin"},{text:"Customer",value:"customer"},{text:"Supplier",value:"supplier"},{text:"Tenant",value:"tenant"}],i=function(e){return[{icon:"edit",tooltip:"Edit",to:"/dashboard/".concat(e.type,"s/").concat("supplier"===e.type?"edit":"manage","?id=").concat(e.id)}]}},31765:function(e,n,t){t.d(n,{I:function(){return r}});var r=[{text:"Select Role",value:""},{text:"Owner",value:"owner"},{text:"Manager",value:"manager"},{text:"User",value:"user"}]}}]);