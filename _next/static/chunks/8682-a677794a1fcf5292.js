"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8682],{62547:function(e,n,t){t.d(n,{V:function(){return S}});var r=t(26042),i=t(69396),o=t(29815),a=t(85893),s=t(45697),l=t.n(s),c=t(93946),u=t(51233),d=t(15861),p=t(21023),m=t(96540),f=t(67294),h=t(83162),g=t(42283),x=t(79665),v=t(11057),b=t(50135),y=t(77957),j=t(41733),Z=t(16310),w=Z.Ry({name:Z.Z_().required(),url:Z.Z_().url().required()}),k=v.Z,C=function(e){var n=e.noEdit,t=e.noDelete,o=e.onDelete,s=e.id,l=e.isAdded,d=e.url,m=e.name,v=e.onSave,Z=(0,f.useState)(l),C=Z[0],_=Z[1],S=(0,g.cI)({resolver:(0,x.S)(w)}),I=S.control,D=S.handleSubmit,E=S.errors,A=function(e){e.stopPropagation(),_(!0)},T=function(e){e.stopPropagation(),_(!1),m&&d||o()},M=function(e){v(e),_(!1)};return(0,a.jsx)("form",{children:C?(0,a.jsxs)(u.Z,{children:[(0,a.jsxs)(u.Z,{spacing:1,children:[(0,a.jsx)(g.Qr,{control:I,name:"name",defaultValue:m,render:function(e){var n;return(0,a.jsx)(b.Z,(0,i.Z)((0,r.Z)({fullWidth:!0,label:"Name",variant:"standard",color:"secondary"},e),{error:E.name,helperText:null===(n=E.name)||void 0===n?void 0:n.message}))}}),(0,a.jsx)(g.Qr,{control:I,name:"url",defaultValue:d,render:function(e){var n;return(0,a.jsx)(b.Z,(0,i.Z)((0,r.Z)({fullWidth:!0,label:"Link",variant:"standard",color:"secondary"},e),{error:E.url,helperText:null===(n=E.url)||void 0===n?void 0:n.message}))}})]}),(0,a.jsxs)(u.Z,{direction:"row",justifyContent:"flex-end",spacing:1,mt:2,children:[(0,a.jsx)(k,{variant:"contained",color:"danger",size:"small",onClick:T,children:"Cancel"}),(0,a.jsx)(k,{variant:"contained",size:"small",onClick:D(M),children:"Save"})]})]}):(0,a.jsxs)(u.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,a.jsx)(h.r,{target:"_blank",variant:"body1",color:"secondary",href:d,sx:{textDecoration:"auto",fontWeight:700},children:m}),!n&&(0,a.jsx)(p.Z,{title:"Edit",placement:"top-start",children:(0,a.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:A,children:(0,a.jsx)(y.Z,{sx:{fontSize:"16px"}})})}),!t&&(0,a.jsx)(p.Z,{title:"Delete",placement:"top-start",children:(0,a.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:function(){return o(s)},children:(0,a.jsx)(j.Z,{sx:{fontSize:"16px"}})})})]})})};C.defaultProps={isAdded:!1,noEdit:!1,noDelete:!1,url:"",name:"",onSave:function(){},onCancel:function(){},onDelete:function(){}},C.propTypes={isAdded:l().bool,noEdit:l().bool,noDelete:l().bool,url:l().string,name:l().string,onSave:l().func,onCancel:l().func,onDelete:l().func};var _=t(74944),S=function(e){var n=e.values,t=e.setValue,s=e.name,l=e.title,h=e.displayMode,g=e.noDeleteEdit,x=e.titleSx,v=(0,f.useState)([]),b=v[0],y=v[1],j=(0,(0,_.x)().hasRole)("tenant");(0,f.useEffect)(function(){Array.isArray(n)&&y(n)},[n]);var Z=function(e){e.stopPropagation(),y(function(e){return(0,o.Z)(e).concat([{name:"",link:"",isAdded:!0}])})},w=function(e,n){var r=(0,o.Z)(b);r.splice(e,1,n),t(s,r)};return(0,a.jsxs)(u.Z,{children:[(0,a.jsxs)(u.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,a.jsxs)(d.Z,{sx:x,children:[l,":"]}),!h&&!j&&(0,a.jsx)(p.Z,{title:"Add new link",placement:"top-start",children:(0,a.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:Z,children:(0,a.jsx)(m.Z,{})})})]}),(0,a.jsx)(u.Z,{pl:2,spacing:.8,children:(null==b?void 0:b.length)?b.map(function(e,o){var l;return(0,a.jsx)(C,(0,i.Z)((0,r.Z)({index:o},e),{noEdit:g||h,noDelete:g||h,onDelete:function(){var e=n.filter(function(e,n){return n!==o});t(s,e),y(e)},onSave:function(e){return w(o,e)}}))}):(0,a.jsx)(d.Z,{typography:"subtitle2",children:"No data"})})]})};S.defaultProps={values:[],setValue:function(){},title:"Related links",displayMode:!1,noDeleteEdit:!1,titleSx:{}},S.propTypes={values:l().arrayOf(l().shape({isAdded:l().bool,noEdit:l().bool,url:l().string,name:l().string})),titleSx:l().object,setValue:l().func,noDeleteEdit:l().bool}},56264:function(e,n,t){t.d(n,{H:function(){return s},Z:function(){return a}});var r=t(85893),i=t(67294),o=(0,i.createContext)();function a(e){var n=e.audience,t=e.setAudience,i=e.audienceOptions,a=e.children;return(0,r.jsx)(o.Provider,{value:{audience:n,setAudience:t,audienceOptions:i},children:a})}a.defaultProps={audience:"",setAudience:function(){},audienceOptions:[]};var s=function(){return(0,i.useContext)(o)}},72981:function(e,n,t){t.d(n,{V:function(){return l},Z:function(){return s}});var r=t(85893),i=t(67026),o=t(67294),a=(0,o.createContext)({});function s(e){var n=e.children,t=(0,o.useMemo)(function(){return{historyState:(0,i.l)()}},[]);return(0,r.jsx)(a.Provider,{value:t,children:n})}var l=function(){return(0,o.useContext)(a)}},57826:function(e,n,t){t.d(n,{Z:function(){return a},i:function(){return s}});var r=t(85893),i=t(67294),o=(0,i.createContext)({setMentionSearch:function(){},mentions:[]});function a(e){var n=e.setMentionSearch,t=e.mentions,i=e.children;return(0,r.jsx)(o.Provider,{value:{setMentionSearch:n,mentions:t},children:i})}a.defaultProps={setMentionSearch:function(){},mentions:[]};var s=function(){return(0,i.useContext)(o)}},96261:function(e,n,t){t.d(n,{HB:function(){return m},HJ:function(){return p},dP:function(){return f}});var r=t(51438),i=t(28668),o=t(82670),a=t(26626),s=t(85893),l=t(61084),c=t(67294),u=c.lazy(function(){return t.e(3874).then(t.bind(t,23874))});function d(e){if(e.src.startsWith("file:///"))return null;var n=e.alt,t=e.src,r=e.width;return{node:m({altText:n,height:e.height,src:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(t),width:r})}}var p=function(e){(0,i.Z)(t,e);var n=(0,a.Z)(t);function t(e,i,o,a,s,c,u,d,p,m,f){var h;return(0,r.Z)(this,t),(h=n.call(this,f)).__src=e,h.__altText=i,h.__maxWidth=o,h.__width=a,h.__height=s,h.__showCaption=c||!1,h.__caption=u||(0,l.Jh)(),h.__captionsEnabled=d||void 0===d,h.__className=p,h.__isLink=m,h}var o=t.prototype;return o.exportDOM=function(){var e=document.createElement("img");return e.setAttribute("src",this.__src),e.setAttribute("alt",this.__altText),e.setAttribute("width",this.__width),e.setAttribute("height",this.__height),{element:e}},o.exportJSON=function(){return{altText:this.getAltText(),caption:this.__caption.toJSON(),height:this.__height,maxWidth:this.__maxWidth,showCaption:this.__showCaption,src:this.getSrc(),type:"image",version:1,width:this.__width,className:this.__className,isLink:this.__isLink}},o.setWidthAndHeight=function(e,n){var t=this.getWritable();t.__width=e,t.__height=n},o.setShowCaption=function(e){this.getWritable().__showCaption=e},o.createDOM=function(e){var n=document.createElement("span"),t=e.theme.image;return void 0!==t&&(n.className=t),n},o.updateDOM=function(){return!1},o.getSrc=function(){return this.__src},o.setSrc=function(e){this.__src=e},o.getAltText=function(){return this.__altText},o.decorate=function(){return(0,s.jsx)(c.Suspense,{fallback:null,children:(0,s.jsx)(u,{className:this.__className,src:this.__src,altText:this.__altText,width:this.__width,height:this.__height,maxWidth:this.__maxWidth,nodeKey:this.getKey(),showCaption:this.__showCaption,caption:this.__caption,captionsEnabled:this.__captionsEnabled,resizable:!0})})},t.getType=function(){return"image"},t.clone=function(e){return new t(e.__src,e.__altText,e.__maxWidth,e.__width,e.__height,e.__showCaption,e.__caption,e.__captionsEnabled,e.__className,e.__isLink,e.__key)},t.importJSON=function(e){var n=e.altText,t=e.height,r=e.width,i=e.maxWidth,o=e.caption,a=e.src,s=e.showCaption,l=e.isLink,c=e.className,u=l?a:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(a),d=m({altText:n,height:t,maxWidth:i,showCaption:s,src:u,width:r,className:c}),p=d.__caption,f=p.parseEditorState(o.editorState);return f.isEmpty()||p.setEditorState(f),d},t.importDOM=function(){return{img:function(e){return{conversion:d,priority:0}}}},t}(l.Ij);function m(e){var n=e.altText,t=e.height,r=e.maxWidth,i=e.captionsEnabled,o=e.src,a=e.width,s=e.showCaption,c=e.caption,u=e.className,d=e.isLink,m=e.key;return(0,l.U2)(new p(o,n,r,a,t,s,c,i,u,d,m))}function f(e){return(0,o.Z)(e,p)}},91395:function(e,n,t){t.d(n,{AV:function(){return p},IY:function(){return m}});var r=t(51438),i=t(45785),o=t(82662),a=t(28668),s=t(26042),l=t(69396),c=t(26626),u=t(61084);function d(e){var n=e.trigger,t=e.label,r=e.value;return null!==t&&null!==n?{node:m({trigger:n,label:t,value:r})}:null}var p=function(e){(0,a.Z)(t,e);var n=(0,c.Z)(t);function t(e,i,o,a,s){var l;return(0,r.Z)(this,t),(l=n.call(this,e+i,s)).__trigger=e,l.__label=i,l.__value=o,l}var u=t.prototype;return u.exportJSON=function(){return(0,l.Z)((0,s.Z)({},(0,i.Z)((0,o.Z)(t.prototype),"exportJSON",this).call(this)),{trigger:this.__trigger,label:this.__label,value:this.__value,type:"mention",version:1})},u.createDOM=function(e){var n=(0,i.Z)((0,o.Z)(t.prototype),"createDOM",this).call(this,e);return n.className="editor-text-mention",n},u.exportDOM=function(){var e=document.createElement("span");return e.setAttribute("data-lexical-mention","true"),e.textContent=this.__text,e.trigger=this.__trigger,e.label=this.__label,e.value=this.__value,{element:e}},u.isTextEntity=function(){return!0},u.canInsertTextBefore=function(){return!1},u.canInsertTextAfter=function(){return!1},t.getType=function(){return"mention"},t.clone=function(e){return new t(e.__trigger,e.__label,e.__value,e.__text,e.__key)},t.importJSON=function(e){var n=m({trigger:e.trigger,label:e.label,value:e.value});return n.setTextContent(e.text),n.setFormat(e.format),n.setDetail(e.detail),n.setMode(e.mode),n.setStyle(e.style),n},t.importDOM=function(){return{span:function(e){return e.hasAttribute("data-lexical-mention")?{conversion:d,priority:1}:null}}},t}(u.R2);function m(e){var n=e.trigger,t=e.label,r=e.value,i=new p(n,t,r);return i.setMode("segmented").toggleDirectionless(),(0,u.U2)(i)}},67798:function(e,n,t){t.d(n,{WL:function(){return ne},Ps:function(){return na},yi:function(){return e2},tC:function(){return eH},Xe:function(){return ei},Hi:function(){return ed},Nz:function(){return eA},DE:function(){return e1},Mq:function(){return ec},xt:function(){return nr}});var r=t(828),i=t(85893),o=t(45697),a=t.n(o),s=t(46895),l=t(61084),c=t(42693),u=t(23605),d=t(10261),p=t(18824),m=t(79380),f=t(87012),h=t(88560),g=t(67294),x=t(19861),v=t(55578),b=t(21605),y=t(82443),j=t(79230),Z=t(58309),w=t(44743),k=t(21798),C=t(54612),_=t(90086),S=t(82553),I=t(40580),D=t(37345);function E(e){var n=e.anchor,t=e.focus,r=e.anchor.getNode(),i=e.focus.getNode();return r===i?r:e.isBackward()?(0,d.P4)(t)?r:i:(0,d.P4)(n)?r:i}var A=new Set(["http:","https:","mailto:","sms:","tel:"]);function T(e){try{var n=new URL(e);if(!A.has(n.protocol))return"about:blank"}catch(t){}return e}var M=RegExp(/((([A-Za-z]{3,9}:(?:\/\/)?)(?:[-;:&=+$,\w]+@)?[A-Za-z0-9.-]+|(?:www.|[-;:&=+$,\w]+@)[A-Za-z0-9.-]+)((?:\/[+~%/.\w-_]*)?\??(?:[-+=&;%@.\w_]*)#?(?:[\w]*))?)/);function L(e){return"https://"===e||M.test(e)}var P=t(21598),z=t(11057),O=t(18972),N=t(67797),R=t(94341),q=t(47568),U=t(82670),W=t(26042),F=t(69396),$=t(29815),B=t(97582),H=t(96261),V=t(50135),Q=t(90629),G=t(51233),Y=t(35520),K=t(10166),J=["image/","image/heic","image/heif","image/gif","image/webp"],X=(0,l.fA)("INSERT_IMAGE_COMMAND"),ee=(0,K.Z)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1});function en(e){var n=e.onClick,t=(0,g.useState)(""),r=t[0],o=t[1],a=(0,g.useState)(""),s=a[0],l=a[1];return(0,i.jsxs)(G.Z,{p:2,spacing:1,children:[(0,i.jsx)(V.Z,{label:"Image URL",placeholder:"i.e. https://source.unsplash.com/random",onChange:function(e){return o(e.target.value)},value:r,"data-test-id":"image-modal-url-input",variant:"outlined",color:"secondary"}),(0,i.jsx)(V.Z,{label:"Alt Text",placeholder:"Random unsplash image",onChange:function(e){return l(e.target.value)},value:s,"data-test-id":"image-modal-alt-text-input",variant:"outlined",color:"secondary"}),(0,i.jsx)(z.Z,{color:"secondary",variant:"contained",disabled:""===r,onClick:function(){return n({altText:s,src:r,isLink:!0})},children:"Confirm"})]})}function et(e){var n=e.onClick,t=(0,g.useState)([]),r=t[0],o=t[1],a=0===r.length,s=function(e){var n=e.target.files;o((0,$.Z)(n))};return(0,i.jsxs)(G.Z,{p:2,spacing:1,children:[(0,i.jsx)(G.Z,{spacing:2,children:r.map(function(e){return(0,i.jsx)(P.G5,{file:e})})}),(0,i.jsxs)(z.Z,{component:"label",variant:"contained",color:"secondary",startIcon:(0,i.jsx)(Y.Z,{}),children:["Upload files",(0,i.jsx)(ee,{type:"file",accept:"image/*",multiple:!0,onChange:s})]}),(0,i.jsx)(z.Z,{color:"secondary",variant:"contained",disabled:a,onClick:function(){return n(r)},children:"Confirm"})]})}function er(e){var n,t=e.activeEditor,r=e.onClose,o=(0,g.useState)(null),a=o[0],s=o[1],l=(0,g.useRef)(!1);(0,g.useEffect)(function(){l.current=!1;var e=function(e){l.current=e.altKey};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}},[t]);var c=(n=(0,q.Z)(function(e){var n,i,o,a,s,l,c,u,d;return(0,B.__generator)(this,function(m){switch(m.label){case 0:return[4,(0,p.j5)(e,[J].flatMap(function(e){return e}))];case 1:n=m.sent(),i=!0,o=!1,a=void 0;try{for(s=n[Symbol.iterator]();!(i=(l=s.next()).done);i=!0)u=(c=l.value).file,d=c.result,(0,p.tV)(u,J)&&t.dispatchCommand(X,{altText:u.name,src:d})}catch(f){o=!0,a=f}finally{try{i||null==s.return||s.return()}finally{if(o)throw a}}return r(),[2]}})}),function(e){return n.apply(this,arguments)}),u=function(e){t.dispatchCommand(X,e),r()};return(0,i.jsxs)(Q.Z,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"400px"},children:[!a&&(0,i.jsxs)(G.Z,{p:2,spacing:1,children:[(0,i.jsx)(z.Z,{color:"secondary",variant:"contained",onClick:function(){return s("url")},children:"URL"}),(0,i.jsx)(z.Z,{color:"secondary",variant:"contained",onClick:function(){return s("file")},children:"File"})]}),"url"===a&&(0,i.jsx)(en,{onClick:u}),"file"===a&&(0,i.jsx)(et,{onClick:c})]})}function ei(e){var n=e.captionsEnabled,t=(0,r.Z)((0,s.g)(),1)[0];return(0,g.useEffect)(function(){if(!t.hasNodes([H.HJ]))throw Error("ImagesPlugin: ImageNode not registered on editor");return(0,p.qV)(t.registerCommand(X,function(e){var t=(0,H.HB)((0,F.Z)((0,W.Z)({},e),{captionsEnabled:n}));return(0,l.od)([t]),(0,l._v)(t.getParentOrThrow())&&(0,p.JB)(t,l.BE).selectEnd(),!0},l.VN),t.registerCommand(l.XI,function(e){return function(e){var n=eo();if(!n)return!1;var t=e.dataTransfer;if(!t)return!1;var r=document.createElement("img");return r.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",t.setData("text/plain","_"),t.setDragImage(r,0,0),t.setData("application/x-lexical-drag",JSON.stringify({data:{altText:n.__altText,caption:n.__caption,height:n.__height,key:n.getKey(),maxWidth:n.__maxWidth,showCaption:n.__showCaption,src:n.__src,width:n.__width},type:"image"})),!0}(e)},l.Eo),t.registerCommand(l.kE,function(e){var n;return n=e,!!eo()&&(ea(n)||n.preventDefault(),!0)},l.KB),t.registerCommand(l.zD,function(e){return function(e,n){var t=eo();if(!t)return!1;var r=function(e){var n,t=null===(n=e.dataTransfer)||void 0===n?void 0:n.getData("application/x-lexical-drag");if(!t)return null;var r=JSON.parse(t),i=r.type,o=r.data;return"image"!==i?null:o}(e);if(!r)return!1;if(e.preventDefault(),ea(e)){var i=function(e){var n,t,r=e.target,i=((t=null==r?null:9===r.nodeType?r.defaultView:r.ownerDocument.defaultView)||window).getSelection();if(document.caretRangeFromPoint)n=document.caretRangeFromPoint(e.clientX,e.clientY);else if(e.rangeParent&&null!==i)i.collapse(e.rangeParent,e.rangeOffset||0),n=i.getRangeAt(0);else throw Error("Cannot get the selection when dragging");return n}(e);t.remove();var o=(0,l.vN)();null!=i&&o.applyDOMRange(i),(0,l.oq)(o),n.dispatchCommand(X,r)}return!0}(e,t)},l.Eo))},[n,t]),null}function eo(){var e=(0,l.dL)();if(!(0,l.iO)(e))return null;var n=e.getNodes()[0];return(0,H.dP)(n)?n:null}function ea(e){var n=e.target;return!!(n&&(0,U.Z)(n,HTMLElement)&&!n.closest("code, span.editor-image")&&n.parentElement&&n.parentElement.closest("div.ContentEditable__root"))}var es={bullet:"Bulleted List",check:"Check List",code:"Code Block",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4",h5:"Heading 5",h6:"Heading 6",number:"Numbered List",paragraph:"Normal",quote:"Quote"};function el(){return(0,i.jsx)("div",{className:"divider"})}function ec(e){var n=e.setIsLinkEditMode,t=(0,r.Z)((0,s.g)(),1)[0],o=(0,g.useState)(t),a=o[0],A=o[1],M=(0,g.useState)("paragraph")[1],L=(0,g.useState)("root")[1],q=(0,g.useState)(null)[1],U=(0,g.useRef)(null),W=(0,g.useState)("15px")[1],F=(0,g.useState)("#000"),$=F[0],B=F[1],H=(0,g.useState)("#fff"),V=H[0],Q=H[1],G=(0,g.useState)("Arial")[1],Y=(0,g.useState)("left")[1],K=(0,g.useState)(!1),J=K[0],X=K[1],ee=(0,g.useState)(!1),en=ee[0],et=ee[1],ei=(0,g.useState)(!1),eo=ei[0],ea=ei[1],ec=(0,g.useState)(!1),eu=ec[0],ed=ec[1],ep=(0,g.useState)(!1),em=ep[0],ef=ep[1],eh=(0,g.useState)(!1),eg=eh[0],ex=eh[1],ev=(0,g.useState)(!1),eb=ev[0],ey=ev[1],ej=(0,g.useState)(!1),eZ=ej[0],ew=ej[1],ek=(0,g.useState)(!1)[1],eC=(0,g.useState)(!1)[1],e_=(0,g.useState)(!1)[1],eS=(0,g.useState)("")[1],eI=(0,r.Z)((0,N.d)(),2),eD=eI[0],eE=eI[1],eA=(0,g.useState)(function(){return t.isEditable()}),eT=eA[0],eM=eA[1],eL=(0,g.useCallback)(function(){var e=(0,l.dL)();if((0,l.OP)(e)){var n,t=e.anchor.getNode(),r="root"===t.getKey()?t:(0,p.$s)(t,function(e){var n=e.getParent();return null!==n&&(0,l._v)(n)});null===r&&(r=t.getTopLevelElementOrThrow());var i=r.getKey(),o=a.getElementByKey(i);ef(e.hasFormat("bold")),ex(e.hasFormat("italic")),ey(e.hasFormat("underline")),ew(e.hasFormat("strikethrough")),ek(e.hasFormat("subscript")),eC(e.hasFormat("superscript")),ea(e.hasFormat("code")),e_((0,d.Vx)(e));var s=E(e),g=s.getParent();(0,c.Pq)(g)||(0,c.Pq)(s)?ed(!0):ed(!1);var x=(0,p.$s)(s,m.di);if((0,m.di)(x)?L("table"):L("root"),null!==o){if(q(i),(0,h.I3)(r)){var v=(0,p.yD)(t,h.EG);M(v?v.getListType():r.getListType())}else{var b=(0,u.rc)(r)?r.getTag():r.getType();if(b in es&&M(b),(0,f.Pe)(r)){var y=r.getLanguage();eS(y?f.md[y]||y:"");return}}}W((0,d.ui)(e,"font-size","15px")),B((0,d.ui)(e,"color","#000")),Q((0,d.ui)(e,"background-color","#fff")),G((0,d.ui)(e,"font-family","Arial")),(0,c.Pq)(g)&&(n=(0,p.$s)(s,function(e){return(0,l.F7)(e)&&!e.isInline()})),Y((0,l.F7)(n)?n.getFormatType():(0,l.F7)(s)?s.getFormatType():(null==g?void 0:g.getFormatType())||"left")}},[a]);(0,g.useEffect)(function(){return t.registerCommand(l.oj,function(e,n){return eL(),A(n),!1},l.jw)},[t,eL]),(0,g.useEffect)(function(){return(0,p.qV)(t.registerEditableListener(function(e){eM(e)}),a.registerUpdateListener(function(e){e.editorState.read(function(){eL()})}),a.registerCommand(l.yn,function(e){return X(e),!1},l.jw),a.registerCommand(l.r0,function(e){return et(e),!1},l.jw))},[eL,a,t]),(0,g.useEffect)(function(){return a.registerCommand(l.yb,function(e){var t,r=e.code,i=e.ctrlKey,o=e.metaKey;return"KeyK"===r&&(!!i||!!o)&&(e.preventDefault(),eu?(n(!1),t=null):(n(!0),t=T("https://")),a.dispatchCommand(c.k0,t))},l.u6)},[a,eu,n]);var eP=(0,g.useCallback)(function(e){e.preventDefault(),eu?(n(!1),t.dispatchCommand(c.k0,null)):(n(!0),t.dispatchCommand(c.k0,T("https://")))},[t,eu,n]),ez=(0,g.useCallback)(function(e,n){a.update(function(){var n=(0,l.dL)();null!==n&&(0,d.yD)(n,e)},n?{tag:"historic"}:{})},[a]),eO=(0,g.useCallback)(function(e,n){ez({color:e},n)},[ez]),eN=(0,g.useCallback)(function(e,n){ez({"background-color":e},n)},[ez]);return(0,i.jsxs)("div",{className:"toolbar",ref:U,children:[(0,i.jsx)(z.Z,{disabled:!J||!eT,disableMinWidth:!0,classes:{root:"toolbar-item"},color:"black",variant:"text","aria-label":"Undo",onClick:function(e){e.preventDefault(),a.dispatchCommand(l.$l,void 0)},children:(0,i.jsx)(x.Z,{classes:{root:"format undo"}})}),(0,i.jsx)(z.Z,{disabled:!en||!eT,disableMinWidth:!0,classes:{root:"toolbar-item"},color:"black",variant:"text","aria-label":"Redo",onClick:function(e){e.preventDefault(),a.dispatchCommand(l.zq,void 0)},children:(0,i.jsx)(v.Z,{classes:{root:"format redo"}})}),(0,i.jsx)(el,{}),(0,i.jsx)(z.Z,{disableMinWidth:!0,classes:{root:"toolbar-item spaced "+(em?"active":"")},color:"black",variant:"text","aria-label":"Format Bold",onClick:function(e){e.preventDefault(),a.dispatchCommand(l.Ew,"bold")},children:(0,i.jsx)(b.Z,{classes:{root:"format bold"}})}),(0,i.jsx)(z.Z,{disableMinWidth:!0,classes:{root:"toolbar-item spaced "+(eg?"active":"")},color:"black",variant:"text","aria-label":"Format Italics",onClick:function(e){e.preventDefault(),a.dispatchCommand(l.Ew,"italic")},children:(0,i.jsx)(y.Z,{classes:{root:"format italic"}})}),(0,i.jsx)(z.Z,{disableMinWidth:!0,classes:{root:"toolbar-item spaced "+(eb?"active":"")},color:"black",variant:"text","aria-label":"Format Underline",onClick:function(e){e.preventDefault(),a.dispatchCommand(l.Ew,"underline")},children:(0,i.jsx)(j.Z,{classes:{root:"format underline"}})}),(0,i.jsx)(z.Z,{disableMinWidth:!0,classes:{root:"toolbar-item spaced "+(eZ?"active":"")},color:"black",variant:"text","aria-label":"Format Strikethrough",onClick:function(e){e.preventDefault(),a.dispatchCommand(l.Ew,"strikethrough")},children:(0,i.jsx)(Z.Z,{classes:{root:"format strikethrough"}})}),(0,i.jsx)(el,{}),(0,i.jsx)(z.Z,{disableMinWidth:!0,classes:{root:"toolbar-item spaced"},color:"black",variant:"text","aria-label":"Left Align",onClick:function(e){e.preventDefault(),a.dispatchCommand(l.RO,"left")},children:(0,i.jsx)(w.Z,{classes:{root:"format left-align"}})}),(0,i.jsx)(z.Z,{disableMinWidth:!0,classes:{root:"toolbar-item spaced"},color:"black",variant:"text","aria-label":"Center Align",onClick:function(e){e.preventDefault(),a.dispatchCommand(l.RO,"center")},children:(0,i.jsx)(k.Z,{classes:{root:"format center-align"}})}),(0,i.jsx)(z.Z,{disableMinWidth:!0,classes:{root:"toolbar-item spaced"},color:"black",variant:"text","aria-label":"Right Align",onClick:function(e){e.preventDefault(),a.dispatchCommand(l.RO,"right")},children:(0,i.jsx)(C.Z,{classes:{root:"format right-align"}})}),(0,i.jsx)(z.Z,{disableMinWidth:!0,classes:{root:"toolbar-item spaced"},color:"black",variant:"text","aria-label":"Justify Align",onClick:function(e){e.preventDefault(),a.dispatchCommand(l.RO,"justify")},children:(0,i.jsx)(_.Z,{classes:{root:"format justify-align"}})}),(0,i.jsx)(z.Z,{disableMinWidth:!0,classes:{root:"toolbar-item spaced "+(eo?"active":"")},color:"black",variant:"text","aria-label":"Insert code block",onClick:function(e){e.preventDefault(),a.dispatchCommand(l.Ew,"code")},children:(0,i.jsx)(S.Z,{classes:{root:"format code"}})}),(0,i.jsx)(z.Z,{disableMinWidth:!0,classes:{root:"toolbar-item spaced "+(eu?"active":"")},color:"black",variant:"text","aria-label":"Insert link",onClick:eP,children:(0,i.jsx)(I.Z,{classes:{root:"format link"}})}),(0,i.jsx)(P.q3,{type:"font",buttonClassName:"toolbar-item color-picker",buttonIconClassName:"icon font-color",disabled:!eT,color:$,onChange:eO}),(0,i.jsx)(P.q3,{type:"background",buttonClassName:"toolbar-item color-picker",buttonIconClassName:"icon bg-color",disabled:!eT,color:V,onChange:eN}),(0,i.jsx)(R.Z,{label:"Insert",buttonClassName:"toolbar-item insert-action",children:(0,i.jsxs)(O.Z,{disableRipple:!0,onClick:function(){eE({content:function(e){var n=e.onClose;return(0,i.jsx)(er,{activeEditor:a,onClose:n})}})},children:[(0,i.jsx)(D.Z,{}),"Image"]})}),eD]})}ec.defaultProps={setIsLinkEditMode:function(){}},ec.propTypes={setIsLinkEditMode:a().func};var eu=t(58385);function ed(){return(0,i.jsx)(eu.H,{validateUrl:L})}var ep=t(51438),em=t(28668),ef=t(26626),eh=t(26984),eg=t(91395),ex=t(69661),ev=t(78462),eb=t(97212),ey=t(18987),ej=t(98619),eZ=t(59334),ew=t(16143),ek=t(57826),eC="\\.,\\+\\*\\?\\$\\@\\|#{}\\(\\)\\^\\-\\[\\]\\\\/!%'\"~=<>_:;",e_="[^@"+eC+"\\s]",eS=RegExp("(^|\\s|\\()([@]((?:"+e_+"(?:\\.[ |$]| |["+eC+"]|)){0,75}))$"),eI=RegExp("(^|\\s|\\()([@]((?:"+e_+"){0,50}))$"),eD=function(e){(0,em.Z)(t,e);var n=(0,ef.Z)(t);function t(e,r){var i;return(0,ep.Z)(this,t),(i=n.call(this,e)).label=e,i.value=r,i}return t}(eh.n);function eE(e){var n=e.index,t=e.isSelected,r=e.onClick,o=e.onMouseEnter,a=e.option,s="item";return t&&(s+=" selected"),(0,i.jsx)(eb.ZP,{classes:{root:s},id:"typeahead-item-"+n,disablePadding:!0,onMouseEnter:o,onClick:r,children:(0,i.jsxs)(ej.Z,{children:[(0,i.jsx)(ey.Z,{children:(0,i.jsx)(ex.Z,{alt:a.label})}),(0,i.jsx)(eZ.Z,{primary:"".concat(a.label)})]})},a.key)}function eA(){var e=(0,r.Z)((0,s.g)(),1)[0],n=(0,ek.i)(),t=n.setMentionSearch,o=n.mentions,a=(0,g.useState)(""),l=a[0],c=a[1];(0,g.useEffect)(function(){var e=setTimeout(function(){t(l)},500);return function(){return clearTimeout(e)}},[l]);var u=(0,eh.wd)("/",{minLength:0}),d=(0,g.useMemo)(function(){return o.map(function(e){return new eD(e.label,e.value)})},[o]),p=(0,g.useCallback)(function(n,t,r){e.update(function(){var e=(0,eg.IY)({trigger:"@",label:n.label,value:n.value});t&&t.replace(e),e.select(),r()})},[e]),m=(0,g.useCallback)(function(n){var t;return null!==u(n,e)?null:function(e,n){var t=eS.exec(e);if(null===t&&(t=eI.exec(e)),null!==t){var r=t[1],i=t[3];if(i.length>=0)return{leadOffset:t.index+r.length,matchingString:i,replaceableString:t[2]}}return null}(n,0)},[u,e]);return(0,i.jsx)(eh.HQ,{anchorClassName:"MuiPopover-root MuiModal-root",onQueryChange:c,onSelectOption:p,triggerFn:m,options:d,menuRenderFn:function(e,n){var t=n.selectedIndex,r=n.selectOptionAndCleanUp,a=n.setHighlightedIndex,s=n.options;return e.current&&o.length?(0,i.jsx)(ew.Z,{open:!0,anchorEl:e.current,placement:"right-start",children:(0,i.jsx)(Q.Z,{sx:{width:"auto",maxHeight:"40vh"},children:(0,i.jsx)(ev.Z,{dense:!0,sx:{width:"100%",maxHeight:"40vh",overflow:"auto",maxWidth:360,bgcolor:"background.paper"},children:s.map(function(e,n){return(0,i.jsx)(eE,{index:n,isSelected:t===n,onClick:function(){a(n),r(e)},onMouseEnter:function(){a(n)},option:e},e.value)})})})}):null}})}eA.defaultProps={},eA.propTypes={};var eT=t(7297),eM=t(70917);function eL(){var e=(0,eT.Z)(["\n  .link-editor {\n    position: absolute;\n    top: 0;\n    left: 0;\n    z-index: 1200;\n    max-width: 400px;\n    width: 100%;\n  }\n"]);return eL=function(){return e},e}function eP(){var e=(0,eT.Z)(["\n  ","\n"]);return eP=function(){return e},e}var ez=function(e){return(0,eM.iv)(eL())},eO=K.Z.div(eP(),ez),eN=t(73935);function eR(e,n,t){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:5,o=t.parentElement;if(null===e||!o){n.style.opacity="0",n.style.transform="translate(-10000px, -10000px)";return}var a=n.getBoundingClientRect(),s=t.getBoundingClientRect(),l=o.getBoundingClientRect(),c=e.top-r,u=e.left-i;c<l.top&&(c+=a.height+e.height+2*r),u+a.width>l.right&&(u=l.right-a.width-i),c-=s.top,u-=s.left,n.style.opacity="1",n.style.transform="translate(".concat(u,"px, ").concat(c,"px)")}var eq=t(93946),eU=t(21386),eW=t(85412),eF=t(12282),e$=t(83162);function eB(e){var n=e.editor,t=e.isLink,r=e.setIsLink,o=e.anchorElem,a=e.isLinkEditMode,s=e.setIsLinkEditMode,u=(0,g.useRef)(null),d=(0,g.useRef)(null),m=(0,g.useState)(""),f=m[0],h=m[1],x=(0,g.useState)("https://"),v=x[0],b=x[1],y=(0,g.useState)(null),j=y[0],Z=y[1],w=(0,g.useCallback)(function(){var e=(0,l.dL)();if((0,l.OP)(e)){var t=E(e),r=(0,p.$s)(t,c.Pq);r?h(r.getURL()):(0,c.Pq)(t)?h(t.getURL()):h(""),a&&b(f)}var i=u.current,d=window.getSelection(),m=document.activeElement;if(null!==i){var g=n.getRootElement();if(null!==e&&null!==d&&null!==g&&g.contains(d.anchorNode)&&n.isEditable()){var x,v,y=null===(x=d.focusNode)||void 0===x?void 0:null===(v=x.parentElement)||void 0===v?void 0:v.getBoundingClientRect();y&&(y.y+=40,eR(y,i,o)),Z(e)}else m&&"link-input"===m.className||(null!==g&&eR(null,i,o),Z(null),s(!1),h(""));return!0}},[o,n,s,a,f]);(0,g.useEffect)(function(){var e=o.parentElement,t=function(){n.getEditorState().read(function(){w()})};return window.addEventListener("resize",t),e&&e.addEventListener("scroll",t),function(){window.removeEventListener("resize",t),e&&e.removeEventListener("scroll",t)}},[o.parentElement,n,w]),(0,g.useEffect)(function(){return(0,p.qV)(n.registerUpdateListener(function(e){e.editorState.read(function(){w()})}),n.registerCommand(l.oj,function(){return w(),!0},l.KB),n.registerCommand(l.Zq,function(){return!!t&&(r(!1),!0)},l.Eo))},[n,w,r,t]),(0,g.useEffect)(function(){n.getEditorState().read(function(){w()})},[n,w]),(0,g.useEffect)(function(){a&&d.current&&d.current.focus()},[a,t]);var k=function(e){"Enter"===e.key?(e.preventDefault(),C()):"Escape"===e.key&&(e.preventDefault(),s(!1))},C=function(){null!==j&&(""!==f&&(n.dispatchCommand(c.k0,T(v)),n.update(function(){var e=(0,l.dL)();if((0,l.OP)(e)){var n=E(e).getParent();if((0,c.Xp)(n)){var t=(0,c.zV)(n.getURL(),{rel:n.__rel,target:n.__target,title:n.__title});n.replace(t,!0)}}})),b("https://"),s(!1))};return(0,i.jsx)(eO,{children:(0,i.jsx)("div",{ref:u,className:"link-editor",children:t?a?(0,i.jsx)(Q.Z,{elevation:3,sx:{p:2},children:(0,i.jsxs)(G.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,i.jsx)(V.Z,{fullWidth:!0,color:"secondary",inputRef:d,value:v,onChange:function(e){b(e.target.value)},onKeyDown:function(e){k(e)}}),(0,i.jsxs)(G.Z,{direction:"row",spacing:1,children:[(0,i.jsx)(eq.Z,{onClick:function(){s(!1)},children:(0,i.jsx)(eW.Z,{})}),(0,i.jsx)(eq.Z,{onClick:C,children:(0,i.jsx)(eU.Z,{})})]})]})}):(0,i.jsx)(Q.Z,{elevation:3,sx:{p:2},children:(0,i.jsxs)(G.Z,{width:"100%",direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,i.jsx)(e$.r,{color:"secondary",href:T(f),children:f}),(0,i.jsxs)(G.Z,{direction:"row",spacing:1,children:[(0,i.jsx)(eq.Z,{onMouseDown:function(e){return e.preventDefault()},onClick:function(){b(f),s(!0)},children:(0,i.jsx)(eF.Z,{})}),(0,i.jsx)(eq.Z,{onMouseDown:function(e){return e.preventDefault()},onClick:function(){n.dispatchCommand(c.k0,null)},children:(0,i.jsx)(eW.Z,{})})]})]})}):null})})}function eH(e){var n,t,o,a,u,d,m,f,h,x,v=e.anchorElem,b=void 0===v?document.body:v,y=e.isLinkEditMode,j=e.setIsLinkEditMode;return n=(0,r.Z)((0,s.g)(),1)[0],d=(u=(0,g.useState)(n))[0],m=u[1],h=(f=(0,g.useState)(!1))[0],x=f[1],(0,g.useEffect)(function(){var e=function(){var e=(0,l.dL)();if((0,l.OP)(e)){var n=E(e),t=(0,p.$s)(n,c.Pq),r=(0,p.$s)(n,c.Xp);if(!(t||r)){x(!1);return}e.getNodes().find(function(e){var n=(0,p.$s)(e,c.Pq),i=(0,p.$s)(e,c.Xp);if(!(null==n?void 0:n.is(t))&&!(null==i?void 0:i.is(r))&&!n&&!i&&!(0,l.A3)(e))return e})?x(!1):x(!0)}};return(0,p.qV)(n.registerUpdateListener(function(n){n.editorState.read(function(){e()})}),n.registerCommand(l.oj,function(n,t){return e(),m(t),!1},l.jw),n.registerCommand(l.Kr,function(e){var n=(0,l.dL)();if((0,l.OP)(n)){var t=E(n),r=(0,p.$s)(t,c.Pq);if((0,c.Pq)(r)&&(e.metaKey||e.ctrlKey))return window.open(r.getURL(),"_blank"),!0}return!1},l.KB))},[n]),(0,eN.createPortal)((0,i.jsx)(eB,{editor:d,isLink:h,anchorElem:b,setIsLink:x,isLinkEditMode:y,setIsLinkEditMode:j}),b)}var eV=t(98456),eQ=t(21023),eG=t(24339),eY=t(70573),eK=t(63973),eJ=function(e,n){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=[],i=function(e){if(e.type===n&&(Object.keys(t).find(function(n){return t[n]===e[n]})||r.push(e)),Array.isArray(e.children)){var o=e.children,a=!0,s=!1,l=void 0;try{for(var c,u=o[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value;i(d)}}catch(p){s=!0,l=p}finally{try{a||null==u.return||u.return()}finally{if(s)throw l}}}};return i(e),r},eX=function(e){var n=e.json,t=e.type,r=e.to,i=e.keys,o=e.avoidKeyValues,a=void 0===o?{}:o,s=(0,W.Z)({},n),l=function(e){if(e.type===t){var n=Object.keys(i);Object.keys(a).find(function(n){return a[n]===e[n]})||n.forEach(function(n){var t=r.shift();e[n]=t[i[n]]})}if(Array.isArray(e.children)){var o=e.children,s=!0,c=!1,u=void 0;try{for(var d,p=o[Symbol.iterator]();!(s=(d=p.next()).done);s=!0){var m=d.value;l(m)}}catch(f){c=!0,u=f}finally{try{s||null==p.return||p.return()}finally{if(c)throw u}}}};return l(s.editorState.root),s},e0=z.Z;function e1(e){var n=e.saveContent,t=e.loading,o=e.setLoading,a=(0,r.Z)((0,s.g)(),1)[0],c=(0,g.useCallback)(function(e){a.getEditorState().read((0,q.Z)(function(){var e,t,r,i,s,c,u,d,p,m;return(0,B.__generator)(this,function(u){switch(u.label){case 0:var d;return u.trys.push([0,,3,4]),o(!0),e=(0,l.Gv)(),t=(0,l.K8)(eg.AV),r=e.getTextContent(),i=(0,eY.S)(a,null),s=a.toJSON(),c=t.map(function(e){return e.__value}),[4,Promise.all(eJ(s.editorState.root,"image",{isLink:!0}).map(function(e){return function(e,n){for(var t=e.split(","),r=t[0].match(/:(.*?);/)[1],i=atob(t[t.length-1]),o=i.length,a=new Uint8Array(o);o--;)a[o]=i.charCodeAt(o);return new File([a],n,{type:r})}(e.src,e.altText)}).map((d=(0,q.Z)(function(e){return(0,B.__generator)(this,function(n){switch(n.label){case 0:return[4,(0,eK.V)(e,"image")];case 1:return[2,n.sent()]}})}),function(e){return d.apply(this,arguments)})))];case 1:return m=eX({json:s,type:"image",to:u.sent(),keys:{src:"key"},avoidKeyValues:{isLink:!0}}),[4,n({json:m,plainText:r,htmlString:i,mentions:c})];case 2:return u.sent(),a.dispatchCommand(l.BM,void 0),[3,4];case 3:return o(!1),[7];case 4:return[2]}})}))},[a]),u=(0,g.useCallback)(function(e){var n=e.ctrlKey,t=e.metaKey;return(n||t)&&(e.preventDefault(),c(e)),!0},[a]);return(0,g.useEffect)(function(){return(0,p.qV)(a.registerCommand(l.XN,u,l.Eo))},[a,u]),(0,i.jsx)(eQ.Z,{title:"Ctrl or CMD + Enter",children:(0,i.jsx)(e0,{disableMinWidth:!0,disabled:t,color:"success",variant:"contained",sx:{width:"50px"},onClick:c,children:t?(0,i.jsx)(eV.Z,{color:"success",size:18}):(0,i.jsx)(eG.Z,{})})})}function e2(){var e=(0,r.Z)((0,s.g)(),1)[0];return(0,g.useEffect)(function(){return e.registerCommand(u.BD,function(n){return(0,q.Z)(function(){var t,r,i,o,a,s,l,c,u;return(0,B.__generator)(this,function(d){switch(d.label){case 0:return[4,(0,p.j5)(n,[J].flatMap(function(e){return e}))];case 1:t=d.sent(),r=!0,i=!1,o=void 0;try{for(a=t[Symbol.iterator]();!(r=(s=a.next()).done);r=!0)c=(l=s.value).file,u=l.result,(0,p.tV)(c,J)&&e.dispatchCommand(X,{altText:c.name,src:u})}catch(m){i=!0,o=m}finally{try{r||null==a.return||a.return()}finally{if(i)throw o}}return[2]}})})(),!0},l.KB)},[e]),null}e1.defaultProps={loading:!1,setLoading:function(){},saveContent:(0,q.Z)(function(){return(0,B.__generator)(this,function(e){return[2]})})},e1.propTypes={loading:a().bool,setLoading:a().func,saveContent:a().func};var e5=t(25464),e6=t(15861),e8=t(90948),e3=t(56693),e4=t(8821),e9=t(62665),e7=function(e){var n=e.loading,t=e.attachments,r=e.description,o=e.setDescription,a=e.handleSubmit;return(0,i.jsx)(Q.Z,{sx:{position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, -50%)",width:"80vw",maxHeight:"90vh",overflowY:"scroll"},children:(0,i.jsxs)(G.Z,{width:"100%",alignItems:"center",p:2,children:[t&&t.map(function(e){return(0,i.jsx)(P.G5,{file:e},e.lastModified)}),!!t.length&&(0,i.jsxs)(G.Z,{width:"100%",spacing:1,children:[(0,i.jsx)(V.Z,{value:r,onChange:function(e){return o(e.target.value)},label:"Add a caption",multiline:!0,minRows:4,variant:"filled",color:"secondary",sx:{width:"100%"}}),(0,i.jsx)(z.Z,{disabled:n,variant:"contained",color:"secondary",onClick:a,children:n?(0,i.jsx)(eV.Z,{color:"secondary"}):"Send"})]})]})})};function ne(e){var n,t=e.loading,o=e.setLoading,a=e.saveContent,s=(0,r.Z)((0,N.d)(),2),l=s[0],c=s[1],u=(0,g.useState)(null),d=u[0],p=u[1],m=(0,g.useState)(""),f=m[0],h=m[1],x=(0,g.useState)([]),v=x[0],b=x[1],y=(0,g.useCallback)((n=(0,q.Z)(function(e){return(0,B.__generator)(this,function(e){switch(e.label){case 0:return e.trys.push([0,,2,3]),o(!0),[4,a({description:f,attachments:v})];case 1:return e.sent(),[3,3];case 2:return o(!1),[7];case 3:return[2]}})}),function(e){return n.apply(this,arguments)}),[o,a,v,f]);(0,g.useEffect)(function(){v.length&&(p(null),c({content:function(e){var n=e.onClose;return(0,i.jsx)(e7,{loading:t,attachments:v,description:f,setDescription:h,handleSubmit:(0,q.Z)(function(){return(0,B.__generator)(this,function(e){switch(e.label){case 0:return[4,y()];case 1:return e.sent(),n(),[2]}})})})}}))},[v,t,f,p,c,h,y]);var j=(0,g.useCallback)(function(e){var n=e.target.files;b((0,$.Z)(n))},[b]),Z=Boolean(d);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(eq.Z,{disabled:t,onClick:function(e){return p(e.currentTarget)},children:(0,i.jsx)(e4.Z,{})}),(0,i.jsxs)(e5.Z,{open:Z,id:Z?"AttachmentPopUp-popover":void 0,anchorEl:d,onClose:function(){return p(null)},children:[(0,i.jsxs)(O.Z,{component:"label",children:[(0,i.jsxs)(G.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,i.jsx)(e3.Z,{}),(0,i.jsx)(e6.Z,{children:" Upload image"})]}),(0,i.jsx)(nn,{onChange:j,type:"file",accept:"image/*",multiple:!0})]}),(0,i.jsxs)(O.Z,{component:"label",children:[(0,i.jsxs)(G.Z,{direction:"row",alignItems:"center",spacing:2,children:[(0,i.jsx)(e9.Z,{}),(0,i.jsx)(e6.Z,{children:" Upload PDF"})]}),(0,i.jsx)(nn,{onChange:j,type:"file",accept:".pdf",multiple:!0})]})]}),l]})}e7.defaultProps={loading:!1,attachments:[],description:"",setDescription:function(){},handleSubmit:function(){}},e7.propTypes={loading:a().bool,attachments:a().array,description:a().string,setDescription:a().func,handleSubmit:a().func},ne.defaultProps={loading:!1,setLoading:function(){},saveContent:function(){}},ne.propTypes={loading:a().bool,setLoading:a().func,saveContent:a().func};var nn=(0,e8.ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),nt=t(70686);function nr(){var e=(0,r.Z)((0,s.g)(),1)[0];return(0,i.jsx)(nt.L,{viewClassName:"tree-view-output",treeTypeButtonClassName:"debug-treetype-button",timeTravelPanelClassName:"debug-timetravel-panel",timeTravelButtonClassName:"debug-timetravel-button",timeTravelPanelSliderClassName:"debug-timetravel-panel-slider",timeTravelPanelButtonClassName:"debug-timetravel-panel-button",editor:e})}var ni=t(18360),no=t(56264);function na(){var e=(0,no.H)();if(!e)return(0,i.jsx)("div",{});var n=e.audienceOptions,t=e.audience,r=e.setAudience;return(0,i.jsx)("div",{className:"audience-plugin",children:(0,i.jsx)(ni.Z,{classes:{select:"select",icon:"icon"},MenuProps:{classes:{root:"test"}},value:t,label:"To",variant:"filled",color:"secondary",onChange:function(e){return r(e.target.value)},children:n.map(function(e){var n=e.value,t=e.label;return(0,i.jsx)(O.Z,{value:n,children:t})})})})}na.defaultProps={},na.propTypes={}},94341:function(e,n,t){t.d(n,{Z:function(){return c}});var r=t(85893),i=t(11057),o=t(25464),a=t(67294),s=t(6103),l=t(71496);function c(e){var n=e.label,t=e.buttonClassName,c=e.children,u=(0,a.useState)(null),d=u[0],p=u[1],m=Boolean(d),f=function(e){p(e.currentTarget)},h=function(){p(null)};return(0,r.jsxs)("div",{children:[(0,r.jsx)(i.Z,{classes:{root:t},id:"drop-down-customized-button","aria-controls":m?"drop-down-customized-menu":void 0,"aria-haspopup":"true","aria-expanded":m?"true":void 0,variant:"text",color:"black",disableElevation:!0,onClick:f,startIcon:(0,r.jsx)(s.Z,{}),endIcon:(0,r.jsx)(l.Z,{}),children:n}),(0,r.jsx)(o.Z,{id:"drop-down-customized-menu",MenuListProps:{"aria-labelledby":"drop-down-customized-button"},anchorEl:d,open:m,onClose:h,children:(0,r.jsx)("div",{onClick:h,children:c})})]})}},37563:function(e,n,t){t.d(n,{Z:function(){return l}});var r=t(85893),i=t(18824),o=t(67294);function a(e,n,t){return Math.min(Math.max(e,n),t)}var s={east:1,north:8,south:2,west:4};function l(e){var n=e.onResizeStart,t=e.onResizeEnd,l=e.buttonRef,c=e.imageRef,u=e.maxWidth,d=e.editor,p=e.showCaption,m=e.setShowCaption,f=e.captionsEnabled,h=(0,o.useRef)(null),g=(0,o.useRef)({priority:"",value:"default"}),x=(0,o.useRef)({currentHeight:0,currentWidth:0,direction:0,isResizing:!1,ratio:0,startHeight:0,startWidth:0,startX:0,startY:0}),v=d.getRootElement(),b=u||(null!==v?v.getBoundingClientRect().width-20:100),y=null!==v?v.getBoundingClientRect().height-20:100,j=function(e){var n=e===s.east||e===s.west,t=e===s.north||e===s.south,r=e&s.north&&e&s.west||e&s.south&&e&s.east,i=n?"ew":t?"ns":r?"nwse":"nesw";null!==v&&v.style.setProperty("cursor","".concat(i,"-resize"),"important"),null!==document.body&&(document.body.style.setProperty("cursor","".concat(i,"-resize"),"important"),g.current.value=document.body.style.getPropertyValue("-webkit-user-select"),g.current.priority=document.body.style.getPropertyPriority("-webkit-user-select"),document.body.style.setProperty("-webkit-user-select","none","important"))},Z=function(){null!==v&&v.style.setProperty("cursor","text"),null!==document.body&&(document.body.style.setProperty("cursor","default"),document.body.style.setProperty("-webkit-user-select",g.current.value,g.current.priority))},w=function(e,t){if(d.isEditable()){var r=c.current,o=h.current;if(null!==r&&null!==o){e.preventDefault();var a=r.getBoundingClientRect(),s=a.width,l=a.height,u=(0,i.MZ)(r),p=x.current;p.startWidth=s,p.startHeight=l,p.ratio=s/l,p.currentWidth=s,p.currentHeight=l,p.startX=e.clientX/u,p.startY=e.clientY/u,p.isResizing=!0,p.direction=t,j(t),n(),o.classList.add("image-control-wrapper--resizing"),r.style.height="".concat(l,"px"),r.style.width="".concat(s,"px"),document.addEventListener("pointermove",k),document.addEventListener("pointerup",C)}}},k=function(e){var n=c.current,t=x.current,r=t.direction&(s.east|s.west),o=t.direction&(s.south|s.north);if(null!==n&&t.isResizing){var l=(0,i.MZ)(n);if(r&&o){var u=Math.floor(t.startX-e.clientX/l);u=t.direction&s.east?-u:u;var d=a(t.startWidth+u,100,b),p=d/t.ratio;n.style.width="".concat(d,"px"),n.style.height="".concat(p,"px"),t.currentHeight=p,t.currentWidth=d}else if(o){var m=Math.floor(t.startY-e.clientY/l);m=t.direction&s.south?-m:m;var f=a(t.startHeight+m,100,y);n.style.height="".concat(f,"px"),t.currentHeight=f}else{var h=Math.floor(t.startX-e.clientX/l);h=t.direction&s.east?-h:h;var g=a(t.startWidth+h,100,b);n.style.width="".concat(g,"px"),t.currentWidth=g}}},C=function(){var e=c.current,n=x.current,r=h.current;if(null!==e&&null!==r&&n.isResizing){var i=n.currentWidth,o=n.currentHeight;n.startWidth=0,n.startHeight=0,n.ratio=0,n.startX=0,n.startY=0,n.currentWidth=0,n.currentHeight=0,n.isResizing=!1,r.classList.remove("image-control-wrapper--resizing"),Z(),t(i,o),document.removeEventListener("pointermove",k),document.removeEventListener("pointerup",C)}};return(0,r.jsxs)("div",{ref:h,children:[!p&&f&&(0,r.jsx)("button",{className:"image-caption-button",ref:l,onClick:function(){m(!p)},children:"Add Caption"}),(0,r.jsx)("div",{className:"image-resizer image-resizer-n",onPointerDown:function(e){w(e,s.north)}}),(0,r.jsx)("div",{className:"image-resizer image-resizer-ne",onPointerDown:function(e){w(e,s.north|s.east)}}),(0,r.jsx)("div",{className:"image-resizer image-resizer-e",onPointerDown:function(e){w(e,s.east)}}),(0,r.jsx)("div",{className:"image-resizer image-resizer-se",onPointerDown:function(e){w(e,s.south|s.east)}}),(0,r.jsx)("div",{className:"image-resizer image-resizer-s",onPointerDown:function(e){w(e,s.south)}}),(0,r.jsx)("div",{className:"image-resizer image-resizer-sw",onPointerDown:function(e){w(e,s.south|s.west)}}),(0,r.jsx)("div",{className:"image-resizer image-resizer-w",onPointerDown:function(e){w(e,s.west)}}),(0,r.jsx)("div",{className:"image-resizer image-resizer-nw",onPointerDown:function(e){w(e,s.north|s.west)}})]})}},21598:function(e,n,t){t.d(n,{f$:function(){return v},q3:function(){return d},G5:function(){return M},Vm:function(){return w}}),t(94341);var r=t(85893),i=t(11057),o=t(14564),a=t(67294),s=t(82809),l=t(18560),c=t(40876),u={font:(0,r.jsx)(s.Z,{}),background:(0,r.jsx)(l.Z,{})};function d(e){var n=e.type,t=e.buttonClassName,s=e.disabled,l=void 0!==s&&s,d=(e.color,e.onChange),p=(0,a.useState)(null),m=p[0],f=p[1],h=(0,a.useRef)(null),g=(0,a.useState)(""),x=g[0],v=g[1],b=Boolean(m),y=b?"simple-popover":void 0;(0,a.useEffect)(function(){b&&(null==h?void 0:h.current)&&h.current.click()},[b,null==h?void 0:h.current]),(0,a.useEffect)(function(){var e=setTimeout(function(){d(x)},300);return function(){return clearTimeout(e)}},[x]);var j=function(e){f(e.currentTarget)},Z=function(){f(null)};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(i.Z,{disableMinWidth:!0,disabled:l,"aria-describedby":y,variant:"text",color:"black",classes:{root:void 0===t?"":t},onClick:j,startIcon:u[void 0===n?"font":n],endIcon:(0,r.jsx)(c.Z,{})}),(0,r.jsx)("input",{ref:h,disabled:l,value:x,onChange:function(e){return v(e.target.value)},type:"color",style:{width:0,height:0,opacity:0,padding:0,border:"none"}}),(0,r.jsx)(o.ZP,{keepMounted:!0,id:y,open:b,anchorEl:m,onClose:Z,anchorOrigin:{vertical:"bottom",horizontal:"left"},PaperProps:{sx:{width:0,height:0,minWidth:0,minHeight:0,opacity:0}}})]})}t(37563);var p=t(7297),m=t(16177),f=t(70917),h=t(10166);function g(){var e=(0,p.Z)(["\n  .ContentEditable__root {\n    border: 0;\n    font-size: 15px;\n    display: block;\n    position: relative;\n    outline: 0;\n    padding: 8px 28px 40px;\n    min-height: 150px;\n  }\n  @media (max-width: 1025px) {\n    .ContentEditable__root {\n      padding-left: 8px;\n      padding-right: 8px;\n    }\n  }\n"]);return g=function(){return e},e}function x(){var e=(0,p.Z)(["\n  ","\n"]);return x=function(){return e},e}function v(e){var n=e.className;return(0,r.jsx)(y,{children:(0,r.jsx)(m.f,{className:n||"ContentEditable__root"})})}var b=function(e){return(0,f.iv)(g())},y=h.Z.div(x(),b);function j(){var e=(0,p.Z)(["\n  &.Placeholder__root {\n    font-size: 15px;\n    color: #999;\n    overflow: hidden;\n    position: absolute;\n    text-overflow: ellipsis;\n    top: 8px;\n    left: 28px;\n    right: 28px;\n    user-select: none;\n    white-space: nowrap;\n    display: inline-block;\n    pointer-events: none;\n  }\n  @media (max-width: 1025px) {\n    &.Placeholder__root {\n      left: 8px;\n    }\n  }\n"]);return j=function(){return e},e}function Z(){var e=(0,p.Z)(["\n  ","\n"]);return Z=function(){return e},e}function w(e){var n=e.children,t=e.className;return(0,r.jsx)(C,{className:t||"Placeholder__root",children:n})}var k=function(e){return(0,f.iv)(j())},C=h.Z.div(Z(),k),_=t(51233),S=t(15861),I=t(18824),D=t(75323),E=t(17730),A=["image/"],T=["application/pdf"];function M(e){var n=e.file,t=(0,I.tV)(n,A);return(0,I.tV)(n,T)?(0,r.jsxs)(_.Z,{mb:2,width:"100%",direction:"row",alignItems:"center",sx:{p:1,border:"1px solid rgba(0, 0, 0, 0.4)",borderRadius:"5px"},children:[(0,r.jsx)(D.Z,{sx:{color:"red",mr:1}}),(0,r.jsx)(S.Z,{children:n.name})]}):t?(0,r.jsx)(_.Z,{mb:2,flexDirection:"row",children:(0,r.jsx)("img",{style:{width:"100%",borderRadius:"8px",border:"1px solid grey",marginTop:"0.5rem",marginBottom:"0.5rem"},src:URL.createObjectURL(n),alt:n.name})}):(0,r.jsxs)(_.Z,{mb:2,width:"100%",direction:"row",alignItems:"center",sx:{p:1,border:"1px solid rgba(0, 0, 0, 0.4)",borderRadius:"5px"},children:[(0,r.jsx)(E.Z,{sx:{mr:1}}),(0,r.jsx)(S.Z,{children:n.name})]})}},76011:function(e,n,t){t.d(n,{f:function(){return I}});var r=t(26042),i=t(69396),o=t(29815),a=t(85893),s=t(67294),l=t(15861),c=t(93946),u=t(51233),d=t(21023),p=t(96540),m=t(45697),f=t.n(m),h=t(79665),g=t(50135),x=t(11057),v=t(90948),b=t(42283),y=t(41733),j=t(83372),Z=t(16310),w=Z.Ry().shape({caption:Z.Z_()}),k=x.Z,C=(0,v.ZP)(l.Z)({backgroundColor:j.Q.COLOUR.secondary,color:j.Q.COLOUR.white,textAlign:"center",minWidth:"64px",borderRadius:"4px",margin:"10px 0",padding:"4px 10px",boxShadow:"0px 3px 1px -2px rgba(0,0,0,0.2),\n    0px 2px 2px 0px rgba(0,0,0,0.14),\n    0px 1px 5px 0px rgba(0,0,0,0.12)"}),_=(0,v.ZP)("input")({clip:"rect(0 0 0 0)",clipPath:"inset(50%)",height:1,overflow:"hidden",position:"absolute",bottom:0,left:0,whiteSpace:"nowrap",width:1}),S=function(e){var n,t=e.noDelete,o=e.onDelete,p=e.isAdded,m=e.media,f=e.caption,x=e.onSave,v=(0,s.useState)(null),Z=v[0],S=v[1],I=(0,s.useState)(""),D=I[0],E=I[1],A=(0,s.useState)(p),T=A[0],M=A[1],L=(0,b.cI)({resolver:(0,h.S)(w)}),P=L.register,z=L.errors,O=L.handleSubmit,N=L.reset,R=function(e){e.stopPropagation(),S(null),N()},q=function(e){e.stopPropagation(),M(!1),o()},U=function(e){Z&&(x((0,i.Z)((0,r.Z)({},e),{media:Z,type:D})),M(!1))},W=(0,s.useCallback)(function(e){return function(n){n.stopPropagation();var t=n.target.files[0];E(e),S(t)}},[S]);return(0,a.jsx)("form",{children:T?(0,a.jsx)(u.Z,{children:(0,a.jsxs)(u.Z,{rowGap:2,children:[(0,a.jsx)(g.Z,{fullWidth:!0,label:"Caption",variant:"standard",color:"secondary",name:"caption",inputRef:P,error:z.name,helperText:null===(n=z.name)||void 0===n?void 0:n.message}),Z?(0,a.jsxs)(u.Z,{rowGap:3,children:[(0,a.jsxs)(u.Z,{direction:"row",justifyContent:"space-between",alignItems:"center",children:[(0,a.jsx)(l.Z,{sx:{color:j.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:Z.name}),(0,a.jsx)(d.Z,{title:"Delete",placement:"top-start",children:(0,a.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:R,children:(0,a.jsx)(y.Z,{})})})]}),(0,a.jsxs)(u.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,a.jsx)(k,{variant:"contained",color:"danger",size:"small",onClick:q,children:"Cancel"}),(0,a.jsx)(k,{variant:"contained",size:"small",onClick:O(U),children:"Save"})]})]}):(0,a.jsxs)(u.Z,{direction:"row",columnGap:3,justifyContent:"flex-end",children:[(0,a.jsxs)(C,{component:"label",children:["Add image\xa0",(0,a.jsx)(_,{onChange:W("image"),type:"file",accept:"image/*, .heic"})]}),(0,a.jsxs)(C,{component:"label",children:["Add document\xa0",(0,a.jsx)(_,{onChange:W("document"),type:"file",accept:".pdf, .doc, .docx, .xlsx",multiple:!0})]})]})]})}):(0,a.jsxs)(u.Z,{direction:"row",justifyContent:"flex-start",alignItems:"center",spacing:1,children:[(0,a.jsx)(l.Z,{sx:{color:j.Q.COLOUR.secondary,fontWeight:600,pointerEvents:"none"},children:f||(null==m?void 0:m.name)||"No caption"}),!t&&(0,a.jsx)(d.Z,{title:"Delete",placement:"top-start",children:(0,a.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:o,children:(0,a.jsx)(y.Z,{sx:{fontSize:"16px"}})})})]})})};S.propTypes={noDelete:f().func,onDelete:f().func,isAdded:f().bool,media:f().object,onSave:f().func};var I=function(e){var n=e.values,t=e.setValue,m=e.name,f=void 0===m?"attachments":m,h=e.title,g=void 0===h?"Attachments":h,x=e.titleSx,v=e.onDeleteExistingMedia,b=(0,s.useState)([]),y=b[0],j=b[1];(0,s.useEffect)(function(){Array.isArray(n)&&j(n)},[n]);var Z=function(e){e.stopPropagation(),j(function(e){return(0,o.Z)(e).concat([{mediaId:null,caption:"",media:null,type:"",isAdded:!0}])})},w=function(e,n){var r=(0,o.Z)(y);r.splice(e,1,n),t(f,r)};return(0,a.jsxs)(u.Z,{children:[(0,a.jsxs)(u.Z,{direction:"row",alignItems:"center",spacing:1,children:[(0,a.jsx)(l.Z,{sx:void 0===x?{}:x,children:g?g+":":""}),(0,a.jsx)(d.Z,{title:"Add new attachment",placement:"top-start",children:(0,a.jsx)(c.Z,{size:"small",sx:{":hover":{backgroundColor:"#DDDDDD"}},onClick:Z,children:(0,a.jsx)(p.Z,{})})})]}),(0,a.jsx)(u.Z,{pl:2,spacing:.8,children:(null==y?void 0:y.length)?y.map(function(e,n){var o;return(0,a.jsx)(S,(0,i.Z)((0,r.Z)({},e),{onDelete:function(){v&&(null===(e=y[n])||void 0===e?void 0:e.mediaId)&&v(y[n].mediaId);var e,r=y.filter(function(e,t){return t!==n});t(f,r),j(r)},onSave:function(e){return w(n,e)}}),e.caption+n)}):(0,a.jsx)(l.Z,{typography:"subtitle2",children:"No data"})})]})}},8539:function(e,n,t){t.d(n,{b:function(){return na}});var r=t(47568),i=t(26042),o=t(69396),a=t(828),s=t(7297),l=t(29815),c=t(97582),u=t(85893),d=t(67294),p=t(45697),m=t.n(p),f=t(6812),h=t(50319),g=t(75063);function x(){var e=(0,s.Z)(['\n  fragment CommunicationFields on Communication {\n    editorState\n    text\n    from\n    icon\n    id\n    more\n    status\n    statusLog\n    to\n    createdAt\n    media: Media(where: { entity: { _eq: "Communication" } }) {\n      id\n      medium: Medium {\n        id\n        category\n        filename\n        meta\n        type\n      }\n    }\n    user: User {\n      id\n      nameFirst\n      nameLast\n      email\n    }\n  }\n']);return x=function(){return e},e}function v(){var e=(0,s.Z)(["\n  query getCommunications(\n    $accountId: Int\n    $filter: String\n    $jobId: Int\n    $taskId: Int\n    $text: String_comparison_exp\n    $neqFilter: String\n    $limit: Int\n    $offset: Int\n  ) {\n    communications: Communication(\n      order_by: { id: desc }\n      where: {\n        accountId: { _eq: $accountId }\n        text: $text\n        icon: { _eq: $filter, _neq: $neqFilter }\n        jobId: { _eq: $jobId }\n        taskId: { _eq: $taskId }\n      }\n      limit: $limit\n      offset: $offset\n    ) {\n      ...CommunicationFields\n      __typename\n    }\n  }\n\n  ","\n"]);return v=function(){return e},e}function b(){var e=(0,s.Z)(['\n  subscription getCommunications(\n    $accountId: Int\n    $filter: String\n    $jobId: Int\n    $taskId: Int\n    $userId: Int\n    $now: timestamptz!\n  ) {\n    communications: Communication(\n      order_by: { createdAt: desc }\n      where: {\n        accountId: { _eq: $accountId }\n        icon: { _eq: $filter }\n        jobId: { _eq: $jobId }\n        taskId: { _eq: $taskId }\n        _or: [{ from: { _eq: "System message" } }, { userId: { _neq: $userId } }]\n        createdAt: { _gte: $now }\n      }\n    ) {\n      ...CommunicationFields\n    }\n  }\n  ',"\n"]);return b=function(){return e},e}function y(){var e=(0,s.Z)(["\n  mutation AddCommunication($objects: [Communication_insert_input!]!) {\n    insert_Communication(objects: $objects) {\n      returning {\n        ...CommunicationFields\n      }\n    }\n  }\n  ","\n"]);return y=function(){return e},e}function j(){var e=(0,s.Z)(['\n  query GetAllMentionUser($id: [Int!]!, $q: String, $limit: Int, $offset: Int = 0) {\n    users: User(\n      where: {\n        fullName: { _ilike: $q }\n        Account_Users: {\n          status: { _eq: "active" }\n          isContact: { _eq: true }\n          Account: { id: { _in: $id } }\n        }\n      }\n      limit: $limit\n      offset: $offset\n    ) {\n      id\n      fullName\n      email\n      phone\n      Account_Users {\n        Account {\n          type\n        }\n      }\n    }\n  }\n']);return j=function(){return e},e}var Z,w=(0,g.Ps)(x()),k=(0,g.Ps)(v(),w),C=(0,g.Ps)(b(),w),_=(0,g.Ps)(y(),w),S=(0,g.Ps)(j()),I=t(14924),D=t(30381),E=t.n(D),A=function(e,n,t,r,i){if(e)return{entity:"Communication",status:"active",Medium:{data:{meta:"internal"===i?{adminOnly:!0}:{allUser:!0},adminId:r.adminId,filename:e,extension:n,type:t,userId:r.id}}}},T=t(63973),M=(Z=(0,r.Z)(function(e){var n,t,r,i,o,a,s,l,u,d,p,m,f,h,g,x,v,b;return(0,c.__generator)(this,function(c){switch(n=e.form,t=e.scope,r=e.user,i=e.id,o=e.AddCommunication,a=n.audience,s=n.editorState,l=n.text,u=n.mentions,d=null,t){case"job":d="jobId";break;case"task":d="taskId";break;case"customer":case"supplier":case"admin":d="accountId";break;case"property":d="locationId"}if(!d)return[2,null];if(p={},(0,I.Z)(p,d,i),(0,I.Z)(p,"editorState",s),(0,I.Z)(p,"text",l),(0,I.Z)(p,"mentions",u),(0,I.Z)(p,"from",null),(0,I.Z)(p,"icon","comment"),(0,I.Z)(p,"status","delivered"),(0,I.Z)(p,"to",a),(0,I.Z)(p,"userId",r.id),(0,I.Z)(p,"Media",{data:[]}),m=p,x=[],n.attachments&&n.attachments.length>0)for(v=0;v<n.attachments.length;v++)"application/pdf"===(b=n.attachments[v]).type?(h="document",g="pdf"):b.type.startsWith("image/")&&(h="image",g=b.type.split("/")[1]),x.push((0,T.V)(b,h).then(function(e){if("image"===h){var n=e.key,t=e.data.find(function(e){return"large"===e.name});f=t?t.relativePath:n}else f=e.key;m.Media.data.push(A(f,g,h,r,a))}));return Promise.all(x).then(function(e){o({variables:{objects:m}})}),[2]})}),function(e){return Z.apply(this,arguments)}),L=function(e){for(var n=[],t=e.sort(function(e,n){return new Date(n.createdAt).getTime()-new Date(e.createdAt).getTime()}),r=0;r<t.length;r++){var a=t[r],s=E()(a.createdAt).format("D MMM YYYY"),l=t[r+1],c=l?E()(l.createdAt).format("D MMM YYYY"):null;n.push((0,o.Z)((0,i.Z)({},a),{isDivider:c!==s,date:s}))}return n},P=function(e){var n=e.accountType;switch(n){case"customer":return[{label:"Internal",value:"customer"},{label:"Include others",value:"admin-customer"}];case"supplier":return[{label:"Internal",value:"supplier"},{label:"Include others",value:"admin-supplier"}];case"admin":return[{label:"Internal",value:"admin"},{label:"All",value:"all"},{label:"Customer Only",value:"admin-customer"},{label:"Supplier Only",value:"admin-supplier"}];default:return[]}},z=function(e){var n=e.accountType,t=e.adminId,r=e.customerId,i=e.supplierId,o=[];switch(n){case"admin":r&&o.push(r),i&&o.push(i),t&&o.push(t);break;case"customer":r&&o.push(r);break;case"supplier":i&&o.push(i)}return o},O=function(e){var n=e.users,t=e.audience,r=e.accountType,i=e.userId;return n.filter(function(e){var n,i=null===(n=e.Account_Users)||void 0===n?void 0:n.find(function(e){return!!e.Account});if(!i)return!1;switch(t){case"all":return!0;case"admin":return"admin"===i.Account.type;case"admin-customer":if("admin"===r)return"customer"===i.Account.type;return"admin"===i.Account.type||"customer"===i.Account.type;case"admin-supplier":if("admin"===r)return"supplier"===i.Account.type;return"admin"===i.Account.type||"supplier"===i.Account.type;case"customer":return"customer"===i.Account.type;case"supplier":return"supplier"===i.Account.type;default:return!1}}).filter(function(e){return e.id!==i}).map(function(e){return{id:e.id,name:e.fullName,email:e.email,phone:e.phone,value:e.id,label:e.fullName}})},N=t(87918),R=t(51233),q=t(50135),U=t(81458),W=t(5616),F=t(86532),$=t(38895),B=t(22797),H=t(15861),V=t(70917),Q=t(94054),G=t(47312),Y=t(18972),K=t(18360),J=function(e){var n=e.filter,t=e.setFilter,r=function(e){t("all"===e?null:e)};return(0,u.jsx)(W.Z,{sx:{minWidth:120},children:(0,u.jsxs)(Q.Z,{fullWidth:!0,variant:"standard",color:"secondary",children:[(0,u.jsx)(G.Z,{children:"Filter"}),(0,u.jsx)(K.Z,{value:null===n?"all":n,label:"Filter",color:"secondary",onChange:function(e){return r(e.target.value)},children:["all","email","notification","comment"].map(function(e){var n=e.charAt(0).toUpperCase()+e.slice(1);return(0,u.jsx)(Y.Z,{value:e,color:"secondary",children:n},e)})})]})})};J.propTypes={filter:m().oneOf(["all","email","notification","comment"]).isRequired,setFilter:m().func.isRequired};var X=t(89357),ee=t(63786),en=t(68218),et=t(28635),er=t(4505),ei=t(92044),eo=void 0!==window.document&&void 0!==window.document.createElement,ea=t(67798),es=t(21598),el={disableBeforeInput:!1,emptyEditor:!0,isAutocomplete:!1,isCharLimit:!1,isCharLimitUtf8:!1,isCollab:!1,isMaxLength:!1,isRichText:!0,measureTypingPerf:!1,shouldUseLexicalContextMenu:!1,showNestedEditorTreeView:!1,showTableOfContents:!1,showTreeView:!1,tableCellBackgroundColor:!0,tableCellMerge:!0},ec=(0,d.createContext)({setOption:function(e,n){},settings:el});function eu(e){var n=e.children,t=(0,d.useState)(el),r=t[0],a=t[1],s=(0,d.useCallback)(function(e,n){a(function(t){return(0,o.Z)((0,i.Z)({},t),(0,I.Z)({},e,n))}),el[e]===n?ed(e,null):ed(e,n)},[]),l=(0,d.useMemo)(function(){return{setOption:s,settings:r}},[s,r]);return(0,u.jsx)(ec.Provider,{value:l,children:n})}function ed(e,n){var t=new URL(window.location.href),r=new URLSearchParams(t.search);null!==n?r.has(e)?r.set(e,String(n)):r.append(e,String(n)):r.has(e)&&r.delete(e),t.search=r.toString(),window.history.pushState(null,"",t.toString())}var ep=t(72981),em=et.$,ef=function(e){var n=e.loading,t=e.setLoading,r=e.onSubmit,i=e.onSubmitAttachment,o=(0,ep.V)().historyState,a=(0,d.useContext)(ec).settings.showTreeView,s=(0,ei.Z)(),l=(0,d.useState)(document.body)[0],c=(0,d.useState)(!1),p=c[0],m=c[1],f=(0,d.useState)(!1),h=f[0],g=f[1];return(0,d.useEffect)(function(){var e=function(){var e=eo&&window.matchMedia("(max-width: 1025px)").matches;e!==h&&g(e)};return e(),window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}},[h]),(0,u.jsxs)("div",{className:"editor-container",children:[s&&(0,u.jsx)(ea.Mq,{setIsLinkEditMode:m}),(0,u.jsxs)("div",{className:"editor-inner",children:[(0,u.jsx)(en.B,{contentEditable:(0,u.jsx)(es.f$,{className:"editor-input"}),placeholder:(0,u.jsx)(es.Vm,{className:"editor-placeholder"}),ErrorBoundary:X.Z}),(0,u.jsx)(em,{}),(0,u.jsx)(er.y,{}),(0,u.jsx)(ee.e,{externalHistoryState:o}),(0,u.jsx)(ea.Hi,{}),(0,u.jsx)(ea.Nz,{}),(0,u.jsx)(ea.yi,{}),(0,u.jsx)(ea.Xe,{captionsEnabled:!1}),s&&l&&(0,u.jsx)(ea.tC,{anchorElem:l,isLinkEditMode:p,setIsLinkEditMode:m})]}),s&&(0,u.jsxs)("div",{className:"editor-footer",children:[(0,u.jsx)(ea.Ps,{}),(0,u.jsxs)("div",{children:[(0,u.jsx)(ea.WL,{loading:n,setLoading:t,saveContent:i}),(0,u.jsx)(ea.DE,{loading:n,setLoading:t,saveContent:r})]})]}),a&&(0,u.jsx)(ea.xt,{})]})};ef.defaultProps={loading:!1,onSubmit:function(){},onSubmitAttachment:function(){}},ef.propTypes={loading:m().bool,onSubmit:m().func,onSubmitAttachment:m().func};var eh=t(99534),eg=t(10166);function ex(){var e=(0,s.Z)(["\n    ","\n    ","\n  "]);return ex=function(){return e},e}function ev(){var e=(0,s.Z)(["\n  .editor-container {\n    font-family: Nunito-Regular;\n    width: 100%;\n    border-radius: 10px;\n    color: #000;\n    background: rgba(0, 0, 0, 0.06);\n    position: relative;\n    line-height: 20px;\n    font-weight: 400;\n    text-align: left;\n  }\n\n  .ltr {\n    text-align: left;\n  }\n\n  .rtl {\n    text-align: right;\n  }\n\n  .editor-inner {\n    position: relative;\n  }\n\n  .editor-input {\n    min-height: 150px;\n    resize: none;\n    font-size: 15px;\n    caret-color: rgb(5, 5, 5);\n    position: relative;\n    tab-size: 1;\n    outline: 0;\n    padding: 15px 10px;\n    caret-color: #444;\n  }\n\n  .editor-placeholder {\n    color: #999;\n    overflow: hidden;\n    position: absolute;\n    text-overflow: ellipsis;\n    top: 15px;\n    left: 10px;\n    font-size: 15px;\n    user-select: none;\n    display: inline-block;\n    pointer-events: none;\n  }\n\n  .editor-text-bold {\n    font-weight: bold;\n  }\n\n  .editor-text-italic {\n    font-style: italic;\n  }\n\n  .editor-text-underline {\n    text-decoration: underline;\n  }\n\n  .editor-text-strikethrough {\n    text-decoration: line-through;\n  }\n\n  .editor-text-underlineStrikethrough {\n    text-decoration: underline line-through;\n  }\n\n  .editor-text-code {\n    background-color: rgba(0, 0, 0, 0.1);\n    padding: 1px 0.25rem;\n    font-family: Menlo, Consolas, Monaco, monospace;\n    font-size: 94%;\n  }\n\n  .editor-link {\n    color: rgb(33, 111, 219);\n    text-decoration: none;\n  }\n\n  .editor-text-mention {\n    border-radius: 5px;\n    padding: 0 5px;\n    background-color: #faae20;\n  }\n\n  .tree-view-output {\n    display: block;\n    background: #222;\n    color: #fff;\n    padding: 5px;\n    font-size: 12px;\n    white-space: pre-wrap;\n    margin: 1px auto 10px auto;\n    max-height: 250px;\n    position: relative;\n    border-bottom-left-radius: 10px;\n    border-bottom-right-radius: 10px;\n    overflow: auto;\n    line-height: 14px;\n  }\n\n  .editor-code {\n    background-color: rgb(240, 242, 245);\n    font-family: Menlo, Consolas, Monaco, monospace;\n    display: block;\n    padding: 8px 8px 8px 52px;\n    line-height: 1.53;\n    font-size: 13px;\n    margin: 0;\n    margin-top: 8px;\n    margin-bottom: 8px;\n    tab-size: 2;\n    /* white-space: pre; */\n    overflow-x: auto;\n    position: relative;\n  }\n\n  .editor-code:before {\n    content: attr(data-gutter);\n    position: absolute;\n    background-color: #eee;\n    left: 0;\n    top: 0;\n    border-right: 1px solid #ccc;\n    padding: 8px;\n    color: #777;\n    white-space: pre-wrap;\n    text-align: right;\n    min-width: 25px;\n  }\n  .editor-code:after {\n    content: attr(data-highlight-language);\n    top: 0;\n    right: 3px;\n    padding: 3px;\n    font-size: 10px;\n    text-transform: uppercase;\n    position: absolute;\n    color: rgba(0, 0, 0, 0.5);\n  }\n\n  .editor-tokenComment {\n    color: slategray;\n  }\n\n  .editor-tokenPunctuation {\n    color: #999;\n  }\n\n  .editor-tokenProperty {\n    color: #905;\n  }\n\n  .editor-tokenSelector {\n    color: #690;\n  }\n\n  .editor-tokenOperator {\n    color: #9a6e3a;\n  }\n\n  .editor-tokenAttr {\n    color: #07a;\n  }\n\n  .editor-tokenVariable {\n    color: #e90;\n  }\n\n  .editor-tokenFunction {\n    color: #dd4a68;\n  }\n\n  .editor-paragraph {\n    margin: 0;\n    margin-bottom: 8px;\n    position: relative;\n  }\n\n  .editor-paragraph:last-child {\n    margin-bottom: 0;\n  }\n\n  .editor-heading-h1 {\n    font-size: 24px;\n    color: rgb(5, 5, 5);\n    font-weight: 400;\n    margin: 0;\n    margin-bottom: 12px;\n    padding: 0;\n  }\n\n  .editor-heading-h2 {\n    font-size: 15px;\n    color: rgb(101, 103, 107);\n    font-weight: 700;\n    margin: 0;\n    margin-top: 10px;\n    padding: 0;\n    text-transform: uppercase;\n  }\n\n  .editor-quote {\n    margin: 0;\n    margin-left: 20px;\n    font-size: 15px;\n    color: rgb(101, 103, 107);\n    border-left-color: rgb(206, 208, 212);\n    border-left-width: 4px;\n    border-left-style: solid;\n    padding-left: 16px;\n  }\n\n  .editor-list-ol {\n    padding: 0;\n    margin: 0;\n    margin-left: 16px;\n  }\n\n  .editor-list-ul {\n    padding: 0;\n    margin: 0;\n    margin-left: 16px;\n  }\n\n  .editor-listitem {\n    margin: 8px 32px 8px 32px;\n  }\n\n  .editor-nested-listitem {\n    list-style-type: none;\n  }\n\n  .editor-text-bgcolor {\n    border-radius: 5px;\n    padding: 0 5px;\n  }\n\n  pre::-webkit-scrollbar {\n    background: transparent;\n    width: 10px;\n  }\n\n  pre::-webkit-scrollbar-thumb {\n    background: #999;\n  }\n\n  .debug-timetravel-panel {\n    overflow: hidden;\n    padding: 0 0 10px 0;\n    margin: auto;\n    display: flex;\n  }\n\n  .debug-timetravel-panel-slider {\n    padding: 0;\n    flex: 8;\n  }\n\n  .debug-timetravel-panel-button {\n    padding: 0;\n    border: 0;\n    background: none;\n    flex: 1;\n    color: #fff;\n    font-size: 12px;\n  }\n\n  .debug-timetravel-panel-button:hover {\n    text-decoration: underline;\n  }\n\n  .debug-timetravel-button {\n    border: 0;\n    padding: 0;\n    font-size: 12px;\n    top: 10px;\n    right: 15px;\n    position: absolute;\n    background: none;\n    color: #fff;\n  }\n\n  .debug-timetravel-button:hover {\n    text-decoration: underline;\n  }\n\n  .toolbar {\n    display: flex;\n    margin-bottom: 1px;\n    padding: 4px;\n    border-top-left-radius: 10px;\n    border-top-right-radius: 10px;\n    vertical-align: middle;\n    overflow-x: scroll;\n  }\n\n  .toolbar::-webkit-scrollbar {\n    width: 10px;\n    height: 5px;\n  }\n\n  .toolbar button.toolbar-item {\n    border: 0;\n    display: flex;\n    background: none;\n    border-radius: 10px;\n    padding: 8px;\n    cursor: pointer;\n    vertical-align: middle;\n  }\n\n  .toolbar button.toolbar-item:disabled {\n    cursor: not-allowed;\n  }\n\n  .toolbar button.toolbar-item.spaced {\n    margin-right: 2px;\n  }\n\n  .toolbar button.toolbar-item svg.MuiSvgIcon-root.format {\n    background-size: contain;\n    display: inline-block;\n    // height: 18px;\n    // width: 18px;\n    margin-top: 2px;\n    vertical-align: -0.25em;\n    display: flex;\n    opacity: 0.6;\n  }\n\n  .toolbar button.toolbar-item:disabled svg.MuiSvgIcon-root.format {\n    opacity: 0.2;\n  }\n\n  .toolbar button.toolbar-item.active {\n    background-color: rgba(0, 0, 0, 0.1);\n  }\n\n  .toolbar button.toolbar-item.active svg {\n    opacity: 1;\n  }\n\n  .toolbar .toolbar-item:hover:not([disabled]) {\n    background-color: rgba(0, 0, 0, 0.1);\n  }\n\n  .toolbar .divider {\n    width: 1px;\n    min-width: 1px;\n    background-color: rgba(0, 0, 0, 0.2);\n    margin: 0 10px;\n  }\n\n  .toolbar .toolbar-item .text {\n    display: flex;\n    line-height: 20px;\n    width: 200px;\n    vertical-align: middle;\n    font-size: 14px;\n    color: #777;\n    text-overflow: ellipsis;\n    width: 70px;\n    overflow: hidden;\n    height: 20px;\n    text-align: left;\n  }\n\n  .toolbar .toolbar-item .icon {\n    display: flex;\n    width: 20px;\n    height: 20px;\n    user-select: none;\n    margin-right: 8px;\n    line-height: 16px;\n    background-size: contain;\n  }\n\n  .toolbar .toolbar-item.color-picker .MuiButton-startIcon {\n    margin: 0;\n  }\n\n  .toolbar .toolbar-item.color-picker .MuiButton-endIcon {\n    margin: 0;\n    margin-left: 4px;\n  }\n\n  .editor-image {\n    cursor: default;\n    display: inline-block;\n    position: relative;\n    user-select: none;\n  }\n\n  .editor-image img {\n    max-width: 100%;\n    cursor: default;\n  }\n\n  .editor-image img.focused {\n    outline: 2px solid rgb(60, 132, 244);\n    user-select: none;\n  }\n\n  .editor-image img.focused.draggable {\n    cursor: grab;\n  }\n\n  .editor-image img.focused.draggable:active {\n    cursor: grabbing;\n  }\n\n  .editor-image .image-caption-container .tree-view-output {\n    margin: 0;\n    border-radius: 0;\n  }\n\n  .editor-image .image-caption-container {\n    display: block;\n    position: absolute;\n    bottom: 4px;\n    left: 0;\n    right: 0;\n    padding: 0;\n    margin: 0;\n    border-top: 1px solid #fff;\n    background-color: rgba(255, 255, 255, 0.9);\n    min-width: 100px;\n    color: #000;\n    overflow: hidden;\n  }\n\n  .editor-image .image-caption-button {\n    display: block;\n    position: absolute;\n    bottom: 20px;\n    left: 0;\n    right: 0;\n    width: 30%;\n    padding: 10px;\n    margin: 0 auto;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    border-radius: 5px;\n    background-color: rgba(0, 0, 0, 0.5);\n    min-width: 100px;\n    color: #fff;\n    cursor: pointer;\n    user-select: none;\n  }\n\n  .editor-image .image-caption-button:hover {\n    background-color: rgba(60, 132, 244, 0.5);\n  }\n\n  .editor-image .image-edit-button {\n    border: 1px solid rgba(0, 0, 0, 0.3);\n    border-radius: 5px;\n    background-image: url(/src/images/icons/pencil-fill.svg);\n    background-size: 16px;\n    background-position: center;\n    background-repeat: no-repeat;\n    width: 35px;\n    height: 35px;\n    vertical-align: -0.25em;\n    position: absolute;\n    right: 4px;\n    top: 4px;\n    cursor: pointer;\n    user-select: none;\n  }\n\n  .editor-image .image-edit-button:hover {\n    background-color: rgba(60, 132, 244, 0.1);\n  }\n\n  .editor-image .image-resizer {\n    display: block;\n    width: 7px;\n    height: 7px;\n    position: absolute;\n    background-color: rgb(60, 132, 244);\n    border: 1px solid #fff;\n  }\n\n  .editor-image .image-resizer.image-resizer-n {\n    top: -6px;\n    left: 48%;\n    cursor: n-resize;\n  }\n\n  .editor-image .image-resizer.image-resizer-ne {\n    top: -6px;\n    right: -6px;\n    cursor: ne-resize;\n  }\n\n  .editor-image .image-resizer.image-resizer-e {\n    bottom: 48%;\n    right: -6px;\n    cursor: e-resize;\n  }\n\n  .editor-image .image-resizer.image-resizer-se {\n    bottom: -2px;\n    right: -6px;\n    cursor: nwse-resize;\n  }\n\n  .editor-image .image-resizer.image-resizer-s {\n    bottom: -2px;\n    left: 48%;\n    cursor: s-resize;\n  }\n\n  .editor-image .image-resizer.image-resizer-sw {\n    bottom: -2px;\n    left: -6px;\n    cursor: sw-resize;\n  }\n\n  .editor-image .image-resizer.image-resizer-w {\n    bottom: 48%;\n    left: -6px;\n    cursor: w-resize;\n  }\n\n  .editor-image .image-resizer.image-resizer-nw {\n    top: -6px;\n    left: -6px;\n    cursor: nw-resize;\n  }\n\n  .editor-footer {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding-left: 10px;\n    padding-right: 10px;\n    padding-bottom: 10px;\n  }\n\n  .ImageNode__contentEditable {\n    min-height: 20px;\n    border: 0px;\n    resize: none;\n    cursor: text;\n    caret-color: rgb(5, 5, 5);\n    display: block;\n    position: relative;\n    outline: 0px;\n    padding: 10px;\n    user-select: text;\n    font-size: 12px;\n    width: calc(100% - 20px);\n    white-space: pre-wrap;\n    word-break: break-word;\n  }\n\n  .ImageNode__placeholder {\n    font-size: 12px;\n    color: #888;\n    overflow: hidden;\n    position: absolute;\n    text-overflow: ellipsis;\n    top: 10px;\n    left: 10px;\n    user-select: none;\n    white-space: nowrap;\n    display: inline-block;\n    pointer-events: none;\n  }\n\n  .ImageNode__taskPriority {\n    width: 20px;\n    height: 20px;\n    margin-bottom: -5px;\n  }\n\n  .image-control-wrapper--resizing {\n    touch-action: none;\n  }\n"]);return ev=function(){return e},e}function eb(e){var n=e.customStyles,t=(0,eh.Z)(e,["customStyles"]),r=eg.Z.div(ex(),ey,n);return(0,u.jsx)(r,(0,i.Z)({},t))}eb.defaultProps={customStyles:""},eb.propTypes={customStyles:m().string};var ey=function(e){return(0,V.iv)(ev())},ej=t(42693),eZ=t(91395),ew=t(96261),ek=t(51438),eC=t(45785),e_=t(82662),eS=t(28668),eI=t(26626),eD=function(e){(0,eS.Z)(t,e);var n=(0,eI.Z)(t);function t(e,r,i){var o;return(0,ek.Z)(this,t),(o=n.call(this,e,i)).__text=E()(e).format(r),o.__momentFormat=r,o}var r=t.prototype;return r.createDOM=function(e){return(0,eC.Z)((0,e_.Z)(t.prototype),"createDOM",this).call(this,e)},r.updateDOM=function(e,n,r){return(0,eC.Z)((0,e_.Z)(t.prototype),"updateDOM",this).call(this,e,n,r)},r.exportJSON=function(){return{text:E()(this.__text,this.__momentFormat).toISOString(),momentFormat:this.__momentFormat,type:"TimestampNode",version:1}},t.importJSON=function(e){var n,t,r=e.text,i=e.momentFormat,o=e.format,a=(n=r,t=i,new eD(n,t));return a.setFormat(o),a},t.getType=function(){return"TimestampNode"},t.clone=function(e){return new t(e.__text,e.__momentFormat,e.__key)},t}(t(61084).R2),eE=[ej.qp,ej.GR,eZ.AV,ew.HJ,eD],eA={editable:!0,namespace:"React.js Demo",nodes:(0,l.Z)(eE),onError:function(e){throw e},theme:{code:"editor-code",heading:{h1:"editor-heading-h1",h2:"editor-heading-h2",h3:"editor-heading-h3",h4:"editor-heading-h4",h5:"editor-heading-h5"},image:"editor-image",link:"editor-link",list:{listitem:"editor-listitem",nested:{listitem:"editor-nested-listitem"},ol:"editor-list-ol",ul:"editor-list-ul"},ltr:"ltr",paragraph:"editor-paragraph",placeholder:"editor-placeholder",quote:"editor-quote",rtl:"rtl",text:{bold:"editor-text-bold",code:"editor-text-code",hashtag:"editor-text-hashtag",italic:"editor-text-italic",overflowed:"editor-text-overflowed",strikethrough:"editor-text-strikethrough",underline:"editor-text-underline",underlineStrikethrough:"editor-text-underlineStrikethrough"}}},eT=t(56264),eM=t(57826);function eL(){var e=(0,s.Z)(["\n  .message-header {\n    display: flex;\n    justify-content: space-between;\n    border-radius: 10px 10px 0 0;\n    background: rgba(0, 0, 0, 0.06);\n    padding: 5px 15px 0 15px;\n  }\n\n  .message-footer {\n    position: relative;\n    border-radius: 0 0 10px 0;\n    background: rgba(0, 0, 0, 0.06);\n    padding: 5px 15px 0 15px;\n  }\n  .message-footer:after {\n    content: '';\n    position: absolute;\n    bottom: 0;\n    left: -14px;\n    width: 0;\n    height: 0;\n    border-top: 10px solid transparent;\n    border-right: 15px solid rgba(0, 0, 0, 0.06);\n    border-bottom: 0px solid transparent;\n  }\n\n  .message-images {\n    padding: 0 15px;\n    background: rgba(0, 0, 0, 0.06);\n  }\n"]);return eL=function(){return e},e}function eP(){var e=(0,s.Z)(["\n  .editor-container {\n    border-radius: 0;\n  }\n\n  .editor-input {\n    min-height: auto;\n    padding: 0 15px;\n    border-radius: 0;\n  }\n"]);return eP=function(){return e},e}function ez(){var e=(0,s.Z)(["\n  ","\n"]);return ez=function(){return e},e}var eO=function(e){return(0,V.iv)(eL())},eN=function(){return(0,V.iv)(eP())},eR=eg.Z.div(ez(),eO),eq=t(69661),eU=function(e){switch(e){case"supplier":return"supplier only";case"customer":return"customer only";case"all":return"all";case"admin":return"internal";case"admin-supplier":return"admin and supplier";case"admin-customer":return"admin and customer";default:return""}},eW=t(62665).Z,eF=function(e){var n=e.documentAttachmentArray;return(0,u.jsx)(u.Fragment,{children:n.map(function(e){return(0,u.jsxs)(W.Z,{sx:{mb:"5px"},children:[(0,u.jsx)("object",{style:{borderRadius:"5px"},data:e.src,width:"100%",height:"200px"}),(0,u.jsxs)(R.Z,{direction:"row",alignItems:"center",children:[(0,u.jsx)(eW,{color:"muiGray.main",sx:{mr:"10px"}}),(0,u.jsx)("a",{href:e.src,rel:"noopener noreferrer",target:"_blank",style:{fontSize:"11px"},children:e.name})]})]})})})};eF.propTypes={documentAttachmentArray:m().array.isRequired};var e$=t(734),eB=function(e){var n=e.imageAttachmentArray,t=(0,d.useState)(0),r=t[0],i=t[1],o=(0,d.useState)(!1),a=o[0],s=o[1],l=n.map(function(e){return e.src}),c=(0,d.useCallback)(function(e){i(e),s(!0)},[]),p=function(){i(0),s(!1)};return(0,u.jsxs)(W.Z,{children:[l.map(function(e,n){return(0,u.jsx)("img",{src:e,onClick:function(){return c(n)},style:{objectFit:"cover",width:"150px",height:"100px",margin:"2px"},alt:""},n)}),a&&(0,u.jsx)(e$.Z,{src:l,currentIndex:r,disableScroll:!1,closeOnClickOutside:!0,onClose:p,backgroundStyle:{zIndex:9999}})]})};eB.propTypes={imageAttachmentArray:m().array.isRequired};var eH=function(e){var n=e.attachmentArray;return n[0].type.startsWith("application")?(0,u.jsx)(eF,{documentAttachmentArray:n}):n[0].type.startsWith("image")?(0,u.jsx)(eB,{imageAttachmentArray:n}):null};eH.propTypes={attachmentArray:m().array.isRequired};var eV=t(76388),eQ=t(40999),eG=function(e){var n=e.data,t="at "+E()(n.createdAt).format("hh:mma"),r=eU(n.to),a=(0,eV.u)("".concat(n.user.nameFirst," ").concat(n.user.nameLast));return(0,u.jsx)(eR,{children:(0,u.jsxs)(R.Z,{direction:"row",justifyContent:"flex-start",alignItems:"flex-end",mb:2,children:[(0,u.jsxs)(eq.Z,{sx:{bgcolor:a},alt:n.from,src:n.from,children:[n.user.nameFirst[0],n.user.nameLast[0]]}),(0,u.jsxs)(R.Z,{width:"80%",ml:2,children:[(0,u.jsxs)("div",{className:"message-header",children:[(0,u.jsx)(H.Z,{sx:{fontSize:11,fontWeight:600},children:n.from}),(0,u.jsx)(H.Z,{sx:{fontSize:11,color:"rgba(0, 0, 0, 0.87)",marginLeft:"5px"},children:t})]}),(0,u.jsx)("div",{className:"message-images",children:Boolean(n.attachments.length)&&(0,u.jsx)(eH,{attachmentArray:n.attachments})}),(0,u.jsx)(eQ.R,{initialConfig:(0,o.Z)((0,i.Z)({},eA),{editable:!1,editorState:JSON.stringify(n.editorState)}),children:(0,u.jsx)(ep.Z,{children:(0,u.jsx)(eb,{customStyles:eN,children:(0,u.jsx)(ef,{})})})}),(0,u.jsx)("div",{className:"message-footer",children:(0,u.jsx)(R.Z,{width:"100%",direction:"row",justifyContent:"flex-end",children:(0,u.jsx)(H.Z,{sx:{fontSize:11},children:r})})})]})]})})};function eY(){var e=(0,s.Z)(["\n  .message-header {\n    display: flex;\n    justify-content: space-between;\n    border-radius: 10px 10px 0 0;\n    background: rgba(0, 0, 0, 0.06);\n    padding: 5px 15px 0 15px;\n  }\n\n  .message-footer {\n    position: relative;\n    border-radius: 0 0 0 10px;\n    background: rgba(0, 0, 0, 0.06);\n    padding: 5px 15px 0 15px;\n  }\n  .message-footer:after {\n    content: '';\n    position: absolute;\n    bottom: 0;\n    right: -14px;\n    width: 0;\n    height: 0;\n    border-top: 10px solid transparent;\n    border-left: 15px solid rgba(0, 0, 0, 0.06);\n    border-bottom: 0px solid transparent;\n  }\n\n  .message-images {\n    padding: 0 15px;\n    background: rgba(0, 0, 0, 0.06);\n  }\n"]);return eY=function(){return e},e}function eK(){var e=(0,s.Z)(["\n  .editor-container {\n    border-radius: 0;\n  }\n\n  .editor-input {\n    min-height: auto;\n    padding: 0 15px;\n    border-radius: 0;\n  }\n"]);return eK=function(){return e},e}function eJ(){var e=(0,s.Z)(["\n  ","\n"]);return eJ=function(){return e},e}eG.propTypes={data:m().object.isRequired};var eX=function(e){return(0,V.iv)(eY())},e0=function(){return(0,V.iv)(eK())},e1=eg.Z.div(eJ(),eX),e2=function(e){var n=e.data,t="at "+E()(n.createdAt).format("hh:mma"),r=eU(n.to),a=(0,eV.u)("".concat(n.user.nameFirst," ").concat(n.user.nameLast));return(0,u.jsx)(e1,{children:(0,u.jsxs)(R.Z,{direction:"row",justifyContent:"flex-end",alignItems:"flex-end",mb:2,children:[(0,u.jsxs)(R.Z,{width:"80%",mr:2,children:[(0,u.jsxs)("div",{className:"message-header",children:[(0,u.jsx)(H.Z,{sx:{fontSize:11,fontWeight:600},children:n.from}),(0,u.jsx)(H.Z,{sx:{fontSize:11,color:"rgba(0, 0, 0, 0.87)",marginLeft:"5px"},children:t})]}),(0,u.jsx)("div",{className:"message-images",children:Boolean(n.attachments.length)&&(0,u.jsx)(eH,{attachmentArray:n.attachments})}),(0,u.jsx)(eQ.R,{initialConfig:(0,o.Z)((0,i.Z)({},eA),{editable:!1,editorState:JSON.stringify(n.editorState)}),children:(0,u.jsx)(ep.Z,{children:(0,u.jsx)(eb,{customStyles:e0,children:(0,u.jsx)(ef,{editable:!1})})})}),(0,u.jsx)("div",{className:"message-footer",children:(0,u.jsx)(R.Z,{width:"100%",direction:"row",justifyContent:"flex-end",children:(0,u.jsx)(H.Z,{sx:{fontSize:11},children:r})})})]}),(0,u.jsxs)(eq.Z,{sx:{bgcolor:a},alt:n.from,src:n.from,children:[n.user.nameFirst[0],n.user.nameLast[0]]})]})})};function e5(){var e=(0,s.Z)(["\n  .message-header {\n    display: flex;\n    justify-content: space-between;\n    border-radius: 10px 10px 0 0;\n    background: none;\n    padding: 5px 15px 0 15px;\n  }\n\n  .message-images {\n    background: none;\n  }\n\n  .editor-container {\n    border-radius: 0;\n  }\n\n  div.editor-input {\n    min-height: auto;\n    padding: 0 15px;\n  }\n"]);return e5=function(){return e},e}function e6(){var e=(0,s.Z)(["\n  .editor-container {\n    border-radius: 0;\n    background: none;\n  }\n\n  .editor-input {\n    min-height: auto;\n    padding: 0 15px;\n    border-radius: 0;\n    color: rgba(117, 117, 117, 0.87);\n  }\n"]);return e6=function(){return e},e}function e8(){var e=(0,s.Z)(["\n  ","\n"]);return e8=function(){return e},e}e2.propTypes={data:m().object.isRequired};var e3=function(e){return(0,V.iv)(e5())},e4=function(){return(0,V.iv)(e6())},e9=eg.Z.div(e8(),e3),e7=t(86886),ne=function(e){var n=e.data,t="at "+E()(n.createdAt).format("hh:mma");return(0,u.jsx)(e9,{children:(0,u.jsx)(R.Z,{direction:"row",justifyContent:"flex-start",mb:2,children:(0,u.jsx)(R.Z,{width:"100%",children:(0,u.jsxs)(e7.ZP,{container:!0,children:[(0,u.jsxs)(e7.ZP,{item:!0,xs:9,children:[(0,u.jsx)("div",{className:"message-images",children:Boolean(n.attachments.length)&&(0,u.jsx)(eH,{attachmentArray:n.attachments})}),(0,u.jsx)(eQ.R,{initialConfig:(0,o.Z)((0,i.Z)({},eA),{editable:!1,editorState:JSON.stringify(n.editorState)}),children:(0,u.jsx)(ep.Z,{children:(0,u.jsx)(eb,{customStyles:e4,children:(0,u.jsx)(ef,{editable:!1})})})})]}),(0,u.jsx)(e7.ZP,{item:!0,xs:3,children:(0,u.jsx)(H.Z,{sx:{fontSize:11,color:"rgba(0, 0, 0, 0.87)",textAlign:"right"},children:t})})]})})})})};ne.propTypes={data:m().object.isRequired};var nn=function(e){var n=e.data;return"System message"===n.from?(0,u.jsx)(ne,{data:n}):"in"===n.type?(0,u.jsx)(eG,{data:n}):(0,u.jsx)(e2,{data:n})},nt=t(74944),nr=t(27434),ni=t(58533);function no(){var e=(0,s.Z)(["\n  .editor-inner {\n    overflow-y: scroll;\n    max-height: 300px;\n  }\n\n  .editor-input {\n    min-height: 100px;\n  }\n\n  .audience-plugin {\n    .MuiInputBase-root {\n      width: 110px;\n    }\n\n    .select {\n      justify-self: flex-start;\n      padding: 5px 32px 5px 5px;\n    }\n  }\n"]);return no=function(){return e},e}var na=function(e){var n,t=e.title,s=e.elevation,p=e.maxHeight,m=e.id,g=e.adminId,x=e.customerId,v=e.supplierId,b=e.scope,y=e.expanded,j=e.onChangeExpanded,Z=e.hideExpandIcon,w=(0,nt.x)().user,I=(0,d.useMemo)(function(){return P({accountType:w.accountType})},[w.accountType]),D=(0,d.useState)(!1),A=D[0],T=D[1],V=(0,d.useState)(null),Q=V[0],G=V[1],Y=(0,d.useState)(""),K=Y[0],X=Y[1],ee=(0,d.useState)(""),en=ee[0],et=ee[1],er=(0,d.useState)(""),ei=er[0],eo=er[1],ea=(0,d.useState)(null===(n=I[0])||void 0===n?void 0:n.value),es=ea[0],el=ea[1],ec=(0,d.useState)([]),ed=ec[0],em=ec[1],eh=(0,d.useState)(0),eg=eh[0],ex=eh[1],ev=(0,d.useState)(!0),ey=ev[0],ej=ev[1],eZ=(0,d.useMemo)(function(){return z({accountType:w.accountType,adminId:g,customerId:x,supplierId:v})},[w.accountType,g,x,v]),ew=(0,f.a)(S,{variables:{id:eZ,limit:50,offset:0,q:ei?"%".concat(ei,"%"):null}}).data,ek=(void 0===ew?{users:[]}:ew).users,eC=(0,d.useMemo)(function(){return O({users:ek,audience:es,accountType:w.accountType,userId:w.id})},[es,w.accountType,w.id,ek]),e_=(0,d.useMemo)(function(){return(0,o.Z)((0,i.Z)({},"job"===b&&{jobId:m},"task"===b&&{taskId:m}),{filter:Q||null,text:{_ilike:en?"%".concat(en,"%"):null},limit:50,offset:0})},[b,m,Q,en]),eS=(0,d.useMemo)(function(){return(0,o.Z)((0,i.Z)({},"job"===b&&{jobId:m},"task"===b&&{taskId:m}),{filter:Q||null})},[b,m,Q]),eI=(0,f.a)(k,{variables:e_,fetchPolicy:"cache-and-network",nextFetchPolicy:"cache-and-network"}),eD=eI.data,eE=(void 0===eD?{communications:[]}:eD).communications,eL=eI.fetchMore,eP=eI.subscribeToMore,ez=eI.updateQuery,eO=(0,d.useCallback)((0,r.Z)(function(){var e,n;return(0,c.__generator)(this,function(e){switch(e.label){case 0:return[4,eL({variables:{offset:eg+50},updateQuery:function(e,n){var t=n.fetchMoreResult;if(!t)return e;var r=t.communications.filter(function(n){var t=n.id;return!e.communications.find(function(e){return e.id===t})});return Object.assign({},e,{communications:(0,l.Z)(e.communications).concat((0,l.Z)(r))})}})];case 1:return n=e.sent().data.communications,ex(function(e){return e+50}),n.length||ej(!1),[2]}})}),[eL,eg]);(0,d.useEffect)(function(){var e,n,t=(0,l.Z)(eE).map(function(e){var n=e.user?"".concat(e.user.nameFirst," <").concat(e.user.email,">"):"Undefined";"System message"===e.from&&(n="System message");var t=[];return e.media.forEach(function(e){var n,r;(null==e?void 0:null===(n=e.medium)||void 0===n?void 0:n.type)==="image"?t.push({type:"image/png",src:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.medium.filename),name:""}):(null==e?void 0:null===(r=e.medium)||void 0===r?void 0:r.type)==="document"&&t.push({type:"application/pdf",src:"".concat("https://cleverly-media.s3.eu-west-2.amazonaws.com","/").concat(e.medium.filename),name:"".concat(e.medium.filename)})}),{editorState:e.editorState,text:e.text,from:n,icon:e.icon,id:e.id,more:e.more,status:e.status,statusLog:e.statusLog,to:e.to,createdAt:e.createdAt,media:e.media,user:e.user,type:e.user&&e.user.id===w.id?"out":"in",statusText:e.status,attachments:t}}),r=L(t);em(r)},[eE,w]);var eN=(0,d.useCallback)(function(){return eP({document:C,variables:(0,o.Z)((0,i.Z)({},eS),{userId:w.id,now:E()().toISOString()}),updateQuery:function(e,n){var t=n.subscriptionData;if(!t.data)return e;if(e.communications){var r=t.data.communications.filter(function(n){var t=n.id;return!e.communications.find(function(e){return e.id===t})});return Object.assign({},e,{communications:(0,l.Z)(e.communications).concat((0,l.Z)(r))})}}})},[eP,eS,w.id]);(0,d.useEffect)(function(){eN()},[eN]);var eR=(0,a.Z)((0,h.D)(_,{onCompleted:function(e){ez(function(n){return(0,o.Z)((0,i.Z)({},n),{communications:(0,l.Z)(n.communications).concat((0,l.Z)(e.insert_Communication.returning))})})}}),2),eq=eR[0],eU=eR[1].loading,eW=function(e){var n=e.json,t=e.plainText,r=e.mentions,i={text:t,editorState:n.editorState,audience:es,mentions:r};M({form:i,scope:b,user:w,id:m,AddCommunication:eq})},eF=function(e){var n,t=e.attachments,r=e.description;M({form:{attachments:t,text:r,editorState:{root:{type:"root",format:"",indent:0,version:1,children:[{type:"paragraph",format:"",indent:0,version:1,children:[{mode:"normal",text:r,type:"text",style:"color: ;",detail:0,format:0,version:1}],direction:"ltr"}],direction:"ltr"}},audience:es,message:null},scope:b,user:w,id:m,AddCommunication:eq})};return(0,d.useEffect)(function(){var e=setTimeout(function(){et(K)},2e3);return function(){return clearTimeout(e)}},[K]),(0,u.jsx)(W.Z,{children:(0,u.jsxs)(F.Z,{elevation:s,expanded:y,onChange:j,children:[(0,u.jsx)($.Z,(0,o.Z)((0,i.Z)({},!Z&&{expandIcon:(0,u.jsx)(nr.Z,{})}),{sx:{"& .MuiAccordionSummary-content":{marginBottom:0}},children:(0,u.jsx)(H.Z,{variant:"h6",children:t})})),(0,u.jsx)(B.Z,{sx:{pt:0},children:(0,u.jsxs)(R.Z,{width:"100%",maxHeight:p,children:[(0,u.jsx)(H.Z,{children:"Active Chat"}),(0,u.jsxs)(R.Z,{direction:"row",justifyContent:"space-between",width:"100%",spacing:1,children:[(0,u.jsx)(q.Z,{fullWidth:!0,label:"Search message",variant:"standard",color:"secondary",value:K,onChange:function(e){return X(e.target.value)}}),(0,u.jsx)(J,{filter:Q,setFilter:G})]}),(0,u.jsx)(W.Z,{id:"scrollableDiv",sx:{display:"flex",flexDirection:"column-reverse",pt:1,overflowY:"auto"},children:(0,u.jsxs)(ni.Z,{dataLength:ed.length,next:eO,style:{display:"flex",flexDirection:"column-reverse",padding:"5px 0 0 0"},inverse:!0,hasMore:ey,loader:(0,u.jsx)(U.Z,{color:"secondary"}),scrollableTarget:"scrollableDiv",children:[!ed.length&&(0,u.jsx)(R.Z,{width:"100%",height:"120px",alignItems:"center",justifyContent:"center",children:(0,u.jsx)(H.Z,{children:"Here no messages"})}),ed.map(function(e){return(0,u.jsxs)(W.Z,{children:[e.isDivider&&(0,u.jsx)(R.Z,{direction:"row",justifyContent:"center",children:(0,u.jsx)(W.Z,{mb:1,children:(0,u.jsx)(N.Z,{label:e.date,sx:{fontSize:"11px",color:"#202020"},size:"small"})})}),(0,u.jsx)(nn,{data:e})]},e.id)})]})}),(0,u.jsx)(eu,{children:(0,u.jsx)(eQ.R,{initialConfig:eA,children:(0,u.jsx)(eT.Z,{audienceOptions:I,audience:es,setAudience:el,children:(0,u.jsx)(eM.Z,{setMentionSearch:eo,mentions:eC,children:(0,u.jsx)(ep.Z,{children:(0,u.jsx)(eb,{customStyles:ns,children:(0,u.jsx)(ef,{loading:A||eU,setLoading:T,onSubmit:eW,onSubmitAttachment:eF})})})})})})})]})})]})})};na.propTypes={scope:m().oneOf(["job","task","customer","supplier","admin","property"]),expanded:m().bool,onChangeExpanded:m().func},na.defaultProps={title:"Context",elevation:1,maxHeight:"550px",onChangeExpanded:function(){}};var ns=function(){return(0,V.iv)(no())}},62155:function(e,n,t){t.d(n,{G:function(){return E}});var r=t(47568),i=t(26042),o=t(69396),a=t(828),s=t(97582),l=t(85893),c=t(30381),u=t.n(c),d=t(50319),p=t(73359),m=t(42283),f=t(79665),h=t(61472),g=t(98456),x=t(51233),v=t(50135),b=t(69297),y=t(33754),j=t(42151),Z=t(74944),w=t(62547),k=t(11389),C=t(76011),_=t(46242),S=t(57493),I=t(67294),D=t(18531),E=function(e){var n,t=e.jobId,c=e.close,E=(0,Z.x)().user,A=(0,_.z)("Task",E.adminId,E.id),T=A.createMediaInput,M=A.loadingAddMedia,L=(0,I.useState)(""),P=L[0],z=L[1],O=(0,m.cI)({defaultValues:{priority:"urgent",relatedLinks:[]},resolver:(0,f.S)(k.E)}),N=O.handleSubmit,R=O.register,q=O.watch,U=O.setValue,W=O.control,F=O.errors,$=q("relatedLinks"),B=q("attachments"),H=(0,a.Z)((0,d.D)(j.ew,{refetchQueries:["GetTasksTable"]}),2),V=H[0],Q=H[1].loading,G=(0,a.Z)((0,p.t)(S.A5,{variables:{accountId:E.adminId,q:""!==P?"%".concat(P,"%"):null}}),2),Y=G[0],K=G[1],J=K.loading,X=K.data,ee=(void 0===X?{items:[]}:X).items,en=(n=(0,r.Z)(function(e){var n,r;return(0,s.__generator)(this,function(o){switch(o.label){case 0:return[4,T(e.attachments)];case 1:return n=o.sent(),r=(0,i.Z)({status:h.cj.NEW,priority:e.priority,relatedLinks:e.relatedLinks,title:e.title,content:e.content,dueDate:e.dueDate,adminId:E.adminId,userId:E.id,assignedAccountId:E.adminId,assignedUserId:e.assignedUser.value,jobId:t},n||{}),[4,V({variables:{objects:[r]}})];case 2:return o.sent(),c(),[2]}})}),function(e){return n.apply(this,arguments)});return Q||M?(0,l.jsx)(x.Z,{width:"100%",direction:"column",justifyContent:"center",alignItems:"center",children:(0,l.jsx)(g.Z,{color:"secondary"})}):(0,l.jsx)("form",{id:"offCanvasForm",onSubmit:N(en),children:(0,l.jsxs)(x.Z,{direction:"column",spacing:3,children:[(0,l.jsx)(m.Qr,{control:W,name:"title",render:function(e){var n,t=e.value,r=e.onChange;return(0,l.jsx)(v.Z,{variant:"standard",color:"secondary",label:"Title",value:t,onChange:r,error:F.title,helperText:null===(n=F.title)||void 0===n?void 0:n.message})}}),(0,l.jsx)(m.Qr,{control:W,name:"content",render:function(e){var n,t=e.value,r=e.onChange;return(0,l.jsx)(v.Z,{multiline:!0,minRows:8,variant:"filled",color:"secondary",label:"Content",value:t,onChange:r,error:F.content,helperText:null===(n=F.content)||void 0===n?void 0:n.message})}}),(0,l.jsx)(m.Qr,{control:W,name:"priority",render:function(e){var n,t=e.value,r=e.onChange;return(0,l.jsx)(b.E,{label:"Priority:",labelLeft:!0,stackProps:{direction:"row",flexWrap:"wrap"},options:h.FX,value:t,onChange:r,error:F.priority,helperText:null===(n=F.priority)||void 0===n?void 0:n.message})}}),(0,l.jsx)(m.Qr,{control:W,name:"dueDate",defaultValue:null,render:function(e){return(0,l.jsx)(y.M,(0,o.Z)((0,i.Z)({},e),{label:"Due date",inputFormat:"Do MMM YYYY",minDate:u()(),renderInput:function(e){var n;return(0,l.jsx)(v.Z,(0,o.Z)((0,i.Z)({},e),{error:F.dueDate,helperText:null===(n=F.dueDate)||void 0===n?void 0:n.message,color:"secondary",variant:"standard"}))}}))}}),(0,l.jsx)(m.Qr,{name:"assignedUser",control:W,render:function(e){var n,t=e.value,r=e.onChange;return(0,l.jsx)(D.q,{value:t,onChange:function(e,n){return r(n)},onOpen:function(){return Y()},loading:J,options:ee,setSearch:z,isOptionEqualToValue:function(e,n){return e.value===n.value},textFieldProps:{color:"secondary",variant:"standard",label:"Assigned to",error:F.assignedUser,helperText:null===(n=F.assignedUser)||void 0===n?void 0:n.message}})}}),(0,l.jsx)(w.V,{values:$,setValue:U,name:"relatedLinks"}),(0,l.jsx)(C.f,{values:B,setValue:U}),(0,l.jsx)("input",(0,o.Z)((0,i.Z)({},R("relatedLinks")),{type:"hidden"})),(0,l.jsx)("input",(0,o.Z)((0,i.Z)({},R("attachments")),{type:"hidden"}))]})})};E.defaultProps={},E.propTypes={}},42151:function(e,n,t){t.d(n,{ew:function(){return c},go:function(){return u},lm:function(){return l}});var r=t(7297),i=t(75063);function o(){var e=(0,r.Z)(["\n  query GetTaskDetails($id: Int!) {\n    task: Task_by_pk(id: $id) {\n      id\n      status\n      priority\n      statusLog\n      meta\n      relatedLinks\n      title\n      content\n      dueDate\n      createdAt\n      updatedAt\n      adminId\n      archived\n      userId\n      assignedAccountId\n      assignedUser: AssignedUser {\n        id\n        fullName\n      }\n      jobId\n      workflowId\n      job: Job {\n        id\n        number\n        type\n        quoted\n\n        customer: Customer {\n          id\n          name\n        }\n\n        supplier: Supplier {\n          id\n          name\n        }\n\n        location: Location {\n          id\n          name\n        }\n      }\n    }\n  }\n"]);return o=function(){return e},e}function a(){var e=(0,r.Z)(["\n  mutation CreateTask($objects: [Task_insert_input!]!) {\n    insert_Task(objects: $objects) {\n      returning {\n        id\n      }\n    }\n  }\n"]);return a=function(){return e},e}function s(){var e=(0,r.Z)(["\n  mutation UpdateTask($id: Int!, $object: Task_set_input!) {\n    update_Task_by_pk(pk_columns: { id: $id }, _set: $object) {\n      id\n    }\n  }\n"]);return s=function(){return e},e}var l=(0,i.Ps)(o()),c=(0,i.Ps)(a()),u=(0,i.Ps)(s())},11389:function(e,n,t){t.d(n,{E:function(){return i}});var r=t(16310),i=r.Ry({title:r.Z_().required("Title is required field"),content:r.Z_().required("Content is required field"),priority:r.Z_().oneOf(["urgent","high","normal","low"]).required().required("Priority is required field").typeError("Priority is required field"),dueDate:r.hT().required("Due date is required field").typeError("Due date is required field"),assignedUser:r.Ry().required("Assigned to is required field").typeError("Assigned to is required field")})},43759:function(e,n,t){t.d(n,{J:function(){return B}});var r=t(26042),i=t(69396),o=t(828),a=t(29815),s=t(85893),l=t(45697),c=t.n(l),u=t(6812),d=t(50319),p=t(73359),m=t(42283),f=t(79665),h=t(61472),g=t(5616),x=t(11057),v=t(98456),b=t(67720),y=t(86886),j=t(2869),Z=t(51233),w=t(50135),k=t(15861),C=t(41796),_=t(61730),S=t(39300),I=t(42151),D=t(74944),E=t(62547),A=t(11389),T=t(91830),M=t(30381),L=t.n(M),P=t(10166),z=t(6498),O=t(98209),N=t(64277),R=t(83372),q=t(57779),U=t(8539),W=t(57493),F=t(67294),$=t(18531),B=function(e){var n,t=e.id,l=e.close,c=(0,_.Z)("(max-width: 900px)"),M=(0,D.x)().user,P=(0,z.u)(),R=(0,F.useState)(""),B=R[0],G=R[1],Y=(0,m.cI)({defaultValues:{status:"new",priority:"urgent",relatedLinks:[]},resolver:(0,f.S)(A.E)}),K=Y.handleSubmit,J=Y.register,X=Y.watch,ee=Y.setValue,en=Y.control,et=Y.errors,er=Y.reset,ei=X("relatedLinks"),eo=(0,u.a)(I.lm,{variables:{id:t},onCompleted:function(){var e,n,t,r,i,o,s,l,c,u,d,p,m,f,h,g,x=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{task:{}}).task,v=(0,a.Z)(x.relatedLinks||[]);((null===(e=x.job)||void 0===e?void 0:e.id)&&!x.workflowId||(null===(n=x.job)||void 0===n?void 0:n.id)&&x.workflowId&&(null===(t=x.meta)||void 0===t?void 0:null===(r=t.relatedLinksType)||void 0===r?void 0:r.job))&&v.unshift({noDelete:!0,name:"".concat((0,N.y)(x.job.type)," ").concat("quote"!==x.job.type&&x.job.quoted?"Q":""," ").concat(x.job.number),url:"".concat(O.C1.portalUrl,"/dashboard/issues/view?id=").concat(x.job.number),noEdit:!0}),(null===(i=x.job)||void 0===i?void 0:null===(o=i.customer)||void 0===o?void 0:o.id)&&x.workflowId&&(null===(s=x.meta)||void 0===s?void 0:null===(l=s.relatedLinksType)||void 0===l?void 0:l.customer)&&v.unshift({noDelete:!0,name:x.job.customer.name,url:"".concat(O.C1.portalUrl,"/dashboard/customers/view?id=").concat(x.job.customer.id),noEdit:!0}),(null===(c=x.job)||void 0===c?void 0:null===(u=c.supplier)||void 0===u?void 0:u.id)&&x.workflowId&&(null===(d=x.meta)||void 0===d?void 0:null===(p=d.relatedLinksType)||void 0===p?void 0:p.supplier)&&v.unshift({noDelete:!0,name:x.job.supplier.name,url:"".concat(O.C1.portalUrl,"/dashboard/suppliers/view?id=").concat(x.job.supplier.id),noEdit:!0}),(null===(m=x.job)||void 0===m?void 0:null===(f=m.location)||void 0===f?void 0:f.id)&&x.workflowId&&(null===(h=x.meta)||void 0===h?void 0:null===(g=h.relatedLinksType)||void 0===g?void 0:g.location)&&v.unshift({noDelete:!0,name:x.job.location.name,url:"".concat(O.C1.portalUrl,"/dashboard/properties/view?id=").concat(x.job.location.id),noEdit:!0}),er({status:x.status,priority:x.priority,relatedLinks:v,title:x.title,content:x.content,dueDate:x.dueDate,assignedUser:{label:x.assignedUser.fullName,value:x.assignedUser.id}})}}),ea=eo.data,es=(void 0===ea?{task:{}}:ea).task,el=eo.loading,ec=eo.refetch,eu=(0,o.Z)((0,d.D)(I.go,{refetchQueries:["GetTasksTable","GetTaskDetails"]}),2),ed=eu[0],ep=eu[1].loading,em=(0,o.Z)((0,p.t)(W.A5,{variables:{accountId:M.adminId,q:""!==B?"%".concat(B,"%"):null}}),2),ef=em[0],eh=em[1],eg=eh.loading,ex=eh.data,ev=(void 0===ex?{items:[]}:ex).items,eb=function(e){var n=e.relatedLinks.filter(function(e){return!e.noEdit});ed({variables:{id:t,object:{status:e.status,priority:e.priority,relatedLinks:n,title:e.title,content:e.content,dueDate:e.dueDate,adminId:M.adminId,userId:M.id,assignedAccountId:M.adminId,assignedUserId:e.assignedUser.value}}}),l()},ey={disableUnderline:!0,sx:{color:(0,C.$n)(P.palette.text.primary,.46),fontWeight:700}},ej=function(){ed({variables:{id:t,object:{archived:!1}}}),l()};return el||ep?(0,s.jsx)(Z.Z,{width:"100%",direction:"column",justifyContent:"center",alignItems:"center",children:(0,s.jsx)(v.Z,{color:"secondary"})}):(0,s.jsxs)(V,{sx:H.container(null==es?void 0:es.archived),children:[(null==es?void 0:es.archived)&&(0,s.jsx)(Q,{children:(0,s.jsxs)(k.Z,{sx:H.unarchiveLabel,children:["This task has been archived.",(0,s.jsx)(x.Z,{onClick:ej,variant:"text",sx:H.unarchiveButton,children:"Unarchive"})]})}),(0,s.jsxs)(y.ZP,{container:!0,justifyContent:"space-between",rowGap:3,sx:{height:"100%",minHeight:"calc(100vh - 128px)"},children:[(0,s.jsxs)(y.ZP,{item:!0,xs:12,md:5,children:[(0,s.jsx)("form",{id:"offCanvasForm",onSubmit:K(eb),children:(0,s.jsxs)(Z.Z,{direction:"column",spacing:3,children:[(0,s.jsxs)(Z.Z,{direction:"row",spacing:1,children:[(0,s.jsx)(k.Z,{children:"Created date:"}),(0,s.jsx)(k.Z,{fontWeight:700,children:L()(es.createdAt).format("DD/MM/YYYY")})]}),(0,s.jsx)(w.Z,{InputProps:{sx:H.title},variant:"standard",color:"secondary",label:"Title",name:"title",inputRef:J,error:et.title,helperText:null===(n=et.title)||void 0===n?void 0:n.message}),(0,s.jsx)(m.Qr,{control:en,name:"content",render:function(e){var n,t=e.value,r=e.onChange;return(0,s.jsx)(w.Z,{multiline:!0,minRows:8,variant:"filled",color:"secondary",value:t,onChange:r,error:et.content,helperText:null===(n=et.content)||void 0===n?void 0:n.message})}}),(0,s.jsxs)(y.ZP,{container:!0,alignItems:"flex-end",rowGap:1,children:[(0,s.jsx)(y.ZP,{item:!0,xs:12,md:5,lg:5,children:(0,s.jsx)(m.Qr,{control:en,name:"status",render:function(e){var n,t=e.value,r=e.onChange;return(0,s.jsx)(T.P,{formControl:{error:et.status,helperText:null===(n=et.status)||void 0===n?void 0:n.message},selectProps:{input:(0,s.jsx)(j.ZP,{sx:H.hoverOpacity})},withoutSelectIcon:!0,inputComponent:"chip",selectComponent:"chip",leftSideLabel:!0,label:"Status:",value:t,onChange:r,options:h.jb})}})}),(0,s.jsxs)(y.ZP,{container:!0,item:!0,xs:12,md:7,lg:7,display:"flex",direction:"row",alignItems:"center",columnGap:1,children:[(0,s.jsx)(k.Z,{children:"Assigned to:"}),(0,s.jsx)(m.Qr,{name:"assignedUser",control:en,render:function(e){var n,t=e.value,i=e.onChange;return(0,s.jsx)($.q,{value:t,onChange:function(e,n){return i(n)},onOpen:function(){return ef()},loading:eg,options:ev,setSearch:G,isOptionEqualToValue:function(e,n){return e.value===n.value},textFieldProps:{color:"secondary",variant:"standard",error:et.assignedUser,helperText:null===(n=et.assignedUser)||void 0===n?void 0:n.message,InputProps:ey},sx:(0,r.Z)({},H.assignedToAutocomplete,H.hoverBackground)})}})]}),(0,s.jsxs)(y.ZP,{container:!0,item:!0,xs:12,sm:4,md:5,lg:5,display:"flex",direction:"row",alignItems:"center",columnGap:1,children:[(0,s.jsx)(k.Z,{children:"Priority:"}),(0,s.jsx)(m.Qr,{control:en,name:"priority",render:function(e){var n=e.value,t=e.onChange;return(0,s.jsx)(T.P,{selectProps:{input:(0,s.jsx)(j.ZP,{sx:(0,r.Z)({width:"90px!important"},H.paddingHorizontal,H.hoverBackground)}),inputProps:ey},withoutSelectIcon:!0,inputComponent:"textWithIcon",selectComponent:"textWithIcon",options:h.FX,value:n,onChange:t})}})]}),(0,s.jsxs)(y.ZP,{container:!0,item:!0,xs:12,md:7,lg:7,display:"flex",direction:"row",alignItems:"center",columnGap:1,children:[(0,s.jsx)(k.Z,{whiteSpace:"nowrap",children:"Due date:"}),(0,s.jsx)(m.Qr,{control:en,name:"dueDate",render:function(e){return(0,s.jsx)(S.O,(0,i.Z)((0,r.Z)({},e),{inputFormat:"Do MMM YYYY",minDate:L()(),renderInput:function(e){var n;return(0,s.jsx)(s.Fragment,{children:(0,s.jsx)(w.Z,(0,i.Z)((0,r.Z)({sx:(0,r.Z)({width:"120px"},H.paddingHorizontal,H.hoverBackground)},e),{onOpen:e.InputProps.endAdornment,error:et.dueDate,helperText:null===(n=et.dueDate)||void 0===n?void 0:n.message,color:"secondary",variant:"standard",InputProps:ey}))})}}))}})]})]}),(0,s.jsx)(E.V,{values:ei,setValue:ee,name:"relatedLinks"}),(0,s.jsx)("input",(0,i.Z)((0,r.Z)({},J("relatedLinks")),{type:"hidden"}))]})}),(0,s.jsx)(g.Z,{sx:H.marginTop,children:(0,s.jsx)(q.G,{carousel:!1,entityId:es.id,entity:"Task",onMediaAdd:ec,onMediaRemove:ec,columnVisibilityModel:{name:!1},mediaFormProps:{showSubmitButton:!0},offCanvasProps:{submit:!1}})})]}),!c&&(0,s.jsx)(y.ZP,{item:!0,xs:12,md:.5,display:"flex",justifyContent:"center",children:(0,s.jsx)(b.Z,{orientation:"vertical"})}),(0,s.jsx)(y.ZP,{item:!0,xs:12,md:6,children:(0,s.jsx)(U.b,{elevation:0,maxHeight:"800px",title:"Activity",id:t,adminId:M.adminId,scope:"task",expanded:!0,hideExpandIcon:!0})})]})]})},H={assignedToAutocomplete:{".MuiFormControl-fullWidth":{width:"120px !important"},".MuiInputBase-input":{minWidth:"90px !important"},"& .MuiAutocomplete-endAdornment":{"& .MuiButtonBase-root.MuiIconButton-root.MuiAutocomplete-popupIndicator":{"& .MuiSvgIcon-root":{display:"none"}}}},hoverBackground:{":hover":{backgroundColor:"#DDDDDD",borderRadius:"10px"}},marginTop:{marginTop:"10px"},paddingHorizontal:{padding:"0px 3px"},hoverOpacity:{opacity:.6},unarchiveButton:{color:"".concat(R.Q.COLOUR.black,"!important"),fontWeight:600,transition:"all 0.5s easy-in-out",":hover":{textDecoration:"underline"}},unarchiveLabel:{color:"".concat(R.Q.COLOUR.black,"!important"),fontWeight:500},title:{fontSize:20,fontWeight:700},container:function(e){return{marginTop:e?"3.5rem":0}}};B.defaultProps={close:function(){}},B.propTypes={id:c().number.isRequired,close:c().func};var V=(0,P.Z)(g.Z)(function(e){var n=e.theme;return{"& .MuiTypography-root:not(.MuiLink-root)":{color:(0,C.$n)(n.palette.text.primary,.46)},"& .MuiInputBase-formControl:hover .mui-hover":{borderRadius:"10px",transition:".5s easy-in-out",backgroundColor:"red!important"}}}),Q=(0,P.Z)(g.Z)({position:"absolute",left:0,marginTop:"-4.5rem",display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"60px",backgroundColor:R.Q.COLOUR.info})},46242:function(e,n,t){t.d(n,{z:function(){return p}});var r=t(47568),i=t(828),o=t(29815),a=t(97582),s=t(6812),l=t(50319),c=t(92711),u=t(67999),d=t(67294),p=function(e,n,t,p){var m,f,h,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"media",x=(0,d.useState)(!1),v=x[0],b=x[1],y=(0,s.a)(c.O,{variables:{entity:e,entityId:p,category:g,adminId:n},skip:!p}),j=y.data,Z=(void 0===j?{items:[]}:j).items,w=y.loading,k=(0,i.Z)((0,l.D)(u.CI),2),C=k[0],_=k[1].loading,S=(0,i.Z)((0,l.D)(u.xM,{refetchQueries:["MEDIAS"]}),1)[0],I=function(e){C({variables:{mediaId:e}})},D=function(){var e="cleverly-media";return JSON.stringify([{width:32,height:32,bucket:e,sizeName:"vSmall",fit:"inside"},{width:200,height:200,bucket:e,sizeName:"small",fit:"inside"},{width:600,height:600,bucket:e,sizeName:"medium",fit:"inside"},{width:1200,height:1200,bucket:e,sizeName:"large",fit:"inside"}])},E=(m=(0,r.Z)(function(r,i){var o,s;return(0,a.__generator)(this,function(a){switch(a.label){case 0:if(a.trys.push([0,,4,5]),b(!0),!i)return[3,3];return[4,T(i)];case 1:return o=a.sent(),s={adminId:n,caption:i.caption,expiryAt:null,extension:i.media.name.split(".").pop(),userId:t,filename:o.key,type:i.type,Media_Entities:{data:[{entity:e,entityId:r}]}},[4,S({variables:{objects:s}})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:return b(!1),[7];case 5:return[2]}})}),function(e,n){return m.apply(this,arguments)}),A=(f=(0,r.Z)(function(){var r,i,s,l,c,u,d,p,m,f,h,g,x,v,y,j,Z,w,k=arguments;return(0,a.__generator)(this,function(a){switch(a.label){case 0:r=k.length>0&&void 0!==k[0]?k[0]:[],i=k.length>1&&void 0!==k[1]?k[1]:"media",a.label=1;case 1:a.trys.push([1,,10,11]),b(!0),s=null,l=!0,c=!1,u=void 0,a.label=2;case 2:a.trys.push([2,7,8,9]),d=r[Symbol.iterator](),a.label=3;case 3:if(l=(p=d.next()).done)return[3,6];if((m=p.value).mediaId)return[3,5];return[4,T(m)];case 4:h=a.sent(),g=null,x=null,"image"===m.type?(v=h.key,g=(y=h.data.find(function(e){return"large"===e.name}))?y.relativePath:v,x={original:{relativePath:v},thumbnails:h.data||null}):g=h.key,s={Media_Entity:{data:(0,o.Z)(null!==(j=null==s?void 0:null===(f=s.Media_Entity)||void 0===f?void 0:f.data)&&void 0!==j?j:[]).concat([{entity:e,Medium:{data:{adminId:n,caption:null!==(Z=null==m?void 0:m.caption)&&void 0!==Z?Z:null,expiryAt:null,extension:m.media.name.split(".").pop(),userId:t,category:i,filename:g,type:m.type,meta:x}}}])}},a.label=5;case 5:return l=!0,[3,3];case 6:return[3,9];case 7:return w=a.sent(),c=!0,u=w,[3,9];case 8:try{l||null==d.return||d.return()}finally{if(c)throw u}return[7];case 9:return[2,s];case 10:return b(!1),[7];case 11:return[2]}})}),function(){return f.apply(this,arguments)}),T=(h=(0,r.Z)(function(e){var n,t,r,i,o;return(0,a.__generator)(this,function(o){switch(o.label){case 0:switch(n="cleverly-media",t="https://aws.cleverly.works/aws/s3/upload",(r=new window.FormData).append("file",e.media,e.media.name),e.type){case"image":i="https://aws.cleverly.works/image/process",r.append("sizes",D());break;case"document":case"audio":r.append("bucket",n),r.append("folder","".concat(e.type,"s")),i=t}return[4,window.fetch(i,{method:"POST",body:r})];case 1:return[2,o.sent().json()]}})}),function(e){return h.apply(this,arguments)});return{uploadMedia:E,uploadMediaToS3:T,createMediaInput:A,deleteMediaByEntity:I,loadingAddMedia:v,loadingDeleteMedia:_,preloadedMediaLoading:w,preloadedMedia:(null==Z?void 0:Z.length)?Z:[]}}},61472:function(e,n,t){t.d(n,{FX:function(){return f},cj:function(){return d},jb:function(){return m}});var r=t(85893),i=t(83372),o=t(96540),a=t(90244),s=t(98441),l=t(422),c=t(38780),u=t(10105),d={DONE:"done",NEW:"new",IN_PROGRESS:"inprogress",TO_DO:"todo",BLOCKED:"blocked"},p={URGENT:"urgent",HIGH:"high",NORMAL:"normal",LOW:"low"},m=[{value:d.NEW,label:"New",icon:(0,r.jsx)(o.Z,{color:"white"}),color:i.Q.COLOUR.white,bgcolor:"#83BBDC"},{value:d.TO_DO,label:"To do",icon:(0,r.jsx)(a.Z,{color:"white"}),color:i.Q.COLOUR.white,bgcolor:i.Q.COLOUR.secondary},{value:d.IN_PROGRESS,label:"In progress",icon:(0,r.jsx)(s.Z,{color:"white"}),color:i.Q.COLOUR.white,bgcolor:i.Q.COLOUR.info},{value:d.DONE,label:"Done",icon:(0,r.jsx)(l.Z,{color:"white"}),color:i.Q.COLOUR.white,bgcolor:i.Q.COLOUR.success},{value:d.BLOCKED,label:"Blocked",icon:(0,r.jsx)(c.Z,{color:"white"}),color:i.Q.COLOUR.white,bgcolor:i.Q.COLOUR.danger}],f=[{value:p.URGENT,label:"Urgent",icon:(0,r.jsx)(u.Z,{color:"danger"})},{value:p.HIGH,label:"High",icon:(0,r.jsx)(u.Z,{color:"info"})},{value:p.NORMAL,label:"Normal",icon:(0,r.jsx)(u.Z,{color:"secondary"})},{value:p.LOW,label:"Low",icon:(0,r.jsx)(u.Z,{color:"muiGray"})}]}}]);